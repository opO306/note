# Firebase 비용 분석 및 예산 지속 기간 추정

## 예산: 180만원 (약 $1,350 USD, 환율 1,333원 기준)

---

## 현재 사용 중인 Firebase 서비스

### 1. Firestore (데이터베이스)
- **읽기**: $0.06 per 100K
- **쓰기**: $0.18 per 100K
- **삭제**: $0.02 per 100K
- **무료 할당량**: 일일 50K 읽기, 20K 쓰기, 20K 삭제

### 2. Cloud Functions
- **실행 시간**: $0.0000025 per GB-second
- **호출**: $0.40 per million
- **무료 할당량**: 월 2M 호출, 400K GB-second

### 3. Vertex AI (Gemini)
- **Gemini 2.0 Flash**: 
  - 입력: $0.075 per 1M tokens
  - 출력: $0.30 per 1M tokens
- **Gemini 1.5 Flash**:
  - 입력: $0.075 per 1M tokens
  - 출력: $0.30 per 1M tokens
- **무료 할당량**: 없음 (모두 유료)

### 4. Storage
- **저장**: $0.026 per GB/month
- **다운로드**: $0.12 per GB
- **무료 할당량**: 5GB 저장, 1GB/일 다운로드

### 5. Authentication
- **무료**: 무제한 사용자

### 6. Hosting
- **무료**: 일일 10GB 전송량까지

---

## 사용 패턴 분석

### 스케줄된 함수 (정기 실행)
1. **일일 추천** (`sendMorningRecommendations`)
   - 실행: 매일 09:00 KST
   - 대상: 최대 500명/일
   - Firestore 읽기: ~1,000회/사용자 (신호 수집)
   - Firestore 쓰기: ~10회/사용자
   - **월간 비용**: 약 $15-30

2. **주간 통계** (`calcWeeklyStats`)
   - 실행: 매주 월요일 08:00
   - Firestore 읽기: ~10,000회 (모든 게시물)
   - Firestore 쓰기: ~1,000회
   - Functions 실행: ~9분 (1GB 메모리)
   - **월간 비용**: 약 $5-10

3. **주간 퀴즈** (`generateWeeklyQuiz`)
   - 실행: 매주 월요일 09:00
   - Vertex AI 호출: ~10-20회/주
   - 평균 토큰: 입력 2K, 출력 1K per 호출
   - **월간 비용**: 약 $2-5

### 트리거 함수 (이벤트 기반)
1. **게시물 생성** (`onPostCreated`)
   - 모더레이션 검사 (욕설, 개인정보, 스팸)
   - Firestore 읽기: ~5-10회
   - Firestore 쓰기: ~3-5회

2. **게시물 수정** (`onPostUpdated`)
   - 답글 추가 시 모더레이션
   - Firestore 읽기: ~3-5회
   - Firestore 쓰기: ~2-3회

3. **알림 생성** (`onNotificationCreated`)
   - 푸시 알림 발송
   - Firestore 읽기: ~2회
   - FCM 발송: 무료 (Firebase 기본)

### 클라이언트 측 사용량
1. **실시간 리스너** (`onSnapshot`)
   - 알림 목록: 지속적 읽기
   - 사용자 프로필: 지속적 읽기
   - **비용 증가 요인**: 실시간 업데이트로 인한 읽기 증가

2. **게시물 조회**
   - 초기 로드: 24개 게시물
   - 조회수 증가: 쓰기 1회
   - 조회 로그: 쓰기 1회

---

## 비용 추정 시나리오

### 시나리오 1: 소규모 (일일 활성 사용자 100명)
**일일 활동량**:
- 게시물 작성: 10개
- 답글 작성: 50개
- 게시물 조회: 500회
- 알림 생성: 30개
- 실시간 리스너: 100명 × 평균 2시간/일 = 200시간/일

**월간 비용**:
- Firestore 읽기: 
  - 일반 읽기: ~500K
  - 실시간 리스너 (onSnapshot): ~1.5M (알림, 프로필 업데이트 등)
  - 총 읽기: ~2M (무료 할당량 초과: $1.17)
- Firestore 쓰기: ~50K (무료 할당량 초과: $0.54)
- Functions 호출: ~10K (무료)
- Functions 실행 시간: ~100K GB-second (무료)
- Vertex AI: $5 (주간 퀴즈만)
- 일일 추천: $10 (500명 × 30일, 최대 500명/일 제한)
- **총액**: 약 **$17-20/월**

**180만원 지속 기간**: **약 6-8개월**

### 시나리오 2: 중규모 (일일 활성 사용자 500명)
**일일 활동량**:
- 게시물 작성: 50개
- 답글 작성: 250개
- 게시물 조회: 2,500회
- 알림 생성: 150개
- 실시간 리스너: 500명 × 평균 2시간/일 = 1,000시간/일

**월간 비용**:
- Firestore 읽기:
  - 일반 읽기: ~2.5M
  - 실시간 리스너: ~7.5M (알림, 프로필 등)
  - 총 읽기: ~10M (무료 할당량 초과: $5.70)
- Firestore 쓰기: ~250K (무료 할당량 초과: $2.70)
- Functions 호출: ~50K (무료)
- Functions 실행 시간: ~500K GB-second (무료 할당량 초과: $0.25)
- Vertex AI: $5
- 일일 추천: $15 (500명 × 30일, 최대 500명/일 제한)
- **총액**: 약 **$29-35/월**

**180만원 지속 기간**: **약 3.5-4.5개월**

### 시나리오 3: 대규모 (일일 활성 사용자 2,000명)
**일일 활동량**:
- 게시물 작성: 200개
- 답글 작성: 1,000개
- 게시물 조회: 10,000회
- 알림 생성: 600개
- 실시간 리스너: 2,000명 × 평균 2시간/일 = 4,000시간/일

**월간 비용**:
- Firestore 읽기:
  - 일반 읽기: ~10M
  - 실시간 리스너: ~30M (알림, 프로필 등)
  - 총 읽기: ~40M (무료 할당량 초과: $23.70)
- Firestore 쓰기: ~1M (무료 할당량 초과: $10.80)
- Functions 호출: ~200K (무료)
- Functions 실행 시간: ~2M GB-second (무료 할당량 초과: $4.00)
- Vertex AI: $5
- 일일 추천: $15 (500명 × 30일, 최대 500명/일 제한)
- Storage: $5 (추정)
- **총액**: 약 **$54-65/월**

**180만원 지속 기간**: **약 2-2.5개월**

### 시나리오 4: 대규모 + AI 모더레이션 활성화
**추가 비용**:
- AI 모더레이션: 게시물의 10% 검사 가정
  - 일일 20개 게시물 × 30일 = 600회/월
  - 평균 토큰: 입력 1K, 출력 0.5K
  - 비용: $0.06/월
- AI 자동 답변: 일일 50회 가정
  - 월 1,500회
  - 평균 토큰: 입력 2K, 출력 1K
  - 비용: $0.30/월
- **AI 추가 비용**: 약 **$0.50-1/월**

**총액 (시나리오 3 기준)**: 약 **$55-66/월**

**180만원 지속 기간**: **약 2-2.5개월**

---

## 비용 최적화 권장사항 (긴급)

### 1. Firestore 읽기 최적화 (최우선)
- ⚠️ **실시간 리스너(`onSnapshot`)가 비용의 70% 이상 차지**
- ✅ 알림 리스너: 폴링 방식으로 변경 (30초 간격)
- ✅ 프로필 리스너: 필요한 경우만 구독, 자동 해제 강화
- ✅ 페이지네이션 강화 (초기 24개 → 10개로 감소)
- ✅ 캐싱 전략 강화 (로컬 스토리지 활용)

### 2. Functions 최적화
- ✅ Cold start 최소화 (이미 적용됨)
- ✅ 불필요한 트리거 제거
- ✅ 배치 처리 활용

### 3. Vertex AI 비용 절감
- ✅ AI 모더레이션: 위험도 높은 경우만 사용 (현재 관리자 수동)
- ✅ 자동 답변: 사용자 요청 시에만
- ✅ 주간 퀴즈: 주 1회만 (현재 적용됨)

### 4. Storage 최적화
- ✅ 이미지 압축
- ✅ CDN 활용

---

## 예상 지속 기간 요약

| 사용자 규모 | 일일 활성 사용자 | 월간 비용 | 180만원 지속 기간 |
|------------|----------------|----------|------------------|
| 소규모 | 100명 | $17-20 | **약 6-8개월** |
| 중규모 | 500명 | $29-35 | **약 3.5-4.5개월** |
| 대규모 | 2,000명 | $54-65 | **약 2-2.5개월** |
| 대규모 + AI | 2,000명 | $55-66 | **약 2-2.5개월** |

**⚠️ 주의**: 실시간 리스너(`onSnapshot`) 사용으로 인해 읽기 비용이 크게 증가합니다.

---

## 주의사항

1. **실시간 리스너 비용**: `onSnapshot` 사용 시 읽기 비용이 급증할 수 있음
2. **사용자 증가**: 사용자가 늘어날수록 비용은 선형적으로 증가
3. **AI 비용**: Vertex AI는 무료 할당량이 없어 사용량에 비례
4. **예상치 못한 트래픽**: 바이럴 등으로 인한 급증 시 비용 폭증 가능

---

## 비용 모니터링 권장사항

1. **Firebase Console에서 비용 알림 설정**
   - 월 $50, $100, $200 등 임계값 설정
2. **일일 사용량 모니터링**
   - Firestore 읽기/쓰기 추이 확인
   - Functions 호출 횟수 추적
3. **비용 예산 설정**
   - Firebase Console에서 예산 제한 설정

---

## 결론

**현재 시스템 기준으로 180만원 예산으로는:**

| 사용자 규모 | 일일 활성 사용자 | 월간 비용 | 180만원 지속 기간 |
|------------|----------------|----------|------------------|
| **소규모** | 100명 | $17-20 | **약 6-8개월** |
| **중규모** | 500명 | $29-35 | **약 3.5-4.5개월** |
| **대규모** | 2,000명 | $54-65 | **약 2-2.5개월** |

### 주요 비용 요인
1. **실시간 리스너(`onSnapshot`)**: 비용의 70% 이상 차지
   - 알림 리스너: 지속적 읽기 발생
   - 프로필 리스너: 사용자별 구독
2. **일일 추천 시스템**: 매일 500명 처리
3. **Firestore 쓰기**: 게시물/답글 작성 시 증가

### 비용 절감 시 지속 기간
실시간 리스너를 폴링 방식으로 변경하면:
- **소규모**: 6-8개월 → **12-15개월**
- **중규모**: 3.5-4.5개월 → **6-8개월**
- **대규모**: 2-2.5개월 → **4-5개월**

**⚠️ 실제 지속 기간은 사용자 활동량, 실시간 리스너 사용 패턴, AI 사용 빈도에 따라 크게 달라질 수 있습니다.**

