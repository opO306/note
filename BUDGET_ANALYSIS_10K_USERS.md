# Firebase 비용 분석 및 예산 지속 기간 추정 (1만명 사용자 기준)

## 예산: 180만원 (약 $1,350 USD, 환율 1,333원 기준)

---

## 사용자 규모: 최대 1만명

### 가정
- **전체 사용자 수**: 10,000명
- **일일 활성 사용자(DAU)**: 1,000-2,000명 (10-20% 활성률)
- **월간 활성 사용자(MAU)**: 3,000-5,000명 (30-50% 활성률)

---

## 현재 사용 중인 Firebase 서비스

### 1. Firestore (데이터베이스)
- **읽기**: $0.06 per 100K
- **쓰기**: $0.18 per 100K
- **삭제**: $0.02 per 100K
- **무료 할당량**: 일일 50K 읽기, 20K 쓰기, 20K 삭제

### 2. Cloud Functions
- **실행 시간**: $0.0000025 per GB-second
- **호출**: $0.40 per million
- **무료 할당량**: 월 2M 호출, 400K GB-second

### 3. Vertex AI (Gemini)
- **Gemini 2.0 Flash**: 
  - 입력: $0.075 per 1M tokens
  - 출력: $0.30 per 1M tokens
- **무료 할당량**: 없음 (모두 유료)

### 4. Storage
- **저장**: $0.026 per GB/month
- **다운로드**: $0.12 per GB
- **무료 할당량**: 5GB 저장, 1GB/일 다운로드

### 5. Authentication
- **무료**: 무제한 사용자

### 6. Hosting
- **무료**: 일일 10GB 전송량까지

---

## 사용 패턴 분석 (1만명 사용자 기준)

### 일일 활동량 추정 (DAU 1,500명 기준)
- **게시물 작성**: 150개/일 (10% 작성)
- **답글 작성**: 750개/일 (50% 답글)
- **게시물 조회**: 7,500회/일 (평균 5회/사용자)
- **알림 생성**: 450개/일
- **등불(좋아요)**: 1,500개/일
- **팔로우**: 100개/일

### 스케줄된 함수 (정기 실행)

#### 1. 일일 추천 (`sendMorningRecommendations`)
- **실행**: 매일 09:00 KST
- **대상**: 최대 200명/일 (최적화 후)
- **Firestore 읽기**: ~700회/사용자 (최적화 후, 7일 데이터만)
- **Firestore 쓰기**: ~10회/사용자
- **월간 비용**: 
  - 읽기: 200명 × 700회 × 30일 = 4.2M 읽기 → $2.52
  - 쓰기: 200명 × 10회 × 30일 = 60K 쓰기 → $0.72
  - Functions 실행: 200명 × 30일 × 5초 × 1GB = 30K GB-second (무료)
  - **총액**: 약 **$3-4/월**

#### 2. 주간 통계 (`calcWeeklyStats`)
- **실행**: 매주 월요일 08:00
- **Firestore 읽기**: ~10,000회 (모든 게시물)
- **Firestore 쓰기**: ~1,000회 (상위 100명 보상)
- **Functions 실행**: ~9분 (1GB 메모리) = 540초 × 1GB = 540 GB-second (무료)
- **월간 비용**: 약 **$5-8/월**

#### 3. 주간 퀴즈 (`generateWeeklyQuiz`)
- **실행**: 매주 월요일 09:00
- **Vertex AI 호출**: ~10-15회/주 (최적화 후, 서브카테고리 2개)
- **평균 토큰**: 입력 2K, 출력 1K per 호출
- **월간 비용**: 
  - 입력: 15회 × 4주 × 2K = 120K tokens → $0.009
  - 출력: 15회 × 4주 × 1K = 60K tokens → $0.018
  - **총액**: 약 **$2-3/월**

### 트리거 함수 (이벤트 기반)

#### 1. 게시물 생성 (`onPostCreated`)
- **일일 호출**: 150회
- **Firestore 읽기**: ~8회/호출 (신뢰도, 최근 게시물, 사용자 정보)
- **Firestore 쓰기**: ~4회/호출 (게시물 업데이트, 사용자 카운트)
- **월간 비용**:
  - 읽기: 150회 × 8회 × 30일 = 36K 읽기 (무료)
  - 쓰기: 150회 × 4회 × 30일 = 18K 쓰기 (무료)
  - Functions 호출: 150회 × 30일 = 4.5K 호출 (무료)
  - **총액**: **무료** (무료 할당량 내)

#### 2. 게시물 수정 (`onPostUpdated`)
- **일일 호출**: 750회 (답글 작성)
- **Firestore 읽기**: ~5회/호출
- **Firestore 쓰기**: ~3회/호출
- **월간 비용**:
  - 읽기: 750회 × 5회 × 30일 = 112.5K 읽기 (무료 할당량 초과: $0.0375)
  - 쓰기: 750회 × 3회 × 30일 = 67.5K 쓰기 (무료 할당량 초과: $0.0855)
  - Functions 호출: 750회 × 30일 = 22.5K 호출 (무료)
  - **총액**: 약 **$0.12/월**

#### 3. 알림 생성 (`onNotificationCreated`)
- **일일 호출**: 450회
- **Firestore 읽기**: ~2회/호출
- **FCM 발송**: 무료 (Firebase 기본)
- **월간 비용**:
  - 읽기: 450회 × 2회 × 30일 = 27K 읽기 (무료)
  - Functions 호출: 450회 × 30일 = 13.5K 호출 (무료)
  - **총액**: **무료**

#### 4. 기타 트리거 함수
- **팔로우 생성/삭제**: 100회/일 → 월 3K 호출 (무료)
- **등불 생성**: 1,500회/일 → 월 45K 호출 (무료)
- **신고 생성**: 10회/일 → 월 300호출 (무료)

### 클라이언트 측 사용량 (최적화 적용 후)

#### 1. 게시물 조회
- **초기 로드**: 10개 게시물 (최적화 후)
- **일일 조회**: 7,500회
- **월간 비용**:
  - 읽기: 7,500회 × 10개 × 30일 = 2.25M 읽기 (무료 할당량 초과: $1.35)
  - 조회수 증가 쓰기: 7,500회 × 30일 = 225K 쓰기 (무료 할당량 초과: $0.405)
  - **총액**: 약 **$1.76/월**

#### 2. 알림 폴링 (최적화 적용)
- **폴링 간격**: 30초
- **일일 활성 사용자**: 1,500명
- **평균 세션 시간**: 2시간
- **월간 비용**:
  - 읽기: 1,500명 × (2시간 × 3600초 / 30초) × 30일 = 10.8M 읽기 (무료 할당량 초과: $6.48)
  - **총액**: 약 **$6.48/월**

#### 3. 프로필 조회 (최적화 적용)
- **폴링 간격**: 1분
- **일일 활성 사용자**: 1,500명
- **평균 프로필 조회**: 10개/사용자/일
- **월간 비용**:
  - 읽기: 1,500명 × 10개 × 30일 = 450K 읽기 (무료 할당량 초과: $0.27)
  - **총액**: 약 **$0.27/월**

#### 4. 게시물 작성/답글 작성
- **일일 게시물**: 150개
- **일일 답글**: 750개
- **월간 비용**:
  - 쓰기: (150 + 750) × 30일 = 27K 쓰기 (무료 할당량 초과: $0.0126)
  - **총액**: 약 **$0.01/월**

### AI 기능 사용량

#### 1. AI 자동 답변 (`aiAutoReply`)
- **일일 호출**: 50회 (사용자 요청 시)
- **평균 토큰**: 입력 2K, 출력 1K
- **월간 비용**:
  - 입력: 50회 × 30일 × 2K = 3M tokens → $0.225
  - 출력: 50회 × 30일 × 1K = 1.5M tokens → $0.45
  - **총액**: 약 **$0.68/월**

#### 2. AI 모더레이션 (`aiModerationReview`)
- **일일 호출**: 20회 (관리자 수동)
- **평균 토큰**: 입력 1K, 출력 0.5K
- **월간 비용**:
  - 입력: 20회 × 30일 × 1K = 600K tokens → $0.045
  - 출력: 20회 × 30일 × 0.5K = 300K tokens → $0.09
  - **총액**: 약 **$0.14/월**

### Storage 사용량

#### 1. 프로필 이미지
- **사용자 수**: 10,000명
- **평균 이미지 크기**: 50KB (압축 후)
- **총 저장량**: 10,000 × 50KB = 500MB = 0.5GB
- **월간 저장 비용**: 0.5GB × $0.026 = $0.013

#### 2. 이미지 다운로드
- **일일 다운로드**: 1,500명 × 10개 프로필 = 15,000회
- **월간 다운로드**: 15,000회 × 30일 × 50KB = 22.5GB
- **무료 할당량**: 1GB/일 = 30GB/월
- **월간 다운로드 비용**: **무료** (무료 할당량 내)

---

## 월간 비용 요약 (1만명 사용자 기준)

### 시나리오 1: 보수적 추정 (DAU 1,000명)

| 항목 | 월간 비용 |
|------|----------|
| Firestore 읽기 | $8-10 |
| Firestore 쓰기 | $0.5-1 |
| Cloud Functions | $0 (무료 할당량 내) |
| Vertex AI | $3-4 |
| Storage | $0.01 |
| **총액** | **$12-15/월** |

**180만원 지속 기간**: **약 7-9년** (84-108개월)

### 시나리오 2: 현실적 추정 (DAU 1,500명)

| 항목 | 월간 비용 |
|------|----------|
| Firestore 읽기 | $8-12 |
| Firestore 쓰기 | $0.5-1 |
| Cloud Functions | $0 (무료 할당량 내) |
| Vertex AI | $3-4 |
| Storage | $0.01 |
| **총액** | **$12-17/월** |

**180만원 지속 기간**: **약 6.5-9년** (78-108개월)

### 시나리오 3: 최대 부하 추정 (DAU 2,000명)

| 항목 | 월간 비용 |
|------|----------|
| Firestore 읽기 | $10-15 |
| Firestore 쓰기 | $0.8-1.5 |
| Cloud Functions | $0-1 |
| Vertex AI | $3-5 |
| Storage | $0.02 |
| **총액** | **$14-22/월** |

**180만원 지속 기간**: **약 5-8년** (60-96개월)

---

## 비용 최적화 적용 효과

### 최적화 전 예상 비용 (비교용)
- **Firestore 읽기**: $50-80/월 (실시간 리스너 사용 시)
- **총액**: $60-100/월
- **180만원 지속 기간**: 약 1-1.5년 (12-18개월)

### 최적화 후 실제 비용
- **Firestore 읽기**: $8-15/월 (폴링 방식)
- **총액**: $12-22/월
- **180만원 지속 기간**: 약 5-9년 (60-108개월)

**절감 효과**: **약 80-85% 비용 절감**

---

## 주요 비용 요인 분석

### 1. Firestore 읽기 (비용의 60-70%)
- **알림 폴링**: $6-8/월
- **게시물 조회**: $1-2/월
- **프로필 조회**: $0.3-0.5/월
- **기타**: $1-2/월

### 2. Vertex AI (비용의 20-25%)
- **주간 퀴즈**: $2-3/월
- **AI 자동 답변**: $0.7/월
- **AI 모더레이션**: $0.1-0.2/월

### 3. Firestore 쓰기 (비용의 5-10%)
- **게시물/답글 작성**: $0.5-1/월
- **기타 업데이트**: $0.1-0.5/월

### 4. Storage (비용의 1% 미만)
- **저장**: $0.01/월
- **다운로드**: 무료 (할당량 내)

---

## 예상 지속 기간 요약

| 시나리오 | 일일 활성 사용자 | 월간 비용 | 180만원 지속 기간 |
|---------|----------------|----------|------------------|
| **보수적** | 1,000명 | $12-15 | **약 7-9년** (84-108개월) |
| **현실적** | 1,500명 | $12-17 | **약 6.5-9년** (78-108개월) |
| **최대 부하** | 2,000명 | $14-22 | **약 5-8년** (60-96개월) |

---

## 비용 모니터링 권장사항

### 1. Firebase Console 설정
- **비용 알림**: 월 $20, $50, $100 임계값 설정
- **일일 사용량 모니터링**: Firestore 읽기/쓰기 추이 확인
- **Functions 호출 횟수 추적**: 비정상적인 증가 감지

### 2. 예산 제한 설정
- Firebase Console에서 월간 예산 제한 설정
- 예산 초과 시 자동 알림 및 서비스 제한

### 3. 정기적인 비용 검토
- **주간**: Firestore 읽기/쓰기 추이 확인
- **월간**: 전체 비용 분석 및 최적화 기회 탐색

---

## 추가 비용 절감 기회

### 1. 알림 폴링 간격 조정
- **현재**: 30초
- **조정**: 60초로 변경 시 읽기 비용 50% 절감
- **예상 절감**: $3-4/월

### 2. 프로필 캐싱 강화
- **현재**: 1분 폴링
- **조정**: 5분 폴링 + 로컬 캐시 강화
- **예상 절감**: $0.2-0.3/월

### 3. AI 기능 사용량 제한
- **AI 자동 답변**: 일일 호출 제한 (50회 → 30회)
- **예상 절감**: $0.3-0.4/월

### 4. 게시물 페이지네이션 추가 최적화
- **현재**: 초기 10개
- **조정**: 초기 5개 + 무한 스크롤
- **예상 절감**: $0.5-1/월

---

## 결론

### 1만명 사용자 기준 예상 비용 및 지속 기간

**현실적 시나리오 (DAU 1,500명)**:
- **월간 비용**: $12-17
- **180만원 지속 기간**: **약 6.5-9년** (78-108개월)
- **연간 비용**: 약 $144-204 (약 19-27만원)

### 주요 특징
1. **비용 최적화 효과**: 실시간 리스너를 폴링으로 변경하여 80-85% 비용 절감
2. **안정적인 운영**: 180만원으로 최소 5년 이상 운영 가능
3. **확장성**: 사용자 증가에 따라 비용이 선형적으로 증가하지만, 여전히 경제적

### 주의사항
1. **사용자 증가**: 사용자가 1만명을 초과하면 비용이 선형적으로 증가
2. **활성 사용자 비율**: DAU 비율이 높아지면 비용 증가
3. **AI 기능 사용량**: AI 기능 사용량이 증가하면 Vertex AI 비용 증가
4. **예상치 못한 트래픽**: 바이럴 등으로 인한 급증 시 비용 폭증 가능

### 권장사항
1. **비용 모니터링**: 정기적인 비용 추적 및 분석
2. **최적화 지속**: 추가 비용 절감 기회 지속 탐색
3. **예산 관리**: Firebase Console에서 예산 제한 설정
4. **사용자 증가 대비**: 사용자 증가에 따른 비용 증가 계획 수립

---

**최종 결론**: 180만원 예산으로 1만명 사용자 기준 **약 6-9년** 운영 가능 (현실적 시나리오 기준)

