import{r,j as s}from"./index-Dk92xA2w.js";import{B as p,g as C}from"./App-Bs6YIlvy.js";import{C as X,a as Y}from"./card-BTNeCppV.js";import{I as Z}from"./input-CIhE7IwC.js";import{b as _,i as ee,j as se}from"./MainScreenRefactored-Cnk3o5eP.js";import{A as ae}from"./arrow-left-BKP0x_yl.js";import{S as re}from"./search-C4k4I2w1.js";import"./vendor-capacitor-rvH5hiNU.js";import"./vendor-react-1wgkHQEd.js";import"./vendor-firebase-C8ERkm_B.js";import"./toastHelper-CmqwgrpB.js";import"./index-DKlU3y7i.js";import"./index-SzzsopSI.js";import"./checkbox-BNqRj2KP.js";import"./check-CFbpOADo.js";import"./avatar-BVorKTXF.js";import"./alert-dialog-simple-CJo3HBbI.js";import"./sparkles-BV-B8Lrs.js";import"./firebaseCache-C_csZa1c.js";import"./profanityFilter-CmEWjjlv.js";import"./users-D58BOHBF.js";import"./sun-aJJImKwH.js";function Le({onBack:i,categories:L,activeCategory:I,activeSubCategory:S,onCategorySelect:n,posts:T,onPostSelect:g,userNickname:P="",userProfileImage:U="",currentTitle:A="",isPostLanterned:m,isBookmarked:u,onLanternToggle:j,onBookmarkToggle:b,formatTimeAgo:h,formatCreatedAt:x,isGuest:M,userUid:z}){const[t,f]=r.useState(""),[o,v]=r.useState("category"),E=_({key:`category-${o}`}),N=L.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())||e.subCategories.some(a=>a.name.toLowerCase().includes(t.toLowerCase()))),d=T.filter(e=>e.title?.toLowerCase?.().includes(t.toLowerCase())||e.content?.toLowerCase?.().includes(t.toLowerCase())||e.author?.toLowerCase?.().includes(t.toLowerCase())||e.tags&&e.tags.some(a=>a.toLowerCase().includes(t.toLowerCase()))),k=r.useCallback(e=>{n(e,"전체"),i()},[n,i]),y=r.useCallback((e,a)=>{n(e,a),i()},[n,i]),R=r.useCallback(e=>{f(e.target.value)},[]),$=r.useCallback(()=>{v("category"),f("")},[]),D=r.useCallback(()=>{v("post"),f("")},[]),F=r.useCallback(e=>{g(e)},[g]),O=r.useCallback(e=>{const a=e.currentTarget.dataset.categoryId;a&&k(a)},[k]),B=r.useCallback(e=>{const a=e.currentTarget.dataset.categoryId,c=e.currentTarget.dataset.subCategoryId;a&&c&&y(a,c)},[y]),W=r.useCallback(e=>m?m(e):!1,[m]),q=r.useCallback(e=>u?u(e):!1,[u]),G=r.useCallback(e=>{j?.(e)},[j]),H=r.useCallback(e=>{b?.(e)},[b]),J=r.useCallback(e=>h?h(e):"",[h]),K=r.useCallback(e=>x?x(e):"",[x]),Q=r.useMemo(()=>{const e=new Set;return d.forEach(a=>{typeof a?.authorUid=="string"&&a.authorUid.length>0&&e.add(a.authorUid)}),Array.from(e)},[d]),V=ee(Q);return s.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[s.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:s.jsxs("div",{className:"px-4 py-3",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[s.jsx(p,{variant:"ghost",size:"icon",onClick:i,children:s.jsx(ae,{className:"w-5 h-5"})}),s.jsx("h1",{className:"font-medium",children:"카테고리 선택"})]}),s.jsxs("div",{className:"flex space-x-2 mb-3",children:[s.jsx(p,{variant:o==="category"?"default":"outline",size:"sm",onClick:$,className:"flex-1",children:"카테고리 검색"}),s.jsx(p,{variant:o==="post"?"default":"outline",size:"sm",onClick:D,className:"flex-1",children:"글 검색"})]}),s.jsxs("div",{className:"relative",children:[s.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),s.jsx(Z,{type:"text",placeholder:o==="category"?"카테고리 검색...":"글 제목, 내용, 작성자 검색...",value:t,onChange:R,className:"pl-10 h-9"})]})]})}),o==="category"?s.jsx("div",{ref:E,className:"flex-1 scroll-container scrollbar-hide",children:s.jsxs("div",{className:"p-4 space-y-4",children:[N.map(e=>{const a=e.icon,c=I===e.id;return s.jsx(X,{className:`transition-all list-optimized ${c?"ring-2 ring-primary":""}`,children:s.jsx(Y,{className:"p-4",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between cursor-pointer hover:bg-accent/50 p-3 rounded-md -m-2 touch-target","data-category-id":e.id,onClick:O,children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-primary/10 to-primary/20 flex items-center justify-center",children:s.jsx(a,{className:"w-5 h-5 text-primary"})}),s.jsx("div",{children:s.jsx("h3",{className:"font-medium",children:e.name})})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[c&&s.jsx(C,{variant:"default",className:"text-xs",children:"선택됨"}),s.jsx(C,{variant:"secondary",className:"text-xs tabular-nums",children:e.count})]})]}),e.id!=="전체"&&e.subCategories.length>1&&s.jsx("div",{className:"ml-4 space-y-2",children:s.jsx("div",{className:"border-l-2 border-border pl-4 space-y-2",children:e.subCategories.filter(l=>l.id!=="전체").filter(l=>t===""||l.name.toLowerCase().includes(t.toLowerCase())).map(l=>{const w=c&&S===l.id;return s.jsxs("div",{className:`flex items-center justify-between cursor-pointer hover:bg-accent/50 p-3 rounded-md transition-colors touch-target ${w?"bg-accent":""}`,"data-category-id":e.id,"data-sub-category-id":l.id,onClick:B,children:[s.jsx("div",{children:s.jsx("p",{className:"text-sm font-medium",children:l.name})}),s.jsx("div",{className:"flex items-center space-x-2",children:w&&s.jsx(C,{variant:"default",className:"text-xs",children:"선택됨"})})]},l.id)})})})]})})},e.id)}),N.length===0&&t&&s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-muted-foreground",children:"검색된 카테고리가 없습니다."})})]})}):s.jsx("div",{className:"flex-1 overflow-hidden bg-background",children:d.length>0?s.jsx(se,{posts:d,userNickname:P,userProfileImage:U,isPostLanterned:W,isBookmarked:q,currentTitle:A,userProfiles:V,formatTimeAgo:J,formatCreatedAt:K,onPostClick:F,onLanternToggle:G,onBookmarkToggle:H,isGuest:M,userUid:z||""}):t?s.jsx("div",{className:"h-full flex items-center justify-center p-4",children:s.jsx("p",{className:"text-muted-foreground",children:"검색된 글이 없습니다."})}):s.jsx("div",{className:"h-full flex items-center justify-center p-4",children:s.jsx("p",{className:"text-muted-foreground",children:"검색어를 입력해주세요."})})})]})}export{Le as CategoryScreen};
