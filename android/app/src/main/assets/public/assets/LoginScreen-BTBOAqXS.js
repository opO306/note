import{a as S,r as d,j as e}from"./index-nq_z7WhA.js";import{C as x}from"./vendor-capacitor-rvH5hiNU.js";import{G as h,u as I,B as y,L as z}from"./App-COUbzzsB.js";import{G as M,B as L}from"./vendor-firebase-D1NEqzdz.js";import{p as n}from"./loginDebug-CNrNP7Rg.js";import{t as T}from"./toastHelper-BQ6M3Cc4.js";import{C as A,a as G}from"./card-DIbA5A_d.js";import{C as O}from"./checkbox-CFUi8qYh.js";import{L as B}from"./label-DFqdyXVq.js";import{S as $,M as E}from"./sun-BhpYpMxp.js";import"./vendor-react-1wgkHQEd.js";import"./index-Bjta6Ul0.js";import"./index-C-WI9JZT.js";import"./check-FzTHNnAz.js";let w=!1;async function W(){w||(w=!0,n("init.start",{platform:x.getPlatform()}),x.getPlatform()==="web"?await h.initialize({clientId:"852428184810-eh4ojd3kj5ssvia7o54iteamk2sub31o.apps.googleusercontent.com",scopes:["profile","email"],grantOfflineAccess:!0}):await h.initialize(),n("init.done"))}function P(t){return t.length<=12?"***":`${t.slice(0,6)}...${t.slice(-6)}`}async function U(){await W(),n("google.signIn.start");const o=(await h.signIn()).authentication?.idToken;if(n("google.signIn.done",{hasIdToken:!!o,idTokenPreview:o?P(o):null}),!o)throw new Error("No Google idToken");const s=M.credential(o);n("firebase.credential.created");try{n("firebase.signIn.start",{type:"signInWithCredential"});const r=await L(S,s);return n("firebase.signIn.done",{uid:r.user.uid,isAnonymous:r.user.isAnonymous,providers:r.user.providerData.map(m=>m?.providerId)}),r}catch(r){throw n("error",{where:"loginWithGoogle",code:r?.code,message:r?.message}),r}}function g(t){try{const o=new WeakSet;return JSON.stringify(t,(s,r)=>{if(typeof s=="string"&&/token|idToken|accessToken/i.test(s))return"***";if(typeof r=="string"&&r.length>2e3)return r.slice(0,2e3)+"...";if(typeof r=="object"&&r!==null){if(o.has(r))return"[Circular]";o.add(r)}return r},2)}catch{return String(t)}}function D(t){const o={title:"Google ë¡œê·¸ì¸ ì‹¤íŒ¨",message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"};if(!t)return o;if(t instanceof Error){const s=t.code??t.error??t.status;return{title:o.title,code:s?String(s):void 0,message:t.message||o.message,raw:g(t)}}if(typeof t=="object"){const s=t,r=s.code??s.error??s.status,m=s.message??s.errorMessage??s.localizedMessage??(typeof s=="string"?s:void 0)??o.message;return{title:o.title,code:r?String(r):void 0,message:String(m),raw:g(t)}}return{title:o.title,code:typeof t=="number"?String(t):void 0,message:String(t),raw:g(t)}}const b=["ğ“","ğ“‘","ğ“’","ğ““","ğ“”","ğ“•","ğ“–","ğ“—","ğ“˜","ğ“™","ğ“š","ğ“›","ğ“œ","ğ“","ğ“","ğ“Ÿ","ğ“ ","ğ“¡","ğ“¢","ğ“£","ğ“¤","ğ“¥","ğ“¦","ğ“§","ğ“¨","ğ“©","ğ“ª","ğ“«","ğ“¬","ğ“­","ğ“®","ğ“¯","ğ“°","ğ“±","ğ“²","ğ“³","ğ“´","ğ“µ","ğ“¶","ğ“·","ğ“¸","ğ“¹","ğ“º","ğ“»","ğ“¼","ğ“½","ğ“¾","ğ“¿","ğ”€","ğ”","ğ”‚","ğ”ƒ","ğ’œ","ğ’","ğ’Ÿ","ğ’¢","ğ’¥","ğ’¦","ğ’©","ğ’ª","ğ’¬","ğ’®","ğ’¯","ğ’³","ğ’´","ğ’µ"],j=d.memo(({item:t})=>{const o=t.opacity<.2?"fadeInOut1":t.opacity<.25?"fadeInOut2":"fadeInOut3",s={"--symbol-x":`${t.x}%`,"--symbol-y":`${t.y}%`,"--symbol-size":`${t.size}px`,"--symbol-animation":`${o} ${t.duration}s ease-in-out ${t.delay}s infinite both`};return e.jsx("div",{className:"floating-symbol text-slate-600 dark:text-slate-400",style:s,children:t.symbol})});j.displayName="FloatingSymbolItem";function re({onShowTerms:t,onShowPrivacy:o,isDarkMode:s,onToggleDarkMode:r}){const{isOnline:m}=I(),v=d.useMemo(()=>Array.from({length:30},(a,c)=>({id:c,symbol:b[Math.floor(Math.random()*b.length)],x:Math.random()*100,y:Math.random()*100,size:16+Math.random()*24,duration:5+Math.random()*5,delay:Math.random()*8,opacity:.15+Math.random()*.2})),[]),[l,N]=d.useState(!1),[u,p]=d.useState(!1),[i,k]=d.useState(null),C=d.useCallback(async()=>{if(!l){T.error("ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.");return}if(!u){p(!0);try{await U()}catch(a){const c=D(a);k(c)}finally{p(!1)}}},[l,u]),f=a=>{const c=!!a;N(c);try{typeof window<"u"&&window.localStorage&&(c?(window.localStorage.setItem("tosAccepted","true"),window.localStorage.setItem("privacyAccepted","true")):(window.localStorage.removeItem("tosAccepted"),window.localStorage.removeItem("privacyAccepted")))}catch{}};return e.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center p-6 overflow-hidden bg-background text-foreground transition-colors duration-300",children:[r&&e.jsx("div",{className:"absolute safe-top-button right-4 z-50",children:e.jsx(y,{variant:"ghost",size:"icon",onClick:r,className:"rounded-full hover:bg-accent transition-colors",children:s?e.jsx($,{className:"w-5 h-5 text-yellow-500"}):e.jsx(E,{className:"w-5 h-5 text-slate-700 dark:text-slate-300"})})}),e.jsx("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none select-none opacity-60","aria-hidden":"true",children:v.map(a=>e.jsx(j,{item:a},a.id))}),e.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none","aria-hidden":"true",children:e.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("defs",{children:[e.jsxs("pattern",{id:"loginComplexGrid",x:"0",y:"0",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:[e.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"currentColor",strokeWidth:"1",className:"text-muted-foreground/20"}),e.jsx("circle",{cx:"20",cy:"20",r:"2",fill:"currentColor",className:"text-muted-foreground/20"})]}),e.jsx("pattern",{id:"loginDiagonalLines",x:"0",y:"0",width:"60",height:"60",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 0 60 L 60 0",stroke:"currentColor",strokeWidth:"1",className:"text-muted-foreground/10"})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#loginComplexGrid)"}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#loginDiagonalLines)"})]})}),e.jsx("div",{className:"relative z-10 w-full max-w-sm animate-in fade-in zoom-in duration-500",children:e.jsx(A,{className:"w-full border-border/60 shadow-2xl bg-background/95 backdrop-blur-sm",children:e.jsxs(G,{className:"pt-6 pb-7 px-4 sm:px-6 space-y-8",children:[e.jsx("div",{className:"flex flex-col items-center space-y-3 mt-6",children:e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent dark:from-white dark:to-gray-400",children:"ë¹„ìœ ë…¸íŠ¸"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ì„¸ìƒì˜ ëª¨ë“  ì§€ì‹ì„ ë¹„ìœ ë¡œ ì—°ê²°í•˜ë‹¤"})]})}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg bg-muted/30 border border-border/40 hover:bg-muted/50 transition-colors cursor-pointer group",onClick:()=>f(!l),children:[e.jsx(O,{id:"terms",checked:l,onCheckedChange:a=>f(a),className:"mt-0.5 data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(B,{htmlFor:"terms",className:"text-sm font-medium leading-snug cursor-pointer select-none group-hover:text-foreground/80",children:"ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜ (í•„ìˆ˜)"}),e.jsxs("p",{className:"text-xs text-muted-foreground whitespace-nowrap -ml-1 sm:ml-0",children:[e.jsx("button",{type:"button",className:"underline decoration-muted-foreground/50 hover:text-primary hover:decoration-primary underline-offset-2 transition-all mr-0.5 sm:mr-1",onClick:a=>{a.stopPropagation(),t()},children:"ì´ìš©ì•½ê´€"}),"ê³¼",e.jsx("button",{type:"button",className:"underline decoration-muted-foreground/50 hover:text-primary hover:decoration-primary underline-offset-2 transition-all mx-0.5 sm:mx-1",onClick:a=>{a.stopPropagation(),o()},children:"ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨"}),"ì„ ì½ê³  ë™ì˜í•©ë‹ˆë‹¤."]})]})]})}),e.jsx(y,{className:"w-full h-12 text-base font-medium transition-all hover:scale-[1.02] active:scale-[0.98]",variant:l?"default":"secondary",disabled:!l||u||!m,onClick:C,children:u?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"ë¡œê·¸ì¸ í™•ì¸ ì¤‘..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.84z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{children:"Google ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ê¸°"})]})}),e.jsx("p",{className:"text-xs text-muted-foreground/60 text-center",children:"Â© 2024 BiyuNote. All rights reserved."}),i&&e.jsxs("div",{style:{margin:"12px 16px",padding:"12px",borderRadius:12,background:"#3a0b0b",border:"1px solid rgba(255,255,255,0.12)",color:"white"},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:4},children:[i.title,i.code?` (code: ${i.code})`:""]}),e.jsx("div",{style:{opacity:.9},children:i.message}),i.raw&&e.jsxs("details",{style:{marginTop:8},children:[e.jsx("summary",{style:{cursor:"pointer"},children:"ìì„¸íˆ ë³´ê¸°"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",marginTop:8,fontSize:12,opacity:.9},children:i.raw})]})]})]})})})]})}export{re as LoginScreen};
