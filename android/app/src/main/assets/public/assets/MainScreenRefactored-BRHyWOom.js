const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./MyPageScreen-SpDGq-et.js","./index-nq_z7WhA.js","./vendor-capacitor-rvH5hiNU.js","./vendor-react-1wgkHQEd.js","./vendor-firebase-D1NEqzdz.js","./index-CMsVaf-q.css","./App-COUbzzsB.js","./App-CEi_s2iG.css","./card-DIbA5A_d.js","./label-DFqdyXVq.js","./index-Bjta6Ul0.js","./index-C-WI9JZT.js","./checkbox-CFUi8qYh.js","./check-FzTHNnAz.js","./tabs-CprT-Mux.js","./avatar-CGdV8c0F.js","./switch-DSP7bNjX.js","./separator-ChiaOu68.js","./toastHelper-BQ6M3Cc4.js","./loginDebug-CNrNP7Rg.js","./arrow-left-Lp9IH1tN.js","./palette-DmnnlyTB.js","./sun-BhpYpMxp.js","./shield-C-5UIn88.js","./trash-2-CwUGqWoD.js","./AppHeader-BT9vd7QI.js","./shield-check-PERLHSEk.js","./users-CgQI8rwE.js","./user-check-CJt_OBSS.js","./file-text-B2yTW3on.js","./compass-DDaLZSZd.js","./log-out-CKRO520m.js","./alert-dialog-simple-C5oUXbYo.js","./sparkles-7iSHoCyd.js","./firebaseCache-C_csZa1c.js","./profanityFilter-CmEWjjlv.js","./CategoryScreen-D6JXZrsA.js","./input-sWE24-w0.js","./search-ebEFE5MH.js","./SearchScreen-CHVKd83-.js","./keyboard-dismiss-button-Dy89Uq3q.js","./trending-up-DYzLWqtV.js","./RankingScreen-CleX25xt.js","./award-B79nP1PI.js","./BookmarkScreen-01H30ULA.js","./MyContentListScreen-CrXHqBkT.js","./WriteScreen-CkILADPX.js","./NotesScreen-DhwxMpts.js","./NoteDetailScreen-nRAMIs_w.js","./QuestionComposeScreen-D9DE9d_J.js","./TitleShop-B-kx8AuZ.js","./shopTitles-D4xbNovf.js","./lock-8Sm5p2Vf.js","./circle-alert-CRxICFkj.js","./TitlesCollection-CHxM74HX.js","./AchievementsScreen-DQEjk4Sr.js","./ThemeScreen-CkrnFEE1.js","./FollowListScreen-_qyJQQKQ.js","./UserProfileDialog-DF4iNReH.js","./NotificationSettingsDialog-C9an01YN.js","./ReportDialog-C7kBk4J1.js","./AdminReportScreen-CZS8Q3Pi.js"])))=>i.map(i=>d[i]);
import{A as ta,_ as Be}from"./vendor-capacitor-rvH5hiNU.js";import{r as l,a as ge,d as he,j as s,c as pl,f as po,t as fd,R as J,b as hd}from"./index-nq_z7WhA.js";import{t as H}from"./toastHelper-BQ6M3Cc4.js";import{x as ti,s as je,t as Ft,q as ni,D as fn,w as Vn,H as st,I as Oe,J as Et,K as ri,M as gl,N as go,O as et,P as oi,A as Zt,Q as xl,R as Ht,T as yl,U as mr,n as md,V as xo}from"./vendor-firebase-D1NEqzdz.js";import{c as Ne,b as tt,d as Qt,B as we,r as pd,f as vl,e as gd,a as wl,g as dn,C as na,u as xd}from"./App-COUbzzsB.js";import{C as Ct,b as yd,c as vd,a as St}from"./card-DIbA5A_d.js";import{c as Eo,P as Ze,a as Me,d as wd,u as bd,b as bl}from"./index-Bjta6Ul0.js";import{P as gn}from"./checkbox-CFUi8qYh.js";import{u as ht,A as Cd,a as Sd,b as kd}from"./avatar-CGdV8c0F.js";import{u as xr}from"./index-C-WI9JZT.js";import{X as _s,A as si}from"./alert-dialog-simple-C5oUXbYo.js";import{S as ra}from"./sparkles-7iSHoCyd.js";import{f as hs,g as lo,w as Td}from"./firebaseCache-C_csZa1c.js";import{c as Ls}from"./profanityFilter-CmEWjjlv.js";import{A as Cl}from"./arrow-left-Lp9IH1tN.js";import{F as Sl,U as jd}from"./users-CgQI8rwE.js";import{C as Rd}from"./check-FzTHNnAz.js";import{S as Ad,M as Nd}from"./sun-BhpYpMxp.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ed=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Id=Ne("bell",Ed);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pd=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],_d=Ne("book-open",Pd);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ld=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],ii=Ne("bookmark",Ld);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Md=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Dd=Ne("chevron-down",Md);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Od=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],kl=Ne("circle-help",Od);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zd=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],oa=Ne("circle-x",zd);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ud=[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]],Bd=Ne("cog",Ud);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fd=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Hd=Ne("dollar-sign",Fd);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $d=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Tl=Ne("ellipsis",$d);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wd=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Vd=Ne("eye",Wd);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qd=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Gd=Ne("globe",qd);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yd=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],sa=Ne("hash",Yd);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xd=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],Zd=Ne("house",Xd);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kd=[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]],Qd=Ne("menu",Kd);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jd=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],ai=Ne("message-circle",Jd);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ef=[["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["path",{d:"M9.5 8h5",key:"11mslq"}],["path",{d:"M9.5 12H16",key:"ktog6x"}],["path",{d:"M9.5 16H14",key:"p1seyn"}]],tf=Ne("notebook-text",ef);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nf=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],rf=Ne("pen-line",nf);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const of=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],jl=Ne("pen-tool",of);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sf=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Rl=Ne("plus",sf);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const af=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Al=Ne("rotate-cw",af);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lf=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],cf=Ne("send",lf);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uf=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],df=Ne("settings",uf);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ff=[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]],hf=Ne("shopping-bag",ff);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mf=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],yo=Ne("star",mf);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pf=[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]],Ms=Ne("trophy",pf);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gf=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],xf=Ne("user-x",gf);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yf=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],vf=Ne("user",yf);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wf=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],bf=Ne("zap",wf),pt=new Map,Jt=new Map,un=new Map,yr=new Map,ia=50,Nl=300*1e3;let Ds=!1;const Os=new Set;typeof window<"u"&&ti(ge,e=>{Ds=!0,Os.forEach(t=>t()),e||(Jt.forEach(t=>t()),Jt.clear(),pt.clear(),yr.clear(),un.forEach(t=>{t.forEach(n=>n())}))});function El(e){yr.set(e,Date.now());const t=pt.get(e);t&&(pt.delete(e),pt.set(e,t))}function Cf(){if(!(pt.size<=ia))for(const e of pt.keys()){if(pt.size<=ia)break;if(un.get(e)?.size??!1)continue;pt.delete(e),yr.delete(e);const t=Jt.get(e);t&&(t(),Jt.delete(e))}}function Sf(){const e=Date.now();for(const[t,n]of yr.entries())if(!((un.get(t)?.size??0)>0)&&e-n>Nl){pt.delete(t),yr.delete(t);const r=Jt.get(t);r&&(r(),Jt.delete(t))}}let aa=null;function kf(){!aa&&typeof window<"u"&&(aa=setInterval(Sf,Nl))}const Tf=6e4,jf=6e4;function Rf(e){if(Jt.has(e)||!ge.currentUser)return;const t=pt.get(e);if(t&&t.lastUpdated&&Date.now()-t.lastUpdated<jf)return;const n=je(he,"users",e);let r=null,o=!0;const i=async()=>{if(o)try{El(e);const c=await Ft(n);if(!o)return;if(!c.exists())pt.delete(e);else{const d=c.data();let f=null;if(typeof d.profileImage=="string"&&d.profileImage)f=d.profileImage;else if(typeof d.photoURL=="string"&&d.photoURL){const y=d.photoURL;y.includes("googleusercontent.com")||y.includes("googleapis.com")||y.includes("lh3.googleusercontent.com")||y.includes("lh4.googleusercontent.com")||y.includes("lh5.googleusercontent.com")||y.includes("lh6.googleusercontent.com")||(f=y)}const x={nickname:typeof d.nickname=="string"?d.nickname:"알 수 없음",profileImage:f,currentTitleId:typeof d.currentTitle=="string"?d.currentTitle:null,profileDescription:typeof d.profileDescription=="string"?d.profileDescription:null,currentTheme:typeof d.currentTheme=="string"?d.currentTheme:null,trustScore:typeof d.trustScore=="number"?d.trustScore:void 0,role:d.role==="admin"||d.role==="user"?d.role:"user",lastUpdated:Date.now()};pt.set(e,x)}Cf();const u=un.get(e);u&&u.forEach(d=>d())}catch(c){if(c.code==="permission-denied"){Jt.delete(e),o=!1;return}}};i(),r=setInterval(i,Tf);const a=()=>{o=!1,r&&(clearInterval(r),r=null)};Jt.set(e,a)}function Io(e){kf();const t=(e||[]).filter(f=>typeof f=="string"&&f.length>0),n=Array.from(new Set(t)).sort().join("|"),r=l.useMemo(()=>n?n.split("|"):[],[n]),[o,i]=l.useState(Ds),a=ge.currentUser?.uid;l.useEffect(()=>{if(Ds){i(!0);return}const f=()=>i(!0);return Os.add(f),()=>{Os.delete(f)}},[]);const c=l.useCallback(()=>{const f={};return r.forEach(x=>{const y=pt.get(x);y&&(f[x]=y)}),f},[n]),[u,d]=l.useState(c);return l.useEffect(()=>{if(!o)return;let f=!0;const x=()=>{f&&d(y=>{const b=c();let S=!1;const C=Object.keys(y),w=Object.keys(b);if(C.length!==w.length)S=!0;else for(const m of C)if(y[m]!==b[m]){S=!0;break}return S?b:y})};return r.forEach(y=>{un.has(y)||un.set(y,new Set),un.get(y).add(x),Rf(y),El(y)}),x(),()=>{f=!1,r.forEach(y=>{const b=un.get(y);b&&b.delete(x)})}},[n,o,a,c]),u}function Af(){const[e,t]=l.useState(ge.currentUser?.uid??null);l.useEffect(()=>{const r=ti(ge,o=>{t(o?.uid??null)});return()=>r()},[]);const n=Io(e?[e]:[]);return e?n[e]??null:null}function Po(e,t){if(!e)return"";const r=(t??new Date).getTime()-e.getTime(),o=Math.floor(r/1e3),i=Math.floor(o/60),a=Math.floor(i/60);if(Math.floor(a/24)<1)return o<60?"방금 전":i<60?`${i}분 전`:`${a}시간 전`;const u=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),f=String(e.getDate()).padStart(2,"0");return`${u}.${d}.${f}`}var Nf=l.createContext(void 0);function Ef(e){const t=l.useContext(Nf);return e||t||"ltr"}function If(e,[t,n]){return Math.min(n,Math.max(t,e))}function Pf(e,t){return l.useReducer((n,r)=>t[n][r]??n,e)}var li="ScrollArea",[Il]=Eo(li),[_f,jt]=Il(li),Pl=l.forwardRef((e,t)=>{const{__scopeScrollArea:n,type:r="hover",dir:o,scrollHideDelay:i=600,...a}=e,[c,u]=l.useState(null),[d,f]=l.useState(null),[x,y]=l.useState(null),[b,S]=l.useState(null),[C,w]=l.useState(null),[m,p]=l.useState(0),[g,h]=l.useState(0),[k,j]=l.useState(!1),[v,R]=l.useState(!1),N=tt(t,L=>u(L)),E=Ef(o);return s.jsx(_f,{scope:n,type:r,dir:E,scrollHideDelay:i,scrollArea:c,viewport:d,onViewportChange:f,content:x,onContentChange:y,scrollbarX:b,onScrollbarXChange:S,scrollbarXEnabled:k,onScrollbarXEnabledChange:j,scrollbarY:C,onScrollbarYChange:w,scrollbarYEnabled:v,onScrollbarYEnabledChange:R,onCornerWidthChange:p,onCornerHeightChange:h,children:s.jsx(Ze.div,{dir:E,...a,ref:N,style:{position:"relative","--radix-scroll-area-corner-width":m+"px","--radix-scroll-area-corner-height":g+"px",...e.style}})})});Pl.displayName=li;var _l="ScrollAreaViewport",Ll=l.forwardRef((e,t)=>{const{__scopeScrollArea:n,children:r,nonce:o,...i}=e,a=jt(_l,n),c=l.useRef(null),u=tt(t,c,a.onViewportChange);return s.jsxs(s.Fragment,{children:[s.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),s.jsx(Ze.div,{"data-radix-scroll-area-viewport":"",...i,ref:u,style:{overflowX:a.scrollbarXEnabled?"scroll":"hidden",overflowY:a.scrollbarYEnabled?"scroll":"hidden",...e.style},children:s.jsx("div",{ref:a.onContentChange,style:{minWidth:"100%",display:"table"},children:r})})]})});Ll.displayName=_l;var Wt="ScrollAreaScrollbar",Ml=l.forwardRef((e,t)=>{const{forceMount:n,...r}=e,o=jt(Wt,e.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:a}=o,c=e.orientation==="horizontal";return l.useEffect(()=>(c?i(!0):a(!0),()=>{c?i(!1):a(!1)}),[c,i,a]),o.type==="hover"?s.jsx(Lf,{...r,ref:t,forceMount:n}):o.type==="scroll"?s.jsx(Mf,{...r,ref:t,forceMount:n}):o.type==="auto"?s.jsx(Dl,{...r,ref:t,forceMount:n}):o.type==="always"?s.jsx(ci,{...r,ref:t}):null});Ml.displayName=Wt;var Lf=l.forwardRef((e,t)=>{const{forceMount:n,...r}=e,o=jt(Wt,e.__scopeScrollArea),[i,a]=l.useState(!1);return l.useEffect(()=>{const c=o.scrollArea;let u=0;if(c){const d=()=>{window.clearTimeout(u),a(!0)},f=()=>{u=window.setTimeout(()=>a(!1),o.scrollHideDelay)};return c.addEventListener("pointerenter",d),c.addEventListener("pointerleave",f),()=>{window.clearTimeout(u),c.removeEventListener("pointerenter",d),c.removeEventListener("pointerleave",f)}}},[o.scrollArea,o.scrollHideDelay]),s.jsx(gn,{present:n||i,children:s.jsx(Dl,{"data-state":i?"visible":"hidden",...r,ref:t})})}),Mf=l.forwardRef((e,t)=>{const{forceMount:n,...r}=e,o=jt(Wt,e.__scopeScrollArea),i=e.orientation==="horizontal",a=Lo(()=>u("SCROLL_END"),100),[c,u]=Pf("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(c==="idle"){const d=window.setTimeout(()=>u("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(d)}},[c,o.scrollHideDelay,u]),l.useEffect(()=>{const d=o.viewport,f=i?"scrollLeft":"scrollTop";if(d){let x=d[f];const y=()=>{const b=d[f];x!==b&&(u("SCROLL"),a()),x=b};return d.addEventListener("scroll",y),()=>d.removeEventListener("scroll",y)}},[o.viewport,i,u,a]),s.jsx(gn,{present:n||c!=="hidden",children:s.jsx(ci,{"data-state":c==="hidden"?"hidden":"visible",...r,ref:t,onPointerEnter:Me(e.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:Me(e.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),Dl=l.forwardRef((e,t)=>{const n=jt(Wt,e.__scopeScrollArea),{forceMount:r,...o}=e,[i,a]=l.useState(!1),c=e.orientation==="horizontal",u=Lo(()=>{if(n.viewport){const d=n.viewport.offsetWidth<n.viewport.scrollWidth,f=n.viewport.offsetHeight<n.viewport.scrollHeight;a(c?d:f)}},10);return qn(n.viewport,u),qn(n.content,u),s.jsx(gn,{present:r||i,children:s.jsx(ci,{"data-state":i?"visible":"hidden",...o,ref:t})})}),ci=l.forwardRef((e,t)=>{const{orientation:n="vertical",...r}=e,o=jt(Wt,e.__scopeScrollArea),i=l.useRef(null),a=l.useRef(0),[c,u]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=Fl(c.viewport,c.content),f={...r,sizes:c,onSizesChange:u,hasThumb:d>0&&d<1,onThumbChange:y=>i.current=y,onThumbPointerUp:()=>a.current=0,onThumbPointerDown:y=>a.current=y};function x(y,b){return Ff(y,a.current,c,b)}return n==="horizontal"?s.jsx(Df,{...f,ref:t,onThumbPositionChange:()=>{if(o.viewport&&i.current){const y=o.viewport.scrollLeft,b=la(y,c,o.dir);i.current.style.transform=`translate3d(${b}px, 0, 0)`}},onWheelScroll:y=>{o.viewport&&(o.viewport.scrollLeft=y)},onDragScroll:y=>{o.viewport&&(o.viewport.scrollLeft=x(y,o.dir))}}):n==="vertical"?s.jsx(Of,{...f,ref:t,onThumbPositionChange:()=>{if(o.viewport&&i.current){const y=o.viewport.scrollTop,b=la(y,c);i.current.style.transform=`translate3d(0, ${b}px, 0)`}},onWheelScroll:y=>{o.viewport&&(o.viewport.scrollTop=y)},onDragScroll:y=>{o.viewport&&(o.viewport.scrollTop=x(y))}}):null}),Df=l.forwardRef((e,t)=>{const{sizes:n,onSizesChange:r,...o}=e,i=jt(Wt,e.__scopeScrollArea),[a,c]=l.useState(),u=l.useRef(null),d=tt(t,u,i.onScrollbarXChange);return l.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),s.jsx(zl,{"data-orientation":"horizontal",...o,ref:d,sizes:n,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":_o(n)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.x),onDragScroll:f=>e.onDragScroll(f.x),onWheelScroll:(f,x)=>{if(i.viewport){const y=i.viewport.scrollLeft+f.deltaX;e.onWheelScroll(y),$l(y,x)&&f.preventDefault()}},onResize:()=>{u.current&&i.viewport&&a&&r({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:wo(a.paddingLeft),paddingEnd:wo(a.paddingRight)}})}})}),Of=l.forwardRef((e,t)=>{const{sizes:n,onSizesChange:r,...o}=e,i=jt(Wt,e.__scopeScrollArea),[a,c]=l.useState(),u=l.useRef(null),d=tt(t,u,i.onScrollbarYChange);return l.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),s.jsx(zl,{"data-orientation":"vertical",...o,ref:d,sizes:n,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":_o(n)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.y),onDragScroll:f=>e.onDragScroll(f.y),onWheelScroll:(f,x)=>{if(i.viewport){const y=i.viewport.scrollTop+f.deltaY;e.onWheelScroll(y),$l(y,x)&&f.preventDefault()}},onResize:()=>{u.current&&i.viewport&&a&&r({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:wo(a.paddingTop),paddingEnd:wo(a.paddingBottom)}})}})}),[zf,Ol]=Il(Wt),zl=l.forwardRef((e,t)=>{const{__scopeScrollArea:n,sizes:r,hasThumb:o,onThumbChange:i,onThumbPointerUp:a,onThumbPointerDown:c,onThumbPositionChange:u,onDragScroll:d,onWheelScroll:f,onResize:x,...y}=e,b=jt(Wt,n),[S,C]=l.useState(null),w=tt(t,N=>C(N)),m=l.useRef(null),p=l.useRef(""),g=b.viewport,h=r.content-r.viewport,k=ht(f),j=ht(u),v=Lo(x,10);function R(N){if(m.current){const E=N.clientX-m.current.left,L=N.clientY-m.current.top;d({x:E,y:L})}}return l.useEffect(()=>{const N=E=>{const L=E.target;S?.contains(L)&&k(E,h)};return document.addEventListener("wheel",N,{passive:!1}),()=>document.removeEventListener("wheel",N,{passive:!1})},[g,S,h,k]),l.useEffect(j,[r,j]),qn(S,v),qn(b.content,v),s.jsx(zf,{scope:n,scrollbar:S,hasThumb:o,onThumbChange:ht(i),onThumbPointerUp:ht(a),onThumbPositionChange:j,onThumbPointerDown:ht(c),children:s.jsx(Ze.div,{...y,ref:w,style:{position:"absolute",...y.style},onPointerDown:Me(e.onPointerDown,N=>{N.button===0&&(N.target.setPointerCapture(N.pointerId),m.current=S.getBoundingClientRect(),p.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",b.viewport&&(b.viewport.style.scrollBehavior="auto"),R(N))}),onPointerMove:Me(e.onPointerMove,R),onPointerUp:Me(e.onPointerUp,N=>{const E=N.target;E.hasPointerCapture(N.pointerId)&&E.releasePointerCapture(N.pointerId),document.body.style.webkitUserSelect=p.current,b.viewport&&(b.viewport.style.scrollBehavior=""),m.current=null})})})}),vo="ScrollAreaThumb",Ul=l.forwardRef((e,t)=>{const{forceMount:n,...r}=e,o=Ol(vo,e.__scopeScrollArea);return s.jsx(gn,{present:n||o.hasThumb,children:s.jsx(Uf,{ref:t,...r})})}),Uf=l.forwardRef((e,t)=>{const{__scopeScrollArea:n,style:r,...o}=e,i=jt(vo,n),a=Ol(vo,n),{onThumbPositionChange:c}=a,u=tt(t,x=>a.onThumbChange(x)),d=l.useRef(void 0),f=Lo(()=>{d.current&&(d.current(),d.current=void 0)},100);return l.useEffect(()=>{const x=i.viewport;if(x){const y=()=>{if(f(),!d.current){const b=Hf(x,c);d.current=b,c()}};return c(),x.addEventListener("scroll",y),()=>x.removeEventListener("scroll",y)}},[i.viewport,f,c]),s.jsx(Ze.div,{"data-state":a.hasThumb?"visible":"hidden",...o,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...r},onPointerDownCapture:Me(e.onPointerDownCapture,x=>{const b=x.target.getBoundingClientRect(),S=x.clientX-b.left,C=x.clientY-b.top;a.onThumbPointerDown({x:S,y:C})}),onPointerUp:Me(e.onPointerUp,a.onThumbPointerUp)})});Ul.displayName=vo;var ui="ScrollAreaCorner",Bl=l.forwardRef((e,t)=>{const n=jt(ui,e.__scopeScrollArea),r=!!(n.scrollbarX&&n.scrollbarY);return n.type!=="scroll"&&r?s.jsx(Bf,{...e,ref:t}):null});Bl.displayName=ui;var Bf=l.forwardRef((e,t)=>{const{__scopeScrollArea:n,...r}=e,o=jt(ui,n),[i,a]=l.useState(0),[c,u]=l.useState(0),d=!!(i&&c);return qn(o.scrollbarX,()=>{const f=o.scrollbarX?.offsetHeight||0;o.onCornerHeightChange(f),u(f)}),qn(o.scrollbarY,()=>{const f=o.scrollbarY?.offsetWidth||0;o.onCornerWidthChange(f),a(f)}),d?s.jsx(Ze.div,{...r,ref:t,style:{width:i,height:c,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function wo(e){return e?parseInt(e,10):0}function Fl(e,t){const n=e/t;return isNaN(n)?0:n}function _o(e){const t=Fl(e.viewport,e.content),n=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,r=(e.scrollbar.size-n)*t;return Math.max(r,18)}function Ff(e,t,n,r="ltr"){const o=_o(n),i=o/2,a=t||i,c=o-a,u=n.scrollbar.paddingStart+a,d=n.scrollbar.size-n.scrollbar.paddingEnd-c,f=n.content-n.viewport,x=r==="ltr"?[0,f]:[f*-1,0];return Hl([u,d],x)(e)}function la(e,t,n="ltr"){const r=_o(t),o=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,i=t.scrollbar.size-o,a=t.content-t.viewport,c=i-r,u=n==="ltr"?[0,a]:[a*-1,0],d=If(e,u);return Hl([0,a],[0,c])(d)}function Hl(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function $l(e,t){return e>0&&e<t}var Hf=(e,t=()=>{})=>{let n={left:e.scrollLeft,top:e.scrollTop},r=0;return(function o(){const i={left:e.scrollLeft,top:e.scrollTop},a=n.left!==i.left,c=n.top!==i.top;(a||c)&&t(),n=i,r=window.requestAnimationFrame(o)})(),()=>window.cancelAnimationFrame(r)};function Lo(e,t){const n=ht(e),r=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(r.current),[]),l.useCallback(()=>{window.clearTimeout(r.current),r.current=window.setTimeout(n,t)},[n,t])}function qn(e,t){const n=ht(t);xr(()=>{let r=0;if(e){const o=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(n)});return o.observe(e),()=>{window.cancelAnimationFrame(r),o.unobserve(e)}}},[e,n])}var $f=Pl,Wf=Ll,Vf=Bl;function qf({className:e,children:t,...n}){return s.jsxs($f,{"data-slot":"scroll-area",className:Qt("relative",e),...n,children:[s.jsx(Wf,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:t}),s.jsx(Gf,{}),s.jsx(Vf,{})]})}function Gf({className:e,orientation:t="vertical",...n}){return s.jsx(Ml,{"data-slot":"scroll-area-scrollbar",orientation:t,className:Qt("flex touch-none p-px transition-colors select-none",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",e),...n,children:s.jsx(Ul,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function Yf({open:e,onOpenChange:t,blockedUserIds:n,onUnblocked:r}){const[o,i]=l.useState(null);if(!e)return null;const a=async c=>{try{i(c);const u=ni();await fn(u,"unblockUser")({targetUserId:c}),H.success("차단이 해제되었습니다."),r()}catch{H.error("차단 해제 실패")}finally{i(null)}};return s.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4 animate-in fade-in duration-200",children:s.jsxs(Ct,{className:"w-full max-w-md h-[50vh] flex flex-col shadow-lg scale-100",children:[s.jsxs(yd,{className:"flex flex-row items-center justify-between space-y-0 pb-2 border-b",children:[s.jsxs(vd,{className:"flex items-center text-lg",children:[s.jsx(xf,{className:"w-5 h-5 mr-2"}),"차단한 사용자 관리"]}),s.jsx(we,{variant:"ghost",size:"icon",onClick:()=>t(!1),children:s.jsx(_s,{className:"w-4 h-4"})})]}),s.jsxs(St,{className:"flex-1 overflow-hidden p-0 flex flex-col",children:[s.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:n.length===0?s.jsx("div",{className:"h-full flex flex-col items-center justify-center text-muted-foreground text-sm",children:s.jsx("p",{children:"차단한 사용자가 없습니다."})}):s.jsx(qf,{className:"h-full pr-3",children:s.jsx("div",{className:"space-y-2",children:n.map(c=>s.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-secondary/50 border border-border/50",children:[s.jsxs("div",{className:"flex flex-col overflow-hidden mr-2",children:[s.jsx("span",{className:"text-[10px] text-muted-foreground uppercase",children:"User ID"}),s.jsx("span",{className:"text-sm font-mono truncate w-full",title:c,children:c})]}),s.jsx(we,{variant:"outline",size:"sm",disabled:o===c,onClick:()=>a(c),className:"shrink-0 h-8 text-xs border-red-200 hover:bg-red-50 text-red-600 dark:hover:bg-red-900/20 dark:border-red-900/50",children:o===c?"처리 중":"해제"})]},c))})})}),s.jsx("div",{className:"p-3 border-t bg-secondary/10 flex justify-end",children:s.jsx(we,{onClick:()=>t(!1),children:"닫기"})})]})]})})}const bo="탈퇴한 사용자";function Mo(e,t){return t===!0||e===bo}function di(e,t){return Mo(e,t)||!e?bo:e}const Wl=ni(pl,"asia-northeast3"),Xf=fn(Wl,"awardLumens"),Zf=fn(Wl,"purchaseTitle"),Zr={balance:0,totalEarned:0,totalSpent:0,transactions:[]};function Kf(e){const{enabled:t=!0}=e||{},[n,r]=l.useState(Zr),[o,i]=l.useState(!0);l.useEffect(()=>{if(!t){i(!1),r(Zr);return}const d=ge.currentUser?.uid;if(!d){i(!1),r(Zr);return}const f=je(he,"users",d);let x=!1;return(async()=>{try{const b=await Ft(f);if(x)return;if(b.exists()){const S=b.data(),C={balance:S.lumenBalance||0,totalEarned:S.lumenTotalEarned||0,totalSpent:S.lumenTotalSpent||0,transactions:(S.lumenTransactions||[]).sort((w,m)=>m.timestamp-w.timestamp)};r(C)}else await Vn(f,{lumenBalance:0,lumenTotalEarned:0,lumenTotalSpent:0,lumenTransactions:[]},{merge:!0}),r(Zr)}catch{H.error("재화 정보를 불러오는 데 실패했습니다.")}finally{x||i(!1)}})(),()=>{x=!0}},[t]);const a=l.useCallback(async(d,f,x)=>{if(d<=0)return;const y={...n},b={id:`${Date.now()}-${Math.random().toString(36).substr(2,5)}`,amount:d,reason:f,achievementId:x,timestamp:Date.now()};r(S=>({balance:S.balance+d,totalEarned:S.totalEarned+d,totalSpent:S.totalSpent,transactions:[b,...S.transactions]}));try{if(!(await Xf({amount:d,reason:f,achievementId:x})).data.success)throw new Error("서버에서 루멘 추가를 거부했습니다.")}catch{H.error(`"${f}" 보상 획득에 실패했습니다. 다시 시도해주세요.`),r(y)}},[n]),c=l.useCallback(async(d,f,x)=>{if(d<=0)return!1;if(n.balance<d)return H.error("루멘이 부족합니다!"),!1;const y={...n},b={id:`${Date.now()}-${Math.random().toString(36).substr(2,5)}`,amount:-d,reason:f,titleId:x,timestamp:Date.now()};r(S=>({balance:S.balance-d,totalEarned:S.totalEarned,totalSpent:S.totalSpent+d,transactions:[b,...S.transactions]}));try{if(x){if(!(await Zf({titleId:x})).data.success)throw new Error("서버에서 칭호 구매를 거부했습니다.");H.success("칭호를 성공적으로 구매했습니다!")}return!0}catch(S){const C=S.details?.message||"아이템 구매에 실패했습니다. 잠시 후 다시 시도해주세요.";return H.error(C),r(y),!1}},[n]),u=l.useCallback(d=>n.transactions.some(f=>f.achievementId===d&&f.amount>0),[n.transactions]);return{isLoading:o,balance:n.balance,totalEarned:n.totalEarned,totalSpent:n.totalSpent,transactions:n.transactions,addLumens:a,spendLumens:c,hasReceivedRewardForAchievement:u}}const zs=[{id:"first_explore",name:"첫 탐구",description:"첫 번째 질문 글을 작성했습니다",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:1},reward:{lumens:0}},{id:"first_share",name:"첫 공유",description:"첫 번째 정보 공유 글을 작성했습니다",category:"share",hidden:!1,condition:{type:"share_post_count",target:1},reward:{lumens:0}},{id:"first_reply",name:"첫 답변",description:"첫 번째 답변을 작성했습니다",category:"reply",hidden:!1,condition:{type:"reply_count",target:1},reward:{lumens:0}},{id:"first_guide",name:"첫 길잡이",description:"처음으로 길잡이로 채택되었습니다 - 당신의 설명이 누군가의 길을 밝혔습니다",category:"guide",hidden:!1,condition:{type:"guide_count",target:1},reward:{lumens:0}},{id:"first_lantern_received",name:"첫 등불",description:"처음으로 등불을 받았습니다",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:1},reward:{lumens:0}},{id:"first_login_streak",name:"첫 출석",description:"연속 3일 로그인했습니다",category:"streak",hidden:!1,condition:{type:"login_streak",target:3},reward:{lumens:0}},{id:"explore_seeker",name:"탐색자",description:"질문 글을 10개 작성했습니다",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:10},reward:{lumens:0,specialTitle:"탐색자"}},{id:"explore_inquirer",name:"질문자",description:"질문 글을 30개 작성했습니다",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:30},reward:{lumens:1,specialTitle:"질문자"}},{id:"explore_investigator",name:"조사자",description:"질문 글을 100개 작성했습니다",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:100},reward:{lumens:3,specialTitle:"조사자"}},{id:"explore_philosopher",name:"사색가",description:"질문 글을 300개 작성했습니다",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:300},reward:{lumens:5,specialTitle:"사색가"}},{id:"reply_helper",name:"조력자",description:"등불 10개 이상 받은 답변을 10개 작성했습니다 - 작은 도움이 큰 힘이 됩니다",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:10,minLanterns:10},reward:{lumens:0,specialTitle:"조력자"}},{id:"reply_advisor",name:"조언자",description:"등불 10개 이상 받은 답변을 30개 작성했습니다 - 신뢰할 수 있는 조언자가 되었습니다",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:30,minLanterns:10},reward:{lumens:1,specialTitle:"조언자"}},{id:"reply_mentor",name:"멘토",description:"등불 10개 이상 받은 답변을 100개 작성했습니다 - 많은 이들의 멘토가 되었습니다",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:100,minLanterns:10},reward:{lumens:3,specialTitle:"멘토"}},{id:"reply_scholar",name:"학자",description:"등불 10개 이상 받은 답변을 300개 작성했습니다 - 진정한 학자의 길을 걷고 있습니다",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:300,minLanterns:10},reward:{lumens:5,specialTitle:"학자"}},{id:"guide_guide",name:"가이드",description:"길잡이로 5회 채택되었습니다 - 여러 사람의 이해를 도왔습니다",category:"guide",hidden:!1,condition:{type:"guide_count",target:5},reward:{lumens:0,specialTitle:"가이드"}},{id:"guide_navigator",name:"내비게이터",description:"길잡이로 20회 채택되었습니다 - 많은 이들의 길잡이가 되었습니다",category:"guide",hidden:!1,condition:{type:"guide_count",target:20},reward:{lumens:1,specialTitle:"내비게이터"}},{id:"guide_luminary",name:"선도자",description:"길잡이로 100회 채택되었습니다 - 커뮤니티의 빛이 되었습니다",category:"guide",hidden:!1,condition:{type:"guide_count",target:100},reward:{lumens:5,specialTitle:"선도자"}},{id:"lantern_candle",name:"촛불",description:"등불을 50개 받았습니다 - 작은 빛이 모여 밝은 길이 됩니다",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:50},reward:{lumens:0,specialTitle:"촛불"}},{id:"lantern_campfire",name:"모닥불",description:"등불을 200개 받았습니다 - 당신의 지식이 많은 이를 따뜻하게 합니다",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:200},reward:{lumens:1,specialTitle:"모닥불"}},{id:"lantern_lantern",name:"랜턴",description:"등불을 500개 받았습니다 - 어둠을 밝히는 든든한 등불이 되었습니다",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:500},reward:{lumens:3,specialTitle:"랜턴"}},{id:"lantern_furnace",name:"용광로",description:"등불을 1500개 받았습니다 - 끊임없이 타오르는 지식의 불꽃입니다",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:1500},reward:{lumens:5,specialTitle:"용광로"}},{id:"share_sharer",name:"공유자",description:"등불 3개 이상 받은 정보 공유 글을 10개 작성했습니다",category:"share",hidden:!1,condition:{type:"share_post_count",target:10,minLanterns:3},reward:{lumens:0,specialTitle:"공유자"}},{id:"share_curator",name:"큐레이터",description:"등불 3개 이상 받은 정보 공유 글을 30개 작성했습니다",category:"share",hidden:!1,condition:{type:"share_post_count",target:30,minLanterns:3},reward:{lumens:1,specialTitle:"큐레이터"}},{id:"share_publisher",name:"발행자",description:"등불 3개 이상 받은 정보 공유 글을 100개 작성했습니다",category:"share",hidden:!1,condition:{type:"share_post_count",target:100,minLanterns:3},reward:{lumens:3,specialTitle:"발행자"}},{id:"share_archivist",name:"기록 관리자",description:"등불 3개 이상 받은 정보 공유 글을 300개 작성했습니다",category:"share",hidden:!1,condition:{type:"share_post_count",target:300,minLanterns:3},reward:{lumens:5,specialTitle:"기록 관리자"}},{id:"streak_visitor",name:"방문자",description:"연속 7일 로그인했습니다",category:"streak",hidden:!1,condition:{type:"login_streak",target:7},reward:{lumens:0,specialTitle:"방문자"}},{id:"streak_regular",name:"단골",description:"연속 30일 로그인했습니다",category:"streak",hidden:!1,condition:{type:"login_streak",target:30},reward:{lumens:0,specialTitle:"단골"}},{id:"streak_resident",name:"주민",description:"연속 100일 로그인했습니다",category:"streak",hidden:!1,condition:{type:"login_streak",target:100},reward:{lumens:0,specialTitle:"주민"}},{id:"streak_pillar",name:"기둥",description:"연속 365일 로그인했습니다",category:"streak",hidden:!1,condition:{type:"login_streak",target:365},reward:{lumens:0,specialTitle:"기둥"}},{id:"captain_captain",name:"선장",description:"선원 100명을 모았습니다",category:"captain",hidden:!1,condition:{type:"follower_count",target:100},reward:{lumens:0,specialTitle:"선장"}},{id:"economy_analyst",name:"경제 분석인",description:"경제 카테고리에서 등불 5개 이상 받은 답변을 40개 작성했습니다",category:"economy",hidden:!1,condition:{type:"category_quality_reply",target:40,minAverageLanterns:5},reward:{lumens:2,specialTitle:"경제 분석인"}},{id:"economy_expert",name:"경제 길잡이",description:"경제 카테고리에서 등불 10개 이상 받은 답변을 150개 작성했습니다",category:"economy",hidden:!1,condition:{type:"category_quality_reply",target:150,minAverageLanterns:10},reward:{lumens:5,specialTitle:"경제 길잡이"}},{id:"it_consultant",name:"기술 상담인",description:"IT 카테고리에서 등불 5개 이상 받은 답변을 40개 작성했습니다",category:"it",hidden:!1,condition:{type:"category_quality_reply",target:40,minAverageLanterns:5},reward:{lumens:2,specialTitle:"기술 상담인"}},{id:"it_expert",name:"기술 이야기꾼",description:"IT 카테고리에서 등불 10개 이상 받은 답변을 150개 작성했습니다",category:"it",hidden:!1,condition:{type:"category_quality_reply",target:150,minAverageLanterns:10},reward:{lumens:5,specialTitle:"기술 이야기꾼"}},{id:"language_tutor",name:"언어 튜터",description:"외국어 카테고리에서 등불 5개 이상 받은 답변을 40개 작성했습니다",category:"language",hidden:!1,condition:{type:"category_quality_reply",target:40,minAverageLanterns:5},reward:{lumens:2,specialTitle:"언어 튜터"}},{id:"language_expert",name:"언어 항해사",description:"외국어 카테고리에서 등불 10개 이상 받은 답변을 150개 작성했습니다",category:"language",hidden:!1,condition:{type:"category_quality_reply",target:150,minAverageLanterns:10},reward:{lumens:5,specialTitle:"언어 항해사"}},{id:"engineering_curious",name:"변수 연구자",description:"공학 카테고리에서 질문 글을 10개 작성했습니다",category:"explore",hidden:!1,condition:{type:"category_explore_count",target:10},reward:{lumens:1,specialTitle:"변수 연구자"}},{id:"engineering_focused",name:"함수 마스터",description:"공학 카테고리에만 집중해서 글 40개를 작성했습니다",category:"reply",hidden:!0,condition:{type:"single_category_posts",target:40},reward:{lumens:2,specialTitle:"함수 마스터"}},{id:"engineering_first_light",name:"공학자의 첫 등불",description:"공학 카테고리에서 처음으로 등불을 받았습니다",category:"lantern",hidden:!1,condition:{type:"category_first_lantern",target:1},reward:{lumens:1,specialTitle:"공학자의 첫 등불"}},{id:"engineering_destroyer",name:"방정식 해결사",description:"공학 카테고리에서 답변을 50개 작성했습니다",category:"reply",hidden:!1,condition:{type:"category_reply_count",target:50},reward:{lumens:3,specialTitle:"방정식 해결사"}},{id:"explore_brave_questioner",name:"용기 있는 질문러",description:"부끄러움을 이겨내고 질문 글을 5개 작성했습니다 - 모르는 것을 인정하는 용기가 배움의 시작입니다",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:5},reward:{lumens:1,specialTitle:"용기 있는 질문러"}},{id:"explore_steady_questioner",name:"꾸준한 질문러",description:"포기하지 않고 질문 글을 20개 작성했습니다 - 꾸준함이 성장의 열쇠입니다",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:20},reward:{lumens:2,specialTitle:"꾸준한 질문러"}},{id:"reply_challenger",name:"도전하는 답변가",description:"완벽하지 않아도, 자신의 이해 방식을 담은 답변을 10개 시도했습니다 - 시도하는 것만으로도 가치가 있습니다",category:"reply",hidden:!1,condition:{type:"reply_count",target:10},reward:{lumens:1,specialTitle:"도전하는 답변가"}},{id:"reply_persistent_helper",name:"끈기 있는 답변가",description:"도움을 주기 위해 답변 50개를 남겼습니다 - 끈기 있는 도움은 커뮤니티의 힘입니다",category:"reply",hidden:!1,condition:{type:"reply_count",target:50},reward:{lumens:3,specialTitle:"끈기 있는 답변가"}},{id:"lantern_giver_small",name:"좋아요 요정",description:"다른 사람의 글에 등불을 50개 켜줬습니다 - 당신의 응원이 누군가에게 힘이 됩니다",category:"lantern",hidden:!1,condition:{type:"lanterns_given",target:50},reward:{lumens:1,specialTitle:"좋아요 요정"}},{id:"lantern_giver_captain",name:"응원단장",description:"다른 사람의 글에 등불을 200개 켜줬습니다 - 따뜻한 응원이 커뮤니티를 밝힙니다",category:"lantern",hidden:!1,condition:{type:"lanterns_given",target:200},reward:{lumens:3,specialTitle:"응원단장"}}],Us=[{id:"multi_specialist",name:"다중 분야 항해사",description:"3개 분야에서 길잡이 칭호를 획득했습니다",category:"reply",hidden:!0,condition:{type:"multi_field_expert",target:3},reward:{lumens:10,specialTitle:"다중 분야 항해사"}},{id:"discussion_expert",name:"마라톤 토론러",description:"한 글에서 답변을 15회 이상 주고받았습니다",category:"reply",hidden:!0,condition:{type:"discussion_exchanges",target:15},reward:{lumens:5,specialTitle:"마라톤 토론러"}},{id:"best_contributor",name:"베스트 컨트리뷰터",description:"한 글에서 등불 100개 이상을 받았습니다",category:"lantern",hidden:!0,condition:{type:"max_post_lanterns",target:100},reward:{lumens:10,specialTitle:"베스트 컨트리뷰터"}},{id:"community_fellow",name:"커뮤니티 펠로우",description:"모든 기본 칭호에서 3단계 이상을 달성했습니다",category:"guide",hidden:!0,condition:{type:"all_categories_tier3",target:1},reward:{lumens:15,specialTitle:"커뮤니티 펠로우"}},{id:"honorary_scholar",name:"명예 학자",description:"모든 기본 칭호에서 4단계(최고)를 달성했습니다",category:"guide",hidden:!0,condition:{type:"all_categories_tier4",target:1},reward:{lumens:50,specialTitle:"명예 학자"}},{id:"lantern_giver",name:"등불 나눔이",description:"다른 사람에게 등불을 500개 켜줬습니다",category:"lantern",hidden:!0,condition:{type:"lanterns_given",target:500},reward:{lumens:3,specialTitle:"등불 나눔이"}},{id:"diligent_visitor",name:"성실한 방문자",description:"최근 30일 중 27일 이상 로그인했습니다",category:"streak",hidden:!0,condition:{type:"monthly_login_rate",target:27},reward:{lumens:0,specialTitle:"성실한 방문자"}},{id:"popular_questioner",name:"인기 질문러",description:"내가 올린 질문 중 하나가 등불 30개 이상을 받아, 많은 사람들이 공감한 질문이 되었습니다",category:"explore",hidden:!0,condition:{type:"max_post_lanterns",target:30},reward:{lumens:2,specialTitle:"인기 질문러"}},{id:"specialized_replier",name:"특화 답변가",description:"한 카테고리에서 답변 300개를 작성했습니다",category:"reply",hidden:!0,condition:{type:"single_category_replies",target:300},reward:{lumens:3,specialTitle:"특화 답변가"}}],Qf=[...zs,...Us];function Qy(e){return{guide:"길잡이",explore:"탐구",share:"지식 공유",reply:"답변",lantern:"등불",streak:"출석",captain:"선장",economy:"경제",it:"IT",language:"외국어"}[e]}const Bn={explorePosts:0,sharePosts:0,replies:0,qualityReplies:0,lanternsReceived:0,lanternsGiven:0,guideCount:0,bookmarks:0,loginStreak:0,maxPostReplies:0,maxPostLanterns:0,maxDiscussionExchanges:0,followerCount:0},Co={ACHIEVED_ACHIEVEMENTS:"app_achieved_achievements",USER_ACTIVITY:"app_user_activity"};function Jf(){if(typeof window>"u")return null;try{const e=window.localStorage.getItem(Co.ACHIEVED_ACHIEVEMENTS),t=window.localStorage.getItem(Co.USER_ACTIVITY);if(!e&&!t)return null;let n=[],r={...Bn};if(e)try{const o=JSON.parse(e);Array.isArray(o)&&(n=o.map(i=>!i||typeof i!="object"||typeof i.achievementId!="string"||typeof i.achievedAt!="string"?null:{achievementId:i.achievementId,achievedAt:i.achievedAt,rewardClaimed:typeof i.rewardClaimed=="boolean"?i.rewardClaimed:!0}).filter(i=>i!==null))}catch{}if(t)try{const o=JSON.parse(t);o&&typeof o=="object"&&(r={...Bn,...o})}catch{}return{achieved:n,activity:r}}catch{return null}}function eh(e,t){const[n,r]=l.useState([]),[o,i]=l.useState(Bn),[a,c]=l.useState(!1),u=l.useRef(!1),d=l.useCallback(g=>n.find(h=>h.achievementId===g),[n]);l.useEffect(()=>{const g=ge.currentUser?.uid;if(!g)return;let h=!1;return(async()=>{try{const j=je(he,"users",g),v=await Ft(j);if(v.exists()){const L=v.data(),O=L.userActivity&&typeof L.userActivity=="object"?{...Bn,...L.userActivity}:{...Bn};let I=[];Array.isArray(L.achievedAchievements)&&(I=L.achievedAchievements.filter(P=>P&&typeof P.achievementId=="string"&&typeof P.achievedAt=="string").map(P=>({achievementId:P.achievementId,achievedAt:P.achievedAt,rewardClaimed:typeof P.rewardClaimed=="boolean"?P.rewardClaimed:!0}))),h||(i(O),r(I));return}const R=Jf(),N=R?.activity??{...Bn},E=R?.achieved??[];if(h||(i(N),r(E)),await Vn(j,{userActivity:N,achievedAchievements:E},{merge:!0}),R)try{window.localStorage.removeItem(Co.USER_ACTIVITY),window.localStorage.removeItem(Co.ACHIEVED_ACHIEVEMENTS)}catch{}}catch{}finally{h||c(!0)}})(),()=>{h=!0}},[]),l.useEffect(()=>{const g=ge.currentUser?.uid;if(!g||!a)return;if(!u.current){u.current=!0;return}const h=je(he,"users",g);st(h,{userActivity:o,achievedAchievements:n}).catch(k=>{})},[o,n,a]);const f=l.useCallback(g=>n.some(h=>h.achievementId===g),[n]),x=l.useCallback((g,h)=>{const{condition:k}=g;switch(k.type){case"explore_post_count":return h.explorePosts>=k.target;case"share_post_count":return h.sharePosts>=k.target;case"quality_reply_count":return h.qualityReplies>=k.target;case"reply_count":return h.replies>=k.target;case"lanterns_received":return h.lanternsReceived>=k.target;case"lanterns_given":return h.lanternsGiven>=k.target;case"guide_count":return h.guideCount>=k.target;case"bookmark_count":return h.bookmarks>=k.target;case"login_streak":return h.loginStreak>=k.target;case"follower_count":return h.followerCount>=k.target;case"discussion_exchanges":return h.maxDiscussionExchanges>=k.target;case"max_post_lanterns":return h.maxPostLanterns>=k.target;case"category_quality_reply":return g.category==="economy"?(h.economyReplies||0)>=k.target&&(h.economyAverageLanterns||0)>=(k.minAverageLanterns||0):g.category==="it"?(h.itReplies||0)>=k.target&&(h.itAverageLanterns||0)>=(k.minAverageLanterns||0):g.category==="language"?(h.languageReplies||0)>=k.target&&(h.languageAverageLanterns||0)>=(k.minAverageLanterns||0):!1;case"multi_field_expert":return(h.unlockedFieldExpertCount||0)>=k.target;case"all_categories_tier3":return(h.tier3AchievementsCount||0)>=6;case"all_categories_tier4":return(h.tier4AchievementsCount||0)>=6;case"category_explore_count":return(h.engineeringExplorePosts||0)>=k.target;case"single_category_posts":return(h.engineeringOnlyPosts||0)>=k.target;case"category_first_lantern":return h.engineeringFirstLanternReceived===!0;case"category_reply_count":return(h.engineeringTotalReplies||0)>=k.target;case"monthly_login_rate":return(h.monthlyLoginDays||0)>=k.target;case"own_post_guide_selected":return(h.ownPostGuideSelected||0)>=k.target;case"single_category_replies":return(h.singleCategoryMaxReplies||0)>=k.target;default:return!1}},[]),y=l.useCallback(g=>{const h=n.find(E=>E.achievementId===g.id);if(h&&h.rewardClaimed)return;const{reward:k}=g,j=!h||!h.rewardClaimed;j&&(k.lumens>0&&e&&e(k.lumens,`업적 달성: ${g.name}`,g.id),k.specialTitle&&t&&t(g.id,k.specialTitle));const v=new Date().toISOString(),R=h?{...h,achievedAt:h.achievedAt||v,rewardClaimed:!0}:{achievementId:g.id,achievedAt:v,rewardClaimed:!0};r(E=>{const L=E.findIndex(I=>I.achievementId===g.id);if(L===-1)return[...E,R];const O=[...E];return O[L]=R,O});let N=`${g.name} 업적을 달성했습니다!`;j&&(k.lumens>0&&k.specialTitle?N+=` (루멘 ${k.lumens}개 + 칭호 "${k.specialTitle}" 획득)`:k.lumens>0?N+=` (루멘 ${k.lumens}개 획득)`:k.specialTitle&&(N+=` (특별 칭호 "${k.specialTitle}" 획득)`)),g.hidden?H.success(`🌟 히든 업적 달성! 🌟
${N}`,{duration:5e3}):H.success(`🎉 ${N}`,{duration:4e3})},[n,e,t]),b=l.useCallback(g=>{Qf.forEach(h=>{f(h.id)||x(h,g)&&y(h)})},[x,y,f]),S=l.useCallback(g=>{i(h=>{const k={...h,...g};return setTimeout(()=>{b(k)},100),k})},[b]),C=n.filter(g=>zs.some(h=>h.id===g.achievementId)).length,w=n.filter(g=>Us.some(h=>h.id===g.achievementId)).length,m=zs.length,p=Us.length;return{achievedAchievements:n,userActivity:o,isAchievementUnlocked:f,getAchievementInfo:d,updateActivity:S,checkAchievements:b,achievedNormalCount:C,achievedHiddenCount:w,normalCount:m,hiddenCount:p}}const th=10;function nh(e){const{includeHidden:t=!1,enabled:n=!0}={},[r,o]=l.useState([]),[i,a]=l.useState(!1);return l.useEffect(()=>{if(!n)return;a(!0);const c=Oe(he,"posts"),u=Et(c,gl("createdAt","desc"),ri(th)),d=go(u,f=>{const x=ge.currentUser?.uid??null,b=f.docs.map(S=>{const C=S.data(),w=C.hidden===!0;if(w&&!t)return null;const m=C.createdAt&&typeof C.createdAt.toDate=="function"?C.createdAt.toDate():C.createdAt instanceof Date?C.createdAt:new Date;let p=[];return Array.isArray(C.replies)&&(p=C.replies.filter(h=>!(!h||typeof h!="object"||h.hidden===!0&&!t)).map(h=>({id:h.id??Date.now(),content:h.content??"",author:h.author??"알 수 없음",authorUid:h.authorUid??null,authorAvatar:h.authorAvatar??null,timeAgo:h.timeAgo??"",lanterns:h.lanterns??0,isGuide:!!h.isGuide,createdAt:typeof h.createdAt?.toDate=="function"?h.createdAt.toDate():h.createdAt instanceof Date?h.createdAt:new Date,authorTitleId:h.authorTitleId??null,isAi:h.isAi===!0||typeof h.aiLabel=="string",aiLabel:h.aiLabel,aiSummary:h.aiSummary,aiSource:h.aiSource}))),{id:S.id,title:C.title??"",content:C.content??"",category:C.category??"기타",subCategory:C.subCategory??"기타",type:C.type??"question",tags:Array.isArray(C.tags)?C.tags:[],author:C.author??"알 수 없음",authorUid:C.authorUid??null,authorAvatar:C.authorAvatar??"",createdAt:m,lanterns:C.lanterns??0,replies:p,replyCount:C.replyCount??p.length,comments:C.comments??p.length,views:C.views??0,isBookmarked:!1,isOwner:!!x&&!!C.authorUid&&x===C.authorUid,authorTitleId:C.authorTitleId??null,authorTitleName:C.authorTitleName??null,hidden:w,reportCount:C.reportCount??0,moderationStatus:C.moderationStatus??"pending",clientIp:C.clientIp??null}}).filter(S=>S!==null);o(b),a(!1)},f=>{a(!1)});return()=>d()},[t,n]),{posts:r,setPosts:o,loading:i,refresh:()=>{}}}function ms({icon:e,title:t,onClick:n,variant:r="default"}){const[o,i]=l.useState(()=>document.documentElement.classList.contains("dark"));return l.useEffect(()=>{const a=new MutationObserver(()=>{i(document.documentElement.classList.contains("dark"))});return a.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>a.disconnect()},[]),s.jsxs("button",{type:"button",onClick:n,style:r==="default"&&o?{backgroundColor:"#2D2F31",borderColor:"#c9a532"}:void 0,className:`
                w-full text-left
                rounded-xl
                border
                transition-all
                px-4 py-3.5
                flex items-center gap-3
                hover:scale-[1.02] active:scale-[0.98]
                ${r==="default"?"bg-primary/20 border-primary/30 hover:bg-primary/30 text-foreground dark:text-[#D4D4D4]":"border-border/30 bg-transparent hover:bg-accent/20 text-foreground"}
            `,onMouseEnter:a=>{r==="default"&&o&&(a.currentTarget.style.backgroundColor="#353739")},onMouseLeave:a=>{r==="default"&&o&&(a.currentTarget.style.backgroundColor="#2D2F31")},children:[s.jsx("div",{className:`
                    shrink-0 w-10 h-10 rounded-xl
                    flex items-center justify-center
                    ${r==="default"&&o?"bg-[#D4D4D4]/10 text-[#D4D4D4]":"bg-primary/10 text-primary"}
                `,children:e}),s.jsx("div",{className:"min-w-0 flex-1 flex flex-col gap-1",children:s.jsx("div",{className:`text-[15px] font-semibold ${r==="default"&&o?"text-[#D4D4D4]":"text-foreground"}`,children:t})})]})}function rh({open:e,onClose:t,onSelectStructured:n,onSelectWrite:r,onSelectNotes:o}){l.useEffect(()=>{if(!e)return;const u=d=>{d.key==="Escape"&&t()};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[e,t]);const i=l.useCallback(()=>{t(),n()},[t,n]),a=l.useCallback(()=>{t(),r()},[t,r]),c=l.useCallback(()=>{t(),o()},[t,o]);return e?s.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[s.jsx("div",{className:`
          absolute inset-0
          bg-black/35
          backdrop-blur-[3px]
        `,onClick:t,"aria-hidden":"true"}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",onClick:t,children:s.jsx("div",{role:"dialog","aria-modal":"true",onClick:u=>u.stopPropagation(),className:`
                        w-full max-w-[400px]
                        rounded-2xl
                        border border-border/30
                        bg-card
                        shadow-[0_24px_90px_rgba(0,0,0,0.55)]
                        overflow-hidden
                    `,children:s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-accent/50 flex items-center justify-center shrink-0",children:s.jsx(ra,{className:"w-6 h-6 text-muted-foreground"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"text-lg font-semibold text-foreground",children:"무엇을 하고 싶나요?"}),s.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:"먼저 정리하면 더 좋은 질문/글이 됩니다."})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(ms,{icon:s.jsx(ra,{size:18}),title:"질문을 정리하고 싶어요",onClick:i,variant:"default"}),s.jsx(ms,{icon:s.jsx(rf,{size:18}),title:"그냥 글을 쓰고 싶어요",onClick:a,variant:"default"}),s.jsx(ms,{icon:s.jsx(tf,{size:18}),title:"내 노트를 보고 싶어요",onClick:c,variant:"default"})]})]})})})]}):null}const ca=(e,t)=>Oe(he,"user_lanterns",e,t);function oh({posts:e,setPosts:t,selectedPost:n,setSelectedPost:r,userNickname:o,userActivity:i,updateActivity:a,userPostLanterns:c,setUserPostLanterns:u,userReplyLanterns:d,setUserReplyLanterns:f,addLumensWithTrust:x,updateTrust:y}){const[b,S]=l.useState(new Set),[C,w]=l.useState(new Set);l.useEffect(()=>{const k=ge.currentUser?.uid??null;if(!k)return;(async()=>{try{const R=(await et(ca(k,"posts"))).docs.map(L=>L.id);S(new Set(R));const E=(await et(ca(k,"replies"))).docs.map(L=>Number(L.id)).filter(L=>!Number.isNaN(L));w(new Set(E))}catch{}})()},[]);const m=l.useCallback(async k=>{const j=String(k),v=new Set;b.forEach(P=>v.add(String(P)));const R=v.has(j),N=new Set(v);R?N.delete(j):N.add(j),S(N);const E=R?-1:1,O=e.find(P=>String(P.id)===j)?.lanterns??0;t(P=>P.map(_=>String(_.id)===j?{..._,lanterns:Math.max(0,O+E)}:_)),n&&String(n.id)===j&&r({...n,lanterns:Math.max(0,O+E)});const I=fn(po,"toggleLantern");try{await I({postId:j})}catch{S(v),t(_=>_.map(M=>String(M.id)===j?{...M,lanterns:O}:M)),n&&String(n.id)===j&&r({...n,lanterns:O}),H.error("등불 처리에 실패했어요. 잠시 후 다시 시도해주세요.");return}R||H.success("등불을 밝혔습니다! ✨")},[b,e,t,n,r]),p=l.useCallback(async(k,j)=>{const v=String(j),R=C.has(k),N=new Set(C);R?N.delete(k):N.add(k),w(N);const E=R?-1:1,I=e.find(_=>String(_.id)===v)?.replies?.find(_=>_.id===k)?.lanterns??0;t(_=>_.map(M=>String(M.id)===v&&Array.isArray(M.replies)?{...M,replies:M.replies.map(z=>z.id===k?{...z,lanterns:Math.max(0,I+E)}:z)}:M)),n&&String(n.id)===v&&Array.isArray(n.replies)&&r({...n,replies:n.replies.map(_=>_.id===k?{..._,lanterns:Math.max(0,I+E)}:_)});const P=fn(po,"toggleReplyLantern");try{await P({postId:v,replyId:k})}catch{w(C),t(M=>M.map(z=>String(z.id)===v&&Array.isArray(z.replies)?{...z,replies:z.replies.map(F=>F.id===k?{...F,lanterns:I}:F)}:z)),n&&String(n.id)===v&&Array.isArray(n.replies)&&r({...n,replies:n.replies.map(M=>M.id===k?{...M,lanterns:I}:M)}),H.error("등불 처리에 실패했어요. 잠시 후 다시 시도해주세요.");return}R||H.success("등불을 밝혔습니다! ✨")},[C,e,t,n,r]),g=l.useCallback(k=>b.has(String(k)),[b]),h=l.useCallback(k=>C.has(k),[C]);return{lanternedPosts:b,lanternedReplies:C,handleLanternToggle:m,handleReplyLanternToggle:p,isPostLanterned:g,isReplyLanterned:h}}const ua=e=>Oe(he,"user_bookmarks",e,"posts"),da=(e,t)=>je(he,"user_bookmarks",e,"posts",String(t));function sh({userNickname:e}){const[t,n]=l.useState(new Set);l.useEffect(()=>{const i=ge.currentUser?.uid??null;if(!i)return;(async()=>{try{const u=(await et(ua(i))).docs.map(d=>d.id);n(new Set(u))}catch{}})()},[]),l.useEffect(()=>{const i=ge.currentUser?.uid??null;if(!i){n(new Set);return}(async()=>{try{const c=await et(ua(i)),u=new Set;c.forEach(d=>{const f=d.data(),x=(f&&f.postId)??d.id;u.add(String(x))}),n(u)}catch{}})()},[e]);const r=l.useCallback(async i=>{const a=String(i),c=t.has(a),u=ge.currentUser?.uid??null;if(n(d=>{const f=new Set(d);return c?f.delete(a):f.add(a),f}),u)try{if(c)await oi(da(u,a)),H.success("북마크가 해제되었습니다");else{let d=null,f=null;try{const x=await Ft(je(he,"posts",a));if(x.exists()){const y=x.data();d=y?.category??null,f=y?.subCategory??null}}catch{}await Vn(da(u,a),{postId:a,category:d,subCategory:f,createdAt:Zt()},{merge:!0}),H.success("북마크에 저장되었습니다")}}catch{n(f=>{const x=new Set(f);return c?x.add(a):x.delete(a),x}),H.error("북마크 저장에 실패했습니다")}else H.error("로그인이 필요합니다"),n(d=>{const f=new Set(d);return c?f.add(a):f.delete(a),f})},[t]),o=l.useCallback(i=>t.has(String(i)),[t]);return{bookmarkedPosts:t,handleBookmarkToggle:r,isBookmarked:o}}var fi={};(function e(t,n,r,o){var i=!!(t.Worker&&t.Blob&&t.Promise&&t.OffscreenCanvas&&t.OffscreenCanvasRenderingContext2D&&t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype.transferControlToOffscreen&&t.URL&&t.URL.createObjectURL),a=typeof Path2D=="function"&&typeof DOMMatrix=="function",c=(function(){if(!t.OffscreenCanvas)return!1;try{var A=new OffscreenCanvas(1,1),T=A.getContext("2d");T.fillRect(0,0,1,1);var $=A.transferToImageBitmap();T.createPattern($,"no-repeat")}catch{return!1}return!0})();function u(){}function d(A){var T=n.exports.Promise,$=T!==void 0?T:t.Promise;return typeof $=="function"?new $(A):(A(u,u),null)}var f=(function(A,T){return{transform:function($){if(A)return $;if(T.has($))return T.get($);var K=new OffscreenCanvas($.width,$.height),V=K.getContext("2d");return V.drawImage($,0,0),T.set($,K),K},clear:function(){T.clear()}}})(c,new Map),x=(function(){var A=Math.floor(16.666666666666668),T,$,K={},V=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(T=function(q){var se=Math.random();return K[se]=requestAnimationFrame(function G(B){V===B||V+A-1<B?(V=B,delete K[se],q()):K[se]=requestAnimationFrame(G)}),se},$=function(q){K[q]&&cancelAnimationFrame(K[q])}):(T=function(q){return setTimeout(q,A)},$=function(q){return clearTimeout(q)}),{frame:T,cancel:$}})(),y=(function(){var A,T,$={};function K(V){function q(se,G){V.postMessage({options:se||{},callback:G})}V.init=function(G){var B=G.transferControlToOffscreen();V.postMessage({canvas:B},[B])},V.fire=function(G,B,te){if(T)return q(G,null),T;var oe=Math.random().toString(36).slice(2);return T=d(function(Q){function me(fe){fe.data.callback===oe&&(delete $[oe],V.removeEventListener("message",me),T=null,f.clear(),te(),Q())}V.addEventListener("message",me),q(G,oe),$[oe]=me.bind(null,{data:{callback:oe}})}),T},V.reset=function(){V.postMessage({reset:!0});for(var G in $)$[G](),delete $[G]}}return function(){if(A)return A;if(!r&&i){var V=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{A=new Worker(URL.createObjectURL(new Blob([V])))}catch{return typeof console<"u",null}K(A)}return A}})(),b={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function S(A,T){return T?T(A):A}function C(A){return A!=null}function w(A,T,$){return S(A&&C(A[T])?A[T]:b[T],$)}function m(A){return A<0?0:Math.floor(A)}function p(A,T){return Math.floor(Math.random()*(T-A))+A}function g(A){return parseInt(A,16)}function h(A){return A.map(k)}function k(A){var T=String(A).replace(/[^0-9a-f]/gi,"");return T.length<6&&(T=T[0]+T[0]+T[1]+T[1]+T[2]+T[2]),{r:g(T.substring(0,2)),g:g(T.substring(2,4)),b:g(T.substring(4,6))}}function j(A){var T=w(A,"origin",Object);return T.x=w(T,"x",Number),T.y=w(T,"y",Number),T}function v(A){A.width=document.documentElement.clientWidth,A.height=document.documentElement.clientHeight}function R(A){var T=A.getBoundingClientRect();A.width=T.width,A.height=T.height}function N(A){var T=document.createElement("canvas");return T.style.position="fixed",T.style.top="0px",T.style.left="0px",T.style.pointerEvents="none",T.style.zIndex=A,T}function E(A,T,$,K,V,q,se,G,B){A.save(),A.translate(T,$),A.rotate(q),A.scale(K,V),A.arc(0,0,1,se,G,B),A.restore()}function L(A){var T=A.angle*(Math.PI/180),$=A.spread*(Math.PI/180);return{x:A.x,y:A.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:A.startVelocity*.5+Math.random()*A.startVelocity,angle2D:-T+(.5*$-Math.random()*$),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:A.color,shape:A.shape,tick:0,totalTicks:A.ticks,decay:A.decay,drift:A.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:A.gravity*3,ovalScalar:.6,scalar:A.scalar,flat:A.flat}}function O(A,T){T.x+=Math.cos(T.angle2D)*T.velocity+T.drift,T.y+=Math.sin(T.angle2D)*T.velocity+T.gravity,T.velocity*=T.decay,T.flat?(T.wobble=0,T.wobbleX=T.x+10*T.scalar,T.wobbleY=T.y+10*T.scalar,T.tiltSin=0,T.tiltCos=0,T.random=1):(T.wobble+=T.wobbleSpeed,T.wobbleX=T.x+10*T.scalar*Math.cos(T.wobble),T.wobbleY=T.y+10*T.scalar*Math.sin(T.wobble),T.tiltAngle+=.1,T.tiltSin=Math.sin(T.tiltAngle),T.tiltCos=Math.cos(T.tiltAngle),T.random=Math.random()+2);var $=T.tick++/T.totalTicks,K=T.x+T.random*T.tiltCos,V=T.y+T.random*T.tiltSin,q=T.wobbleX+T.random*T.tiltCos,se=T.wobbleY+T.random*T.tiltSin;if(A.fillStyle="rgba("+T.color.r+", "+T.color.g+", "+T.color.b+", "+(1-$)+")",A.beginPath(),a&&T.shape.type==="path"&&typeof T.shape.path=="string"&&Array.isArray(T.shape.matrix))A.fill(z(T.shape.path,T.shape.matrix,T.x,T.y,Math.abs(q-K)*.1,Math.abs(se-V)*.1,Math.PI/10*T.wobble));else if(T.shape.type==="bitmap"){var G=Math.PI/10*T.wobble,B=Math.abs(q-K)*.1,te=Math.abs(se-V)*.1,oe=T.shape.bitmap.width*T.scalar,Q=T.shape.bitmap.height*T.scalar,me=new DOMMatrix([Math.cos(G)*B,Math.sin(G)*B,-Math.sin(G)*te,Math.cos(G)*te,T.x,T.y]);me.multiplySelf(new DOMMatrix(T.shape.matrix));var fe=A.createPattern(f.transform(T.shape.bitmap),"no-repeat");fe.setTransform(me),A.globalAlpha=1-$,A.fillStyle=fe,A.fillRect(T.x-oe/2,T.y-Q/2,oe,Q),A.globalAlpha=1}else if(T.shape==="circle")A.ellipse?A.ellipse(T.x,T.y,Math.abs(q-K)*T.ovalScalar,Math.abs(se-V)*T.ovalScalar,Math.PI/10*T.wobble,0,2*Math.PI):E(A,T.x,T.y,Math.abs(q-K)*T.ovalScalar,Math.abs(se-V)*T.ovalScalar,Math.PI/10*T.wobble,0,2*Math.PI);else if(T.shape==="star")for(var ne=Math.PI/2*3,ae=4*T.scalar,ue=8*T.scalar,ie=T.x,de=T.y,Se=5,Te=Math.PI/Se;Se--;)ie=T.x+Math.cos(ne)*ue,de=T.y+Math.sin(ne)*ue,A.lineTo(ie,de),ne+=Te,ie=T.x+Math.cos(ne)*ae,de=T.y+Math.sin(ne)*ae,A.lineTo(ie,de),ne+=Te;else A.moveTo(Math.floor(T.x),Math.floor(T.y)),A.lineTo(Math.floor(T.wobbleX),Math.floor(V)),A.lineTo(Math.floor(q),Math.floor(se)),A.lineTo(Math.floor(K),Math.floor(T.wobbleY));return A.closePath(),A.fill(),T.tick<T.totalTicks}function I(A,T,$,K,V){var q=T.slice(),se=A.getContext("2d"),G,B,te=d(function(oe){function Q(){G=B=null,se.clearRect(0,0,K.width,K.height),f.clear(),V(),oe()}function me(){r&&!(K.width===o.width&&K.height===o.height)&&(K.width=A.width=o.width,K.height=A.height=o.height),!K.width&&!K.height&&($(A),K.width=A.width,K.height=A.height),se.clearRect(0,0,K.width,K.height),q=q.filter(function(fe){return O(se,fe)}),q.length?G=x.frame(me):Q()}G=x.frame(me),B=Q});return{addFettis:function(oe){return q=q.concat(oe),te},canvas:A,promise:te,reset:function(){G&&x.cancel(G),B&&B()}}}function P(A,T){var $=!A,K=!!w(T||{},"resize"),V=!1,q=w(T,"disableForReducedMotion",Boolean),se=i&&!!w(T||{},"useWorker"),G=se?y():null,B=$?v:R,te=A&&G?!!A.__confetti_initialized:!1,oe=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,Q;function me(ne,ae,ue){for(var ie=w(ne,"particleCount",m),de=w(ne,"angle",Number),Se=w(ne,"spread",Number),Te=w(ne,"startVelocity",Number),nn=w(ne,"decay",Number),rn=w(ne,"gravity",Number),on=w(ne,"drift",Number),at=w(ne,"colors",h),yt=w(ne,"ticks",Number),bn=w(ne,"shapes"),In=w(ne,"scalar"),Gt=!!w(ne,"flat"),vt=j(ne),sn=ie,an=[],er=A.width*vt.x,Mr=A.height*vt.y;sn--;)an.push(L({x:er,y:Mr,angle:de,spread:Se,startVelocity:Te,color:at[sn%at.length],shape:bn[p(0,bn.length)],ticks:yt,decay:nn,gravity:rn,drift:on,scalar:In,flat:Gt}));return Q?Q.addFettis(an):(Q=I(A,an,B,ae,ue),Q.promise)}function fe(ne){var ae=q||w(ne,"disableForReducedMotion",Boolean),ue=w(ne,"zIndex",Number);if(ae&&oe)return d(function(Te){Te()});$&&Q?A=Q.canvas:$&&!A&&(A=N(ue),document.body.appendChild(A)),K&&!te&&B(A);var ie={width:A.width,height:A.height};G&&!te&&G.init(A),te=!0,G&&(A.__confetti_initialized=!0);function de(){if(G){var Te={getBoundingClientRect:function(){if(!$)return A.getBoundingClientRect()}};B(Te),G.postMessage({resize:{width:Te.width,height:Te.height}});return}ie.width=ie.height=null}function Se(){Q=null,K&&(V=!1,t.removeEventListener("resize",de)),$&&A&&(document.body.contains(A)&&document.body.removeChild(A),A=null,te=!1)}return K&&!V&&(V=!0,t.addEventListener("resize",de,!1)),G?G.fire(ne,ie,Se):me(ne,ie,Se)}return fe.reset=function(){G&&G.reset(),Q&&Q.reset()},fe}var _;function M(){return _||(_=P(null,{useWorker:!0,resize:!0})),_}function z(A,T,$,K,V,q,se){var G=new Path2D(A),B=new Path2D;B.addPath(G,new DOMMatrix(T));var te=new Path2D;return te.addPath(B,new DOMMatrix([Math.cos(se)*V,Math.sin(se)*V,-Math.sin(se)*q,Math.cos(se)*q,$,K])),te}function F(A){if(!a)throw new Error("path confetti are not supported in this browser");var T,$;typeof A=="string"?T=A:(T=A.path,$=A.matrix);var K=new Path2D(T),V=document.createElement("canvas"),q=V.getContext("2d");if(!$){for(var se=1e3,G=se,B=se,te=0,oe=0,Q,me,fe=0;fe<se;fe+=2)for(var ne=0;ne<se;ne+=2)q.isPointInPath(K,fe,ne,"nonzero")&&(G=Math.min(G,fe),B=Math.min(B,ne),te=Math.max(te,fe),oe=Math.max(oe,ne));Q=te-G,me=oe-B;var ae=10,ue=Math.min(ae/Q,ae/me);$=[ue,0,0,ue,-Math.round(Q/2+G)*ue,-Math.round(me/2+B)*ue]}return{type:"path",path:T,matrix:$}}function Z(A){var T,$=1,K="#000000",V='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof A=="string"?T=A:(T=A.text,$="scalar"in A?A.scalar:$,V="fontFamily"in A?A.fontFamily:V,K="color"in A?A.color:K);var q=10*$,se=""+q+"px "+V,G=new OffscreenCanvas(q,q),B=G.getContext("2d");B.font=se;var te=B.measureText(T),oe=Math.ceil(te.actualBoundingBoxRight+te.actualBoundingBoxLeft),Q=Math.ceil(te.actualBoundingBoxAscent+te.actualBoundingBoxDescent),me=2,fe=te.actualBoundingBoxLeft+me,ne=te.actualBoundingBoxAscent+me;oe+=me+me,Q+=me+me,G=new OffscreenCanvas(oe,Q),B=G.getContext("2d"),B.font=se,B.fillStyle=K,B.fillText(T,fe,ne);var ae=1/$;return{type:"bitmap",bitmap:G.transferToImageBitmap(),matrix:[ae,0,0,ae,-oe*ae/2,-Q*ae/2]}}n.exports=function(){return M().apply(this,arguments)},n.exports.reset=function(){M().reset()},n.exports.create=P,n.exports.shapeFromPath=F,n.exports.shapeFromText=Z})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),fi,!1);const ih=fi.exports;fi.exports.create;const ze={setItem:(e,t)=>{try{localStorage.setItem(e,t)}catch{}},getItem:e=>{try{return localStorage.getItem(e)}catch{return null}},setJSON:(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch{}},getJSON:(e,t)=>{try{const n=localStorage.getItem(e);return n===null?t:JSON.parse(n)}catch{return t}},getNumber:(e,t)=>{try{const n=localStorage.getItem(e);if(n===null)return t;const r=parseInt(n);return isNaN(r)?t:r}catch{return t}},removeItem:e=>{try{localStorage.removeItem(e)}catch{}}};async function Vl(e){return Td(lo("userData",e),async()=>fd("getUserData",async()=>{const t=je(he,"users",e),n=await Ft(t);if(!n.exists())return{trustScore:30,ownedTitles:[],currentTitle:null};const r=n.data();return{trustScore:typeof r.trustScore=="number"?r.trustScore:30,ownedTitles:Array.isArray(r.ownedTitles)?r.ownedTitles.filter(o=>typeof o=="string"):[],currentTitle:typeof r.currentTitle=="string"&&r.currentTitle.trim()!==""?r.currentTitle:null}}),300*1e3)}function Un(e){hs.invalidate(lo("userData",e)),hs.invalidate(lo("trustScore",e)),hs.invalidate(lo("userTitles",e))}function ah({posts:e,setPosts:t,selectedPost:n,setSelectedPost:r,userNickname:o}){const[i,a]=l.useState(new Set),[c,u]=l.useState(new Map);l.useEffect(()=>{const y=ze.getJSON("guideReplies",[]);Array.isArray(y)&&a(new Set(y));const b=ze.getJSON("postGuides",{});if(typeof b=="object"&&b!==null){const S=Object.entries(b).filter(([,C])=>typeof C=="number");u(new Map(S))}},[]);const d=l.useCallback(async(y,b,S)=>{const C=String(S),w=e.find(h=>String(h.id)===C);if(!w){H.error("게시글 정보를 찾을 수 없습니다.");return}if(c.get(C)!==void 0||w.guideReplyId){H.error("이미 길잡이가 채택된 글입니다.");return}if(b===o){H.error("자신의 답글은 채택할 수 없습니다.");return}if(w.author!==o){H.error("글 작성자만 길잡이를 채택할 수 있습니다.");return}const m=new Set(i);m.add(y),a(m);const p=new Map(c);p.set(C,y),u(p),ze.setJSON("guideReplies",Array.from(m)),ze.setJSON("postGuides",Object.fromEntries(p));const g=e.map(h=>{if(String(h.id)===C){const k=(h.replies||[]).map(j=>({...j,isGuide:j.id===y}));return{...h,replies:k,guideReplyId:y}}return h});if(t(g),n&&String(n.id)===C){const h=g.find(k=>String(k.id)===C);h&&r(h)}H.success(`${b}님을 길잡이로 채택했습니다! 🌟`);try{const k=w.replies?.find(j=>j.id===y)?.authorUid;if(k){const j=je(he,"users",k);Ft(j).then(async v=>{v.exists()&&((v.data().ownedTitles||[]).includes("guide_pathfinder")||(await st(j,{ownedTitles:xl("guide_pathfinder")}),Un(k),ih({particleCount:150,spread:70,origin:{y:.6},colors:["#f59e0b","#fbbf24","#d97706"]}),H.success("🏆 최초 채택 달성! '개척자' 칭호를 획득했습니다!")))}).catch(v=>{})}}catch{}try{await fn(po,"selectGuide")({postId:C,replyId:y})}catch{H.error("서버에 길잡이 정보를 업데이트하는 중 오류가 발생했습니다.")}},[e,n,o,i,c,t,r]),f=l.useCallback(y=>{const b=String(y);if(c.has(b))return!0;const S=e.find(C=>String(C.id)===b);return!!(S&&(S.guideReplyId!==void 0||S.guideReplyId))},[c,e]),x=l.useCallback(y=>i.has(y),[i]);return{handleGuideSelect:d,hasGuide:f,isGuideReply:x}}async function lh(e){if(!e)return null;const t=Oe(he,"users"),n=Et(t,Ht("nickname","==",e)),r=await et(n);if(r.empty)return null;const o=r.docs[0],i=o.data();return{uid:o.id,nickname:i?.nickname??e,photoURL:i?.photoURL??""}}async function ch(e){if(!e)return{followerCount:0,followingCount:0,followingNicknames:[]};const t=je(he,"users",e),n=await Ft(t),r=(n.exists()?n.data():{})??{},o=typeof r.followerCount=="number"?r.followerCount:0,i=typeof r.followingCount=="number"?r.followingCount:0,a=Oe(he,"follows"),c=Et(a,Ht("followerUid","==",e)),u=await et(c),d=new Set;return u.forEach(f=>{const y=f.data()?.followingNickname;y&&d.add(y)}),{followerCount:o,followingCount:i,followingNicknames:Array.from(d)}}async function uh(e){const{currentUid:t,currentNickname:n,targetNickname:r}=e;if(!t)throw new Error("CURRENT_USER_REQUIRED");if(!r)throw new Error("TARGET_NICKNAME_REQUIRED");if(n===r)return{isFollowing:!1,followerCount:0,followingCount:0};const o=await lh(r);if(!o)throw new Error("TARGET_USER_NOT_FOUND");const i=`${t}_${o.uid}`,a=je(he,"follows",i);return await yl(he,async u=>(await u.get(a)).exists()?(u.delete(a),{isFollowing:!1,followerCount:0,followingCount:0}):(u.set(a,{followerUid:t,followerNickname:n,followingUid:o.uid,followingNickname:o.nickname,createdAt:Zt()}),{isFollowing:!0,followerCount:0,followingCount:0}))}async function ql(e){if(!e)return[];const t=Oe(he,"follows"),n=Et(t,Ht("followingUid","==",e)),r=await et(n),o=new Set;return r.forEach(i=>{const c=i.data()?.followerNickname;c&&o.add(c)}),Array.from(o)}async function fa(e){if(!e.length)return[];const t=e.slice(0,10),n=Oe(he,"users"),r=Et(n,Ht("nickname","in",t)),o=await et(r),i=new Map;return o.forEach(a=>{const c=a.data(),u=c.nickname;let d="";if(typeof c.profileImageUrl=="string"&&c.profileImageUrl)d=c.profileImageUrl;else if(typeof c.photoURL=="string"&&c.photoURL){const f=c.photoURL;f.includes("googleusercontent.com")||f.includes("googleapis.com")||f.includes("lh3.googleusercontent.com")||f.includes("lh4.googleusercontent.com")||f.includes("lh5.googleusercontent.com")||f.includes("lh6.googleusercontent.com")||(d=f)}i.set(u,{nickname:u,avatarUrl:d,bio:c.profileDescription||"",title:c.currentTitle||""})}),e.map(a=>i.get(a)||{nickname:a})}function dh({userNickname:e}){const[t,n]=l.useState([]),[r,o]=l.useState(0),[i,a]=l.useState([]),[c,u]=l.useState([]),[d,f]=l.useState([]),x=l.useRef(new Set),y=l.useCallback(async m=>{const p=Oe(he,"users"),g=Et(p,Ht("nickname","==",m)),h=await et(g);if(h.empty)return{exists:!1,isDeleted:!1};const k=h.docs[0].data();return{exists:!0,isDeleted:k?.isDeleted===!0||k?.status==="deleted"||k?.nickname==="탈퇴한 사용자"||k?.nickname==="탈퇴한 사용자 입니다만"||typeof k?.nickname=="string"&&k.nickname.includes("탈퇴한 사용자")}},[]);l.useEffect(()=>{const m=ge.currentUser?.uid??null;if(!m)return;const p=Oe(he,"follows"),g=Et(p,Ht("followerUid","==",m)),h=go(g,v=>{const R=new Set;v.forEach(N=>{const L=N.data()?.followingNickname;L&&R.add(L)}),n(Array.from(R))},v=>{}),k=je(he,"users",m),j=go(k,v=>{const R=(v.exists()?v.data():{})??{},N=typeof R.followerCount=="number"?R.followerCount:0;o(N)},v=>{});return()=>{h(),j()}},[]);const b=l.useCallback(async()=>{const m=ge.currentUser?.uid??null;if(m)try{const p=await ql(m);a(p??[]),o(Array.isArray(p)?p.length:0)}catch{}},[]);l.useEffect(()=>{let m=!1;const p=async()=>{try{const g=await fa(i);m||u(g)}catch{}};return i.length?p():u([]),()=>{m=!0}},[i]),l.useEffect(()=>{let m=!1;const p=async()=>{try{const g=await fa(t);m||f(g)}catch{}};return t.length?p():f([]),()=>{m=!0}},[t]);const S=l.useCallback(async m=>{const p=m?.trim();if(!p||p===e)return!1;if(p==="탈퇴한 사용자")return H.error("탈퇴한 사용자는 팔로우할 수 없습니다."),!1;if(x.current.has(p))return!1;x.current.add(p);const g=ge.currentUser?.uid??null;if(!g)return H.error("로그인 후 이용해주세요."),x.current.delete(p),!1;try{const{exists:h,isDeleted:k}=await y(p);return h?k?(H.error("탈퇴한 사용자는 팔로우할 수 없습니다."),n(v=>v.filter(R=>R!==p)),!1):((await uh({currentUid:g,currentNickname:e,targetNickname:p})).isFollowing?n(v=>v.includes(p)?v:[...v,p]):n(v=>v.filter(R=>R!==p)),!0):(H.error("해당 닉네임의 사용자를 찾을 수 없습니다."),n(v=>v.filter(R=>R!==p)),!1)}catch(h){const k=typeof h?.message=="string"?h.message:"",j=typeof h?.code=="string"?h.code:"";return k.includes("TARGET_USER_NOT_FOUND")||j==="TARGET_USER_NOT_FOUND"?(H.error("해당 닉네임의 사용자를 찾을 수 없습니다."),n(v=>v.filter(R=>R!==p))):j==="permission-denied"||k.includes("permission")?H.error("팔로우 권한이 없습니다. 로그인 상태를 확인해주세요."):H.error(`팔로우 상태를 변경하지 못했습니다: ${k||j||"알 수 없는 오류"}`),!1}finally{x.current.delete(p)}},[e,y]),C=l.useCallback(m=>t.includes(m),[t]),w=t.length;return{followingUsers:t,followerUsers:i,followerCount:r,followingCount:w,handleToggleFollowUser:S,isFollowing:C,fetchFollowerUsers:b,setFollowerCount:o,followerUsersDetailed:c,followingUsersDetailed:d}}const Xt=e=>{const t=ge.currentUser?.uid;return t?`${e}_${t}`:e};function fh({lumenBalance:e,spendLumens:t}){const[n,r]=l.useState([]),[o,i]=l.useState(""),[a,c]=l.useState(!1),[u,d]=l.useState(!0),[f,x]=l.useState(!1);l.useEffect(()=>{ge.currentUser&&x(!0);const m=ti(ge,()=>{x(!0)});return()=>m()},[]),l.useEffect(()=>{if(!f||!ge.currentUser?.uid)return;const p=Xt("ownedTitles"),g=Xt("currentTitle"),h=ze.getJSON(p,[]);Array.isArray(h)&&r(h);const k=ze.getItem(g);k&&k.trim()!==""&&i(k)},[f]),l.useEffect(()=>{if(!f)return;const m=ge.currentUser?.uid;if(!m)return;(async()=>{try{const g=await Vl(m);g.ownedTitles.length>0&&r(R=>{const N=Array.from(new Set([...R,...g.ownedTitles])),E=Xt("ownedTitles");return ze.setJSON(E,N),N});const h=Xt("currentTitle"),k=o,j=ze.getItem(h)||"",v=g.currentTitle!==null?g.currentTitle:k&&k.trim()!==""?k:j&&j.trim()!==""?j:"";if(v){if(i(v),ze.setItem(h,v),g.currentTitle===null&&v!==g.currentTitle)try{const R=je(he,"users",m);await st(R,{currentTitle:v}),Un(m)}catch{}}else i(""),ze.setItem(h,"")}catch{}finally{c(!0),d(!1)}})()},[f,o]),l.useEffect(()=>{if(!a||u)return;const m=ge.currentUser?.uid;if(!m)return;(async()=>{try{const g=je(he,"users",m);await st(g,{ownedTitles:n,currentTitle:o||null}),Un(m)}catch{}})()},[n,o,a,u]);const y=l.useCallback(async(m,p)=>a?p<0?(H.error("잘못된 가격 정보입니다."),!1):n.includes(m)?(H.error("이미 보유한 칭호입니다."),!1):p>0&&e<p?(H.error("루멘이 부족합니다."),!1):p>0&&!await t(p,"칭호 구매",m)?!1:(r(g=>{if(g.includes(m))return g;const h=[...g,m];return ze.setJSON(Xt("ownedTitles"),h),h}),H.success("칭호를 구매했습니다! 🎉"),!0):(H.error("잠시만요! 칭호 정보를 불러오는 중입니다."),!1),[n,e,t,a]),b=l.useCallback(async m=>{if(!a)return H.error("잠시만요! 칭호 정보를 불러오는 중입니다."),!1;if(!n.includes(m))return H.error("소유하지 않은 칭호는 장착할 수 없습니다."),!1;const p=ge.currentUser?.uid;if(!p)return H.error("로그인이 필요합니다."),!1;const g=o;i(m);const h=Xt("currentTitle");ze.setItem(h,m);try{const k=je(he,"users",p);return await st(k,{currentTitle:m}),Un(p),!0}catch{return i(g),ze.setItem(h,g),H.error("칭호 장착에 실패했습니다."),!1}},[n,o,a]),S=l.useCallback(async()=>{if(!a)return H.error("잠시만요! 칭호 정보를 불러오는 중입니다."),!1;const m=ge.currentUser?.uid;if(!m)return H.error("로그인이 필요합니다."),!1;const p=o;i("");const g=Xt("currentTitle");ze.setItem(g,"");try{const h=je(he,"users",m);return await st(h,{currentTitle:""}),Un(m),!0}catch{return i(p),ze.setItem(g,p),H.error("칭호 해제에 실패했습니다."),!1}},[o,a]),C=l.useCallback(async(m,p)=>{if(!a||n.includes(m))return;const g=ge.currentUser?.uid;if(g){r(h=>{if(h.includes(m))return h;const k=[...h,m],j=Xt("ownedTitles");return ze.setJSON(j,k),k});try{const h=je(he,"users",g);await st(h,{ownedTitles:xl(m)}),Un(g),H.success(`칭호 "${p}" 획득! 🎉`)}catch{r(k=>{const j=k.filter(R=>R!==m),v=Xt("ownedTitles");return ze.setJSON(v,j),j})}}},[n,a]),w=l.useCallback(m=>n.includes(m),[n]);return{ownedTitles:n,currentTitle:o,titlesSyncReady:a,handleTitlePurchase:y,handleTitleEquip:b,handleTitleUnequip:S,addSpecialTitle:C,hasTitle:w,setOwnedTitles:r,setCurrentTitle:i}}function hh(e){if(!e||typeof e!="string")return{hasPersonalInfo:!1,detectedTypes:[]};const t=[],n=e.replace(/\s/g,"");return/(01[0-9])[-.\s]?(\d{3,4})[-.\s]?(\d{4})/g.test(e)&&t.push("phone"),/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g.test(e)&&t.push("email"),/(서울|부산|대구|인천|광주|대전|울산|세종|경기|강원|충북|충남|전북|전남|경북|경남|제주).*(시|도|군|구|동|로|길|번지)/g.test(e)&&t.push("address"),/\d{6}[-.\s]?\d{7}/g.test(n)&&t.push("ssn"),/(\d{3,4})[-.\s]?(\d{4,6})[-.\s]?(\d{4,8})/g.test(n)&&n.length>10&&t.push("account"),{hasPersonalInfo:t.length>0,detectedTypes:t}}function mh(e){const t={phone:"전화번호",email:"이메일",address:"주소",ssn:"주민등록번호",account:"계좌번호"};return`개인정보(${e.map(r=>t[r]||r).join(", ")})가 포함되어 있습니다. 개인정보는 공개하지 마세요.`}async function ph(e){const{toUserUid:t,fromUserUid:n,type:r,categoryId:o,data:i}=e;if(t&&t!==n)try{const a=Oe(he,"user_notifications",t,"items");await mr(a,{fromUserUid:n,type:r,categoryId:o??null,data:i,read:!1,timestamp:Date.now()})}catch(a){throw a}}const Mn=md(),fr={getItem:e=>{try{return localStorage.getItem(e)}catch{return null}},setItem:(e,t)=>{try{localStorage.setItem(e,t)}catch{}},removeItem:e=>{try{localStorage.removeItem(e)}catch{}}},ps="guestId";function ha(e){let t;if(e.createdAt instanceof Date)t=e.createdAt;else if(e.createdAt&&typeof e.createdAt.toDate=="function")t=e.createdAt.toDate();else if(typeof e.createdAt=="string"||typeof e.createdAt=="number"){const n=new Date(e.createdAt);t=Number.isNaN(n.getTime())?new Date:n}else t=new Date;return{id:e.id??Date.now(),content:e.content??"",author:e.author??"알 수 없음",authorUid:e.authorUid??null,authorAvatar:e.authorAvatar||null,timeAgo:e.timeAgo??"",lanterns:typeof e.lanterns=="number"?e.lanterns:0,isGuide:!!e.isGuide,createdAt:t,authorTitleId:e.authorTitleId??null,moderationStatus:e.moderationStatus??"approved",clientIp:e.clientIp??null,guestId:e.guestId??null}}const ma=10*1e3,pa="lastReplySubmitTime";function gh({posts:e,setPosts:t,selectedPost:n,setSelectedPost:r,userNickname:o,clampedTrust:i,updateActivity:a,userProfileImage:c,isGuest:u}){const[d,f]=l.useState(""),x=l.useRef(null),[y,b]=l.useState(void 0),[S,C]=l.useState(void 0),[w,m]=l.useState(new Set),[p,g]=l.useState(new Set);l.useEffect(()=>{(async()=>{try{const O=await(await fetch("https://api.ipify.org?format=json")).json();b(O.ip)}catch{}})()},[]),l.useEffect(()=>{if(u){let E=fr.getItem(ps);E||(E=`게스트${Math.floor(Math.random()*1e4).toString().padStart(4,"0")}`,fr.setItem(ps,E)),C(E)}else C(void 0),fr.removeItem(ps)},[u]),l.useEffect(()=>{(async()=>{try{const L=await et(Oe(Mn,"blockedIPs")),O=new Set;L.forEach(I=>O.add(I.id)),m(O)}catch{}})()},[]),l.useEffect(()=>{u&&(async()=>{try{const L=await et(Oe(Mn,"suspendedGuestIds")),O=new Set;L.forEach(I=>O.add(I.id)),g(O)}catch{}})()},[u]);const h=l.useCallback(E=>{f(E.target.value)},[]),k=l.useCallback(E=>{E&&(f(L=>{if(!L)return`@${E} `;const O=!L.endsWith(" ");return`${L}${O?" ":""}@${E} `}),x.current&&x.current.focus())},[]),j=l.useCallback(async()=>{if(!n||!d.trim())return;if(y&&w.has(y)){H.error("서비스 이용이 제한되었습니다. 관리자에게 문의하세요.");return}if(u&&S&&p.has(S)){H.error("게스트 계정이 정지되었습니다. 관리자에게 문의하세요.");return}const E=fr.getItem(pa);if(E)try{const A=parseInt(E,10),$=Date.now()-A;if($<ma){const K=Math.ceil((ma-$)/1e3);H.error(`댓글 작성 쿨타임이 남아있습니다. ${K}초 후 다시 시도해주세요.`);return}}catch{}if(!u&&i<=0){H.error("신뢰도 0점에서는 답글을 작성할 수 없습니다.");return}if(!u&&i<=20){H.error("신뢰도가 너무 낮아 답글을 작성할 수 없습니다. (최소 20점 필요)");return}if(Ls(d)){H.error("부적절한 표현이 포함되어 있습니다.");return}const L=hh(d);if(L.hasPersonalInfo){H.error(mh(L.detectedTypes));return}const O=ge.currentUser?.uid;if(!u&&!O){H.error("로그인이 필요합니다.");return}let I=null;if(O)try{const A=je(Mn,"users",O),T=await Ft(A);T.exists()&&(I=T.data().currentTitle??null)}catch{}const P=Date.now(),_={id:P,content:d.trim(),author:o,authorUid:O??null,authorAvatar:c??null,timeAgo:"방금",lanterns:0,isGuide:!1,createdAt:new Date,authorTitleId:I,...u&&{moderationStatus:"pending",guestId:S},clientIp:y},M=[...n.replies||[],_],z=M.map(ha),F={replies:M,replyCount:M.length,comments:M.length},Z=e.map(A=>String(A.id)===String(n.id)?{...A,...F}:A);t(Z),r({...n,...F}),f(""),fr.setItem(pa,Date.now().toString()),H.success("답글이 작성되었습니다!"),u||a({replies:1});try{const A=typeof n.id=="string"?n.id:String(n.id);await st(je(Mn,"posts",A),{replies:z,replyCount:xo(1),comments:M.length,lastReplyAt:new Date,lastReplyAuthor:o,lastReplyAuthorUid:O??null,lastReplyProfileImage:c??null}),O&&await st(je(Mn,"users",O),{replyCount:xo(1)})}catch{}if(O)try{const A=n.authorUid??null;!u&&A&&A!==O&&A.trim()!==""&&await ph({toUserUid:A,fromUserUid:O,type:"reply",categoryId:n.categoryId??n.category??null,data:{postId:n.id,replyId:P,userId:O??null,userName:o,userAvatar:c??null}})}catch{}},[n,d,o,e,i,t,r,a,c,u,y,w,S,p]),v=l.useCallback(async E=>{if(!n)return;const L=n.replies?.find(_=>_.id===E);if(!L||L.authorUid!==ge.currentUser?.uid){H.error("본인의 답글만 삭제할 수 있습니다.");return}const O=n.replies.filter(_=>_.id!==E),I=O.map(ha),P={replies:O,replyCount:O.length,comments:O.length};t(e.map(_=>String(_.id)===String(n.id)?{..._,...P}:_)),r({...n,...P}),H.success("답글이 삭제되었습니다.");try{const _=typeof n.id=="string"?n.id:String(n.id);await st(je(Mn,"posts",_),{replies:I,replyCount:I.length,comments:I.length})}catch{}},[n,e,t,r]),R=l.useCallback((E,L)=>E?E.replace(/\n{3,}/g,`

`).split(/\n\n/).map((P,_)=>{const M=[],z=/@([^\s@]+)/g;let F=0,Z;for(;(Z=z.exec(P))!==null;){const A=Z[0],T=Z[1],$=Z.index;$>F&&M.push(P.slice(F,$)),M.push(s.jsx("span",{"data-nickname":T,className:"text-primary font-semibold hover:underline cursor-pointer",onClick:()=>L(T),children:A},`mention-${_}-${$}-${T}`)),F=$+A.length}return F<P.length&&M.push(P.slice(F)),s.jsx("div",{className:"whitespace-pre-wrap",children:M},`paragraph-${_}`)}):null,[]),N=(i>0||u)&&y&&!w.has(y)&&(!u||S&&!p.has(S));return{newReplyContent:d,replyInputRef:x,handleReplyContentChange:h,handleInsertMention:k,handleReplySubmit:j,handleDeleteReply:v,renderContentWithMentions:R,canSubmitReply:N,setNewReplyContent:f}}const Bs={reply:{label:"새 답글",defaultPriority:"normal",icon:""},lantern:{label:"등불",defaultPriority:"normal",icon:""},guide:{label:"길잡이 채택",defaultPriority:"high",icon:""},popular:{label:"인기 글",defaultPriority:"normal",icon:""},follow:{label:"새 팔로워",defaultPriority:"normal",icon:"👤"},mention:{label:"멘션",defaultPriority:"normal",icon:"@"},achievement:{label:"업적",defaultPriority:"normal",icon:""},system:{label:"시스템",defaultPriority:"high",icon:""}},So={low:0,normal:1,high:2,urgent:3};function xh(e,t){const n=Bs[e]?.label??"알림",r=u=>{const d=(u??"").trim();return d?d==="탈퇴한 사용자"||d==="탈퇴한 사용자입니다"||d==="탈퇴한 사용자 입니다만"?"탈퇴한 사용자 입니다만":d:"누군가"},o=r(t?.userName),i=t?.lanternCount??1,a=r(t?.titleName),c=t?.lumenReward;switch(e){case"reply":return{title:n,message:`${o}님이 회원님의 글에 답글을 남겼습니다.`};case"lantern":return{title:n,message:i>1?`${o}님 외 ${i-1}명이 등불을 밝혔습니다.`:`${o}님이 등불을 밝혔습니다.`};case"guide":return{title:n,message:c&&a?`${a}님의 답글이 길잡이로 채택되었습니다. (+${c} 루멘)`:`${o}님의 답글이 길잡이로 채택되었습니다.`};case"popular":return{title:n,message:"작성하신 글이 인기 글이 되었습니다."};case"follow":return{title:n,message:`${o}님이 회원님을 승선했습니다.`};case"mention":return{title:n,message:`${o}님이 회원님을 멘션했습니다.`};case"achievement":return{title:n,message:"새 업적을 달성했습니다."};case"system":return{title:n,message:"시스템 알림이 도착했습니다."};default:return{title:"알림",message:"새 알림이 도착했습니다."}}}function Kr(e){if(!e)return null;const t=/^(\d{1,2}):(\d{2})$/.exec(e.trim());if(!t)return null;const n=Number(t[1]),r=Number(t[2]);return Number.isNaN(n)||Number.isNaN(r)?null:n*60+r}function yh(e,t=new Date){if(!e)return!1;let n=!1,r=null,o=null;if(e.doNotDisturb){const a=e.doNotDisturb;n=!!a.enabled,typeof a.start=="string"&&typeof a.end=="string"&&(r=Kr(a.start),o=Kr(a.end)),(r==null||o==null)&&typeof a.startHour=="number"&&typeof a.endHour=="number"&&(r=a.startHour*60,o=a.endHour*60)}if((!n||r==null||o==null)&&e.dndEnabled&&typeof e.dndStart=="string"&&typeof e.dndEnd=="string"&&(n=!0,r=Kr(e.dndStart),o=Kr(e.dndEnd)),!n||r==null||o==null)return!1;const i=t.getHours()*60+t.getMinutes();return r===o?!1:r<o?i>=r&&i<o:i>=r||i<o}function ga(e,t){return t?e.filter(n=>{if(t.type&&t.type!=="all"&&n.type!==t.type||t.types&&t.types.length>0&&!t.types.includes(n.type)||t.onlyUnread&&n.read||typeof t.read=="boolean"&&n.read!==t.read)return!1;if(t.minPriority){const r=So[t.minPriority]??0;if((So[n.priority]??0)<r)return!1}return!0}):e}function vh(e){return e.reduce((t,n)=>n.read?t:t+1,0)}function wh(e){const t={};for(const n of e){const r=n.groupId??(n.data&&n.data.postId?`${n.type}:${String(n.data.postId)}`:n.id);t[r]||(t[r]=[]),t[r].push(n)}return t}function bh(e){return[...e].sort((t,n)=>{const r=So[t.priority]??0,o=So[n.priority]??0;return r!==o?o-r:n.timestamp-t.timestamp})}const xa="notifications",ya="notificationSettings_v2",hr={enabled:!0,sound:!0,vibration:!0,types:{lantern:!0,reply:!0,guide:!0,mention:!0,follow:!0,system:!0,achievement:!0},pushEnabled:!1,inAppEnabled:!0,doNotDisturb:{enabled:!1,start:"22:00",end:"08:00"}},dt=()=>ge.currentUser?.uid??null,Ch=e=>Oe(he,"user_notifications",e,"items"),gs=(e,t)=>je(he,"user_notifications",e,"items",t),xs=e=>je(he,"user_notification_settings",e);function Sh(e={}){const{maxNotifications:t=100,autoDeleteAfterDays:n=30}=e,[r,o]=l.useState([]),[i,a]=l.useState(hr),[c,u]=l.useState(!0),d=n*24*60*60*1e3,f=l.useCallback(I=>{try{localStorage.setItem(xa,JSON.stringify(I))}catch{}},[]),x=l.useCallback(I=>{try{localStorage.setItem(ya,JSON.stringify(I))}catch{}},[]);l.useEffect(()=>{const I=dt();if(!I){try{const Z=localStorage.getItem(xa);if(Z){const T=JSON.parse(Z),$=Date.now()-d,K=T.filter(V=>V.timestamp>$);o(K.slice(0,t))}const A=localStorage.getItem(ya);A&&a(JSON.parse(A))}catch{}finally{u(!1)}return}u(!0);const P=3e4;let _=null,M=!0;const z=async()=>{if(M)try{const Z=Et(Ch(I),gl("timestamp","desc"),ri(t)),A=await et(Z),T=Date.now(),$=T-d,K=A.docs.map(V=>{const q=V.data(),se=typeof q.timestamp=="number"?q.timestamp:T,G=q.type,B=Bs[G];return{id:V.id,type:G,priority:q.priority??B.defaultPriority,title:q.title??"",message:q.message??"",timestamp:se,read:!!q.read,data:q.data,action:q.action,groupId:q.groupId}}).filter(V=>V.timestamp>$);M&&(o(K),u(!1))}catch{M&&u(!1)}},F=async()=>{if(M)try{const Z=await Ft(xs(I));if(Z.exists()){const A=Z.data();M&&a({...hr,...A,types:{...hr.types,...A.types??{}},doNotDisturb:{...hr.doNotDisturb,...A.doNotDisturb??{}}})}else M&&a(hr)}catch{}};return z(),F(),_=setInterval(()=>{z(),F()},P),()=>{M=!1,_&&(clearInterval(_),_=null)}},[t,d]);const y=l.useCallback(async I=>{const P=dt();if(!P){H.error("로그인 후 알림 설정 동기화가 가능합니다.");return}try{await Vn(xs(P),I,{merge:!0})}catch{}},[]),b=l.useCallback(async I=>{const P=dt();if(P)try{await Vn(gs(P,I.id),I,{merge:!0})}catch{}},[]),S=l.useCallback(async I=>{const P=dt();if(P)try{await st(gs(P,I),{read:!0})}catch{}},[]),C=l.useCallback(async I=>{const P=dt();if(P)try{await oi(gs(P,I))}catch{}},[]),w=l.useCallback(async()=>{const I=dt();if(I)try{await Ft(xs(I))}catch{}},[]),m=l.useCallback((I,P,_)=>{if(!i.enabled||!i.types[I]||yh(i))return null;const{title:M,message:z}=xh(I,P),F=Bs[I],Z=Date.now(),A={id:Z.toString()+Math.random().toString(36).substr(2,9),type:I,priority:_?.priority||F.defaultPriority,title:M,message:z,timestamp:Z,read:!1,data:P,action:_?.action,groupId:_?.groupId};return o(T=>{const $=[A,...T].slice(0,t);return dt()?b(A):f($),$}),i.inAppEnabled&&typeof window<"u"&&window.dispatchEvent(new CustomEvent("showInAppNotification",{detail:A})),i.pushEnabled&&typeof window<"u"&&"Notification"in window&&Notification.permission==="granted"&&kh(A,i),A},[i,t,f,b]),p=l.useCallback(I=>{o(P=>{const _=P.map(z=>z.id===I?{...z,read:!0}:z);return dt()?S(I):f(_),_})},[f,S]),g=l.useCallback(()=>{o(I=>{const P=I.filter(z=>!z.read),_=I.map(z=>({...z,read:!0}));return dt()?P.forEach(z=>{S(z.id)}):f(_),_})},[f,S]),h=l.useCallback(I=>{o(P=>{const _=P.filter(z=>z.id!==I);return dt()?C(I):f(_),_})},[f,C]),k=l.useCallback(()=>{o([]),dt()?w():f([])},[f,w]),j=l.useCallback(I=>{o(P=>{const _=P.filter(z=>z.type!==I);return dt()||f(_),_})},[f]),v=l.useCallback(I=>{a(P=>{const _={...P,...I,types:{...P.types,...I.types??{}},doNotDisturb:{...P.doNotDisturb,...I.doNotDisturb??{}}};return dt()?y(_):x(_),_})},[x,y]),R=l.useMemo(()=>vh(r),[r]),N=l.useMemo(()=>wh(r),[r]),E=l.useCallback(I=>ga(r,{type:I}),[r]),L=l.useMemo(()=>ga(r,{read:!1}),[r]);return{notifications:l.useMemo(()=>bh(r),[r]),groupedNotifications:N,unreadNotifications:L,unreadCount:R,settings:i,isLoading:c,addNotification:m,markAsRead:p,markAllAsRead:g,removeNotification:h,clearAll:k,clearByType:j,updateSettings:v,getNotificationsByType:E}}function kh(e,t){if(typeof window>"u"||!("Notification"in window))return;const n={body:e.message,icon:"/icon-192.png",badge:"/badge-72.png",tag:e.groupId||e.id,requireInteraction:e.priority==="urgent",silent:!t.sound,data:{notificationId:e.id,type:e.type,...e.data}};e.data?.userAvatar&&(n.icon=e.data.userAvatar);const r=new Notification(e.title,n);r.onclick=()=>{window.focus(),e.action?.url?window.location.href=e.action.url:e.action?.onClick&&e.action.onClick(),r.close()},e.priority!=="urgent"&&setTimeout(()=>{r.close()},5e3)}function Th({posts:e,onPostSelect:t}){const[n,r]=l.useState(!1),{notifications:o,markAsRead:i,markAllAsRead:a,removeNotification:c,clearAll:u}=Sh({maxNotifications:50,autoDeleteAfterDays:30}),d=J.useMemo(()=>o.filter(w=>!w.read).slice(0,30).map(w=>{const m=w.data?.postId,p=typeof m=="string"||typeof m=="number"?m:void 0;let g;if(p!==void 0){const h=e.find(k=>String(k.id)===String(p));h&&(g=h.title)}return{id:w.id,type:w.type,message:w.message,postId:p,postTitle:g,time:new Date(w.timestamp).toLocaleString("ko-KR"),isRead:w.read}}),[o,e]),f=d.length>0,x=l.useCallback(w=>{if(i(w.id),r(!1),w.postId!=null){const m=e.find(p=>String(p.id)===String(w.postId));if(m){t(m);return}}},[i,e,t]),y=l.useCallback(()=>{d.length&&(a(),H.success("모든 알림을 읽음으로 표시했습니다"))},[a,d.length]),b=l.useCallback(w=>{c(w)},[c]),S=l.useCallback(()=>{d.length&&(u(),H.success("모든 알림을 삭제했습니다"))},[u,d.length]),C=l.useCallback(w=>{r(m=>w!==void 0?w:!m)},[]);return{notifications:d,hasNotifications:f,showNotifications:n,handleNotificationClick:x,handleMarkAllNotificationsRead:y,removeNotification:b,clearAllNotifications:S,toggleNotifications:C,setShowNotifications:r}}function jh({posts:e,setPosts:t,userNickname:n,userProfileImage:r,clampedTrust:o,updateActivity:i}){const[a,c]=l.useState(!1),[u,d]=l.useState(!1),f=l.useCallback(m=>o<=0?(H.error("신뢰도 0점에서는 글을 작성할 수 없습니다."),!1):o<=10?(H.error("신뢰도가 너무 낮아 글을 작성할 수 없습니다. (최소 10점 필요)"),!1):u||localStorage.getItem("hidePostWarning")==="true"?(m(),!0):(c(!0),!0),[o,u]),x=l.useCallback(m=>{if(u&&localStorage.setItem("hidePostWarning","true"),c(!1),o<=0){H.error("신뢰도 0점에서는 글을 작성할 수 없습니다.");return}if(o<=10){H.error("신뢰도가 너무 낮아 글을 작성할 수 없습니다. (최소 10점 필요)");return}m()},[u,o]),y=l.useCallback(async m=>{if(o<=0)return H.error("신뢰도 0점에서는 글을 작성할 수 없습니다."),null;if(o<=10)return H.error("신뢰도가 너무 낮아 글을 작성할 수 없습니다. (최소 10점 필요)"),null;if(Ls(m.title)||Ls(m.content))return H.error("부적절한 표현이 포함되어 있습니다."),null;const p=ge.currentUser?.uid??null,g={...m,author:n,authorUid:p,authorAvatar:r,createdAt:new Date,hidden:!1,lanterns:0,replies:[],replyCount:0,comments:0,views:0,isBookmarked:!1,isOwner:!0};try{const k={id:(await mr(Oe(he,"posts"),{...g,createdAt:Zt()})).id,...g,createdAt:new Date};if(t(j=>[k,...j]),p)try{await st(je(he,"users",p),{postCount:xo(1)})}catch{}return m.type==="question"?i({explorePosts:1}):i({sharePosts:1}),H.success("게시글이 작성되었습니다!"),k}catch{return H.error("게시글 작성에 실패했습니다."),null}},[n,r,o,t,i]),b=l.useCallback(async m=>{const p=String(m),g=e.find(j=>String(j.id)===p);if(!g||g.author!==n)return H.error("본인의 글만 삭제할 수 있습니다."),!1;const h=g.createdAt instanceof Date?g.createdAt:new Date(g.createdAt),k=new Date(Date.now()-1800*1e3);if(h<k)return H.error("작성 후 30분이 지난 글은 삭제할 수 없습니다."),!1;try{return typeof g.id=="string"&&await oi(je(he,"posts",g.id)),t(j=>j.filter(v=>String(v.id)!==p)),H.success("게시글이 삭제되었습니다."),!0}catch{return H.error("게시글 삭제에 실패했습니다."),!1}},[e,n,t]),S=l.useCallback(async m=>{const p=ge.currentUser?.uid;if(!p)return;const g=String(m),h=e.find(v=>String(v.id)===g);if(!h||typeof h.id!="string")return;const k=je(he,"posts",h.id),j=je(he,"postViews",`${h.id}_${p}`);try{await yl(he,async R=>(await R.get(j)).exists()?!1:(R.set(j,{postId:h.id,viewerUid:p,viewedAt:Zt()}),R.update(k,{views:xo(1)}),!0))&&t(R=>R.map(N=>String(N.id)===g?{...N,views:(N.views||0)+1}:N))}catch{}},[e,t]),C=l.useCallback(m=>{const p=String(m),g=e.find(j=>String(j.id)===p);if(!g||g.author!==n)return!1;const h=g.createdAt instanceof Date?g.createdAt:new Date(g.createdAt),k=new Date(Date.now()-1800*1e3);return h>=k},[e,n]);return{showPostWarning:a,setShowPostWarning:c,dontShowWarningAgain:u,setDontShowWarningAgain:d,handleStartWriting:f,handleWarningConfirm:x,createPost:y,deletePost:b,incrementViews:S,canDeletePost:C,checkboxConfig:{checked:u,onCheckedChange:d,label:"다시 보지 않기"}}}function Rh({addLumens:e}){const[t,n]=l.useState(30);l.useEffect(()=>{const u=ze.getNumber("trustScore",30);n(u)},[]),l.useEffect(()=>{const u=ge.currentUser?.uid;if(!u)return;(async()=>{try{const f=await Vl(u);n(f.trustScore),ze.setItem("trustScore",String(f.trustScore))}catch{}})()},[]);const r=l.useMemo(()=>Math.max(0,Math.min(100,t)),[t]),o=l.useMemo(()=>r<=10?.5:1,[r]),i=r>0,a=l.useCallback(u=>{},[]),c=l.useCallback(async(u,d,f)=>{if(r<=0)return;const x=Math.floor(u*o);x<=0||await e(x,d??"",f)},[e,r,o]);return{trustScore:t,clampedTrust:r,lumenMultiplier:o,updateTrust:a,addLumensWithTrust:c,canWrite:i}}function Ah({posts:e,userNickname:t}){const[n,r]=l.useState(0),[o,i]=l.useState(0),[a,c]=l.useState(0),[u,d]=l.useState("");l.useEffect(()=>{const m=ge.currentUser?.uid;if(!m)return;const p=je(he,"users",m),g=go(p,h=>{if(!h.exists())return;const k=h.data();typeof k.guideCount=="number"&&c(k.guideCount),typeof k.postLanternsReceived=="number"&&r(k.postLanternsReceived),typeof k.replyLanternsReceived=="number"&&i(k.replyLanternsReceived),typeof k.profileInterests=="string"&&d(k.profileInterests)},h=>{});return()=>g()},[]);const f=l.useCallback(async m=>{d(m);const p=ge.currentUser?.uid;if(p)try{await st(je(he,"users",p),{profileInterests:m})}catch{}},[]),{weeklyGuideRanking:x,totalGuideRanking:y,weeklyLanternRanking:b}=l.useMemo(()=>{const m={},p={},g={},h=new Date;h.setDate(h.getDate()-7);const k=h.getTime();return e.forEach(j=>{const R=(j.createdAt instanceof Date?j.createdAt:new Date(j.createdAt)).getTime(),N=R>=k;if(N&&j.lanterns>0&&j.author){const E=j.authorUid||j.author;g[E]={author:j.author,authorUid:j.authorUid||null,count:(g[E]?.count??0)+j.lanterns}}Array.isArray(j.replies)&&j.replies.forEach(E=>{if(E.isAi)return;const L=E.author;if(!L)return;const O=typeof E.authorUid=="string"?E.authorUid:null,I=O||L;E.isGuide&&(p[I]={author:L,authorUid:O,count:(p[I]?.count??0)+1},N&&(m[I]={author:L,authorUid:O,count:(m[I]?.count??0)+1}));const P=typeof E.lanterns=="number"?E.lanterns:0;if(P>0){const _=E.createdAt instanceof Date?E.createdAt:null;(_?_.getTime():R)>=k&&(g[I]={author:L,authorUid:O,count:(g[I]?.count??0)+P})}})}),{weeklyGuideRanking:m,totalGuideRanking:p,weeklyLanternRanking:g}},[e]),S=l.useMemo(()=>e.filter(m=>m.author===t),[e,t]),C=l.useMemo(()=>e.flatMap(m=>(m.replies||[]).filter(p=>p.author===t).map(p=>({...p,postTitle:m.title,postAuthor:m.author,postId:m.id}))),[e,t]),w=l.useMemo(()=>Object.values(x).sort((m,p)=>p.count-m.count).slice(0,10).map((m,p)=>({rank:p+1,nickname:m.author,guideCount:m.count,uid:m.authorUid})),[x]);return{userPostLanterns:n,userReplyLanterns:o,userGuideCount:a,profileInterests:u,handleProfileInterestsChange:f,weeklyGuideRanking:x,totalGuideRanking:y,weeklyLanternRanking:b,userPosts:S,userReplies:C,topGuideUsers:w}}function Nh({viewedNickname:e,currentUserNickname:t}){const[n,r]=l.useState(null);return l.useEffect(()=>{if(!e||e===t){r(null);return}let o=!1;return(async()=>{try{r(w=>w?{...w,loading:!0}:{followerCount:0,followingCount:0,followerUsers:[],followingUsers:[],loading:!0});const a=Oe(he,"users"),c=Et(a,Ht("nickname","==",e)),u=await et(c);if(o)return;if(u.empty){r({followerCount:0,followingCount:0,followerUsers:[],followingUsers:[],loading:!1});return}const d=u.docs[0],x=d.data().uid??d.id,y=await ch(x);if(o)return;const b=y.followerCount??0,S=y.followingNicknames??[],C=await ql(x);if(o)return;r({followerCount:b,followingCount:S.length,followerUsers:Array.isArray(C)?C:[],followingUsers:S,loading:!1})}catch{o||r({followerCount:0,followingCount:0,followerUsers:[],followingUsers:[],loading:!1})}})(),()=>{o=!0}},[e,t]),n}function Eh({threshold:e=.1,rootMargin:t="50px",enabled:n=!0}={}){const r=l.useRef(null),[o,i]=l.useState(!1),[a,c]=l.useState(!1);return l.useEffect(()=>{if(!n)return;const u=r.current;if(!u)return;const d=new IntersectionObserver(f=>{f.forEach(x=>{i(x.isIntersecting),x.isIntersecting&&!a&&c(!0)})},{threshold:e,rootMargin:t});return d.observe(u),()=>{d.unobserve(u),d.disconnect()}},[e,t,n,a]),{targetRef:r,isIntersecting:o,hasIntersected:a}}function Ih(e,t){if(!e||typeof e!="string")return"";try{const n=new URL(e);return t&&n.searchParams.set("v",String(t)),n.toString()}catch{return e}}function Ph(e,t){return t==="eager"?"high":e&&e>=80?"normal":"low"}function _h(e){return e==="high"?"high":e==="low"?"low":"auto"}function hi({src:e,alt:t,fallbackText:n,nickname:r,className:o="",imageClassName:i="",size:a,loading:c="lazy",decoding:u="async",onClick:d,rootMargin:f="50px",threshold:x=.01,cacheVersion:y}){const b=l.useMemo(()=>(globalThis.__AVATAR_LOADED_CACHE__||(globalThis.__AVATAR_LOADED_CACHE__=new Set),globalThis.__AVATAR_LOADED_CACHE__),[]),[S,C]=l.useState(!1),[w,m]=l.useState(c==="eager"),p=l.useMemo(()=>`https://api.dicebear.com/7.x/notionists/svg?seed=${encodeURIComponent(r||n||"user")}&backgroundColor=transparent`,[r,n]),g=l.useMemo(()=>{if(typeof e=="string"){const O=e.trim();if(O.length>0)return Ih(O,y)}return p},[e,y,p]),{targetRef:h,isIntersecting:k}=Eh({threshold:x,rootMargin:f,enabled:c==="lazy"&&!w}),j=l.useMemo(()=>Ph(a,c),[a,c]),v=l.useMemo(()=>_h(j),[j]);l.useEffect(()=>{const O=g?b.has(g):!1;C(O),c==="eager"||O?m(!0):g&&m(!1)},[g,c,b]),l.useEffect(()=>{w||c==="eager"||k&&m(!0)},[k,c,w]),l.useEffect(()=>{if(w||c==="eager"||!g)return;const O=setTimeout(()=>m(!0),600);return()=>clearTimeout(O)},[w,c,g]);const R=!!g&&w,N="w-full h-full object-cover",E=S?"lazy-image-loaded":"image-skeleton",L=a?{width:a,height:a,minWidth:a,minHeight:a}:void 0;return s.jsxs(Cd,{ref:c==="lazy"?h:void 0,className:o,style:L,onClick:d,children:[R&&s.jsx(Sd,{src:g,alt:t,loading:c,decoding:u,...v&&{fetchpriority:v},onLoad:()=>{g&&b.add(g),C(!0)},onError:()=>C(!0),className:`${N} ${i} ${E}`,sizes:a?`${a}px`:void 0}),s.jsx(kd,{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 text-white text-xl flex items-center justify-center rounded-full",children:n||"?"})]})}const Gl=l.forwardRef(({className:e,...t},n)=>s.jsx("textarea",{ref:n,"data-slot":"textarea",className:Qt("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...t}));Gl.displayName="Textarea";function Lh(e,t=globalThis?.document){const n=ht(e);l.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return t.addEventListener("keydown",r,{capture:!0}),()=>t.removeEventListener("keydown",r,{capture:!0})},[n,t])}var Mh="DismissableLayer",Fs="dismissableLayer.update",Dh="dismissableLayer.pointerDownOutside",Oh="dismissableLayer.focusOutside",va,Yl=l.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),mi=l.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:i,onInteractOutside:a,onDismiss:c,...u}=e,d=l.useContext(Yl),[f,x]=l.useState(null),y=f?.ownerDocument??globalThis?.document,[,b]=l.useState({}),S=tt(t,v=>x(v)),C=Array.from(d.layers),[w]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),m=C.indexOf(w),p=f?C.indexOf(f):-1,g=d.layersWithOutsidePointerEventsDisabled.size>0,h=p>=m,k=Bh(v=>{const R=v.target,N=[...d.branches].some(E=>E.contains(R));!h||N||(o?.(v),a?.(v),v.defaultPrevented||c?.())},y),j=Fh(v=>{const R=v.target;[...d.branches].some(E=>E.contains(R))||(i?.(v),a?.(v),v.defaultPrevented||c?.())},y);return Lh(v=>{p===d.layers.size-1&&(r?.(v),!v.defaultPrevented&&c&&(v.preventDefault(),c()))},y),l.useEffect(()=>{if(f)return n&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(va=y.body.style.pointerEvents,y.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(f)),d.layers.add(f),wa(),()=>{n&&d.layersWithOutsidePointerEventsDisabled.size===1&&(y.body.style.pointerEvents=va)}},[f,y,n,d]),l.useEffect(()=>()=>{f&&(d.layers.delete(f),d.layersWithOutsidePointerEventsDisabled.delete(f),wa())},[f,d]),l.useEffect(()=>{const v=()=>b({});return document.addEventListener(Fs,v),()=>document.removeEventListener(Fs,v)},[]),s.jsx(Ze.div,{...u,ref:S,style:{pointerEvents:g?h?"auto":"none":void 0,...e.style},onFocusCapture:Me(e.onFocusCapture,j.onFocusCapture),onBlurCapture:Me(e.onBlurCapture,j.onBlurCapture),onPointerDownCapture:Me(e.onPointerDownCapture,k.onPointerDownCapture)})});mi.displayName=Mh;var zh="DismissableLayerBranch",Uh=l.forwardRef((e,t)=>{const n=l.useContext(Yl),r=l.useRef(null),o=tt(t,r);return l.useEffect(()=>{const i=r.current;if(i)return n.branches.add(i),()=>{n.branches.delete(i)}},[n.branches]),s.jsx(Ze.div,{...e,ref:o})});Uh.displayName=zh;function Bh(e,t=globalThis?.document){const n=ht(e),r=l.useRef(!1),o=l.useRef(()=>{});return l.useEffect(()=>{const i=c=>{if(c.target&&!r.current){let u=function(){Xl(Dh,n,d,{discrete:!0})};const d={originalEvent:c};c.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=u,t.addEventListener("click",o.current,{once:!0})):u()}else t.removeEventListener("click",o.current);r.current=!1},a=window.setTimeout(()=>{t.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(a),t.removeEventListener("pointerdown",i),t.removeEventListener("click",o.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function Fh(e,t=globalThis?.document){const n=ht(e),r=l.useRef(!1);return l.useEffect(()=>{const o=i=>{i.target&&!r.current&&Xl(Oh,n,{originalEvent:i},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function wa(){const e=new CustomEvent(Fs);document.dispatchEvent(e)}function Xl(e,t,n,{discrete:r}){const o=n.originalEvent.target,i=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),r?wd(o,i):o.dispatchEvent(i)}var Hh=hd[" useId ".trim().toString()]||(()=>{}),$h=0;function Zl(e){const[t,n]=l.useState(Hh());return xr(()=>{n(r=>r??String($h++))},[e]),e||(t?`radix-${t}`:"")}const Wh=["top","right","bottom","left"],hn=Math.min,ft=Math.max,ko=Math.round,Qr=Math.floor,Bt=e=>({x:e,y:e}),Vh={left:"right",right:"left",bottom:"top",top:"bottom"},qh={start:"end",end:"start"};function Hs(e,t,n){return ft(e,hn(t,n))}function en(e,t){return typeof e=="function"?e(t):e}function tn(e){return e.split("-")[0]}function Zn(e){return e.split("-")[1]}function pi(e){return e==="x"?"y":"x"}function gi(e){return e==="y"?"height":"width"}const Gh=new Set(["top","bottom"]);function zt(e){return Gh.has(tn(e))?"y":"x"}function xi(e){return pi(zt(e))}function Yh(e,t,n){n===void 0&&(n=!1);const r=Zn(e),o=xi(e),i=gi(o);let a=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(a=To(a)),[a,To(a)]}function Xh(e){const t=To(e);return[$s(e),t,$s(t)]}function $s(e){return e.replace(/start|end/g,t=>qh[t])}const ba=["left","right"],Ca=["right","left"],Zh=["top","bottom"],Kh=["bottom","top"];function Qh(e,t,n){switch(e){case"top":case"bottom":return n?t?Ca:ba:t?ba:Ca;case"left":case"right":return t?Zh:Kh;default:return[]}}function Jh(e,t,n,r){const o=Zn(e);let i=Qh(tn(e),n==="start",r);return o&&(i=i.map(a=>a+"-"+o),t&&(i=i.concat(i.map($s)))),i}function To(e){return e.replace(/left|right|bottom|top/g,t=>Vh[t])}function em(e){return{top:0,right:0,bottom:0,left:0,...e}}function Kl(e){return typeof e!="number"?em(e):{top:e,right:e,bottom:e,left:e}}function jo(e){const{x:t,y:n,width:r,height:o}=e;return{width:r,height:o,top:n,left:t,right:t+r,bottom:n+o,x:t,y:n}}function Sa(e,t,n){let{reference:r,floating:o}=e;const i=zt(t),a=xi(t),c=gi(a),u=tn(t),d=i==="y",f=r.x+r.width/2-o.width/2,x=r.y+r.height/2-o.height/2,y=r[c]/2-o[c]/2;let b;switch(u){case"top":b={x:f,y:r.y-o.height};break;case"bottom":b={x:f,y:r.y+r.height};break;case"right":b={x:r.x+r.width,y:x};break;case"left":b={x:r.x-o.width,y:x};break;default:b={x:r.x,y:r.y}}switch(Zn(t)){case"start":b[a]-=y*(n&&d?-1:1);break;case"end":b[a]+=y*(n&&d?-1:1);break}return b}const tm=async(e,t,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:i=[],platform:a}=n,c=i.filter(Boolean),u=await(a.isRTL==null?void 0:a.isRTL(t));let d=await a.getElementRects({reference:e,floating:t,strategy:o}),{x:f,y:x}=Sa(d,r,u),y=r,b={},S=0;for(let C=0;C<c.length;C++){const{name:w,fn:m}=c[C],{x:p,y:g,data:h,reset:k}=await m({x:f,y:x,initialPlacement:r,placement:y,strategy:o,middlewareData:b,rects:d,platform:a,elements:{reference:e,floating:t}});f=p??f,x=g??x,b={...b,[w]:{...b[w],...h}},k&&S<=50&&(S++,typeof k=="object"&&(k.placement&&(y=k.placement),k.rects&&(d=k.rects===!0?await a.getElementRects({reference:e,floating:t,strategy:o}):k.rects),{x:f,y:x}=Sa(d,y,u)),C=-1)}return{x:f,y:x,placement:y,strategy:o,middlewareData:b}};async function vr(e,t){var n;t===void 0&&(t={});const{x:r,y:o,platform:i,rects:a,elements:c,strategy:u}=e,{boundary:d="clippingAncestors",rootBoundary:f="viewport",elementContext:x="floating",altBoundary:y=!1,padding:b=0}=en(t,e),S=Kl(b),w=c[y?x==="floating"?"reference":"floating":x],m=jo(await i.getClippingRect({element:(n=await(i.isElement==null?void 0:i.isElement(w)))==null||n?w:w.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(c.floating)),boundary:d,rootBoundary:f,strategy:u})),p=x==="floating"?{x:r,y:o,width:a.floating.width,height:a.floating.height}:a.reference,g=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c.floating)),h=await(i.isElement==null?void 0:i.isElement(g))?await(i.getScale==null?void 0:i.getScale(g))||{x:1,y:1}:{x:1,y:1},k=jo(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:p,offsetParent:g,strategy:u}):p);return{top:(m.top-k.top+S.top)/h.y,bottom:(k.bottom-m.bottom+S.bottom)/h.y,left:(m.left-k.left+S.left)/h.x,right:(k.right-m.right+S.right)/h.x}}const nm=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:o,rects:i,platform:a,elements:c,middlewareData:u}=t,{element:d,padding:f=0}=en(e,t)||{};if(d==null)return{};const x=Kl(f),y={x:n,y:r},b=xi(o),S=gi(b),C=await a.getDimensions(d),w=b==="y",m=w?"top":"left",p=w?"bottom":"right",g=w?"clientHeight":"clientWidth",h=i.reference[S]+i.reference[b]-y[b]-i.floating[S],k=y[b]-i.reference[b],j=await(a.getOffsetParent==null?void 0:a.getOffsetParent(d));let v=j?j[g]:0;(!v||!await(a.isElement==null?void 0:a.isElement(j)))&&(v=c.floating[g]||i.floating[S]);const R=h/2-k/2,N=v/2-C[S]/2-1,E=hn(x[m],N),L=hn(x[p],N),O=E,I=v-C[S]-L,P=v/2-C[S]/2+R,_=Hs(O,P,I),M=!u.arrow&&Zn(o)!=null&&P!==_&&i.reference[S]/2-(P<O?E:L)-C[S]/2<0,z=M?P<O?P-O:P-I:0;return{[b]:y[b]+z,data:{[b]:_,centerOffset:P-_-z,...M&&{alignmentOffset:z}},reset:M}}}),rm=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:o,middlewareData:i,rects:a,initialPlacement:c,platform:u,elements:d}=t,{mainAxis:f=!0,crossAxis:x=!0,fallbackPlacements:y,fallbackStrategy:b="bestFit",fallbackAxisSideDirection:S="none",flipAlignment:C=!0,...w}=en(e,t);if((n=i.arrow)!=null&&n.alignmentOffset)return{};const m=tn(o),p=zt(c),g=tn(c)===c,h=await(u.isRTL==null?void 0:u.isRTL(d.floating)),k=y||(g||!C?[To(c)]:Xh(c)),j=S!=="none";!y&&j&&k.push(...Jh(c,C,S,h));const v=[c,...k],R=await vr(t,w),N=[];let E=((r=i.flip)==null?void 0:r.overflows)||[];if(f&&N.push(R[m]),x){const P=Yh(o,a,h);N.push(R[P[0]],R[P[1]])}if(E=[...E,{placement:o,overflows:N}],!N.every(P=>P<=0)){var L,O;const P=(((L=i.flip)==null?void 0:L.index)||0)+1,_=v[P];if(_&&(!(x==="alignment"?p!==zt(_):!1)||E.every(F=>zt(F.placement)===p?F.overflows[0]>0:!0)))return{data:{index:P,overflows:E},reset:{placement:_}};let M=(O=E.filter(z=>z.overflows[0]<=0).sort((z,F)=>z.overflows[1]-F.overflows[1])[0])==null?void 0:O.placement;if(!M)switch(b){case"bestFit":{var I;const z=(I=E.filter(F=>{if(j){const Z=zt(F.placement);return Z===p||Z==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(Z=>Z>0).reduce((Z,A)=>Z+A,0)]).sort((F,Z)=>F[1]-Z[1])[0])==null?void 0:I[0];z&&(M=z);break}case"initialPlacement":M=c;break}if(o!==M)return{reset:{placement:M}}}return{}}}};function ka(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Ta(e){return Wh.some(t=>e[t]>=0)}const om=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...o}=en(e,t);switch(r){case"referenceHidden":{const i=await vr(t,{...o,elementContext:"reference"}),a=ka(i,n.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:Ta(a)}}}case"escaped":{const i=await vr(t,{...o,altBoundary:!0}),a=ka(i,n.floating);return{data:{escapedOffsets:a,escaped:Ta(a)}}}default:return{}}}}},Ql=new Set(["left","top"]);async function sm(e,t){const{placement:n,platform:r,elements:o}=e,i=await(r.isRTL==null?void 0:r.isRTL(o.floating)),a=tn(n),c=Zn(n),u=zt(n)==="y",d=Ql.has(a)?-1:1,f=i&&u?-1:1,x=en(t,e);let{mainAxis:y,crossAxis:b,alignmentAxis:S}=typeof x=="number"?{mainAxis:x,crossAxis:0,alignmentAxis:null}:{mainAxis:x.mainAxis||0,crossAxis:x.crossAxis||0,alignmentAxis:x.alignmentAxis};return c&&typeof S=="number"&&(b=c==="end"?S*-1:S),u?{x:b*f,y:y*d}:{x:y*d,y:b*f}}const im=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:o,y:i,placement:a,middlewareData:c}=t,u=await sm(t,e);return a===((n=c.offset)==null?void 0:n.placement)&&(r=c.arrow)!=null&&r.alignmentOffset?{}:{x:o+u.x,y:i+u.y,data:{...u,placement:a}}}}},am=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:o}=t,{mainAxis:i=!0,crossAxis:a=!1,limiter:c={fn:w=>{let{x:m,y:p}=w;return{x:m,y:p}}},...u}=en(e,t),d={x:n,y:r},f=await vr(t,u),x=zt(tn(o)),y=pi(x);let b=d[y],S=d[x];if(i){const w=y==="y"?"top":"left",m=y==="y"?"bottom":"right",p=b+f[w],g=b-f[m];b=Hs(p,b,g)}if(a){const w=x==="y"?"top":"left",m=x==="y"?"bottom":"right",p=S+f[w],g=S-f[m];S=Hs(p,S,g)}const C=c.fn({...t,[y]:b,[x]:S});return{...C,data:{x:C.x-n,y:C.y-r,enabled:{[y]:i,[x]:a}}}}}},lm=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:o,rects:i,middlewareData:a}=t,{offset:c=0,mainAxis:u=!0,crossAxis:d=!0}=en(e,t),f={x:n,y:r},x=zt(o),y=pi(x);let b=f[y],S=f[x];const C=en(c,t),w=typeof C=="number"?{mainAxis:C,crossAxis:0}:{mainAxis:0,crossAxis:0,...C};if(u){const g=y==="y"?"height":"width",h=i.reference[y]-i.floating[g]+w.mainAxis,k=i.reference[y]+i.reference[g]-w.mainAxis;b<h?b=h:b>k&&(b=k)}if(d){var m,p;const g=y==="y"?"width":"height",h=Ql.has(tn(o)),k=i.reference[x]-i.floating[g]+(h&&((m=a.offset)==null?void 0:m[x])||0)+(h?0:w.crossAxis),j=i.reference[x]+i.reference[g]+(h?0:((p=a.offset)==null?void 0:p[x])||0)-(h?w.crossAxis:0);S<k?S=k:S>j&&(S=j)}return{[y]:b,[x]:S}}}},cm=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,r;const{placement:o,rects:i,platform:a,elements:c}=t,{apply:u=()=>{},...d}=en(e,t),f=await vr(t,d),x=tn(o),y=Zn(o),b=zt(o)==="y",{width:S,height:C}=i.floating;let w,m;x==="top"||x==="bottom"?(w=x,m=y===(await(a.isRTL==null?void 0:a.isRTL(c.floating))?"start":"end")?"left":"right"):(m=x,w=y==="end"?"top":"bottom");const p=C-f.top-f.bottom,g=S-f.left-f.right,h=hn(C-f[w],p),k=hn(S-f[m],g),j=!t.middlewareData.shift;let v=h,R=k;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(R=g),(r=t.middlewareData.shift)!=null&&r.enabled.y&&(v=p),j&&!y){const E=ft(f.left,0),L=ft(f.right,0),O=ft(f.top,0),I=ft(f.bottom,0);b?R=S-2*(E!==0||L!==0?E+L:ft(f.left,f.right)):v=C-2*(O!==0||I!==0?O+I:ft(f.top,f.bottom))}await u({...t,availableWidth:R,availableHeight:v});const N=await a.getDimensions(c.floating);return S!==N.width||C!==N.height?{reset:{rects:!0}}:{}}}};function Do(){return typeof window<"u"}function Kn(e){return Jl(e)?(e.nodeName||"").toLowerCase():"#document"}function gt(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Vt(e){var t;return(t=(Jl(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function Jl(e){return Do()?e instanceof Node||e instanceof gt(e).Node:!1}function It(e){return Do()?e instanceof Element||e instanceof gt(e).Element:!1}function $t(e){return Do()?e instanceof HTMLElement||e instanceof gt(e).HTMLElement:!1}function ja(e){return!Do()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof gt(e).ShadowRoot}const um=new Set(["inline","contents"]);function Nr(e){const{overflow:t,overflowX:n,overflowY:r,display:o}=Pt(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!um.has(o)}const dm=new Set(["table","td","th"]);function fm(e){return dm.has(Kn(e))}const hm=[":popover-open",":modal"];function Oo(e){return hm.some(t=>{try{return e.matches(t)}catch{return!1}})}const mm=["transform","translate","scale","rotate","perspective"],pm=["transform","translate","scale","rotate","perspective","filter"],gm=["paint","layout","strict","content"];function yi(e){const t=vi(),n=It(e)?Pt(e):e;return mm.some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||pm.some(r=>(n.willChange||"").includes(r))||gm.some(r=>(n.contain||"").includes(r))}function xm(e){let t=mn(e);for(;$t(t)&&!Gn(t);){if(yi(t))return t;if(Oo(t))return null;t=mn(t)}return null}function vi(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const ym=new Set(["html","body","#document"]);function Gn(e){return ym.has(Kn(e))}function Pt(e){return gt(e).getComputedStyle(e)}function zo(e){return It(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function mn(e){if(Kn(e)==="html")return e;const t=e.assignedSlot||e.parentNode||ja(e)&&e.host||Vt(e);return ja(t)?t.host:t}function ec(e){const t=mn(e);return Gn(t)?e.ownerDocument?e.ownerDocument.body:e.body:$t(t)&&Nr(t)?t:ec(t)}function wr(e,t,n){var r;t===void 0&&(t=[]),n===void 0&&(n=!0);const o=ec(e),i=o===((r=e.ownerDocument)==null?void 0:r.body),a=gt(o);if(i){const c=Ws(a);return t.concat(a,a.visualViewport||[],Nr(o)?o:[],c&&n?wr(c):[])}return t.concat(o,wr(o,[],n))}function Ws(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function tc(e){const t=Pt(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const o=$t(e),i=o?e.offsetWidth:n,a=o?e.offsetHeight:r,c=ko(n)!==i||ko(r)!==a;return c&&(n=i,r=a),{width:n,height:r,$:c}}function wi(e){return It(e)?e:e.contextElement}function Fn(e){const t=wi(e);if(!$t(t))return Bt(1);const n=t.getBoundingClientRect(),{width:r,height:o,$:i}=tc(t);let a=(i?ko(n.width):n.width)/r,c=(i?ko(n.height):n.height)/o;return(!a||!Number.isFinite(a))&&(a=1),(!c||!Number.isFinite(c))&&(c=1),{x:a,y:c}}const vm=Bt(0);function nc(e){const t=gt(e);return!vi()||!t.visualViewport?vm:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function wm(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==gt(e)?!1:t}function jn(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);const o=e.getBoundingClientRect(),i=wi(e);let a=Bt(1);t&&(r?It(r)&&(a=Fn(r)):a=Fn(e));const c=wm(i,n,r)?nc(i):Bt(0);let u=(o.left+c.x)/a.x,d=(o.top+c.y)/a.y,f=o.width/a.x,x=o.height/a.y;if(i){const y=gt(i),b=r&&It(r)?gt(r):r;let S=y,C=Ws(S);for(;C&&r&&b!==S;){const w=Fn(C),m=C.getBoundingClientRect(),p=Pt(C),g=m.left+(C.clientLeft+parseFloat(p.paddingLeft))*w.x,h=m.top+(C.clientTop+parseFloat(p.paddingTop))*w.y;u*=w.x,d*=w.y,f*=w.x,x*=w.y,u+=g,d+=h,S=gt(C),C=Ws(S)}}return jo({width:f,height:x,x:u,y:d})}function Uo(e,t){const n=zo(e).scrollLeft;return t?t.left+n:jn(Vt(e)).left+n}function rc(e,t){const n=e.getBoundingClientRect(),r=n.left+t.scrollLeft-Uo(e,n),o=n.top+t.scrollTop;return{x:r,y:o}}function bm(e){let{elements:t,rect:n,offsetParent:r,strategy:o}=e;const i=o==="fixed",a=Vt(r),c=t?Oo(t.floating):!1;if(r===a||c&&i)return n;let u={scrollLeft:0,scrollTop:0},d=Bt(1);const f=Bt(0),x=$t(r);if((x||!x&&!i)&&((Kn(r)!=="body"||Nr(a))&&(u=zo(r)),$t(r))){const b=jn(r);d=Fn(r),f.x=b.x+r.clientLeft,f.y=b.y+r.clientTop}const y=a&&!x&&!i?rc(a,u):Bt(0);return{width:n.width*d.x,height:n.height*d.y,x:n.x*d.x-u.scrollLeft*d.x+f.x+y.x,y:n.y*d.y-u.scrollTop*d.y+f.y+y.y}}function Cm(e){return Array.from(e.getClientRects())}function Sm(e){const t=Vt(e),n=zo(e),r=e.ownerDocument.body,o=ft(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),i=ft(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let a=-n.scrollLeft+Uo(e);const c=-n.scrollTop;return Pt(r).direction==="rtl"&&(a+=ft(t.clientWidth,r.clientWidth)-o),{width:o,height:i,x:a,y:c}}const Ra=25;function km(e,t){const n=gt(e),r=Vt(e),o=n.visualViewport;let i=r.clientWidth,a=r.clientHeight,c=0,u=0;if(o){i=o.width,a=o.height;const f=vi();(!f||f&&t==="fixed")&&(c=o.offsetLeft,u=o.offsetTop)}const d=Uo(r);if(d<=0){const f=r.ownerDocument,x=f.body,y=getComputedStyle(x),b=f.compatMode==="CSS1Compat"&&parseFloat(y.marginLeft)+parseFloat(y.marginRight)||0,S=Math.abs(r.clientWidth-x.clientWidth-b);S<=Ra&&(i-=S)}else d<=Ra&&(i+=d);return{width:i,height:a,x:c,y:u}}const Tm=new Set(["absolute","fixed"]);function jm(e,t){const n=jn(e,!0,t==="fixed"),r=n.top+e.clientTop,o=n.left+e.clientLeft,i=$t(e)?Fn(e):Bt(1),a=e.clientWidth*i.x,c=e.clientHeight*i.y,u=o*i.x,d=r*i.y;return{width:a,height:c,x:u,y:d}}function Aa(e,t,n){let r;if(t==="viewport")r=km(e,n);else if(t==="document")r=Sm(Vt(e));else if(It(t))r=jm(t,n);else{const o=nc(e);r={x:t.x-o.x,y:t.y-o.y,width:t.width,height:t.height}}return jo(r)}function oc(e,t){const n=mn(e);return n===t||!It(n)||Gn(n)?!1:Pt(n).position==="fixed"||oc(n,t)}function Rm(e,t){const n=t.get(e);if(n)return n;let r=wr(e,[],!1).filter(c=>It(c)&&Kn(c)!=="body"),o=null;const i=Pt(e).position==="fixed";let a=i?mn(e):e;for(;It(a)&&!Gn(a);){const c=Pt(a),u=yi(a);!u&&c.position==="fixed"&&(o=null),(i?!u&&!o:!u&&c.position==="static"&&!!o&&Tm.has(o.position)||Nr(a)&&!u&&oc(e,a))?r=r.filter(f=>f!==a):o=c,a=mn(a)}return t.set(e,r),r}function Am(e){let{element:t,boundary:n,rootBoundary:r,strategy:o}=e;const a=[...n==="clippingAncestors"?Oo(t)?[]:Rm(t,this._c):[].concat(n),r],c=a[0],u=a.reduce((d,f)=>{const x=Aa(t,f,o);return d.top=ft(x.top,d.top),d.right=hn(x.right,d.right),d.bottom=hn(x.bottom,d.bottom),d.left=ft(x.left,d.left),d},Aa(t,c,o));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function Nm(e){const{width:t,height:n}=tc(e);return{width:t,height:n}}function Em(e,t,n){const r=$t(t),o=Vt(t),i=n==="fixed",a=jn(e,!0,i,t);let c={scrollLeft:0,scrollTop:0};const u=Bt(0);function d(){u.x=Uo(o)}if(r||!r&&!i)if((Kn(t)!=="body"||Nr(o))&&(c=zo(t)),r){const b=jn(t,!0,i,t);u.x=b.x+t.clientLeft,u.y=b.y+t.clientTop}else o&&d();i&&!r&&o&&d();const f=o&&!r&&!i?rc(o,c):Bt(0),x=a.left+c.scrollLeft-u.x-f.x,y=a.top+c.scrollTop-u.y-f.y;return{x,y,width:a.width,height:a.height}}function ys(e){return Pt(e).position==="static"}function Na(e,t){if(!$t(e)||Pt(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return Vt(e)===n&&(n=n.ownerDocument.body),n}function sc(e,t){const n=gt(e);if(Oo(e))return n;if(!$t(e)){let o=mn(e);for(;o&&!Gn(o);){if(It(o)&&!ys(o))return o;o=mn(o)}return n}let r=Na(e,t);for(;r&&fm(r)&&ys(r);)r=Na(r,t);return r&&Gn(r)&&ys(r)&&!yi(r)?n:r||xm(e)||n}const Im=async function(e){const t=this.getOffsetParent||sc,n=this.getDimensions,r=await n(e.floating);return{reference:Em(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Pm(e){return Pt(e).direction==="rtl"}const _m={convertOffsetParentRelativeRectToViewportRelativeRect:bm,getDocumentElement:Vt,getClippingRect:Am,getOffsetParent:sc,getElementRects:Im,getClientRects:Cm,getDimensions:Nm,getScale:Fn,isElement:It,isRTL:Pm};function ic(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Lm(e,t){let n=null,r;const o=Vt(e);function i(){var c;clearTimeout(r),(c=n)==null||c.disconnect(),n=null}function a(c,u){c===void 0&&(c=!1),u===void 0&&(u=1),i();const d=e.getBoundingClientRect(),{left:f,top:x,width:y,height:b}=d;if(c||t(),!y||!b)return;const S=Qr(x),C=Qr(o.clientWidth-(f+y)),w=Qr(o.clientHeight-(x+b)),m=Qr(f),g={rootMargin:-S+"px "+-C+"px "+-w+"px "+-m+"px",threshold:ft(0,hn(1,u))||1};let h=!0;function k(j){const v=j[0].intersectionRatio;if(v!==u){if(!h)return a();v?a(!1,v):r=setTimeout(()=>{a(!1,1e-7)},1e3)}v===1&&!ic(d,e.getBoundingClientRect())&&a(),h=!1}try{n=new IntersectionObserver(k,{...g,root:o.ownerDocument})}catch{n=new IntersectionObserver(k,g)}n.observe(e)}return a(!0),i}function Mm(e,t,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:i=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:u=!1}=r,d=wi(e),f=o||i?[...d?wr(d):[],...wr(t)]:[];f.forEach(m=>{o&&m.addEventListener("scroll",n,{passive:!0}),i&&m.addEventListener("resize",n)});const x=d&&c?Lm(d,n):null;let y=-1,b=null;a&&(b=new ResizeObserver(m=>{let[p]=m;p&&p.target===d&&b&&(b.unobserve(t),cancelAnimationFrame(y),y=requestAnimationFrame(()=>{var g;(g=b)==null||g.observe(t)})),n()}),d&&!u&&b.observe(d),b.observe(t));let S,C=u?jn(e):null;u&&w();function w(){const m=jn(e);C&&!ic(C,m)&&n(),C=m,S=requestAnimationFrame(w)}return n(),()=>{var m;f.forEach(p=>{o&&p.removeEventListener("scroll",n),i&&p.removeEventListener("resize",n)}),x?.(),(m=b)==null||m.disconnect(),b=null,u&&cancelAnimationFrame(S)}}const Dm=im,Om=am,zm=rm,Um=cm,Bm=om,Ea=nm,Fm=lm,Hm=(e,t,n)=>{const r=new Map,o={platform:_m,...n},i={...o.platform,_c:r};return tm(e,t,{...o,platform:i})};var $m=typeof document<"u",Wm=function(){},co=$m?l.useLayoutEffect:Wm;function Ro(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,r,o;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;r--!==0;)if(!Ro(e[r],t[r]))return!1;return!0}if(o=Object.keys(e),n=o.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(t,o[r]))return!1;for(r=n;r--!==0;){const i=o[r];if(!(i==="_owner"&&e.$$typeof)&&!Ro(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}function ac(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Ia(e,t){const n=ac(e);return Math.round(t*n)/n}function vs(e){const t=l.useRef(e);return co(()=>{t.current=e}),t}function Vm(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:i,floating:a}={},transform:c=!0,whileElementsMounted:u,open:d}=e,[f,x]=l.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[y,b]=l.useState(r);Ro(y,r)||b(r);const[S,C]=l.useState(null),[w,m]=l.useState(null),p=l.useCallback(F=>{F!==j.current&&(j.current=F,C(F))},[]),g=l.useCallback(F=>{F!==v.current&&(v.current=F,m(F))},[]),h=i||S,k=a||w,j=l.useRef(null),v=l.useRef(null),R=l.useRef(f),N=u!=null,E=vs(u),L=vs(o),O=vs(d),I=l.useCallback(()=>{if(!j.current||!v.current)return;const F={placement:t,strategy:n,middleware:y};L.current&&(F.platform=L.current),Hm(j.current,v.current,F).then(Z=>{const A={...Z,isPositioned:O.current!==!1};P.current&&!Ro(R.current,A)&&(R.current=A,pd.flushSync(()=>{x(A)}))})},[y,t,n,L,O]);co(()=>{d===!1&&R.current.isPositioned&&(R.current.isPositioned=!1,x(F=>({...F,isPositioned:!1})))},[d]);const P=l.useRef(!1);co(()=>(P.current=!0,()=>{P.current=!1}),[]),co(()=>{if(h&&(j.current=h),k&&(v.current=k),h&&k){if(E.current)return E.current(h,k,I);I()}},[h,k,I,E,N]);const _=l.useMemo(()=>({reference:j,floating:v,setReference:p,setFloating:g}),[p,g]),M=l.useMemo(()=>({reference:h,floating:k}),[h,k]),z=l.useMemo(()=>{const F={position:n,left:0,top:0};if(!M.floating)return F;const Z=Ia(M.floating,f.x),A=Ia(M.floating,f.y);return c?{...F,transform:"translate("+Z+"px, "+A+"px)",...ac(M.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:Z,top:A}},[n,c,M.floating,f.x,f.y]);return l.useMemo(()=>({...f,update:I,refs:_,elements:M,floatingStyles:z}),[f,I,_,M,z])}const qm=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:r,padding:o}=typeof e=="function"?e(n):e;return r&&t(r)?r.current!=null?Ea({element:r.current,padding:o}).fn(n):{}:r?Ea({element:r,padding:o}).fn(n):{}}}},Gm=(e,t)=>({...Dm(e),options:[e,t]}),Ym=(e,t)=>({...Om(e),options:[e,t]}),Xm=(e,t)=>({...Fm(e),options:[e,t]}),Zm=(e,t)=>({...zm(e),options:[e,t]}),Km=(e,t)=>({...Um(e),options:[e,t]}),Qm=(e,t)=>({...Bm(e),options:[e,t]}),Jm=(e,t)=>({...qm(e),options:[e,t]});var ep="Arrow",lc=l.forwardRef((e,t)=>{const{children:n,width:r=10,height:o=5,...i}=e;return s.jsx(Ze.svg,{...i,ref:t,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:s.jsx("polygon",{points:"0,0 30,0 15,10"})})});lc.displayName=ep;var tp=lc,bi="Popper",[cc,Bo]=Eo(bi),[np,uc]=cc(bi),dc=e=>{const{__scopePopper:t,children:n}=e,[r,o]=l.useState(null);return s.jsx(np,{scope:t,anchor:r,onAnchorChange:o,children:n})};dc.displayName=bi;var fc="PopperAnchor",hc=l.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...o}=e,i=uc(fc,n),a=l.useRef(null),c=tt(t,a),u=l.useRef(null);return l.useEffect(()=>{const d=u.current;u.current=r?.current||a.current,d!==u.current&&i.onAnchorChange(u.current)}),r?null:s.jsx(Ze.div,{...o,ref:c})});hc.displayName=fc;var Ci="PopperContent",[rp,op]=cc(Ci),mc=l.forwardRef((e,t)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:i="center",alignOffset:a=0,arrowPadding:c=0,avoidCollisions:u=!0,collisionBoundary:d=[],collisionPadding:f=0,sticky:x="partial",hideWhenDetached:y=!1,updatePositionStrategy:b="optimized",onPlaced:S,...C}=e,w=uc(Ci,n),[m,p]=l.useState(null),g=tt(t,G=>p(G)),[h,k]=l.useState(null),j=bd(h),v=j?.width??0,R=j?.height??0,N=r+(i!=="center"?"-"+i:""),E=typeof f=="number"?f:{top:0,right:0,bottom:0,left:0,...f},L=Array.isArray(d)?d:[d],O=L.length>0,I={padding:E,boundary:L.filter(ip),altBoundary:O},{refs:P,floatingStyles:_,placement:M,isPositioned:z,middlewareData:F}=Vm({strategy:"fixed",placement:N,whileElementsMounted:(...G)=>Mm(...G,{animationFrame:b==="always"}),elements:{reference:w.anchor},middleware:[Gm({mainAxis:o+R,alignmentAxis:a}),u&&Ym({mainAxis:!0,crossAxis:!1,limiter:x==="partial"?Xm():void 0,...I}),u&&Zm({...I}),Km({...I,apply:({elements:G,rects:B,availableWidth:te,availableHeight:oe})=>{const{width:Q,height:me}=B.reference,fe=G.floating.style;fe.setProperty("--radix-popper-available-width",`${te}px`),fe.setProperty("--radix-popper-available-height",`${oe}px`),fe.setProperty("--radix-popper-anchor-width",`${Q}px`),fe.setProperty("--radix-popper-anchor-height",`${me}px`)}}),h&&Jm({element:h,padding:c}),ap({arrowWidth:v,arrowHeight:R}),y&&Qm({strategy:"referenceHidden",...I})]}),[Z,A]=xc(M),T=ht(S);xr(()=>{z&&T?.()},[z,T]);const $=F.arrow?.x,K=F.arrow?.y,V=F.arrow?.centerOffset!==0,[q,se]=l.useState();return xr(()=>{m&&se(window.getComputedStyle(m).zIndex)},[m]),s.jsx("div",{ref:P.setFloating,"data-radix-popper-content-wrapper":"",style:{..._,transform:z?_.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:q,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:s.jsx(rp,{scope:n,placedSide:Z,onArrowChange:k,arrowX:$,arrowY:K,shouldHideArrow:V,children:s.jsx(Ze.div,{"data-side":Z,"data-align":A,...C,ref:g,style:{...C.style,animation:z?void 0:"none"}})})})});mc.displayName=Ci;var pc="PopperArrow",sp={top:"bottom",right:"left",bottom:"top",left:"right"},gc=l.forwardRef(function(t,n){const{__scopePopper:r,...o}=t,i=op(pc,r),a=sp[i.placedSide];return s.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:s.jsx(tp,{...o,ref:n,style:{...o.style,display:"block"}})})});gc.displayName=pc;function ip(e){return e!==null}var ap=e=>({name:"transformOrigin",options:e,fn(t){const{placement:n,rects:r,middlewareData:o}=t,a=o.arrow?.centerOffset!==0,c=a?0:e.arrowWidth,u=a?0:e.arrowHeight,[d,f]=xc(n),x={start:"0%",center:"50%",end:"100%"}[f],y=(o.arrow?.x??0)+c/2,b=(o.arrow?.y??0)+u/2;let S="",C="";return d==="bottom"?(S=a?x:`${y}px`,C=`${-u}px`):d==="top"?(S=a?x:`${y}px`,C=`${r.floating.height+u}px`):d==="right"?(S=`${-u}px`,C=a?x:`${b}px`):d==="left"&&(S=`${r.floating.width+u}px`,C=a?x:`${b}px`),{data:{x:S,y:C}}}});function xc(e){const[t,n="center"]=e.split("-");return[t,n]}var yc=dc,Si=hc,vc=mc,wc=gc,lp="Portal",ki=l.forwardRef((e,t)=>{const{container:n,...r}=e,[o,i]=l.useState(!1);xr(()=>i(!0),[]);const a=n||o&&globalThis?.document?.body;return a?vl.createPortal(s.jsx(Ze.div,{...r,ref:t}),a):null});ki.displayName=lp;var cp=Symbol("radix.slottable");function up(e){const t=({children:n})=>s.jsx(s.Fragment,{children:n});return t.displayName=`${e}.Slottable`,t.__radixId=cp,t}var dp=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),fp="VisuallyHidden",bc=l.forwardRef((e,t)=>s.jsx(Ze.span,{...e,ref:t,style:{...dp,...e.style}}));bc.displayName=fp;var hp=bc,[Fo]=Eo("Tooltip",[Bo]),Ho=Bo(),Cc="TooltipProvider",mp=700,Vs="tooltip.open",[pp,Ti]=Fo(Cc),Sc=e=>{const{__scopeTooltip:t,delayDuration:n=mp,skipDelayDuration:r=300,disableHoverableContent:o=!1,children:i}=e,a=l.useRef(!0),c=l.useRef(!1),u=l.useRef(0);return l.useEffect(()=>{const d=u.current;return()=>window.clearTimeout(d)},[]),s.jsx(pp,{scope:t,isOpenDelayedRef:a,delayDuration:n,onOpen:l.useCallback(()=>{window.clearTimeout(u.current),a.current=!1},[]),onClose:l.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>a.current=!0,r)},[r]),isPointerInTransitRef:c,onPointerInTransitChange:l.useCallback(d=>{c.current=d},[]),disableHoverableContent:o,children:i})};Sc.displayName=Cc;var br="Tooltip",[gp,Er]=Fo(br),kc=e=>{const{__scopeTooltip:t,children:n,open:r,defaultOpen:o,onOpenChange:i,disableHoverableContent:a,delayDuration:c}=e,u=Ti(br,e.__scopeTooltip),d=Ho(t),[f,x]=l.useState(null),y=Zl(),b=l.useRef(0),S=a??u.disableHoverableContent,C=c??u.delayDuration,w=l.useRef(!1),[m,p]=bl({prop:r,defaultProp:o??!1,onChange:v=>{v?(u.onOpen(),document.dispatchEvent(new CustomEvent(Vs))):u.onClose(),i?.(v)},caller:br}),g=l.useMemo(()=>m?w.current?"delayed-open":"instant-open":"closed",[m]),h=l.useCallback(()=>{window.clearTimeout(b.current),b.current=0,w.current=!1,p(!0)},[p]),k=l.useCallback(()=>{window.clearTimeout(b.current),b.current=0,p(!1)},[p]),j=l.useCallback(()=>{window.clearTimeout(b.current),b.current=window.setTimeout(()=>{w.current=!0,p(!0),b.current=0},C)},[C,p]);return l.useEffect(()=>()=>{b.current&&(window.clearTimeout(b.current),b.current=0)},[]),s.jsx(yc,{...d,children:s.jsx(gp,{scope:t,contentId:y,open:m,stateAttribute:g,trigger:f,onTriggerChange:x,onTriggerEnter:l.useCallback(()=>{u.isOpenDelayedRef.current?j():h()},[u.isOpenDelayedRef,j,h]),onTriggerLeave:l.useCallback(()=>{S?k():(window.clearTimeout(b.current),b.current=0)},[k,S]),onOpen:h,onClose:k,disableHoverableContent:S,children:n})})};kc.displayName=br;var qs="TooltipTrigger",Tc=l.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,o=Er(qs,n),i=Ti(qs,n),a=Ho(n),c=l.useRef(null),u=tt(t,c,o.onTriggerChange),d=l.useRef(!1),f=l.useRef(!1),x=l.useCallback(()=>d.current=!1,[]);return l.useEffect(()=>()=>document.removeEventListener("pointerup",x),[x]),s.jsx(Si,{asChild:!0,...a,children:s.jsx(Ze.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...r,ref:u,onPointerMove:Me(e.onPointerMove,y=>{y.pointerType!=="touch"&&!f.current&&!i.isPointerInTransitRef.current&&(o.onTriggerEnter(),f.current=!0)}),onPointerLeave:Me(e.onPointerLeave,()=>{o.onTriggerLeave(),f.current=!1}),onPointerDown:Me(e.onPointerDown,()=>{o.open&&o.onClose(),d.current=!0,document.addEventListener("pointerup",x,{once:!0})}),onFocus:Me(e.onFocus,()=>{d.current||o.onOpen()}),onBlur:Me(e.onBlur,o.onClose),onClick:Me(e.onClick,o.onClose)})})});Tc.displayName=qs;var ji="TooltipPortal",[xp,yp]=Fo(ji,{forceMount:void 0}),jc=e=>{const{__scopeTooltip:t,forceMount:n,children:r,container:o}=e,i=Er(ji,t);return s.jsx(xp,{scope:t,forceMount:n,children:s.jsx(gn,{present:n||i.open,children:s.jsx(ki,{asChild:!0,container:o,children:r})})})};jc.displayName=ji;var Yn="TooltipContent",Rc=l.forwardRef((e,t)=>{const n=yp(Yn,e.__scopeTooltip),{forceMount:r=n.forceMount,side:o="top",...i}=e,a=Er(Yn,e.__scopeTooltip);return s.jsx(gn,{present:r||a.open,children:a.disableHoverableContent?s.jsx(Ac,{side:o,...i,ref:t}):s.jsx(vp,{side:o,...i,ref:t})})}),vp=l.forwardRef((e,t)=>{const n=Er(Yn,e.__scopeTooltip),r=Ti(Yn,e.__scopeTooltip),o=l.useRef(null),i=tt(t,o),[a,c]=l.useState(null),{trigger:u,onClose:d}=n,f=o.current,{onPointerInTransitChange:x}=r,y=l.useCallback(()=>{c(null),x(!1)},[x]),b=l.useCallback((S,C)=>{const w=S.currentTarget,m={x:S.clientX,y:S.clientY},p=Sp(m,w.getBoundingClientRect()),g=kp(m,p),h=Tp(C.getBoundingClientRect()),k=Rp([...g,...h]);c(k),x(!0)},[x]);return l.useEffect(()=>()=>y(),[y]),l.useEffect(()=>{if(u&&f){const S=w=>b(w,f),C=w=>b(w,u);return u.addEventListener("pointerleave",S),f.addEventListener("pointerleave",C),()=>{u.removeEventListener("pointerleave",S),f.removeEventListener("pointerleave",C)}}},[u,f,b,y]),l.useEffect(()=>{if(a){const S=C=>{const w=C.target,m={x:C.clientX,y:C.clientY},p=u?.contains(w)||f?.contains(w),g=!jp(m,a);p?y():g&&(y(),d())};return document.addEventListener("pointermove",S),()=>document.removeEventListener("pointermove",S)}},[u,f,a,d,y]),s.jsx(Ac,{...e,ref:i})}),[wp,bp]=Fo(br,{isInside:!1}),Cp=up("TooltipContent"),Ac=l.forwardRef((e,t)=>{const{__scopeTooltip:n,children:r,"aria-label":o,onEscapeKeyDown:i,onPointerDownOutside:a,...c}=e,u=Er(Yn,n),d=Ho(n),{onClose:f}=u;return l.useEffect(()=>(document.addEventListener(Vs,f),()=>document.removeEventListener(Vs,f)),[f]),l.useEffect(()=>{if(u.trigger){const x=y=>{y.target?.contains(u.trigger)&&f()};return window.addEventListener("scroll",x,{capture:!0}),()=>window.removeEventListener("scroll",x,{capture:!0})}},[u.trigger,f]),s.jsx(mi,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:a,onFocusOutside:x=>x.preventDefault(),onDismiss:f,children:s.jsxs(vc,{"data-state":u.stateAttribute,...d,...c,ref:t,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[s.jsx(Cp,{children:r}),s.jsx(wp,{scope:n,isInside:!0,children:s.jsx(hp,{id:u.contentId,role:"tooltip",children:o||r})})]})})});Rc.displayName=Yn;var Nc="TooltipArrow",Ec=l.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,o=Ho(n);return bp(Nc,n).isInside?null:s.jsx(wc,{...o,...r,ref:t})});Ec.displayName=Nc;function Sp(e,t){const n=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),o=Math.abs(t.right-e.x),i=Math.abs(t.left-e.x);switch(Math.min(n,r,o,i)){case i:return"left";case o:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function kp(e,t,n=5){const r=[];switch(t){case"top":r.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":r.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":r.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":r.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return r}function Tp(e){const{top:t,right:n,bottom:r,left:o}=e;return[{x:o,y:t},{x:n,y:t},{x:n,y:r},{x:o,y:r}]}function jp(e,t){const{x:n,y:r}=e;let o=!1;for(let i=0,a=t.length-1;i<t.length;a=i++){const c=t[i],u=t[a],d=c.x,f=c.y,x=u.x,y=u.y;f>r!=y>r&&n<(x-d)*(r-f)/(y-f)+d&&(o=!o)}return o}function Rp(e){const t=e.slice();return t.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),Ap(t)}function Ap(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const o=e[r];for(;t.length>=2;){const i=t[t.length-1],a=t[t.length-2];if((i.x-a.x)*(o.y-a.y)>=(i.y-a.y)*(o.x-a.x))t.pop();else break}t.push(o)}t.pop();const n=[];for(let r=e.length-1;r>=0;r--){const o=e[r];for(;n.length>=2;){const i=n[n.length-1],a=n[n.length-2];if((i.x-a.x)*(o.y-a.y)>=(i.y-a.y)*(o.x-a.x))n.pop();else break}n.push(o)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var Np=Sc,Ep=kc,Ip=Tc,Pp=jc,_p=Rc,Lp=Ec;function Ic({delayDuration:e=0,...t}){return s.jsx(Np,{"data-slot":"tooltip-provider",delayDuration:e,...t})}function Mp({...e}){return s.jsx(Ic,{children:s.jsx(Ep,{"data-slot":"tooltip",...e})})}function Dp({...e}){return s.jsx(Ip,{"data-slot":"tooltip-trigger",...e})}function Op({className:e,sideOffset:t=0,children:n,...r}){return s.jsx(Pp,{children:s.jsxs(_p,{"data-slot":"tooltip-content",sideOffset:t,className:Qt("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",e),...r,children:[n,s.jsx(Lp,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}var ws=0;function zp(){l.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??Pa()),document.body.insertAdjacentElement("beforeend",e[1]??Pa()),ws++,()=>{ws===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),ws--}},[])}function Pa(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var bs="focusScope.autoFocusOnMount",Cs="focusScope.autoFocusOnUnmount",_a={bubbles:!1,cancelable:!0},Up="FocusScope",Pc=l.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:i,...a}=e,[c,u]=l.useState(null),d=ht(o),f=ht(i),x=l.useRef(null),y=tt(t,C=>u(C)),b=l.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;l.useEffect(()=>{if(r){let C=function(g){if(b.paused||!c)return;const h=g.target;c.contains(h)?x.current=h:cn(x.current,{select:!0})},w=function(g){if(b.paused||!c)return;const h=g.relatedTarget;h!==null&&(c.contains(h)||cn(x.current,{select:!0}))},m=function(g){if(document.activeElement===document.body)for(const k of g)k.removedNodes.length>0&&cn(c)};document.addEventListener("focusin",C),document.addEventListener("focusout",w);const p=new MutationObserver(m);return c&&p.observe(c,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",C),document.removeEventListener("focusout",w),p.disconnect()}}},[r,c,b.paused]),l.useEffect(()=>{if(c){Ma.add(b);const C=document.activeElement;if(!c.contains(C)){const m=new CustomEvent(bs,_a);c.addEventListener(bs,d),c.dispatchEvent(m),m.defaultPrevented||(Bp(Vp(_c(c)),{select:!0}),document.activeElement===C&&cn(c))}return()=>{c.removeEventListener(bs,d),setTimeout(()=>{const m=new CustomEvent(Cs,_a);c.addEventListener(Cs,f),c.dispatchEvent(m),m.defaultPrevented||cn(C??document.body,{select:!0}),c.removeEventListener(Cs,f),Ma.remove(b)},0)}}},[c,d,f,b]);const S=l.useCallback(C=>{if(!n&&!r||b.paused)return;const w=C.key==="Tab"&&!C.altKey&&!C.ctrlKey&&!C.metaKey,m=document.activeElement;if(w&&m){const p=C.currentTarget,[g,h]=Fp(p);g&&h?!C.shiftKey&&m===h?(C.preventDefault(),n&&cn(g,{select:!0})):C.shiftKey&&m===g&&(C.preventDefault(),n&&cn(h,{select:!0})):m===p&&C.preventDefault()}},[n,r,b.paused]);return s.jsx(Ze.div,{tabIndex:-1,...a,ref:y,onKeyDown:S})});Pc.displayName=Up;function Bp(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(cn(r,{select:t}),document.activeElement!==n)return}function Fp(e){const t=_c(e),n=La(t,e),r=La(t.reverse(),e);return[n,r]}function _c(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function La(e,t){for(const n of e)if(!Hp(n,{upTo:t}))return n}function Hp(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function $p(e){return e instanceof HTMLInputElement&&"select"in e}function cn(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&$p(e)&&t&&e.select()}}var Ma=Wp();function Wp(){let e=[];return{add(t){const n=e[0];t!==n&&n?.pause(),e=Da(e,t),e.unshift(t)},remove(t){e=Da(e,t),e[0]?.resume()}}}function Da(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function Vp(e){return e.filter(t=>t.tagName!=="A")}function qp(e){const t=Gp(e),n=l.forwardRef((r,o)=>{const{children:i,...a}=r,c=l.Children.toArray(i),u=c.find(Xp);if(u){const d=u.props.children,f=c.map(x=>x===u?l.Children.count(d)>1?l.Children.only(null):l.isValidElement(d)?d.props.children:null:x);return s.jsx(t,{...a,ref:o,children:l.isValidElement(d)?l.cloneElement(d,void 0,f):null})}return s.jsx(t,{...a,ref:o,children:i})});return n.displayName=`${e}.Slot`,n}function Gp(e){const t=l.forwardRef((n,r)=>{const{children:o,...i}=n;if(l.isValidElement(o)){const a=Kp(o),c=Zp(i,o.props);return o.type!==l.Fragment&&(c.ref=r?gd(r,a):a),l.cloneElement(o,c)}return l.Children.count(o)>1?l.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Yp=Symbol("radix.slottable");function Xp(e){return l.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Yp}function Zp(e,t){const n={...t};for(const r in t){const o=e[r],i=t[r];/^on[A-Z]/.test(r)?o&&i?n[r]=(...c)=>{const u=i(...c);return o(...c),u}:o&&(n[r]=o):r==="style"?n[r]={...o,...i}:r==="className"&&(n[r]=[o,i].filter(Boolean).join(" "))}return{...e,...n}}function Kp(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var Qp=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Dn=new WeakMap,Jr=new WeakMap,eo={},Ss=0,Lc=function(e){return e&&(e.host||Lc(e.parentNode))},Jp=function(e,t){return t.map(function(n){if(e.contains(n))return n;var r=Lc(n);return r&&e.contains(r)?r:null}).filter(function(n){return!!n})},eg=function(e,t,n,r){var o=Jp(t,Array.isArray(e)?e:[e]);eo[n]||(eo[n]=new WeakMap);var i=eo[n],a=[],c=new Set,u=new Set(o),d=function(x){!x||c.has(x)||(c.add(x),d(x.parentNode))};o.forEach(d);var f=function(x){!x||u.has(x)||Array.prototype.forEach.call(x.children,function(y){if(c.has(y))f(y);else try{var b=y.getAttribute(r),S=b!==null&&b!=="false",C=(Dn.get(y)||0)+1,w=(i.get(y)||0)+1;Dn.set(y,C),i.set(y,w),a.push(y),C===1&&S&&Jr.set(y,!0),w===1&&y.setAttribute(n,"true"),S||y.setAttribute(r,"true")}catch{}})};return f(t),c.clear(),Ss++,function(){a.forEach(function(x){var y=Dn.get(x)-1,b=i.get(x)-1;Dn.set(x,y),i.set(x,b),y||(Jr.has(x)||x.removeAttribute(r),Jr.delete(x)),b||x.removeAttribute(n)}),Ss--,Ss||(Dn=new WeakMap,Dn=new WeakMap,Jr=new WeakMap,eo={})}},tg=function(e,t,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),o=Qp(e);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live], script"))),eg(r,o,n,"aria-hidden")):function(){return null}},Ot=function(){return Ot=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Ot.apply(this,arguments)};function Mc(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n}function ng(e,t,n){if(n||arguments.length===2)for(var r=0,o=t.length,i;r<o;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}var uo="right-scroll-bar-position",fo="width-before-scroll-bar",rg="with-scroll-bars-hidden",og="--removed-body-scroll-bar-size";function ks(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function sg(e,t){var n=l.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(r){var o=n.value;o!==r&&(n.value=r,n.callback(r,o))}}}})[0];return n.callback=t,n.facade}var ig=typeof window<"u"?l.useLayoutEffect:l.useEffect,Oa=new WeakMap;function ag(e,t){var n=sg(null,function(r){return e.forEach(function(o){return ks(o,r)})});return ig(function(){var r=Oa.get(n);if(r){var o=new Set(r),i=new Set(e),a=n.current;o.forEach(function(c){i.has(c)||ks(c,null)}),i.forEach(function(c){o.has(c)||ks(c,a)})}Oa.set(n,e)},[e]),n}function lg(e){return e}function cg(e,t){t===void 0&&(t=lg);var n=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(i){var a=t(i,r);return n.push(a),function(){n=n.filter(function(c){return c!==a})}},assignSyncMedium:function(i){for(r=!0;n.length;){var a=n;n=[],a.forEach(i)}n={push:function(c){return i(c)},filter:function(){return n}}},assignMedium:function(i){r=!0;var a=[];if(n.length){var c=n;n=[],c.forEach(i),a=n}var u=function(){var f=a;a=[],f.forEach(i)},d=function(){return Promise.resolve().then(u)};d(),n={push:function(f){a.push(f),d()},filter:function(f){return a=a.filter(f),n}}}};return o}function ug(e){e===void 0&&(e={});var t=cg(null);return t.options=Ot({async:!0,ssr:!1},e),t}var Dc=function(e){var t=e.sideCar,n=Mc(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return l.createElement(r,Ot({},n))};Dc.isSideCarExport=!0;function dg(e,t){return e.useMedium(t),Dc}var Oc=ug(),Ts=function(){},$o=l.forwardRef(function(e,t){var n=l.useRef(null),r=l.useState({onScrollCapture:Ts,onWheelCapture:Ts,onTouchMoveCapture:Ts}),o=r[0],i=r[1],a=e.forwardProps,c=e.children,u=e.className,d=e.removeScrollBar,f=e.enabled,x=e.shards,y=e.sideCar,b=e.noRelative,S=e.noIsolation,C=e.inert,w=e.allowPinchZoom,m=e.as,p=m===void 0?"div":m,g=e.gapMode,h=Mc(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),k=y,j=ag([n,t]),v=Ot(Ot({},h),o);return l.createElement(l.Fragment,null,f&&l.createElement(k,{sideCar:Oc,removeScrollBar:d,shards:x,noRelative:b,noIsolation:S,inert:C,setCallbacks:i,allowPinchZoom:!!w,lockRef:n,gapMode:g}),a?l.cloneElement(l.Children.only(c),Ot(Ot({},v),{ref:j})):l.createElement(p,Ot({},v,{className:u,ref:j}),c))});$o.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};$o.classNames={fullWidth:fo,zeroRight:uo};var fg=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function hg(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=fg();return t&&e.setAttribute("nonce",t),e}function mg(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function pg(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var gg=function(){var e=0,t=null;return{add:function(n){e==0&&(t=hg())&&(mg(t,n),pg(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},xg=function(){var e=gg();return function(t,n){l.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},zc=function(){var e=xg(),t=function(n){var r=n.styles,o=n.dynamic;return e(r,o),null};return t},yg={left:0,top:0,right:0,gap:0},js=function(e){return parseInt(e||"",10)||0},vg=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],o=t[e==="padding"?"paddingRight":"marginRight"];return[js(n),js(r),js(o)]},wg=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return yg;var t=vg(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},bg=zc(),Hn="data-scroll-locked",Cg=function(e,t,n,r){var o=e.left,i=e.top,a=e.right,c=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(rg,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(c,"px ").concat(r,`;
  }
  body[`).concat(Hn,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(c,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(c,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(uo,` {
    right: `).concat(c,"px ").concat(r,`;
  }
  
  .`).concat(fo,` {
    margin-right: `).concat(c,"px ").concat(r,`;
  }
  
  .`).concat(uo," .").concat(uo,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(fo," .").concat(fo,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Hn,`] {
    `).concat(og,": ").concat(c,`px;
  }
`)},za=function(){var e=parseInt(document.body.getAttribute(Hn)||"0",10);return isFinite(e)?e:0},Sg=function(){l.useEffect(function(){return document.body.setAttribute(Hn,(za()+1).toString()),function(){var e=za()-1;e<=0?document.body.removeAttribute(Hn):document.body.setAttribute(Hn,e.toString())}},[])},kg=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,o=r===void 0?"margin":r;Sg();var i=l.useMemo(function(){return wg(o)},[o]);return l.createElement(bg,{styles:Cg(i,!t,o,n?"":"!important")})},Gs=!1;if(typeof window<"u")try{var to=Object.defineProperty({},"passive",{get:function(){return Gs=!0,!0}});window.addEventListener("test",to,to),window.removeEventListener("test",to,to)}catch{Gs=!1}var On=Gs?{passive:!1}:!1,Tg=function(e){return e.tagName==="TEXTAREA"},Uc=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!Tg(e)&&n[t]==="visible")},jg=function(e){return Uc(e,"overflowY")},Rg=function(e){return Uc(e,"overflowX")},Ua=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=Bc(e,r);if(o){var i=Fc(e,r),a=i[1],c=i[2];if(a>c)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},Ag=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},Ng=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},Bc=function(e,t){return e==="v"?jg(t):Rg(t)},Fc=function(e,t){return e==="v"?Ag(t):Ng(t)},Eg=function(e,t){return e==="h"&&t==="rtl"?-1:1},Ig=function(e,t,n,r,o){var i=Eg(e,window.getComputedStyle(t).direction),a=i*r,c=n.target,u=t.contains(c),d=!1,f=a>0,x=0,y=0;do{if(!c)break;var b=Fc(e,c),S=b[0],C=b[1],w=b[2],m=C-w-i*S;(S||m)&&Bc(e,c)&&(x+=m,y+=S);var p=c.parentNode;c=p&&p.nodeType===Node.DOCUMENT_FRAGMENT_NODE?p.host:p}while(!u&&c!==document.body||u&&(t.contains(c)||t===c));return(f&&Math.abs(x)<1||!f&&Math.abs(y)<1)&&(d=!0),d},no=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Ba=function(e){return[e.deltaX,e.deltaY]},Fa=function(e){return e&&"current"in e?e.current:e},Pg=function(e,t){return e[0]===t[0]&&e[1]===t[1]},_g=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Lg=0,zn=[];function Mg(e){var t=l.useRef([]),n=l.useRef([0,0]),r=l.useRef(),o=l.useState(Lg++)[0],i=l.useState(zc)[0],a=l.useRef(e);l.useEffect(function(){a.current=e},[e]),l.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var C=ng([e.lockRef.current],(e.shards||[]).map(Fa),!0).filter(Boolean);return C.forEach(function(w){return w.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),C.forEach(function(w){return w.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var c=l.useCallback(function(C,w){if("touches"in C&&C.touches.length===2||C.type==="wheel"&&C.ctrlKey)return!a.current.allowPinchZoom;var m=no(C),p=n.current,g="deltaX"in C?C.deltaX:p[0]-m[0],h="deltaY"in C?C.deltaY:p[1]-m[1],k,j=C.target,v=Math.abs(g)>Math.abs(h)?"h":"v";if("touches"in C&&v==="h"&&j.type==="range")return!1;var R=window.getSelection(),N=R&&R.anchorNode,E=N?N===j||N.contains(j):!1;if(E)return!1;var L=Ua(v,j);if(!L)return!0;if(L?k=v:(k=v==="v"?"h":"v",L=Ua(v,j)),!L)return!1;if(!r.current&&"changedTouches"in C&&(g||h)&&(r.current=k),!k)return!0;var O=r.current||k;return Ig(O,w,C,O==="h"?g:h)},[]),u=l.useCallback(function(C){var w=C;if(!(!zn.length||zn[zn.length-1]!==i)){var m="deltaY"in w?Ba(w):no(w),p=t.current.filter(function(k){return k.name===w.type&&(k.target===w.target||w.target===k.shadowParent)&&Pg(k.delta,m)})[0];if(p&&p.should){w.cancelable&&w.preventDefault();return}if(!p){var g=(a.current.shards||[]).map(Fa).filter(Boolean).filter(function(k){return k.contains(w.target)}),h=g.length>0?c(w,g[0]):!a.current.noIsolation;h&&w.cancelable&&w.preventDefault()}}},[]),d=l.useCallback(function(C,w,m,p){var g={name:C,delta:w,target:m,should:p,shadowParent:Dg(m)};t.current.push(g),setTimeout(function(){t.current=t.current.filter(function(h){return h!==g})},1)},[]),f=l.useCallback(function(C){n.current=no(C),r.current=void 0},[]),x=l.useCallback(function(C){d(C.type,Ba(C),C.target,c(C,e.lockRef.current))},[]),y=l.useCallback(function(C){d(C.type,no(C),C.target,c(C,e.lockRef.current))},[]);l.useEffect(function(){return zn.push(i),e.setCallbacks({onScrollCapture:x,onWheelCapture:x,onTouchMoveCapture:y}),document.addEventListener("wheel",u,On),document.addEventListener("touchmove",u,On),document.addEventListener("touchstart",f,On),function(){zn=zn.filter(function(C){return C!==i}),document.removeEventListener("wheel",u,On),document.removeEventListener("touchmove",u,On),document.removeEventListener("touchstart",f,On)}},[]);var b=e.removeScrollBar,S=e.inert;return l.createElement(l.Fragment,null,S?l.createElement(i,{styles:_g(o)}):null,b?l.createElement(kg,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function Dg(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Og=dg(Oc,Mg);var Hc=l.forwardRef(function(e,t){return l.createElement($o,Ot({},e,{ref:t,sideCar:Og}))});Hc.classNames=$o.classNames;var Wo="Popover",[$c]=Eo(Wo,[Bo]),Ir=Bo(),[zg,xn]=$c(Wo),Wc=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:o,onOpenChange:i,modal:a=!1}=e,c=Ir(t),u=l.useRef(null),[d,f]=l.useState(!1),[x,y]=bl({prop:r,defaultProp:o??!1,onChange:i,caller:Wo});return s.jsx(yc,{...c,children:s.jsx(zg,{scope:t,contentId:Zl(),triggerRef:u,open:x,onOpenChange:y,onOpenToggle:l.useCallback(()=>y(b=>!b),[y]),hasCustomAnchor:d,onCustomAnchorAdd:l.useCallback(()=>f(!0),[]),onCustomAnchorRemove:l.useCallback(()=>f(!1),[]),modal:a,children:n})})};Wc.displayName=Wo;var Vc="PopoverAnchor",Ug=l.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=xn(Vc,n),i=Ir(n),{onCustomAnchorAdd:a,onCustomAnchorRemove:c}=o;return l.useEffect(()=>(a(),()=>c()),[a,c]),s.jsx(Si,{...i,...r,ref:t})});Ug.displayName=Vc;var qc="PopoverTrigger",Gc=l.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=xn(qc,n),i=Ir(n),a=tt(t,o.triggerRef),c=s.jsx(Ze.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Qc(o.open),...r,ref:a,onClick:Me(e.onClick,o.onOpenToggle)});return o.hasCustomAnchor?c:s.jsx(Si,{asChild:!0,...i,children:c})});Gc.displayName=qc;var Ri="PopoverPortal",[Bg,Fg]=$c(Ri,{forceMount:void 0}),Yc=e=>{const{__scopePopover:t,forceMount:n,children:r,container:o}=e,i=xn(Ri,t);return s.jsx(Bg,{scope:t,forceMount:n,children:s.jsx(gn,{present:n||i.open,children:s.jsx(ki,{asChild:!0,container:o,children:r})})})};Yc.displayName=Ri;var Xn="PopoverContent",Xc=l.forwardRef((e,t)=>{const n=Fg(Xn,e.__scopePopover),{forceMount:r=n.forceMount,...o}=e,i=xn(Xn,e.__scopePopover);return s.jsx(gn,{present:r||i.open,children:i.modal?s.jsx($g,{...o,ref:t}):s.jsx(Wg,{...o,ref:t})})});Xc.displayName=Xn;var Hg=qp("PopoverContent.RemoveScroll"),$g=l.forwardRef((e,t)=>{const n=xn(Xn,e.__scopePopover),r=l.useRef(null),o=tt(t,r),i=l.useRef(!1);return l.useEffect(()=>{const a=r.current;if(a)return tg(a)},[]),s.jsx(Hc,{as:Hg,allowPinchZoom:!0,children:s.jsx(Zc,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Me(e.onCloseAutoFocus,a=>{a.preventDefault(),i.current||n.triggerRef.current?.focus()}),onPointerDownOutside:Me(e.onPointerDownOutside,a=>{const c=a.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0,d=c.button===2||u;i.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:Me(e.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),Wg=l.forwardRef((e,t)=>{const n=xn(Xn,e.__scopePopover),r=l.useRef(!1),o=l.useRef(!1);return s.jsx(Zc,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{e.onCloseAutoFocus?.(i),i.defaultPrevented||(r.current||n.triggerRef.current?.focus(),i.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:i=>{e.onInteractOutside?.(i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const a=i.target;n.triggerRef.current?.contains(a)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&o.current&&i.preventDefault()}})}),Zc=l.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:f,...x}=e,y=xn(Xn,n),b=Ir(n);return zp(),s.jsx(Pc,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:i,children:s.jsx(mi,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:f,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onDismiss:()=>y.onOpenChange(!1),children:s.jsx(vc,{"data-state":Qc(y.open),role:"dialog",id:y.contentId,...b,...x,ref:t,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Kc="PopoverClose",Vg=l.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=xn(Kc,n);return s.jsx(Ze.button,{type:"button",...r,ref:t,onClick:Me(e.onClick,()=>o.onOpenChange(!1))})});Vg.displayName=Kc;var qg="PopoverArrow",Gg=l.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=Ir(n);return s.jsx(wc,{...o,...r,ref:t})});Gg.displayName=qg;function Qc(e){return e?"open":"closed"}var Yg=Wc,Jc=Gc,Xg=Yc,eu=Xc;const Ai=Yg,Vo=l.forwardRef(({...e},t)=>s.jsx(Jc,{ref:t,"data-slot":"popover-trigger",...e}));Vo.displayName=Jc.displayName;const qo=l.forwardRef(({className:e,align:t="center",sideOffset:n=4,...r},o)=>s.jsx(Xg,{children:s.jsx(eu,{ref:o,"data-slot":"popover-content",align:t,sideOffset:n,className:Qt("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...r})}));qo.displayName=eu.displayName;function tu({key:e,debounceMs:t=100}){const n=l.useRef(null),r=l.useRef(null),o=l.useRef(!1);return l.useEffect(()=>{const i=n.current;if(!i)return;const a=sessionStorage.getItem(`scroll-${e}`);a&&!o.current&&(o.current=!0,requestAnimationFrame(()=>{i.scrollTop=parseInt(a,10),setTimeout(()=>{o.current=!1},100)}));const c=()=>{o.current||(r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{sessionStorage.setItem(`scroll-${e}`,i.scrollTop.toString())},t))};return i.addEventListener("scroll",c,{passive:!0}),()=>{i.removeEventListener("scroll",c),r.current&&clearTimeout(r.current)}},[e,t]),n}const nu={best_contributor:"베스트 컨트리뷰터",captain_captain:"선장",community_fellow:"커뮤니티 펠로우",curiosity_spark:"호기심의 불꽃",diligent_visitor:"성실한 방문자",discussion_expert:"마라톤 토론러",discussion_maestro:"토론의 거장",economy_analyst:"경제 분석인",economy_expert:"경제 길잡이",engineering_curious:"변수 연구자",engineering_destroyer:"방정식 해결사",engineering_first_light:"공학자의 첫 등불",engineering_focused:"함수 마스터",explore_brave_questioner:"용기 있는 질문러",explore_inquirer:"질문자",explore_investigator:"조사자",explore_philosopher:"사색가",explore_seeker:"탐색자",explore_steady_questioner:"꾸준한 질문러",famous_guide:"유명한 길잡이",first_explore:"탐색자",guide_guide:"가이드",guide_luminary:"선도자",guide_navigator:"내비게이터",guide_pathfinder:"개척자",guide_sprout:"길잡이 꿈나무",honorary_scholar:"명예 학자",immortal_lantern:"네비게이션",insight_collector:"통찰의 수집가",it_consultant:"기술 상담인",it_expert:"기술 이야기꾼",kind_guide:"친절한 길잡이",knowledge_sage:"지혜의 현자",language_expert:"언어 항해사",language_tutor:"언어 튜터",lantern_campfire:"모닥불",lantern_candle:"촛불",lantern_furnace:"용광로",lantern_giver:"등불 나눔이",lantern_giver_captain:"응원단장",lantern_giver_small:"좋아요 요정",lantern_lantern:"랜턴",little_guide:"꼬마 길잡이",master_on_path:"길 위의 스승",multi_specialist:"다중 분야 항해사",ordinary_guide:"평범한 길잡이",philosopher_soul:"사유의 항해자",popular_questioner:"인기 질문러",reply_advisor:"조언자",reply_challenger:"도전하는 답변가",reply_helper:"조력자",reply_mentor:"멘토",reply_persistent_helper:"끈기 있는 답변가",reply_scholar:"학자",share_archivist:"기록 관리자",share_curator:"큐레이터",share_publisher:"발행자",share_sharer:"공유자",sherpa:"세르파",specialized_replier:"특화 답변가",streak_pillar:"기둥",streak_regular:"단골",streak_resident:"주민",streak_visitor:"방문자",thought_architect:"사고의 건축가",truth_seeker:"진리의 탐험가",wisdom_lighthouse:"지혜의 등대"},Ni=(e,t,n)=>{const r=e??"";return!r||r!==t||!n?"":nu[n]??""},Ei=e=>e?nu[e]??"":"";function ru(e=6e4){const[t,n]=l.useState(()=>new Date);return l.useEffect(()=>{const r=setInterval(()=>{n(new Date)},e);return()=>clearInterval(r)},[e]),t}function Zg(e){if(!e||typeof e!="string")return!1;const t=e.toLowerCase();return t.includes("googleusercontent.com")||t.includes("googleapis.com")||t.includes("lh3.googleusercontent.com")||t.includes("lh4.googleusercontent.com")||t.includes("lh5.googleusercontent.com")||t.includes("lh6.googleusercontent.com")}function Ys(e){return!e||typeof e!="string"||Zg(e)?null:e}function ou(e){if(!e)return null;if(e instanceof Date)return e;if(e&&typeof e.toDate=="function")return e.toDate();if(typeof e=="string"||typeof e=="number"){const t=new Date(e);if(!Number.isNaN(t.getTime()))return t}return null}function su(e){const t=ou(e);return t?t.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}function Kg({post:e,userNickname:t,currentTitle:n,userProfileImage:r}){const o=l.useMemo(()=>{const g=new Set;return typeof e.authorUid=="string"&&e.authorUid.length>0&&g.add(e.authorUid),e.replies?.forEach(h=>{typeof h.authorUid=="string"&&h.authorUid.length>0&&g.add(h.authorUid)}),Array.from(g)},[e.authorUid,e.replies]),i=Io(o),a=e.authorUid?i[e.authorUid]:void 0,c=a?.currentTitleId??null,u=Ei(c),d=e.authorDeleted===!0||e.author==="탈퇴한 사용자",f=di(e.author,d),x=Mo(e.author,d),y=e.author===t,b=l.useMemo(()=>y&&r&&r.trim().length>0?r:a?.profileImage??Ys(e.authorAvatar)??null,[y,r,a?.profileImage,e.authorAvatar]),S=Ni(e.author??"",t,n),C=x?null:u||S,w=ou(e.createdAt),m=su(e.createdAt),p=l.useMemo(()=>e.replies?.filter(g=>g.hidden!==!0)?.map(g=>({...g,isGuide:g.isGuide||e.guideReplyId===g.id}))??[],[e.guideReplyId,e.replies]);return{userProfiles:i,postAuthorProfileImage:b,postAuthorName:f,isPostAuthorDeleted:x,authorTitle:C,postCreatedAtText:m,postCreatedAtDate:w,visibleReplies:p}}function Rn(e){const{className:t,...n}=e;return s.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,...n,children:[s.jsx("path",{d:"M8 6h8l1 2v8c0 1.1-0.9 2-2 2H9c-1.1 0-2-0.9-2-2V8l1-2z"}),s.jsx("path",{d:"M7 6c0-1.1 0.9-2 2-2h6c1.1 0 2 0.9 2 2v0.5H7V6z"}),s.jsx("rect",{x:"10",y:"2",width:"4",height:"2",rx:"0.5"}),s.jsx("circle",{cx:"12",cy:"12",r:"2.5"}),s.jsx("rect",{x:"11.5",y:"9.5",width:"1",height:"5",rx:"0.5"}),s.jsx("rect",{x:"9.5",y:"11.5",width:"5",height:"1",rx:"0.5"}),s.jsx("rect",{x:"11.5",y:"18",width:"1",height:"2",rx:"0.5"})]})}function Go(e){return s.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",...e,children:[s.jsx("path",{d:"M8 6h8l1 2v8c0 1-1 2-2 2H9c-1 0-2-1-2-2V8l1-2z",fillOpacity:.8}),s.jsx("path",{d:"M7 6c0-1 1-2 2-2h6c1 0 2 1 2 2z"}),s.jsx("rect",{x:"10",y:"2",width:"4",height:"2"}),s.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor",fillOpacity:.3}),s.jsx("rect",{x:"11.5",y:"18",width:"1",height:"2"})]})}function Ii({size:e=16,className:t="",isPremium:n=!1}){const r=`laurelGold-${e}`,o=`laurelShadow-${e}`;return s.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",className:t,children:[s.jsxs("defs",{children:[s.jsxs("linearGradient",{id:r,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:"#ffd700",stopOpacity:"1"}),s.jsx("stop",{offset:"30%",stopColor:"#f4d03f",stopOpacity:"1"}),s.jsx("stop",{offset:"60%",stopColor:"#c9a855",stopOpacity:"1"}),s.jsx("stop",{offset:"100%",stopColor:"#b8860b",stopOpacity:"1"})]}),s.jsx("filter",{id:o,children:s.jsx("feDropShadow",{dx:"0.3",dy:"0.3",stdDeviation:"0.4",floodColor:"#8b6914",floodOpacity:"0.4"})})]}),s.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:`url(#${r})`,strokeWidth:"1.5",fill:"none",strokeLinecap:"round",filter:`url(#${o})`}),s.jsx("path",{d:"M 6 6 L 5.2 4.5 L 6.8 4.5 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 8 5 L 7.2 3.5 L 8.8 3.5 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 10 4.5 L 9.2 3 L 10.8 3 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 12 4 L 11.2 2.5 L 12.8 2.5 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 14 4.5 L 13.2 3 L 14.8 3 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 16 5 L 15.2 3.5 L 16.8 3.5 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 18 6 L 17.2 4.5 L 18.8 4.5 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 19 8 L 20.5 7.2 L 20.5 8.8 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 19.5 10 L 21 9.2 L 21 10.8 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 20 12 L 21.5 11.2 L 21.5 12.8 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 19.5 14 L 21 13.2 L 21 14.8 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 19 16 L 20.5 15.2 L 20.5 16.8 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 18 18 L 17.2 19.5 L 18.8 19.5 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 16 19 L 15.2 20.5 L 16.8 20.5 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 14 19.5 L 13.2 21 L 14.8 21 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 12 20 L 11.2 21.5 L 12.8 21.5 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 10 19.5 L 9.2 21 L 10.8 21 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 8 19 L 7.2 20.5 L 8.8 20.5 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 6 18 L 5.2 19.5 L 6.8 19.5 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 5 16 L 3.5 15.2 L 3.5 16.8 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 4.5 14 L 3 13.2 L 3 14.8 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 4 12 L 2.5 11.2 L 2.5 12.8 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 4.5 10 L 3 9.2 L 3 10.8 Z",fill:`url(#${r})`,filter:`url(#${o})`}),s.jsx("path",{d:"M 5 8 L 3.5 7.2 L 3.5 8.8 Z",fill:`url(#${r})`,filter:`url(#${o})`})]})}const Qg=J.memo(function({date:t,title:n}){const r=ru(6e4);return t?s.jsx("span",{title:n||void 0,children:Po(t,r)}):null});function Jg({post:e,userNickname:t,userProfileImage:n,currentTitle:r,isDarkMode:o,blockedUserIds:i,isPostLanterned:a,isReplyLanterned:c,onLanternToggle:u,onReplyLanternToggle:d,isBookmarked:f,onBookmarkToggle:x,isGuideReply:y,hasGuide:b,onGuideSelect:S,newReplyContent:C,onReplyContentChange:w,onReplySubmit:m,replyInputRef:p,onClose:g,onAuthorClick:h,onMentionAuthor:k,onMentionReplyAuthor:j,onReplyAuthorClick:v,onReport:R,onDelete:N,onReportReply:E,renderContentWithMentions:L,canSubmitReply:O,onRefresh:I,isRefreshing:P=!1,isGuest:_}){const{navigateToLogin:M}=wl(),[z,F]=l.useState(!1),Z=ru(6e4),A=tu({key:`post-detail-${e.id}`}),T=e.author===t,{userProfiles:$,postAuthorProfileImage:K,postAuthorName:V,isPostAuthorDeleted:q,authorTitle:se,postCreatedAtText:G,postCreatedAtDate:B,visibleReplies:te}=Kg({post:e,userNickname:t,currentTitle:r,userProfileImage:T?n:void 0}),oe=l.useMemo(()=>T?n&&n.trim().length>0?n:null:K,[T,n,K]),Q=l.useMemo(()=>typeof window>"u"?!1:(document.documentElement.getAttribute("data-theme")||"default")==="greek-temple",[]),me=l.useMemo(()=>{const ae=e.authorUid||e.userId;return ae?$[ae]:void 0},[e,$]),fe=l.useCallback(ae=>{ae.key==="Enter"&&!ae.shiftKey&&(ae.preventDefault(),m())},[m]);return l.useMemo(()=>{const ae=e.authorUid||e.userId;return i?.includes(ae)},[e,i])?s.jsxs("div",{className:"h-full flex flex-col items-center justify-center space-y-4 bg-background",children:[s.jsx("div",{className:"p-4 rounded-full bg-muted",children:s.jsx(_s,{className:"w-8 h-8 text-muted-foreground"})}),s.jsx("p",{className:"text-muted-foreground font-medium",children:"차단된 사용자의 게시글입니다."}),s.jsx(we,{variant:"outline",onClick:g,children:"목록으로 돌아가기"})]}):s.jsxs(s.Fragment,{children:[" ",s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsx("div",{className:"bg-card/95 border-b border-border px-4 pb-4 flex-shrink-0 safe-top-with-padding",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(we,{variant:"ghost",size:"icon",onClick:g,children:s.jsx(Cl,{className:"w-5 h-5"})}),s.jsx("h2",{className:"font-medium",children:"게시글 상세"})]}),I&&s.jsx(we,{variant:"ghost",size:"icon",onClick:I,disabled:P,className:"touch-target",children:s.jsx(Al,{className:`w-5 h-5 text-muted-foreground ${P?"animate-spin":""}`})})]})}),s.jsx("div",{ref:A,className:"flex-1 scroll-container",children:s.jsxs("div",{className:"px-4 py-3 pb-24 space-y-4",children:[s.jsx(Ct,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm",children:s.jsx(St,{className:"p-6",children:s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(hi,{src:oe||void 0,alt:V?`${V}님의 프로필`:"프로필 이미지",nickname:q?void 0:e.author||V,fallbackText:V.charAt(0)?.toUpperCase()||"?",className:"w-12 h-12 ring-2 ring-border/30 cursor-pointer",size:48,loading:"eager",decoding:"async",onClick:q?void 0:h}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[Q&&me?.trustScore!==void 0&&me.trustScore>=70&&s.jsx("div",{className:`shrink-0 ${Q?"laurel-wreath-premium":"laurel-wreath"}`,children:s.jsx(Ii,{size:18,isPremium:Q})}),s.jsx("p",{className:"font-semibold text-base "+(q?"text-muted-foreground cursor-default":"cursor-pointer hover:text-primary transition-colors duration-200"),onClick:q?void 0:k,children:V}),se&&s.jsx(dn,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:se})]}),s.jsx("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:s.jsx(Qg,{date:B,title:G})})]})]}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs(Ai,{children:[s.jsx(Vo,{asChild:!0,children:s.jsx(we,{variant:"ghost",size:"icon",className:"touch-target",children:s.jsx(Tl,{className:"w-4 h-4"})})}),s.jsx(qo,{className:"w-48 p-2",align:"end",children:s.jsxs("div",{className:"space-y-1",children:[e.isOwner&&!_&&s.jsxs(we,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-500",onClick:_?()=>F(!0):N,disabled:_,children:[s.jsx(_s,{className:"w-4 h-4 mr-2"}),"삭제하기"]}),!e.isOwner&&!_&&s.jsxs(we,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-500",onClick:_?()=>F(!0):R,disabled:_,children:[s.jsx(Sl,{className:"w-4 h-4 mr-2"}),"신고하기"]})]})})]})})]}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-medium mb-3",children:e.title}),s.jsx("div",{className:"text-base text-foreground/90 leading-7 break-words [&>div:not(:first-child)]:mt-5 [&>div:not(:last-child)]:mb-0",children:L(e.content)})]}),e.tags&&e.tags.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.map(ae=>s.jsxs(dn,{variant:"secondary",children:["#",ae]},ae))}),s.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[e.author!==t&&!_?s.jsxs(we,{variant:"ghost",size:"sm",onClick:_?()=>F(!0):u,className:`space-x-2 touch-target ${a?"text-amber-500":""}`,disabled:_,children:[a?s.jsx(Go,{className:"w-4 h-4 text-amber-500"}):s.jsx(Rn,{className:"w-4 h-4"}),s.jsx("span",{children:e.lanterns})]}):s.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[s.jsx(Rn,{className:"w-4 h-4"}),s.jsx("span",{children:e.lanterns})]}),s.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[s.jsx(ai,{className:"w-4 h-4"}),s.jsx("span",{children:e.comments??e.replies?.length??0})]}),s.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[s.jsx(Vd,{className:"w-4 h-4"}),s.jsx("span",{children:e.views??0})]})]}),s.jsx(we,{variant:f?"default":"ghost",size:"sm",onClick:_?()=>F(!0):x,className:"flex items-center space-x-1 touch-target",disabled:_,children:s.jsx(ii,{className:`w-4 h-4 ${f?"fill-current":""}`})})]})]})})}),s.jsx(e0,{post:e,userNickname:t,userProfileImage:n,currentTitle:r,now:Z,hasGuide:b,isReplyLanterned:c,onReplyLanternToggle:d,onGuideSelect:S,onMentionReplyAuthor:j,onReplyAuthorClick:v,onReportReply:E,renderContentWithMentions:L,userProfiles:$,visibleReplies:te,blockedUserIds:i}),s.jsx(Ct,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm",children:s.jsx(St,{className:"p-4",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(Gl,{ref:p,placeholder:_?"로그인 후 답글을 작성할 수 있습니다.":O?"이 글에 대한 생각을 나눠보세요.":"신뢰도 0점에서는 답글을 작성할 수 없습니다",value:C,onChange:w,onKeyDown:fe,disabled:_||!O,className:"min-h-[100px] resize-none border-border/60 focus:border-primary/50 transition-colors duration-200 bg-background/50"}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"text-xs text-muted-foreground",children:[C.length,"/1000"]}),s.jsxs(we,{onClick:_?()=>F(!0):m,disabled:_||!C.trim()||!O,size:"sm",className:"touch-target px-6 py-2 rounded-xl transition-all duration-200 disabled:opacity-50",children:[s.jsx(cf,{className:"w-4 h-4 mr-2"}),"답글 작성"]})]})]})})})]})})]}),s.jsx(si,{open:z,onOpenChange:F,title:"로그인이 필요합니다.",description:"로그인 후 이 기능을 이용할 수 있습니다. 지금 로그인하시겠습니까?",confirmText:"로그인",onConfirm:M})]})}const e0=J.memo(function({post:t,userNickname:n,userProfileImage:r,currentTitle:o,now:i,hasGuide:a,visibleReplies:c,isReplyLanterned:u,onReplyLanternToggle:d,onGuideSelect:f,onMentionReplyAuthor:x,onReplyAuthorClick:y,onReportReply:b,renderContentWithMentions:S,userProfiles:C,blockedUserIds:w}){const m=t.author===n,p=J.useMemo(()=>!w||w.length===0?c:c.filter(g=>{const h=g.authorUid||g.userId;return h?!w.includes(h):!0}),[c,w]);return s.jsx("div",{className:"space-y-3",children:p.map(g=>s.jsx(t0,{reply:g,postId:t.id,userNickname:n,userProfileImage:r,currentTitle:o,now:i,isPostAuthor:m,isLanterned:u(g.id),isGuide:g.isGuide||t.guideReplyId===g.id,hasGuideAlready:a,onReplyLanternToggle:d,onGuideSelect:f,onMentionReplyAuthor:x,onReplyAuthorClick:y,onReportReply:b,renderContentWithMentions:S,userProfiles:C},g.id))})}),t0=J.memo(function({reply:t,postId:n,userNickname:r,userProfileImage:o,currentTitle:i,now:a,isPostAuthor:c,isLanterned:u,isGuide:d,hasGuideAlready:f,onReplyLanternToggle:x,onGuideSelect:y,onMentionReplyAuthor:b,onReplyAuthorClick:S,onReportReply:C,renderContentWithMentions:w,userProfiles:m}){const p=t.author===r,g=t.isAi===!0,h=t.aiLabel??"[AI 자동응답]",k=typeof t.aiSummary=="string"&&t.aiSummary.length>0?t.aiSummary:"1시간 동안 답변이 없어 자동으로 생성된 안내 답변입니다.",j=l.useCallback(()=>{x(t.id,n)},[x,n,t.id]),v=l.useCallback(()=>{y(t.id,t.author,n)},[y,n,t.author,t.id]),R=l.useCallback(()=>{b(t.author)},[b,t.author]),N=l.useCallback(()=>{S(t.author)},[S,t.author]),E=l.useCallback(()=>{C(t)},[C,t]),L=t.authorUid?m[t.authorUid]:void 0,O=L?.currentTitleId??null,I=Ei(O),P=p&&o?o:L?.profileImage??t.authorAvatar??null,_=Ni(t.author??"",r,i),M=I||_,z=t.authorDeleted===!0||t.author==="탈퇴한 사용자",F=di(t.author,z),Z=Mo(t.author,z),A=Z?null:P,T=Z?null:M;let $=null;if(t.createdAt instanceof Date)$=t.createdAt;else if(t.createdAt&&typeof t.createdAt.toDate=="function")$=t.createdAt.toDate();else if(typeof t.createdAt=="string"||typeof t.createdAt=="number"){const G=new Date(t.createdAt);Number.isNaN(G.getTime())||($=G)}let K="";$?K=Po($,a):typeof t.timeAgo=="string"&&t.timeAgo.length>0&&(K=t.timeAgo);const V=$?su($):"",q=l.useMemo(()=>typeof window>"u"?!1:(document.documentElement.getAttribute("data-theme")||"default")==="greek-temple",[]),se=l.useMemo(()=>typeof window>"u"?!1:(document.documentElement.getAttribute("data-theme")||"default")==="golden-library",[]);return s.jsx(Ct,{className:`border-border/60 shadow-sm bg-card/40 backdrop-blur-sm list-optimized ${d?se?"ring-2 ring-[#d4af37]/70 bg-[#d4af37]/5 border-[#d4af37]/50":"ring-2 ring-amber-500/50 bg-amber-500/5":""}`,children:s.jsx(St,{className:"p-4",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(hi,{src:A||void 0,alt:F?`${F}님의 프로필`:"프로필 이미지",nickname:Z?void 0:t.author||F,fallbackText:F.charAt(0)?.toUpperCase()||"?",className:"w-9 h-9 ring-2 ring-border/20 "+(Z?"":"cursor-pointer"),size:36,loading:"lazy",decoding:"async",onClick:Z?void 0:N}),s.jsx("div",{children:s.jsxs("div",{className:"flex items-center space-x-2",children:[q&&L?.trustScore!==void 0&&L.trustScore>=70&&s.jsx("div",{className:`shrink-0 ${q?"laurel-wreath-premium":"laurel-wreath"}`,children:s.jsx(Ii,{size:14,isPremium:q})}),s.jsx("p",{className:"font-medium text-sm "+(Z?"text-muted-foreground cursor-default":"cursor-pointer hover:text-primary transition-colors duration-200"),onClick:Z?void 0:R,children:F}),T&&s.jsx(dn,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:T}),g&&s.jsx(Ic,{children:s.jsxs(Mp,{children:[s.jsx(Dp,{asChild:!0,children:s.jsx(dn,{variant:"outline",className:"text-[10px] px-2 py-0.5 h-auto border-primary/40 text-primary bg-primary/5",children:h})}),s.jsx(Op,{side:"top",align:"start",children:s.jsx("p",{className:"max-w-xs text-xs leading-snug",children:k})})]})}),d&&s.jsxs(dn,{className:"bg-amber-500 text-white text-[10px] px-2 py-0 flex items-center",children:[s.jsx(yo,{className:"w-3 h-3 mr-1"}),"길잡이"]})]})})]}),!p&&s.jsxs(Ai,{children:[s.jsx(Vo,{asChild:!0,children:s.jsx(we,{variant:"ghost",size:"icon",className:"w-8 h-8",children:s.jsx(Tl,{className:"w-4 h-4"})})}),s.jsx(qo,{className:"w-48 p-2",align:"end",children:s.jsxs("div",{className:"space-y-1",children:[c&&!f&&!d&&!g&&s.jsxs(we,{variant:"ghost",size:"sm",className:"w-full justify-start text-amber-600",onClick:v,children:[s.jsx(yo,{className:"w-4 h-4 mr-2"}),"길잡이 선택"]}),s.jsxs(we,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-500",onClick:E,children:[s.jsx(Sl,{className:"w-4 h-4 mr-2"}),"신고하기"]})]})})]})]}),s.jsx("div",{className:"text-sm text-foreground/90 leading-6 break-words [&>div:not(:first-child)]:mt-4 [&>div:not(:last-child)]:mb-0",children:w(t.content)}),s.jsxs("div",{className:"flex items-center justify-between pt-2",children:[s.jsx("div",{className:"flex items-center space-x-3",children:p?s.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground px-2",children:[s.jsx(Rn,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs",children:t.lanterns})]}):s.jsxs(we,{variant:"ghost",size:"sm",onClick:j,className:`space-x-1 h-8 ${u?"text-amber-500":""}`,children:[u?s.jsx(Go,{className:"w-4 h-4 text-amber-500"}):s.jsx(Rn,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs",children:t.lanterns})]})}),s.jsx("div",{className:"flex flex-col items-end leading-tight text-xs text-muted-foreground",children:K&&s.jsx("span",{title:V||void 0,children:K})})]})]})})})},(e,t)=>!(e.reply.id!==t.reply.id||e.isLanterned!==t.isLanterned||e.isGuide!==t.isGuide||e.hasGuideAlready!==t.hasGuideAlready||e.reply.lanterns!==t.reply.lanterns||e.reply.content!==t.reply.content||e.reply.author!==t.reply.author||e.reply.authorAvatar!==t.reply.authorAvatar||e.reply.createdAt!==t.reply.createdAt||e.reply.authorUid!==t.reply.authorUid||e.reply.timeAgo!==t.reply.timeAgo||e.reply.isAi!==t.reply.isAi||e.reply.aiLabel!==t.reply.aiLabel||e.reply.aiSummary!==t.reply.aiSummary||e.userNickname!==t.userNickname||e.currentTitle!==t.currentTitle||e.userProfileImage!==t.userProfileImage||e.isPostAuthor!==t.isPostAuthor)),Yo=0,yn=1,Qn=2,iu=4;function Ha(e){return()=>e}function n0(e){e()}function au(e,t){return n=>e(t(n))}function $a(e,t){return()=>e(t)}function r0(e,t){return n=>e(t,n)}function Pi(e){return e!==void 0}function o0(...e){return()=>{e.map(n0)}}function Jn(){}function Xo(e,t){return t(e),e}function s0(e,t){return t(e)}function Ie(...e){return e}function Re(e,t){return e(yn,t)}function xe(e,t){e(Yo,t)}function _i(e){e(Qn)}function _e(e){return e(iu)}function re(e,t){return Re(e,r0(t,Yo))}function Nt(e,t){const n=e(yn,r=>{n(),t(r)});return n}function Wa(e){let t,n;return r=>o=>{t=o,n&&clearTimeout(n),n=setTimeout(()=>{r(t)},e)}}function lu(e,t){return e===t}function Ee(e=lu){let t;return n=>r=>{e(t,r)||(t=r,n(r))}}function ce(e){return t=>n=>{e(n)&&t(n)}}function ee(e){return t=>au(t,e)}function Dt(e){return t=>()=>{t(e)}}function W(e,...t){const n=i0(...t);return((r,o)=>{switch(r){case Qn:_i(e);return;case yn:return Re(e,n(o))}})}function Ut(e,t){return n=>r=>{n(t=e(t,r))}}function An(e){return t=>n=>{e>0?e--:t(n)}}function Kt(e){let t=null,n;return r=>o=>{t=o,!n&&(n=setTimeout(()=>{n=void 0,r(t)},e))}}function ye(...e){const t=new Array(e.length);let n=0,r=null;const o=Math.pow(2,e.length)-1;return e.forEach((i,a)=>{const c=Math.pow(2,a);Re(i,u=>{const d=n;n=n|c,t[a]=u,d!==o&&n===o&&r&&(r(),r=null)})}),i=>a=>{const c=()=>{i([a].concat(t))};n===o?c():r=c}}function i0(...e){return t=>e.reduceRight(s0,t)}function a0(e){let t,n;const r=()=>t?.();return function(o,i){switch(o){case yn:return i?n===i?void 0:(r(),n=i,t=Re(e,i),t):(r(),Jn);case Qn:r(),n=null;return}}}function Y(e){let t=e;const n=Ce();return((r,o)=>{switch(r){case Yo:t=o;break;case yn:{o(t);break}case iu:return t}return n(r,o)})}function Xe(e,t){return Xo(Y(t),n=>re(e,n))}function Ce(){const e=[];return((t,n)=>{switch(t){case Yo:e.slice().forEach(r=>{r(n)});return;case Qn:e.splice(0,e.length);return;case yn:return e.push(n),()=>{const r=e.indexOf(n);r>-1&&e.splice(r,1)}}})}function xt(e){return Xo(Ce(),t=>re(e,t))}function ke(e,t=[],{singleton:n}={singleton:!0}){return{constructor:e,dependencies:t,id:l0(),singleton:n}}const l0=()=>Symbol();function c0(e){const t=new Map,n=({constructor:r,dependencies:o,id:i,singleton:a})=>{if(a&&t.has(i))return t.get(i);const c=r(o.map(u=>n(u)));return a&&t.set(i,c),c};return n(e)}function De(...e){const t=Ce(),n=new Array(e.length);let r=0;const o=Math.pow(2,e.length)-1;return e.forEach((i,a)=>{const c=Math.pow(2,a);Re(i,u=>{n[a]=u,r=r|c,r===o&&xe(t,n)})}),function(i,a){switch(i){case Qn:{_i(t);return}case yn:return r===o&&a(n),Re(t,a)}}}function le(e,t=lu){return W(e,Ee(t))}function Xs(...e){return function(t,n){switch(t){case Qn:return;case yn:return o0(...e.map(r=>Re(r,n)))}}}var it=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(it||{});const u0={0:"debug",3:"error",1:"log",2:"warn"},d0=()=>typeof globalThis>"u"?window:globalThis,vn=ke(()=>{const e=Y(3);return{log:Y((t,n,r=1)=>{var o;const i=(o=d0().VIRTUOSO_LOG_LEVEL)!=null?o:_e(e);r>=i}),logLevel:e}},[],{singleton:!0});function Nn(e,t,n){return Li(e,t,n).callbackRef}function Li(e,t,n){const r=J.useRef(null);let o=a=>{};const i=J.useMemo(()=>typeof ResizeObserver<"u"?new ResizeObserver(a=>{const c=()=>{const u=a[0].target;u.offsetParent!==null&&e(u)};n?c():requestAnimationFrame(c)}):null,[e,n]);return o=a=>{a&&t?(i?.observe(a),r.current=a):(r.current&&i?.unobserve(r.current),r.current=null)},{callbackRef:o,ref:r}}function f0(e,t,n,r,o,i,a,c,u){const d=J.useCallback(f=>{const x=h0(f.children,t,c?"offsetWidth":"offsetHeight",o);let y=f.parentElement;for(;!y.dataset.virtuosoScroller;)y=y.parentElement;const b=y.lastElementChild.dataset.viewportType==="window";let S;b&&(S=y.ownerDocument.defaultView);const C=a?c?a.scrollLeft:a.scrollTop:b?c?S.scrollX||S.document.documentElement.scrollLeft:S.scrollY||S.document.documentElement.scrollTop:c?y.scrollLeft:y.scrollTop,w=a?c?a.scrollWidth:a.scrollHeight:b?c?S.document.documentElement.scrollWidth:S.document.documentElement.scrollHeight:c?y.scrollWidth:y.scrollHeight,m=a?c?a.offsetWidth:a.offsetHeight:b?c?S.innerWidth:S.innerHeight:c?y.offsetWidth:y.offsetHeight;r({scrollHeight:w,scrollTop:Math.max(C,0),viewportHeight:m}),i?.(c?Va("column-gap",getComputedStyle(f).columnGap,o):Va("row-gap",getComputedStyle(f).rowGap,o)),x!==null&&e(x)},[e,t,o,i,a,r,c]);return Li(d,n,u)}function h0(e,t,n,r){const o=e.length;if(o===0)return null;const i=[];for(let a=0;a<o;a++){const c=e.item(a);if(c.dataset.index===void 0)continue;const u=parseInt(c.dataset.index),d=parseFloat(c.dataset.knownSize),f=t(c,n);if(f===0&&r("Zero-sized element, this should not happen",{child:c},it.ERROR),f===d)continue;const x=i[i.length-1];i.length===0||x.size!==f||x.endIndex!==u-1?i.push({endIndex:u,size:f,startIndex:u}):i[i.length-1].endIndex++}return i}function Va(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,it.WARN),t==="normal"?0:parseInt(t??"0",10)}function cu(e,t,n){const r=J.useRef(null),o=J.useCallback(u=>{if(!(u!=null&&u.offsetParent))return;const d=u.getBoundingClientRect(),f=d.width;let x,y;if(t){const b=t.getBoundingClientRect(),S=d.top-b.top;y=b.height-Math.max(0,S),x=S+t.scrollTop}else{const b=a.current.ownerDocument.defaultView;y=b.innerHeight-Math.max(0,d.top),x=d.top+b.scrollY}r.current={offsetTop:x,visibleHeight:y,visibleWidth:f},e(r.current)},[e,t]),{callbackRef:i,ref:a}=Li(o,!0,n),c=J.useCallback(()=>{o(a.current)},[o,a]);return J.useEffect(()=>{var u;if(t){t.addEventListener("scroll",c);const d=new ResizeObserver(()=>{requestAnimationFrame(c)});return d.observe(t),()=>{t.removeEventListener("scroll",c),d.unobserve(t)}}else{const d=(u=a.current)==null?void 0:u.ownerDocument.defaultView;return d?.addEventListener("scroll",c),d?.addEventListener("resize",c),()=>{d?.removeEventListener("scroll",c),d?.removeEventListener("resize",c)}}},[c,t,a]),i}const nt=ke(()=>{const e=Ce(),t=Ce(),n=Y(0),r=Ce(),o=Y(0),i=Ce(),a=Ce(),c=Y(0),u=Y(0),d=Y(0),f=Y(0),x=Ce(),y=Ce(),b=Y(!1),S=Y(!1),C=Y(!1);return re(W(e,ee(({scrollTop:w})=>w)),t),re(W(e,ee(({scrollHeight:w})=>w)),a),re(t,o),{deviation:n,fixedFooterHeight:d,fixedHeaderHeight:u,footerHeight:f,headerHeight:c,horizontalDirection:S,scrollBy:y,scrollContainerState:e,scrollHeight:a,scrollingInProgress:b,scrollTo:x,scrollTop:t,skipAnimationFrameInResizeObserver:C,smoothScrollTargetReached:r,statefulScrollTop:o,viewportHeight:i}},[],{singleton:!0}),Cr={lvl:0};function uu(e,t){const n=e.length;if(n===0)return[];let{index:r,value:o}=t(e[0]);const i=[];for(let a=1;a<n;a++){const{index:c,value:u}=t(e[a]);i.push({end:c-1,start:r,value:o}),r=c,o=u}return i.push({end:1/0,start:r,value:o}),i}function Ae(e){return e===Cr}function Sr(e,t){if(!Ae(e))return t===e.k?e.v:t<e.k?Sr(e.l,t):Sr(e.r,t)}function _t(e,t,n="k"){if(Ae(e))return[-1/0,void 0];if(Number(e[n])===t)return[e.k,e.v];if(Number(e[n])<t){const r=_t(e.r,t,n);return r[0]===-1/0?[e.k,e.v]:r}return _t(e.l,t,n)}function mt(e,t,n){return Ae(e)?hu(t,n,1):t===e.k?Ue(e,{k:t,v:n}):t<e.k?qa(Ue(e,{l:mt(e.l,t,n)})):qa(Ue(e,{r:mt(e.r,t,n)}))}function $n(){return Cr}function Wn(e,t,n){if(Ae(e))return[];const r=_t(e,t)[0];return m0(Ks(e,r,n))}function Zs(e,t){if(Ae(e))return Cr;const{k:n,l:r,r:o}=e;if(t===n){if(Ae(r))return o;if(Ae(o))return r;{const[i,a]=fu(r);return ho(Ue(e,{k:i,l:du(r),v:a}))}}else return t<n?ho(Ue(e,{l:Zs(r,t)})):ho(Ue(e,{r:Zs(o,t)}))}function Tn(e){return Ae(e)?[]:[...Tn(e.l),{k:e.k,v:e.v},...Tn(e.r)]}function Ks(e,t,n){if(Ae(e))return[];const{k:r,l:o,r:i,v:a}=e;let c=[];return r>t&&(c=c.concat(Ks(o,t,n))),r>=t&&r<=n&&c.push({k:r,v:a}),r<=n&&(c=c.concat(Ks(i,t,n))),c}function ho(e){const{l:t,lvl:n,r}=e;if(r.lvl>=n-1&&t.lvl>=n-1)return e;if(n>r.lvl+1){if(Rs(t))return mu(Ue(e,{lvl:n-1}));if(!Ae(t)&&!Ae(t.r))return Ue(t.r,{l:Ue(t,{r:t.r.l}),lvl:n,r:Ue(e,{l:t.r.r,lvl:n-1})});throw new Error("Unexpected empty nodes")}else{if(Rs(e))return Qs(Ue(e,{lvl:n-1}));if(!Ae(r)&&!Ae(r.l)){const o=r.l,i=Rs(o)?r.lvl-1:r.lvl;return Ue(o,{l:Ue(e,{lvl:n-1,r:o.l}),lvl:o.lvl+1,r:Qs(Ue(r,{l:o.r,lvl:i}))})}else throw new Error("Unexpected empty nodes")}}function Ue(e,t){return hu(t.k!==void 0?t.k:e.k,t.v!==void 0?t.v:e.v,t.lvl!==void 0?t.lvl:e.lvl,t.l!==void 0?t.l:e.l,t.r!==void 0?t.r:e.r)}function du(e){return Ae(e.r)?e.l:ho(Ue(e,{r:du(e.r)}))}function Rs(e){return Ae(e)||e.lvl>e.r.lvl}function fu(e){return Ae(e.r)?[e.k,e.v]:fu(e.r)}function hu(e,t,n,r=Cr,o=Cr){return{k:e,l:r,lvl:n,r:o,v:t}}function qa(e){return Qs(mu(e))}function mu(e){const{l:t}=e;return!Ae(t)&&t.lvl===e.lvl?Ue(t,{r:Ue(e,{l:t.r})}):e}function Qs(e){const{lvl:t,r:n}=e;return!Ae(n)&&!Ae(n.r)&&n.lvl===t&&n.r.lvl===t?Ue(n,{l:Ue(e,{r:n.l}),lvl:t+1}):e}function m0(e){return uu(e,({k:t,v:n})=>({index:t,value:n}))}function pu(e,t){return!!(e&&e.startIndex===t.startIndex&&e.endIndex===t.endIndex)}function kr(e,t){return!!(e&&e[0]===t[0]&&e[1]===t[1])}const Mi=ke(()=>({recalcInProgress:Y(!1)}),[],{singleton:!0});function gu(e,t,n){return e[Ao(e,t,n)]}function Ao(e,t,n,r=0){let o=e.length-1;for(;r<=o;){const i=Math.floor((r+o)/2),a=e[i],c=n(a,t);if(c===0)return i;if(c===-1){if(o-r<2)return i-1;o=i-1}else{if(o===r)return i;r=i+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function p0(e,t,n,r){const o=Ao(e,t,r),i=Ao(e,n,r,o);return e.slice(o,i+1)}function pn(e,t){return Math.round(e.getBoundingClientRect()[t])}function Zo(e){return!Ae(e.groupOffsetTree)}function Di({index:e},t){return t===e?0:t<e?-1:1}function g0(){return{groupIndices:[],groupOffsetTree:$n(),lastIndex:0,lastOffset:0,lastSize:0,offsetTree:[],sizeTree:$n()}}function x0(e,t){let n=Ae(e)?0:1/0;for(const r of t){const{endIndex:o,size:i,startIndex:a}=r;if(n=Math.min(n,a),Ae(e)){e=mt(e,0,i);continue}const c=Wn(e,a-1,o+1);if(c.some(k0(r)))continue;let u=!1,d=!1;for(const{end:f,start:x,value:y}of c)u?(o>=x||i===y)&&(e=Zs(e,x)):(d=y!==i,u=!0),f>o&&o>=x&&y!==i&&(e=mt(e,o+1,y));d&&(e=mt(e,a,i))}return[e,n]}function y0(e){return typeof e.groupIndex<"u"}function v0({offset:e},t){return t===e?0:t<e?-1:1}function Tr(e,t,n){if(t.length===0)return 0;const{index:r,offset:o,size:i}=gu(t,e,Di),a=e-r,c=i*a+(a-1)*n+o;return c>0?c+n:c}function xu(e,t){if(!Zo(t))return e;let n=0;for(;t.groupIndices[n]<=e+n;)n++;return e+n}function yu(e,t,n){if(y0(e))return t.groupIndices[e.groupIndex]+1;{const r=e.index==="LAST"?n:e.index;let o=xu(r,t);return o=Math.max(0,o,Math.min(n,o)),o}}function w0(e,t,n,r=0){return r>0&&(t=Math.max(t,gu(e,r,Di).offset)),uu(p0(e,t,n,v0),S0)}function b0(e,[t,n,r,o]){t.length>0&&r("received item sizes",t,it.DEBUG);const i=e.sizeTree;let a=i,c=0;if(n.length>0&&Ae(i)&&t.length===2){const y=t[0].size,b=t[1].size;a=n.reduce((S,C)=>mt(mt(S,C,y),C+1,b),a)}else[a,c]=x0(a,t);if(a===i)return e;const{lastIndex:u,lastOffset:d,lastSize:f,offsetTree:x}=Js(e.offsetTree,c,a,o);return{groupIndices:n,groupOffsetTree:n.reduce((y,b)=>mt(y,b,Tr(b,x,o)),$n()),lastIndex:u,lastOffset:d,lastSize:f,offsetTree:x,sizeTree:a}}function C0(e){return Tn(e).map(({k:t,v:n},r,o)=>{const i=o[r+1];return{endIndex:i?i.k-1:1/0,size:n,startIndex:t}})}function Ga(e,t){let n=0,r=0;for(;n<e;)n+=t[r+1]-t[r]-1,r++;return r-(n===e?0:1)}function Js(e,t,n,r){let o=e,i=0,a=0,c=0,u=0;if(t!==0){u=Ao(o,t-1,Di),c=o[u].offset;const d=_t(n,t-1);i=d[0],a=d[1],o.length&&o[u].size===_t(n,t)[1]&&(u-=1),o=o.slice(0,u+1)}else o=[];for(const{start:d,value:f}of Wn(n,t,1/0)){const x=d-i,y=x*a+c+x*r;o.push({index:d,offset:y,size:f}),i=d,c=y,a=f}return{lastIndex:i,lastOffset:c,lastSize:a,offsetTree:o}}function S0(e){return{index:e.index,value:e}}function k0(e){const{endIndex:t,size:n,startIndex:r}=e;return o=>o.start===r&&(o.end===t||o.end===1/0)&&o.value===n}const T0={offsetHeight:"height",offsetWidth:"width"},qt=ke(([{log:e},{recalcInProgress:t}])=>{const n=Ce(),r=Ce(),o=Xe(r,0),i=Ce(),a=Ce(),c=Y(0),u=Y([]),d=Y(void 0),f=Y(void 0),x=Y(void 0),y=Y(void 0),b=Y((v,R)=>pn(v,T0[R])),S=Y(void 0),C=Y(0),w=g0(),m=Xe(W(n,ye(u,e,C),Ut(b0,w),Ee()),w),p=Xe(W(u,Ee(),Ut((v,R)=>({current:R,prev:v.current}),{current:[],prev:[]}),ee(({prev:v})=>v)),[]);re(W(u,ce(v=>v.length>0),ye(m,C),ee(([v,R,N])=>{const E=v.reduce((L,O,I)=>mt(L,O,Tr(O,R.offsetTree,N)||I),$n());return{...R,groupIndices:v,groupOffsetTree:E}})),m),re(W(r,ye(m),ce(([v,{lastIndex:R}])=>v<R),ee(([v,{lastIndex:R,lastSize:N}])=>[{endIndex:R,size:N,startIndex:v}])),n),re(d,f);const g=Xe(W(d,ee(v=>v===void 0)),!0);re(W(f,ce(v=>v!==void 0&&Ae(_e(m).sizeTree)),ee(v=>{const R=_e(x),N=_e(u).length>0;return R?N?[{endIndex:0,size:R,startIndex:0},{endIndex:1,size:v,startIndex:1}]:[]:[{endIndex:0,size:v,startIndex:0}]})),n),re(W(y,ce(v=>v!==void 0&&v.length>0&&Ae(_e(m).sizeTree)),ee(v=>{const R=[];let N=v[0],E=0;for(let L=1;L<v.length;L++){const O=v[L];O!==N&&(R.push({endIndex:L-1,size:N,startIndex:E}),N=O,E=L)}return R.push({endIndex:v.length-1,size:N,startIndex:E}),R})),n),re(W(u,ye(x,f),ce(([,v,R])=>v!==void 0&&R!==void 0),ee(([v,R,N])=>{const E=[];for(let L=0;L<v.length;L++){const O=v[L],I=v[L+1];E.push({startIndex:O,endIndex:O,size:R}),I!==void 0&&E.push({startIndex:O+1,endIndex:I-1,size:N})}return E})),n);const h=xt(W(n,ye(m),Ut(({sizes:v},[R,N])=>({changed:N!==v,sizes:N}),{changed:!1,sizes:w}),ee(v=>v.changed)));Re(W(c,Ut((v,R)=>({diff:v.prev-R,prev:R}),{diff:0,prev:0}),ee(v=>v.diff)),v=>{const{groupIndices:R}=_e(m);if(v>0)xe(t,!0),xe(i,v+Ga(v,R));else if(v<0){const N=_e(p);N.length>0&&(v-=Ga(-v,N)),xe(a,v)}}),Re(W(c,ye(e)),([v,R])=>{v<0&&R("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:c},it.ERROR)});const k=xt(i);re(W(i,ye(m),ee(([v,R])=>{const N=R.groupIndices.length>0,E=[],L=R.lastSize;if(N){const O=Sr(R.sizeTree,0);let I=0,P=0;for(;I<v;){const M=R.groupIndices[P],z=R.groupIndices.length===P+1?1/0:R.groupIndices[P+1]-M-1;E.push({endIndex:M,size:O,startIndex:M}),E.push({endIndex:M+1+z-1,size:L,startIndex:M+1}),P++,I+=z+1}const _=Tn(R.sizeTree);return I!==v&&_.shift(),_.reduce((M,{k:z,v:F})=>{let Z=M.ranges;return M.prevSize!==0&&(Z=[...M.ranges,{endIndex:z+v-1,size:M.prevSize,startIndex:M.prevIndex}]),{prevIndex:z+v,prevSize:F,ranges:Z}},{prevIndex:v,prevSize:0,ranges:E}).ranges}return Tn(R.sizeTree).reduce((O,{k:I,v:P})=>({prevIndex:I+v,prevSize:P,ranges:[...O.ranges,{endIndex:I+v-1,size:O.prevSize,startIndex:O.prevIndex}]}),{prevIndex:0,prevSize:L,ranges:[]}).ranges})),n);const j=xt(W(a,ye(m,C),ee(([v,{offsetTree:R},N])=>{const E=-v;return Tr(E,R,N)})));return re(W(a,ye(m,C),ee(([v,R,N])=>{if(R.groupIndices.length>0){if(Ae(R.sizeTree))return R;let E=$n();const L=_e(p);let O=0,I=0,P=0;for(;O<-v;){P=L[I];const _=L[I+1]-P-1;I++,O+=_+1}if(E=Tn(R.sizeTree).reduce((_,{k:M,v:z})=>mt(_,Math.max(0,M+v),z),E),O!==-v){const _=Sr(R.sizeTree,P);E=mt(E,0,_);const M=_t(R.sizeTree,-v+1)[1];E=mt(E,1,M)}return{...R,sizeTree:E,...Js(R.offsetTree,0,E,N)}}else{const E=Tn(R.sizeTree).reduce((L,{k:O,v:I})=>mt(L,Math.max(0,O+v),I),$n());return{...R,sizeTree:E,...Js(R.offsetTree,0,E,N)}}})),m),{beforeUnshiftWith:k,data:S,defaultItemSize:f,firstItemIndex:c,fixedItemSize:d,fixedGroupSize:x,gap:C,groupIndices:u,heightEstimates:y,itemSize:b,listRefresh:h,shiftWith:a,shiftWithOffset:j,sizeRanges:n,sizes:m,statefulTotalCount:o,totalCount:r,trackItemSizes:g,unshiftWith:i}},Ie(vn,Mi),{singleton:!0});function j0(e){return e.reduce((t,n)=>(t.groupIndices.push(t.totalCount),t.totalCount+=n+1,t),{groupIndices:[],totalCount:0})}const vu=ke(([{groupIndices:e,sizes:t,totalCount:n},{headerHeight:r,scrollTop:o}])=>{const i=Ce(),a=Ce(),c=xt(W(i,ee(j0)));return re(W(c,ee(u=>u.totalCount)),n),re(W(c,ee(u=>u.groupIndices)),e),re(W(De(o,t,r),ce(([u,d])=>Zo(d)),ee(([u,d,f])=>_t(d.groupOffsetTree,Math.max(u-f,0),"v")[0]),Ee(),ee(u=>[u])),a),{groupCounts:i,topItemsIndexes:a}},Ie(qt,nt)),wn=ke(([{log:e}])=>{const t=Y(!1),n=xt(W(t,ce(r=>r),Ee()));return Re(t,r=>{r&&_e(e)("props updated",{},it.DEBUG)}),{didMount:n,propsReady:t}},Ie(vn),{singleton:!0}),R0=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function wu(e){const t=typeof e=="number"?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!R0)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const Pr=ke(([{gap:e,listRefresh:t,sizes:n,totalCount:r},{fixedFooterHeight:o,fixedHeaderHeight:i,footerHeight:a,headerHeight:c,scrollingInProgress:u,scrollTo:d,smoothScrollTargetReached:f,viewportHeight:x},{log:y}])=>{const b=Ce(),S=Ce(),C=Y(0);let w=null,m=null,p=null;function g(){w&&(w(),w=null),p&&(p(),p=null),m&&(clearTimeout(m),m=null),xe(u,!1)}return re(W(b,ye(n,x,r,C,c,a,y),ye(e,i,o),ee(([[h,k,j,v,R,N,E,L],O,I,P])=>{const _=wu(h),{align:M,behavior:z,offset:F}=_,Z=v-1,A=yu(_,k,Z);let T=Tr(A,k.offsetTree,O)+N;M==="end"?(T+=I+_t(k.sizeTree,A)[1]-j+P,A===Z&&(T+=E)):M==="center"?T+=(I+_t(k.sizeTree,A)[1]-j+P)/2:T-=R,F&&(T+=F);const $=K=>{g(),K?(L("retrying to scroll to",{location:h},it.DEBUG),xe(b,h)):(xe(S,!0),L("list did not change, scroll successful",{},it.DEBUG))};if(g(),z==="smooth"){let K=!1;p=Re(t,V=>{K=K||V}),w=Nt(f,()=>{$(K)})}else w=Nt(W(t,A0(150)),$);return m=setTimeout(()=>{g()},1200),xe(u,!0),L("scrolling from index to",{behavior:z,index:A,top:T},it.DEBUG),{behavior:z,top:T}})),d),{scrollTargetReached:S,scrollToIndex:b,topListHeight:C}},Ie(qt,nt,vn),{singleton:!0});function A0(e){return t=>{const n=setTimeout(()=>{t(!1)},e);return r=>{r&&(t(!0),clearTimeout(n))}}}function Oi(e,t){e==0?t():requestAnimationFrame(()=>{Oi(e-1,t)})}function zi(e,t){const n=t-1;return typeof e=="number"?e:e.index==="LAST"?n:e.index}const _r=ke(([{defaultItemSize:e,listRefresh:t,sizes:n},{scrollTop:r},{scrollTargetReached:o,scrollToIndex:i},{didMount:a}])=>{const c=Y(!0),u=Y(0),d=Y(!0);return re(W(a,ye(u),ce(([f,x])=>!!x),Dt(!1)),c),re(W(a,ye(u),ce(([f,x])=>!!x),Dt(!1)),d),Re(W(De(t,a),ye(c,n,e,d),ce(([[,f],x,{sizeTree:y},b,S])=>f&&(!Ae(y)||Pi(b))&&!x&&!S),ye(u)),([,f])=>{Nt(o,()=>{xe(d,!0)}),Oi(4,()=>{Nt(r,()=>{xe(c,!0)}),xe(i,f)})}),{initialItemFinalLocationReached:d,initialTopMostItemIndex:u,scrolledToInitialItem:c}},Ie(qt,nt,Pr,wn),{singleton:!0});function bu(e,t){return Math.abs(e-t)<1.01}const jr="up",pr="down",N0="none",E0={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollHeight:0,scrollTop:0,viewportHeight:0}},I0=0,Lr=ke(([{footerHeight:e,headerHeight:t,scrollBy:n,scrollContainerState:r,scrollTop:o,viewportHeight:i}])=>{const a=Y(!1),c=Y(!0),u=Ce(),d=Ce(),f=Y(4),x=Y(I0),y=Xe(W(Xs(W(le(o),An(1),Dt(!0)),W(le(o),An(1),Dt(!1),Wa(100))),Ee()),!1),b=Xe(W(Xs(W(n,Dt(!0)),W(n,Dt(!1),Wa(200))),Ee()),!1);re(W(De(le(o),le(x)),ee(([p,g])=>p<=g),Ee()),c),re(W(c,Kt(50)),d);const S=xt(W(De(r,le(i),le(t),le(e),le(f)),Ut((p,[{scrollHeight:g,scrollTop:h},k,j,v,R])=>{const N=h+k-g>-R,E={scrollHeight:g,scrollTop:h,viewportHeight:k};if(N){let O,I;return h>p.state.scrollTop?(O="SCROLLED_DOWN",I=p.state.scrollTop-h):(O="SIZE_DECREASED",I=p.state.scrollTop-h||p.scrollTopDelta),{atBottom:!0,atBottomBecause:O,scrollTopDelta:I,state:E}}let L;return E.scrollHeight>p.state.scrollHeight?L="SIZE_INCREASED":k<p.state.viewportHeight?L="VIEWPORT_HEIGHT_DECREASING":h<p.state.scrollTop?L="SCROLLING_UPWARDS":L="NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:L,state:E}},E0),Ee((p,g)=>p&&p.atBottom===g.atBottom))),C=Xe(W(r,Ut((p,{scrollHeight:g,scrollTop:h,viewportHeight:k})=>{if(bu(p.scrollHeight,g))return{changed:!1,jump:0,scrollHeight:g,scrollTop:h};{const j=g-(h+k)<1;return p.scrollTop!==h&&j?{changed:!0,jump:p.scrollTop-h,scrollHeight:g,scrollTop:h}:{changed:!0,jump:0,scrollHeight:g,scrollTop:h}}},{changed:!1,jump:0,scrollHeight:0,scrollTop:0}),ce(p=>p.changed),ee(p=>p.jump)),0);re(W(S,ee(p=>p.atBottom)),a),re(W(a,Kt(50)),u);const w=Y(pr);re(W(r,ee(({scrollTop:p})=>p),Ee(),Ut((p,g)=>_e(b)?{direction:p.direction,prevScrollTop:g}:{direction:g<p.prevScrollTop?jr:pr,prevScrollTop:g},{direction:pr,prevScrollTop:0}),ee(p=>p.direction)),w),re(W(r,Kt(50),Dt(N0)),w);const m=Y(0);return re(W(y,ce(p=>!p),Dt(0)),m),re(W(o,Kt(100),ye(y),ce(([p,g])=>g),Ut(([p,g],[h])=>[g,h],[0,0]),ee(([p,g])=>g-p)),m),{atBottomState:S,atBottomStateChange:u,atBottomThreshold:f,atTopStateChange:d,atTopThreshold:x,isAtBottom:a,isAtTop:c,isScrolling:y,lastJumpDueToItemResize:C,scrollDirection:w,scrollVelocity:m}},Ie(nt)),Rr="top",Ar="bottom",Ya="none";function Xa(e,t,n){return typeof e=="number"?n===jr&&t===Rr||n===pr&&t===Ar?e:0:n===jr?t===Rr?e.main:e.reverse:t===Ar?e.main:e.reverse}function Za(e,t){var n;return typeof e=="number"?e:(n=e[t])!=null?n:0}const Ui=ke(([{deviation:e,fixedHeaderHeight:t,headerHeight:n,scrollTop:r,viewportHeight:o}])=>{const i=Ce(),a=Y(0),c=Y(0),u=Y(0),d=Xe(W(De(le(r),le(o),le(n),le(i,kr),le(u),le(a),le(t),le(e),le(c)),ee(([f,x,y,[b,S],C,w,m,p,g])=>{const h=f-p,k=w+m,j=Math.max(y-h,0);let v=Ya;const R=Za(g,Rr),N=Za(g,Ar);return b-=p,b+=y+m,S+=y+m,S-=p,b>f+k-R&&(v=jr),S<f-j+x+N&&(v=pr),v!==Ya?[Math.max(h-y-Xa(C,Rr,v)-R,0),h-j-m+x+Xa(C,Ar,v)+N]:null}),ce(f=>f!=null),Ee(kr)),[0,0]);return{increaseViewportBy:c,listBoundary:i,overscan:u,topListHeight:a,visibleRange:d}},Ie(nt),{singleton:!0});function P0(e,t,n){if(Zo(t)){const r=xu(e,t);return[{index:_t(t.groupOffsetTree,r)[0],offset:0,size:0},{data:n?.[0],index:r,offset:0,size:0}]}return[{data:n?.[0],index:e,offset:0,size:0}]}const As={bottom:0,firstItemIndex:0,items:[],offsetBottom:0,offsetTop:0,top:0,topItems:[],topListHeight:0,totalCount:0};function mo(e,t,n,r,o,i){const{lastIndex:a,lastOffset:c,lastSize:u}=o;let d=0,f=0;if(e.length>0){d=e[0].offset;const C=e[e.length-1];f=C.offset+C.size}const x=n-a,y=c+x*u+(x-1)*r,b=d,S=y-f;return{bottom:f,firstItemIndex:i,items:Ka(e,o,i),offsetBottom:S,offsetTop:d,top:b,topItems:Ka(t,o,i),topListHeight:t.reduce((C,w)=>w.size+C,0),totalCount:n}}function Cu(e,t,n,r,o,i){let a=0;if(n.groupIndices.length>0)for(const f of n.groupIndices){if(f-a>=e)break;a++}const c=e+a,u=zi(t,c),d=Array.from({length:c}).map((f,x)=>({data:i[x+u],index:x+u,offset:0,size:0}));return mo(d,[],c,o,n,r)}function Ka(e,t,n){if(e.length===0)return[];if(!Zo(t))return e.map(d=>({...d,index:d.index+n,originalIndex:d.index}));const r=e[0].index,o=e[e.length-1].index,i=[],a=Wn(t.groupOffsetTree,r,o);let c,u=0;for(const d of e){(!c||c.end<d.index)&&(c=a.shift(),u=t.groupIndices.indexOf(c.start));let f;d.index===c.start?f={index:u,type:"group"}:f={groupIndex:u,index:d.index-(u+1)+n},i.push({...f,data:d.data,offset:d.offset,originalIndex:d.index,size:d.size})}return i}function Qa(e,t){var n;return e===void 0?0:typeof e=="number"?e:(n=e[t])!=null?n:0}const En=ke(([{data:e,firstItemIndex:t,gap:n,sizes:r,totalCount:o},i,{listBoundary:a,topListHeight:c,visibleRange:u},{initialTopMostItemIndex:d,scrolledToInitialItem:f},{topListHeight:x},y,{didMount:b},{recalcInProgress:S}])=>{const C=Y([]),w=Y(0),m=Ce(),p=Y(0);re(i.topItemsIndexes,C);const g=Xe(W(De(b,S,le(u,kr),le(o),le(r),le(d),f,le(C),le(t),le(n),le(p),e),ce(([v,R,,N,,,,,,,,E])=>{const L=E&&E.length!==N;return v&&!R&&!L}),ee(([,,[v,R],N,E,L,O,I,P,_,M,z])=>{var F,Z,A,T;const $=E,{offsetTree:K,sizeTree:V}=$,q=_e(w);if(N===0)return{...As,totalCount:N};if(v===0&&R===0)return q===0?{...As,totalCount:N}:Cu(q,L,E,P,_,z||[]);if(Ae(V))return q>0?null:mo(P0(zi(L,N),$,z),[],N,_,$,P);const se=[];if(I.length>0){const fe=I[0],ne=I[I.length-1];let ae=0;for(const ue of Wn(V,fe,ne)){const ie=ue.value,de=Math.max(ue.start,fe),Se=Math.min(ue.end,ne);for(let Te=de;Te<=Se;Te++)se.push({data:z?.[Te],index:Te,offset:ae,size:ie}),ae+=ie}}if(!O)return mo([],se,N,_,$,P);const G=I.length>0?I[I.length-1]+1:0,B=w0(K,v,R,G);if(B.length===0)return null;const te=N-1,oe=Xo([],fe=>{for(const ne of B){const ae=ne.value;let ue=ae.offset,ie=ne.start;const de=ae.size;if(ae.offset<v){ie+=Math.floor((v-ae.offset+_)/(de+_));const Te=ie-ne.start;ue+=Te*de+Te*_}ie<G&&(ue+=(G-ie)*de,ie=G);const Se=Math.min(ne.end,te);for(let Te=ie;Te<=Se&&!(ue>=R);Te++)fe.push({data:z?.[Te],index:Te,offset:ue,size:de}),ue+=de+_}}),Q=Qa(M,Rr),me=Qa(M,Ar);if(oe.length>0&&(Q>0||me>0)){const fe=oe[0],ne=oe[oe.length-1];if(Q>0&&fe.index>G){const ae=Math.min(Q,fe.index-G),ue=[];let ie=fe.offset;for(let de=fe.index-1;de>=fe.index-ae;de--){const Se=(Z=(F=Wn(V,de,de)[0])==null?void 0:F.value)!=null?Z:fe.size;ie-=Se+_,ue.unshift({data:z?.[de],index:de,offset:ie,size:Se})}oe.unshift(...ue)}if(me>0&&ne.index<te){const ae=Math.min(me,te-ne.index);let ue=ne.offset+ne.size+_;for(let ie=ne.index+1;ie<=ne.index+ae;ie++){const de=(T=(A=Wn(V,ie,ie)[0])==null?void 0:A.value)!=null?T:ne.size;oe.push({data:z?.[ie],index:ie,offset:ue,size:de}),ue+=de+_}}}return mo(oe,se,N,_,$,P)}),ce(v=>v!==null),Ee()),As);re(W(e,ce(Pi),ee(v=>v?.length)),o),re(W(g,ee(v=>v.topListHeight)),x),re(x,c),re(W(g,ee(v=>[v.top,v.bottom])),a),re(W(g,ee(v=>v.items)),m);const h=xt(W(g,ce(({items:v})=>v.length>0),ye(o,e),ce(([{items:v},R])=>v[v.length-1].originalIndex===R-1),ee(([,v,R])=>[v-1,R]),Ee(kr),ee(([v])=>v))),k=xt(W(g,Kt(200),ce(({items:v,topItems:R})=>v.length>0&&v[0].originalIndex===R.length),ee(({items:v})=>v[0].index),Ee())),j=xt(W(g,ce(({items:v})=>v.length>0),ee(({items:v})=>{let R=0,N=v.length-1;for(;v[R].type==="group"&&R<N;)R++;for(;v[N].type==="group"&&N>R;)N--;return{endIndex:v[N].index,startIndex:v[R].index}}),Ee(pu)));return{endReached:h,initialItemCount:w,itemsRendered:m,listState:g,minOverscanItemCount:p,rangeChanged:j,startReached:k,topItemsIndexes:C,...y}},Ie(qt,vu,Ui,_r,Pr,Lr,wn,Mi),{singleton:!0}),Su=ke(([{fixedFooterHeight:e,fixedHeaderHeight:t,footerHeight:n,headerHeight:r},{listState:o}])=>{const i=Ce(),a=Xe(W(De(n,e,r,t,o),ee(([c,u,d,f,x])=>c+u+d+f+x.offsetBottom+x.bottom)),0);return re(le(a),i),{totalListHeight:a,totalListHeightChanged:i}},Ie(nt,En),{singleton:!0}),_0=ke(([{viewportHeight:e},{totalListHeight:t}])=>{const n=Y(!1),r=Xe(W(De(n,e,t),ce(([o])=>o),ee(([,o,i])=>Math.max(0,o-i)),Kt(0),Ee()),0);return{alignToBottom:n,paddingTopAddition:r}},Ie(nt,Su),{singleton:!0}),ku=ke(()=>({context:Y(null)})),L0=({itemBottom:e,itemTop:t,locationParams:{align:n,behavior:r,...o},viewportBottom:i,viewportTop:a})=>t<a?{...o,align:n??"start",behavior:r}:e>i?{...o,align:n??"end",behavior:r}:null,Tu=ke(([{gap:e,sizes:t,totalCount:n},{fixedFooterHeight:r,fixedHeaderHeight:o,headerHeight:i,scrollingInProgress:a,scrollTop:c,viewportHeight:u},{scrollToIndex:d}])=>{const f=Ce();return re(W(f,ye(t,u,n,i,o,r,c),ye(e),ee(([[x,y,b,S,C,w,m,p],g])=>{const{align:h,behavior:k,calculateViewLocation:j=L0,done:v,...R}=x,N=yu(x,y,S-1),E=Tr(N,y.offsetTree,g)+C+w,L=E+_t(y.sizeTree,N)[1],O=p+w,I=p+b-m,P=j({itemBottom:L,itemTop:E,locationParams:{align:h,behavior:k,...R},viewportBottom:I,viewportTop:O});return P?v&&Nt(W(a,ce(_=>!_),An(_e(a)?1:2)),v):v?.(),P}),ce(x=>x!==null)),d),{scrollIntoView:f}},Ie(qt,nt,Pr,En,vn),{singleton:!0});function Ja(e){return e?e==="smooth"?"smooth":"auto":!1}const M0=(e,t)=>typeof e=="function"?Ja(e(t)):t&&Ja(e),D0=ke(([{listRefresh:e,totalCount:t,fixedItemSize:n,data:r},{atBottomState:o,isAtBottom:i},{scrollToIndex:a},{scrolledToInitialItem:c},{didMount:u,propsReady:d},{log:f},{scrollingInProgress:x},{context:y},{scrollIntoView:b}])=>{const S=Y(!1),C=Ce();let w=null;function m(k){xe(a,{align:"end",behavior:k,index:"LAST"})}Re(W(De(W(le(t),An(1)),u),ye(le(S),i,c,x),ee(([[k,j],v,R,N,E])=>{let L=j&&N,O="auto";return L&&(O=M0(v,R||E),L=L&&!!O),{followOutputBehavior:O,shouldFollow:L,totalCount:k}}),ce(({shouldFollow:k})=>k)),({followOutputBehavior:k,totalCount:j})=>{w&&(w(),w=null),_e(n)?requestAnimationFrame(()=>{_e(f)("following output to ",{totalCount:j},it.DEBUG),m(k)}):w=Nt(e,()=>{_e(f)("following output to ",{totalCount:j},it.DEBUG),m(k),w=null})});function p(k){const j=Nt(o,v=>{k&&!v.atBottom&&v.notAtBottomBecause==="SIZE_INCREASED"&&!w&&(_e(f)("scrolling to bottom due to increased size",{},it.DEBUG),m("auto"))});setTimeout(j,100)}Re(W(De(le(S),t,d),ce(([k,,j])=>k&&j),Ut(({value:k},[,j])=>({refreshed:k===j,value:j}),{refreshed:!1,value:0}),ce(({refreshed:k})=>k),ye(S,t)),([,k])=>{_e(c)&&p(k!==!1)}),Re(C,()=>{p(_e(S)!==!1)}),Re(De(le(S),o),([k,j])=>{k&&!j.atBottom&&j.notAtBottomBecause==="VIEWPORT_HEIGHT_DECREASING"&&m("auto")});const g=Y(null),h=Ce();return re(Xs(W(le(r),ee(k=>{var j;return(j=k?.length)!=null?j:0})),W(le(t))),h),Re(W(De(W(h,An(1)),u),ye(le(g),c,x,y),ee(([[k,j],v,R,N,E])=>j&&R&&v?.({context:E,totalCount:k,scrollingInProgress:N})),ce(k=>!!k),Kt(0)),k=>{w&&(w(),w=null),_e(n)?requestAnimationFrame(()=>{_e(f)("scrolling into view",{}),xe(b,k)}):w=Nt(e,()=>{_e(f)("scrolling into view",{}),xe(b,k),w=null})}),{autoscrollToBottom:C,followOutput:S,scrollIntoViewOnChange:g}},Ie(qt,Lr,Pr,_r,wn,vn,nt,ku,Tu)),O0=ke(([{data:e,firstItemIndex:t,gap:n,sizes:r},{initialTopMostItemIndex:o},{initialItemCount:i,listState:a},{didMount:c}])=>(re(W(c,ye(i),ce(([,u])=>u!==0),ye(o,r,t,n,e),ee(([[,u],d,f,x,y,b=[]])=>Cu(u,d,f,x,y,b))),a),{}),Ie(qt,_r,En,wn),{singleton:!0}),z0=ke(([{didMount:e},{scrollTo:t},{listState:n}])=>{const r=Y(0);return Re(W(e,ye(r),ce(([,o])=>o!==0),ee(([,o])=>({top:o}))),o=>{Nt(W(n,An(1),ce(i=>i.items.length>1)),()=>{requestAnimationFrame(()=>{xe(t,o)})})}),{initialScrollTop:r}},Ie(wn,nt,En),{singleton:!0}),ju=ke(([{scrollVelocity:e}])=>{const t=Y(!1),n=Ce(),r=Y(!1);return re(W(e,ye(r,t,n),ce(([o,i])=>!!i),ee(([o,i,a,c])=>{const{enter:u,exit:d}=i;if(a){if(d(o,c))return!1}else if(u(o,c))return!0;return a}),Ee()),t),Re(W(De(t,e,n),ye(r)),([[o,i,a],c])=>{o&&c&&c.change&&c.change(i,a)}),{isSeeking:t,scrollSeekConfiguration:r,scrollSeekRangeChanged:n,scrollVelocity:e}},Ie(Lr),{singleton:!0}),Bi=ke(([{scrollContainerState:e,scrollTo:t}])=>{const n=Ce(),r=Ce(),o=Ce(),i=Y(!1),a=Y(void 0);return re(W(De(n,r),ee(([{scrollHeight:c,scrollTop:u,viewportHeight:d},{offsetTop:f}])=>({scrollHeight:c,scrollTop:Math.max(0,u-f),viewportHeight:d}))),e),re(W(t,ye(r),ee(([c,{offsetTop:u}])=>({...c,top:c.top+u}))),o),{customScrollParent:a,useWindowScroll:i,windowScrollContainerState:n,windowScrollTo:o,windowViewportRect:r}},Ie(nt)),U0=ke(([{sizeRanges:e,sizes:t},{headerHeight:n,scrollTop:r},{initialTopMostItemIndex:o},{didMount:i},{useWindowScroll:a,windowScrollContainerState:c,windowViewportRect:u}])=>{const d=Ce(),f=Y(void 0),x=Y(null),y=Y(null);return re(c,x),re(u,y),Re(W(d,ye(t,r,a,x,y,n)),([b,S,C,w,m,p,g])=>{const h=C0(S.sizeTree);w&&m!==null&&p!==null&&(C=m.scrollTop-p.offsetTop),C-=g,b({ranges:h,scrollTop:C})}),re(W(f,ce(Pi),ee(B0)),o),re(W(i,ye(f),ce(([,b])=>b!==void 0),Ee(),ee(([,b])=>b.ranges)),e),{getState:d,restoreStateFrom:f}},Ie(qt,nt,_r,wn,Bi));function B0(e){return{align:"start",index:0,offset:e.scrollTop}}const F0=ke(([{topItemsIndexes:e}])=>{const t=Y(0);return re(W(t,ce(n=>n>=0),ee(n=>Array.from({length:n}).map((r,o)=>o))),e),{topItemCount:t}},Ie(En));function Ru(e){let t=!1,n;return(()=>(t||(t=!0,n=e()),n))}const H0=Ru(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),$0=ke(([{deviation:e,scrollBy:t,scrollingInProgress:n,scrollTop:r},{isAtBottom:o,isScrolling:i,lastJumpDueToItemResize:a,scrollDirection:c},{listState:u},{beforeUnshiftWith:d,gap:f,shiftWithOffset:x,sizes:y},{log:b},{recalcInProgress:S}])=>{const C=xt(W(u,ye(a),Ut(([,m,p,g],[{bottom:h,items:k,offsetBottom:j,totalCount:v},R])=>{const N=h+j;let E=0;return p===v&&m.length>0&&k.length>0&&(k[0].originalIndex===0&&m[0].originalIndex===0||(E=N-g,E!==0&&(E+=R))),[E,k,v,N]},[0,[],0,0]),ce(([m])=>m!==0),ye(r,c,n,o,b,S),ce(([,m,p,g,,,h])=>!h&&!g&&m!==0&&p===jr),ee(([[m],,,,,p])=>(p("Upward scrolling compensation",{amount:m},it.DEBUG),m))));function w(m){m>0?(xe(t,{behavior:"auto",top:-m}),xe(e,0)):(xe(e,0),xe(t,{behavior:"auto",top:-m}))}return Re(W(C,ye(e,i)),([m,p,g])=>{g&&H0()?xe(e,p-m):w(-m)}),Re(W(De(Xe(i,!1),e,S),ce(([m,p,g])=>!m&&!g&&p!==0),ee(([m,p])=>p),Kt(1)),w),re(W(x,ee(m=>({top:-m}))),t),Re(W(d,ye(y,f),ee(([m,{groupIndices:p,lastSize:g,sizeTree:h},k])=>{function j(v){return v*(g+k)}if(p.length===0)return j(m);{let v=0;const R=Sr(h,0);let N=0,E=0;for(;N<m;){N++,v+=R;let L=p.length===E+1?1/0:p[E+1]-p[E]-1;N+L>m&&(v-=R,L=m-N+1),N+=L,v+=j(L),E++}return v}})),m=>{xe(e,m),requestAnimationFrame(()=>{xe(t,{top:m}),requestAnimationFrame(()=>{xe(e,0),xe(S,!1)})})}),{deviation:e}},Ie(nt,Lr,En,qt,vn,Mi)),W0=ke(([e,t,n,r,o,i,a,c,u,d,f])=>({...e,...t,...n,...r,...o,...i,...a,...c,...u,...d,...f}),Ie(Ui,O0,wn,ju,Su,z0,_0,Bi,Tu,vn,ku)),Au=ke(([{data:e,defaultItemSize:t,firstItemIndex:n,fixedItemSize:r,fixedGroupSize:o,gap:i,groupIndices:a,heightEstimates:c,itemSize:u,sizeRanges:d,sizes:f,statefulTotalCount:x,totalCount:y,trackItemSizes:b},{initialItemFinalLocationReached:S,initialTopMostItemIndex:C,scrolledToInitialItem:w},m,p,g,h,{scrollToIndex:k},j,{topItemCount:v},{groupCounts:R},N])=>{const{listState:E,minOverscanItemCount:L,topItemsIndexes:O,rangeChanged:I,...P}=h;return re(I,N.scrollSeekRangeChanged),re(W(N.windowViewportRect,ee(_=>_.visibleHeight)),m.viewportHeight),{data:e,defaultItemHeight:t,firstItemIndex:n,fixedItemHeight:r,fixedGroupHeight:o,gap:i,groupCounts:R,heightEstimates:c,initialItemFinalLocationReached:S,initialTopMostItemIndex:C,scrolledToInitialItem:w,sizeRanges:d,topItemCount:v,topItemsIndexes:O,totalCount:y,...g,groupIndices:a,itemSize:u,listState:E,minOverscanItemCount:L,scrollToIndex:k,statefulTotalCount:x,trackItemSizes:b,rangeChanged:I,...P,...N,...m,sizes:f,...p}},Ie(qt,_r,nt,U0,D0,En,Pr,$0,F0,vu,W0));function V0(e,t){const n={},r={};let o=0;const i=e.length;for(;o<i;)r[e[o]]=1,o+=1;for(const a in t)Object.hasOwn(r,a)||(n[a]=t[a]);return n}const ro=typeof document<"u"?J.useLayoutEffect:J.useEffect;function Nu(e,t,n){const r=Object.keys(t.required||{}),o=Object.keys(t.optional||{}),i=Object.keys(t.methods||{}),a=Object.keys(t.events||{}),c=J.createContext({});function u(w,m){w.propsReady&&xe(w.propsReady,!1);for(const p of r){const g=w[t.required[p]];xe(g,m[p])}for(const p of o)if(p in m){const g=w[t.optional[p]];xe(g,m[p])}w.propsReady&&xe(w.propsReady,!0)}function d(w){return i.reduce((m,p)=>(m[p]=g=>{const h=w[t.methods[p]];xe(h,g)},m),{})}function f(w){return a.reduce((m,p)=>(m[p]=a0(w[t.events[p]]),m),{})}const x=J.forwardRef((w,m)=>{const{children:p,...g}=w,[h]=J.useState(()=>Xo(c0(e),v=>{u(v,g)})),[k]=J.useState($a(f,h));ro(()=>{for(const v of a)v in g&&Re(k[v],g[v]);return()=>{Object.values(k).map(_i)}},[g,k,h]),ro(()=>{u(h,g)}),J.useImperativeHandle(m,Ha(d(h)));const j=n;return s.jsx(c.Provider,{value:h,children:n?s.jsx(j,{...V0([...r,...o,...a],g),children:p}):p})}),y=w=>{const m=J.useContext(c);return J.useCallback(p=>{xe(m[w],p)},[m,w])},b=w=>{const m=J.useContext(c)[w],p=J.useCallback(g=>Re(m,g),[m]);return J.useSyncExternalStore(p,()=>_e(m),()=>_e(m))},S=w=>{const m=J.useContext(c)[w],[p,g]=J.useState($a(_e,m));return ro(()=>Re(m,h=>{h!==p&&g(Ha(h))}),[m,p]),p},C=J.version.startsWith("18")?b:S;return{Component:x,useEmitter:(w,m)=>{const p=J.useContext(c)[w];ro(()=>Re(p,m),[m,p])},useEmitterValue:C,usePublisher:y}}const Eu=J.createContext(void 0),Iu=J.createContext(void 0),Pu=typeof document<"u"?J.useLayoutEffect:J.useEffect;function Ns(e){return"self"in e}function q0(e){return"body"in e}function _u(e,t,n,r=Jn,o,i){const a=J.useRef(null),c=J.useRef(null),u=J.useRef(null),d=J.useCallback(y=>{let b,S,C;const w=y.target;if(q0(w)||Ns(w)){const p=Ns(w)?w:w.defaultView;C=i?p.scrollX:p.scrollY,b=i?p.document.documentElement.scrollWidth:p.document.documentElement.scrollHeight,S=i?p.innerWidth:p.innerHeight}else C=i?w.scrollLeft:w.scrollTop,b=i?w.scrollWidth:w.scrollHeight,S=i?w.offsetWidth:w.offsetHeight;const m=()=>{e({scrollHeight:b,scrollTop:Math.max(C,0),viewportHeight:S})};y.suppressFlushSync?m():vl.flushSync(m),c.current!==null&&(C===c.current||C<=0||C===b-S)&&(c.current=null,t(!0),u.current&&(clearTimeout(u.current),u.current=null))},[e,t,i]);J.useEffect(()=>{const y=o||a.current;return r(o||a.current),d({suppressFlushSync:!0,target:y}),y.addEventListener("scroll",d,{passive:!0}),()=>{r(null),y.removeEventListener("scroll",d)}},[a,d,n,r,o]);function f(y){const b=a.current;if(!b||(i?"offsetWidth"in b&&b.offsetWidth===0:"offsetHeight"in b&&b.offsetHeight===0))return;const S=y.behavior==="smooth";let C,w,m;Ns(b)?(w=Math.max(pn(b.document.documentElement,i?"width":"height"),i?b.document.documentElement.scrollWidth:b.document.documentElement.scrollHeight),C=i?b.innerWidth:b.innerHeight,m=i?window.scrollX:window.scrollY):(w=b[i?"scrollWidth":"scrollHeight"],C=pn(b,i?"width":"height"),m=b[i?"scrollLeft":"scrollTop"]);const p=w-C;if(y.top=Math.ceil(Math.max(Math.min(p,y.top),0)),bu(C,w)||y.top===m){e({scrollHeight:w,scrollTop:m,viewportHeight:C}),S&&t(!0);return}S?(c.current=y.top,u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{u.current=null,c.current=null,t(!0)},1e3)):c.current=null,i&&(y={behavior:y.behavior,left:y.top}),b.scrollTo(y)}function x(y){i&&(y={behavior:y.behavior,left:y.top}),a.current.scrollBy(y)}return{scrollByCallback:x,scrollerRef:a,scrollToCallback:f}}const Es="-webkit-sticky",el="sticky",Fi=Ru(()=>{if(typeof document>"u")return el;const e=document.createElement("div");return e.style.position=Es,e.style.position===Es?Es:el});function Hi(e){return e}const G0=ke(()=>{const e=Y(c=>`Item ${c}`),t=Y(c=>`Group ${c}`),n=Y({}),r=Y(Hi),o=Y("div"),i=Y(Jn),a=(c,u=null)=>Xe(W(n,ee(d=>d[c]),Ee()),u);return{components:n,computeItemKey:r,EmptyPlaceholder:a("EmptyPlaceholder"),FooterComponent:a("Footer"),GroupComponent:a("Group","div"),groupContent:t,HeaderComponent:a("Header"),HeaderFooterTag:o,ItemComponent:a("Item","div"),itemContent:e,ListComponent:a("List","div"),ScrollerComponent:a("Scroller","div"),scrollerRef:i,ScrollSeekPlaceholder:a("ScrollSeekPlaceholder"),TopItemListComponent:a("TopItemList")}}),Y0=ke(([e,t])=>({...e,...t}),Ie(Au,G0)),X0=({height:e})=>s.jsx("div",{style:{height:e}}),Z0={overflowAnchor:"none",position:Fi(),zIndex:1},Lu={overflowAnchor:"none"},K0={...Lu,display:"inline-block",height:"100%"},tl=J.memo(function({showTopList:e=!1}){const t=pe("listState"),n=kt("sizeRanges"),r=pe("useWindowScroll"),o=pe("customScrollParent"),i=kt("windowScrollContainerState"),a=kt("scrollContainerState"),c=o||r?i:a,u=pe("itemContent"),d=pe("context"),f=pe("groupContent"),x=pe("trackItemSizes"),y=pe("itemSize"),b=pe("log"),S=kt("gap"),C=pe("horizontalDirection"),{callbackRef:w}=f0(n,y,x,e?Jn:c,b,S,o,C,pe("skipAnimationFrameInResizeObserver")),[m,p]=J.useState(0);$i("deviation",P=>{m!==P&&p(P)});const g=pe("EmptyPlaceholder"),h=pe("ScrollSeekPlaceholder")||X0,k=pe("ListComponent"),j=pe("ItemComponent"),v=pe("GroupComponent"),R=pe("computeItemKey"),N=pe("isSeeking"),E=pe("groupIndices").length>0,L=pe("alignToBottom"),O=pe("initialItemFinalLocationReached"),I=e?{}:{boxSizing:"border-box",...C?{display:"inline-block",height:"100%",marginLeft:m!==0?m:L?"auto":0,paddingLeft:t.offsetTop,paddingRight:t.offsetBottom,whiteSpace:"nowrap"}:{marginTop:m!==0?m:L?"auto":0,paddingBottom:t.offsetBottom,paddingTop:t.offsetTop},...O?{}:{visibility:"hidden"}};return!e&&t.totalCount===0&&g?s.jsx(g,{...Ye(g,d)}):s.jsx(k,{...Ye(k,d),"data-testid":e?"virtuoso-top-item-list":"virtuoso-item-list",ref:w,style:I,children:(e?t.topItems:t.items).map(P=>{const _=P.originalIndex,M=R(_+t.firstItemIndex,P.data,d);return N?l.createElement(h,{...Ye(h,d),height:P.size,index:P.index,key:M,type:P.type||"item",...P.type==="group"?{}:{groupIndex:P.groupIndex}}):P.type==="group"?l.createElement(v,{...Ye(v,d),"data-index":_,"data-item-index":P.index,"data-known-size":P.size,key:M,style:Z0},f(P.index,d)):l.createElement(j,{...Ye(j,d),...tx(j,P.data),"data-index":_,"data-item-group-index":P.groupIndex,"data-item-index":P.index,"data-known-size":P.size,key:M,style:C?K0:Lu},E?u(P.index,P.groupIndex,P.data,d):u(P.index,P.data,d))})})}),Q0={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},J0={outline:"none",overflowX:"auto",position:"relative"},Ko=e=>({height:"100%",position:"absolute",top:0,width:"100%",...e?{display:"flex",flexDirection:"column"}:{}}),ex={position:Fi(),top:0,width:"100%",zIndex:1};function Ye(e,t){if(typeof e!="string")return{context:t}}function tx(e,t){return{item:typeof e=="string"?void 0:t}}const nx=J.memo(function(){const e=pe("HeaderComponent"),t=kt("headerHeight"),n=pe("HeaderFooterTag"),r=Nn(J.useMemo(()=>i=>{t(pn(i,"height"))},[t]),!0,pe("skipAnimationFrameInResizeObserver")),o=pe("context");return e?s.jsx(n,{ref:r,children:s.jsx(e,{...Ye(e,o)})}):null}),rx=J.memo(function(){const e=pe("FooterComponent"),t=kt("footerHeight"),n=pe("HeaderFooterTag"),r=Nn(J.useMemo(()=>i=>{t(pn(i,"height"))},[t]),!0,pe("skipAnimationFrameInResizeObserver")),o=pe("context");return e?s.jsx(n,{ref:r,children:s.jsx(e,{...Ye(e,o)})}):null});function Mu({useEmitter:e,useEmitterValue:t,usePublisher:n}){return J.memo(function({children:r,style:o,context:i,...a}){const c=n("scrollContainerState"),u=t("ScrollerComponent"),d=n("smoothScrollTargetReached"),f=t("scrollerRef"),x=t("horizontalDirection")||!1,{scrollByCallback:y,scrollerRef:b,scrollToCallback:S}=_u(c,d,u,f,void 0,x);return e("scrollTo",S),e("scrollBy",y),s.jsx(u,{"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,ref:b,style:{...x?J0:Q0,...o},tabIndex:0,...a,...Ye(u,i),children:r})})}function Du({useEmitter:e,useEmitterValue:t,usePublisher:n}){return J.memo(function({children:r,style:o,context:i,...a}){const c=n("windowScrollContainerState"),u=t("ScrollerComponent"),d=n("smoothScrollTargetReached"),f=t("totalListHeight"),x=t("deviation"),y=t("customScrollParent"),b=J.useRef(null),S=t("scrollerRef"),{scrollByCallback:C,scrollerRef:w,scrollToCallback:m}=_u(c,d,u,S,y);return Pu(()=>{var p;return w.current=y||((p=b.current)==null?void 0:p.ownerDocument.defaultView),()=>{w.current=null}},[w,y]),e("windowScrollTo",m),e("scrollBy",C),s.jsx(u,{ref:b,"data-virtuoso-scroller":!0,style:{position:"relative",...o,...f!==0?{height:f+x}:{}},...a,...Ye(u,i),children:r})})}const ox=({children:e})=>{const t=J.useContext(Eu),n=kt("viewportHeight"),r=kt("fixedItemHeight"),o=pe("alignToBottom"),i=pe("horizontalDirection"),a=J.useMemo(()=>au(n,u=>pn(u,i?"width":"height")),[n,i]),c=Nn(a,!0,pe("skipAnimationFrameInResizeObserver"));return J.useEffect(()=>{t&&(n(t.viewportHeight),r(t.itemHeight))},[t,n,r]),s.jsx("div",{"data-viewport-type":"element",ref:c,style:Ko(o),children:e})},sx=({children:e})=>{const t=J.useContext(Eu),n=kt("windowViewportRect"),r=kt("fixedItemHeight"),o=pe("customScrollParent"),i=cu(n,o,pe("skipAnimationFrameInResizeObserver")),a=pe("alignToBottom");return J.useEffect(()=>{t&&(r(t.itemHeight),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:100}))},[t,n,r]),s.jsx("div",{"data-viewport-type":"window",ref:i,style:Ko(a),children:e})},ix=({children:e})=>{const t=pe("TopItemListComponent")||"div",n=pe("headerHeight"),r={...ex,marginTop:`${n}px`},o=pe("context");return s.jsx(t,{style:r,...Ye(t,o),children:e})},ax=J.memo(function(e){const t=pe("useWindowScroll"),n=pe("topItemsIndexes").length>0,r=pe("customScrollParent"),o=pe("context");return s.jsxs(r||t?ux:cx,{...e,context:o,children:[n&&s.jsx(ix,{children:s.jsx(tl,{showTopList:!0})}),s.jsxs(r||t?sx:ox,{children:[s.jsx(nx,{}),s.jsx(tl,{}),s.jsx(rx,{})]})]})}),{Component:lx,useEmitter:$i,useEmitterValue:pe,usePublisher:kt}=Nu(Y0,{required:{},optional:{restoreStateFrom:"restoreStateFrom",context:"context",followOutput:"followOutput",scrollIntoViewOnChange:"scrollIntoViewOnChange",itemContent:"itemContent",groupContent:"groupContent",overscan:"overscan",increaseViewportBy:"increaseViewportBy",minOverscanItemCount:"minOverscanItemCount",totalCount:"totalCount",groupCounts:"groupCounts",topItemCount:"topItemCount",firstItemIndex:"firstItemIndex",initialTopMostItemIndex:"initialTopMostItemIndex",components:"components",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",computeItemKey:"computeItemKey",defaultItemHeight:"defaultItemHeight",fixedGroupHeight:"fixedGroupHeight",fixedItemHeight:"fixedItemHeight",heightEstimates:"heightEstimates",itemSize:"itemSize",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"HeaderFooterTag",data:"data",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",alignToBottom:"alignToBottom",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",horizontalDirection:"horizontalDirection",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver"},methods:{scrollToIndex:"scrollToIndex",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollBy:"scrollBy",autoscrollToBottom:"autoscrollToBottom",getState:"getState"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",totalListHeightChanged:"totalListHeightChanged",itemsRendered:"itemsRendered",groupIndices:"groupIndices"}},ax),cx=Mu({useEmitter:$i,useEmitterValue:pe,usePublisher:kt}),ux=Du({useEmitter:$i,useEmitterValue:pe,usePublisher:kt}),dx=lx,fx=ke(()=>{const e=Y(d=>s.jsxs("td",{children:["Item $",d]})),t=Y(null),n=Y(d=>s.jsxs("td",{colSpan:1e3,children:["Group ",d]})),r=Y(null),o=Y(null),i=Y({}),a=Y(Hi),c=Y(Jn),u=(d,f=null)=>Xe(W(i,ee(x=>x[d]),Ee()),f);return{components:i,computeItemKey:a,context:t,EmptyPlaceholder:u("EmptyPlaceholder"),FillerRow:u("FillerRow"),fixedFooterContent:o,fixedHeaderContent:r,itemContent:e,groupContent:n,ScrollerComponent:u("Scroller","div"),scrollerRef:c,ScrollSeekPlaceholder:u("ScrollSeekPlaceholder"),TableBodyComponent:u("TableBody","tbody"),TableComponent:u("Table","table"),TableFooterComponent:u("TableFoot","tfoot"),TableHeadComponent:u("TableHead","thead"),TableRowComponent:u("TableRow","tr"),GroupComponent:u("Group","tr")}});Ie(Au,fx);Fi();const nl={bottom:0,itemHeight:0,items:[],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},hx={bottom:0,itemHeight:0,items:[{index:0}],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},{ceil:rl,floor:No,max:gr,min:Is,round:ol}=Math;function sl(e,t,n){return Array.from({length:t-e+1}).map((r,o)=>({data:n===null?null:n[o+e],index:o+e}))}function mx(e){return{...hx,items:e}}function oo(e,t){return e&&e.width===t.width&&e.height===t.height}function px(e,t){return e&&e.column===t.column&&e.row===t.row}const gx=ke(([{increaseViewportBy:e,listBoundary:t,overscan:n,visibleRange:r},{footerHeight:o,headerHeight:i,scrollBy:a,scrollContainerState:c,scrollTo:u,scrollTop:d,smoothScrollTargetReached:f,viewportHeight:x},y,b,{didMount:S,propsReady:C},{customScrollParent:w,useWindowScroll:m,windowScrollContainerState:p,windowScrollTo:g,windowViewportRect:h},k])=>{const j=Y(0),v=Y(0),R=Y(nl),N=Y({height:0,width:0}),E=Y({height:0,width:0}),L=Ce(),O=Ce(),I=Y(0),P=Y(null),_=Y({column:0,row:0}),M=Ce(),z=Ce(),F=Y(!1),Z=Y(0),A=Y(!0),T=Y(!1),$=Y(!1);Re(W(S,ye(Z),ce(([B,te])=>!!te)),()=>{xe(A,!1)}),Re(W(De(S,A,E,N,Z,T),ce(([B,te,oe,Q,,me])=>B&&!te&&oe.height!==0&&Q.height!==0&&!me)),([,,,,B])=>{xe(T,!0),Oi(1,()=>{xe(L,B)}),Nt(W(d),()=>{xe(t,[0,0]),xe(A,!0)})}),re(W(z,ce(B=>B!=null&&B.scrollTop>0),Dt(0)),v),Re(W(S,ye(z),ce(([,B])=>B!=null)),([,B])=>{B&&(xe(N,B.viewport),xe(E,B.item),xe(_,B.gap),B.scrollTop>0&&(xe(F,!0),Nt(W(d,An(1)),te=>{xe(F,!1)}),xe(u,{top:B.scrollTop})))}),re(W(N,ee(({height:B})=>B)),x),re(W(De(le(N,oo),le(E,oo),le(_,(B,te)=>B&&B.column===te.column&&B.row===te.row),le(d)),ee(([B,te,oe,Q])=>({gap:oe,item:te,scrollTop:Q,viewport:B}))),M),re(W(De(le(j),r,le(_,px),le(E,oo),le(N,oo),le(P),le(v),le(F),le(A),le(Z)),ce(([,,,,,,,B])=>!B),ee(([B,[te,oe],Q,me,fe,ne,ae,,ue,ie])=>{const{column:de,row:Se}=Q,{height:Te,width:nn}=me,{width:rn}=fe;if(ae===0&&(B===0||rn===0))return nl;if(nn===0){const an=zi(ie,B),er=an+Math.max(ae-1,0);return mx(sl(an,er,ne))}const on=Ou(rn,nn,de);let at,yt;ue?te===0&&oe===0&&ae>0?(at=0,yt=ae-1):(at=on*No((te+Se)/(Te+Se)),yt=on*rl((oe+Se)/(Te+Se))-1,yt=Is(B-1,gr(yt,on-1)),at=Is(yt,gr(0,at))):(at=0,yt=-1);const bn=sl(at,yt,ne),{bottom:In,top:Gt}=il(fe,Q,me,bn),vt=rl(B/on),sn=vt*Te+(vt-1)*Se-In;return{bottom:In,itemHeight:Te,items:bn,itemWidth:nn,offsetBottom:sn,offsetTop:Gt,top:Gt}})),R),re(W(P,ce(B=>B!==null),ee(B=>B.length)),j),re(W(De(N,E,R,_),ce(([B,te,{items:oe}])=>oe.length>0&&te.height!==0&&B.height!==0),ee(([B,te,{items:oe},Q])=>{const{bottom:me,top:fe}=il(B,Q,te,oe);return[fe,me]}),Ee(kr)),t);const K=Y(!1);re(W(d,ye(K),ee(([B,te])=>te||B!==0)),K);const V=xt(W(De(R,j),ce(([{items:B}])=>B.length>0),ye(K),ce(([[B,te],oe])=>{const Q=B.items[B.items.length-1].index===te-1;return(oe||B.bottom>0&&B.itemHeight>0&&B.offsetBottom===0&&B.items.length===te)&&Q}),ee(([[,B]])=>B-1),Ee())),q=xt(W(le(R),ce(({items:B})=>B.length>0&&B[0].index===0),Dt(0),Ee())),se=xt(W(le(R),ye(F),ce(([{items:B},te])=>B.length>0&&!te),ee(([{items:B}])=>({endIndex:B[B.length-1].index,startIndex:B[0].index})),Ee(pu),Kt(0)));re(se,b.scrollSeekRangeChanged),re(W(L,ye(N,E,j,_),ee(([B,te,oe,Q,me])=>{const fe=wu(B),{align:ne,behavior:ae,offset:ue}=fe;let ie=fe.index;ie==="LAST"&&(ie=Q-1),ie=gr(0,ie,Is(Q-1,ie));let de=ei(te,me,oe,ie);return ne==="end"?de=ol(de-te.height+oe.height):ne==="center"&&(de=ol(de-te.height/2+oe.height/2)),ue&&(de+=ue),{behavior:ae,top:de}})),u);const G=Xe(W(R,ee(B=>B.offsetBottom+B.bottom)),0);return re(W(h,ee(B=>({height:B.visibleHeight,width:B.visibleWidth}))),N),{customScrollParent:w,data:P,deviation:I,footerHeight:o,gap:_,headerHeight:i,increaseViewportBy:e,initialItemCount:v,itemDimensions:E,overscan:n,restoreStateFrom:z,scrollBy:a,scrollContainerState:c,scrollHeight:O,scrollTo:u,scrollToIndex:L,scrollTop:d,smoothScrollTargetReached:f,totalCount:j,useWindowScroll:m,viewportDimensions:N,windowScrollContainerState:p,windowScrollTo:g,windowViewportRect:h,...b,gridState:R,horizontalDirection:$,initialTopMostItemIndex:Z,totalListHeight:G,...y,endReached:V,propsReady:C,rangeChanged:se,startReached:q,stateChanged:M,stateRestoreInProgress:F,...k}},Ie(Ui,nt,Lr,ju,wn,Bi,vn));function Ou(e,t,n){return gr(1,No((e+n)/(No(t)+n)))}function il(e,t,n,r){const{height:o}=n;if(o===void 0||r.length===0)return{bottom:0,top:0};const i=ei(e,t,n,r[0].index);return{bottom:ei(e,t,n,r[r.length-1].index)+o,top:i}}function ei(e,t,n,r){const o=Ou(e.width,n.width,t.column),i=No(r/o),a=i*n.height+gr(0,i-1)*t.row;return a>0?a+t.row:a}const xx=ke(()=>{const e=Y(x=>`Item ${x}`),t=Y({}),n=Y(null),r=Y("virtuoso-grid-item"),o=Y("virtuoso-grid-list"),i=Y(Hi),a=Y("div"),c=Y(Jn),u=(x,y=null)=>Xe(W(t,ee(b=>b[x]),Ee()),y),d=Y(!1),f=Y(!1);return re(le(f),d),{components:t,computeItemKey:i,context:n,FooterComponent:u("Footer"),HeaderComponent:u("Header"),headerFooterTag:a,itemClassName:r,ItemComponent:u("Item","div"),itemContent:e,listClassName:o,ListComponent:u("List","div"),readyStateChanged:d,reportReadyState:f,ScrollerComponent:u("Scroller","div"),scrollerRef:c,ScrollSeekPlaceholder:u("ScrollSeekPlaceholder","div")}}),yx=ke(([e,t])=>({...e,...t}),Ie(gx,xx)),vx=J.memo(function(){const e=Pe("gridState"),t=Pe("listClassName"),n=Pe("itemClassName"),r=Pe("itemContent"),o=Pe("computeItemKey"),i=Pe("isSeeking"),a=Tt("scrollHeight"),c=Pe("ItemComponent"),u=Pe("ListComponent"),d=Pe("ScrollSeekPlaceholder"),f=Pe("context"),x=Tt("itemDimensions"),y=Tt("gap"),b=Pe("log"),S=Pe("stateRestoreInProgress"),C=Tt("reportReadyState"),w=Nn(J.useMemo(()=>m=>{const p=m.parentElement.parentElement.scrollHeight;a(p);const g=m.firstChild;if(g){const{height:h,width:k}=g.getBoundingClientRect();x({height:h,width:k})}y({column:al("column-gap",getComputedStyle(m).columnGap,b),row:al("row-gap",getComputedStyle(m).rowGap,b)})},[a,x,y,b]),!0,!1);return Pu(()=>{e.itemHeight>0&&e.itemWidth>0&&C(!0)},[e]),S?null:s.jsx(u,{className:t,ref:w,...Ye(u,f),"data-testid":"virtuoso-item-list",style:{paddingBottom:e.offsetBottom,paddingTop:e.offsetTop},children:e.items.map(m=>{const p=o(m.index,m.data,f);return i?s.jsx(d,{...Ye(d,f),height:e.itemHeight,index:m.index,width:e.itemWidth},p):l.createElement(c,{...Ye(c,f),className:n,"data-index":m.index,key:p},r(m.index,m.data,f))})})}),wx=J.memo(function(){const e=Pe("HeaderComponent"),t=Tt("headerHeight"),n=Pe("headerFooterTag"),r=Nn(J.useMemo(()=>i=>{t(pn(i,"height"))},[t]),!0,!1),o=Pe("context");return e?s.jsx(n,{ref:r,children:s.jsx(e,{...Ye(e,o)})}):null}),bx=J.memo(function(){const e=Pe("FooterComponent"),t=Tt("footerHeight"),n=Pe("headerFooterTag"),r=Nn(J.useMemo(()=>i=>{t(pn(i,"height"))},[t]),!0,!1),o=Pe("context");return e?s.jsx(n,{ref:r,children:s.jsx(e,{...Ye(e,o)})}):null}),Cx=({children:e})=>{const t=J.useContext(Iu),n=Tt("itemDimensions"),r=Tt("viewportDimensions"),o=Nn(J.useMemo(()=>i=>{r(i.getBoundingClientRect())},[r]),!0,!1);return J.useEffect(()=>{t&&(r({height:t.viewportHeight,width:t.viewportWidth}),n({height:t.itemHeight,width:t.itemWidth}))},[t,r,n]),s.jsx("div",{ref:o,style:Ko(!1),children:e})},Sx=({children:e})=>{const t=J.useContext(Iu),n=Tt("windowViewportRect"),r=Tt("itemDimensions"),o=Pe("customScrollParent"),i=cu(n,o,!1);return J.useEffect(()=>{t&&(r({height:t.itemHeight,width:t.itemWidth}),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:t.viewportWidth}))},[t,n,r]),s.jsx("div",{ref:i,style:Ko(!1),children:e})},kx=J.memo(function({...e}){const t=Pe("useWindowScroll"),n=Pe("customScrollParent"),r=n||t?jx:Tx,o=n||t?Sx:Cx,i=Pe("context");return s.jsx(r,{...e,...Ye(r,i),children:s.jsxs(o,{children:[s.jsx(wx,{}),s.jsx(vx,{}),s.jsx(bx,{})]})})}),{useEmitter:zu,useEmitterValue:Pe,usePublisher:Tt}=Nu(yx,{optional:{context:"context",totalCount:"totalCount",overscan:"overscan",itemContent:"itemContent",components:"components",computeItemKey:"computeItemKey",data:"data",initialItemCount:"initialItemCount",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"headerFooterTag",listClassName:"listClassName",itemClassName:"itemClassName",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",restoreStateFrom:"restoreStateFrom",initialTopMostItemIndex:"initialTopMostItemIndex",increaseViewportBy:"increaseViewportBy"},methods:{scrollTo:"scrollTo",scrollBy:"scrollBy",scrollToIndex:"scrollToIndex"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",stateChanged:"stateChanged",readyStateChanged:"readyStateChanged"}},kx),Tx=Mu({useEmitter:zu,useEmitterValue:Pe,usePublisher:Tt}),jx=Du({useEmitter:zu,useEmitterValue:Pe,usePublisher:Tt});function al(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,it.WARN),t==="normal"?0:parseInt(t??"0",10)}function Rx({value:e,options:t,onChange:n,className:r,triggerClassName:o}){const[i,a]=l.useState(!1),c=l.useRef(null),u=t.find(f=>f.value===e);l.useEffect(()=>{const f=x=>{c.current&&!c.current.contains(x.target)&&a(!1)};return i&&(document.addEventListener("mousedown",f),document.addEventListener("touchstart",f)),()=>{document.removeEventListener("mousedown",f),document.removeEventListener("touchstart",f)}},[i]);const d=f=>{n(f),a(!1)};return s.jsxs("div",{ref:c,className:Qt("relative inline-block",r),children:[s.jsxs("button",{type:"button",onClick:()=>a(!i),className:Qt("inline-flex items-center justify-between gap-2 rounded-lg border border-border/60 bg-background/50 px-3 py-1.5 text-xs transition-colors hover:bg-accent/50",o),children:[s.jsx("span",{children:u?.label}),s.jsx(Dd,{size:14,style:{stroke:"currentColor",fill:"none",display:"block",width:"14px",height:"14px",transform:i?"rotate(180deg)":"rotate(0deg)",transition:"transform 200ms ease"}})]}),i&&s.jsx("div",{className:"absolute right-0 top-full mt-1 z-[9999] min-w-[6rem] rounded-md border border-border bg-popover shadow-lg animate-in fade-in-0 zoom-in-95 slide-in-from-top-2",children:s.jsx("div",{className:"p-1",children:t.map(f=>s.jsxs("button",{type:"button",onClick:()=>d(f.value),className:Qt("relative w-full flex items-center justify-between gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors cursor-pointer","hover:bg-accent hover:text-accent-foreground",f.value===e?"bg-accent/50 text-accent-foreground":"text-popover-foreground"),children:[s.jsx("span",{children:f.label}),f.value===e&&s.jsx(Rd,{size:16,style:{stroke:"currentColor",fill:"none",display:"block",width:"16px",height:"16px"}})]},f.value))})})]})}function Ax({icon:e,title:t,description:n,action:r,glowClassName:o,circleClassName:i,containerClassName:a}){return s.jsxs("div",{className:`flex flex-col items-center justify-center h-96 text-center px-4 ${a??""}`,children:[s.jsxs("div",{className:"relative mb-8",children:[s.jsx("div",{className:`absolute inset-0 ${o??"bg-amber-500/30 dark:bg-amber-400/30"} blur-3xl rounded-full animate-pulse`}),s.jsx("div",{className:`relative w-32 h-32 rounded-full ${i??"bg-amber-100 dark:bg-amber-900/40 border-4 border-amber-400 dark:border-amber-600"} flex items-center justify-center shadow-lg`,children:e})]}),s.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:t}),s.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-64",children:n}),r]})}function Nx({icon:e,title:t,description:n,glowClassName:r,circleClassName:o}){return s.jsx(Ct,{children:s.jsxs(St,{className:"p-8 text-center",children:[s.jsxs("div",{className:"relative mb-6",children:[s.jsx("div",{className:`absolute inset-0 ${r??"bg-amber-500/30 dark:bg-amber-400/30"} blur-2xl rounded-full`}),s.jsx("div",{className:`relative w-24 h-24 rounded-full ${o??"bg-amber-100 dark:bg-amber-900/40 border-4 border-amber-400 dark:border-amber-600"} shadow-lg flex items-center justify-center mx-auto`,children:e})]}),s.jsx("h3",{className:"font-medium text-foreground mb-2",children:t}),s.jsx("p",{className:"text-sm text-muted-foreground",children:n})]})})}function ln({className:e,...t}){return s.jsx("div",{"data-slot":"skeleton",className:Qt("bg-accent animate-pulse rounded-md",e),...t})}function Ex(){return s.jsx("div",{className:"px-4 py-1.5",children:s.jsxs("div",{className:"rounded-lg border bg-card p-4",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx(ln,{className:"h-10 w-10 rounded-full"}),s.jsxs("div",{className:"flex-1",children:[s.jsx(ln,{className:"h-4 w-24 mb-2"}),s.jsx(ln,{className:"h-3 w-16"})]})]}),s.jsx(ln,{className:"h-4 w-full mb-2"}),s.jsx(ln,{className:"h-4 w-3/4 mb-4"}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(ln,{className:"h-4 w-16"}),s.jsx(ln,{className:"h-4 w-16"}),s.jsx(ln,{className:"h-4 w-16"})]})]})})}function Ix({count:e=5}){return s.jsx(s.Fragment,{children:Array.from({length:e}).map((t,n)=>s.jsx(Ex,{},n))})}const ll=({size:e=24,className:t=""})=>s.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:t,children:[s.jsx("rect",{x:"10",y:"4",width:"4",height:"16",rx:"0.5"}),s.jsx("rect",{x:"9",y:"2",width:"6",height:"2",rx:"0.3"}),s.jsx("rect",{x:"9.5",y:"20",width:"5",height:"2",rx:"0.3"})]}),Px=({size:e=24,className:t=""})=>s.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:t,children:[s.jsx("rect",{x:"10",y:"4",width:"4",height:"16",rx:"0.5"}),s.jsx("rect",{x:"9",y:"2",width:"6",height:"2",rx:"0.3"}),s.jsx("rect",{x:"9.5",y:"20",width:"5",height:"2",rx:"0.3"}),s.jsx("path",{d:"M 8 4 Q 10 3 12 4 Q 14 3 16 4",strokeWidth:"1.2"}),s.jsx("path",{d:"M 8 5 Q 10 4 12 5 Q 14 4 16 5",strokeWidth:"1",opacity:"0.7"})]}),_x=({size:e=24,className:t=""})=>s.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:t,children:[s.jsx("rect",{x:"10",y:"4",width:"4",height:"16",rx:"0.5"}),s.jsx("rect",{x:"9",y:"2",width:"6",height:"2",rx:"0.3"}),s.jsx("rect",{x:"9.5",y:"20",width:"5",height:"2",rx:"0.3"}),s.jsx("path",{d:"M 8 4 Q 10 2.5 12 4 Q 14 2.5 16 4",strokeWidth:"1.2"}),s.jsx("path",{d:"M 9 3.5 Q 10.5 2.8 12 3.5 Q 13.5 2.8 15 3.5",strokeWidth:"1",opacity:"0.8"}),s.jsx("path",{d:"M 9.5 4.5 Q 11 3.8 12 4.5 Q 13 3.8 14.5 4.5",strokeWidth:"0.8",opacity:"0.6"}),s.jsx("path",{d:"M 10 5 L 14 5",strokeWidth:"0.5",opacity:"0.5"})]});function Lx({style:e,size:t=24,className:n=""}){switch(e){case"doric":return s.jsx(ll,{size:t,className:n});case"ionic":return s.jsx(Px,{size:t,className:n});case"corinthian":return s.jsx(_x,{size:t,className:n});default:return s.jsx(ll,{size:t,className:n})}}function Mx(e){return e==null||e<=30?"doric":e<=60?"ionic":"corinthian"}function Dx(e,t=!1){const n=l.useRef([]);return l.useEffect(()=>{e.length>0&&(n.current=e)},[e]),{visible:e.length>0?e:t?n.current:[],lastNonEmpty:n.current}}const Ox=[{label:"최신순",value:"latest"},{label:"오래된순",value:"oldest"},{label:"인기순",value:"lanterns"}],cl={lanterns:(e,t)=>(t.lanterns??0)-(e.lanterns??0),oldest:(e,t)=>(e.createdAt?.getTime?.()??0)-(t.createdAt?.getTime?.()??0),latest:(e,t)=>(t.createdAt?.getTime?.()??0)-(e.createdAt?.getTime?.()??0)},zx=e=>e.hidden===!0;function Ux({posts:e,activeCategory:t,activeSubCategory:n,sortBy:r,categories:o,onSubCategoryChange:i}){const a=tu({key:`main-posts-${t}-${n}`}),c=l.useDeferredValue(e),u=l.useMemo(()=>{const p=new Set;return c.forEach(g=>{typeof g.authorUid=="string"&&g.authorUid.length>0&&p.add(g.authorUid)}),Array.from(p)},[c]),d=Io(u),f=l.useMemo(()=>o.find(p=>p.id===t),[o,t]),x=l.useMemo(()=>f?.subCategories??[],[f]),y=l.useCallback(p=>{const g=p.currentTarget.getAttribute("data-sub-id");g&&i(g)},[i]),b=l.useMemo(()=>{const p=c.filter(h=>!zx(h)),g=t==="전체"?p:p.filter(h=>h.category===t);return n==="전체"?g:g.filter(h=>h.subCategory===n)},[c,t,n]),S=l.useMemo(()=>{const g=cl[r??"latest"]??cl.latest;return[...b].sort(g)},[b,r]),{visible:C}=Dx(S,!0),w=l.useCallback(p=>Po(p),[]),m=l.useCallback(p=>p?p.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",[]);return{scrollRef:a,currentSubCategories:x,visiblePosts:C,filteredCount:S.length,handleSubCategoryClick:y,formatTimeAgo:w,formatCreatedAt:m,userProfiles:d}}const Bx=(e,t)=>e===t?!0:e?.profileImage===t?.profileImage&&e?.currentTitleId===t?.currentTitleId;function Fx({posts:e,userNickname:t,userProfileImage:n,userUid:r,activeCategory:o,activeSubCategory:i,sortBy:a,blockedUserIds:c,categories:u,onSubCategoryChange:d,onSortChange:f,isPostLanterned:x,isBookmarked:y,onPostClick:b,onLanternToggle:S,onBookmarkToggle:C,onStartWriting:w,currentTitle:m,onRefresh:p,isRefreshing:g=!1,isLoading:h=!1,userTrustScore:k,isGuest:j}){const v=l.useMemo(()=>!c||c.length===0?e:e.filter(F=>{const Z=F.authorUid||F.userId;return!c.includes(Z)}),[e,c]),R=l.useMemo(()=>v.filter(()=>!0),[v,r]),{scrollRef:N,currentSubCategories:E,visiblePosts:L,filteredCount:O,handleSubCategoryClick:I,formatTimeAgo:P,formatCreatedAt:_,userProfiles:M}=Ux({posts:R,activeCategory:o,activeSubCategory:i,sortBy:a,categories:u,onSubCategoryChange:d}),z=l.useCallback(F=>{f(F)},[f]);return s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsx($x,{currentSubCategories:E,activeSubCategory:i,handleSubCategoryClick:I,filteredCount:O,sortBy:a,onSortChange:z,onRefresh:p,isRefreshing:g}),s.jsx("div",{className:"flex-1 overflow-hidden bg-background",children:(h||g)&&e.length===0?s.jsx("div",{className:"h-full overflow-y-auto scrollbar-hide",children:s.jsx(Ix,{count:5})}):L.length===0?s.jsx("div",{className:"h-full overflow-y-auto scrollbar-hide p-4",children:s.jsx(Wx,{onStartWriting:w,isGuest:j})}):s.jsx(Vx,{posts:L,userNickname:t,userProfileImage:n,userUid:r,isPostLanterned:x,isBookmarked:y,currentTitle:m,userProfiles:M,formatTimeAgo:P,formatCreatedAt:_,onPostClick:b,onLanternToggle:S,onBookmarkToggle:C,scrollRef:N,userTrustScore:k,isGuest:j})})]})}const Hx=J.memo(Fx);function $x({currentSubCategories:e,activeSubCategory:t,handleSubCategoryClick:n,filteredCount:r,sortBy:o,onSortChange:i,onRefresh:a,isRefreshing:c}){return s.jsxs("div",{className:"bg-card/98 glass-effect border-b border-border px-4 py-3 flex-shrink-0 shadow-sm relative z-20",children:[e.length>1&&s.jsx("div",{className:"flex space-x-2 overflow-x-auto scrollbar-hide mb-3",children:e.map(u=>{const d=t===u.id;return s.jsx(we,{variant:d?"default":"ghost",size:"sm","data-sub-id":u.id,onClick:n,className:`whitespace-nowrap flex-shrink-0 rounded-full px-4 transition-all duration-200 ${d?"bg-primary text-primary-foreground shadow-sm":"hover:bg-accent/80"}`,children:u.name},u.id)})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm text-muted-foreground",children:[r,"개의 글"]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[a&&s.jsx(we,{variant:"ghost",size:"sm",onClick:a,disabled:c,className:"h-8 w-8 p-0 rounded-full hover:bg-accent transition-all",children:s.jsx(Al,{className:`w-4 h-4 text-muted-foreground ${c?"animate-spin":""}`})}),s.jsx(Rx,{value:o,onChange:u=>i(u),options:Ox,triggerClassName:"w-24 h-8"})]})]})]})}function Wx({onStartWriting:e,isGuest:t}){return s.jsx(Ax,{icon:s.jsx(Rn,{className:"w-20 h-20 text-amber-900 dark:text-amber-200"}),title:"아직 글이 없어요",description:"첫 번째 글을 작성해서 비유노트 커뮤니티를 시작해보세요!",action:s.jsxs(we,{onClick:t?()=>{}:e,className:"bg-primary text-primary-foreground px-6 py-2 rounded-xl",disabled:t,children:[s.jsx(Rl,{className:"w-4 h-4 mr-2"}),"첫 글 작성하기"]}),glowClassName:"bg-amber-500/30 dark:bg-amber-400/30",circleClassName:"bg-amber-100 dark:bg-amber-900/40 border-4 border-amber-400 dark:border-amber-600"})}const Vx=J.memo(function({posts:t,userNickname:n,userProfileImage:r,userUid:o,isPostLanterned:i,isBookmarked:a,currentTitle:c,userProfiles:u,formatTimeAgo:d,formatCreatedAt:f,onPostClick:x,onLanternToggle:y,onBookmarkToggle:b,scrollRef:S,userTrustScore:C,isGuest:w}){const m=l.useMemo(()=>t.map(p=>({post:p,isLanterned:i(p.id),isBookmarked:a(p.id),timeAgo:d(p.createdAt),createdAtText:f(p.createdAt),authorProfile:p.authorUid?u[p.authorUid]:void 0})),[t,i,a,d,f,u]);return s.jsx(dx,{style:{height:"100%"},scrollerRef:p=>{S&&p&&(S.current=p)},data:m,className:"scrollbar-hide",itemContent:(p,{post:g,isLanterned:h,isBookmarked:k,timeAgo:j,createdAtText:v,authorProfile:R})=>s.jsx("div",{className:"px-4 py-1.5 first:pt-3 last:pb-24",children:s.jsx(qx,{post:g,userNickname:n,userProfileImage:r,userUid:o,isLanterned:h,isBookmarked:k,timeAgo:j,createdAtText:v,currentTitle:c,authorProfile:R,onPostClick:x,onLanternToggle:y,onBookmarkToggle:b,index:p,userTrustScore:C,isGuest:w},g.id)})})}),qx=J.memo(({post:e,userNickname:t,userProfileImage:n,userUid:r,isLanterned:o,isBookmarked:i,timeAgo:a,createdAtText:c,currentTitle:u,authorProfile:d,onPostClick:f,onLanternToggle:x,onBookmarkToggle:y,index:b=999,userTrustScore:S,isGuest:C})=>{const{navigateToLogin:w}=wl(),[m,p]=l.useState(!1),g=e.authorUid===r,h=d?.currentTitleId??null,k=Ei(h),j=l.useMemo(()=>g?n??"":d?.profileImage??Ys(e.authorAvatar)??"",[g,n,d?.profileImage,e.authorAvatar]),v=Ni(e.author??"",t,u),R=e.authorDeleted===!0||e.author==="탈퇴한 사용자",N=di(e.author,R),E=Mo(e.author,R),L=E?null:e.authorTitleName||k||v,O=l.useCallback(()=>{f(e)},[f,e]),I=l.useCallback(T=>{if(C){p(!0),T.preventDefault(),T.stopPropagation(),T.nativeEvent.stopImmediatePropagation();return}T.preventDefault(),T.stopPropagation(),T.nativeEvent.stopImmediatePropagation();const $=T.currentTarget;$.getAttribute("data-post-id")===String(e.id)&&($.hasAttribute("data-processing")||($.setAttribute("data-processing","true"),setTimeout(()=>{$.removeAttribute("data-processing")},1e3),x(e.id)))},[x,e.id,C]),P=l.useCallback(T=>{if(C){p(!0),T.preventDefault(),T.stopPropagation();return}T.preventDefault(),T.stopPropagation(),y(e.id)},[y,e.id,C]),_=l.useMemo(()=>{const T=typeof window<"u"&&document.documentElement.getAttribute("data-theme")||"default",$={midnight:"border-l-4 border-l-[#d4af37] shadow-md bg-card/90 hover:shadow-lg hover:border-l-[#e6c85a]","e-ink":"border-l-2 border-l-[#5a564d] shadow-sm bg-card/98 border-t border-t-[#d4cfc2]/50","golden-library":"bg-card/90 hover:shadow-lg",default:"border-border/60 shadow-sm bg-card/80"};return $[T]||$.default},[]),M=l.useMemo(()=>typeof window>"u"?!1:(document.documentElement.getAttribute("data-theme")||"default")==="greek-temple",[]),z=l.useMemo(()=>typeof window>"u"?!1:(document.documentElement.getAttribute("data-theme")||"default")==="golden-library",[]),F=g?S:d?.trustScore,Z=l.useMemo(()=>M?Mx(F):null,[M,F]),A=l.useMemo(()=>{const T=e.lanterns??0,$=e.views??0,K=e.type==="guide",V=e.author===t;return T>=10||$>=100||K||V},[e.lanterns,e.views,e.type,e.author,t]);return s.jsxs(s.Fragment,{children:[s.jsxs(Ct,{className:`${_} backdrop-blur-sm transition-all cursor-pointer list-optimized relative ${g&&z?"my-post-golden-border":""}`,onClick:O,"data-highlighted":A?"true":"false","data-lanterns":e.lanterns??0,"data-views":e.views??0,"data-type":e.type||"","data-is-owner":g?"true":"false",children:[M&&Z&&s.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 flex items-center justify-center opacity-60",children:s.jsx("div",{className:"h-full flex items-center justify-center py-2",children:s.jsx(Lx,{style:Z,size:16,className:"text-primary/70"})})}),s.jsx(St,{className:"p-4 relative z-10",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(hi,{src:j||void 0,alt:N?`${N}님의 프로필`:"프로필 이미지",nickname:E?void 0:N,fallbackText:N.charAt(0)?.toUpperCase()||"?",className:"w-10 h-10 ring-2 ring-border/20",size:40,loading:b<3?"eager":"lazy",decoding:"async"}),s.jsx("div",{className:"w-full",children:s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[M&&F!==void 0&&F>=70&&s.jsx("div",{className:`shrink-0 ${M?"laurel-wreath-premium":"laurel-wreath"}`,children:s.jsx(Ii,{size:14,isPremium:M})}),s.jsx("p",{className:"text-sm font-medium "+(E?"text-muted-foreground":""),children:N})]}),L&&s.jsx(dn,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:L})]}),s.jsx("div",{className:"text-xs text-muted-foreground",children:(e.timeAgo??a)&&s.jsx("span",{title:c||void 0,children:e.timeAgo??a})})]}),(()=>{const T=[e.category&&e.category!=="전체"?e.category:null,e.subCategory&&e.subCategory!=="전체"?e.subCategory:null,e.type?e.type==="guide"?"길잡이 글":"질문글":null].filter(Boolean);return T.length?s.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:T.join(" · ")}):null})()]})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"font-medium text-base mb-1 line-clamp-1",children:e.title}),s.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.content})]}),s.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50 relative z-10",onClick:T=>{T.stopPropagation()},onMouseDown:T=>T.stopPropagation(),onTouchStart:T=>T.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",onClick:T=>T.stopPropagation(),children:[g?s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(Rn,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs",children:e.lanterns??0})]}):s.jsx("div",{onClick:T=>T.stopPropagation(),children:s.jsxs(we,{type:"button",variant:"ghost",size:"sm",onClick:I,"data-post-id":e.id,className:`h-8 px-2 space-x-1 ${o?"text-amber-500":"text-muted-foreground"}`,disabled:C,children:[o?s.jsx(Go,{className:"w-4 h-4"}):s.jsx(Rn,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs",children:e.lanterns??0})]})}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(ai,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs",children:e.comments??e.replies?.length??0})]}),s.jsxs("span",{children:["조회수 ",e.views??0]})]}),s.jsx("div",{onClick:T=>T.stopPropagation(),children:s.jsx(we,{type:"button",variant:"ghost",size:"sm",onClick:P,className:`h-8 px-2 ${i?"text-primary":"text-muted-foreground"}`,disabled:C,children:s.jsx(ii,{className:`w-4 h-4 ${i?"fill-current":""}`})})})]})]})})]}),s.jsx(si,{open:m,onOpenChange:p,title:"로그인이 필요합니다.",description:"로그인 후 이 기능을 이용할 수 있습니다. 지금 로그인하시겠습니까?",confirmText:"로그인",onConfirm:w})]})},(e,t)=>{if(e.post.id!==t.post.id||e.isLanterned!==t.isLanterned||e.isBookmarked!==t.isBookmarked||e.post.lanterns!==t.post.lanterns||(e.post.comments??e.post.replies?.length)!==(t.post.comments??t.post.replies?.length)||e.post.views!==t.post.views||e.post.title!==t.post.title||e.post.content!==t.post.content||e.post.type!==t.post.type||e.post.author!==t.post.author||e.post.authorAvatar!==t.post.authorAvatar||(e.post.createdAt?.getTime?.()??0)!==(t.post.createdAt?.getTime?.()??0))return!1;const n=e.post.tags?.join(",")??"",r=t.post.tags?.join(",")??"";return!(n!==r||!Bx(e.authorProfile,t.authorProfile)||e.timeAgo!==t.timeAgo||e.createdAtText!==t.createdAtText||e.currentTitle!==t.currentTitle||e.userProfileImage!==t.userProfileImage||e.userNickname!==t.userNickname||e.userUid!==t.userUid||e.post.moderationStatus!==t.post.moderationStatus)});function Gx({isDarkMode:e,onToggleDarkMode:t,hasNotifications:n,showNotifications:r,onNotificationsToggle:o,notifications:i,onNotificationClick:a,onMarkAllNotificationsRead:c,onNotificationSettingsClick:u,onNotificationDelete:d,activeCategory:f,activeSubCategory:x,onCategoryClick:y,onQuizClick:b,onTitleShopClick:S,isAdmin:C,onOpenAdminReports:w,isGuest:m}){return s.jsx("header",{className:"bg-card/98 glass-effect border-b border-border/60 flex-shrink-0 z-40 safe-top",children:s.jsx("div",{className:"px-4 py-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(we,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200",onClick:y,children:s.jsx(Qd,{className:"w-5 h-5"})}),s.jsx("div",{children:s.jsxs("h1",{className:"text-lg font-semibold",children:[f,x!=="전체"&&` • ${x}`]})})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(we,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200 text-foreground",onClick:b,"aria-label":"주간 퀴즈",children:s.jsx(kl,{className:"w-5 h-5"})}),s.jsx(we,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200 text-foreground",onClick:m?()=>{}:S,disabled:m,children:s.jsx(hf,{className:"w-5 h-5"})}),C&&!m&&w&&s.jsx(we,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200 text-foreground",onClick:m?()=>{}:w,disabled:m,children:s.jsx(yo,{className:"w-5 h-5"})}),s.jsx(we,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200",onClick:t,children:e?s.jsx(Ad,{className:"w-4 h-4"}):s.jsx(Nd,{className:"w-4 h-4"})}),s.jsxs(Ai,{open:r,onOpenChange:o,children:[s.jsx(Vo,{asChild:!0,children:s.jsxs(we,{variant:"ghost",size:"icon",className:"relative",children:[s.jsx(Id,{className:"w-4 h-4"}),n&&s.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"})]})}),s.jsxs(qo,{className:"w-80 p-0",align:"end",side:"bottom",sideOffset:5,children:[s.jsx("div",{className:"p-4 border-b border-border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"font-medium",children:"알림"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[i.some(p=>!p.isRead)&&!m&&s.jsx(we,{variant:"outline",size:"sm",onClick:c,className:"text-xs h-7 px-2",disabled:m,children:"모두 읽음"}),s.jsx(we,{variant:"ghost",size:"icon",onClick:m?()=>{}:u,disabled:m,children:s.jsx(df,{className:"w-4 h-4"})})]})]})}),s.jsx("div",{className:"max-h-80 scroll-optimized",children:i.length===0?s.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"새로운 알림이 없습니다"}):s.jsx(s.Fragment,{children:i.map(p=>s.jsx(Xx,{notification:p,onNotificationClick:a,onDelete:d?()=>d(p.id):void 0},p.id))})})]})]})]})]})})})}const Yx=J.memo(Gx),Xx=J.memo(function({notification:t,onNotificationClick:n,onDelete:r}){const o=l.useRef(null),i=l.useRef(null),a=l.useRef(0),[c,u]=J.useState(0),d=l.useRef(!1),f=80,x=10,y=l.useCallback(()=>{a.current=0,u(0),o.current=null,i.current=null,d.current=!1},[]),b=l.useCallback((v,R)=>{o.current=v,i.current=R,a.current=0,d.current=!1,u(0)},[]),S=l.useCallback((v,R)=>{if(o.current===null||i.current===null)return;const N=v-o.current,E=Math.abs(R-i.current);Math.abs(N)>x&&Math.abs(N)>E*1.5?(d.current=!0,a.current=N,u(N)):d.current&&Math.abs(N)>0&&(a.current=N,u(N))},[]),C=l.useCallback(()=>{if(o.current===null)return;Math.abs(a.current)>f&&r&&r(),y()},[r,y]),w=l.useCallback(v=>{const R=v.touches[0];b(R.clientX,R.clientY)},[b]),m=l.useCallback(v=>{if(o.current===null||i.current===null)return;const R=v.touches[0],N=R.clientX-o.current,E=Math.abs(R.clientY-i.current);Math.abs(N)>x&&Math.abs(N)>E*1.5?(d.current=!0,a.current=N,u(N),v.preventDefault(),v.stopPropagation()):d.current&&(v.preventDefault(),v.stopPropagation())},[]),p=l.useCallback(v=>{d.current&&(v.preventDefault(),v.stopPropagation()),C()},[C]),g=l.useCallback(v=>{b(v.clientX,v.clientY);const R=E=>{o.current!==null&&S(E.clientX,E.clientY)},N=()=>{C(),document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",N)};document.addEventListener("mousemove",R),document.addEventListener("mouseup",N)},[b,S,C]),h=l.useCallback(v=>{if(d.current||Math.abs(a.current)>x){v.preventDefault(),v.stopPropagation();return}n(t)},[t,n]),k=Math.abs(c)>f?.4:1,j=Math.abs(c)>20;return s.jsxs("div",{className:`p-4 border-b border-border hover:bg-muted/50 transition-all cursor-pointer relative overflow-hidden select-none ${t.isRead?"":"bg-muted/30"}`,onClick:h,onTouchStart:w,onTouchMove:m,onTouchEnd:p,onMouseDown:g,style:{transform:`translateX(${c}px)`,opacity:k,transition:c===0?"transform 0.2s ease-out, opacity 0.2s ease-out":"none",touchAction:Math.abs(c)>0?"pan-x":"pan-y"},children:[j&&s.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center justify-end px-4 bg-destructive text-destructive-foreground pointer-events-none",style:{width:`${Math.min(Math.abs(c)+20,120)}px`},children:s.jsx("span",{className:"text-xs font-medium whitespace-nowrap",children:"삭제"})}),s.jsxs("div",{className:"flex items-start space-x-3 relative z-10",children:[s.jsxs("div",{className:"flex-shrink-0 mt-1",children:[t.type==="reply"&&s.jsx(ai,{className:"w-4 h-4 text-blue-500"}),t.type==="lantern"&&s.jsx(Go,{className:"w-4 h-4 text-amber-500"}),t.type==="popular"&&s.jsx(yo,{className:"w-4 h-4 text-primary"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm",children:t.message}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.postTitle," • ",t.time]})]}),!t.isRead&&s.jsx("div",{className:"w-2 h-2 bg-primary rounded-full flex-shrink-0"})]})]})});function ul({title:e,subtitle:t,onBack:n,rightSlot:r}){return s.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:s.jsx("div",{className:"px-4 py-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[n&&s.jsx(we,{variant:"ghost",size:"icon",onClick:n,children:s.jsx(Cl,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("h1",{className:"font-medium",children:e}),t&&s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t})]})]}),r&&s.jsx("div",{children:r})]})})})}const Zx="weekly_quizzes",Kx="user_quiz_answers";function Qx(e=new Date){const t=new Date(e.toLocaleString("en-US",{timeZone:"Asia/Seoul"})),n=t.getFullYear(),r=new Date(n,0,1),o=Math.floor((t.getTime()-r.getTime())/(1440*60*1e3)),i=Math.ceil((o+r.getDay()+1)/7);return`${n}-W${i.toString().padStart(2,"0")}`}function Jx({onBack:e}){const[t,n]=l.useState("category"),[r,o]=l.useState(null),[i,a]=l.useState(0),[c,u]=l.useState(new Map),[d,f]=l.useState(!1),[x,y]=l.useState(null),[b,S]=l.useState(!1),[C,w]=l.useState([]),[m,p]=l.useState(new Map),g=l.useMemo(()=>Qx(),[]);l.useEffect(()=>{(async()=>{S(!0);try{const P=Oe(he,Zx),_=Et(P,Ht("weekId","==",g)),M=await et(_),z=new Map,F=[];M.forEach(Z=>{const A=Z.data(),T=A.category;T&&Array.isArray(A.questions)&&A.questions.length>0&&(z.set(T,{weekId:A.weekId,category:T,startDate:A.startDate?.toDate?.()??new Date,endDate:A.endDate?.toDate?.()??new Date,questions:A.questions,rewards:A.rewards??{perfect:10,partial:5}}),F.push(T))}),p(z),w(F)}catch{H.error("퀴즈를 불러오지 못했습니다.")}finally{S(!1)}})()},[g]);const h=l.useCallback(I=>{const P=m.get(I);if(!P){H.error("해당 카테고리 퀴즈를 찾을 수 없습니다.");return}o(P),a(0),u(new Map),f(!1),y(null),n("quiz")},[m]),k=l.useCallback((I,P)=>{u(_=>{const M=new Map(_);return M.set(I,P),M})},[]),j=l.useCallback(async()=>{if(!r||!ge.currentUser)return;const I=[];let P=0;r.questions.forEach(z=>{const F=c.get(z.id)??-1,Z=F===z.correctIndex;Z&&P++,I.push({questionId:z.id,selectedIndex:F,isCorrect:Z})});const _=Math.round(P/r.questions.length*100),M=r.questions.length;y({score:_,correctCount:P,totalCount:M}),f(!0);try{const z={userId:ge.currentUser.uid,weekId:r.weekId,category:r.category,answers:I,score:_,completedAt:Zt()},F=je(he,Kx,`${ge.currentUser.uid}_${r.weekId}_${r.category}`);await Vn(F,z,{merge:!0}),_===100?H.success(`완벽합니다! ${r.rewards.perfect} 루멘을 획득했습니다.`):_>=60&&H.success(`잘하셨어요! ${r.rewards.partial} 루멘을 획득했습니다.`)}catch{}},[r,c]),v=l.useCallback(()=>{r&&(i<r.questions.length-1?a(I=>I+1):j())},[r,i,j]),R=l.useCallback(()=>{n("category"),o(null),a(0),u(new Map),f(!1),y(null)},[]),N=l.useCallback(()=>{r&&(a(0),u(new Map),f(!1),y(null))},[r]),E=r?.questions[i],L=E&&c.has(E.id),O=i===(r?.questions.length??0)-1;return t==="category"?s.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[s.jsx(ul,{title:"주간 퀴즈",onBack:e}),s.jsx("div",{className:"flex-1 overflow-y-auto flex items-center justify-center",children:s.jsx("div",{className:"max-w-screen-md w-full px-4 py-4",children:b?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("p",{className:"text-muted-foreground",children:"퀴즈를 불러오는 중..."})}):C.length===0?s.jsx(Nx,{icon:s.jsx(kl,{className:"w-12 h-12 text-muted-foreground"}),title:"이번 주 퀴즈가 없습니다",description:"다음 주에 새로운 퀴즈가 생성됩니다."}):s.jsxs("div",{className:"space-y-3",children:[s.jsx(Ct,{children:s.jsxs(St,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(Ms,{className:"w-5 h-5 text-amber-500"}),s.jsx("p",{className:"font-medium",children:"이번 주 퀴즈"})]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"카테고리별로 문제를 풀고 루멘을 획득하세요!"})]})}),C.map(I=>{const P=m.get(I),_=P?.questions.length??0;return s.jsx(Ct,{className:"cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>h(I),children:s.jsx(St,{className:"p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:I}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[_,"문제"]})]}),s.jsxs(dn,{variant:"secondary",children:[P?.rewards.perfect??10," 루멘"]})]})})},I)})]})})})]}):t==="quiz"&&r&&E?s.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[s.jsx(ul,{title:`${r.category} 퀴즈`,onBack:d?void 0:R}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:s.jsx("div",{className:"max-w-screen-md mx-auto px-4 py-4",children:d&&x?s.jsxs("div",{className:"space-y-4",children:[s.jsx(Ct,{className:"bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/20",children:s.jsxs(St,{className:"p-6 text-center",children:[s.jsx("div",{className:"flex justify-center mb-4",children:x.score===100?s.jsx(Ms,{className:"w-16 h-16 text-amber-500"}):x.score>=60?s.jsx(na,{className:"w-16 h-16 text-green-500"}):s.jsx(oa,{className:"w-16 h-16 text-red-500"})}),s.jsxs("p",{className:"text-2xl font-bold mb-2",children:[x.score,"점"]}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.correctCount," / ",x.totalCount," 정답"]}),x.score===100&&s.jsxs("p",{className:"text-sm text-amber-500 mt-2",children:["+",r.rewards.perfect," 루멘 획득!"]}),x.score>=60&&x.score<100&&s.jsxs("p",{className:"text-sm text-green-500 mt-2",children:["+",r.rewards.partial," 루멘 획득!"]})]})}),s.jsx("div",{className:"space-y-3",children:r.questions.map((I,P)=>{const _=c.get(I.id)??-1,M=_===I.correctIndex;return s.jsx(Ct,{children:s.jsx(St,{className:"p-4",children:s.jsxs("div",{className:"flex items-start space-x-2 mb-3",children:[M?s.jsx(na,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}):s.jsx(oa,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("p",{className:"font-medium mb-2",children:[P+1,". ",I.question]}),s.jsx("div",{className:"space-y-2",children:I.options.map((z,F)=>{const Z=_===F,A=F===I.correctIndex;return s.jsx("div",{className:`p-2 rounded border ${A?"bg-green-500/10 border-green-500/50":Z&&!A?"bg-red-500/10 border-red-500/50":"bg-muted/30 border-border"}`,children:s.jsxs("p",{className:"text-sm",children:[String.fromCharCode(65+F),". ",z,A&&" ✓"]})},F)})}),s.jsx("div",{className:"mt-3 p-2 bg-muted/30 rounded",children:s.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.jsx("span",{className:"font-medium",children:"해설:"})," ",I.explanation]})})]})]})})},I.id)})}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(we,{variant:"outline",className:"flex-1",onClick:R,children:"카테고리 선택"}),s.jsx(we,{className:"flex-1",onClick:N,children:"다시 풀기"})]})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsx(Ct,{children:s.jsxs(St,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("p",{className:"font-medium",children:[i+1," / ",r.questions.length]}),s.jsxs(dn,{variant:"secondary",children:[Math.round((i+1)/r.questions.length*100),"%"]})]}),s.jsx("p",{className:"text-lg mb-4",children:E.question})]})}),s.jsx("div",{className:"space-y-2",children:E.options.map((I,P)=>{const _=c.get(E.id)===P;return s.jsx(Ct,{className:`cursor-pointer transition-colors ${_?"bg-primary/10 border-primary":"hover:bg-accent/50"}`,onClick:()=>k(E.id,P),children:s.jsx(St,{className:"p-4",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${_?"border-primary bg-primary":"border-muted-foreground"}`,children:_&&s.jsx("div",{className:"w-2 h-2 rounded-full bg-primary-foreground"})}),s.jsxs("p",{className:"flex-1",children:[String.fromCharCode(65+P),". ",I]})]})})},P)})}),s.jsx(we,{className:"w-full",onClick:v,disabled:!L,children:O?"결과 확인":"다음 문제"})]})})})]}):null}const so={stroke:"currentColor",fill:"none",display:"block",width:"20px",height:"20px"},dl={stroke:"#ffffff",fill:"none",display:"block",width:"24px",height:"24px"},ey=({size:e=20,className:t=""})=>s.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:t,children:[s.jsx("path",{d:"M12 2L4 7v2h16V7l-8-5z"}),s.jsx("path",{d:"M4 9v10h16V9"}),s.jsx("path",{d:"M4 9h16"}),s.jsx("path",{d:"M8 9v10"}),s.jsx("path",{d:"M16 9v10"}),s.jsx("path",{d:"M12 9v10"})]}),ty=({size:e=24,className:t=""})=>s.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"#ffffff",strokeWidth:"2.5",className:t,children:[s.jsx("path",{d:"M12 8c-2 0-4 1-4 3s2 3 4 3 4-1 4-3-2-3-4-3z"}),s.jsx("path",{d:"M8 11c-1-1-1-2 0-3"}),s.jsx("path",{d:"M16 11c1-1 1-2 0-3"}),s.jsx("path",{d:"M6 14c-1 0-2-1-1-2"}),s.jsx("path",{d:"M18 14c1 0 2-1 1-2"}),s.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"none"})]}),ny=({size:e=20,className:t=""})=>s.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:t,children:[s.jsx("ellipse",{cx:"12",cy:"8",rx:"6",ry:"5"}),s.jsx("path",{d:"M6 13c0 2 2 4 6 4s6-2 6-4"}),s.jsx("path",{d:"M9 17h6"}),s.jsx("path",{d:"M8 20h8"})]});function ry({onHomeClick:e,onRankingClick:t,onBookmarksClick:n,onMyPageClick:r,onWriteClick:o,activeTab:i="home"}){const[a,c]=l.useState(!1),[u,d]=l.useState(!1);l.useEffect(()=>{const w=()=>{const p=document.documentElement.getAttribute("data-theme");c(p==="greek-temple"),d(p==="golden-library")};w();const m=new MutationObserver(w);return m.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>m.disconnect()},[]);const f=l.useCallback((w,m)=>{const p=m.currentTarget;p.blur(),setTimeout(()=>{p.style.backgroundColor="transparent",p.classList.remove("focus:bg-accent","focus-visible:bg-accent")},0),w()},[]),x=l.useCallback(w=>{f(e,w)},[f,e]),y=l.useCallback(w=>{f(t,w)},[f,t]),b=l.useCallback(w=>{o&&f(o,w)},[f,o]),S=l.useCallback(w=>{f(n,w)},[f,n]),C=l.useCallback(w=>{f(r,w)},[f,r]);return s.jsxs("nav",{className:"bg-card/98 glass-effect border-t border-border flex-shrink-0 shadow-[0_-2px_8px_rgba(0,0,0,0.04)] dark:shadow-[0_-2px_8px_rgba(0,0,0,0.2)] safe-nav-bottom relative",children:[o&&s.jsxs(we,{className:"write-button absolute left-1/2 -translate-x-1/2 -top-5 rounded-full w-14 h-14 bg-primary hover:bg-primary/90 shadow-lg hover:shadow-xl overflow-hidden z-10",onClick:b,children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/80 to-primary rounded-full"}),a?s.jsxs("div",{className:"relative z-10 flex items-center justify-center",children:[s.jsx(ty,{size:24}),s.jsx(bf,{size:12,className:"absolute",style:{stroke:"#ffffff",fill:"#ffffff"}})]}):u?s.jsx(jl,{size:24,strokeWidth:2.5,style:dl,className:"relative z-10"}):s.jsx(Rl,{size:24,strokeWidth:2.5,style:dl,className:"relative z-10"})]}),s.jsx("div",{className:"px-2 py-2",children:s.jsxs("div",{className:"flex items-center justify-between max-w-md mx-auto",children:[s.jsxs("div",{className:"flex items-center justify-around flex-1",children:[s.jsxs(we,{"data-perf-ignore":"true",variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${i==="home"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:x,children:[a?s.jsx(ey,{size:20,className:`transition-transform duration-200 ${i==="home"?"scale-110":""}`}):s.jsx(Zd,{size:20,strokeWidth:2,style:so,className:`transition-transform duration-200 ${i==="home"?"scale-110":""}`}),s.jsx("span",{className:"text-xs font-medium",children:"홈"})]}),s.jsxs(we,{"data-perf-ignore":"true",variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${i==="ranking"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:y,children:[s.jsx(Ms,{size:20,strokeWidth:2,style:so,className:`transition-transform duration-200 ${i==="ranking"?"scale-110":""}`}),s.jsx("span",{className:"text-xs font-medium",children:"랭킹"})]})]}),s.jsx("div",{className:"w-16"}),s.jsxs("div",{className:"flex items-center justify-around flex-1",children:[s.jsxs(we,{"data-perf-ignore":"true",variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${i==="bookmarks"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:S,children:[s.jsx(ii,{size:20,strokeWidth:2,style:so,className:`transition-transform duration-200 ${i==="bookmarks"?"scale-110":""}`}),s.jsx("span",{className:"text-xs font-medium",children:"북마크"})]}),s.jsxs(we,{"data-perf-ignore":"true",variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${i==="profile"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:C,children:[a?s.jsx(ny,{size:20,className:`transition-transform duration-200 ${i==="profile"?"scale-110":""}`}):s.jsx(vf,{size:20,strokeWidth:2,style:so,className:`transition-transform duration-200 ${i==="profile"?"scale-110":""}`}),s.jsx("span",{className:"text-xs font-medium",children:"내 정보"})]})]})]})})]})}const Qe=J.memo(ry),Uu=l.createContext(null);function oy({children:e}){const[t,n]=l.useState({name:"home"}),[r,o]=l.useState("home"),[i,a]=l.useState(null),c=l.useRef([]),u=l.useCallback(M=>{const z=c.current.filter(F=>F!==M);z.push(M),c.current=z},[]),d=l.useCallback(M=>{c.current=c.current.filter(z=>z!==M)},[]),f=l.useCallback(()=>{const M=c.current;if(M.length===0)return null;const z=M[M.length-1];return c.current=M.slice(0,-1),z},[]),x=l.useCallback(()=>{c.current=[]},[]),y=l.useCallback(M=>{switch(M.name){case"home":return"home";case"ranking":return"ranking";case"bookmarks":return"bookmarks";case"myPage":return"profile";case"titlesCollection":return"titlesCollection";case"achievements":return"achievements";case"quiz":return"home";case"postDetail":return"home";case"userProfile":return"home";case"category":case"search":case"titleShop":return"home";case"followList":case"myContentList":return"profile";case"adminReports":return"home";case"notificationSettings":return"profile";default:return"home"}},[]),b=l.useCallback(M=>{const z={showMyPage:!1,showCategoryScreen:!1,showSearchScreen:!1,showNotificationSettings:!1,showBookmarks:!1,showWriteScreen:!1,showPostWarning:!1,showTitleShop:!1,showTitlesCollection:!1,showRanking:!1,showAchievements:!1,showTheme:!1,showGuidelines:!1,showNotifications:!1,showFollowList:null,showMyContentList:null,showUserProfile:null,currentScreen:"home"};switch(M.name){case"home":return z;case"ranking":return{...z,showRanking:!0};case"bookmarks":return{...z,showBookmarks:!0};case"myPage":return{...z,showMyPage:!0};case"category":return{...z,showCategoryScreen:!0};case"search":return{...z,showSearchScreen:!0};case"titleShop":return{...z,showTitleShop:!0};case"titlesCollection":return{...z,showTitlesCollection:!0};case"achievements":return{...z,showAchievements:!0};case"theme":return{...z,showTheme:!0};case"quiz":return z;case"followList":return{...z,showFollowList:M.mode};case"myContentList":return{...z,showMyContentList:M.mode};case"userProfile":return{...z,showUserProfile:M.nickname};case"postDetail":return z;case"adminReports":return z;case"notificationSettings":return{...z,showMyPage:!0,showNotificationSettings:!0};default:return z}},[]),S=l.useCallback(M=>{n(M),o(y(M))},[y]),C=l.useCallback(()=>S({name:"home"}),[S]),w=l.useCallback(()=>S({name:"ranking"}),[S]),m=l.useCallback(()=>S({name:"bookmarks"}),[S]),p=l.useCallback(()=>S({name:"myPage"}),[S]),g=l.useCallback(()=>S({name:"category"}),[S]),h=l.useCallback(()=>S({name:"search"}),[S]),k=l.useCallback(()=>S({name:"titleShop"}),[S]),j=l.useCallback(()=>S({name:"titlesCollection"}),[S]),v=l.useCallback(()=>S({name:"achievements"}),[S]),R=l.useCallback(()=>S({name:"quiz"}),[S]),N=l.useCallback(M=>S({name:"followList",mode:M}),[S]),E=l.useCallback(M=>S({name:"myContentList",mode:M}),[S]),L=l.useCallback(M=>S({name:"userProfile",nickname:M}),[S]),O=l.useCallback((M,z)=>S({name:"postDetail",postId:M,source:z}),[S]),I=l.useCallback(()=>S({name:"adminReports"}),[S]),P=l.useCallback(()=>S({name:"notificationSettings"}),[S]),_=l.useMemo(()=>({route:t,setRoute:n,currentScreen:r,setCurrentScreen:o,visibility:b(t),goHome:C,goRanking:w,goBookmarks:m,goMyPage:p,goCategory:g,goSearch:h,goTitleShop:k,goTitlesCollection:j,goAchievements:v,goQuiz:R,goFollowList:N,goMyContentList:E,goUserProfile:L,goPostDetail:O,goAdminReports:I,goNotificationSettings:P,layerStackRef:c,pushLayer:u,removeLayer:d,clearLayers:x,popLayer:f,writeDraft:i,setWriteDraft:a}),[t,r,b,C,w,m,p,g,h,k,j,v,R,N,E,L,O,I,P,u,d,x,f,i,a,c,o]);return s.jsx(Uu.Provider,{value:_,children:e})}function sy(){const e=l.useContext(Uu);if(!e)throw new Error("useNavigationStore must be used within NavigationStoreProvider");return e}const fl=[{id:"전체",name:"전체",icon:Gd,count:0,subCategories:[{id:"전체",name:"전체",count:0}]},{id:"공학",name:"공학",icon:Bd,count:0,subCategories:[{id:"전체",name:"전체",count:0},{id:"소프트웨어",name:"소프트웨어",count:0},{id:"기계공학",name:"기계공학",count:0},{id:"전자공학",name:"전자공학",count:0},{id:"건축공학",name:"건축공학",count:0}]},{id:"과학",name:"과학",icon:sa,count:0,subCategories:[{id:"전체",name:"전체",count:0},{id:"물리학",name:"물리학",count:0},{id:"화학",name:"화학",count:0},{id:"생물학",name:"생물학",count:0},{id:"지구과학",name:"지구과학",count:0},{id:"천문학",name:"천문학",count:0}]},{id:"경제",name:"경제",icon:Hd,count:0,subCategories:[{id:"전체",name:"전체",count:0},{id:"거시경제",name:"거시경제",count:0},{id:"미시경제",name:"미시경제",count:0},{id:"금융",name:"금융",count:0},{id:"국제경제",name:"국제경제",count:0},{id:"계량경제",name:"계량경제",count:0}]},{id:"수학",name:"수학",icon:_d,count:0,subCategories:[{id:"전체",name:"전체",count:0},{id:"대수학",name:"대수학",count:0},{id:"기하학",name:"기하학",count:0},{id:"해석학",name:"해석학",count:0},{id:"통계학",name:"통계학",count:0},{id:"이산수학",name:"이산수학",count:0}]},{id:"예술",name:"예술",icon:jd,count:0,subCategories:[{id:"전체",name:"전체",count:0},{id:"미술",name:"미술",count:0},{id:"음악",name:"음악",count:0},{id:"문학",name:"문학",count:0}]},{id:"철학",name:"철학",icon:jl,count:0,subCategories:[{id:"전체",name:"전체",count:0},{id:"동양철학",name:"동양철학",count:0},{id:"서양철학",name:"서양철학",count:0}]},{id:"기타",name:"기타",icon:sa,count:0,subCategories:[{id:"전체",name:"전체",count:0},{id:"자유",name:"자유",count:0}]}],iy=l.lazy(()=>Be(()=>import("./MyPageScreen-SpDGq-et.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]),import.meta.url).then(e=>({default:e.MyPageScreen}))),ay=l.lazy(()=>Be(()=>import("./CategoryScreen-D6JXZrsA.js"),__vite__mapDeps([36,1,2,3,4,5,6,7,8,37,20,38,18,10,11,12,13,15,32,33,34,35,27,22]),import.meta.url).then(e=>({default:e.CategoryScreen}))),ly=l.lazy(()=>Be(()=>import("./SearchScreen-CHVKd83-.js"),__vite__mapDeps([39,1,2,3,4,5,40,6,7,37,16,10,11,20,38,41,18,8,12,13,15,32,33,34,35,27,22]),import.meta.url).then(e=>({default:e.SearchScreen}))),cy=l.lazy(()=>Be(()=>import("./RankingScreen-CleX25xt.js"),__vite__mapDeps([42,1,2,3,4,5,8,6,7,14,10,11,15,12,13,25,20,41,43,18,32,33,34,35,27,22]),import.meta.url).then(e=>({default:e.RankingScreen}))),uy=l.lazy(()=>Be(()=>import("./BookmarkScreen-01H30ULA.js"),__vite__mapDeps([44,1,2,3,4,5,6,7,8,37,20,38,18,10,11,12,13,15,32,33,34,35,27,22]),import.meta.url).then(e=>({default:e.BookmarkScreen}))),dy=l.lazy(()=>Be(()=>import("./MyContentListScreen-CrXHqBkT.js"),__vite__mapDeps([45,1,2,3,4,5,25,6,7,20,8,29,18,10,11,12,13,15,32,33,34,35,27,22]),import.meta.url).then(e=>({default:e.MyContentListScreen}))),fy=J.memo(cy),hy=J.memo(uy),my=J.memo(ly),py=l.lazy(()=>Be(()=>import("./WriteScreen-CkILADPX.js"),__vite__mapDeps([46,1,2,3,4,5,40,6,7,18,35,8,37,32,12,10,11,13,20,30,15,33,34,27,22]),import.meta.url).then(e=>({default:e.default}))),gy=l.lazy(()=>Be(()=>import("./NotesScreen-DhwxMpts.js"),__vite__mapDeps([47,1,2,3,4,5,18,6,7,8,10,11,12,13,15,32,33,34,35,20,27,22]),import.meta.url)),xy=l.lazy(()=>Be(()=>import("./NoteDetailScreen-nRAMIs_w.js"),__vite__mapDeps([48,1,2,3,4,5,6,7,8,20,24,29,18,10,11,12,13,15,32,33,34,35,27,22]),import.meta.url)),yy=l.lazy(()=>Be(()=>import("./QuestionComposeScreen-D9DE9d_J.js"),__vite__mapDeps([49,1,2,3,4,5,18,6,7,8,10,11,12,13,15,32,33,34,35,20,27,22]),import.meta.url).then(e=>({default:e.QuestionComposeScreen}))),vy=l.lazy(()=>Be(()=>import("./TitleShop-B-kx8AuZ.js"),__vite__mapDeps([50,1,2,3,4,5,6,7,8,18,51,33,43,30,20,13,52,53,10,11,12,15,32,34,35,27,22]),import.meta.url).then(e=>({default:e.TitleShop}))),wy=l.lazy(()=>Be(()=>import("./TitlesCollection-CHxM74HX.js"),__vite__mapDeps([54,1,2,3,4,5,8,6,7,51,33,43,30,20,52,18,10,11,12,13,15,32,34,35,27,22]),import.meta.url).then(e=>({default:e.TitlesCollection}))),by=l.lazy(()=>Be(()=>import("./AchievementsScreen-DQEjk4Sr.js"),__vite__mapDeps([55,1,2,3,4,5,6,7,8,20,52,18,10,11,12,13,15,32,33,34,35,27,22]),import.meta.url).then(e=>({default:e.AchievementsScreen}))),Cy=l.lazy(()=>Be(()=>import("./ThemeScreen-CkrnFEE1.js"),__vite__mapDeps([56,1,2,3,4,5,6,7,8,16,10,11,9,18,20,33,21,22,13,52]),import.meta.url).then(e=>({default:e.ThemeScreen}))),Sy=l.lazy(()=>Be(()=>import("./FollowListScreen-_qyJQQKQ.js"),__vite__mapDeps([57,1,2,3,4,5,8,6,7,25,20,28,27,18,10,11,12,13,15,32,33,34,35,22]),import.meta.url).then(e=>({default:e.FollowListScreen}))),ky=l.lazy(()=>Be(()=>import("./UserProfileDialog-DF4iNReH.js"),__vite__mapDeps([58,1,2,3,4,5,6,7,8,14,10,11,15,12,13,18,25,20,57,28,27,32,33,34,35,22,45,29,26]),import.meta.url).then(e=>({default:e.UserProfileDialog}))),Ty=l.lazy(()=>Be(()=>import("./NotificationSettingsDialog-C9an01YN.js"),__vite__mapDeps([59,1,2,3,4,5,6,7,16,10,11,17,18,25,20,8,12,13,15,32,33,34,35,27,22]),import.meta.url).then(e=>({default:e.NotificationSettingsDialog}))),hl=l.lazy(()=>Be(()=>import("./ReportDialog-C7kBk4J1.js"),__vite__mapDeps([60,1,2,3,4,5,6,7,9,12,10,11,13,18,32,8,53,15,33,34,35,20,27,22]),import.meta.url).then(e=>({default:e.ReportDialog}))),jy=l.lazy(()=>Be(()=>import("./AdminReportScreen-CZS8Q3Pi.js"),__vite__mapDeps([61,1,2,3,4,5,6,7,8,32,12,10,11,13,25,20]),import.meta.url).then(e=>({default:e.AdminReportScreen}))),io=Object.freeze([]),Ry=120*1e3,Je=()=>s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-muted animate-pulse"}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"불러오는 중..."})]})}),Ay=()=>s.jsxs("div",{className:"w-full h-full bg-background flex flex-col",children:[s.jsx("div",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top sticky top-0 z-10",children:s.jsx("div",{className:"px-4 py-3",children:s.jsxs("div",{className:"flex items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 min-w-0",children:[s.jsx("div",{className:"w-10 h-10 rounded bg-muted animate-pulse"}),s.jsx("div",{className:"h-6 w-24 rounded bg-muted animate-pulse"})]}),s.jsx("div",{className:"h-8 w-32 rounded-full bg-muted animate-pulse"})]})})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:Array.from({length:6}).map((e,t)=>s.jsx("div",{className:"rounded-lg border bg-card p-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("div",{className:"h-5 w-32 rounded bg-muted animate-pulse"}),s.jsx("div",{className:"h-4 w-48 rounded bg-muted animate-pulse"})]}),s.jsx("div",{className:"h-9 w-20 rounded bg-muted animate-pulse"})]})},t))})]}),Ny=()=>s.jsxs("div",{className:"w-full h-full bg-background flex flex-col",children:[s.jsx("div",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top sticky top-0 z-10",children:s.jsx("div",{className:"px-4 py-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"h-6 w-24 rounded bg-muted animate-pulse"}),s.jsx("div",{className:"w-10 h-10 rounded bg-muted animate-pulse"})]})})}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[s.jsx("div",{className:"rounded-lg border bg-card p-6",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-20 h-20 rounded-full bg-muted animate-pulse"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("div",{className:"h-5 w-32 rounded bg-muted animate-pulse"}),s.jsx("div",{className:"h-4 w-48 rounded bg-muted animate-pulse"})]})]})}),Array.from({length:4}).map((e,t)=>s.jsx("div",{className:"rounded-lg border bg-card p-4",children:s.jsx("div",{className:"h-16 w-full rounded bg-muted animate-pulse"})},t))]})]}),Ps=3600*1e3;function ao(e,t,n,r){l.useEffect(()=>{const o=r.current;if(t){o[e]&&(clearTimeout(o[e]),delete o[e]),n(i=>{if(i.has(e))return i;const a=new Set(i);return a.add(e),a});return}return o[e]&&clearTimeout(o[e]),o[e]=window.setTimeout(()=>{n(i=>{if(!i.has(e))return i;const a=new Set(i);return a.delete(e),a}),delete o[e]},Ry),()=>{o[e]&&(clearTimeout(o[e]),delete o[e])}},[t,e,n,r])}function ml(e){if(!e)return null;if(e instanceof Date)return e;if(e&&typeof e.toDate=="function")try{return e.toDate()}catch{return null}if(typeof e=="string"||typeof e=="number"){const t=new Date(e);if(!Number.isNaN(t.getTime()))return t}return null}function Ey(e){return s.jsx(oy,{children:s.jsx(Iy,{...e})})}function Iy({userNickname:e,userProfileImage:t,onProfileImageChange:n,onLogout:r,isDarkMode:o,onToggleDarkMode:i,onRequestExit:a,onShowTerms:c,onShowPrivacy:u,onShowOpenSourceLicenses:d,onShowAttributions:f,onThemeClick:x,shouldOpenMyPageOnMain:y,shouldOpenSettingsOnMyPage:b,onMainScreenReady:S,onSettingsOpenedFromMain:C,isGuest:w}){const[m,p]=l.useState(()=>typeof window<"u"&&localStorage.getItem("app-theme")||"default");l.useEffect(()=>{const D=()=>{const X=localStorage.getItem("app-theme")||"default";p(X)};window.addEventListener("theme-changed",D);const U=X=>{X.key==="app-theme"&&p(X.newValue||"default")};return window.addEventListener("storage",U),()=>{window.removeEventListener("theme-changed",D),window.removeEventListener("storage",U)}},[]);const{route:g,setRoute:h,currentScreen:k,setCurrentScreen:j,visibility:v,pushLayer:R,removeLayer:N,popLayer:E,goHome:L,goRanking:O,goBookmarks:I,goMyPage:P,goPostDetail:_,goAchievements:M,setWriteDraft:z}=sy(),[F,Z]=l.useState(!1),[A,T]=l.useState(null),[$,K]=l.useState(!1),[V,q]=l.useState(null),[se,G]=l.useState(!1),[B,te]=l.useState(!1);l.useEffect(()=>{const D=requestAnimationFrame(()=>{te(!0)});return()=>cancelAnimationFrame(D)},[]);const oe=Kf({enabled:B}),{posts:Q,setPosts:me,loading:fe,refresh:ne}=nh(),ae=oe.balance,[ue,ie]=l.useState("home"),[de,Se]=l.useState(null),[Te,nn]=l.useState(!1),[rn,on]=l.useState("전체"),[at,yt]=l.useState("전체"),[bn,In]=l.useState("latest"),Gt=l.useRef(null),vt=l.useRef((()=>{if(typeof window>"u")return new Set;try{const D=localStorage.getItem("aiAutoReplyTriggered");return D?new Set(JSON.parse(D)):new Set}catch{return new Set}})()),sn=l.useRef(null),an=F,er=g.name==="questionCompose",Mr=v.showMyPage,Wi=v.showCategoryScreen,Vi=v.showTitleShop,Bu=v.showTitlesCollection,tr=v.showUserProfile,qi=v.showRanking,Qo=v.showSearchScreen,Fu=v.showAchievements,Hu=v.showTheme,Gi=v.showBookmarks||k==="bookmarks",nr=v.showNotificationSettings,$u=g.name==="quiz",Cn=v.showFollowList,rr=v.showMyContentList,Dr=v.showMyPage,Or=v.showCategoryScreen,zr=v.showSearchScreen,Ur=v.showTitleShop,Br=v.showTitlesCollection,Fr=v.showAchievements,Yi=v.showTheme,Hr=v.showUserProfile,Wu=g.name==="notes",$r=Cn,Jo=rr;l.useEffect(()=>{switch(g.name){case"questionCompose":j("home");break;case"home":j("home");break;case"myPage":j("profile");break;case"ranking":j("ranking");break;case"bookmarks":j("bookmarks");break;case"category":j("home");break;case"search":j("home");break;case"titleShop":j("home");break;case"titlesCollection":j("profile");break;case"achievements":j("achievements");break;case"followList":j("profile");break;case"myContentList":j("profile");break;case"userProfile":j("home");break;case"adminReports":j("home");break;case"notificationSettings":j("profile");break;case"postDetail":j("home");break}},[g,j]);const[Pn,es]=l.useState(null),[or,ts]=l.useState(null),[Wr,Xi]=l.useState(fl),[ns,wt]=l.useState("profile"),sr=Af(),_n=l.useMemo(()=>sr?.blockedUserIds||[],[sr]),rt=l.useMemo(()=>{const D=Array.isArray(_n)?_n:[];return Q.filter(U=>{if(U.hidden===!0)return!1;const X=U.authorUid||U.userId;return X?!D.includes(X):!0})},[Q,_n]);l.useEffect(()=>{if(rt.length===0){Xi(fl);return}Xi(D=>D.map(U=>{const X=U.id==="전체"?rt.length:0,be=rt.filter(ot=>ot.category===U.id),Fe=U.id==="전체"?X:be.length,ut=U.subCategories.map(ot=>{if(ot.id==="전체")return{...ot,count:Fe};const Le=be.filter(Ge=>Ge.subCategory===ot.id).length;return{...ot,count:Le}});return{...U,count:Fe,subCategories:ut}}))},[rt]),l.useEffect(()=>{if(!V)return;const D=Q.find(U=>U.id===V.id);D&&D!==V&&q(D)},[Q,V]);const ir=l.useCallback(()=>{Gt.current&&(clearTimeout(Gt.current),Gt.current=null)},[]),rs=l.useCallback(async D=>{const U=String(D);if(vt.current.has(U))return;const X=Q.find(Le=>Le.id===U);if(!X)return;const be=X.replies?.some(Le=>Le?.isAi===!0||typeof Le?.aiLabel=="string")===!0,Fe=X.replies?.some(Le=>Le?.isAi!==!0&&Le?.hidden!==!0)===!0;if(be||Fe)return;const ut=ml(X.createdAt);if(!(!ut||Date.now()-ut.getTime()<Ps)){vt.current.add(U),localStorage.setItem("aiAutoReplyTriggered",JSON.stringify(Array.from(vt.current)));try{if(!ge.currentUser){vt.current.delete(U);return}const Ge=fn(po,"aiAutoReply"),ea=`${X.title??""} 

 ${X.content??""}`;await Ge({prompt:ea,postId:U,postTitle:X.title??"",postContent:X.content??"",postCategory:X.category??"",postCreatedAt:ut.toISOString(),replyCount:X.replies?.length??0})}catch{vt.current.delete(U),localStorage.setItem("aiAutoReplyTriggered",JSON.stringify(Array.from(vt.current)))}}},[Q]);l.useEffect(()=>{if(ir(),!V||g.name!=="postDetail")return;const D=V.id,U=Q.find(Ge=>Ge.id===D)??V,X=U.replies?.some(Ge=>Ge?.isAi===!0||typeof Ge?.aiLabel=="string")===!0,be=U.replies?.some(Ge=>Ge?.isAi!==!0&&Ge?.hidden!==!0)===!0;if(X||be)return;const Fe=ml(U.createdAt);if(!Fe)return;const ut=Date.now(),ot=Fe.getTime()+Ps;if(ot<=ut){rs(String(D));return}const Le=Math.max(0,Math.min(ot-ut,Ps));return Gt.current=setTimeout(()=>{rs(String(D))},Le),()=>ir()},[ir,Q,g.name,V,rs]),l.useEffect(()=>()=>{ir()},[ir]);const{clampedTrust:ar,updateTrust:Vu,addLumensWithTrust:Zi}=Rh({addLumens:oe.addLumens}),He=fh({lumenBalance:oe.balance,spendLumens:oe.spendLumens}),{userActivity:qu,updateActivity:os}=eh(Zi,(D,U)=>{He.addSpecialTitle(D,U)}),Vr=sr?.role==="admin",Rt=Ah({posts:Q,userNickname:e}),Gu=l.useCallback(async D=>{const U=ge.currentUser?.uid;if(U)try{await st(je(he,"users",U),{profileDescription:D})}catch{}},[]),bt=oh({posts:Q,setPosts:me,selectedPost:V,setSelectedPost:q,userNickname:e,userActivity:qu,updateActivity:os,userPostLanterns:Rt.userPostLanterns,setUserPostLanterns:Rt.setUserPostLanterns??(()=>{}),userReplyLanterns:Rt.userReplyLanterns,setUserReplyLanterns:Rt.setUserReplyLanterns??(()=>{}),addLumensWithTrust:Zi,updateTrust:Vu}),lt=sh({userNickname:e}),ct=dh({userNickname:e}),qr=l.useMemo(()=>(g.name==="userProfile"?g.nickname:null)??v.showUserProfile,[g,v.showUserProfile]),lr=l.useMemo(()=>{if(!qr)return null;const D=Q.find(U=>U.author===qr&&(typeof U.authorUid=="string"||typeof U.uid=="string"));return D?D.authorUid??D.uid??null:null},[qr,Q]),Yu=l.useMemo(()=>lr?[lr]:[],[lr]),Xu=Io(Yu),Sn=lr?Xu[lr]??null:null,cr=Nh({viewedNickname:qr,currentUserNickname:e}),ss=ah({posts:Q,setPosts:me,selectedPost:V,setSelectedPost:q,userNickname:e}),Yt=gh({posts:Q,setPosts:me,selectedPost:V,setSelectedPost:q,userNickname:e,clampedTrust:ar,updateActivity:os,userProfileImage:t,isGuest:w}),Zu=l.useCallback(D=>{q(D)},[]),is=l.useCallback(D=>D?Po(D):"",[]),as=l.useCallback(D=>D?D.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",[]),Lt=Th({posts:Q,onPostSelect:Zu}),At=jh({posts:Q,setPosts:me,userNickname:e,userProfileImage:t,clampedTrust:ar,updateActivity:os}),ur=l.useCallback((D,U)=>{_(D.id,U),ie(U),q(D),At.incrementViews(D.id)},[At,_]),We=l.useCallback(()=>{q(null),L()},[L]),Ve=l.useCallback(()=>{q(null),O()},[O]),qe=l.useCallback(()=>{q(null),I()},[I]),Ke=l.useCallback(()=>{q(null),P()},[P]),Ku=l.useCallback(()=>{q(null),M()},[M]),{isOnline:ls,wasOffline:Qu}=xd(),Ju=l.useCallback(D=>Lt.setShowNotifications(D),[Lt]),ed=l.useCallback(()=>{Lt.setShowNotifications(!1),h({name:"notificationSettings"})},[h,Lt]),td=l.useCallback(()=>{h({name:"category"})},[h]),nd=l.useCallback(()=>{h({name:"quiz"})},[h]),rd=l.useCallback(()=>{h({name:"titleShop"})},[h]),od=l.useCallback(()=>{Vr&&h({name:"adminReports"})},[Vr,h]),Ki=l.useCallback(async()=>{K(!0);try{ne&&(await ne(),H.success("최신 목록을 불러왔어요"))}catch{H.error("목록을 불러오지 못했습니다")}finally{K(!1)}},[ne]);l.useEffect(()=>{y&&(h({name:"myPage"}),S?.())},[y,S,h]);const cs=l.useRef({route:g,showWriteScreen:F,selectedPost:V,showTitlesCollection:Br,showTitleShop:Ur,showAchievements:Fr,showMyPage:Dr,showSearchScreen:zr,showCategoryScreen:Or,showNotificationSettings:nr,showMyContentList:rr,showFollowList:Cn,showUserProfile:Hr,userProfileSection:ns,lastUserProfileNickname:A,currentScreen:k,postDetailSource:ue}),ve=l.useCallback((D,U)=>{U?R(D):N(D)},[R,N]);l.useEffect(()=>{cs.current={route:g,showWriteScreen:F,selectedPost:V,showTitlesCollection:Br,showTitleShop:Ur,showAchievements:Fr,showMyPage:Dr,showSearchScreen:zr,showCategoryScreen:Or,showNotificationSettings:nr,showMyContentList:rr,showFollowList:Cn,showUserProfile:Hr,userProfileSection:ns,lastUserProfileNickname:A,currentScreen:k,postDetailSource:ue}}),l.useEffect(()=>ve("write",F),[F,ve]),l.useEffect(()=>ve("questionCompose",g.name==="questionCompose"),[g.name,ve]),l.useEffect(()=>ve("postDetail",!!V),[V,ve]),l.useEffect(()=>ve("titlesCollection",Br),[Br,ve]),l.useEffect(()=>ve("titleShop",Ur),[Ur,ve]),l.useEffect(()=>ve("achievements",Fr),[Fr,ve]),l.useEffect(()=>ve("theme",Yi),[Yi,ve]),l.useEffect(()=>ve("userProfile",!!Hr),[Hr,ve]),l.useEffect(()=>ve("myContentList",!!rr),[rr,ve]),l.useEffect(()=>ve("followList",!!Cn),[Cn,ve]),l.useEffect(()=>ve("myPage",Dr),[Dr,ve]),l.useEffect(()=>ve("category",Or),[Or,ve]),l.useEffect(()=>ve("notificationSettings",nr),[nr,ve]),l.useEffect(()=>ve("ranking",v.showRanking),[v.showRanking,ve]),l.useEffect(()=>ve("bookmarks",v.showBookmarks),[v.showBookmarks,ve]),l.useEffect(()=>ve("search",zr),[zr,ve]),l.useEffect(()=>ve("quiz",g.name==="quiz"),[g.name,ve]),l.useEffect(()=>ve("notes",g.name==="notes"),[g.name,ve]),l.useEffect(()=>ve("noteDetail",g.name==="noteDetail"),[g.name,ve]);const Gr=l.useCallback(D=>{const U=D??cs.current;if(U.selectedPost){if(U.postDetailSource==="notes"){const X=sn.current;q(null),X?(h({name:"noteDetail",noteId:X}),j("home")):(h({name:"notes"}),j("home")),sn.current=null,ie("home");return}if(U.postDetailSource==="myPostsList")q(null),h({name:"myContentList",mode:"posts"}),j("profile");else if(U.postDetailSource==="myRepliesList")q(null),h({name:"myContentList",mode:"replies"}),j("profile");else if(U.postDetailSource==="followList"){q(null);const X=U.showFollowList||"followers";h({name:"followList",mode:X}),j("profile")}else if(U.postDetailSource==="myPage")q(null),h({name:"myPage"}),j("profile");else if(U.postDetailSource==="userProfilePosts"){q(null);const X=U.lastUserProfileNickname??U.showUserProfile;X?(wt("posts"),h({name:"userProfile",nickname:X})):(wt("profile"),h({name:"home"})),j("home")}else if(U.postDetailSource==="userProfileReplies"){q(null);const X=U.lastUserProfileNickname??U.showUserProfile;X?(wt("replies"),h({name:"userProfile",nickname:X})):(wt("profile"),h({name:"home"})),j("home")}else U.postDetailSource==="category"?(q(null),h({name:"category"}),j("home")):U.postDetailSource==="search"?(q(null),h({name:"search"}),j("home")):(q(null),h({name:"home"}));ie("home")}},[j,ie,h,q,wt]),Yr=l.useCallback(()=>{const D=E();if(!D)return g.name==="theme"?(h({name:"myPage"}),!0):g.name==="myPage"?(h({name:"home"}),j("home"),!0):!1;switch(D){case"write":Z(!1),h({name:"home"}),j("home");break;case"noteDetail":h({name:"notes"}),j("home");break;case"notes":h({name:"home"}),j("home");break;case"questionCompose":h({name:"home"}),j("home");break;case"postDetail":Gr();break;case"titlesCollection":h({name:"myPage"});break;case"titleShop":h({name:"home"});break;case"achievements":h({name:"myPage"});break;case"userProfile":if(de?.source==="followList"){const U=de.mode==="followers"||de.mode==="following"?de.mode:"followers";h({name:"followList",mode:U}),j("profile")}else if(de?.source==="myPage")h({name:"myPage"}),j("profile");else if(de?.source==="myContentList"){const U=de.mode==="posts"||de.mode==="replies"?de.mode:"posts";h({name:"myContentList",mode:U}),j("profile")}else de?.source==="userProfile"?(h({name:"home"}),j("home")):(h({name:"home"}),j("home"));Se(null);break;case"myContentList":h({name:"myPage"}),j("profile");break;case"followList":h({name:"myPage"}),j("profile");break;case"myPage":h({name:"home"}),j("home");break;case"category":h({name:"home"}),j("home");break;case"notificationSettings":h({name:"myPage"}),j("profile");break;case"ranking":L();break;case"bookmarks":h({name:"home"}),j("home");break;case"quiz":h({name:"home"}),j("home");break;case"search":h({name:"home"}),j("home");break;case"theme":h({name:"myPage"}),j("home");break}return!0},[Gr,L,E,g.name,j,h,Z,Se,de]),$e=l.useCallback(()=>{Yr()},[Yr]);l.useEffect(()=>{Cn==="followers"&&ct.fetchFollowerUsers()},[Cn,ct]),l.useEffect(()=>{let D=null;return(async()=>{if(ta?.addListener)try{D=await ta.addListener("backButton",()=>{const X=cs.current;if(!Yr()){if(X.route.name==="adminReports"){h({name:"home"}),j("home");return}if(X.currentScreen==="home"&&!X.selectedPost){a?.();return}h({name:"home"}),j("home")}})}catch{}})(),()=>{D?.remove()}},[Yr,a,j,h]);const us=l.useCallback(()=>{At.handleStartWriting(()=>{Z(!0),h({name:"home"})})},[At,h,Z]),sd=l.useCallback(async D=>{const U=await At.createPost(D);U&&(Z(!1),q(U),h({name:"postDetail",postId:U.id,source:"home"}))},[At,h,q,Z]),id=l.useCallback(async D=>{const U=ge.currentUser?.uid;if(!U){H.error("로그인 후 사용할 수 있어요.");return}try{const X=`post:${D?.id??""}`,be=Et(Oe(he,"notes"),Ht("uid","==",U),Ht("source","==",X),ri(1));if(!(await et(be)).empty){H.info("이미 노트로 저장된 글이에요.");return}await mr(Oe(he,"notes"),{uid:U,title:(D?.title??"").toString().trim(),body:(D?.content??"").toString(),source:X,createdAt:Zt(),updatedAt:Zt()}),H.success("노트에 저장했어요.")}catch{H.error("노트 저장에 실패했어요.")}},[]),Qi=l.useCallback(D=>{!D||D===bo||(wt("profile"),T(D),Se({source:"home"}),h({name:"userProfile",nickname:D}))},[T,h,wt]),ad=l.useCallback(D=>Yt.renderContentWithMentions(D??"",Qi),[Yt,Qi]),ds=l.useMemo(()=>{const D=Q.filter(be=>be.author===e),U=Q.flatMap(be=>(be.replies??[]).filter(Fe=>Fe.author===e).map(Fe=>({...Fe,postTitle:be.title,postAuthor:be.author,postId:be.id}))),X=Q.filter(be=>lt.isBookmarked(be.id)).filter(be=>be.hidden!==!0);return{userPostsForMyPage:D,userRepliesForMyPage:U,userBookmarkedPosts:X}},[Q,e,lt]),ld=l.useMemo(()=>{if(!tr)return{profileTarget:null,profilePosts:[],profileFirstAvatar:"",followerCountForProfile:0,followingCountForProfile:0,followerUsersForProfile:io,followingUsersForProfile:io};const D=tr,U=Q.filter(Ge=>Ge.author===D),X=U[0]?.authorAvatar??"",be=D===e,Fe=be?ct.followerCount:cr?.followerCount??0,ut=be?ct.followingCount:cr?.followingCount??0,ot=be?ct.followerUsers:cr?.followerUsers??io,Le=be?ct.followingUsers:cr?.followingUsers??io;return{profileTarget:D,profilePosts:U,profileFirstAvatar:X,followerCountForProfile:Fe,followingCountForProfile:ut,followerUsersForProfile:ot,followingUsersForProfile:Le}},[tr,Q,e,ct,cr]),Ji=l.useMemo(()=>{const D=rt.filter(X=>X.author===e),U=rt.flatMap(X=>(X.replies??[]).filter(be=>be.author===e).map(be=>({...be,authorAvatar:be.authorAvatar??void 0,postTitle:X.title,postAuthor:X.author,postId:X.id,postAuthorUid:typeof X.authorUid=="string"?X.authorUid:typeof X.uid=="string"?X.uid:null})));return{myPosts:D,myReplies:U}},[rt,e]),[Ln,dr]=l.useState(new Set(["home"])),Xr=l.useRef({});l.useEffect(()=>{dr(D=>{let U="";if(v.showMyPage?U="myPage":v.showRanking?U="ranking":v.showBookmarks?U="bookmarks":v.showTitleShop?U="titleShop":v.showTitlesCollection?U="titlesCollection":v.showAchievements?U="achievements":v.showTheme?U="theme":g.name==="quiz"?U="quiz":v.showFollowList?U="followList":v.showMyContentList?U="myContentList":v.showCategoryScreen?U="category":v.showSearchScreen?U="search":v.showUserProfile?U="userProfile":v.showNotificationSettings?U="notificationSettings":g.name==="adminReports"?U="adminReports":U="home",D.has(U))return D;const X=new Set(D);return X.add(U),X})},[v,g.name]),ao("myPage",Mr,dr,Xr),ao("ranking",qi,dr,Xr),ao("bookmarks",Gi,dr,Xr),ao("search",Qo,dr,Xr);const cd=g.name==="postDetail"&&!!V&&String(g.postId)===String(V.id);if(er)return s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsx(yy,{onBack:$e,onGoWrite:D=>{h({name:"home"}),j("home"),z({...D,postType:"question"}),Z(!0),R("write")},onNavigateToNotes:()=>{h({name:"notes"}),j("home")}})});if(Wu)return s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(gy,{onBack:$e,onOpenNote:D=>{h({name:"noteDetail",noteId:D}),j("home")}}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})});if(g.name==="noteDetail")return s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(xy,{noteId:g.noteId,onBack:()=>{h({name:"notes"}),j("home")},onGoWrite:D=>{z({...D,postType:"guide"}),h({name:"home"}),j("home"),Z(!0)},onOpenSourcePost:D=>{sn.current=g.noteId;const U=Q.find(X=>String(X.id)===String(D));if(!U){H.error("원문 게시글을 찾을 수 없어요.");return}ur(U,"notes")}}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})});if(an)return s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsx(py,{onBack:$e,onSubmit:sd,categories:Wr,lumenBalance:ae,spendLumens:oe.spendLumens,isGuest:w})});const ud=!(m!=="default")&&o;return s.jsxs("div",{className:`w-full h-full relative ${ud?"dark":""}`,children:[s.jsxs("div",{className:`w-full h-full bg-background text-foreground flex flex-col absolute inset-0 ${k==="home"&&!Wi&&!Qo&&!Vi&&!tr&&!g.name.includes("admin")?"z-10 opacity-100":"z-0 opacity-0 pointer-events-none hidden"}`,children:[s.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[(!ls||Qu)&&s.jsx("div",{className:`px-3 py-2 text-xs ${ls?"bg-emerald-500/80 text-white":"bg-red-500/80 text-white"}`,children:ls?"다시 연결되었습니다.":"오프라인 상태입니다. 작성/갱신이 제한될 수 있습니다."}),cd&&V?s.jsx(Jg,{post:V,userNickname:e,userProfileImage:t,currentTitle:He.currentTitle,isDarkMode:o,isPostLanterned:bt.isPostLanterned(V.id),isReplyLanterned:bt.isReplyLanterned,onLanternToggle:()=>bt.handleLanternToggle(V.id),onReplyLanternToggle:bt.handleReplyLanternToggle,isBookmarked:lt.isBookmarked(V.id),onBookmarkToggle:()=>lt.handleBookmarkToggle(V.id),isGuideReply:ss.isGuideReply,hasGuide:ss.hasGuide(V.id),onGuideSelect:ss.handleGuideSelect,newReplyContent:Yt.newReplyContent,onReplyContentChange:Yt.handleReplyContentChange,onReplySubmit:Yt.handleReplySubmit,replyInputRef:Yt.replyInputRef,onClose:()=>Gr(),onAuthorClick:()=>{wt("profile"),T(V.author),Se(ue==="followList"?{source:"followList"}:ue==="myPage"||ue==="myPostsList"||ue==="myRepliesList"?{source:"myPage"}:ue==="userProfilePosts"||ue==="userProfileReplies"?{source:"userProfile"}:{source:"home"}),h({name:"userProfile",nickname:V.author})},onMentionAuthor:()=>Yt.handleInsertMention(V.author),onMentionReplyAuthor:Yt.handleInsertMention,onReplyAuthorClick:D=>{wt("profile"),T(D),Se(ue==="followList"?{source:"followList"}:ue==="myPage"||ue==="myPostsList"||ue==="myRepliesList"?{source:"myPage"}:ue==="userProfilePosts"||ue==="userProfileReplies"?{source:"userProfile"}:{source:"home"}),h({name:"userProfile",nickname:D})},onReport:()=>es(V),onDelete:()=>{At.deletePost(V.id),Gr()},onSaveNote:()=>id(V),hideSaveNote:ue==="notes",onReportReply:D=>ts(D),renderContentWithMentions:ad,canSubmitReply:!!Yt.canSubmitReply,blockedUserIds:_n,onRefresh:Ki,isRefreshing:$,isGuest:w}):s.jsxs(s.Fragment,{children:[s.jsx(Yx,{isDarkMode:o,onToggleDarkMode:i,hasNotifications:Lt.notifications.some(D=>!D.isRead),showNotifications:Lt.showNotifications,onNotificationsToggle:Ju,notifications:Lt.notifications,onNotificationClick:Lt.handleNotificationClick,onMarkAllNotificationsRead:Lt.handleMarkAllNotificationsRead,onNotificationSettingsClick:ed,onNotificationDelete:Lt.removeNotification,activeCategory:rn,activeSubCategory:at,onCategoryClick:td,onQuizClick:nd,onTitleShopClick:rd,isAdmin:Vr,onOpenAdminReports:od,isGuest:w}),s.jsx(Hx,{posts:rt,userNickname:e,userProfileImage:t,activeCategory:rn,activeSubCategory:at,sortBy:bn,categories:Wr,onSubCategoryChange:yt,onSortChange:In,isPostLanterned:bt.isPostLanterned,userTrustScore:ar,isBookmarked:lt.isBookmarked,onPostClick:D=>ur(D,"home"),onLanternToggle:bt.handleLanternToggle,onBookmarkToggle:lt.handleBookmarkToggle,onStartWriting:us,currentTitle:He.currentTitle,blockedUserIds:_n,onRefresh:Ki,isRefreshing:$,isLoading:fe,isGuest:w,userUid:ge.currentUser?.uid||""})]})]}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]}),Ln.has("myPage")&&s.jsx("div",{className:`absolute inset-0 bg-background ${Mr?"z-20 block":"z-0 hidden"}`,children:s.jsx(l.Suspense,{fallback:s.jsx(Ny,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(iy,{userNickname:e,userProfileImage:t,onProfileImageChange:n,onBack:$e,onLogout:r,isDarkMode:o,onToggleDarkMode:i,onShowTerms:c,onShowPrivacy:u,onShowOpenSourceLicenses:d,currentTheme:typeof window<"u"&&localStorage.getItem("app-theme")||"default",onShowAttributions:f,userPosts:ds.userPostsForMyPage,userReplies:ds.userRepliesForMyPage,bookmarkedPosts:ds.userBookmarkedPosts,currentTitle:He.currentTitle,onManageBlockedUsers:()=>nn(!0),userGuideCount:Rt.userGuideCount,trustScore:ar,profileDescription:sr?.profileDescription??"",onProfileDescriptionChange:Gu,onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onWriteClick:us,onTitleShopClick:()=>{h({name:"titleShop"})},onAchievementsClick:Ku,onThemeClick:x,onTitlesCollectionClick:()=>{h({name:"titlesCollection"})},followerCount:ct.followerCount,followingCount:ct.followingCount,onFollowerCardClick:()=>{h({name:"followList",mode:"followers"})},onFollowingCardClick:()=>{h({name:"followList",mode:"following"})},onMyPostsCardClick:()=>{h({name:"myContentList",mode:"posts"})},onMyRepliesCardClick:()=>{h({name:"myContentList",mode:"replies"})},onPostClick:D=>{const U=Q.find(X=>X.id===D);U&&ur(U,"myPage")},onReplyClick:D=>{const U=Q.find(X=>X.id===D);U&&(ie("myRepliesList"),q(U),h({name:"postDetail",postId:U.id,source:"myRepliesList"}))},autoOpenSettings:b,onAutoSettingsOpened:C,isGuest:w}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})}),Ln.has("ranking")&&s.jsx("div",{className:`absolute inset-0 bg-background transition-all duration-200 ease-out ${qi?"z-20 opacity-100 translate-y-0":"z-0 opacity-0 translate-y-2 pointer-events-none"}`,children:s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(fy,{onBack:$e,weeklyGuideRanking:Rt.weeklyGuideRanking,totalGuideRanking:Rt.totalGuideRanking,weeklyLanternRanking:Rt.weeklyLanternRanking,currentTheme:m}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})}),Ln.has("bookmarks")&&s.jsx("div",{className:`absolute inset-0 bg-background transition-all duration-200 ease-out ${Gi?"z-20 opacity-100 translate-y-0":"z-0 opacity-0 translate-y-2 pointer-events-none"}`,children:s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(hy,{onBack:$e,bookmarkedPosts:lt.bookmarkedPosts,posts:rt,onPostSelect:D=>{const U=String(D?.id??""),X=rt.find(be=>String(be.id)===U);X&&(ie("category"),q(X),h({name:"postDetail",postId:String(X.id),source:"category"}))},userNickname:e,currentTitle:He.currentTitle,isGuest:w}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})}),Ln.has("quiz")&&s.jsx("div",{className:`absolute inset-0 bg-background transition-all duration-200 ease-out ${$u?"z-20 opacity-100 translate-y-0":"z-0 opacity-0 translate-y-2 pointer-events-none"}`,children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(Jx,{onBack:$e}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})}),Ln.has("category")&&s.jsx("div",{className:`absolute inset-0 bg-background transition-all duration-200 ease-out ${Wi?"z-30 opacity-100 translate-y-0":"z-0 opacity-0 translate-y-2 pointer-events-none"}`,children:s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsx(ay,{onBack:$e,categories:Wr,activeCategory:rn,activeSubCategory:at,onCategorySelect:(D,U)=>{on(D),yt(U||"전체")},posts:rt,onPostSelect:D=>{ur(D,"home"),h({name:"postDetail",postId:D.id,source:"home"})},userNickname:e,userProfileImage:t,currentTitle:He.currentTitle,isPostLanterned:bt.isPostLanterned,isBookmarked:lt.isBookmarked,onLanternToggle:bt.handleLanternToggle,onBookmarkToggle:lt.handleBookmarkToggle,formatTimeAgo:is,formatCreatedAt:as,isGuest:w})})}),Ln.has("search")&&s.jsx("div",{className:`absolute inset-0 bg-background transition-all duration-200 ease-out ${Qo?"z-30 opacity-100 translate-y-0":"z-0 opacity-0 translate-y-2 pointer-events-none"}`,children:s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsx(my,{onBack:$e,posts:rt,onPostSelect:D=>{ur(D,"search")},userNickname:e,userProfileImage:t,currentTitle:He.currentTitle,isPostLanterned:bt.isPostLanterned,isBookmarked:lt.isBookmarked,onLanternToggle:bt.handleLanternToggle,onBookmarkToggle:lt.handleBookmarkToggle,formatTimeAgo:is,formatCreatedAt:as,isGuest:w,userUid:ge.currentUser?.uid||""})})}),Vi&&s.jsx("div",{className:"absolute inset-0 z-30 bg-background",children:s.jsx(l.Suspense,{fallback:s.jsx(Ay,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:s.jsx(vy,{onBack:$e,userLumens:ae,userPostLanterns:Rt.userPostLanterns,userReplyLanterns:Rt.userReplyLanterns,userGuideCount:Rt.userGuideCount,ownedTitles:He.ownedTitles,currentTitle:He.currentTitle,onTitlePurchase:w?(D,U)=>(H.info("로그인 후 칭호를 구매할 수 있습니다."),Promise.resolve(!1)):He.handleTitlePurchase,onTitleEquip:w?D=>H.info("로그인 후 칭호를 장착할 수 있습니다."):He.handleTitleEquip})}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})}),tr&&s.jsx("div",{className:"absolute inset-0 z-30 bg-background",children:(()=>{const{profileTarget:D,profilePosts:U,profileFirstAvatar:X,followerCountForProfile:be,followingCountForProfile:Fe,followerUsersForProfile:ut,followingUsersForProfile:ot}=ld,Le=D===e,Ge=Sn?.nickname,dd=Sn?.isDeleted===!0||Ge==="탈퇴한 사용자"?"탈퇴한 사용자":Ge??D??"";return s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(ky,{onBack:$e,username:dd,userAvatar:Le?t:Sn?.profileImage??X??"",userBio:Le?sr?.profileDescription??"":Sn?.profileDescription??"",posts:U,trustScore:Le?ar:Sn?.trustScore??void 0,reportCount:0,achievementCount:0,titleCount:0,guideCount:0,currentTitle:Le?He.currentTitle:Sn?.currentTitleId??"",currentTheme:(()=>{if(Le)return typeof window<"u"&&localStorage.getItem("app-theme")||"default";const Mt=Sn?.currentTheme;return Mt&&Mt!=="default"?Mt:null})(),followerCount:be,followingCount:Fe,followerUsers:ut,followingUsers:ot,onPostClick:Mt=>{const kn=Q.find(fs=>fs.id===Mt);kn&&(ie("userProfilePosts"),T(D),q(kn),h({name:"postDetail",postId:kn.id,source:"userProfilePosts"}))},onReplyClick:Mt=>{const kn=Q.find(fs=>fs.id===Mt);kn&&(ie("userProfileReplies"),T(D),q(kn),h({name:"postDetail",postId:kn.id,source:"userProfileReplies"}))},isMyself:Le,isFollowing:ct.isFollowing(D??""),onToggleFollowUser:ct.handleToggleFollowUser,onFollowUserClick:Mt=>{wt("profile"),T(Mt),Se({source:"userProfile"}),h({name:"userProfile",nickname:Mt})},activeSection:ns,onChangeSection:wt}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})})()}),Bu&&s.jsx("div",{className:"absolute inset-0 z-30 bg-background",children:s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx("div",{className:"flex-1 overflow-y-auto",children:s.jsx(wy,{onBack:$e,userTitles:He.ownedTitles,equippedTitle:He.currentTitle,onTitleEquip:He.handleTitleEquip,onTitleUnequip:He.handleTitleUnequip,isGuest:w})}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})}),$r&&s.jsx("div",{className:"absolute inset-0 z-30 bg-background",children:s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(Sy,{mode:$r,users:$r==="followers"?ct.followerUsersDetailed:ct.followingUsersDetailed,onBack:$e,onUserClick:D=>{if(!D||D===bo)return;wt("profile"),T(D),Se({source:"followList",mode:$r}),h({name:"userProfile",nickname:D})},currentTheme:m,isGuest:w}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})}),Jo&&s.jsx("div",{className:"absolute inset-0 z-30 bg-background",children:s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(dy,{mode:Jo,onBack:$e,posts:Ji.myPosts,replies:Ji.myReplies,userNickname:e,userProfileImage:t,currentTitle:He.currentTitle,isPostLanterned:bt.isPostLanterned,isBookmarked:lt.isBookmarked,formatTimeAgo:is,formatCreatedAt:as,onLanternToggle:bt.handleLanternToggle,onBookmarkToggle:lt.handleBookmarkToggle,onPostClick:w?D=>{}:D=>{const U=rt.find(X=>X.id===D);if(U){const X=Jo==="posts"?"myPostsList":"myRepliesList";ie(X),q(U),h({name:"postDetail",postId:U.id,source:X})}},onReplyClick:w?(D,U)=>{}:(D,U)=>{const X=rt.find(be=>be.id===D);X&&(ie("myRepliesList"),q(X),h({name:"postDetail",postId:X.id,source:"myRepliesList"}))},isGuest:w}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})}),Fu&&s.jsx("div",{className:"absolute inset-0 z-30 bg-background transition-all duration-200 ease-out opacity-100 translate-y-0",children:s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(by,{onBack:$e,userNickname:e,isDarkMode:o}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})}),Hu&&s.jsx("div",{className:"absolute inset-0 z-30 bg-background transition-all duration-200 ease-out opacity-100 translate-y-0",children:s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(Cy,{onBack:$e,isDarkMode:o,onToggleDarkMode:i,lumenBalance:ae,onThemePurchase:async(D,U)=>{const X=await oe.spendLumens(U,`테마 구매: ${D}`,D);if(X){const be=ni(pl,"asia-northeast3"),Fe=fn(be,"purchaseTheme");try{await Fe({themeId:D,cost:U})}catch{return H.error("테마 구매 정보 저장에 실패했습니다."),!1}}return X}}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})}),g.name==="adminReports"&&Vr&&s.jsx("div",{className:"absolute inset-0 z-40 bg-background",children:s.jsx(l.Suspense,{fallback:s.jsx(Je,{}),children:s.jsxs("div",{className:"w-full h-full flex flex-col",children:[s.jsx(jy,{onBack:()=>{h({name:"home"}),j("home")}}),s.jsx(Qe,{onHomeClick:We,onRankingClick:Ve,onBookmarksClick:qe,onMyPageClick:Ke,onWriteClick:()=>{w?H.info("로그인 후 이용 가능합니다."):G(!0)},activeTab:k})]})})}),nr&&s.jsx("div",{className:"fixed inset-0 z-50 bg-background",children:s.jsx(l.Suspense,{fallback:null,children:s.jsx(Ty,{onBack:$e,categories:Wr})})}),Pn&&s.jsx(l.Suspense,{fallback:null,children:s.jsx(hl,{open:!!Pn,onOpenChange:D=>!D&&es(null),targetType:"게시글",onSubmit:async(D,U)=>{if(Pn)try{const X=ge.currentUser?.uid??null;await mr(Oe(he,"reports"),{targetType:"post",targetId:Pn.id,targetAuthorUid:Pn.authorUid??Pn.uid??null,reporterUid:X,reasons:D,details:U,createdAt:Zt(),status:"pending",autoHidden:!1,priority:"normal"}),H.success("신고가 접수되었어요. 검토 후 조치하겠습니다.")}catch{H.error("신고 처리 중 문제가 발생했어요. 잠시 후 다시 시도해주세요.")}finally{es(null)}}})}),or&&s.jsx(l.Suspense,{fallback:null,children:s.jsx(hl,{open:!!or,onOpenChange:D=>!D&&ts(null),targetType:"답글",onSubmit:async(D,U)=>{if(or)try{const X=ge.currentUser?.uid??null;await mr(Oe(he,"reports"),{targetType:"reply",targetId:String(or.id),targetAuthorUid:or.authorUid??null,reporterUid:X,reasons:D,details:U,createdAt:Zt(),status:"pending",autoHidden:!1,priority:"normal",postId:V?.id??null}),H.success("신고가 접수되었어요. 검토 후 조치하겠습니다.")}catch{H.error("신고 처리 중 문제가 발생했어요. 잠시 후 다시 시도해주세요.")}finally{ts(null)}}})}),s.jsx(Yf,{open:Te,onOpenChange:nn,blockedUserIds:_n,onUnblocked:()=>{}}),s.jsx(rh,{open:se,onClose:()=>G(!1),onSelectStructured:w?()=>H.info("로그인 후 이용 가능합니다."):()=>{G(!1),h({name:"questionCompose"})},onSelectWrite:w?()=>{}:()=>{G(!1),us()},onSelectNotes:w?()=>H.info("로그인 후 이용 가능합니다."):()=>{G(!1),h({name:"notes"}),j("home")}}),s.jsx(si,{open:At.showPostWarning,onOpenChange:At.setShowPostWarning,title:"작성 전 확인",description:"게시글 작성 30분 후 부터는 삭제 불가",confirmText:"확인",onConfirm:()=>{At.handleWarningConfirm(()=>{Z(!0)})},checkbox:At.checkboxConfig})]})}const Jy=Object.freeze(Object.defineProperty({__proto__:null,MainScreenRefactored:Ey},Symbol.toStringTag,{value:"Module"}));export{wc as $,ul as A,Id as B,Dd as C,mi as D,Nx as E,Pc as F,hf as G,sa as H,eh as I,Qf as J,Qy as K,Ii as L,ai as M,tf as N,hi as O,ki as P,Bo as Q,Hc as R,yo as S,Ms as T,xf as U,Ef as V,yc as W,Si as X,dx as Y,bf as Z,vc as _,zp as a,bo as a0,qx as a1,Jy as a2,tu as b,Go as c,_d as d,df as e,Gl as f,Ei as g,tg as h,Io as i,Vx as j,Dx as k,Ni as l,ii as m,Ys as n,Rn as o,hh as p,mh as q,cf as r,ze as s,Rl as t,Zl as u,Ax as v,Ai as w,Vo as x,Tl as y,qo as z};
