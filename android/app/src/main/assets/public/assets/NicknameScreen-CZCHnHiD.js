import{r,j as e,R as z,a as y,f as $}from"./index-Dk92xA2w.js";import{r as A,B as u}from"./App-Bs6YIlvy.js";import{C as I,b as L,a as P}from"./card-BTNeCppV.js";import{I as F}from"./input-CIhE7IwC.js";import{L as U}from"./label-S73REEuH.js";import{A as O,a as E,b as D}from"./avatar-BVorKTXF.js";import{J as R}from"./vendor-firebase-C8ERkm_B.js";import{S as G}from"./sparkles-BV-B8Lrs.js";import{c as W}from"./profanityFilter-CmEWjjlv.js";import{S as H,M as J}from"./sun-aJJImKwH.js";import{A as K}from"./arrow-left-BKP0x_yl.js";import{C as T}from"./check-CFbpOADo.js";import{C as Z}from"./circle-alert-x8MWc3Sp.js";import"./vendor-capacitor-rvH5hiNU.js";import"./vendor-react-1wgkHQEd.js";import"./index-SzzsopSI.js";function _({nickname:t,onCancel:l,onConfirm:i,isDarkMode:n=!1}){const[d,a]=r.useState(!1);return r.useEffect(()=>(a(!0),document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]),d?A.createPortal(e.jsx("div",{className:n?"dark":"",children:e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/60 backdrop-blur-sm flex items-center justify-center px-4 text-foreground",children:e.jsxs("div",{className:"w-[360px] max-w-full rounded-2xl border border-border/60 bg-card shadow-2xl shadow-black/20 p-6 space-y-5",children:[e.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center shrink-0 mb-1",children:e.jsx(G,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-lg font-semibold text-foreground",children:[e.jsxs("span",{className:"text-primary",children:['"',t,'"']}),"(ìœ¼)ë¡œ ì‹œì‘í• ê¹Œìš”?"]}),e.jsxs("p",{className:"text-sm text-muted-foreground leading-relaxed break-keep",children:["í•œ ë²ˆ ì„¤ì •í•œ ë‹‰ë„¤ì„ì€ ë³€ê²½í•  ìˆ˜ ì—†ì–´ìš”.",e.jsx("br",{}),"ì˜¤íƒ€ê°€ ì—†ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”."]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2",children:[e.jsx("button",{onClick:l,className:"flex-1 h-11 rounded-xl border border-input bg-background hover:bg-accent hover:text-accent-foreground text-foreground font-medium transition-colors text-sm",children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:i,className:"flex-1 h-11 rounded-xl bg-primary text-primary-foreground hover:bg-primary/90 font-medium shadow-lg shadow-primary/20 transition-colors text-sm",children:"í™•ì¸"})]})]})})}),document.body):null}const v=z.memo(({item:t})=>{const l=t.opacity<.2?"fadeInOut1":t.opacity<.25?"fadeInOut2":"fadeInOut3",i=r.useCallback(n=>{n&&(n.style.setProperty("--symbol-x",`${t.x}%`),n.style.setProperty("--symbol-y",`${t.y}%`),n.style.setProperty("--symbol-size",`${t.size}px`),n.style.setProperty("--symbol-animation",`${l} ${t.duration}s ease-in-out ${t.delay}s infinite both`))},[t.x,t.y,t.size,l,t.duration,t.delay]);return e.jsx("div",{className:"floating-symbol text-slate-600 dark:text-slate-400",ref:i,children:t.symbol})});v.displayName="FloatingSymbolItem";const j=["ğ“","ğ“‘","ğ“’","ğ““","ğ“”","ğ“•","ğ“–","ğ“—","ğ“˜","ğ“™","ğ“š","ğ“›","ğ“œ","ğ“","ğ“","ğ“Ÿ","ğ“ ","ğ“¡","ğ“¢","ğ“£","ğ“¤","ğ“¥","ğ“¦","ğ“§","ğ“¨","ğ“©","ğ“ª","ğ“«","ğ“¬","ğ“­","ğ“®","ğ“¯","ğ“°","ğ“±","ğ“²","ğ“³","ğ“´","ğ“µ","ğ“¶","ğ“·","ğ“¸","ğ“¹","ğ“º","ğ“»","ğ“¼","ğ“½","ğ“¾","ğ“¿","ğ”€","ğ”","ğ”‚","ğ”ƒ"];function me({onBack:t,onComplete:l,userEmail:i,isDarkMode:n,onToggleDarkMode:d}){const[a,p]=r.useState(""),[m,o]=r.useState(""),[N,h]=r.useState(!1),[x,g]=r.useState(!1),k=r.useMemo(()=>Array.from({length:30},(s,c)=>({id:c,symbol:j[Math.floor(Math.random()*j.length)],x:Math.random()*100,y:Math.random()*100,size:16+Math.random()*24,duration:5+Math.random()*5,delay:Math.random()*8,opacity:10+Math.random()*15})),[]),w=r.useCallback(s=>{p(s.target.value),o("")},[]),b=r.useCallback(()=>{const s=a.trim();if(!x){if(s.length<2||s.length>12){o("ë‹‰ë„¤ì„ì€ 2~12ê¸€ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}if(!/^[ê°€-í£a-zA-Z0-9]+$/.test(s)){o("í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.");return}if(W(s)){o("ë¶€ì ì ˆí•œ ë‹¨ì–´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.");return}h(!0)}},[a,x]),C=r.useCallback(()=>{h(!1)},[]),S=r.useCallback(async()=>{if(h(!1),x)return;g(!0);const s=y.currentUser;if(!s){t();return}try{await R($,"finalizeOnboarding")({nickname:a.trim()}),await s.reload(),await y.currentUser?.getIdToken(!0),l(a.trim())}catch(c){const f=String(c?.code??"").replace(/^functions\//,"");o(f==="already-exists"?"ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.":f==="invalid-argument"?"ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.":f==="unauthenticated"?"ë¡œê·¸ì¸ì´ í’€ë ¸ì–´ìš”. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.":"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")}finally{g(!1)}},[a,t,l]),M=r.useCallback(()=>{const s=["ì§€ì‹íƒêµ¬ì","ì‚¬ìƒ‰ê°€","ì§ˆë¬¸ëŸ¬","íƒí—˜ê°€","í•™ìŠµì","ì‚¬ìœ ì","ì—°êµ¬ì"],c=`${s[Math.floor(Math.random()*s.length)]}${Math.floor(Math.random()*9e3)+1e3}`;p(c),o("")},[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center p-6 overflow-hidden bg-background text-foreground transition-colors duration-300",children:[d&&e.jsx("div",{className:"absolute safe-top-button right-4 z-50",children:e.jsx(u,{variant:"ghost",size:"icon",onClick:d,className:"rounded-full hover:bg-accent transition-colors",children:n?e.jsx(H,{className:"w-5 h-5 text-yellow-500"}):e.jsx(J,{className:"w-5 h-5 text-slate-700 dark:text-slate-300"})})}),e.jsx("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none select-none",children:k.map(s=>e.jsx(v,{item:s},s.id))}),e.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none",children:e.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"nicknameComplexGrid",x:"0",y:"0",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"currentColor",strokeWidth:"1",className:"text-muted-foreground/20"})}),e.jsx("pattern",{id:"nicknameDiagonalLines",x:"0",y:"0",width:"60",height:"60",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 0 60 L 60 0",stroke:"currentColor",strokeWidth:"1",className:"text-muted-foreground/10"})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#nicknameComplexGrid)"}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#nicknameDiagonalLines)"})]})}),e.jsx("div",{className:"relative z-10 w-full max-w-sm animate-in fade-in zoom-in duration-500",children:e.jsxs(I,{className:"w-full border-border/60 shadow-2xl bg-background",children:[e.jsx(L,{className:"pb-4",children:e.jsxs("div",{className:"w-full relative",children:[e.jsx(u,{variant:"ghost",size:"icon",className:"absolute left-0 top-0 rounded-full text-muted-foreground hover:text-foreground hover:bg-accent -ml-2",onClick:t,children:e.jsx(K,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4 pt-2",children:[e.jsxs(O,{className:"w-24 h-24 border-4 border-background shadow-xl relative ring-2 ring-primary/20",children:[e.jsx(E,{src:`https://api.dicebear.com/7.x/notionists/svg?seed=${a||"user"}&backgroundColor=transparent`}),e.jsx(D,{className:"text-3xl bg-gradient-to-br from-primary via-primary/80 to-primary/60 text-primary-foreground font-bold",children:a?a.charAt(0).toUpperCase():"?"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent dark:from-white dark:to-gray-400",children:"ë‹‰ë„¤ì„ ì„¤ì •"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ì—ê²Œ ë³´ì—¬ì§ˆ ì´ë¦„ì…ë‹ˆë‹¤",i&&e.jsxs("span",{className:"block mt-1 text-xs opacity-70 font-mono",children:["(",i,")"]})]})]})]})]})}),e.jsxs(P,{className:"pt-2 pb-6 px-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"nickname",className:"text-sm font-medium leading-snug",children:"ë‹‰ë„¤ì„"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{id:"nickname",value:a,onChange:w,placeholder:"ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”",className:`${m?"border-destructive focus-visible:ring-destructive":""}`,maxLength:12,onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),setTimeout(()=>b(),10))}}),!m&&a.length>=2&&e.jsx(T,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-green-500"})]}),e.jsx("div",{className:"h-4 text-xs",children:m?e.jsxs("span",{className:"text-destructive flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"})," ",m]}):e.jsx("span",{className:"text-muted-foreground",children:"2~12ì í•œê¸€, ì˜ë¬¸, ìˆ«ì"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{onClick:b,className:"w-full h-12 text-base font-medium transition-all hover:scale-[1.02] active:scale-[0.98]",children:x?"ì €ì¥ ì¤‘...":"ê³„ì†í•˜ê¸°"}),e.jsx(u,{variant:"ghost",className:"w-full text-muted-foreground hover:text-foreground hover:bg-accent",onClick:M,children:"ëœë¤ ë‹‰ë„¤ì„ ìƒì„±"})]})]})]})})]}),N&&e.jsx(_,{nickname:a,onCancel:C,onConfirm:S})]})}export{me as NicknameScreen};
