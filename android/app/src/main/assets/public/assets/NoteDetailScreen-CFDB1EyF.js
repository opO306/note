import{R as i,d as v,j as e,a as z}from"./index-Dk92xA2w.js";import{A as y,Q as F,T as L,K as R,U}from"./vendor-firebase-C8ERkm_B.js";import{B as o}from"./App-Bs6YIlvy.js";import{C as h,a as x}from"./card-BTNeCppV.js";import{w as W,x as M,y as q,z as K}from"./MainScreenRefactored-Cnk3o5eP.js";import{A as Q}from"./arrow-left-BKP0x_yl.js";import{S as G,T as H}from"./trash-2-BoPuaL8J.js";import{F as E}from"./file-text-cmC5qgPs.js";import"./vendor-capacitor-rvH5hiNU.js";import"./vendor-react-1wgkHQEd.js";import"./toastHelper-CmqwgrpB.js";import"./index-DKlU3y7i.js";import"./index-SzzsopSI.js";import"./checkbox-BNqRj2KP.js";import"./check-CFbpOADo.js";import"./avatar-BVorKTXF.js";import"./alert-dialog-simple-CJo3HBbI.js";import"./sparkles-BV-B8Lrs.js";import"./firebaseCache-C_csZa1c.js";import"./profanityFilter-CmEWjjlv.js";import"./users-D58BOHBF.js";import"./sun-aJJImKwH.js";function xe({noteId:c,onBack:w,onGoWrite:T,onOpenSourcePost:P}){const[s,A]=i.useState(null),[p,f]=i.useState(!0),[b,l]=i.useState(null),[d,j]=i.useState(!1),[C,m]=i.useState(""),[k,u]=i.useState("");i.useEffect(()=>{const t=y(v,"notes",c),a=F(t,r=>{if(!r.exists()){l("노트를 찾을 수 없어요."),f(!1);return}const n=r.data();A(n),m(n.title??""),u(n.body??""),f(!1),l(null)},()=>{l("노트를 불러오지 못했어요."),f(!1)});return()=>a()},[c]);const B=async()=>{const t=z.currentUser?.uid;if(t){if(!s||s.uid!==t){l("삭제 권한이 없어요.");return}await L(y(v,"notes",c)),w()}},S=i.useMemo(()=>{const t=s?.source;if(typeof t!="string"||!t.startsWith("post:"))return null;const a=t.slice(5).trim();return a.length>0?a:null},[s?.source]),D=async()=>{const t=z.currentUser?.uid;if(t){if(!s||s.uid!==t){l("수정 권한이 없어요.");return}try{await R(y(v,"notes",c),{title:C.trim(),body:k,updatedAt:U()}),j(!1)}catch{l("저장에 실패했어요.")}}},g=i.useMemo(()=>{if(!s?.body)return[];const t=s.body.split(`
`),a=[];let r=null;for(const n of t){const N=n.trim();N.startsWith("- ")||N.startsWith("### ")?(r&&a.push({...r,content:r.content.trim()}),r={title:N.replace(/^(?:- |### )/,"").trim(),content:""}):r&&(r.content?r.content+=`
`+n:r.content=n)}return r&&a.push({...r,content:r.content.trim()}),a},[s?.body]);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"bg-card/95 border-b border-border px-4 pb-4 flex-shrink-0 safe-top-with-padding",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:w,children:e.jsx(Q,{className:"w-5 h-5"})}),e.jsx("h2",{className:"font-medium",children:"노트 상세"})]}),!d&&e.jsxs(W,{children:[e.jsx(M,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"icon",className:"touch-target",children:e.jsx(q,{className:"w-4 h-4"})})}),e.jsx(K,{className:"w-48 p-2",align:"end",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs(o,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>{s&&(j(!0),m(s.title??""),u(s.body??""))},children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"수정하기"]}),S&&e.jsxs(o,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>P?.(S),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"원문 보기"]}),e.jsxs(o,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>{s&&T({title:s.title||"",body:s.body||""})},children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"글쓰기 이어서"]}),e.jsxs(o,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-500",onClick:B,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"삭제하기"]})]})})]}),d&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>{j(!1),m(s?.title??""),u(s?.body??"")},children:"취소"}),e.jsx(o,{variant:"default",size:"sm",onClick:D,children:"저장"})]})]})}),e.jsx("div",{className:"flex-1 scroll-container",children:e.jsxs("div",{className:"px-4 py-3 pb-4 space-y-4",children:[p&&e.jsx(h,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm",children:e.jsx(x,{className:"p-6",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"불러오는 중..."})})}),!p&&b&&e.jsx(h,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm",children:e.jsx(x,{className:"p-6",children:e.jsx("div",{className:"text-sm text-red-500",children:b})})}),!p&&!b&&s&&e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm",children:e.jsx(x,{className:"p-6",children:d?e.jsx("input",{value:C,onChange:t=>m(t.target.value),className:"w-full px-3 py-3 rounded-2xl bg-card border border-border outline-none focus:ring-2 focus:ring-primary/30",placeholder:"제목"}):e.jsx("h1",{className:"text-xl font-medium",children:s.title||"(제목 없음)"})})}),e.jsx(h,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm",children:e.jsx(x,{className:"p-6",children:d?e.jsx("textarea",{value:k,onChange:t=>u(t.target.value),rows:12,className:"w-full px-3 py-3 rounded-2xl bg-card border border-border outline-none focus:ring-2 focus:ring-primary/30 resize-none",placeholder:"내용"}):g.length>0?e.jsx("div",{className:"space-y-6",children:g.map((t,a)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-base font-semibold text-foreground",children:t.title}),e.jsx("div",{className:"text-base text-foreground/90 leading-7 break-words whitespace-pre-wrap",children:t.content||"-"}),a<g.length-1&&e.jsx("div",{className:"border-t border-border/60 pt-6 -mb-3"})]},a))}):e.jsx("div",{className:"text-base text-foreground/90 leading-7 break-words whitespace-pre-wrap",children:s.body||""})})})]})]})})]})}export{xe as default};
