import{R as s,d as b,j as e,b as N}from"./index-BJjkZhAE.js";import{Y as m,Z as D,_ as F,$ as R,a0 as T}from"./vendor-firebase-B8qz7irO.js";import"./vendor-capacitor-Bm7NWSxP.js";import"./vendor-react-1wgkHQEd.js";function L({noteId:o,onBack:g,onGoWrite:w,onOpenSourcePost:C}){const[t,S]=s.useState(null),[c,i]=s.useState(!0),[u,n]=s.useState(null),[f,x]=s.useState(!1),[h,a]=s.useState(""),[y,l]=s.useState("");s.useEffect(()=>{const r=m(b,"notes",o),d=D(r,v=>{if(!v.exists()){n("노트를 찾을 수 없어요."),i(!1);return}const p=v.data();S(p),a(p.title??""),l(p.body??""),i(!1),n(null)},()=>{n("노트를 불러오지 못했어요."),i(!1)});return()=>d()},[o]);const k=async()=>{const r=N.currentUser?.uid;if(r){if(!t||t.uid!==r){n("삭제 권한이 없어요.");return}await F(m(b,"notes",o)),g()}},j=s.useMemo(()=>{const r=t?.source;if(typeof r!="string"||!r.startsWith("post:"))return null;const d=r.slice(5).trim();return d.length>0?d:null},[t?.source]),E=async()=>{const r=N.currentUser?.uid;if(r){if(!t||t.uid!==r){n("수정 권한이 없어요.");return}try{await R(m(b,"notes",o),{title:h.trim(),body:y,updatedAt:T()}),x(!1)}catch{n("저장에 실패했어요.")}}};return e.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 border-b border-border safe-top",children:[e.jsx("button",{type:"button",onClick:g,className:"px-3 py-2 rounded-xl text-sm bg-accent/50 hover:bg-accent",children:"뒤로"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-base font-semibold leading-tight",children:"노트"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"저장된 내용"})]}),f?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),a(t?.title??""),l(t?.body??"")},className:"px-3 py-2 rounded-xl text-sm bg-accent/50 hover:bg-accent",children:"취소"}),e.jsx("button",{type:"button",onClick:E,className:"px-3 py-2 rounded-xl text-sm bg-primary text-primary-foreground hover:bg-primary/90",children:"저장"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>{t&&(x(!0),a(t.title??""),l(t.body??""))},className:"px-3 py-2 rounded-xl text-sm bg-accent/50 hover:bg-accent",children:"수정"}),e.jsx("button",{type:"button",onClick:k,className:"px-3 py-2 rounded-xl text-sm bg-destructive text-destructive-foreground hover:opacity-90",children:"삭제"}),j&&e.jsx("button",{type:"button",onClick:()=>C?.(j),className:"px-3 py-2 rounded-xl text-sm bg-accent/50 hover:bg-accent",children:"원문 보기"}),e.jsx("button",{type:"button",onClick:()=>{t&&w({title:t.title||"",body:t.body||""})},className:"px-3 py-2 rounded-xl text-sm bg-primary text-primary-foreground hover:bg-primary/90",children:"글쓰기 이어서"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:[c&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"불러오는 중..."}),!c&&u&&e.jsx("div",{className:"text-sm text-red-500",children:u}),!c&&!u&&t&&e.jsx("div",{className:"space-y-3",children:f?e.jsxs(e.Fragment,{children:[e.jsx("input",{value:h,onChange:r=>a(r.target.value),className:"w-full px-3 py-3 rounded-2xl bg-card border border-border outline-none focus:ring-2 focus:ring-primary/30",placeholder:"제목"}),e.jsx("textarea",{value:y,onChange:r=>l(r.target.value),rows:12,className:"w-full px-3 py-3 rounded-2xl bg-card border border-border outline-none focus:ring-2 focus:ring-primary/30 resize-none",placeholder:"내용"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-lg font-bold",children:t.title||"(제목 없음)"}),e.jsx("pre",{className:"whitespace-pre-wrap text-sm leading-6 bg-card/60 border border-border rounded-2xl p-4",children:t.body||""})]})})]})]})}export{L as default};
