import{r as o,R as v,j as e,d as q}from"./index-BbQUyxS2.js";import{k as $,i as Z,b as Q,S as E,Z as I,E as J,Y as K,O as X,g as ee}from"./MainScreenRefactored-BV6t3nIm.js";import{N as te,O as se,Q as ae,P as re,T as ne}from"./vendor-firebase-C-5pmDAC.js";import{C as S,a as M}from"./card-3DnD1VWg.js";import{c as G,g as N}from"./App-CSSMO0Oh.js";import{T as ie,a as oe,b as W,c as C}from"./tabs-B80YWsht.js";import{A as le}from"./AppHeader-CEmD3kaq.js";import{T as ce}from"./trending-up-DJ9IiAMv.js";import{A as B}from"./award-C1AGijSZ.js";import"./vendor-capacitor-B-BXHHKA.js";import"./vendor-react-1wgkHQEd.js";import"./toastHelper-C2J_DWXH.js";import"./index-5LAPAtmD.js";import"./index-3nZT1wFB.js";import"./checkbox-CPLuEh_8.js";import"./check-C_WT1q55.js";import"./avatar-CLeAy6nm.js";import"./alert-dialog-simple-C_DV6hbj.js";import"./sparkles-Bmu-kJOd.js";import"./firebaseCache-C_csZa1c.js";import"./profanityFilter-CmEWjjlv.js";import"./arrow-left-2FIjscO0.js";import"./users-BnxKf8TP.js";import"./sun-ay515dC2.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],me=G("calendar",de);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],P=G("crown",ue);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],he=G("flame",xe),fe=s=>{const t=s.periodEnd;if(t&&typeof t.toDate=="function"){const a=t.toDate(),n=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0");return`${n}-${i}-${r}`}return typeof s.weekEnding=="string"?s.weekEnding:""},F=(s,t)=>{const a=Array.isArray(s)?s:[],n=a.slice(0,5).map(r=>({author:String(r?.nickname??""),count:typeof r?.count=="number"?r.count:0,authorUid:typeof r?.uid=="string"?r.uid:null})),i=a.map((r,l)=>({rank:typeof r?.rank=="number"?r.rank:l+1,author:String(r?.nickname??""),lumens:typeof r?.rewardLumen=="number"?r.rewardLumen:0,weekEnding:t}));return{items:n,rewards:i}};function ge(s,t=[],a=[]){const[n,i]=o.useState(t),[r,l]=o.useState(a),[m,c]=o.useState([]),[d,x]=o.useState([]),[g,k]=o.useState(!0);o.useEffect(()=>{let h=!0,y=!0;return(async()=>{y&&(k(!0),y=!1);try{const j=te(s,"weekly_stats"),f=se(j,ae("periodEnd","desc"),re(1)),w=await ne(f);if(!h)return;if(w.empty){i(t),l(a),c([]),x([]);return}const u=w.docs[0].data(),A=fe(u),{items:V,rewards:H}=F(u.guideRanking,A),{items:O,rewards:Y}=F(u.lanternRanking,A);i(V),l(O),c(H),x(Y)}catch{if(!h)return;i(t),l(a),c([]),x([])}finally{h&&k(!1)}})(),()=>{h=!1}},[s,t,a]);const{visible:R}=$(n,g),{visible:p}=$(r,g);return{weeklyGuideData:n,weeklyLanternData:r,lastWeekGuideRewards:m,lastWeekLanternRewards:d,visibleWeeklyGuide:R,visibleWeeklyLantern:p,isLoading:g}}const T=(s,t=5)=>Object.values(s??{}).map(a=>({author:a.author,count:a.count,authorUid:a.authorUid})).sort((a,n)=>n.count-a.count).slice(0,t),pe=s=>{const t=new Date(s),a=(7-s.getDay()+1)%7||7;return t.setDate(s.getDate()+a),t.setHours(8,0,0,0),s.getDay()===1&&s.getHours()<8&&t.setDate(s.getDate()),t.getTime()};function je(){const[s,t]=o.useState(()=>Date.now());return o.useEffect(()=>{const a=setInterval(()=>t(Date.now()),6e4);return()=>clearInterval(a)},[]),o.useMemo(()=>{const a=pe(new Date(s)),n=Math.max(0,a-s),i=Math.floor(n/(1e3*60*60*24)),r=Math.floor(n%(1e3*60*60*24)/(1e3*60*60));return{days:i,hours:r}},[s])}function we({db:s,weeklyGuideRanking:t,totalGuideRanking:a,weeklyLanternRanking:n}){const i=o.useMemo(()=>T(t),[t]),r=o.useMemo(()=>T(n),[n]),l=o.useMemo(()=>T(a),[a]),{weeklyGuideData:m,weeklyLanternData:c,visibleWeeklyGuide:d,visibleWeeklyLantern:x,lastWeekGuideRewards:g,lastWeekLanternRewards:k,isLoading:R}=ge(s,i,r),p=o.useMemo(()=>m.length>0?m:i,[m,i]),h=o.useMemo(()=>c.length>0?c:r,[c,r]),y=o.useMemo(()=>d.length>0?d:i,[d,i]),b=o.useMemo(()=>x.length>0?x:r,[x,r]),j=o.useMemo(()=>{const L=new Set;return p.length>0&&p.forEach(u=>{u.authorUid&&L.add(u.authorUid)}),h.length>0&&h.forEach(u=>{u.authorUid&&L.add(u.authorUid)}),l.length>0&&l.forEach(u=>{u.authorUid&&L.add(u.authorUid)}),Array.from(L)},[p,l,h]),f=Z(j),w=je();return{fallbackWeeklyGuide:i,fallbackWeeklyLantern:r,weeklyGuideForView:y,weeklyLanternForView:b,totalGuideData:l,lastWeekGuideRewards:g,lastWeekLanternRewards:k,userProfiles:f,isLoading:R,resetCountdown:w}}const D=v.memo(({icon:s,title:t,subtitle:a,badgeLabel:n})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[s,e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t}),a&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a})]})]}),e.jsx(N,{variant:"secondary",className:"text-xs",children:n})]})),_=v.memo(()=>e.jsx(S,{className:"bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/20",children:e.jsxs(M,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(P,{className:"w-4 h-4 text-amber-500"}),e.jsx("p",{className:"text-sm font-medium",children:"ì£¼ê°„ ë³´ìƒ"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("div",{children:"ðŸ¥‡ 1ìœ„: ë£¨ë©˜ 5ê°œ"}),e.jsx("div",{children:"ðŸ¥ˆ 2ìœ„: ë£¨ë©˜ 3ê°œ"}),e.jsx("div",{children:"ðŸ¥‰ 3ìœ„: ë£¨ë©˜ 1ê°œ"})]})]})})),z=v.memo(function({rewards:t}){if(t.length===0)return null;const a=t[0].weekEnding;return e.jsx(S,{children:e.jsxs(M,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(B,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("p",{className:"text-sm font-medium",children:["ì§€ë‚œ ì£¼ ë³´ìƒ (",a," ì£¼)"]})]}),e.jsx("div",{className:"space-y-2",children:t.map(n=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:[n.rank,"ìœ„"]}),e.jsx("span",{children:n.author})]}),e.jsxs("span",{className:"text-amber-500",children:["+",n.lumens," ë£¨ë©˜"]})]},n.author))})]})})}),Ye=v.memo(function({onBack:t,weeklyGuideRanking:a,totalGuideRanking:n,weeklyLanternRanking:i,currentTheme:r}){const[l,m]=o.useState("weekly"),c=Q({key:`ranking-${l}`}),[d,x]=o.useState(null),g=o.useCallback(w=>{c&&(c.current=w),x(w)},[c]),{weeklyGuideForView:k,weeklyLanternForView:R,totalGuideData:p,lastWeekGuideRewards:h,lastWeekLanternRewards:y,userProfiles:b,isLoading:j,resetCountdown:f}=we({db:q,weeklyGuideRanking:a,totalGuideRanking:n,weeklyLanternRanking:i});return e.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:[e.jsx(le,{title:"ëž­í‚¹",icon:e.jsx(ce,{className:"w-5 h-5 text-primary"}),onBack:t}),e.jsx("div",{ref:g,className:"flex-1 min-h-0 overflow-y-auto scroll-container",children:e.jsx("div",{className:"p-4 pb-24",children:e.jsxs(ie,{value:l,onValueChange:m,children:[e.jsxs(oe,{className:"grid w-full grid-cols-3 !h-8",children:[e.jsx(W,{value:"weekly",className:"text-xs",children:"ì£¼ê°„ ê¸¸ìž¡ì´"}),e.jsx(W,{value:"total",className:"text-xs",children:"ëˆ„ì  ê¸¸ìž¡ì´"}),e.jsx(W,{value:"lantern",className:"text-xs",children:"ì£¼ê°„ ë“±ë¶ˆ"})]}),l==="weekly"&&e.jsx(C,{value:"weekly",className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(D,{icon:e.jsx(me,{className:"w-4 h-4 text-muted-foreground"}),title:"ì´ë²ˆ ì£¼ ê¸¸ìž¡ì´ ì±„íƒ ëž­í‚¹",subtitle:`ì´ˆê¸°í™”: ${f.days}ì¼ ${f.hours}ì‹œê°„ í›„`,badgeLabel:"Weekly"}),e.jsx(_,{}),e.jsx(z,{rewards:h}),e.jsx(U,{data:k,type:"guide",loading:j,userProfiles:b,scrollContainer:d,currentTheme:r})]})}),l==="total"&&e.jsx(C,{value:"total",className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(D,{icon:e.jsx(E,{className:"w-4 h-4 text-muted-foreground"}),title:"ëˆ„ì  ê¸¸ìž¡ì´ ì±„íƒ ëž­í‚¹ (ì „ì²´)",badgeLabel:"Total"}),e.jsx(U,{data:p,type:"guide",loading:!1,userProfiles:b,scrollContainer:d,currentTheme:r})]})}),l==="lantern"&&e.jsx(C,{value:"lantern",className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(D,{icon:e.jsx(I,{className:"w-4 h-4 text-muted-foreground"}),title:"ì´ë²ˆ ì£¼ ë°›ì€ ë“±ë¶ˆ ëž­í‚¹",subtitle:`ì´ˆê¸°í™”: ${f.days}ì¼ ${f.hours}ì‹œê°„ í›„`,badgeLabel:"Weekly"}),e.jsx(_,{}),e.jsx(z,{rewards:y}),e.jsx(U,{data:R,type:"lantern",loading:j,userProfiles:b,scrollContainer:d,currentTheme:r})]})})]})})})]})},(s,t)=>s.weeklyGuideRanking===t.weeklyGuideRanking&&s.totalGuideRanking===t.totalGuideRanking&&s.weeklyLanternRanking===t.weeklyLanternRanking&&s.onBack===t.onBack&&s.currentTheme===t.currentTheme),ke=s=>{switch(s){case 0:return e.jsx(P,{className:"w-5 h-5 text-amber-500"});case 1:return e.jsx(B,{className:"w-5 h-5 text-gray-400"});case 2:return e.jsx(he,{className:"w-5 h-5 text-amber-700"});default:return e.jsx("div",{className:"w-5 h-5 flex items-center justify-center text-sm font-medium text-muted-foreground",children:s+1})}},ye=s=>{switch(s){case 0:return e.jsx(N,{className:"bg-gradient-to-r from-amber-500 to-yellow-600 text-white text-xs",children:"1ìœ„"});case 1:return e.jsx(N,{className:"bg-gradient-to-r from-gray-400 to-gray-500 text-white text-xs",children:"2ìœ„"});case 2:return e.jsx(N,{className:"bg-gradient-to-r from-amber-700 to-amber-800 text-white text-xs",children:"3ìœ„"});default:return e.jsxs(N,{variant:"outline",className:"text-xs",children:[s+1,"ìœ„"]})}},U=v.memo(function({data:t,type:a,loading:n,userProfiles:i,scrollContainer:r,currentTheme:l}){const m=o.useMemo(()=>!t||t.length===0?[]:t,[t]);return n&&t.length===0?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((c,d)=>e.jsx(S,{className:"border border-border/60 bg-card/60",children:e.jsx(M,{className:"p-4 animate-pulse space-y-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-muted/60"}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/50"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 w-1/3 bg-muted/50 rounded"}),e.jsx("div",{className:"h-3 w-1/4 bg-muted/40 rounded"})]}),e.jsx("div",{className:"w-12 h-6 rounded bg-muted/40"})]})})},d))}):m.length===0?e.jsx(J,{icon:a==="guide"?e.jsx(E,{className:"w-14 h-14 text-amber-900 dark:text-amber-200",strokeWidth:2.5}):e.jsx(I,{className:"w-14 h-14 text-yellow-900 dark:text-yellow-200",strokeWidth:2.5}),title:"ì•„ì§ ëž­í‚¹ì´ ì—†ì–´ìš”",description:a==="guide"?"ê¸¸ìž¡ì´ ì±„íƒì´ ì´ë£¨ì–´ì§€ë©´ ëž­í‚¹ì´ í‘œì‹œë©ë‹ˆë‹¤":"ë“±ë¶ˆì´ ë°í˜€ì§€ë©´ ëž­í‚¹ì´ í‘œì‹œë©ë‹ˆë‹¤",glowClassName:a==="guide"?"bg-amber-500/30 dark:bg-amber-400/30":"bg-yellow-500/30 dark:bg-yellow-400/30",circleClassName:a==="guide"?"bg-amber-100 dark:bg-amber-900/40 border-4 border-amber-400 dark:border-amber-600":"bg-yellow-100 dark:bg-yellow-900/40 border-4 border-yellow-400 dark:border-yellow-600"}):e.jsx(K,{customScrollParent:r||void 0,data:m,itemContent:(c,d)=>{const x=d.authorUid&&i[d.authorUid]?i[d.authorUid]:void 0;return e.jsx("div",{className:"pb-3 last:pb-0",children:e.jsx(be,{item:d,index:c,type:a,profile:x,currentTheme:l})})}})}),be=v.memo(function({item:t,index:a,type:n,profile:i,currentTheme:r}){const l=i?.currentTitleId??null,m=ee(l),c=i?.profileImage;return e.jsx(S,{className:`list-optimized ${a<3?"bg-gradient-to-r from-muted/50 to-muted/30":"bg-card"}`,children:e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:ke(a)}),e.jsx(X,{src:c||void 0,alt:t.author?`${t.author}ë‹˜ì˜ í”„ë¡œí•„`:"í”„ë¡œí•„ ì´ë¯¸ì§€",nickname:t.author,fallbackText:t.author?.charAt(0)?.toUpperCase()||"?",className:"w-10 h-10",size:40,loading:"lazy",decoding:"async"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.author}),ye(a)]}),m&&e.jsx(N,{variant:"secondary",className:"text-xs px-1.5 py-0.5 mt-1 w-fit",children:m}),e.jsx("div",{className:"flex items-center space-x-1 mt-1",children:n==="guide"?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-3 h-3 text-amber-500"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["ê¸¸ìž¡ì´ ",t.count,"íšŒ"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-3 h-3 text-amber-500"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["ë“±ë¶ˆ ",t.count,"ê°œ"]})]})})]})]})})})},(s,t)=>s.item===t.item&&s.profile===t.profile&&s.index===t.index&&s.type===t.type?!0:!(s.index!==t.index||s.type!==t.type||s.item.author!==t.item.author||s.item.count!==t.item.count||s.item.authorUid!==t.item.authorUid||s.profile?.currentTitleId!==t.profile?.currentTitleId||s.profile?.profileImage!==t.profile?.profileImage));export{Ye as RankingScreen};
