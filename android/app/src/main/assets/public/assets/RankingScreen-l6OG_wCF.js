import{r as c,R as b,j as e,d as Y}from"./index-BJjkZhAE.js";import{i as S,l as $,j as Q,u as X,V as E,k as y,C as W,b as C,al as Z,am as J,O as K,D as ee}from"./App-Cnx-z95_.js";import{S as se,Q as te,V as ae,W as re,X as ne}from"./vendor-firebase-B8qz7irO.js";import{T as le,a as ie,b as D,c as M}from"./tabs-C8huRtv9.js";import{A as oe}from"./AppHeader-DUFlu2QS.js";import{T as ce}from"./trending-up-CMkYmqDN.js";import{A as V}from"./award-CSx5UlBn.js";import"./vendor-capacitor-Bm7NWSxP.js";import"./vendor-react-1wgkHQEd.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ue=S("calendar",de);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],B=S("crown",me);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],he=S("flame",xe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],A=S("zap",fe),ge=t=>{const s=t.periodEnd;if(s&&typeof s.toDate=="function"){const a=s.toDate(),n=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0");return`${n}-${l}-${r}`}return typeof t.weekEnding=="string"?t.weekEnding:""},F=(t,s)=>{const a=Array.isArray(t)?t:[],n=a.slice(0,5).map(r=>({author:String(r?.nickname??""),count:typeof r?.count=="number"?r.count:0,authorUid:typeof r?.uid=="string"?r.uid:null})),l=a.map((r,o)=>({rank:typeof r?.rank=="number"?r.rank:o+1,author:String(r?.nickname??""),lumens:typeof r?.rewardLumen=="number"?r.rewardLumen:0,weekEnding:s}));return{items:n,rewards:l}};function je(t,s=[],a=[]){const[n,l]=c.useState(s),[r,o]=c.useState(a),[d,i]=c.useState([]),[h,f]=c.useState([]),[j,k]=c.useState(!0);c.useEffect(()=>{let m=!0,g=!0;return(async()=>{g&&(k(!0),g=!1);try{const x=se(t,"weekly_stats"),p=te(x,ae("periodEnd","desc"),re(1)),L=await ne(p);if(!m)return;if(L.empty){l(s),o(a),i([]),f([]);return}const u=L.docs[0].data(),G=ge(u),{items:H,rewards:P}=F(u.guideRanking,G),{items:q,rewards:O}=F(u.lanternRanking,G);l(H),o(q),i(P),f(O)}catch{if(!m)return;l(s),o(a),i([]),f([])}finally{m&&k(!1)}})(),()=>{m=!1}},[t,s,a]);const{visible:N}=$(n,j),{visible:w}=$(r,j);return{weeklyGuideData:n,weeklyLanternData:r,lastWeekGuideRewards:d,lastWeekLanternRewards:h,visibleWeeklyGuide:N,visibleWeeklyLantern:w,isLoading:j}}const T=(t,s=5)=>Object.values(t??{}).map(a=>({author:a.author,count:a.count,authorUid:a.authorUid})).sort((a,n)=>n.count-a.count).slice(0,s),we=t=>{const s=new Date(t),a=(7-t.getDay()+1)%7||7;return s.setDate(t.getDate()+a),s.setHours(8,0,0,0),t.getDay()===1&&t.getHours()<8&&s.setDate(t.getDate()),s.getTime()};function ke(){const[t,s]=c.useState(()=>Date.now());return c.useEffect(()=>{const a=setInterval(()=>s(Date.now()),6e4);return()=>clearInterval(a)},[]),c.useMemo(()=>{const a=we(new Date(t)),n=Math.max(0,a-t),l=Math.floor(n/(1e3*60*60*24)),r=Math.floor(n%(1e3*60*60*24)/(1e3*60*60));return{days:l,hours:r}},[t])}function pe({db:t,weeklyGuideRanking:s,totalGuideRanking:a,weeklyLanternRanking:n}){const l=c.useMemo(()=>T(s),[s]),r=c.useMemo(()=>T(n),[n]),o=c.useMemo(()=>T(a),[a]),{weeklyGuideData:d,weeklyLanternData:i,visibleWeeklyGuide:h,visibleWeeklyLantern:f,lastWeekGuideRewards:j,lastWeekLanternRewards:k,isLoading:N}=je(t,l,r),w=d.length>0?d:l,m=i.length>0?i:r,g=h.length>0?h:l,v=f.length>0?f:r,x=c.useMemo(()=>{const R=new Set;return w.length>0&&w.forEach(u=>{u.authorUid&&R.add(u.authorUid)}),m.length>0&&m.forEach(u=>{u.authorUid&&R.add(u.authorUid)}),o.length>0&&o.forEach(u=>{u.authorUid&&R.add(u.authorUid)}),Array.from(R)},[w,o,m]),p=Q(x),L=ke();return{fallbackWeeklyGuide:l,fallbackWeeklyLantern:r,weeklyGuideForView:g,weeklyLanternForView:v,totalGuideData:o,lastWeekGuideRewards:j,lastWeekLanternRewards:k,userProfiles:p,isLoading:N,resetCountdown:L}}const U=b.memo(({icon:t,title:s,subtitle:a,badgeLabel:n})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[t,e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s}),a&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a})]})]}),e.jsx(y,{variant:"secondary",className:"text-xs",children:n})]})),_=b.memo(()=>e.jsx(W,{className:"bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/20",children:e.jsxs(C,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(B,{className:"w-4 h-4 text-amber-500"}),e.jsx("p",{className:"text-sm font-medium",children:"ì£¼ê°„ ë³´ìƒ"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("div",{children:"ðŸ¥‡ 1ìœ„: ë£¨ë©˜ 5ê°œ"}),e.jsx("div",{children:"ðŸ¥ˆ 2ìœ„: ë£¨ë©˜ 3ê°œ"}),e.jsx("div",{children:"ðŸ¥‰ 3ìœ„: ë£¨ë©˜ 1ê°œ"})]})]})})),z=b.memo(function({rewards:s}){if(s.length===0)return null;const a=s[0].weekEnding;return e.jsx(W,{children:e.jsxs(C,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(V,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("p",{className:"text-sm font-medium",children:["ì§€ë‚œ ì£¼ ë³´ìƒ (",a," ì£¼)"]})]}),e.jsx("div",{className:"space-y-2",children:s.map(n=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:[n.rank,"ìœ„"]}),e.jsx("span",{children:n.author})]}),e.jsxs("span",{className:"text-amber-500",children:["+",n.lumens," ë£¨ë©˜"]})]},n.author))})]})})}),Ue=b.memo(function({onBack:s,weeklyGuideRanking:a,totalGuideRanking:n,weeklyLanternRanking:l}){const[r,o]=c.useState("weekly"),d=X({key:`ranking-${r}`}),[i,h]=c.useState(null),f=c.useCallback(p=>{d&&(d.current=p),h(p)},[d]),{weeklyGuideForView:j,weeklyLanternForView:k,totalGuideData:N,lastWeekGuideRewards:w,lastWeekLanternRewards:m,userProfiles:g,isLoading:v,resetCountdown:x}=pe({db:Y,weeklyGuideRanking:a,totalGuideRanking:n,weeklyLanternRanking:l});return e.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:[e.jsx(oe,{title:"ëž­í‚¹",icon:e.jsx(ce,{className:"w-5 h-5 text-primary"}),onBack:s}),e.jsx("div",{ref:f,className:"flex-1 min-h-0 overflow-y-auto scroll-container",children:e.jsx("div",{className:"p-4 pb-24",children:e.jsxs(le,{value:r,onValueChange:o,children:[e.jsxs(ie,{className:"grid w-full grid-cols-3 !h-8",children:[e.jsx(D,{value:"weekly",className:"text-xs",children:"ì£¼ê°„ ê¸¸ìž¡ì´"}),e.jsx(D,{value:"total",className:"text-xs",children:"ëˆ„ì  ê¸¸ìž¡ì´"}),e.jsx(D,{value:"lantern",className:"text-xs",children:"ì£¼ê°„ ë“±ë¶ˆ"})]}),r==="weekly"&&e.jsx(M,{value:"weekly",className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(U,{icon:e.jsx(ue,{className:"w-4 h-4 text-muted-foreground"}),title:"ì´ë²ˆ ì£¼ ê¸¸ìž¡ì´ ì±„íƒ ëž­í‚¹",subtitle:`ì´ˆê¸°í™”: ${x.days}ì¼ ${x.hours}ì‹œê°„ í›„`,badgeLabel:"Weekly"}),e.jsx(_,{}),e.jsx(z,{rewards:w}),e.jsx(I,{data:j,type:"guide",loading:v,userProfiles:g,scrollContainer:i})]})}),r==="total"&&e.jsx(M,{value:"total",className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(U,{icon:e.jsx(E,{className:"w-4 h-4 text-muted-foreground"}),title:"ëˆ„ì  ê¸¸ìž¡ì´ ì±„íƒ ëž­í‚¹ (ì „ì²´)",badgeLabel:"Total"}),e.jsx(I,{data:N,type:"guide",loading:!1,userProfiles:g,scrollContainer:i})]})}),r==="lantern"&&e.jsx(M,{value:"lantern",className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(U,{icon:e.jsx(A,{className:"w-4 h-4 text-muted-foreground"}),title:"ì´ë²ˆ ì£¼ ë°›ì€ ë“±ë¶ˆ ëž­í‚¹",subtitle:`ì´ˆê¸°í™”: ${x.days}ì¼ ${x.hours}ì‹œê°„ í›„`,badgeLabel:"Weekly"}),e.jsx(_,{}),e.jsx(z,{rewards:m}),e.jsx(I,{data:k,type:"lantern",loading:v,userProfiles:g,scrollContainer:i})]})})]})})})]})},(t,s)=>t.weeklyGuideRanking===s.weeklyGuideRanking&&t.totalGuideRanking===s.totalGuideRanking&&t.weeklyLanternRanking===s.weeklyLanternRanking&&t.onBack===s.onBack),ye=t=>{switch(t){case 0:return e.jsx(B,{className:"w-5 h-5 text-amber-500"});case 1:return e.jsx(V,{className:"w-5 h-5 text-gray-400"});case 2:return e.jsx(he,{className:"w-5 h-5 text-amber-700"});default:return e.jsx("div",{className:"w-5 h-5 flex items-center justify-center text-sm font-medium text-muted-foreground",children:t+1})}},be=t=>{switch(t){case 0:return e.jsx(y,{className:"bg-gradient-to-r from-amber-500 to-yellow-600 text-white text-xs",children:"1ìœ„"});case 1:return e.jsx(y,{className:"bg-gradient-to-r from-gray-400 to-gray-500 text-white text-xs",children:"2ìœ„"});case 2:return e.jsx(y,{className:"bg-gradient-to-r from-amber-700 to-amber-800 text-white text-xs",children:"3ìœ„"});default:return e.jsxs(y,{variant:"outline",className:"text-xs",children:[t+1,"ìœ„"]})}},I=b.memo(function({data:s,type:a,loading:n,userProfiles:l,scrollContainer:r}){const o=c.useMemo(()=>s,[s]);return n&&s.length===0?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((d,i)=>e.jsx(W,{className:"border border-border/60 bg-card/60",children:e.jsx(C,{className:"p-4 animate-pulse space-y-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-muted/60"}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/50"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 w-1/3 bg-muted/50 rounded"}),e.jsx("div",{className:"h-3 w-1/4 bg-muted/40 rounded"})]}),e.jsx("div",{className:"w-12 h-6 rounded bg-muted/40"})]})})},i))}):s.length===0?e.jsx(Z,{icon:a==="guide"?e.jsx(E,{className:"w-14 h-14 text-amber-900 dark:text-amber-200",strokeWidth:2.5}):e.jsx(A,{className:"w-14 h-14 text-yellow-900 dark:text-yellow-200",strokeWidth:2.5}),title:"ì•„ì§ ëž­í‚¹ì´ ì—†ì–´ìš”",description:a==="guide"?"ê¸¸ìž¡ì´ ì±„íƒì´ ì´ë£¨ì–´ì§€ë©´ ëž­í‚¹ì´ í‘œì‹œë©ë‹ˆë‹¤":"ë“±ë¶ˆì´ ë°í˜€ì§€ë©´ ëž­í‚¹ì´ í‘œì‹œë©ë‹ˆë‹¤",glowClassName:a==="guide"?"bg-amber-500/30 dark:bg-amber-400/30":"bg-yellow-500/30 dark:bg-yellow-400/30",circleClassName:a==="guide"?"bg-amber-100 dark:bg-amber-900/40 border-4 border-amber-400 dark:border-amber-600":"bg-yellow-100 dark:bg-yellow-900/40 border-4 border-yellow-400 dark:border-yellow-600"}):e.jsx(J,{customScrollParent:r||void 0,data:o,itemContent:(d,i)=>{const h=i.authorUid&&l[i.authorUid]?l[i.authorUid]:void 0;return e.jsx("div",{className:"pb-3 last:pb-0",children:e.jsx(Ne,{item:i,index:d,type:a,profile:h},i.author)})}})}),Ne=b.memo(function({item:s,index:a,type:n,profile:l}){const r=l?.currentTitleId??null,o=ee(r),d=l?.profileImage;return e.jsx(W,{className:`list-optimized ${a<3?"bg-gradient-to-r from-muted/50 to-muted/30":""}`,style:a>=3?{backgroundColor:"var(--card)"}:void 0,children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:ye(a)}),e.jsx(K,{src:d||void 0,alt:s.author?`${s.author}ë‹˜ì˜ í”„ë¡œí•„`:"í”„ë¡œí•„ ì´ë¯¸ì§€",nickname:s.author,fallbackText:s.author?.charAt(0)?.toUpperCase()||"?",className:"w-10 h-10",size:40,loading:"lazy",decoding:"async"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.author}),be(a)]}),o&&e.jsx(y,{variant:"secondary",className:"text-xs px-1.5 py-0.5 mt-1 w-fit",children:o}),e.jsx("div",{className:"flex items-center space-x-1 mt-1",children:n==="guide"?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-3 h-3 text-amber-500"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["ê¸¸ìž¡ì´ ",s.count,"íšŒ"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-3 h-3 text-amber-500"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["ë“±ë¶ˆ ",s.count,"ê°œ"]})]})})]})]})})})},(t,s)=>!(t.index!==s.index||t.type!==s.type||t.item.author!==s.item.author||t.item.count!==s.item.count||t.item.authorUid!==s.item.authorUid||t.profile?.currentTitleId!==s.profile?.currentTitleId||t.profile?.profileImage!==s.profile?.profileImage));export{Ue as RankingScreen};
