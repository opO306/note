import{R as te,r,b as O,d as W,j as e}from"./index-BJjkZhAE.js";import{u as ae,K as re}from"./keyboard-dismiss-button-CgE0Ackf.js";import{SlowConnectionWarning as le}from"./offline-indicator-C_WISlkw.js";import{i as ce,j as ne,B as j,f as ie,F as oe,I as de,P as ue}from"./App-Cnx-z95_.js";import{S as me}from"./switch-BKazc2QQ.js";import{Y as _,a2 as he,$ as B,a3 as fe,a1 as xe,a0 as ge,S as Se}from"./vendor-firebase-B8qz7irO.js";import{S as J}from"./search-CuXXKiqy.js";import{T as je}from"./trending-up-CMkYmqDN.js";import"./vendor-capacitor-Bm7NWSxP.js";import"./vendor-react-1wgkHQEd.js";import"./triangle-alert-DhDogudD.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],be=ce("clock",ve),pe=["AI","머신러닝","수학","물리학","프로그래밍","알고리즘","데이터사이언스","양자역학","적분","미술","음악","철학","건의사항","자유토론"],Ne=({searchResults:v,searchResultUserProfiles:b,userNickname:y,userProfileImage:w,isPostLanterned:k,isBookmarked:C,formatTimeAgo:A,formatCreatedAt:T,currentTitle:R,onPostSelect:I,onLanternToggle:L,onBookmarkToggle:U})=>e.jsx(ue,{posts:v,userNickname:y,userProfileImage:w,isPostLanterned:k,isBookmarked:C,currentTitle:R,userProfiles:b,formatTimeAgo:A,formatCreatedAt:T,onPostClick:I,onLanternToggle:L,onBookmarkToggle:U}),ye=te.memo(Ne);function De({onBack:v,posts:b,onPostSelect:y,userNickname:w,userProfileImage:k,currentTitle:C,isPostLanterned:A,isBookmarked:T,onLanternToggle:R,onBookmarkToggle:I,formatTimeAgo:L,formatCreatedAt:U}){const[m,p]=r.useState(""),[h,P]=r.useState([]),[d,f]=r.useState([]),[x,S]=r.useState(!0),[$,F]=r.useState(!1),[K,z]=r.useState(!1),G=ae({delay:350,offset:80}),N=m.trim().length>0,H=r.useMemo(()=>{const s=new Set;return h.forEach(t=>{typeof t.authorUid=="string"&&t.authorUid.length>0&&s.add(t.authorUid)}),Array.from(s)},[h]),M=ne(H);r.useEffect(()=>{if(typeof window>"u"){z(!0);return}let s=[],t=!0;try{const c=localStorage.getItem("recentSearches");if(c){const i=JSON.parse(c);Array.isArray(i)&&(s=i)}const o=localStorage.getItem("searchAutoSave");o!==null&&(t=o!=="false")}catch{}const n=O.currentUser?.uid;if(!n){f(s),S(t),z(!0);return}let a=!1;const l=_(W,"users",n);return(async()=>{try{const c=await he(l);let o=s,i=t;if(c.exists()){const E=c.data()?.searchSettings;E?(o=E.recentSearches||s,i=E.autoSave??t,localStorage.setItem("recentSearches",JSON.stringify(o)),localStorage.setItem("searchAutoSave",i.toString())):await B(l,{searchSettings:{autoSave:t,recentSearches:s}})}else await fe(l,{searchSettings:{autoSave:t,recentSearches:s}},{merge:!0});a||(f(o),S(i))}catch{a||(f(s),S(t))}finally{a||z(!0)}})(),()=>{a=!0}},[]);const u=r.useCallback(async(s,t)=>{try{localStorage.setItem("recentSearches",JSON.stringify(s)),localStorage.setItem("searchAutoSave",t.toString())}catch{}const n=O.currentUser?.uid;if(n)try{const a=_(W,"users",n);await B(a,{searchSettings:{autoSave:t,recentSearches:s}})}catch{}},[]),Q=r.useCallback(()=>{F(s=>!s)},[]),V=r.useCallback(s=>{p(s.target.value)},[]),g=r.useCallback(s=>{if(!s.trim()){P([]);return}const t=s.toLowerCase().trim(),n=b.filter(a=>[a.title,a.content,a.author,a.category,a.subCategory,...a.tags].some(c=>c.toLowerCase().includes(t))).sort((a,l)=>{const c=a.title.toLowerCase(),o=l.title.toLowerCase(),i=c.startsWith(t),D=o.startsWith(t);return i&&!D?-1:!i&&D?1:l.lanterns!==a.lanterns?l.lanterns-a.lanterns:l.createdAt.getTime()-a.createdAt.getTime()});P(n)},[b]),Y=r.useCallback(s=>{s.preventDefault();const t=m.trim();if(!t)return;if(g(t),x){const a=[t,...d.filter(l=>l!==t)].slice(0,10);f(a),u(a,x)}const n=O.currentUser?.uid;n&&xe(Se(W,"user_activity",n,"searchLogs"),{keyword:t,createdAt:ge()}).catch(a=>{})},[m,g,x,d,u]),q=r.useCallback(s=>{const t=s.currentTarget.dataset.value;t&&(p(t),g(t))},[g]),X=r.useCallback(s=>{const t=s.currentTarget.dataset.value;t&&(p(t),g(t))},[g]),Z=r.useCallback(()=>{p(""),P([]),v()},[v]),ee=r.useCallback(()=>{f([]),u([],x)},[x,u]),se=r.useCallback(s=>{if(!s&&d.length>0){if(confirm(`검색 기록 자동저장을 끄시겠습니까?
기존 검색 기록도 함께 삭제됩니다.`)){f([]),S(!1),u([],!1);return}return}S(s),u(d,s)},[d,u]);return K?e.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[e.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:Z,children:e.jsx(ie,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-medium",children:"검색"})]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:Q,children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:Y,className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(de,{ref:G,type:"text",placeholder:"글 제목, 내용, 작성자, 태그를 검색하세요...",value:m,onChange:V,className:"pl-10 h-10 input-keyboard-safe",autoFocus:!0})]}),$&&e.jsx("div",{className:"mt-3 p-3 bg-muted/30 rounded-lg border border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"검색 기록 자동저장"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"검색한 키워드를 자동으로 저장합니다"})]}),e.jsx(me,{checked:x,onCheckedChange:se})]})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[!N&&e.jsx("div",{className:"px-4 pt-4 pb-2 flex-shrink-0",children:e.jsx(le,{})}),N&&h.length>0&&e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-card/98 glass-effect border-b border-border px-4 py-3 flex-shrink-0 shadow-sm relative z-20",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["'",m,"' 검색 결과 ",h.length,"개"]})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-background",children:e.jsx(ye,{searchResults:h,searchResultUserProfiles:M,userNickname:w,userProfileImage:k,isPostLanterned:A,isBookmarked:T,formatTimeAgo:L,formatCreatedAt:U,currentTitle:C,onPostSelect:y,onLanternToggle:R,onBookmarkToggle:I})})]}),N&&h.length===0&&e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide p-4",children:e.jsxs("div",{className:"text-center py-16 px-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-500/30 dark:bg-slate-400/30 blur-2xl rounded-full"}),e.jsx("div",{className:"relative w-24 h-24 rounded-full bg-slate-100 dark:bg-slate-700/40 flex items-center justify-center border-4 border-slate-400 dark:border-slate-600 shadow-lg mx-auto",children:e.jsx(J,{className:"w-14 h-14 text-slate-900 dark:text-slate-200",strokeWidth:2.5})})]}),e.jsxs("p",{className:"text-muted-foreground font-medium mb-1",children:["'",m,"'에 대한 검색 결과가 없습니다."]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"다른 키워드로 검색해보세요."})]})}),!N&&e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide p-4 pb-24",children:e.jsxs("div",{className:"space-y-6",children:[d.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"font-medium flex items-center space-x-2",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:"최근 검색"})]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:ee,className:"text-muted-foreground hover:text-foreground",children:"전체 삭제"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map((s,t)=>e.jsx(j,{variant:"outline",size:"sm","data-value":s,onClick:q,className:"text-xs h-8",children:s},`${s}-${t}`))})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"font-medium mb-3 flex items-center space-x-2",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"인기 태그"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:pe.map(s=>e.jsxs(j,{variant:"secondary",size:"sm","data-value":s,onClick:X,className:"text-xs h-8",children:["#",s]},s))})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium mb-2 text-sm",children:"검색 팁"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• 키워드로 글 제목, 내용, 작성자를 검색할 수 있어요"}),e.jsx("li",{children:"• #태그명으로 특정 태그를 검색해보세요"}),e.jsx("li",{children:"• 카테고리명으로도 검색이 가능해요"})]})]})]})})]}),e.jsx(re,{})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"검색 설정을 불러오는 중..."})})}export{ye as SearchResultsList,De as SearchScreen};
