import{R as ae,r as a,a as _,d as B,j as e}from"./index-BbQUyxS2.js";import{u as le,K as ce}from"./keyboard-dismiss-button-ByNqYVE_.js";import{c as ne,B as j,S as ie}from"./App-CSSMO0Oh.js";import{I as oe}from"./input-BSsz_4de.js";import{S as de}from"./switch-BSamu2IM.js";import{i as me,e as ue,j as he}from"./MainScreenRefactored-BV6t3nIm.js";import{x as J,w as fe,M as K,K as xe,Z as ge,V as pe,N as Se}from"./vendor-firebase-C-5pmDAC.js";import{A as je}from"./arrow-left-2FIjscO0.js";import{S as M}from"./search-UcxyXlk4.js";import{T as ve}from"./trending-up-DJ9IiAMv.js";import"./vendor-capacitor-B-BXHHKA.js";import"./vendor-react-1wgkHQEd.js";import"./index-5LAPAtmD.js";import"./index-3nZT1wFB.js";import"./toastHelper-C2J_DWXH.js";import"./card-3DnD1VWg.js";import"./checkbox-CPLuEh_8.js";import"./check-C_WT1q55.js";import"./avatar-CLeAy6nm.js";import"./alert-dialog-simple-C_DV6hbj.js";import"./sparkles-Bmu-kJOd.js";import"./firebaseCache-C_csZa1c.js";import"./profanityFilter-CmEWjjlv.js";import"./users-BnxKf8TP.js";import"./sun-ay515dC2.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Ne=ne("clock",be),ye=["AI","머신러닝","수학","물리학","프로그래밍","알고리즘","데이터사이언스","양자역학","적분","미술","음악","철학","건의사항","자유토론"],we=({searchResults:v,searchResultUserProfiles:b,userNickname:w,userProfileImage:k,isPostLanterned:C,isBookmarked:A,formatTimeAgo:T,formatCreatedAt:R,currentTitle:I,onPostSelect:L,onLanternToggle:U,onBookmarkToggle:P,isGuest:i,userUid:z})=>e.jsx(he,{posts:v,userNickname:w,userProfileImage:k,isPostLanterned:C,isBookmarked:A,currentTitle:I,userProfiles:b,formatTimeAgo:T,formatCreatedAt:R,onPostClick:L,onLanternToggle:U,onBookmarkToggle:P,isGuest:i,userUid:z}),ke=ae.memo(we);function Xe({onBack:v,posts:b,onPostSelect:w,userNickname:k,userProfileImage:C,currentTitle:A,isPostLanterned:T,isBookmarked:R,onLanternToggle:I,onBookmarkToggle:L,formatTimeAgo:U,formatCreatedAt:P,isGuest:i,userUid:z}){const[h,N]=a.useState(""),[f,D]=a.useState([]),[m,x]=a.useState([]),[g,S]=a.useState(!0),[V,$]=a.useState(!1),[F,E]=a.useState(!1),H=le({delay:350,offset:80}),y=h.trim().length>0,Q=a.useMemo(()=>{const s=new Set;return f.forEach(t=>{typeof t.authorUid=="string"&&t.authorUid.length>0&&s.add(t.authorUid)}),Array.from(s)},[f]),Z=me(Q);a.useEffect(()=>{if(typeof window>"u"){E(!0);return}let s=[],t=!0;try{const c=localStorage.getItem("recentSearches");if(c){const o=JSON.parse(c);Array.isArray(o)&&(s=o)}const d=localStorage.getItem("searchAutoSave");d!==null&&(t=d!=="false")}catch{}const n=_.currentUser?.uid;if(!n){x(s),S(t),E(!0);return}let r=!1;const l=J(B,"users",n);return(async()=>{try{const c=await fe(l);let d=s,o=t;if(c.exists()){const W=c.data()?.searchSettings;W?(d=W.recentSearches||s,o=W.autoSave??t,localStorage.setItem("recentSearches",JSON.stringify(d)),localStorage.setItem("searchAutoSave",o.toString())):await K(l,{searchSettings:{autoSave:t,recentSearches:s}})}else await xe(l,{searchSettings:{autoSave:t,recentSearches:s}},{merge:!0});r||(x(d),S(o))}catch{r||(x(s),S(t))}finally{r||E(!0)}})(),()=>{r=!0}},[]);const u=a.useCallback(async(s,t)=>{try{localStorage.setItem("recentSearches",JSON.stringify(s)),localStorage.setItem("searchAutoSave",t.toString())}catch{}const n=_.currentUser?.uid;if(n)try{const r=J(B,"users",n);await K(r,{searchSettings:{autoSave:t,recentSearches:s}})}catch{}},[]),q=a.useCallback(()=>{$(s=>!s)},[]),X=a.useCallback(s=>{N(s.target.value)},[]),p=a.useCallback(s=>{if(!s.trim()){D([]);return}const t=s.toLowerCase().trim(),n=b.filter(r=>[r.title,r.content,r.author,r.category,r.subCategory,...r.tags].some(c=>c.toLowerCase().includes(t))).sort((r,l)=>{const c=r.title.toLowerCase(),d=l.title.toLowerCase(),o=c.startsWith(t),O=d.startsWith(t);return o&&!O?-1:!o&&O?1:l.lanterns!==r.lanterns?l.lanterns-r.lanterns:l.createdAt.getTime()-r.createdAt.getTime()});D(n)},[b]),Y=a.useCallback(s=>{s.preventDefault();const t=h.trim();if(!t)return;if(p(t),g&&!i){const r=[t,...m.filter(l=>l!==t)].slice(0,10);x(r),u(r,g)}const n=_.currentUser?.uid;n&&!i&&ge(Se(B,"user_activity",n,"searchLogs"),{keyword:t,createdAt:pe()}).catch(r=>{})},[h,p,g,m,u,i]),G=a.useCallback(s=>{const t=s.currentTarget.dataset.value;t&&(N(t),p(t))},[p]),ee=a.useCallback(s=>{const t=s.currentTarget.dataset.value;t&&(N(t),p(t))},[p]),se=a.useCallback(()=>{N(""),D([]),v()},[v]),te=a.useCallback(()=>{x([]),u([],g)},[g,u]),re=a.useCallback(s=>{if(!s&&m.length>0){if(confirm(`검색 기록 자동저장을 끄시겠습니까?
기존 검색 기록도 함께 삭제됩니다.`)){x([]),S(!1),u([],!1);return}return}S(s),u(m,s)},[m,u]);return F?e.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[e.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:se,children:e.jsx(je,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-medium",children:"검색"})]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:q,children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:Y,className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(oe,{ref:H,type:"text",placeholder:"글 제목, 내용, 작성자, 태그를 검색하세요...",value:h,onChange:X,className:"pl-10 h-10 input-keyboard-safe",autoFocus:!0})]}),V&&e.jsx("div",{className:"mt-3 p-3 bg-muted/30 rounded-lg border border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"검색 기록 자동저장"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"검색한 키워드를 자동으로 저장합니다"})]}),e.jsx(de,{checked:g,onCheckedChange:re,disabled:i})]})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[!y&&e.jsx("div",{className:"px-4 pt-4 pb-2 flex-shrink-0",children:e.jsx(ie,{})}),y&&f.length>0&&e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-card/98 glass-effect border-b border-border px-4 py-3 flex-shrink-0 shadow-sm relative z-20",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["'",h,"' 검색 결과 ",f.length,"개"]})}),e.jsx("div",{className:"flex-1 overflow-hidden bg-background",children:e.jsx(ke,{searchResults:f,searchResultUserProfiles:Z,userNickname:k,userProfileImage:C,isPostLanterned:T,isBookmarked:R,formatTimeAgo:U,formatCreatedAt:P,currentTitle:A,onPostSelect:w,onLanternToggle:I,onBookmarkToggle:L,isGuest:i,userUid:z||""})})]}),y&&f.length===0&&e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide p-4",children:e.jsxs("div",{className:"text-center py-16 px-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-500/30 dark:bg-slate-400/30 blur-2xl rounded-full"}),e.jsx("div",{className:"relative w-24 h-24 rounded-full bg-slate-100 dark:bg-slate-700/40 flex items-center justify-center border-4 border-slate-400 dark:border-slate-600 shadow-lg mx-auto",children:e.jsx(M,{className:"w-14 h-14 text-slate-900 dark:text-slate-200",strokeWidth:2.5})})]}),e.jsxs("p",{className:"text-muted-foreground font-medium mb-1",children:["'",h,"'에 대한 검색 결과가 없습니다."]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"다른 키워드로 검색해보세요."})]})}),!y&&e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide p-4 pb-24",children:e.jsxs("div",{className:"space-y-6",children:[m.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"font-medium flex items-center space-x-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{children:"최근 검색"})]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:i?()=>{}:te,className:"text-muted-foreground hover:text-foreground",disabled:i,children:"전체 삭제"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((s,t)=>e.jsx(j,{variant:"outline",size:"sm","data-value":s,onClick:G,className:"text-xs h-8",children:s},`${s}-${t}`))})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"font-medium mb-3 flex items-center space-x-2",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:"인기 태그"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ye.map(s=>e.jsxs(j,{variant:"secondary",size:"sm","data-value":s,onClick:ee,className:"text-xs h-8",children:["#",s]},s))})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium mb-2 text-sm",children:"검색 팁"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• 키워드로 글 제목, 내용, 작성자를 검색할 수 있어요"}),e.jsx("li",{children:"• #태그명으로 특정 태그를 검색해보세요"}),e.jsx("li",{children:"• 카테고리명으로도 검색이 가능해요"})]})]})]})})]}),e.jsx(ce,{})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"검색 설정을 불러오는 중..."})})}export{ke as SearchResultsList,Xe as SearchScreen};
