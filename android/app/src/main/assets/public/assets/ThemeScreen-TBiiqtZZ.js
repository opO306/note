const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./in-app-purchases.web-7UeTATBt.js","./vendor-capacitor-B-BXHHKA.js"])))=>i.map(i=>d[i]);
import{r as d,a as N,d as k,c as V,j as e}from"./index-BbQUyxS2.js";import{B as G,g as m}from"./App-CSSMO0Oh.js";import{C as g,b as E,c as _,a as j}from"./card-3DnD1VWg.js";import{S as J}from"./switch-BSamu2IM.js";import{L as K}from"./label-BfwQOg68.js";import{t as n}from"./toastHelper-C2J_DWXH.js";import{K as I,x as y,V as L,o as W,J as q,w as Q}from"./vendor-firebase-C-5pmDAC.js";import{r as X,_ as Y,C as R}from"./vendor-capacitor-B-BXHHKA.js";import{A as Z}from"./arrow-left-2FIjscO0.js";import{S as ee}from"./sparkles-Bmu-kJOd.js";import{P as D}from"./palette-Gzr0i4eM.js";import{M as se,S as re}from"./sun-ay515dC2.js";import{C as M}from"./check-C_WT1q55.js";import{L as te}from"./lock-TK1JQzmj.js";import"./vendor-react-1wgkHQEd.js";import"./index-5LAPAtmD.js";import"./index-3nZT1wFB.js";const $=X("InAppPurchases",{web:()=>Y(()=>import("./in-app-purchases.web-7UeTATBt.js"),__vite__mapDeps([0,1]),import.meta.url).then(l=>new l.InAppPurchasesWeb)}),u={"e-ink":"theme_e_ink",midnight:"theme_midnight","golden-library":"theme_golden_room","greek-temple":"theme_greek_temple",sketchbook:"theme_sketchbook"};function z(){return R.isNativePlatform()}async function ae(){if(!z())return!1;try{return(await $.initialize()).success}catch{return!1}}async function ie(l){if(!z())return n.error("Ïù∏Ïï± Íµ¨Îß§Îäî Î™®Î∞îÏùº Ïï±ÏóêÏÑúÎßå ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§."),{success:!1};try{const i=await $.purchase({productId:l});return i.transaction?.transactionId?{success:!0,transactionId:i.transaction.transactionId,receipt:i.transaction.receipt}:{success:!1}}catch(i){return i.message?.includes("cancel")||i.message?.includes("Cancel")?n.info("Íµ¨Îß§Í∞Ä Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§."):n.error("Íµ¨Îß§ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî."),{success:!1}}}const A=[{id:"e-ink",name:"Ï†ÑÏûê Ï¢ÖÏù¥",description:"ÎààÏù¥ Ìé∏ÏïàÌïú Ï†ÄÎåÄÎπÑ ÌÖåÎßàÎ°ú ÍπäÏù¥ ÏûàÎäî ÏÇ¨ÏÉâÏóê Î™∞ÏûÖÌïòÏÑ∏Ïöî.",price:"Î¨¥Î£å",preview:"üìú",productId:u["e-ink"]},{id:"midnight",name:"Ïã¨Ïïº ÎèÑÏÑúÍ¥Ä",description:"ÍπäÏùÄ ÏïîÏ≤≠ÏÉâÍ≥º Ìô©Í∏à Ìè¨Ïù∏Ìä∏Î°ú Í≥†ÌíçÏä§Îü¨Ïö¥ ÌïôÏà† Î∂ÑÏúÑÍ∏∞Î•º Ïó∞Ï∂úÌï©ÎãàÎã§.",price:"Î¨¥Î£å",preview:"üèõ",productId:u.midnight},{id:"golden-library",name:"Ìô©Í∏àÎπõ ÏÑúÏû¨",description:"Í≥†Í∏âÏä§Îü¨Ïö¥ Í∏àÏÉâÍ≥º Í∏∞ÌïòÌïôÏ†Å Î¨∏ÏñëÏúºÎ°ú ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌïôÏà† Î∂ÑÏúÑÍ∏∞Î•º ÏôÑÏÑ±Ìï©ÎãàÎã§.",price:"Î¨¥Î£å",preview:"‚ú®",productId:u["golden-library"]},{id:"greek-temple",name:"Í∑∏Î¶¨Ïä§ Ïã†Ï†Ñ",description:"Í≥†Ï†ÑÏ†ÅÏù∏ ÎåÄÎ¶¨ÏÑù ÏßàÍ∞êÍ≥º Ìô©Í∏à Ïû•ÏãùÏúºÎ°ú Í≥†ÎåÄ Í∑∏Î¶¨Ïä§Ïùò ÏõÖÏû•Ìï®ÏùÑ Îã¥ÏïòÏäµÎãàÎã§.",price:"Î¨¥Î£å",preview:"üèõÔ∏è",productId:u["greek-temple"]},{id:"sketchbook",name:"ÏÜêÍ∏ÄÏî® ÏÑúÏû¨",description:"ÌïÑÍ∏∞Ï≤¥ Ìè∞Ìä∏Î°ú ÏÜêÏúºÎ°ú ÏßÅÏ†ë Ïì¥ ÎìØÌïú Îî∞ÎúªÌïòÍ≥† ÏπúÍ∑ºÌïú ÌïôÎ¨∏Ïùò Í≥µÍ∞ÑÏûÖÎãàÎã§.",price:"Î¨¥Î£å",preview:"‚úçÔ∏è",productId:u.sketchbook}];function ye({onBack:l,isDarkMode:i,onToggleDarkMode:H,lumenBalance:U,onThemePurchase:ce}){const[p,v]=d.useState(()=>typeof window<"u"&&localStorage.getItem("app-theme")||"default"),[h,w]=d.useState([]),[x,B]=d.useState(!1),[f,P]=d.useState(!1);d.useEffect(()=>{(async()=>{const t=await ae();B(t);const c=N.currentUser?.uid;if(c)try{const a=y(k,"users",c),r=await Q(a);if(r.exists()){const o=r.data();w(o.purchasedThemes||[])}}catch{}})()},[]),d.useEffect(()=>{const s=localStorage.getItem("app-theme")||"default";v(s);const t=document.documentElement;t.setAttribute("data-theme",s),t.removeAttribute("data-skin"),s!=="default"&&t.classList.remove("dark")},[]);const C=d.useCallback(async s=>{if(s==="default"){v("default"),localStorage.setItem("app-theme","default");const r=document.documentElement;r.setAttribute("data-theme","default"),r.removeAttribute("data-skin");const o=localStorage.getItem("darkMode");(o!==null?o==="true":!0)?r.classList.add("dark"):r.classList.remove("dark");const b=N.currentUser?.uid;if(b)try{await I(y(k,"users",b),{currentTheme:"default",updatedAt:L()},{merge:!0})}catch{}window.dispatchEvent(new CustomEvent("theme-changed")),n.success("Í∏∞Î≥∏ ÌÖåÎßàÍ∞Ä Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§.");return}const t=A.find(r=>r.id===s);if(!t)return;if(t.price==="Î¨¥Î£å")h.includes(s)||w(r=>[...r,s]);else if(!h.includes(s))if(x&&t.productId){P(!0);try{const r=await ie(t.productId);if(r.success&&r.transactionId){const o=W(V,"asia-northeast3"),S=q(o,"verifyThemePurchase"),b=R.getPlatform()==="ios"?"ios":"android";await S({themeId:s,transactionId:r.transactionId,receipt:r.receipt||"",platform:b}),w(T=>[...T,s]),n.success(`${t.name} ÌÖåÎßàÎ•º Íµ¨Îß§ÌñàÏäµÎãàÎã§!`)}else return}catch(r){n.error(r.message||"ÌÖåÎßà Íµ¨Îß§Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.");return}finally{P(!1)}}else{n.error("ÌÖåÎßà Íµ¨Îß§Îäî Î™®Î∞îÏùº Ïï±ÏóêÏÑúÎßå Í∞ÄÎä•Ìï©ÎãàÎã§. Google Play Store ÎòêÎäî App StoreÏóêÏÑú Ïï±ÏùÑ Îã§Ïö¥Î°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.");return}v(s),localStorage.setItem("app-theme",s);const c=N.currentUser?.uid;if(c)try{await I(y(k,"users",c),{currentTheme:s,updatedAt:L()},{merge:!0})}catch{}const a=document.documentElement;if(a.setAttribute("data-theme",s),a.removeAttribute("data-skin"),s!=="default")a.classList.remove("dark");else{const r=localStorage.getItem("darkMode");(r!==null?r==="true":!0)?a.classList.add("dark"):a.classList.remove("dark")}a.offsetHeight,window.dispatchEvent(new CustomEvent("theme-changed")),f||n.success(`${t?.name||s} ÌÖåÎßàÍ∞Ä Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§.`)},[h,x,f]),F=s=>s==="default"||A.find(c=>c.id===s)?.price==="Î¨¥Î£å"?!0:h.includes(s),O=s=>s==="default"?!0:x;return e.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:[e.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top z-10",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 min-w-0",children:[e.jsx(G,{variant:"ghost",size:"icon",onClick:l,className:"-ml-2 flex-shrink-0",children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-medium text-lg truncate",children:"ÌÖåÎßà ÏÑ§Ï†ï"})]}),!x&&e.jsxs("div",{className:"flex items-center space-x-2 bg-amber-500/10 px-3 py-1.5 rounded-full border border-amber-500/20 flex-shrink-0",children:[e.jsx(ee,{className:"w-4 h-4 text-amber-500 fill-amber-500 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-amber-600 dark:text-amber-400 tabular-nums whitespace-nowrap",children:U.toLocaleString()}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:"Î£®Î©ò"})]})]})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar p-4 pb-24 space-y-4",children:[e.jsxs(g,{className:"bg-card border-border",children:[e.jsx(E,{children:e.jsxs(_,{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{children:"Í∏∞Î≥∏ Î™®Îìú"})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[i?e.jsx(se,{className:"w-4 h-4"}):e.jsx(re,{className:"w-4 h-4"}),e.jsx(K,{className:"text-foreground",children:"Îã§ÌÅ¨ Î™®Îìú"})]}),e.jsx("div",{className:"-m-2 p-2 inline-flex items-center",children:e.jsx(J,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11
                  [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5
                  [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:i,onCheckedChange:H})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Í∏∞Î≥∏ ÎùºÏù¥Ìä∏ Î™®ÎìúÏôÄ Îã§ÌÅ¨ Î™®ÎìúÎäî Î¨¥Î£åÎ°ú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§."})]})]}),e.jsxs(g,{className:"bg-card border-border",children:[e.jsx(E,{children:e.jsxs(_,{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{children:"Î™∞ÏûÖ ÌÖåÎßà"})]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsx(g,{className:`cursor-pointer transition-all ${p==="default"?"border-primary ring-1 ring-primary":"border-border hover:border-primary/50"}`,onClick:()=>C("default"),children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:"üé®"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:"Í∏∞Î≥∏"}),p==="default"&&e.jsx(m,{className:"text-[10px] px-1.5 h-5",children:"Ï†ÅÏö© Ï§ë"}),e.jsx(m,{variant:"outline",className:"text-[10px] px-1.5 h-5 text-green-600",children:"Î¨¥Î£å"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Í∏∞Î≥∏ ÎùºÏù¥Ìä∏/Îã§ÌÅ¨ Î™®Îìú ÌÖåÎßà"})]})]}),p==="default"&&e.jsx(M,{className:"w-5 h-5 text-primary"})]})})}),A.map(s=>{const t=F(s.id),c=O(s.id),a=p===s.id;return e.jsx(g,{className:`cursor-pointer transition-all ${a?"border-primary ring-1 ring-primary":!t&&!c?"opacity-70 border-dashed":"border-border hover:border-primary/50"} ${f?"opacity-50 cursor-not-allowed":""}`,onClick:()=>!f&&C(s.id),children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"text-2xl flex-shrink-0",children:s.preview}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.name}),a&&e.jsx(m,{className:"text-[10px] px-1.5 h-5",children:"Ï†ÅÏö© Ï§ë"}),t?e.jsx(m,{variant:"outline",className:"text-[10px] px-1.5 h-5 text-green-600",children:"Î≥¥Ïú† Ï§ë"}):e.jsxs(m,{variant:"outline",className:"text-[10px] px-1.5 h-5 text-amber-600",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),s.price]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:s.description})]})]}),a&&e.jsx(M,{className:"w-5 h-5 text-primary flex-shrink-0"})]})})},s.id)})]})]})]})]})}export{ye as ThemeScreen};
