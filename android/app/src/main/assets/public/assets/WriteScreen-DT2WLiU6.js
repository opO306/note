import{r as t,j as e}from"./index-BJjkZhAE.js";import{a as ge,u as q,K as je}from"./keyboard-dismiss-button-CgE0Ackf.js";import{i as F,a5 as ve,a6 as Ne,s as o,a7 as w,B as d,f as be,a8 as ye,C as v,b as N,q as Ce,I as B,Q as Se,a9 as ke,aa as we,k as Te,X as Ie,R as De}from"./App-Cnx-z95_.js";import{ConnectionBadge as Ee}from"./offline-indicator-C_WISlkw.js";import{C as Ae}from"./compass-DdDIcXqX.js";import"./vendor-capacitor-Bm7NWSxP.js";import"./vendor-react-1wgkHQEd.js";import"./vendor-firebase-B8qz7irO.js";import"./triangle-alert-DhDogudD.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],J=F("folder-open",Pe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ze=F("save",Re);function Oe(){return ve()}const g={getItem:m=>{try{return localStorage.getItem(m)}catch{return null}},setItem:(m,h)=>{try{localStorage.setItem(m,h)}catch{}},removeItem:m=>{try{localStorage.removeItem(m)}catch{}}},Le=3600*1e3;function Qe({onBack:m,onSubmit:h,categories:T}){const[l,I]=t.useState(""),[i,D]=t.useState(""),[u,b]=t.useState("question"),[n,H]=t.useState(""),[c,y]=t.useState("전체"),[a,E]=t.useState([]),[C,V]=t.useState(""),[Q,W]=t.useState(!1),[X,G]=t.useState(!1),[U,A]=t.useState(!1),[P,R]=t.useState(null),[j,Y]=t.useState(!0),x=t.useRef(null),z=t.useRef(!1),S=ge(),Z=q({delay:350,offset:100}),ee=q({delay:350,offset:100}),se=q({delay:350,offset:100}),{isOnline:O}=Ne(),_=T.find(s=>s.id===n),k=_?.subCategories||[],te=j?"작성 중인 내용은 자동으로 임시 저장됩니다. 임시 저장된 내용은 1시간 후 자동으로 삭제됩니다.":"작성 중인 내용은 저장되지 않습니다. 나가면 현재 작성 중인 내용이 사라집니다.";t.useEffect(()=>{try{const s=g.getItem("userSettings");if(!s)return;const r=JSON.parse(s);typeof r.autoSave=="boolean"&&Y(r.autoSave)}catch{}},[]);const{writeDraft:f,setWriteDraft:K}=Oe();t.useEffect(()=>{if(f)return;const s=g.getItem("draftPost");if(s)try{const r=JSON.parse(s);if(r.savedAt){const M=new Date(r.savedAt).getTime();if(!M||Number.isNaN(M)){g.removeItem("draftPost");return}if(Date.now()-M>Le){g.removeItem("draftPost");return}}I(r.title||""),D(r.content||""),b(r.postType||"question"),H(r.category||""),y(r.subCategory||"전체"),E(r.tags||[]),R(r.savedAt?new Date(r.savedAt):null),o.success("임시 저장된 글을 불러왔습니다.")}catch{}},[f]),t.useEffect(()=>{f&&(I(f.title??""),D(f.body??""),b(f.postType??"question"),R(null),K(null))},[f,K]);const $=t.useCallback(()=>{if(!l.trim()&&!i.trim())return;const s={title:l,content:i,postType:u,category:n,subCategory:c,tags:a,savedAt:new Date().toISOString()};g.setItem("draftPost",JSON.stringify(s)),R(new Date),z.current=!1},[l,i,u,n,c,a]);t.useEffect(()=>{if(!j){x.current&&clearTimeout(x.current);return}return(l.trim()||i.trim())&&(z.current=!0,x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{$()},3e3)),()=>{x.current&&clearTimeout(x.current)}},[l,i,u,n,c,a,$,j]);const ae=t.useCallback(()=>{b("question")},[]),re=t.useCallback(()=>{b("guide")},[]),ne=t.useCallback(()=>{W(s=>!s)},[]),le=t.useCallback(()=>{y("전체")},[]),ie=t.useCallback(s=>{I(s.target.value)},[]),ce=t.useCallback(s=>{D(s.target.value)},[]),oe=t.useCallback(()=>{G(s=>!s)},[]),de=t.useCallback(s=>{V(s.target.value)},[]),me=t.useCallback(s=>{s&&s.style.setProperty("--dynamic-padding-bottom",S.isVisible?`${S.height}px`:"0px")},[S.isVisible,S.height]),p=t.useCallback(()=>{g.removeItem("draftPost"),z.current=!1},[]);t.useEffect(()=>{n&&y("전체")},[n]);const ue=t.useCallback(()=>{if(!O){o.error("인터넷 연결이 필요합니다. 연결 후 다시 시도해주세요.");return}if(!l.trim()){o.error("제목을 입력해주세요.");return}if(!i.trim()){o.error("내용을 입력해주세요.");return}if(!n){o.error("카테고리를 선택해주세요.");return}if(w(l)){o.error("제목에 부적절한 단어가 포함되어 있습니다");return}if(w(i)){o.error("내용에 부적절한 단어가 포함되어 있습니다");return}if(a.some(s=>w(s))){o.error("태그에 부적절한 단어가 포함되어 있습니다");return}h({title:l.trim(),content:i.trim(),category:n,subCategory:c,type:u,tags:a}),p()},[O,l,i,n,u,c,a,h,p]),xe=t.useCallback(()=>{l.trim()||i.trim()?A(!0):(p(),m())},[l,i,m,p]),fe=t.useCallback(()=>{A(!1),j||p(),m()},[m,j,p]),L=t.useCallback(()=>{const s=C.trim();if(s){if(w(s)){o.error("태그에 부적절한 단어가 포함되어 있습니다.");return}if(a.includes(s)){o.error("이미 추가된 태그입니다.");return}if(a.length>=5){o.error("태그는 최대 5개까지 추가할 수 있습니다.");return}E([...a,s]),V("")}},[C,a]),he=t.useCallback(s=>{E(a.filter(r=>r!==s))},[a]),pe=t.useCallback(s=>{s.key==="Enter"&&(s.preventDefault(),L())},[L]);return e.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-hidden flex flex-col",children:[e.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:xe,children:e.jsx(be,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"font-medium",children:"새 글 작성"}),e.jsx(Ee,{})]}),P&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(ze,{className:"w-3 h-3"}),new Date().getTime()-P.getTime()<6e4?"방금 저장됨":`${Math.floor((new Date().getTime()-P.getTime())/6e4)}분 전 저장됨`]})]})]}),e.jsxs(d,{onClick:ue,className:"flex items-center space-x-2",disabled:!l.trim()||!i.trim()||!n||!O,children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"게시"})]})]})})}),e.jsx("main",{className:"flex-1 overflow-y-auto scrollbar-hide keyboard-aware-container dynamic-container",ref:me,children:e.jsxs("div",{className:"p-4 space-y-4 pb-24",children:[e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"게시글 유형"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(d,{variant:u==="question"?"default":"outline",onClick:ae,className:"flex items-center space-x-2 h-12",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{children:"질문글"})]}),e.jsxs(d,{variant:u==="guide"?"default":"outline",onClick:re,className:"flex items-center space-x-2 h-12",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"길잡이글"})]})]})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"카테고리"}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:ne,className:"flex items-center space-x-1",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"선택"})]})]}),Q&&e.jsxs("div",{className:"space-y-3 border-2 border-primary bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"메인 카테고리를 선택하세요"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:T.filter(s=>s.id!=="전체").map(s=>e.jsx(d,{variant:n===s.id?"default":"outline",onClick:()=>H(s.id),className:"h-auto py-3",children:s.name},s.id))})]}),n&&n!=="전체"&&k.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"세부 카테고리를 선택하세요 (선택사항)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(d,{variant:c==="전체"?"default":"outline",onClick:le,size:"sm",children:"전체"}),k.filter(s=>s.id!=="전체").map(s=>e.jsx(d,{variant:c===s.id?"default":"outline",onClick:()=>y(s.id),size:"sm",children:s.name},s.id))]})]})]}),n&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsxs("span",{children:[_?.name,n!=="전체"&&c&&c!=="전체"&&k.find(s=>s.id===c)&&` > ${k.find(s=>s.id===c)?.name}`]})]})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"제목"}),e.jsx(B,{ref:Z,value:l,onChange:ie,placeholder:"제목을 입력하세요",maxLength:100,className:"input-keyboard-safe"}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[l.length,"/100"]})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"내용"}),e.jsx(Se,{ref:ee,value:i,onChange:ce,placeholder:"내용을 입력하세요",className:"min-h-[200px] resize-none input-keyboard-safe",maxLength:2e3}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[i.length,"/2000"]}),e.jsx("div",{className:"pt-2 border-t border-border/50",children:e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"⚠️ 욕설, 타인을 비난하는 글 등 게시판 이용 방향과 위배되는 글들은 경고 없이 삭제 및 사용자 이용 정지 조치됩니다."})})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"태그"}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:oe,className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{children:"추가"})]})]}),X&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(B,{ref:se,value:C,onChange:de,onKeyPress:pe,placeholder:"태그를 입력하세요 (최대 5개)",maxLength:20,disabled:a.length>=5,className:"input-keyboard-safe"}),e.jsx(d,{onClick:L,disabled:!C.trim()||a.length>=5,size:"sm",children:e.jsx(we,{className:"w-4 h-4"})})]}),a.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(s=>e.jsxs(Te,{variant:"secondary",className:"flex items-center space-x-1 px-2 py-1",children:[e.jsxs("span",{children:["#",s]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>he(s),className:"h-auto p-1 hover:bg-transparent touch-extended ml-1",children:e.jsx(Ie,{className:"w-3 h-3"})})]},s))}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"태그는 최대 5개까지 추가할 수 있습니다."})]})})})]})}),e.jsx(je,{}),e.jsx(De,{open:U,onOpenChange:A,title:"작성을 취소하시겠습니까?",description:te,confirmText:"나가기",onConfirm:fe})]})}export{Qe as WriteScreen};
