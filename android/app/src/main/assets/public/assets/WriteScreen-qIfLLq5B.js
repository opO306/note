import{r as t,j as e,d as ee}from"./index-Dk92xA2w.js";import{R as se,M as te}from"./vendor-firebase-C8ERkm_B.js";import{a as $e,u as K,K as He}from"./keyboard-dismiss-button-D7USFvij.js";import{c as le,u as Ke,a as qe,B as m,j as Ve,g as Ge}from"./App-Bs6YIlvy.js";import{s as u,p as Je,q as Ue,r as We,M as Fe,f as Xe,H as Ye,t as Qe}from"./MainScreenRefactored-Cnk3o5eP.js";import{t as l}from"./toastHelper-CmqwgrpB.js";import{c as D}from"./profanityFilter-CmEWjjlv.js";import{C as N,a as y}from"./card-BTNeCppV.js";import{I as ae}from"./input-CIhE7IwC.js";import{X as Ze,A as re}from"./alert-dialog-simple-CJo3HBbI.js";import{A as es}from"./arrow-left-BKP0x_yl.js";import{C as ss}from"./compass-Br1pEBh_.js";import"./vendor-capacitor-rvH5hiNU.js";import"./vendor-react-1wgkHQEd.js";import"./index-DKlU3y7i.js";import"./index-SzzsopSI.js";import"./checkbox-BNqRj2KP.js";import"./check-CFbpOADo.js";import"./avatar-BVorKTXF.js";import"./sparkles-BV-B8Lrs.js";import"./firebaseCache-C_csZa1c.js";import"./users-D58BOHBF.js";import"./sun-aJJImKwH.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],ne=le("folder-open",ts);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],rs=le("save",as),q="guestId",ns=3600*1e3,ce="lastPostSubmitTime",ie=30*1e3;function As({onBack:C,onSubmit:V,categories:G,lumenBalance:cs=0,spendLumens:is,isGuest:h}){const[n,P]=t.useState(""),[c,A]=t.useState(""),[x,I]=t.useState("question"),[i,J]=t.useState(""),[d,k]=t.useState("전체"),[r,M]=t.useState([]),[w,U]=t.useState(""),[oe,de]=t.useState(!1),[me,ue]=t.useState(!1),[fe,_]=t.useState(!1),[he,W]=t.useState(!1),[L,O]=t.useState(null),[v,xe]=t.useState(!0),p=t.useRef(null),B=t.useRef(!1),[j,pe]=t.useState(void 0),[S,F]=t.useState(void 0),[R,ge]=t.useState(new Set),[z,je]=t.useState(new Set),T=$e(),be=K({delay:350,offset:100}),ve=K({delay:350,offset:100}),Se=K({delay:350,offset:100}),{isOnline:$}=Ke(),{navigateToLogin:Ne}=qe(),[g,X]=t.useState(null),Y=G.find(s=>s.id===i),E=Y?.subCategories||[],ye=v?"작성 중인 내용은 자동으로 임시 저장됩니다. 임시 저장된 내용은 1시간 후 자동으로 삭제됩니다.":"작성 중인 내용은 저장되지 않습니다. 나가면 현재 작성 중인 내용이 사라집니다.";t.useEffect(()=>{(async()=>{try{const o=await(await fetch("https://api.ipify.org?format=json")).json();pe(o.ip)}catch{}})()},[]),t.useEffect(()=>{if(h){let s=u.getItem(q);s||(s=`게스트${Math.floor(Math.random()*1e4).toString().padStart(4,"0")}`,u.setItem(q,s)),F(s)}else F(void 0),u.removeItem(q)},[h]),t.useEffect(()=>{(async()=>{try{const a=await se(te(ee,"blockedIPs")),o=new Set;a.forEach(f=>o.add(f.id)),ge(o)}catch{}})()},[]),t.useEffect(()=>{h&&(async()=>{try{const a=await se(te(ee,"suspendedGuestIds")),o=new Set;a.forEach(f=>o.add(f.id)),je(o)}catch{}})()},[h]),t.useEffect(()=>{try{const s=u.getItem("userSettings");if(!s)return;const a=JSON.parse(s);typeof a.autoSave=="boolean"&&xe(a.autoSave)}catch{}},[]),t.useEffect(()=>{if(g)return;const s=u.getItem("draftPost");if(s)try{const a=JSON.parse(s);if(a.savedAt){const o=new Date(a.savedAt).getTime();if(!o||Number.isNaN(o)){u.removeItem("draftPost");return}if(Date.now()-o>ns){u.removeItem("draftPost");return}}P(a.title||""),A(a.content||""),I(a.postType||"question"),J(a.category||""),k(a.subCategory||"전체"),M(a.tags||[]),O(a.savedAt?new Date(a.savedAt):null),l.success("임시 저장된 글을 불러왔습니다.")}catch{}},[g]),t.useEffect(()=>{g&&(P(g.title??""),A(g.body??""),I(g.postType??"question"),O(null),X(null))},[g,X]);const Q=t.useCallback(()=>{if(!n.trim()&&!c.trim())return;const s={title:n,content:c,postType:x,category:i,subCategory:d,tags:r,savedAt:new Date().toISOString()};u.setItem("draftPost",JSON.stringify(s)),O(new Date),B.current=!1},[n,c,x,i,d,r]);t.useEffect(()=>{if(!v){p.current&&clearTimeout(p.current);return}return(n.trim()||c.trim())&&(B.current=!0,p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{Q()},3e3)),()=>{p.current&&clearTimeout(p.current)}},[n,c,x,i,d,r,Q,v]);const Ce=t.useCallback(()=>{I("question")},[]),Ie=t.useCallback(()=>{I("guide")},[]),ke=t.useCallback(()=>{de(s=>!s)},[]),we=t.useCallback(()=>{k("전체")},[]),Te=t.useCallback(s=>{P(s.target.value)},[]),Ee=t.useCallback(s=>{A(s.target.value)},[]),De=t.useCallback(()=>{ue(s=>!s)},[]),Pe=t.useCallback(s=>{U(s.target.value)},[]),Ae=t.useCallback(s=>{s&&s.style.setProperty("--dynamic-padding-bottom",T.isVisible?`${T.height}px`:"0px")},[T.isVisible,T.height]),b=t.useCallback(()=>{u.removeItem("draftPost"),B.current=!1},[]);t.useEffect(()=>{i&&k("전체")},[i]);const Me=t.useCallback(async()=>{if(!$){l.error("인터넷 연결이 필요합니다. 연결 후 다시 시도해주세요.");return}if(j&&R.has(j)){l.error("서비스 이용이 제한되었습니다. 관리자에게 문의하세요.");return}if(h&&S&&z.has(S)){l.error("게스트 계정이 정지되었습니다. 관리자에게 문의하세요.");return}const s=u.getItem(ce);if(s)try{const f=parseInt(s,10),Z=Date.now()-f;if(Z<ie){const ze=Math.ceil((ie-Z)/1e3);l.error(`게시글 작성 쿨타임이 남아있습니다. ${ze}초 후 다시 시도해주세요.`);return}}catch{}if(!n.trim()){l.error("제목을 입력해주세요.");return}if(!c.trim()){l.error("내용을 입력해주세요.");return}if(!i){l.error("카테고리를 선택해주세요.");return}if(D(n)){l.error("제목에 부적절한 단어가 포함되어 있습니다");return}if(D(c)){l.error("내용에 부적절한 단어가 포함되어 있습니다");return}if(r.some(f=>D(f))){l.error("태그에 부적절한 단어가 포함되어 있습니다");return}const a=`${n} ${c}`,o=Je(a);if(o.hasPersonalInfo){l.error(Ue(o.detectedTypes));return}if(h){W(!0);return}V({title:n.trim(),content:c.trim(),category:i,subCategory:d,type:x,tags:r,clientIp:j}),u.setItem(ce,Date.now().toString()),b()},[$,n,c,i,x,d,r,V,b,h,j,S,R,z]),_e=t.useCallback(()=>{n.trim()||c.trim()?_(!0):(b(),C())},[n,c,C,b]),Le=t.useCallback(()=>{_(!1),v||b(),C()},[C,v,b]),H=t.useCallback(()=>{const s=w.trim();if(s){if(D(s)){l.error("태그에 부적절한 단어가 포함되어 있습니다.");return}if(r.includes(s)){l.error("이미 추가된 태그입니다.");return}if(r.length>=5){l.error("태그는 최대 5개까지 추가할 수 있습니다.");return}M([...r,s]),U("")}},[w,r]),Oe=t.useCallback(s=>{M(r.filter(a=>a!==s))},[r]),Be=t.useCallback(s=>{s.key==="Enter"&&(s.preventDefault(),H())},[H]),Re=!!(!n.trim()||!c.trim()||!i||!$||j&&R.has(j)||S&&z.has(S)||h);return e.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-hidden flex flex-col",children:[e.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:_e,children:e.jsx(es,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"font-medium",children:"새 글 작성"}),e.jsx(Ve,{})]}),L&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(rs,{className:"w-3 h-3"}),new Date().getTime()-L.getTime()<6e4?"방금 저장됨":`${Math.floor((new Date().getTime()-L.getTime())/6e4)}분 전 저장됨`]})]})]}),e.jsxs(m,{onClick:Me,className:"flex items-center space-x-2",disabled:Re,children:[e.jsx(We,{className:"w-4 h-4"}),e.jsx("span",{children:"게시"})]})]})})}),e.jsxs("main",{className:"flex-1 overflow-y-auto scrollbar-hide keyboard-aware-container dynamic-container",ref:Ae,children:[e.jsxs("div",{className:"p-4 space-y-4 pb-24",children:[e.jsx(N,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"게시글 유형"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(m,{variant:x==="question"?"default":"outline",onClick:Ce,className:"flex items-center space-x-2 h-12",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"질문글"})]}),e.jsxs(m,{variant:x==="guide"?"default":"outline",onClick:Ie,className:"flex items-center space-x-2 h-12",children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsx("span",{children:"길잡이글"})]})]})]})})}),e.jsx(N,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"카테고리"}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:ke,className:"flex items-center space-x-1",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"선택"})]})]}),oe&&e.jsxs("div",{className:"space-y-3 border-2 border-primary bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"메인 카테고리를 선택하세요"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:G.filter(s=>s.id!=="전체").map(s=>e.jsx(m,{variant:i===s.id?"default":"outline",onClick:()=>J(s.id),className:"h-auto py-3",children:s.name},s.id))})]}),i&&i!=="전체"&&E.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"세부 카테고리를 선택하세요 (선택사항)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(m,{variant:d==="전체"?"default":"outline",onClick:we,size:"sm",children:"전체"}),E.filter(s=>s.id!=="전체").map(s=>e.jsx(m,{variant:d===s.id?"default":"outline",onClick:()=>k(s.id),size:"sm",children:s.name},s.id))]})]})]}),i&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsxs("span",{children:[Y?.name,i!=="전체"&&d&&d!=="전체"&&E.find(s=>s.id===d)?` > ${E.find(s=>s.id===d)?.name}`:null]})]})]})})}),e.jsx(N,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"제목"}),e.jsx(ae,{ref:be,value:n,onChange:Te,placeholder:"제목을 입력하세요",maxLength:100,className:"input-keyboard-safe"}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[n.length,"/100"]})]})})}),e.jsx(N,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"내용"}),e.jsx(Xe,{ref:ve,value:c,onChange:Ee,placeholder:"내용을 입력하세요",className:"min-h-[200px] resize-none input-keyboard-safe",maxLength:2e3}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[c.length,"/2000"]}),e.jsx("div",{className:"pt-2 border-t border-border/50",children:e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"⚠️ 욕설, 타인을 비난하는 글 등 게시판 이용 방향과 위배되는 글들은 경고 없이 삭제 및 사용자 이용 정지 조치됩니다."})})]})})}),e.jsx(N,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"태그"}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:De,className:"flex items-center space-x-1",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{children:"추가"})]})]}),me&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(ae,{ref:Se,value:w,onChange:Pe,onKeyPress:Be,placeholder:"태그를 입력하세요 (최대 5개)",maxLength:20,disabled:r.length>=5,className:"input-keyboard-safe"}),e.jsx(m,{onClick:H,disabled:!w.trim()||r.length>=5,size:"sm",children:e.jsx(Qe,{className:"w-4 h-4"})})]}),r.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(s=>e.jsxs(Ge,{variant:"secondary",className:"flex items-center space-x-1 px-2 py-1",children:[e.jsxs("span",{children:["#",s]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>Oe(s),className:"h-auto p-1 hover:bg-transparent touch-extended ml-1",children:e.jsx(Ze,{className:"w-3 h-3"})})]},s))}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"태그는 최대 5개까지 추가할 수 있습니다."})]})})})]})," "]}),e.jsx(He,{}),e.jsx(re,{open:fe,onOpenChange:_,title:"작성을 취소하시겠습니까?",description:ye,confirmText:"나가기",onConfirm:Le}),e.jsx(re,{open:he,onOpenChange:W,title:"로그인이 필요합니다.",description:"로그인 후 이 기능을 이용할 수 있습니다. 지금 로그인하시겠습니까?",confirmText:"로그인",onConfirm:()=>{Ne()}})]})}export{As as default};
