const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-CS1gUDcK.js","assets/vendor-radix-common-B3645yeL.js","assets/vendor-react-FE6BcKt8.js","assets/vendor-utils-Bl8elWQx.js","assets/vendor-radix-extra-CO-j8Ez3.js","assets/vendor-icons-B_v69IgL.js"])))=>i.map(i=>d[i]);
import{r as x,j as i,S as Vg,n as Vb,T as Lg,o as Lb,C as Og,p as Ob,O as Mg,q as Mb,s as Ug,t as Fg,D as Bg,v as Ub,w as Fb}from"./vendor-radix-common-B3645yeL.js";import{b as Bb}from"./vendor-react-FE6BcKt8.js";import{c as vd,t as $g,a as qg,b as ss,T as $b}from"./vendor-utils-Bl8elWQx.js";import{C as qb,a as zb,R as zg,I as Gg,F as Hg,b as Gb,L as Hb,T as Kb,c as Wb,d as Qb,e as Jb,f as Yb,g as Xb,h as Zb}from"./vendor-radix-extra-CO-j8Ez3.js";import{C as to,A as Et,a as Tu,U as Ti,T as ev,B as tv,F as tl,L as Kg,E as Wg,X as Id,M as It,b as nv,c as gi,S as Qg,d as Gn,e as Jg,P as Td,f as sv,g as $s,h as Yg,i as Nd,j as Ed,k as bc,l as nl,H as rv,m as Ms,n as iv,o as av,p as ov,q as Xg,D as cv,r as lv,s as Zg,t as uv,u as dv,v as ex,w as vc,x as Bn,y as br,z as La,W as tx,G as Zo,I as Gf,R as hv,J as fv,K as nx,N as mv,O as Hf,Q as Nu,V as Ia,Y as xi,Z as pv,_ as Ta,$ as gv,a0 as Wl,a1 as Ql,a2 as xv,a3 as yv,a4 as _v,a5 as wv,a6 as bv,a7 as vv,a8 as Iv}from"./vendor-icons-B_v69IgL.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();var Tv=Bb();const Nv="modulepreload",Ev=function(n){return"/"+n},Kf={},Av=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let o=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=c?.nonce||c?.getAttribute("nonce");r=o(t.map(d=>{if(d=Ev(d),d in Kf)return;Kf[d]=!0;const h=d.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":Nv,h||(p.as="script"),p.crossOrigin="",p.href=d,u&&p.setAttribute("nonce",u),document.head.appendChild(p),h)return new Promise((w,v)=>{p.addEventListener("load",w),p.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return r.then(o=>{for(const c of o||[])c.status==="rejected"&&a(c.reason);return e().catch(a)})};/*! Capacitor: https://capacitorjs.com/ - MIT License */var Ni;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Ni||(Ni={}));class Jl extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const jv=n=>{var e,t;return n?.androidBridge?"android":!((t=(e=n?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},kv=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},s=t.Plugins=t.Plugins||{},r=()=>e!==null?e.name:jv(n),a=()=>r()!=="web",o=m=>{const p=d.get(m);return!!(p?.platforms.has(r())||c(m))},c=m=>{var p;return(p=t.PluginHeaders)===null||p===void 0?void 0:p.find(w=>w.name===m)},u=m=>n.console.error(m),d=new Map,h=(m,p={})=>{const w=d.get(m);if(w)return console.warn(`Capacitor plugin "${m}" already registered. Cannot register plugins twice.`),w.proxy;const v=r(),j=c(m);let k;const P=async()=>(!k&&v in p?k=typeof p[v]=="function"?k=await p[v]():k=p[v]:e!==null&&!k&&"web"in p&&(k=typeof p.web=="function"?k=await p.web():k=p.web),k),R=(y,b)=>{var I,T;if(j){const A=j?.methods.find(N=>b===N.name);if(A)return A.rtype==="promise"?N=>t.nativePromise(m,b.toString(),N):(N,F)=>t.nativeCallback(m,b.toString(),N,F);if(y)return(I=y[b])===null||I===void 0?void 0:I.bind(y)}else{if(y)return(T=y[b])===null||T===void 0?void 0:T.bind(y);throw new Jl(`"${m}" plugin is not implemented on ${v}`,Ni.Unimplemented)}},C=y=>{let b;const I=(...T)=>{const A=P().then(N=>{const F=R(N,y);if(F){const Z=F(...T);return b=Z?.remove,Z}else throw new Jl(`"${m}.${y}()" is not implemented on ${v}`,Ni.Unimplemented)});return y==="addListener"&&(A.remove=async()=>b()),A};return I.toString=()=>`${y.toString()}() { [capacitor code] }`,Object.defineProperty(I,"name",{value:y,writable:!1,configurable:!1}),I},S=C("addListener"),D=C("removeListener"),M=(y,b)=>{const I=S({eventName:y},b),T=async()=>{const N=await I;D({eventName:y,callbackId:N},b)},A=new Promise(N=>I.then(()=>N({remove:T})));return A.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await T()},A},_=new Proxy({},{get(y,b){switch(b){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return j?M:S;case"removeListener":return D;default:return C(b)}}});return s[m]=_,d.set(m,{name:m,proxy:_,platforms:new Set([...Object.keys(p),...j?[v]:[]])}),_};return t.convertFileSrc||(t.convertFileSrc=m=>m),t.getPlatform=r,t.handleError=u,t.isNativePlatform=a,t.isPluginAvailable=o,t.registerPlugin=h,t.Exception=Jl,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},Cv=n=>n.Capacitor=kv(n),Eu=Cv(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Ad=Eu.registerPlugin;class sx{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const a=this.windowListeners[e];a&&!a.registered&&this.addWindowListener(a),s&&this.sendRetainedArgumentsForEvent(e);const o=async()=>this.removeListener(e,t);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const r=this.listeners[e];if(!r){if(s){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}return}r.forEach(a=>a(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:s=>{this.notifyListeners(t,s)}}}unimplemented(e="not implemented"){return new Eu.Exception(e,Ni.Unimplemented)}unavailable(e="not available"){return new Eu.Exception(e,Ni.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const r=s.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(s=>{this.notifyListeners(e,s)}))}}const Wf=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Qf=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Sv extends sx{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(s=>{if(s.length<=0)return;let[r,a]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");r=Qf(r).trim(),a=Qf(a).trim(),t[r]=a}),t}async setCookie(e){try{const t=Wf(e.key),s=Wf(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,a=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${r}; path=${a}; ${o};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Ad("CapacitorCookies",{web:()=>new Sv});const Rv=async n=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{const r=s.result;e(r.indexOf(",")>=0?r.split(",")[1]:r)},s.onerror=r=>t(r),s.readAsDataURL(n)}),Pv=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(r=>r.toLocaleLowerCase()).reduce((r,a,o)=>(r[a]=n[e[o]],r),{})},Dv=(n,e=!0)=>n?Object.entries(n).reduce((s,r)=>{const[a,o]=r;let c,u;return Array.isArray(o)?(u="",o.forEach(d=>{c=e?encodeURIComponent(d):d,u+=`${a}=${c}&`}),u.slice(0,-1)):(c=e?encodeURIComponent(o):o,u=`${a}=${c}`),`${s}&${u}`},"").substr(1):null,Vv=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),r=Pv(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(r.includes("application/x-www-form-urlencoded")){const a=new URLSearchParams;for(const[o,c]of Object.entries(n.data||{}))a.set(o,c);t.body=a.toString()}else if(r.includes("multipart/form-data")||n.data instanceof FormData){const a=new FormData;if(n.data instanceof FormData)n.data.forEach((c,u)=>{a.append(u,c)});else for(const c of Object.keys(n.data))a.append(c,n.data[c]);t.body=a;const o=new Headers(t.headers);o.delete("content-type"),t.headers=o}else(r.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class Lv extends sx{async request(e){const t=Vv(e,e.webFetchExtra),s=Dv(e.params,e.shouldEncodeUrlParams),r=s?`${e.url}?${s}`:e.url,a=await fetch(r,t),o=a.headers.get("content-type")||"";let{responseType:c="text"}=a.ok?e:{};o.includes("application/json")&&(c="json");let u,d;switch(c){case"arraybuffer":case"blob":d=await a.blob(),u=await Rv(d);break;case"json":u=await a.json();break;case"document":case"text":default:u=await a.text()}const h={};return a.headers.forEach((m,p)=>{h[p]=m}),{data:u,headers:h,status:a.status,url:a.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Ad("CapacitorHttp",{web:()=>new Lv});const Au=Ad("App",{web:()=>Av(()=>import("./web-CS1gUDcK.js"),__vite__mapDeps([0,1,2,3,4,5])).then(n=>new n.AppWeb)});function Ov(...n){return $g(qg(n))}const Mv=vd("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),z=x.forwardRef(({className:n,variant:e,size:t,asChild:s=!1,...r},a)=>{const o=s?Vg:"button";return i.jsx(o,{className:Ov(Mv({variant:e,size:t}),n),ref:a,...r})});z.displayName="Button";function qe(...n){return $g(qg(n))}function $({className:n,...e}){return i.jsx("div",{"data-slot":"card",className:qe("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",n),...e})}function ge({className:n,...e}){return i.jsx("div",{"data-slot":"card-header",className:qe("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",n),...e})}function ye({className:n,...e}){return i.jsx("h4",{"data-slot":"card-title",className:qe("leading-none",n),...e})}function q({className:n,...e}){return i.jsx("div",{"data-slot":"card-content",className:qe("px-6 [&:last-child]:pb-6",n),...e})}function yi({className:n,...e}){return i.jsx(qb,{"data-slot":"checkbox",className:qe("peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",n),...e,children:i.jsx(zb,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:i.jsx(to,{className:"size-3.5"})})})}function Mt({className:n,...e}){return i.jsx(Vb,{"data-slot":"label",className:qe("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",n),...e})}const Uv="/assets/c33b5ffb86c8f42db8f0cdf6145f21abd5c6153f-BWCCbCq_.png",Fv=()=>{};var Jf={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rx=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Bv=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const a=n[t++];e[s++]=String.fromCharCode((r&31)<<6|a&63)}else if(r>239&&r<365){const a=n[t++],o=n[t++],c=n[t++],u=((r&7)<<18|(a&63)<<12|(o&63)<<6|c&63)-65536;e[s++]=String.fromCharCode(55296+(u>>10)),e[s++]=String.fromCharCode(56320+(u&1023))}else{const a=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(a&63)<<6|o&63)}}return e.join("")},jd={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const a=n[r],o=r+1<n.length,c=o?n[r+1]:0,u=r+2<n.length,d=u?n[r+2]:0,h=a>>2,m=(a&3)<<4|c>>4;let p=(c&15)<<2|d>>6,w=d&63;u||(w=64,o||(p=64)),s.push(t[h],t[m],t[p],t[w])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(rx(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Bv(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const a=t[n.charAt(r++)],c=r<n.length?t[n.charAt(r)]:0;++r;const d=r<n.length?t[n.charAt(r)]:64;++r;const m=r<n.length?t[n.charAt(r)]:64;if(++r,a==null||c==null||d==null||m==null)throw new $v;const p=a<<2|c>>4;if(s.push(p),d!==64){const w=c<<4&240|d>>2;if(s.push(w),m!==64){const v=d<<6&192|m;s.push(v)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class $v extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const qv=function(n){const e=rx(n);return jd.encodeByteArray(e,!0)},Ic=function(n){return qv(n).replace(/\./g,"")},ix=function(n){try{return jd.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zv=()=>kd().__FIREBASE_DEFAULTS__,Gv=()=>{if(typeof process>"u"||typeof Jf>"u")return;const n=Jf.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Hv=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ix(n[1]);return e&&JSON.parse(e)},sl=()=>{try{return Fv()||zv()||Gv()||Hv()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ax=n=>sl()?.emulatorHosts?.[n],ox=n=>{const e=ax(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},cx=()=>sl()?.config,lx=n=>sl()?.[`_${n}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function rl(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kv(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,a=n.sub||n.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Ic(JSON.stringify(t)),Ic(JSON.stringify(o)),""].join(".")}const Na={};function Wv(){const n={prod:[],emulator:[]};for(const e of Object.keys(Na))Na[e]?n.emulator.push(e):n.prod.push(e);return n}function Qv(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Yf=!1;function Cd(n,e){if(typeof window>"u"||typeof document>"u"||!Zn(window.location.host)||Na[n]===e||Na[n]||Yf)return;Na[n]=e;function t(p){return`__firebase__banner__${p}`}const s="__firebase__banner",a=Wv().prod.length>0;function o(){const p=document.getElementById(s);p&&p.remove()}function c(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function u(p,w){p.setAttribute("width","24"),p.setAttribute("id",w),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function d(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{Yf=!0,o()},p}function h(p,w){p.setAttribute("id",w),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function m(){const p=Qv(s),w=t("text"),v=document.getElementById(w)||document.createElement("span"),j=t("learnmore"),k=document.getElementById(j)||document.createElement("a"),P=t("preprendIcon"),R=document.getElementById(P)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const C=p.element;c(C),h(k,j);const S=d();u(R,P),C.append(R,v,k,S),document.body.appendChild(C)}a?(v.innerText="Preview backend disconnected.",R.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(R.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,v.innerText="Preview backend running in this workspace."),v.setAttribute("id",w)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _t(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Jv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_t())}function ux(){const n=sl()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Yv(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Sd(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Xv(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Zv(){const n=_t();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function dx(){return!ux()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function hx(){return!ux()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function qi(){try{return typeof indexedDB=="object"}catch{return!1}}function Rd(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}function fx(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e0="FirebaseError";class gn extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=e0,Object.setPrototypeOf(this,gn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Zs.prototype.create)}}class Zs{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,a=this.errors[e],o=a?t0(a,s):"Error",c=`${this.serviceName}: ${o} (${r}).`;return new gn(r,c,s)}}function t0(n,e){return n.replace(n0,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const n0=/\{\$([^}]+)}/g;function s0(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ls(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const a=n[r],o=e[r];if(Xf(a)&&Xf(o)){if(!ls(a,o))return!1}else if(a!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function Xf(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function no(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function r0(n,e){const t=new i0(n,e);return t.subscribe.bind(t)}class i0{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");a0(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=Yl),r.error===void 0&&(r.error=Yl),r.complete===void 0&&(r.complete=Yl);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function a0(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Yl(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o0=1e3,c0=2,l0=14400*1e3,u0=.5;function ju(n,e=o0,t=c0){const s=e*Math.pow(t,n),r=Math.round(u0*s*(Math.random()-.5)*2);return Math.min(l0,s+r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ge(n){return n&&n._delegate?n._delegate:n}class Kt{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new Oa;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(f0(e))try{this.getOrInitializeService({instanceIdentifier:dr})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:r});s.resolve(a)}catch{}}}}clearInstance(e=dr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=dr){return this.instances.has(e)}getOptions(e=dr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[a,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(a);s===c&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const a=this.instances.get(s);return a&&e(a,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:h0(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=dr){return this.component?this.component.multipleInstances?e:dr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function h0(n){return n===dr?void 0:n}function f0(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new d0(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ve;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ve||(Ve={}));const p0={debug:Ve.DEBUG,verbose:Ve.VERBOSE,info:Ve.INFO,warn:Ve.WARN,error:Ve.ERROR,silent:Ve.SILENT},g0=Ve.INFO,x0={[Ve.DEBUG]:"log",[Ve.VERBOSE]:"log",[Ve.INFO]:"info",[Ve.WARN]:"warn",[Ve.ERROR]:"error"},y0=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=x0[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class so{constructor(e){this.name=e,this._logLevel=g0,this._logHandler=y0,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ve))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?p0[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ve.DEBUG,...e),this._logHandler(this,Ve.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ve.VERBOSE,...e),this._logHandler(this,Ve.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ve.INFO,...e),this._logHandler(this,Ve.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ve.WARN,...e),this._logHandler(this,Ve.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ve.ERROR,...e),this._logHandler(this,Ve.ERROR,...e)}}const _0=(n,e)=>e.some(t=>n instanceof t);let Zf,em;function w0(){return Zf||(Zf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function b0(){return em||(em=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const mx=new WeakMap,ku=new WeakMap,px=new WeakMap,Xl=new WeakMap,Pd=new WeakMap;function v0(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",a),n.removeEventListener("error",o)},a=()=>{t(qs(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",a),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&mx.set(t,n)}).catch(()=>{}),Pd.set(e,n),e}function I0(n){if(ku.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",o),n.removeEventListener("abort",o)},a=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",a),n.addEventListener("error",o),n.addEventListener("abort",o)});ku.set(n,e)}let Cu={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ku.get(n);if(e==="objectStoreNames")return n.objectStoreNames||px.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return qs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function T0(n){Cu=n(Cu)}function N0(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(Zl(this),e,...t);return px.set(s,e.sort?e.sort():[e]),qs(s)}:b0().includes(n)?function(...e){return n.apply(Zl(this),e),qs(mx.get(this))}:function(...e){return qs(n.apply(Zl(this),e))}}function E0(n){return typeof n=="function"?N0(n):(n instanceof IDBTransaction&&I0(n),_0(n,w0())?new Proxy(n,Cu):n)}function qs(n){if(n instanceof IDBRequest)return v0(n);if(Xl.has(n))return Xl.get(n);const e=E0(n);return e!==n&&(Xl.set(n,e),Pd.set(e,n)),e}const Zl=n=>Pd.get(n);function gx(n,e,{blocked:t,upgrade:s,blocking:r,terminated:a}={}){const o=indexedDB.open(n,e),c=qs(o);return s&&o.addEventListener("upgradeneeded",u=>{s(qs(o.result),u.oldVersion,u.newVersion,qs(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{a&&u.addEventListener("close",()=>a()),r&&u.addEventListener("versionchange",d=>r(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const A0=["get","getKey","getAll","getAllKeys","count"],j0=["put","add","delete","clear"],eu=new Map;function tm(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(eu.get(e))return eu.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=j0.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||A0.includes(t)))return;const a=async function(o,...c){const u=this.transaction(o,r?"readwrite":"readonly");let d=u.store;return s&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),r&&u.done]))[0]};return eu.set(e,a),a}T0(n=>({...n,get:(e,t,s)=>tm(e,t)||n.get(e,t,s),has:(e,t)=>!!tm(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(C0(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function C0(n){return n.getComponent()?.type==="VERSION"}const Su="@firebase/app",nm="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const us=new so("@firebase/app"),S0="@firebase/app-compat",R0="@firebase/analytics-compat",P0="@firebase/analytics",D0="@firebase/app-check-compat",V0="@firebase/app-check",L0="@firebase/auth",O0="@firebase/auth-compat",M0="@firebase/database",U0="@firebase/data-connect",F0="@firebase/database-compat",B0="@firebase/functions",$0="@firebase/functions-compat",q0="@firebase/installations",z0="@firebase/installations-compat",G0="@firebase/messaging",H0="@firebase/messaging-compat",K0="@firebase/performance",W0="@firebase/performance-compat",Q0="@firebase/remote-config",J0="@firebase/remote-config-compat",Y0="@firebase/storage",X0="@firebase/storage-compat",Z0="@firebase/firestore",eI="@firebase/ai",tI="@firebase/firestore-compat",nI="firebase",sI="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ru="[DEFAULT]",rI={[Su]:"fire-core",[S0]:"fire-core-compat",[P0]:"fire-analytics",[R0]:"fire-analytics-compat",[V0]:"fire-app-check",[D0]:"fire-app-check-compat",[L0]:"fire-auth",[O0]:"fire-auth-compat",[M0]:"fire-rtdb",[U0]:"fire-data-connect",[F0]:"fire-rtdb-compat",[B0]:"fire-fn",[$0]:"fire-fn-compat",[q0]:"fire-iid",[z0]:"fire-iid-compat",[G0]:"fire-fcm",[H0]:"fire-fcm-compat",[K0]:"fire-perf",[W0]:"fire-perf-compat",[Q0]:"fire-rc",[J0]:"fire-rc-compat",[Y0]:"fire-gcs",[X0]:"fire-gcs-compat",[Z0]:"fire-fst",[tI]:"fire-fst-compat",[eI]:"fire-vertex","fire-js":"fire-js",[nI]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tc=new Map,iI=new Map,Pu=new Map;function sm(n,e){try{n.container.addComponent(e)}catch(t){us.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function nn(n){const e=n.name;if(Pu.has(e))return us.debug(`There were multiple attempts to register component ${e}.`),!1;Pu.set(e,n);for(const t of Tc.values())sm(t,n);for(const t of iI.values())sm(t,n);return!0}function Rn(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function un(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},zs=new Zs("app","Firebase",aI);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oI{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Kt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw zs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qr=sI;function xx(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:Ru,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw zs.create("bad-app-name",{appName:String(r)});if(t||(t=cx()),!t)throw zs.create("no-options");const a=Tc.get(r);if(a){if(ls(t,a.options)&&ls(s,a.config))return a;throw zs.create("duplicate-app",{appName:r})}const o=new m0(r);for(const u of Pu.values())o.addComponent(u);const c=new oI(t,s,o);return Tc.set(r,c),c}function ro(n=Ru){const e=Tc.get(n);if(!e&&n===Ru&&cx())return xx();if(!e)throw zs.create("no-app",{appName:n});return e}function St(n,e,t){let s=rI[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),a=e.match(/\s|\//);if(r||a){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&a&&o.push("and"),a&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),us.warn(o.join(" "));return}nn(new Kt(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cI="firebase-heartbeat-database",lI=1,Ma="firebase-heartbeat-store";let tu=null;function yx(){return tu||(tu=gx(cI,lI,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ma)}catch(t){console.warn(t)}}}}).catch(n=>{throw zs.create("idb-open",{originalErrorMessage:n.message})})),tu}async function uI(n){try{const t=(await yx()).transaction(Ma),s=await t.objectStore(Ma).get(_x(n));return await t.done,s}catch(e){if(e instanceof gn)us.warn(e.message);else{const t=zs.create("idb-get",{originalErrorMessage:e?.message});us.warn(t.message)}}}async function rm(n,e){try{const s=(await yx()).transaction(Ma,"readwrite");await s.objectStore(Ma).put(e,_x(n)),await s.done}catch(t){if(t instanceof gn)us.warn(t.message);else{const s=zs.create("idb-set",{originalErrorMessage:t?.message});us.warn(s.message)}}}function _x(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dI=1024,hI=30;class fI{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new pI(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=im();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>hI){const r=gI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){us.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=im(),{heartbeatsToSend:t,unsentEntries:s}=mI(this._heartbeatsCache.heartbeats),r=Ic(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return us.warn(e),""}}}function im(){return new Date().toISOString().substring(0,10)}function mI(n,e=dI){const t=[];let s=n.slice();for(const r of n){const a=t.find(o=>o.agent===r.agent);if(a){if(a.dates.push(r.date),am(t)>e){a.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),am(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class pI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return qi()?Rd().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await uI(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return rm(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return rm(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function am(n){return Ic(JSON.stringify({version:2,heartbeats:n})).length}function gI(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xI(n){nn(new Kt("platform-logger",e=>new k0(e),"PRIVATE")),nn(new Kt("heartbeat",e=>new fI(e),"PRIVATE")),St(Su,nm,n),St(Su,nm,"esm2020"),St("fire-js","")}xI("");function wx(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const yI=wx,bx=new Zs("auth","Firebase",wx());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nc=new so("@firebase/auth");function _I(n,...e){Nc.logLevel<=Ve.WARN&&Nc.warn(`Auth (${qr}): ${n}`,...e)}function ec(n,...e){Nc.logLevel<=Ve.ERROR&&Nc.error(`Auth (${qr}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qn(n,...e){throw Vd(n,...e)}function An(n,...e){return Vd(n,...e)}function Dd(n,e,t){const s={...yI(),[e]:t};return new Zs("auth","Firebase",s).create(e,{appName:n.name})}function vr(n){return Dd(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function wI(n,e,t){const s=t;if(!(e instanceof s))throw s.name!==e.constructor.name&&Qn(n,"argument-error"),Dd(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Vd(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return bx.create(n,...e)}function _e(n,e,...t){if(!n)throw Vd(e,...t)}function is(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ec(e),new Error(e)}function ds(n,e){n||is(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Du(){return typeof self<"u"&&self.location?.href||""}function bI(){return om()==="http:"||om()==="https:"}function om(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(bI()||Sd()||"connection"in navigator)?navigator.onLine:!0}function II(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class io{constructor(e,t){this.shortDelay=e,this.longDelay=t,ds(t>e,"Short delay should be less than long delay!"),this.isMobile=Jv()||Xv()}get(){return vI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ld(n,e){ds(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vx{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;is("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;is("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;is("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],EI=new io(3e4,6e4);function Od(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function zr(n,e,t,s,r={}){return Ix(n,r,async()=>{let a={},o={};s&&(e==="GET"?o=s:a={body:JSON.stringify(s)});const c=no({key:n.config.apiKey,...o}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:u,...a};return Yv()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Zn(n.emulatorConfig.host)&&(d.credentials="include"),vx.fetch()(await Tx(n,n.config.apiHost,t,c),d)})}async function Ix(n,e,t){n._canInitEmulator=!1;const s={...TI,...e};try{const r=new jI(n),a=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw Oo(n,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const c=a.ok?o.errorMessage:o.error.message,[u,d]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Oo(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw Oo(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw Oo(n,"user-disabled",o);const h=s[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Dd(n,h,d);Qn(n,h)}}catch(r){if(r instanceof gn)throw r;Qn(n,"network-request-failed",{message:String(r)})}}async function AI(n,e,t,s,r={}){const a=await zr(n,e,t,s,r);return"mfaPendingCredential"in a&&Qn(n,"multi-factor-auth-required",{_serverResponse:a}),a}async function Tx(n,e,t,s){const r=`${e}${t}?${s}`,a=n,o=a.config.emulator?Ld(n.config,r):`${n.config.apiScheme}://${r}`;return NI.includes(t)&&(await a._persistenceManagerAvailable,a._getPersistenceType()==="COOKIE")?a._getPersistence()._getFinalTarget(o).toString():o}class jI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(An(this.auth,"network-request-failed")),EI.get())})}}function Oo(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=An(n,e,s);return r.customData._tokenResponse=t,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kI(n,e){return zr(n,"POST","/v1/accounts:delete",e)}async function Ec(n,e){return zr(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ea(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function CI(n,e=!1){const t=Ge(n),s=await t.getIdToken(e),r=Md(s);_e(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const a=typeof r.firebase=="object"?r.firebase:void 0,o=a?.sign_in_provider;return{claims:r,token:s,authTime:Ea(nu(r.auth_time)),issuedAtTime:Ea(nu(r.iat)),expirationTime:Ea(nu(r.exp)),signInProvider:o||null,signInSecondFactor:a?.sign_in_second_factor||null}}function nu(n){return Number(n)*1e3}function Md(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return ec("JWT malformed, contained fewer than 3 sections"),null;try{const r=ix(t);return r?JSON.parse(r):(ec("Failed to decode base64 JWT payload"),null)}catch(r){return ec("Caught error parsing JWT payload as JSON",r?.toString()),null}}function cm(n){const e=Md(n);return _e(e,"internal-error"),_e(typeof e.exp<"u","internal-error"),_e(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ei(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof gn&&SI(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function SI({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ea(this.lastLoginAt),this.creationTime=Ea(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ac(n){const e=n.auth,t=await n.getIdToken(),s=await Ei(n,Ec(e,{idToken:t}));_e(s?.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const a=r.providerUserInfo?.length?Nx(r.providerUserInfo):[],o=DI(n.providerData,a),c=n.isAnonymous,u=!(n.email&&r.passwordHash)&&!o?.length,d=c?u:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new Vu(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(n,h)}async function PI(n){const e=Ge(n);await Ac(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function DI(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function Nx(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VI(n,e){const t=await Ix(n,{},async()=>{const s=no({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:a}=n.config,o=await Tx(n,r,"/v1/token",`key=${a}`),c=await n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:c,body:s};return n.emulatorConfig&&Zn(n.emulatorConfig.host)&&(u.credentials="include"),vx.fetch()(o,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function LI(n,e){return zr(n,"POST","/v2/accounts:revokeToken",Od(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_e(e.idToken,"internal-error"),_e(typeof e.idToken<"u","internal-error"),_e(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):cm(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){_e(e.length!==0,"internal-error");const t=cm(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(_e(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:a}=await VI(e,t);this.updateTokensAndExpiration(s,r,Number(a))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:a}=t,o=new _i;return s&&(_e(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(_e(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),a&&(_e(typeof a=="number","internal-error",{appName:e}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new _i,this.toJSON())}_performRefresh(){return is("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function As(n,e){_e(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class En{constructor({uid:e,auth:t,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new RI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Vu(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Ei(this,this.stsTokenManager.getToken(this.auth,e));return _e(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return CI(this,e)}reload(){return PI(this)}_assign(e){this!==e&&(_e(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new En({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){_e(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await Ac(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(un(this.auth.app))return Promise.reject(vr(this.auth));const e=await this.getIdToken();return await Ei(this,kI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,r=t.email??void 0,a=t.phoneNumber??void 0,o=t.photoURL??void 0,c=t.tenantId??void 0,u=t._redirectEventId??void 0,d=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:m,emailVerified:p,isAnonymous:w,providerData:v,stsTokenManager:j}=t;_e(m&&j,e,"internal-error");const k=_i.fromJSON(this.name,j);_e(typeof m=="string",e,"internal-error"),As(s,e.name),As(r,e.name),_e(typeof p=="boolean",e,"internal-error"),_e(typeof w=="boolean",e,"internal-error"),As(a,e.name),As(o,e.name),As(c,e.name),As(u,e.name),As(d,e.name),As(h,e.name);const P=new En({uid:m,auth:e,email:r,emailVerified:p,displayName:s,isAnonymous:w,photoURL:o,phoneNumber:a,tenantId:c,stsTokenManager:k,createdAt:d,lastLoginAt:h});return v&&Array.isArray(v)&&(P.providerData=v.map(R=>({...R}))),u&&(P._redirectEventId=u),P}static async _fromIdTokenResponse(e,t,s=!1){const r=new _i;r.updateFromServerResponse(t);const a=new En({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await Ac(a),a}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];_e(r.localId!==void 0,"internal-error");const a=r.providerUserInfo!==void 0?Nx(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!a?.length,c=new _i;c.updateFromIdToken(s);const u=new En({uid:r.localId,auth:e,stsTokenManager:c,isAnonymous:o}),d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Vu(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!a?.length};return Object.assign(u,d),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lm=new Map;function as(n){ds(n instanceof Function,"Expected a class definition");let e=lm.get(n);return e?(ds(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,lm.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ex{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ex.type="NONE";const um=Ex;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(n,e,t){return`firebase:${n}:${e}:${t}`}class wi{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:a}=this.auth;this.fullUserKey=tc(this.userKey,r.apiKey,a),this.fullPersistenceKey=tc("persistence",r.apiKey,a),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Ec(this.auth,{idToken:e}).catch(()=>{});return t?En._fromGetAccountInfoResponse(this.auth,t,e):null}return En._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new wi(as(um),e,s);const r=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let a=r[0]||as(um);const o=tc(s,e.config.apiKey,e.name);let c=null;for(const d of t)try{const h=await d._get(o);if(h){let m;if(typeof h=="string"){const p=await Ec(e,{idToken:h}).catch(()=>{});if(!p)break;m=await En._fromGetAccountInfoResponse(e,p,h)}else m=En._fromJSON(e,h);d!==a&&(c=m),a=d;break}}catch{}const u=r.filter(d=>d._shouldAllowMigration);return!a._shouldAllowMigration||!u.length?new wi(a,e,s):(a=u[0],c&&await a._set(o,c.toJSON()),await Promise.all(t.map(async d=>{if(d!==a)try{await d._remove(o)}catch{}})),new wi(a,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dm(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Cx(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ax(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Rx(e))return"Blackberry";if(Px(e))return"Webos";if(jx(e))return"Safari";if((e.includes("chrome/")||kx(e))&&!e.includes("edge/"))return"Chrome";if(Sx(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if(s?.length===2)return s[1]}return"Other"}function Ax(n=_t()){return/firefox\//i.test(n)}function jx(n=_t()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function kx(n=_t()){return/crios\//i.test(n)}function Cx(n=_t()){return/iemobile/i.test(n)}function Sx(n=_t()){return/android/i.test(n)}function Rx(n=_t()){return/blackberry/i.test(n)}function Px(n=_t()){return/webos/i.test(n)}function Ud(n=_t()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function OI(n=_t()){return Ud(n)&&!!window.navigator?.standalone}function MI(){return Zv()&&document.documentMode===10}function Dx(n=_t()){return Ud(n)||Sx(n)||Px(n)||Rx(n)||/windows phone/i.test(n)||Cx(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vx(n,e=[]){let t;switch(n){case"Browser":t=dm(_t());break;case"Worker":t=`${dm(_t())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${qr}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=a=>new Promise((o,c)=>{try{const u=e(a);o(u)}catch(u){c(u)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FI(n,e={}){return zr(n,"GET","/v2/passwordPolicy",Od(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BI=6;class $I{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??BI,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hm(this),this.idTokenSubscription=new hm(this),this.beforeStateQueue=new UI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bx,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=as(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await wi.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Ec(this,{idToken:e}),s=await En._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(un(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=this.redirectUser?._redirectEventId,o=s?._redirectEventId,c=await this.tryRedirectSignIn(e);(!a||a===o)&&c?.user&&(s=c.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return _e(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ac(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=II()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(un(this.app))return Promise.reject(vr(this));const t=e?Ge(e):null;return t&&_e(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&_e(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return un(this.app)?Promise.reject(vr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return un(this.app)?Promise.reject(vr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(as(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await FI(this),t=new $I(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Zs("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await LI(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&as(e)||this._popupRedirectResolver;_e(t,this,"argument-error"),this.redirectPersistenceManager=await wi.create(this,[as(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const a=typeof t=="function"?t:t.next.bind(t);let o=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(_e(c,this,"internal-error"),c.then(()=>{o||a(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,s,r);return()=>{o=!0,u()}}else{const u=e.addObserver(t);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _e(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Vx(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(un(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&_I(`Error while retrieving App Check token: ${e.error}`),e?.token}}function il(n){return Ge(n)}class hm{constructor(e){this.auth=e,this.observer=null,this.addObserver=r0(t=>this.observer=t)}get next(){return _e(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fd={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function zI(n){Fd=n}function GI(n){return Fd.loadJS(n)}function HI(){return Fd.gapiScript}function KI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WI(n,e){const t=Rn(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),a=t.getOptions();if(ls(a,e??{}))return r;Qn(r,"already-initialized")}return t.initialize({options:e})}function QI(n,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(as);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e?.popupRedirectResolver)}function JI(n,e,t){const s=il(n);_e(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,a=Lx(e),{host:o,port:c}=YI(e),u=c===null?"":`:${c}`,d={url:`${a}//${o}${u}/`},h=Object.freeze({host:o,port:c,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){_e(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),_e(ls(d,s.config.emulator)&&ls(h,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=d,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,Zn(o)?(rl(`${a}//${o}${u}`),Cd("Auth",!0)):XI()}function Lx(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function YI(n){const e=Lx(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const a=r[1];return{host:a,port:fm(s.substr(a.length+1))}}else{const[a,o]=s.split(":");return{host:a,port:fm(o)}}}function fm(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function XI(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ox{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return is("not implemented")}_getIdTokenResponse(e){return is("not implemented")}_linkToIdToken(e,t){return is("not implemented")}_getReauthenticationResolver(e){return is("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bi(n,e){return AI(n,"POST","/v1/accounts:signInWithIdp",Od(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZI="http://localhost";class kr extends Ox{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new kr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Qn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...a}=t;if(!s||!r)return null;const o=new kr(s,r);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return bi(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,bi(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,bi(e,t)}buildRequest(){const e={requestUri:ZI,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=no(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao extends Bd{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps extends ao{constructor(){super("facebook.com")}static credential(e){return kr._fromParams({providerId:Ps.PROVIDER_ID,signInMethod:Ps.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ps.credentialFromTaggedObject(e)}static credentialFromError(e){return Ps.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ps.credential(e.oauthAccessToken)}catch{return null}}}Ps.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ps.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rs extends ao{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return kr._fromParams({providerId:rs.PROVIDER_ID,signInMethod:rs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return rs.credentialFromTaggedObject(e)}static credentialFromError(e){return rs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return rs.credential(t,s)}catch{return null}}}rs.GOOGLE_SIGN_IN_METHOD="google.com";rs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds extends ao{constructor(){super("github.com")}static credential(e){return kr._fromParams({providerId:Ds.PROVIDER_ID,signInMethod:Ds.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ds.credentialFromTaggedObject(e)}static credentialFromError(e){return Ds.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ds.credential(e.oauthAccessToken)}catch{return null}}}Ds.GITHUB_SIGN_IN_METHOD="github.com";Ds.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs extends ao{constructor(){super("twitter.com")}static credential(e,t){return kr._fromParams({providerId:Vs.PROVIDER_ID,signInMethod:Vs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Vs.credentialFromTaggedObject(e)}static credentialFromError(e){return Vs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return Vs.credential(t,s)}catch{return null}}}Vs.TWITTER_SIGN_IN_METHOD="twitter.com";Vs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const a=await En._fromIdTokenResponse(e,s,r),o=mm(s);return new Ai({user:a,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=mm(s);return new Ai({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function mm(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jc extends gn{constructor(e,t,s,r){super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,jc.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new jc(e,t,s,r)}}function Mx(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?jc._fromErrorAndOperation(n,a,e,s):a})}async function eT(n,e,t=!1){const s=await Ei(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ai._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tT(n,e,t=!1){const{auth:s}=n;if(un(s.app))return Promise.reject(vr(s));const r="reauthenticate";try{const a=await Ei(n,Mx(s,r,e,n),t);_e(a.idToken,s,"internal-error");const o=Md(a.idToken);_e(o,s,"internal-error");const{sub:c}=o;return _e(n.uid===c,s,"user-mismatch"),Ai._forOperation(n,r,a)}catch(a){throw a?.code==="auth/user-not-found"&&Qn(s,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nT(n,e,t=!1){if(un(n.app))return Promise.reject(vr(n));const s="signIn",r=await Mx(n,s,e),a=await Ai._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(a.user),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sT(n,e){return zr(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rT(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const s=Ge(n),a={idToken:await s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Ei(s,sT(s.auth,a));s.displayName=o.displayName||null,s.photoURL=o.photoUrl||null;const c=s.providerData.find(({providerId:u})=>u==="password");c&&(c.displayName=s.displayName,c.photoURL=s.photoURL),await s._updateTokensIfNecessary(o)}function iT(n,e,t,s){return Ge(n).onIdTokenChanged(e,t,s)}function aT(n,e,t){return Ge(n).beforeAuthStateChanged(e,t)}function su(n){return Ge(n).signOut()}const kc="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(kc,"1"),this.storage.removeItem(kc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oT=1e3,cT=10;class Fx extends Ux{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Dx(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,c,u)=>{this.notifyListeners(o,u)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},a=this.storage.getItem(s);MI()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,cT):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},oT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Fx.type="LOCAL";const lT=Fx;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bx extends Ux{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Bx.type="SESSION";const $x=Bx;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uT(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new al(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:a}=t.data,o=this.handlersMap[r];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const c=Array.from(o).map(async d=>d(t.origin,a)),u=await uT(c);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}al.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $d(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dT{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let a,o;return new Promise((c,u)=>{const d=$d("",20);r.port1.start();const h=setTimeout(()=>{u(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(m){const p=m;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(h),a=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),c(p.data.response);break;default:clearTimeout(h),clearTimeout(a),u(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hn(){return window}function hT(n){Hn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qx(){return typeof Hn().WorkerGlobalScope<"u"&&typeof Hn().importScripts=="function"}async function fT(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function mT(){return navigator?.serviceWorker?.controller||null}function pT(){return qx()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zx="firebaseLocalStorageDb",gT=1,Cc="firebaseLocalStorage",Gx="fbase_key";class oo{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ol(n,e){return n.transaction([Cc],e?"readwrite":"readonly").objectStore(Cc)}function xT(){const n=indexedDB.deleteDatabase(zx);return new oo(n).toPromise()}function Lu(){const n=indexedDB.open(zx,gT);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Cc,{keyPath:Gx})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(Cc)?e(s):(s.close(),await xT(),e(await Lu()))})})}async function pm(n,e,t){const s=ol(n,!0).put({[Gx]:e,value:t});return new oo(s).toPromise()}async function yT(n,e){const t=ol(n,!1).get(e),s=await new oo(t).toPromise();return s===void 0?null:s.value}function gm(n,e){const t=ol(n,!0).delete(e);return new oo(t).toPromise()}const _T=800,wT=3;class Hx{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Lu(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>wT)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qx()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=al._getInstance(pT()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await fT(),!this.activeServiceWorker)return;this.sender=new dT(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||mT()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Lu();return await pm(e,kc,"1"),await gm(e,kc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>pm(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>yT(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>gm(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const a=ol(r,!1).getAll();return new oo(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:a}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(a)&&(this.notifyListeners(r,a),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_T)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Hx.type="LOCAL";const bT=Hx;new io(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kx(n,e){return e?as(e):(_e(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qd extends Ox{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return bi(e,this._buildIdpRequest())}_linkToIdToken(e,t){return bi(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return bi(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function vT(n){return nT(n.auth,new qd(n),n.bypassAuthState)}function IT(n){const{auth:e,user:t}=n;return _e(t,e,"internal-error"),tT(t,new qd(n),n.bypassAuthState)}async function TT(n){const{auth:e,user:t}=n;return _e(t,e,"internal-error"),eT(t,new qd(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{constructor(e,t,s,r,a=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:a,error:o,type:c}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:t,sessionId:s,tenantId:a||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return vT;case"linkViaPopup":case"linkViaRedirect":return TT;case"reauthViaPopup":case"reauthViaRedirect":return IT;default:Qn(this.auth,"internal-error")}}resolve(e){ds(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ds(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NT=new io(2e3,1e4);async function ET(n,e,t){if(un(n.app))return Promise.reject(An(n,"operation-not-supported-in-this-environment"));const s=il(n);wI(n,e,Bd);const r=Kx(s,t);return new yr(s,"signInViaPopup",e,r).executeNotNull()}class yr extends Wx{constructor(e,t,s,r,a){super(e,t,r,a),this.provider=s,this.authWindow=null,this.pollId=null,yr.currentPopupAction&&yr.currentPopupAction.cancel(),yr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _e(e,this.auth,"internal-error"),e}async onExecution(){ds(this.filter.length===1,"Popup operations only handle one event");const e=$d();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(An(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(An(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yr.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(An(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,NT.get())};e()}}yr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AT="pendingRedirect",nc=new Map;class jT extends Wx{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=nc.get(this.auth._key());if(!e){try{const s=await kT(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}nc.set(this.auth._key(),e)}return this.bypassAuthState||nc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function kT(n,e){const t=RT(e),s=ST(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}function CT(n,e){nc.set(n._key(),e)}function ST(n){return as(n._redirectPersistence)}function RT(n){return tc(AT,n.config.apiKey,n.name)}async function PT(n,e,t=!1){if(un(n.app))return Promise.reject(vr(n));const s=il(n),r=Kx(s,e),o=await new jT(s,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DT=600*1e3;class VT{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!LT(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Qx(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(An(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=DT&&this.cachedEventUids.clear(),this.cachedEventUids.has(xm(e))}saveEventToCache(e){this.cachedEventUids.add(xm(e)),this.lastProcessedEventTime=Date.now()}}function xm(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Qx({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function LT(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Qx(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OT(n,e={}){return zr(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,UT=/^https?/;async function FT(n){if(n.config.emulator)return;const{authorizedDomains:e}=await OT(n);for(const t of e)try{if(BT(t))return}catch{}Qn(n,"unauthorized-domain")}function BT(n){const e=Du(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!UT.test(t))return!1;if(MT.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $T=new io(3e4,6e4);function ym(){const n=Hn().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function qT(n){return new Promise((e,t)=>{function s(){ym(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ym(),t(An(n,"network-request-failed"))},timeout:$T.get()})}if(Hn().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Hn().gapi?.load)s();else{const r=KI("iframefcb");return Hn()[r]=()=>{gapi.load?s():t(An(n,"network-request-failed"))},GI(`${HI()}?onload=${r}`).catch(a=>t(a))}}).catch(e=>{throw sc=null,e})}let sc=null;function zT(n){return sc=sc||qT(n),sc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GT=new io(5e3,15e3),HT="__/auth/iframe",KT="emulator/auth/iframe",WT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},QT=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function JT(n){const e=n.config;_e(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Ld(e,KT):`https://${n.config.authDomain}/${HT}`,s={apiKey:e.apiKey,appName:n.name,v:qr},r=QT.get(n.config.apiHost);r&&(s.eid=r);const a=n._getFrameworks();return a.length&&(s.fw=a.join(",")),`${t}?${no(s).slice(1)}`}async function YT(n){const e=await zT(n),t=Hn().gapi;return _e(t,n,"internal-error"),e.open({where:document.body,url:JT(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:WT,dontclear:!0},s=>new Promise(async(r,a)=>{await s.restyle({setHideOnLeave:!1});const o=An(n,"network-request-failed"),c=Hn().setTimeout(()=>{a(o)},GT.get());function u(){Hn().clearTimeout(c),r(s)}s.ping(u).then(u,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XT={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ZT=500,eN=600,tN="_blank",nN="http://localhost";class _m{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function sN(n,e,t,s=ZT,r=eN){const a=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let c="";const u={...XT,width:s.toString(),height:r.toString(),top:a,left:o},d=_t().toLowerCase();t&&(c=kx(d)?tN:t),Ax(d)&&(e=e||nN,u.scrollbars="yes");const h=Object.entries(u).reduce((p,[w,v])=>`${p}${w}=${v},`,"");if(OI(d)&&c!=="_self")return rN(e||"",c),new _m(null);const m=window.open(e||"",c,h);_e(m,n,"popup-blocked");try{m.focus()}catch{}return new _m(m)}function rN(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iN="__/auth/handler",aN="emulator/auth/handler",oN=encodeURIComponent("fac");async function wm(n,e,t,s,r,a){_e(n.config.authDomain,n,"auth-domain-config-required"),_e(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:qr,eventId:r};if(e instanceof Bd){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",s0(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,m]of Object.entries({}))o[h]=m}if(e instanceof ao){const h=e.getScopes().filter(m=>m!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const c=o;for(const h of Object.keys(c))c[h]===void 0&&delete c[h];const u=await n._getAppCheckToken(),d=u?`#${oN}=${encodeURIComponent(u)}`:"";return`${cN(n)}?${no(c).slice(1)}${d}`}function cN({config:n}){return n.emulator?Ld(n,aN):`https://${n.authDomain}/${iN}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ru="webStorageSupport";class lN{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=$x,this._completeRedirectFn=PT,this._overrideRedirectResult=CT}async _openPopup(e,t,s,r){ds(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const a=await wm(e,t,s,Du(),r);return sN(e,a,$d())}async _openRedirect(e,t,s,r){await this._originValidation(e);const a=await wm(e,t,s,Du(),r);return hT(a),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:a}=this.eventManagers[t];return r?Promise.resolve(r):(ds(a,"If manager is not set, promise should be"),a)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await YT(e),s=new VT(e);return t.register("authEvent",r=>(_e(r?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ru,{type:ru},r=>{const a=r?.[0]?.[ru];a!==void 0&&t(!!a),Qn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=FT(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Dx()||jx()||Ud()}}const uN=lN;var bm="@firebase/auth",vm="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dN{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){_e(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hN(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function fN(n){nn(new Kt("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=s.options;_e(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const u={apiKey:o,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Vx(n)},d=new qI(s,r,a,u);return QI(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),nn(new Kt("auth-internal",e=>{const t=il(e.getProvider("auth").getImmediate());return(s=>new dN(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),St(bm,vm,hN(n)),St(bm,vm,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mN=300,pN=lx("authIdTokenMaxAge")||mN;let Im=null;const gN=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>pN)return;const r=t?.token;Im!==r&&(Im=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function xN(n=ro()){const e=Rn(n,"auth");if(e.isInitialized())return e.getImmediate();const t=WI(n,{popupRedirectResolver:uN,persistence:[bT,lT,$x]}),s=lx("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(s,location.origin);if(location.origin===a.origin){const o=gN(a.toString());aT(t,o,()=>o(t.currentUser)),iT(t,c=>o(c))}}const r=ax("auth");return r&&JI(t,`http://${r}`),t}function yN(){return document.getElementsByTagName("head")?.[0]??document}zI({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const a=An("internal-error");a.customData=r,t(a)},s.type="text/javascript",s.charset="UTF-8",yN().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});fN("Browser");var _N="firebase",wN="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */St(_N,wN,"app");var Tm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Gs,Jx;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(_,y){function b(){}b.prototype=y.prototype,_.F=y.prototype,_.prototype=new b,_.prototype.constructor=_,_.D=function(I,T,A){for(var N=Array(arguments.length-2),F=2;F<arguments.length;F++)N[F-2]=arguments[F];return y.prototype[T].apply(I,N)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(_,y,b){b||(b=0);const I=Array(16);if(typeof y=="string")for(var T=0;T<16;++T)I[T]=y.charCodeAt(b++)|y.charCodeAt(b++)<<8|y.charCodeAt(b++)<<16|y.charCodeAt(b++)<<24;else for(T=0;T<16;++T)I[T]=y[b++]|y[b++]<<8|y[b++]<<16|y[b++]<<24;y=_.g[0],b=_.g[1],T=_.g[2];let A=_.g[3],N;N=y+(A^b&(T^A))+I[0]+3614090360&4294967295,y=b+(N<<7&4294967295|N>>>25),N=A+(T^y&(b^T))+I[1]+3905402710&4294967295,A=y+(N<<12&4294967295|N>>>20),N=T+(b^A&(y^b))+I[2]+606105819&4294967295,T=A+(N<<17&4294967295|N>>>15),N=b+(y^T&(A^y))+I[3]+3250441966&4294967295,b=T+(N<<22&4294967295|N>>>10),N=y+(A^b&(T^A))+I[4]+4118548399&4294967295,y=b+(N<<7&4294967295|N>>>25),N=A+(T^y&(b^T))+I[5]+1200080426&4294967295,A=y+(N<<12&4294967295|N>>>20),N=T+(b^A&(y^b))+I[6]+2821735955&4294967295,T=A+(N<<17&4294967295|N>>>15),N=b+(y^T&(A^y))+I[7]+4249261313&4294967295,b=T+(N<<22&4294967295|N>>>10),N=y+(A^b&(T^A))+I[8]+1770035416&4294967295,y=b+(N<<7&4294967295|N>>>25),N=A+(T^y&(b^T))+I[9]+2336552879&4294967295,A=y+(N<<12&4294967295|N>>>20),N=T+(b^A&(y^b))+I[10]+4294925233&4294967295,T=A+(N<<17&4294967295|N>>>15),N=b+(y^T&(A^y))+I[11]+2304563134&4294967295,b=T+(N<<22&4294967295|N>>>10),N=y+(A^b&(T^A))+I[12]+1804603682&4294967295,y=b+(N<<7&4294967295|N>>>25),N=A+(T^y&(b^T))+I[13]+4254626195&4294967295,A=y+(N<<12&4294967295|N>>>20),N=T+(b^A&(y^b))+I[14]+2792965006&4294967295,T=A+(N<<17&4294967295|N>>>15),N=b+(y^T&(A^y))+I[15]+1236535329&4294967295,b=T+(N<<22&4294967295|N>>>10),N=y+(T^A&(b^T))+I[1]+4129170786&4294967295,y=b+(N<<5&4294967295|N>>>27),N=A+(b^T&(y^b))+I[6]+3225465664&4294967295,A=y+(N<<9&4294967295|N>>>23),N=T+(y^b&(A^y))+I[11]+643717713&4294967295,T=A+(N<<14&4294967295|N>>>18),N=b+(A^y&(T^A))+I[0]+3921069994&4294967295,b=T+(N<<20&4294967295|N>>>12),N=y+(T^A&(b^T))+I[5]+3593408605&4294967295,y=b+(N<<5&4294967295|N>>>27),N=A+(b^T&(y^b))+I[10]+38016083&4294967295,A=y+(N<<9&4294967295|N>>>23),N=T+(y^b&(A^y))+I[15]+3634488961&4294967295,T=A+(N<<14&4294967295|N>>>18),N=b+(A^y&(T^A))+I[4]+3889429448&4294967295,b=T+(N<<20&4294967295|N>>>12),N=y+(T^A&(b^T))+I[9]+568446438&4294967295,y=b+(N<<5&4294967295|N>>>27),N=A+(b^T&(y^b))+I[14]+3275163606&4294967295,A=y+(N<<9&4294967295|N>>>23),N=T+(y^b&(A^y))+I[3]+4107603335&4294967295,T=A+(N<<14&4294967295|N>>>18),N=b+(A^y&(T^A))+I[8]+1163531501&4294967295,b=T+(N<<20&4294967295|N>>>12),N=y+(T^A&(b^T))+I[13]+2850285829&4294967295,y=b+(N<<5&4294967295|N>>>27),N=A+(b^T&(y^b))+I[2]+4243563512&4294967295,A=y+(N<<9&4294967295|N>>>23),N=T+(y^b&(A^y))+I[7]+1735328473&4294967295,T=A+(N<<14&4294967295|N>>>18),N=b+(A^y&(T^A))+I[12]+2368359562&4294967295,b=T+(N<<20&4294967295|N>>>12),N=y+(b^T^A)+I[5]+4294588738&4294967295,y=b+(N<<4&4294967295|N>>>28),N=A+(y^b^T)+I[8]+2272392833&4294967295,A=y+(N<<11&4294967295|N>>>21),N=T+(A^y^b)+I[11]+1839030562&4294967295,T=A+(N<<16&4294967295|N>>>16),N=b+(T^A^y)+I[14]+4259657740&4294967295,b=T+(N<<23&4294967295|N>>>9),N=y+(b^T^A)+I[1]+2763975236&4294967295,y=b+(N<<4&4294967295|N>>>28),N=A+(y^b^T)+I[4]+1272893353&4294967295,A=y+(N<<11&4294967295|N>>>21),N=T+(A^y^b)+I[7]+4139469664&4294967295,T=A+(N<<16&4294967295|N>>>16),N=b+(T^A^y)+I[10]+3200236656&4294967295,b=T+(N<<23&4294967295|N>>>9),N=y+(b^T^A)+I[13]+681279174&4294967295,y=b+(N<<4&4294967295|N>>>28),N=A+(y^b^T)+I[0]+3936430074&4294967295,A=y+(N<<11&4294967295|N>>>21),N=T+(A^y^b)+I[3]+3572445317&4294967295,T=A+(N<<16&4294967295|N>>>16),N=b+(T^A^y)+I[6]+76029189&4294967295,b=T+(N<<23&4294967295|N>>>9),N=y+(b^T^A)+I[9]+3654602809&4294967295,y=b+(N<<4&4294967295|N>>>28),N=A+(y^b^T)+I[12]+3873151461&4294967295,A=y+(N<<11&4294967295|N>>>21),N=T+(A^y^b)+I[15]+530742520&4294967295,T=A+(N<<16&4294967295|N>>>16),N=b+(T^A^y)+I[2]+3299628645&4294967295,b=T+(N<<23&4294967295|N>>>9),N=y+(T^(b|~A))+I[0]+4096336452&4294967295,y=b+(N<<6&4294967295|N>>>26),N=A+(b^(y|~T))+I[7]+1126891415&4294967295,A=y+(N<<10&4294967295|N>>>22),N=T+(y^(A|~b))+I[14]+2878612391&4294967295,T=A+(N<<15&4294967295|N>>>17),N=b+(A^(T|~y))+I[5]+4237533241&4294967295,b=T+(N<<21&4294967295|N>>>11),N=y+(T^(b|~A))+I[12]+1700485571&4294967295,y=b+(N<<6&4294967295|N>>>26),N=A+(b^(y|~T))+I[3]+2399980690&4294967295,A=y+(N<<10&4294967295|N>>>22),N=T+(y^(A|~b))+I[10]+4293915773&4294967295,T=A+(N<<15&4294967295|N>>>17),N=b+(A^(T|~y))+I[1]+2240044497&4294967295,b=T+(N<<21&4294967295|N>>>11),N=y+(T^(b|~A))+I[8]+1873313359&4294967295,y=b+(N<<6&4294967295|N>>>26),N=A+(b^(y|~T))+I[15]+4264355552&4294967295,A=y+(N<<10&4294967295|N>>>22),N=T+(y^(A|~b))+I[6]+2734768916&4294967295,T=A+(N<<15&4294967295|N>>>17),N=b+(A^(T|~y))+I[13]+1309151649&4294967295,b=T+(N<<21&4294967295|N>>>11),N=y+(T^(b|~A))+I[4]+4149444226&4294967295,y=b+(N<<6&4294967295|N>>>26),N=A+(b^(y|~T))+I[11]+3174756917&4294967295,A=y+(N<<10&4294967295|N>>>22),N=T+(y^(A|~b))+I[2]+718787259&4294967295,T=A+(N<<15&4294967295|N>>>17),N=b+(A^(T|~y))+I[9]+3951481745&4294967295,_.g[0]=_.g[0]+y&4294967295,_.g[1]=_.g[1]+(T+(N<<21&4294967295|N>>>11))&4294967295,_.g[2]=_.g[2]+T&4294967295,_.g[3]=_.g[3]+A&4294967295}s.prototype.v=function(_,y){y===void 0&&(y=_.length);const b=y-this.blockSize,I=this.C;let T=this.h,A=0;for(;A<y;){if(T==0)for(;A<=b;)r(this,_,A),A+=this.blockSize;if(typeof _=="string"){for(;A<y;)if(I[T++]=_.charCodeAt(A++),T==this.blockSize){r(this,I),T=0;break}}else for(;A<y;)if(I[T++]=_[A++],T==this.blockSize){r(this,I),T=0;break}}this.h=T,this.o+=y},s.prototype.A=function(){var _=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);_[0]=128;for(var y=1;y<_.length-8;++y)_[y]=0;y=this.o*8;for(var b=_.length-8;b<_.length;++b)_[b]=y&255,y/=256;for(this.v(_),_=Array(16),y=0,b=0;b<4;++b)for(let I=0;I<32;I+=8)_[y++]=this.g[b]>>>I&255;return _};function a(_,y){var b=c;return Object.prototype.hasOwnProperty.call(b,_)?b[_]:b[_]=y(_)}function o(_,y){this.h=y;const b=[];let I=!0;for(let T=_.length-1;T>=0;T--){const A=_[T]|0;I&&A==y||(b[T]=A,I=!1)}this.g=b}var c={};function u(_){return-128<=_&&_<128?a(_,function(y){return new o([y|0],y<0?-1:0)}):new o([_|0],_<0?-1:0)}function d(_){if(isNaN(_)||!isFinite(_))return m;if(_<0)return k(d(-_));const y=[];let b=1;for(let I=0;_>=b;I++)y[I]=_/b|0,b*=4294967296;return new o(y,0)}function h(_,y){if(_.length==0)throw Error("number format error: empty string");if(y=y||10,y<2||36<y)throw Error("radix out of range: "+y);if(_.charAt(0)=="-")return k(h(_.substring(1),y));if(_.indexOf("-")>=0)throw Error('number format error: interior "-" character');const b=d(Math.pow(y,8));let I=m;for(let A=0;A<_.length;A+=8){var T=Math.min(8,_.length-A);const N=parseInt(_.substring(A,A+T),y);T<8?(T=d(Math.pow(y,T)),I=I.j(T).add(d(N))):(I=I.j(b),I=I.add(d(N)))}return I}var m=u(0),p=u(1),w=u(16777216);n=o.prototype,n.m=function(){if(j(this))return-k(this).m();let _=0,y=1;for(let b=0;b<this.g.length;b++){const I=this.i(b);_+=(I>=0?I:4294967296+I)*y,y*=4294967296}return _},n.toString=function(_){if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(v(this))return"0";if(j(this))return"-"+k(this).toString(_);const y=d(Math.pow(_,6));var b=this;let I="";for(;;){const T=S(b,y).g;b=P(b,T.j(y));let A=((b.g.length>0?b.g[0]:b.h)>>>0).toString(_);if(b=T,v(b))return A+I;for(;A.length<6;)A="0"+A;I=A+I}},n.i=function(_){return _<0?0:_<this.g.length?this.g[_]:this.h};function v(_){if(_.h!=0)return!1;for(let y=0;y<_.g.length;y++)if(_.g[y]!=0)return!1;return!0}function j(_){return _.h==-1}n.l=function(_){return _=P(this,_),j(_)?-1:v(_)?0:1};function k(_){const y=_.g.length,b=[];for(let I=0;I<y;I++)b[I]=~_.g[I];return new o(b,~_.h).add(p)}n.abs=function(){return j(this)?k(this):this},n.add=function(_){const y=Math.max(this.g.length,_.g.length),b=[];let I=0;for(let T=0;T<=y;T++){let A=I+(this.i(T)&65535)+(_.i(T)&65535),N=(A>>>16)+(this.i(T)>>>16)+(_.i(T)>>>16);I=N>>>16,A&=65535,N&=65535,b[T]=N<<16|A}return new o(b,b[b.length-1]&-2147483648?-1:0)};function P(_,y){return _.add(k(y))}n.j=function(_){if(v(this)||v(_))return m;if(j(this))return j(_)?k(this).j(k(_)):k(k(this).j(_));if(j(_))return k(this.j(k(_)));if(this.l(w)<0&&_.l(w)<0)return d(this.m()*_.m());const y=this.g.length+_.g.length,b=[];for(var I=0;I<2*y;I++)b[I]=0;for(I=0;I<this.g.length;I++)for(let T=0;T<_.g.length;T++){const A=this.i(I)>>>16,N=this.i(I)&65535,F=_.i(T)>>>16,Z=_.i(T)&65535;b[2*I+2*T]+=N*Z,R(b,2*I+2*T),b[2*I+2*T+1]+=A*Z,R(b,2*I+2*T+1),b[2*I+2*T+1]+=N*F,R(b,2*I+2*T+1),b[2*I+2*T+2]+=A*F,R(b,2*I+2*T+2)}for(_=0;_<y;_++)b[_]=b[2*_+1]<<16|b[2*_];for(_=y;_<2*y;_++)b[_]=0;return new o(b,0)};function R(_,y){for(;(_[y]&65535)!=_[y];)_[y+1]+=_[y]>>>16,_[y]&=65535,y++}function C(_,y){this.g=_,this.h=y}function S(_,y){if(v(y))throw Error("division by zero");if(v(_))return new C(m,m);if(j(_))return y=S(k(_),y),new C(k(y.g),k(y.h));if(j(y))return y=S(_,k(y)),new C(k(y.g),y.h);if(_.g.length>30){if(j(_)||j(y))throw Error("slowDivide_ only works with positive integers.");for(var b=p,I=y;I.l(_)<=0;)b=D(b),I=D(I);var T=M(b,1),A=M(I,1);for(I=M(I,2),b=M(b,2);!v(I);){var N=A.add(I);N.l(_)<=0&&(T=T.add(b),A=N),I=M(I,1),b=M(b,1)}return y=P(_,T.j(y)),new C(T,y)}for(T=m;_.l(y)>=0;){for(b=Math.max(1,Math.floor(_.m()/y.m())),I=Math.ceil(Math.log(b)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),A=d(b),N=A.j(y);j(N)||N.l(_)>0;)b-=I,A=d(b),N=A.j(y);v(A)&&(A=p),T=T.add(A),_=P(_,N)}return new C(T,_)}n.B=function(_){return S(this,_).h},n.and=function(_){const y=Math.max(this.g.length,_.g.length),b=[];for(let I=0;I<y;I++)b[I]=this.i(I)&_.i(I);return new o(b,this.h&_.h)},n.or=function(_){const y=Math.max(this.g.length,_.g.length),b=[];for(let I=0;I<y;I++)b[I]=this.i(I)|_.i(I);return new o(b,this.h|_.h)},n.xor=function(_){const y=Math.max(this.g.length,_.g.length),b=[];for(let I=0;I<y;I++)b[I]=this.i(I)^_.i(I);return new o(b,this.h^_.h)};function D(_){const y=_.g.length+1,b=[];for(let I=0;I<y;I++)b[I]=_.i(I)<<1|_.i(I-1)>>>31;return new o(b,_.h)}function M(_,y){const b=y>>5;y%=32;const I=_.g.length-b,T=[];for(let A=0;A<I;A++)T[A]=y>0?_.i(A+b)>>>y|_.i(A+b+1)<<32-y:_.i(A+b);return new o(T,_.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Jx=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=h,Gs=o}).apply(typeof Tm<"u"?Tm:typeof self<"u"?self:typeof window<"u"?window:{});var Mo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Yx,xa,Xx,rc,Ou,Zx,ey,ty;(function(){var n,e=Object.defineProperty;function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Mo=="object"&&Mo];for(var f=0;f<l.length;++f){var g=l[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var s=t(this);function r(l,f){if(f)e:{var g=s;l=l.split(".");for(var E=0;E<l.length-1;E++){var L=l[E];if(!(L in g))break e;g=g[L]}l=l[l.length-1],E=g[l],f=f(E),f!=E&&f!=null&&e(g,l,{configurable:!0,writable:!0,value:f})}}r("Symbol.dispose",function(l){return l||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(l){return l||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(l){return l||function(f){var g=[],E;for(E in f)Object.prototype.hasOwnProperty.call(f,E)&&g.push([E,f[E]]);return g}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},o=this||self;function c(l){var f=typeof l;return f=="object"&&l!=null||f=="function"}function u(l,f,g){return l.call.apply(l.bind,arguments)}function d(l,f,g){return d=u,d.apply(null,arguments)}function h(l,f){var g=Array.prototype.slice.call(arguments,1);return function(){var E=g.slice();return E.push.apply(E,arguments),l.apply(this,E)}}function m(l,f){function g(){}g.prototype=f.prototype,l.Z=f.prototype,l.prototype=new g,l.prototype.constructor=l,l.Ob=function(E,L,U){for(var Q=Array(arguments.length-2),Ce=2;Ce<arguments.length;Ce++)Q[Ce-2]=arguments[Ce];return f.prototype[L].apply(E,Q)}}var p=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?l=>l&&AsyncContext.Snapshot.wrap(l):l=>l;function w(l){const f=l.length;if(f>0){const g=Array(f);for(let E=0;E<f;E++)g[E]=l[E];return g}return[]}function v(l,f){for(let E=1;E<arguments.length;E++){const L=arguments[E];var g=typeof L;if(g=g!="object"?g:L?Array.isArray(L)?"array":g:"null",g=="array"||g=="object"&&typeof L.length=="number"){g=l.length||0;const U=L.length||0;l.length=g+U;for(let Q=0;Q<U;Q++)l[g+Q]=L[Q]}else l.push(L)}}class j{constructor(f,g){this.i=f,this.j=g,this.h=0,this.g=null}get(){let f;return this.h>0?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function k(l){o.setTimeout(()=>{throw l},0)}function P(){var l=_;let f=null;return l.g&&(f=l.g,l.g=l.g.next,l.g||(l.h=null),f.next=null),f}class R{constructor(){this.h=this.g=null}add(f,g){const E=C.get();E.set(f,g),this.h?this.h.next=E:this.g=E,this.h=E}}var C=new j(()=>new S,l=>l.reset());class S{constructor(){this.next=this.g=this.h=null}set(f,g){this.h=f,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let D,M=!1,_=new R,y=()=>{const l=Promise.resolve(void 0);D=()=>{l.then(b)}};function b(){for(var l;l=P();){try{l.h.call(l.g)}catch(g){k(g)}var f=C;f.j(l),f.h<100&&(f.h++,l.next=f.g,f.g=l)}M=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(l,f){this.type=l,this.g=this.target=f,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var l=!1,f=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const g=()=>{};o.addEventListener("test",g,f),o.removeEventListener("test",g,f)}catch{}return l})();function N(l){return/^[\s\xa0]*$/.test(l)}function F(l,f){T.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l&&this.init(l,f)}m(F,T),F.prototype.init=function(l,f){const g=this.type=l.type,E=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;this.target=l.target||l.srcElement,this.g=f,f=l.relatedTarget,f||(g=="mouseover"?f=l.fromElement:g=="mouseout"&&(f=l.toElement)),this.relatedTarget=f,E?(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=l.pointerType,this.state=l.state,this.i=l,l.defaultPrevented&&F.Z.h.call(this)},F.prototype.h=function(){F.Z.h.call(this);const l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Z="closure_listenable_"+(Math.random()*1e6|0),Ee=0;function xe(l,f,g,E,L){this.listener=l,this.proxy=null,this.src=f,this.type=g,this.capture=!!E,this.ha=L,this.key=++Ee,this.da=this.fa=!1}function K(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function ee(l,f,g){for(const E in l)f.call(g,l[E],E,l)}function oe(l,f){for(const g in l)f.call(void 0,l[g],g,l)}function Ae(l){const f={};for(const g in l)f[g]=l[g];return f}const je="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ke(l,f){let g,E;for(let L=1;L<arguments.length;L++){E=arguments[L];for(g in E)l[g]=E[g];for(let U=0;U<je.length;U++)g=je[U],Object.prototype.hasOwnProperty.call(E,g)&&(l[g]=E[g])}}function De(l){this.src=l,this.g={},this.h=0}De.prototype.add=function(l,f,g,E,L){const U=l.toString();l=this.g[U],l||(l=this.g[U]=[],this.h++);const Q=Me(l,f,E,L);return Q>-1?(f=l[Q],g||(f.fa=!1)):(f=new xe(f,this.src,U,!!E,L),f.fa=g,l.push(f)),f};function Re(l,f){const g=f.type;if(g in l.g){var E=l.g[g],L=Array.prototype.indexOf.call(E,f,void 0),U;(U=L>=0)&&Array.prototype.splice.call(E,L,1),U&&(K(f),l.g[g].length==0&&(delete l.g[g],l.h--))}}function Me(l,f,g,E){for(let L=0;L<l.length;++L){const U=l[L];if(!U.da&&U.listener==f&&U.capture==!!g&&U.ha==E)return L}return-1}var se="closure_lm_"+(Math.random()*1e6|0),Ue={};function He(l,f,g,E,L){if(Array.isArray(f)){for(let U=0;U<f.length;U++)He(l,f[U],g,E,L);return null}return g=W(g),l&&l[Z]?l.J(f,g,c(E)?!!E.capture:!1,L):Rt(l,f,g,!1,E,L)}function Rt(l,f,g,E,L,U){if(!f)throw Error("Invalid event type");const Q=c(L)?!!L.capture:!!L;let Ce=pe(l);if(Ce||(l[se]=Ce=new De(l)),g=Ce.add(f,g,E,Q,U),g.proxy)return g;if(E=Oe(),g.proxy=E,E.src=l,E.listener=g,l.addEventListener)A||(L=Q),L===void 0&&(L=!1),l.addEventListener(f.toString(),E,L);else if(l.attachEvent)l.attachEvent(re(f.toString()),E);else if(l.addListener&&l.removeListener)l.addListener(E);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Oe(){function l(g){return f.call(l.src,l.listener,g)}const f=de;return l}function O(l,f,g,E,L){if(Array.isArray(f))for(var U=0;U<f.length;U++)O(l,f[U],g,E,L);else E=c(E)?!!E.capture:!!E,g=W(g),l&&l[Z]?(l=l.i,U=String(f).toString(),U in l.g&&(f=l.g[U],g=Me(f,g,E,L),g>-1&&(K(f[g]),Array.prototype.splice.call(f,g,1),f.length==0&&(delete l.g[U],l.h--)))):l&&(l=pe(l))&&(f=l.g[f.toString()],l=-1,f&&(l=Me(f,g,E,L)),(g=l>-1?f[l]:null)&&ue(g))}function ue(l){if(typeof l!="number"&&l&&!l.da){var f=l.src;if(f&&f[Z])Re(f.i,l);else{var g=l.type,E=l.proxy;f.removeEventListener?f.removeEventListener(g,E,l.capture):f.detachEvent?f.detachEvent(re(g),E):f.addListener&&f.removeListener&&f.removeListener(E),(g=pe(f))?(Re(g,l),g.h==0&&(g.src=null,f[se]=null)):K(l)}}}function re(l){return l in Ue?Ue[l]:Ue[l]="on"+l}function de(l,f){if(l.da)l=!0;else{f=new F(f,this);const g=l.listener,E=l.ha||l.src;l.fa&&ue(l),l=g.call(E,f)}return l}function pe(l){return l=l[se],l instanceof De?l:null}var Ke="__closure_events_fn_"+(Math.random()*1e9>>>0);function W(l){return typeof l=="function"?l:(l[Ke]||(l[Ke]=function(f){return l.handleEvent(f)}),l[Ke])}function he(){I.call(this),this.i=new De(this),this.M=this,this.G=null}m(he,I),he.prototype[Z]=!0,he.prototype.removeEventListener=function(l,f,g,E){O(this,l,f,g,E)};function Be(l,f){var g,E=l.G;if(E)for(g=[];E;E=E.G)g.push(E);if(l=l.M,E=f.type||f,typeof f=="string")f=new T(f,l);else if(f instanceof T)f.target=f.target||l;else{var L=f;f=new T(E,l),ke(f,L)}L=!0;let U,Q;if(g)for(Q=g.length-1;Q>=0;Q--)U=f.g=g[Q],L=Pt(U,E,!0,f)&&L;if(U=f.g=l,L=Pt(U,E,!0,f)&&L,L=Pt(U,E,!1,f)&&L,g)for(Q=0;Q<g.length;Q++)U=f.g=g[Q],L=Pt(U,E,!1,f)&&L}he.prototype.N=function(){if(he.Z.N.call(this),this.i){var l=this.i;for(const f in l.g){const g=l.g[f];for(let E=0;E<g.length;E++)K(g[E]);delete l.g[f],l.h--}}this.G=null},he.prototype.J=function(l,f,g,E){return this.i.add(String(l),f,!1,g,E)},he.prototype.K=function(l,f,g,E){return this.i.add(String(l),f,!0,g,E)};function Pt(l,f,g,E){if(f=l.i.g[String(f)],!f)return!0;f=f.concat();let L=!0;for(let U=0;U<f.length;++U){const Q=f[U];if(Q&&!Q.da&&Q.capture==g){const Ce=Q.listener,xt=Q.ha||Q.src;Q.fa&&Re(l.i,Q),L=Ce.call(xt,E)!==!1&&L}}return L&&!E.defaultPrevented}function Pn(l,f){if(typeof l!="function")if(l&&typeof l.handleEvent=="function")l=d(l.handleEvent,l);else throw Error("Invalid listener argument");return Number(f)>2147483647?-1:o.setTimeout(l,f||0)}function Dn(l){l.g=Pn(()=>{l.g=null,l.i&&(l.i=!1,Dn(l))},l.l);const f=l.h;l.h=null,l.m.apply(null,f)}class es extends I{constructor(f,g){super(),this.m=f,this.l=g,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:Dn(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ht(l){I.call(this),this.h=l,this.g={}}m(ht,I);var ze=[];function ts(l){ee(l.g,function(f,g){this.g.hasOwnProperty(g)&&ue(f)},l),l.g={}}ht.prototype.N=function(){ht.Z.N.call(this),ts(this)},ht.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ys=o.JSON.stringify,Yi=o.JSON.parse,Xi=class{stringify(l){return o.JSON.stringify(l,void 0)}parse(l){return o.JSON.parse(l,void 0)}};function ns(){}function nr(){}var In={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function sr(){T.call(this,"d")}m(sr,T);function Vn(){T.call(this,"c")}m(Vn,T);var tt={},_s=null;function xn(){return _s=_s||new he}tt.Ia="serverreachability";function gt(l){T.call(this,tt.Ia,l)}m(gt,T);function te(l){const f=xn();Be(f,new gt(f))}tt.STAT_EVENT="statevent";function Te(l,f){T.call(this,tt.STAT_EVENT,l),this.stat=f}m(Te,T);function Pe(l){const f=xn();Be(f,new Te(f,l))}tt.Ja="timingevent";function yn(l,f){T.call(this,tt.Ja,l),this.size=f}m(yn,T);function rr(l,f){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){l()},f)}function ws(){this.g=!0}ws.prototype.ua=function(){this.g=!1};function Qr(l,f,g,E,L,U){l.info(function(){if(l.g)if(U){var Q="",Ce=U.split("&");for(let Xe=0;Xe<Ce.length;Xe++){var xt=Ce[Xe].split("=");if(xt.length>1){const bt=xt[0];xt=xt[1];const On=bt.split("_");Q=On.length>=2&&On[1]=="type"?Q+(bt+"="+xt+"&"):Q+(bt+"=redacted&")}}}else Q=null;else Q=U;return"XMLHTTP REQ ("+E+") [attempt "+L+"]: "+f+`
`+g+`
`+Q})}function Zi(l,f,g,E,L,U,Q){l.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+L+"]: "+f+`
`+g+`
`+U+" "+Q})}function Dt(l,f,g,E){l.info(function(){return"XMLHTTP TEXT ("+f+"): "+At(l,g)+(E?" "+E:"")})}function bs(l,f){l.info(function(){return"TIMEOUT: "+f})}ws.prototype.info=function(){};function At(l,f){if(!l.g)return f;if(!f)return null;try{const U=JSON.parse(f);if(U){for(l=0;l<U.length;l++)if(Array.isArray(U[l])){var g=U[l];if(!(g.length<2)){var E=g[1];if(Array.isArray(E)&&!(E.length<1)){var L=E[0];if(L!="noop"&&L!="stop"&&L!="close")for(let Q=1;Q<E.length;Q++)E[Q]=""}}}}return ys(U)}catch{return f}}var ir={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Wt={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Qt;function Ft(){}m(Ft,ns),Ft.prototype.g=function(){return new XMLHttpRequest},Qt=new Ft;function Vt(l){return encodeURIComponent(String(l))}function Ml(l){var f=1;l=l.split(":");const g=[];for(;f>0&&l.length;)g.push(l.shift()),f--;return l.length&&g.push(l.join(":")),g}function _n(l,f,g,E){this.j=l,this.i=f,this.l=g,this.S=E||1,this.V=new ht(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Jr}function Jr(){this.i=null,this.g="",this.h=!1}var Bt={},ea={};function Yr(l,f,g){l.M=1,l.A=ko(Ln(f)),l.u=g,l.R=!0,jo(l,null)}function jo(l,f){l.F=Date.now(),Ze(l),l.B=Ln(l.A);var g=l.B,E=l.S;Array.isArray(E)||(E=[String(E)]),If(g.i,"t",E),l.C=0,g=l.j.L,l.h=new Jr,l.g=Bf(l.j,g?f:null,!l.u),l.P>0&&(l.O=new es(d(l.Y,l,l.g),l.P)),f=l.V,g=l.g,E=l.ba;var L="readystatechange";Array.isArray(L)||(L&&(ze[0]=L.toString()),L=ze);for(let U=0;U<L.length;U++){const Q=He(g,L[U],E||f.handleEvent,!1,f.h||f);if(!Q)break;f.g[Q.key]=Q}f=l.J?Ae(l.J):{},l.u?(l.v||(l.v="POST"),f["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.B,l.v,l.u,f)):(l.v="GET",l.g.ea(l.B,l.v,null,f)),te(),Qr(l.i,l.v,l.B,l.l,l.S,l.u)}_n.prototype.ba=function(l){l=l.target;const f=this.O;f&&Ts(l)==3?f.j():this.Y(l)},_n.prototype.Y=function(l){try{if(l==this.g)e:{const Ce=Ts(this.g),xt=this.g.ya(),Xe=this.g.ca();if(!(Ce<3)&&(Ce!=3||this.g&&(this.h.h||this.g.la()||Cf(this.g)))){this.K||Ce!=4||xt==7||(xt==8||Xe<=0?te(3):te(2)),Tn(this);var f=this.g.ca();this.X=f;var g=X(this);if(this.o=f==200,Zi(this.i,this.v,this.B,this.l,this.S,Ce,f),this.o){if(this.U&&!this.L){t:{if(this.g){var E,L=this.g;if((E=L.g?L.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(E)){var U=E;break t}}U=null}if(l=U)Dt(this.i,this.l,l,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ar(this,l);else{this.o=!1,this.m=3,Pe(12),on(this),Jt(this);break e}}if(this.R){l=!0;let bt;for(;!this.K&&this.C<g.length;)if(bt=ve(this,g),bt==ea){Ce==4&&(this.m=4,Pe(14),l=!1),Dt(this.i,this.l,null,"[Incomplete Response]");break}else if(bt==Bt){this.m=4,Pe(15),Dt(this.i,this.l,g,"[Invalid Chunk]"),l=!1;break}else Dt(this.i,this.l,bt,null),ar(this,bt);if(ce(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ce!=4||g.length!=0||this.h.h||(this.m=1,Pe(16),l=!1),this.o=this.o&&l,!l)Dt(this.i,this.l,g,"[Invalid Chunked Response]"),on(this),Jt(this);else if(g.length>0&&!this.W){this.W=!0;var Q=this.j;Q.g==this&&Q.aa&&!Q.P&&(Q.j.info("Great, no buffering proxy detected. Bytes received: "+g.length),Hl(Q),Q.P=!0,Pe(11))}}else Dt(this.i,this.l,g,null),ar(this,g);Ce==4&&on(this),this.o&&!this.K&&(Ce==4?Of(this.j,this):(this.o=!1,Ze(this)))}else Pb(this.g),f==400&&g.indexOf("Unknown SID")>0?(this.m=3,Pe(12)):(this.m=0,Pe(13)),on(this),Jt(this)}}}catch{}finally{}};function X(l){if(!ce(l))return l.g.la();const f=Cf(l.g);if(f==="")return"";let g="";const E=f.length,L=Ts(l.g)==4;if(!l.h.i){if(typeof TextDecoder>"u")return on(l),Jt(l),"";l.h.i=new o.TextDecoder}for(let U=0;U<E;U++)l.h.h=!0,g+=l.h.i.decode(f[U],{stream:!(L&&U==E-1)});return f.length=0,l.h.g+=g,l.C=0,l.h.g}function ce(l){return l.g?l.v=="GET"&&l.M!=2&&l.j.Aa:!1}function ve(l,f){var g=l.C,E=f.indexOf(`
`,g);return E==-1?ea:(g=Number(f.substring(g,E)),isNaN(g)?Bt:(E+=1,E+g>f.length?ea:(f=f.slice(E,E+g),l.C=E+g,f)))}_n.prototype.cancel=function(){this.K=!0,on(this)};function Ze(l){l.T=Date.now()+l.H,jt(l,l.H)}function jt(l,f){if(l.D!=null)throw Error("WatchDog timer not null");l.D=rr(d(l.aa,l),f)}function Tn(l){l.D&&(o.clearTimeout(l.D),l.D=null)}_n.prototype.aa=function(){this.D=null;const l=Date.now();l-this.T>=0?(bs(this.i,this.B),this.M!=2&&(te(),Pe(17)),on(this),this.m=2,Jt(this)):jt(this,this.T-l)};function Jt(l){l.j.I==0||l.K||Of(l.j,l)}function on(l){Tn(l);var f=l.O;f&&typeof f.dispose=="function"&&f.dispose(),l.O=null,ts(l.V),l.g&&(f=l.g,l.g=null,f.abort(),f.dispose())}function ar(l,f){try{var g=l.j;if(g.I!=0&&(g.g==l||Ul(g.h,l))){if(!l.L&&Ul(g.h,l)&&g.I==3){try{var E=g.Ba.g.parse(f)}catch{E=null}if(Array.isArray(E)&&E.length==3){var L=E;if(L[0]==0){e:if(!g.v){if(g.g)if(g.g.F+3e3<l.F)Do(g),Ro(g);else break e;Gl(g),Pe(18)}}else g.xa=L[1],0<g.xa-g.K&&L[2]<37500&&g.F&&g.A==0&&!g.C&&(g.C=rr(d(g.Va,g),6e3));pf(g.h)<=1&&g.ta&&(g.ta=void 0)}else cr(g,11)}else if((l.L||g.g==l)&&Do(g),!N(f))for(L=g.Ba.g.parse(f),f=0;f<L.length;f++){let Xe=L[f];const bt=Xe[0];if(!(bt<=g.K))if(g.K=bt,Xe=Xe[1],g.I==2)if(Xe[0]=="c"){g.M=Xe[1],g.ba=Xe[2];const On=Xe[3];On!=null&&(g.ka=On,g.j.info("VER="+g.ka));const lr=Xe[4];lr!=null&&(g.za=lr,g.j.info("SVER="+g.za));const Ns=Xe[5];Ns!=null&&typeof Ns=="number"&&Ns>0&&(E=1.5*Ns,g.O=E,g.j.info("backChannelRequestTimeoutMs_="+E)),E=g;const Es=l.g;if(Es){const Lo=Es.g?Es.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Lo){var U=E.h;U.g||Lo.indexOf("spdy")==-1&&Lo.indexOf("quic")==-1&&Lo.indexOf("h2")==-1||(U.j=U.l,U.g=new Set,U.h&&(Fl(U,U.h),U.h=null))}if(E.G){const Kl=Es.g?Es.g.getResponseHeader("X-HTTP-Session-Id"):null;Kl&&(E.wa=Kl,et(E.J,E.G,Kl))}}g.I=3,g.l&&g.l.ra(),g.aa&&(g.T=Date.now()-l.F,g.j.info("Handshake RTT: "+g.T+"ms")),E=g;var Q=l;if(E.na=Ff(E,E.L?E.ba:null,E.W),Q.L){gf(E.h,Q);var Ce=Q,xt=E.O;xt&&(Ce.H=xt),Ce.D&&(Tn(Ce),Ze(Ce)),E.g=Q}else Vf(E);g.i.length>0&&Po(g)}else Xe[0]!="stop"&&Xe[0]!="close"||cr(g,7);else g.I==3&&(Xe[0]=="stop"||Xe[0]=="close"?Xe[0]=="stop"?cr(g,7):zl(g):Xe[0]!="noop"&&g.l&&g.l.qa(Xe),g.A=0)}}te(4)}catch{}}var wb=class{constructor(l,f){this.g=l,this.map=f}};function ff(l){this.l=l||10,o.PerformanceNavigationTiming?(l=o.performance.getEntriesByType("navigation"),l=l.length>0&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function mf(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function pf(l){return l.h?1:l.g?l.g.size:0}function Ul(l,f){return l.h?l.h==f:l.g?l.g.has(f):!1}function Fl(l,f){l.g?l.g.add(f):l.h=f}function gf(l,f){l.h&&l.h==f?l.h=null:l.g&&l.g.has(f)&&l.g.delete(f)}ff.prototype.cancel=function(){if(this.i=xf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function xf(l){if(l.h!=null)return l.i.concat(l.h.G);if(l.g!=null&&l.g.size!==0){let f=l.i;for(const g of l.g.values())f=f.concat(g.G);return f}return w(l.i)}var yf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bb(l,f){if(l){l=l.split("&");for(let g=0;g<l.length;g++){const E=l[g].indexOf("=");let L,U=null;E>=0?(L=l[g].substring(0,E),U=l[g].substring(E+1)):L=l[g],f(L,U?decodeURIComponent(U.replace(/\+/g," ")):"")}}}function vs(l){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let f;l instanceof vs?(this.l=l.l,ta(this,l.j),this.o=l.o,this.g=l.g,na(this,l.u),this.h=l.h,Bl(this,Tf(l.i)),this.m=l.m):l&&(f=String(l).match(yf))?(this.l=!1,ta(this,f[1]||"",!0),this.o=sa(f[2]||""),this.g=sa(f[3]||"",!0),na(this,f[4]),this.h=sa(f[5]||"",!0),Bl(this,f[6]||"",!0),this.m=sa(f[7]||"")):(this.l=!1,this.i=new ia(null,this.l))}vs.prototype.toString=function(){const l=[];var f=this.j;f&&l.push(ra(f,_f,!0),":");var g=this.g;return(g||f=="file")&&(l.push("//"),(f=this.o)&&l.push(ra(f,_f,!0),"@"),l.push(Vt(g).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.u,g!=null&&l.push(":",String(g))),(g=this.h)&&(this.g&&g.charAt(0)!="/"&&l.push("/"),l.push(ra(g,g.charAt(0)=="/"?Tb:Ib,!0))),(g=this.i.toString())&&l.push("?",g),(g=this.m)&&l.push("#",ra(g,Eb)),l.join("")},vs.prototype.resolve=function(l){const f=Ln(this);let g=!!l.j;g?ta(f,l.j):g=!!l.o,g?f.o=l.o:g=!!l.g,g?f.g=l.g:g=l.u!=null;var E=l.h;if(g)na(f,l.u);else if(g=!!l.h){if(E.charAt(0)!="/")if(this.g&&!this.h)E="/"+E;else{var L=f.h.lastIndexOf("/");L!=-1&&(E=f.h.slice(0,L+1)+E)}if(L=E,L==".."||L==".")E="";else if(L.indexOf("./")!=-1||L.indexOf("/.")!=-1){E=L.lastIndexOf("/",0)==0,L=L.split("/");const U=[];for(let Q=0;Q<L.length;){const Ce=L[Q++];Ce=="."?E&&Q==L.length&&U.push(""):Ce==".."?((U.length>1||U.length==1&&U[0]!="")&&U.pop(),E&&Q==L.length&&U.push("")):(U.push(Ce),E=!0)}E=U.join("/")}else E=L}return g?f.h=E:g=l.i.toString()!=="",g?Bl(f,Tf(l.i)):g=!!l.m,g&&(f.m=l.m),f};function Ln(l){return new vs(l)}function ta(l,f,g){l.j=g?sa(f,!0):f,l.j&&(l.j=l.j.replace(/:$/,""))}function na(l,f){if(f){if(f=Number(f),isNaN(f)||f<0)throw Error("Bad port number "+f);l.u=f}else l.u=null}function Bl(l,f,g){f instanceof ia?(l.i=f,Ab(l.i,l.l)):(g||(f=ra(f,Nb)),l.i=new ia(f,l.l))}function et(l,f,g){l.i.set(f,g)}function ko(l){return et(l,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),l}function sa(l,f){return l?f?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function ra(l,f,g){return typeof l=="string"?(l=encodeURI(l).replace(f,vb),g&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function vb(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var _f=/[#\/\?@]/g,Ib=/[#\?:]/g,Tb=/[#\?]/g,Nb=/[#\?@]/g,Eb=/#/g;function ia(l,f){this.h=this.g=null,this.i=l||null,this.j=!!f}function or(l){l.g||(l.g=new Map,l.h=0,l.i&&bb(l.i,function(f,g){l.add(decodeURIComponent(f.replace(/\+/g," ")),g)}))}n=ia.prototype,n.add=function(l,f){or(this),this.i=null,l=Xr(this,l);let g=this.g.get(l);return g||this.g.set(l,g=[]),g.push(f),this.h+=1,this};function wf(l,f){or(l),f=Xr(l,f),l.g.has(f)&&(l.i=null,l.h-=l.g.get(f).length,l.g.delete(f))}function bf(l,f){return or(l),f=Xr(l,f),l.g.has(f)}n.forEach=function(l,f){or(this),this.g.forEach(function(g,E){g.forEach(function(L){l.call(f,L,E,this)},this)},this)};function vf(l,f){or(l);let g=[];if(typeof f=="string")bf(l,f)&&(g=g.concat(l.g.get(Xr(l,f))));else for(l=Array.from(l.g.values()),f=0;f<l.length;f++)g=g.concat(l[f]);return g}n.set=function(l,f){return or(this),this.i=null,l=Xr(this,l),bf(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[f]),this.h+=1,this},n.get=function(l,f){return l?(l=vf(this,l),l.length>0?String(l[0]):f):f};function If(l,f,g){wf(l,f),g.length>0&&(l.i=null,l.g.set(Xr(l,f),w(g)),l.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],f=Array.from(this.g.keys());for(let E=0;E<f.length;E++){var g=f[E];const L=Vt(g);g=vf(this,g);for(let U=0;U<g.length;U++){let Q=L;g[U]!==""&&(Q+="="+Vt(g[U])),l.push(Q)}}return this.i=l.join("&")};function Tf(l){const f=new ia;return f.i=l.i,l.g&&(f.g=new Map(l.g),f.h=l.h),f}function Xr(l,f){return f=String(f),l.j&&(f=f.toLowerCase()),f}function Ab(l,f){f&&!l.j&&(or(l),l.i=null,l.g.forEach(function(g,E){const L=E.toLowerCase();E!=L&&(wf(this,E),If(this,L,g))},l)),l.j=f}function jb(l,f){const g=new ws;if(o.Image){const E=new Image;E.onload=h(Is,g,"TestLoadImage: loaded",!0,f,E),E.onerror=h(Is,g,"TestLoadImage: error",!1,f,E),E.onabort=h(Is,g,"TestLoadImage: abort",!1,f,E),E.ontimeout=h(Is,g,"TestLoadImage: timeout",!1,f,E),o.setTimeout(function(){E.ontimeout&&E.ontimeout()},1e4),E.src=l}else f(!1)}function kb(l,f){const g=new ws,E=new AbortController,L=setTimeout(()=>{E.abort(),Is(g,"TestPingServer: timeout",!1,f)},1e4);fetch(l,{signal:E.signal}).then(U=>{clearTimeout(L),U.ok?Is(g,"TestPingServer: ok",!0,f):Is(g,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(L),Is(g,"TestPingServer: error",!1,f)})}function Is(l,f,g,E,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),E(g)}catch{}}function Cb(){this.g=new Xi}function $l(l){this.i=l.Sb||null,this.h=l.ab||!1}m($l,ns),$l.prototype.g=function(){return new Co(this.i,this.h)};function Co(l,f){he.call(this),this.H=l,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Co,he),n=Co.prototype,n.open=function(l,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=l,this.D=f,this.readyState=1,oa(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const f={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};l&&(f.body=l),(this.H||o).fetch(new Request(this.D,f)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,aa(this)),this.readyState=0},n.Pa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,oa(this)),this.g&&(this.readyState=3,oa(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Nf(this)}else l.text().then(this.Oa.bind(this),this.ga.bind(this))};function Nf(l){l.j.read().then(l.Ma.bind(l)).catch(l.ga.bind(l))}n.Ma=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var f=l.value?l.value:new Uint8Array(0);(f=this.B.decode(f,{stream:!l.done}))&&(this.response=this.responseText+=f)}l.done?aa(this):oa(this),this.readyState==3&&Nf(this)}},n.Oa=function(l){this.g&&(this.response=this.responseText=l,aa(this))},n.Na=function(l){this.g&&(this.response=l,aa(this))},n.ga=function(){this.g&&aa(this)};function aa(l){l.readyState=4,l.l=null,l.j=null,l.B=null,oa(l)}n.setRequestHeader=function(l,f){this.A.append(l,f)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],f=this.h.entries();for(var g=f.next();!g.done;)g=g.value,l.push(g[0]+": "+g[1]),g=f.next();return l.join(`\r
`)};function oa(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Co.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function Ef(l){let f="";return ee(l,function(g,E){f+=E,f+=":",f+=g,f+=`\r
`}),f}function ql(l,f,g){e:{for(E in g){var E=!1;break e}E=!0}E||(g=Ef(g),typeof l=="string"?g!=null&&Vt(g):et(l,f,g))}function ot(l){he.call(this),this.headers=new Map,this.L=l||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(ot,he);var Sb=/^https?$/i,Rb=["POST","PUT"];n=ot.prototype,n.Fa=function(l){this.H=l},n.ea=function(l,f,g,E){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);f=f?f.toUpperCase():"GET",this.D=l,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Qt.g(),this.g.onreadystatechange=p(d(this.Ca,this));try{this.B=!0,this.g.open(f,String(l),!0),this.B=!1}catch(U){Af(this,U);return}if(l=g||"",g=new Map(this.headers),E)if(Object.getPrototypeOf(E)===Object.prototype)for(var L in E)g.set(L,E[L]);else if(typeof E.keys=="function"&&typeof E.get=="function")for(const U of E.keys())g.set(U,E.get(U));else throw Error("Unknown input type for opt_headers: "+String(E));E=Array.from(g.keys()).find(U=>U.toLowerCase()=="content-type"),L=o.FormData&&l instanceof o.FormData,!(Array.prototype.indexOf.call(Rb,f,void 0)>=0)||E||L||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,Q]of g)this.g.setRequestHeader(U,Q);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(l),this.v=!1}catch(U){Af(this,U)}};function Af(l,f){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=f,l.o=5,jf(l),So(l)}function jf(l){l.A||(l.A=!0,Be(l,"complete"),Be(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=l||7,Be(this,"complete"),Be(this,"abort"),So(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),So(this,!0)),ot.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?kf(this):this.Xa())},n.Xa=function(){kf(this)};function kf(l){if(l.h&&typeof a<"u"){if(l.v&&Ts(l)==4)setTimeout(l.Ca.bind(l),0);else if(Be(l,"readystatechange"),Ts(l)==4){l.h=!1;try{const U=l.ca();e:switch(U){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var g;if(!(g=f)){var E;if(E=U===0){let Q=String(l.D).match(yf)[1]||null;!Q&&o.self&&o.self.location&&(Q=o.self.location.protocol.slice(0,-1)),E=!Sb.test(Q?Q.toLowerCase():"")}g=E}if(g)Be(l,"complete"),Be(l,"success");else{l.o=6;try{var L=Ts(l)>2?l.g.statusText:""}catch{L=""}l.l=L+" ["+l.ca()+"]",jf(l)}}finally{So(l)}}}}function So(l,f){if(l.g){l.m&&(clearTimeout(l.m),l.m=null);const g=l.g;l.g=null,f||Be(l,"ready");try{g.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Ts(l){return l.g?l.g.readyState:0}n.ca=function(){try{return Ts(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(l){if(this.g){var f=this.g.responseText;return l&&f.indexOf(l)==0&&(f=f.substring(l.length)),Yi(f)}};function Cf(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.F){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function Pb(l){const f={};l=(l.g&&Ts(l)>=2&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let E=0;E<l.length;E++){if(N(l[E]))continue;var g=Ml(l[E]);const L=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const U=f[L]||[];f[L]=U,U.push(g)}oe(f,function(E){return E.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ca(l,f,g){return g&&g.internalChannelParams&&g.internalChannelParams[l]||f}function Sf(l){this.za=0,this.i=[],this.j=new ws,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ca("failFast",!1,l),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ca("baseRetryDelayMs",5e3,l),this.Za=ca("retryDelaySeedMs",1e4,l),this.Ta=ca("forwardChannelMaxRetries",2,l),this.va=ca("forwardChannelRequestTimeoutMs",2e4,l),this.ma=l&&l.xmlHttpFactory||void 0,this.Ua=l&&l.Rb||void 0,this.Aa=l&&l.useFetchStreams||!1,this.O=void 0,this.L=l&&l.supportsCrossDomainXhr||!1,this.M="",this.h=new ff(l&&l.concurrentRequestLimit),this.Ba=new Cb,this.S=l&&l.fastHandshake||!1,this.R=l&&l.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=l&&l.Pb||!1,l&&l.ua&&this.j.ua(),l&&l.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&l&&l.detectBufferingProxy||!1,this.ia=void 0,l&&l.longPollingTimeout&&l.longPollingTimeout>0&&(this.ia=l.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Sf.prototype,n.ka=8,n.I=1,n.connect=function(l,f,g,E){Pe(0),this.W=l,this.H=f||{},g&&E!==void 0&&(this.H.OSID=g,this.H.OAID=E),this.F=this.X,this.J=Ff(this,null,this.W),Po(this)};function zl(l){if(Rf(l),l.I==3){var f=l.V++,g=Ln(l.J);if(et(g,"SID",l.M),et(g,"RID",f),et(g,"TYPE","terminate"),la(l,g),f=new _n(l,l.j,f),f.M=2,f.A=ko(Ln(g)),g=!1,o.navigator&&o.navigator.sendBeacon)try{g=o.navigator.sendBeacon(f.A.toString(),"")}catch{}!g&&o.Image&&(new Image().src=f.A,g=!0),g||(f.g=Bf(f.j,null),f.g.ea(f.A)),f.F=Date.now(),Ze(f)}Uf(l)}function Ro(l){l.g&&(Hl(l),l.g.cancel(),l.g=null)}function Rf(l){Ro(l),l.v&&(o.clearTimeout(l.v),l.v=null),Do(l),l.h.cancel(),l.m&&(typeof l.m=="number"&&o.clearTimeout(l.m),l.m=null)}function Po(l){if(!mf(l.h)&&!l.m){l.m=!0;var f=l.Ea;D||y(),M||(D(),M=!0),_.add(f,l),l.D=0}}function Db(l,f){return pf(l.h)>=l.h.j-(l.m?1:0)?!1:l.m?(l.i=f.G.concat(l.i),!0):l.I==1||l.I==2||l.D>=(l.Sa?0:l.Ta)?!1:(l.m=rr(d(l.Ea,l,f),Mf(l,l.D)),l.D++,!0)}n.Ea=function(l){if(this.m)if(this.m=null,this.I==1){if(!l){this.V=Math.floor(Math.random()*1e5),l=this.V++;const L=new _n(this,this.j,l);let U=this.o;if(this.U&&(U?(U=Ae(U),ke(U,this.U)):U=this.U),this.u!==null||this.R||(L.J=U,U=null),this.S)e:{for(var f=0,g=0;g<this.i.length;g++){t:{var E=this.i[g];if("__data__"in E.map&&(E=E.map.__data__,typeof E=="string")){E=E.length;break t}E=void 0}if(E===void 0)break;if(f+=E,f>4096){f=g;break e}if(f===4096||g===this.i.length-1){f=g+1;break e}}f=1e3}else f=1e3;f=Df(this,L,f),g=Ln(this.J),et(g,"RID",l),et(g,"CVER",22),this.G&&et(g,"X-HTTP-Session-Id",this.G),la(this,g),U&&(this.R?f="headers="+Vt(Ef(U))+"&"+f:this.u&&ql(g,this.u,U)),Fl(this.h,L),this.Ra&&et(g,"TYPE","init"),this.S?(et(g,"$req",f),et(g,"SID","null"),L.U=!0,Yr(L,g,null)):Yr(L,g,f),this.I=2}}else this.I==3&&(l?Pf(this,l):this.i.length==0||mf(this.h)||Pf(this))};function Pf(l,f){var g;f?g=f.l:g=l.V++;const E=Ln(l.J);et(E,"SID",l.M),et(E,"RID",g),et(E,"AID",l.K),la(l,E),l.u&&l.o&&ql(E,l.u,l.o),g=new _n(l,l.j,g,l.D+1),l.u===null&&(g.J=l.o),f&&(l.i=f.G.concat(l.i)),f=Df(l,g,1e3),g.H=Math.round(l.va*.5)+Math.round(l.va*.5*Math.random()),Fl(l.h,g),Yr(g,E,f)}function la(l,f){l.H&&ee(l.H,function(g,E){et(f,E,g)}),l.l&&ee({},function(g,E){et(f,E,g)})}function Df(l,f,g){g=Math.min(l.i.length,g);const E=l.l?d(l.l.Ka,l.l,l):null;e:{var L=l.i;let Ce=-1;for(;;){const xt=["count="+g];Ce==-1?g>0?(Ce=L[0].g,xt.push("ofs="+Ce)):Ce=0:xt.push("ofs="+Ce);let Xe=!0;for(let bt=0;bt<g;bt++){var U=L[bt].g;const On=L[bt].map;if(U-=Ce,U<0)Ce=Math.max(0,L[bt].g-100),Xe=!1;else try{U="req"+U+"_"||"";try{var Q=On instanceof Map?On:Object.entries(On);for(const[lr,Ns]of Q){let Es=Ns;c(Ns)&&(Es=ys(Ns)),xt.push(U+lr+"="+encodeURIComponent(Es))}}catch(lr){throw xt.push(U+"type="+encodeURIComponent("_badmap")),lr}}catch{E&&E(On)}}if(Xe){Q=xt.join("&");break e}}Q=void 0}return l=l.i.splice(0,g),f.G=l,Q}function Vf(l){if(!l.g&&!l.v){l.Y=1;var f=l.Da;D||y(),M||(D(),M=!0),_.add(f,l),l.A=0}}function Gl(l){return l.g||l.v||l.A>=3?!1:(l.Y++,l.v=rr(d(l.Da,l),Mf(l,l.A)),l.A++,!0)}n.Da=function(){if(this.v=null,Lf(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var l=4*this.T;this.j.info("BP detection timer enabled: "+l),this.B=rr(d(this.Wa,this),l)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Pe(10),Ro(this),Lf(this))};function Hl(l){l.B!=null&&(o.clearTimeout(l.B),l.B=null)}function Lf(l){l.g=new _n(l,l.j,"rpc",l.Y),l.u===null&&(l.g.J=l.o),l.g.P=0;var f=Ln(l.na);et(f,"RID","rpc"),et(f,"SID",l.M),et(f,"AID",l.K),et(f,"CI",l.F?"0":"1"),!l.F&&l.ia&&et(f,"TO",l.ia),et(f,"TYPE","xmlhttp"),la(l,f),l.u&&l.o&&ql(f,l.u,l.o),l.O&&(l.g.H=l.O);var g=l.g;l=l.ba,g.M=1,g.A=ko(Ln(f)),g.u=null,g.R=!0,jo(g,l)}n.Va=function(){this.C!=null&&(this.C=null,Ro(this),Gl(this),Pe(19))};function Do(l){l.C!=null&&(o.clearTimeout(l.C),l.C=null)}function Of(l,f){var g=null;if(l.g==f){Do(l),Hl(l),l.g=null;var E=2}else if(Ul(l.h,f))g=f.G,gf(l.h,f),E=1;else return;if(l.I!=0){if(f.o)if(E==1){g=f.u?f.u.length:0,f=Date.now()-f.F;var L=l.D;E=xn(),Be(E,new yn(E,g)),Po(l)}else Vf(l);else if(L=f.m,L==3||L==0&&f.X>0||!(E==1&&Db(l,f)||E==2&&Gl(l)))switch(g&&g.length>0&&(f=l.h,f.i=f.i.concat(g)),L){case 1:cr(l,5);break;case 4:cr(l,10);break;case 3:cr(l,6);break;default:cr(l,2)}}}function Mf(l,f){let g=l.Qa+Math.floor(Math.random()*l.Za);return l.isActive()||(g*=2),g*f}function cr(l,f){if(l.j.info("Error code "+f),f==2){var g=d(l.bb,l),E=l.Ua;const L=!E;E=new vs(E||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||ta(E,"https"),ko(E),L?jb(E.toString(),g):kb(E.toString(),g)}else Pe(2);l.I=0,l.l&&l.l.pa(f),Uf(l),Rf(l)}n.bb=function(l){l?(this.j.info("Successfully pinged google.com"),Pe(2)):(this.j.info("Failed to ping google.com"),Pe(1))};function Uf(l){if(l.I=0,l.ja=[],l.l){const f=xf(l.h);(f.length!=0||l.i.length!=0)&&(v(l.ja,f),v(l.ja,l.i),l.h.i.length=0,w(l.i),l.i.length=0),l.l.oa()}}function Ff(l,f,g){var E=g instanceof vs?Ln(g):new vs(g);if(E.g!="")f&&(E.g=f+"."+E.g),na(E,E.u);else{var L=o.location;E=L.protocol,f=f?f+"."+L.hostname:L.hostname,L=+L.port;const U=new vs(null);E&&ta(U,E),f&&(U.g=f),L&&na(U,L),g&&(U.h=g),E=U}return g=l.G,f=l.wa,g&&f&&et(E,g,f),et(E,"VER",l.ka),la(l,E),E}function Bf(l,f,g){if(f&&!l.L)throw Error("Can't create secondary domain capable XhrIo object.");return f=l.Aa&&!l.ma?new ot(new $l({ab:g})):new ot(l.ma),f.Fa(l.L),f}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function $f(){}n=$f.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Vo(){}Vo.prototype.g=function(l,f){return new cn(l,f)};function cn(l,f){he.call(this),this.g=new Sf(f),this.l=l,this.h=f&&f.messageUrlParams||null,l=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(l?l["X-WebChannel-Content-Type"]=f.messageContentType:l={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.sa&&(l?l["X-WebChannel-Client-Profile"]=f.sa:l={"X-WebChannel-Client-Profile":f.sa}),this.g.U=l,(l=f&&f.Qb)&&!N(l)&&(this.g.u=l),this.A=f&&f.supportsCrossDomainXhr||!1,this.v=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!N(f)&&(this.g.G=f,l=this.h,l!==null&&f in l&&(l=this.h,f in l&&delete l[f])),this.j=new Zr(this)}m(cn,he),cn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},cn.prototype.close=function(){zl(this.g)},cn.prototype.o=function(l){var f=this.g;if(typeof l=="string"){var g={};g.__data__=l,l=g}else this.v&&(g={},g.__data__=ys(l),l=g);f.i.push(new wb(f.Ya++,l)),f.I==3&&Po(f)},cn.prototype.N=function(){this.g.l=null,delete this.j,zl(this.g),delete this.g,cn.Z.N.call(this)};function qf(l){sr.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var f=l.__sm__;if(f){e:{for(const g in f){l=g;break e}l=void 0}(this.i=l)&&(l=this.i,f=f!==null&&l in f?f[l]:void 0),this.data=f}else this.data=l}m(qf,sr);function zf(){Vn.call(this),this.status=1}m(zf,Vn);function Zr(l){this.g=l}m(Zr,$f),Zr.prototype.ra=function(){Be(this.g,"a")},Zr.prototype.qa=function(l){Be(this.g,new qf(l))},Zr.prototype.pa=function(l){Be(this.g,new zf)},Zr.prototype.oa=function(){Be(this.g,"b")},Vo.prototype.createWebChannel=Vo.prototype.g,cn.prototype.send=cn.prototype.o,cn.prototype.open=cn.prototype.m,cn.prototype.close=cn.prototype.close,ty=function(){return new Vo},ey=function(){return xn()},Zx=tt,Ou={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ir.NO_ERROR=0,ir.TIMEOUT=8,ir.HTTP_ERROR=6,rc=ir,Wt.COMPLETE="complete",Xx=Wt,nr.EventType=In,In.OPEN="a",In.CLOSE="b",In.ERROR="c",In.MESSAGE="d",he.prototype.listen=he.prototype.J,xa=nr,ot.prototype.listenOnce=ot.prototype.K,ot.prototype.getLastError=ot.prototype.Ha,ot.prototype.getLastErrorCode=ot.prototype.ya,ot.prototype.getStatus=ot.prototype.ca,ot.prototype.getResponseJson=ot.prototype.La,ot.prototype.getResponseText=ot.prototype.la,ot.prototype.send=ot.prototype.ea,ot.prototype.setWithCredentials=ot.prototype.Fa,Yx=ot}).apply(typeof Mo<"u"?Mo:typeof self<"u"?self:typeof window<"u"?window:{});const Nm="@firebase/firestore",Em="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}qt.UNAUTHENTICATED=new qt(null),qt.GOOGLE_CREDENTIALS=new qt("google-credentials-uid"),qt.FIRST_PARTY=new qt("first-party-uid"),qt.MOCK_USER=new qt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zi="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cr=new so("@firebase/firestore");function ci(){return Cr.logLevel}function G(n,...e){if(Cr.logLevel<=Ve.DEBUG){const t=e.map(zd);Cr.debug(`Firestore (${zi}): ${n}`,...t)}}function Gt(n,...e){if(Cr.logLevel<=Ve.ERROR){const t=e.map(zd);Cr.error(`Firestore (${zi}): ${n}`,...t)}}function Ua(n,...e){if(Cr.logLevel<=Ve.WARN){const t=e.map(zd);Cr.warn(`Firestore (${zi}): ${n}`,...t)}}function zd(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ne(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,ny(n,s,t)}function ny(n,e,t){let s=`FIRESTORE (${zi}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw Gt(s),new Error(s)}function ie(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||ny(e,r,s)}function we(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class H extends gn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class vN{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(qt.UNAUTHENTICATED)))}shutdown(){}}class IN{constructor(e){this.t=e,this.currentUser=qt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ie(this.o===void 0,42304);let s=this.i;const r=u=>this.i!==s?(s=this.i,t(u)):Promise.resolve();let a=new jn;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new jn,e.enqueueRetryable((()=>r(this.currentUser)))};const o=()=>{const u=a;e.enqueueRetryable((async()=>{await u.promise,await r(this.currentUser)}))},c=u=>{G("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((u=>c(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(G("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new jn)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(G("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(ie(typeof s.accessToken=="string",31837,{l:s}),new bN(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ie(e===null||typeof e=="string",2055,{h:e}),new qt(e)}}class TN{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=qt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class NN{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new TN(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(qt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Am{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class EN{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,un(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ie(this.o===void 0,3512);const s=a=>{a.error!=null&&G("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.m;return this.m=a.token,G("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable((()=>s(a)))};const r=a=>{G("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((a=>r(a))),setTimeout((()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?r(a):G("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Am(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ie(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Am(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AN(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=AN(40);for(let a=0;a<r.length;++a)s.length<20&&r[a]<t&&(s+=e.charAt(r[a]%62))}return s}}function Ie(n,e){return n<e?-1:n>e?1:0}function Mu(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),a=e.charAt(s);if(r!==a)return iu(r)===iu(a)?Ie(r,a):iu(r)?1:-1}return Ie(n.length,e.length)}const jN=55296,kN=57343;function iu(n){const e=n.charCodeAt(0);return e>=jN&&e<=kN}function ji(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}function sy(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jm="__name__";class Un{constructor(e,t,s){t===void 0?t=0:t>e.length&&ne(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&ne(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return Un.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Un?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const a=Un.compareSegments(e.get(r),t.get(r));if(a!==0)return a}return Ie(e.length,t.length)}static compareSegments(e,t){const s=Un.isNumericId(e),r=Un.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?Un.extractNumericId(e).compare(Un.extractNumericId(t)):Mu(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Gs.fromString(e.substring(4,e.length-2))}}class $e extends Un{construct(e,t,s){return new $e(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new H(B.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new $e(t)}static emptyPath(){return new $e([])}}const CN=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class it extends Un{construct(e,t,s){return new it(e,t,s)}static isValidIdentifier(e){return CN.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),it.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===jm}static keyField(){return new it([jm])}static fromServerFormat(e){const t=[];let s="",r=0;const a=()=>{if(s.length===0)throw new H(B.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const c=e[r];if(c==="\\"){if(r+1===e.length)throw new H(B.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[r+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new H(B.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=u,r+=2}else c==="`"?(o=!o,r++):c!=="."||o?(s+=c,r++):(a(),r++)}if(a(),o)throw new H(B.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new it(t)}static emptyPath(){return new it([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y{constructor(e){this.path=e}static fromPath(e){return new Y($e.fromString(e))}static fromName(e){return new Y($e.fromString(e).popFirst(5))}static empty(){return new Y($e.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&$e.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return $e.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Y(new $e(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ry(n,e,t){if(!t)throw new H(B.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function SN(n,e,t,s){if(e===!0&&s===!0)throw new H(B.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function km(n){if(!Y.isDocumentKey(n))throw new H(B.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Cm(n){if(Y.isDocumentKey(n))throw new H(B.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function iy(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function cl(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ne(12329,{type:typeof n})}function tn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new H(B.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=cl(n);throw new H(B.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mt(n,e){const t={typeString:n};return e&&(t.value=e),t}function co(n,e){if(!iy(n))throw new H(B.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,a="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(a!==void 0&&o!==a.value){t=`Expected '${s}' field to equal '${a.value}'`;break}}if(t)throw new H(B.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sm=-62135596800,Rm=1e6;class Qe{static now(){return Qe.fromMillis(Date.now())}static fromDate(e){return Qe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*Rm);return new Qe(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new H(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new H(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Sm)throw new H(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new H(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Rm}_compareTo(e){return this.seconds===e.seconds?Ie(this.nanoseconds,e.nanoseconds):Ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Qe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(co(e,Qe._jsonSchema))return new Qe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Sm;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Qe._jsonSchemaVersion="firestore/timestamp/1.0",Qe._jsonSchema={type:mt("string",Qe._jsonSchemaVersion),seconds:mt("number"),nanoseconds:mt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{static fromTimestamp(e){return new le(e)}static min(){return new le(new Qe(0,0))}static max(){return new le(new Qe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fa=-1;class Sc{constructor(e,t,s,r){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=r}}function Uu(n){return n.fields.find((e=>e.kind===2))}function hr(n){return n.fields.filter((e=>e.kind!==2))}Sc.UNKNOWN_ID=-1;class ic{constructor(e,t){this.fieldPath=e,this.kind=t}}class Ba{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ba(0,pn.min())}}function RN(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=le.fromTimestamp(s===1e9?new Qe(t+1,0):new Qe(t,s));return new pn(r,Y.empty(),e)}function ay(n){return new pn(n.readTime,n.key,Fa)}class pn{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new pn(le.min(),Y.empty(),Fa)}static max(){return new pn(le.max(),Y.empty(),Fa)}}function Hd(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Y.comparator(n.documentKey,e.documentKey),t!==0?t:Ie(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class cy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gr(n){if(n.code!==B.FAILED_PRECONDITION||n.message!==oy)throw n;G("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ne(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new V(((s,r)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(s,r)},this.catchCallback=a=>{this.wrapFailure(t,a).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof V?t:V.resolve(t)}catch(t){return V.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):V.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):V.reject(t)}static resolve(e){return new V(((t,s)=>{t(e)}))}static reject(e){return new V(((t,s)=>{s(e)}))}static waitFor(e){return new V(((t,s)=>{let r=0,a=0,o=!1;e.forEach((c=>{++r,c.next((()=>{++a,o&&a===r&&t()}),(u=>s(u)))})),o=!0,a===r&&t()}))}static or(e){let t=V.resolve(!1);for(const s of e)t=t.next((r=>r?V.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,a)=>{s.push(t.call(this,r,a))})),this.waitFor(s)}static mapArray(e,t){return new V(((s,r)=>{const a=e.length,o=new Array(a);let c=0;for(let u=0;u<a;u++){const d=u;t(e[d]).next((h=>{o[d]=h,++c,c===a&&s(o)}),(h=>r(h)))}}))}static doWhile(e,t){return new V(((s,r)=>{const a=()=>{e()===!0?t().next((()=>{a()}),r):s()};a()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ln="SimpleDb";class ll{static open(e,t,s,r){try{return new ll(t,e.transaction(r,s))}catch(a){throw new Aa(t,a)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new jn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Aa(e,t.error)):this.S.resolve()},this.transaction.onerror=s=>{const r=Kd(s.target.error);this.S.reject(new Aa(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(G(ln,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new DN(t)}}class Hs{static delete(e){return G(ln,"Removing database:",e),mr(kd().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!qi())return!1;if(Hs.F())return!0;const e=_t(),t=Hs.M(e),s=0<t&&t<10,r=ly(e),a=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||a)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}constructor(e,t,s){this.name=e,this.version=t,this.N=s,this.B=null,Hs.M(_t())===12.2&&Gt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(G(ln,"Opening database:",this.name),this.db=await new Promise(((t,s)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=a=>{const o=a.target.result;t(o)},r.onblocked=()=>{s(new Aa(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=a=>{const o=a.target.error;o.name==="VersionError"?s(new H(B.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?s(new H(B.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):s(new Aa(e,o))},r.onupgradeneeded=a=>{G(ln,'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);const o=a.target.result;this.N.k(o,r.transaction,a.oldVersion,this.version).next((()=>{G(ln,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,s,r){const a=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const c=ll.open(this.db,e,a?"readonly":"readwrite",s),u=r(c).next((d=>(c.C(),d))).catch((d=>(c.abort(d),V.reject(d)))).toPromise();return u.catch((()=>{})),await c.D,u}catch(c){const u=c,d=u.name!=="FirebaseError"&&o<3;if(G(ln,"Transaction failed with error:",u.message,"Retrying:",d),this.close(),!d)return Promise.reject(u)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ly(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class PN{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return mr(this.U.delete())}}class Aa extends H{constructor(e,t){super(B.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function er(n){return n.name==="IndexedDbTransactionError"}class DN{constructor(e){this.store=e}put(e,t){let s;return t!==void 0?(G(ln,"PUT",this.store.name,e,t),s=this.store.put(t,e)):(G(ln,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),mr(s)}add(e){return G(ln,"ADD",this.store.name,e,e),mr(this.store.add(e))}get(e){return mr(this.store.get(e)).next((t=>(t===void 0&&(t=null),G(ln,"GET",this.store.name,e,t),t)))}delete(e){return G(ln,"DELETE",this.store.name,e),mr(this.store.delete(e))}count(){return G(ln,"COUNT",this.store.name),mr(this.store.count())}J(e,t){const s=this.options(e,t),r=s.index?this.store.index(s.index):this.store;if(typeof r.getAll=="function"){const a=r.getAll(s.range);return new V(((o,c)=>{a.onerror=u=>{c(u.target.error)},a.onsuccess=u=>{o(u.target.result)}}))}{const a=this.cursor(s),o=[];return this.H(a,((c,u)=>{o.push(u)})).next((()=>o))}}Y(e,t){const s=this.store.getAll(e,t===null?void 0:t);return new V(((r,a)=>{s.onerror=o=>{a(o.target.error)},s.onsuccess=o=>{r(o.target.result)}}))}Z(e,t){G(ln,"DELETE ALL",this.store.name);const s=this.options(e,t);s.X=!1;const r=this.cursor(s);return this.H(r,((a,o,c)=>c.delete()))}ee(e,t){let s;t?s=e:(s={},t=e);const r=this.cursor(s);return this.H(r,t)}te(e){const t=this.cursor({});return new V(((s,r)=>{t.onerror=a=>{const o=Kd(a.target.error);r(o)},t.onsuccess=a=>{const o=a.target.result;o?e(o.primaryKey,o.value).next((c=>{c?o.continue():s()})):s()}}))}H(e,t){const s=[];return new V(((r,a)=>{e.onerror=o=>{a(o.target.error)},e.onsuccess=o=>{const c=o.target.result;if(!c)return void r();const u=new PN(c),d=t(c.primaryKey,c.value,u);if(d instanceof V){const h=d.catch((m=>(u.done(),V.reject(m))));s.push(h)}u.isDone?r():u.G===null?c.continue():c.continue(u.G)}})).next((()=>V.waitFor(s)))}options(e,t){let s;return e!==void 0&&(typeof e=="string"?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.X?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function mr(n){return new V(((e,t)=>{n.onsuccess=s=>{const r=s.target.result;e(r)},n.onerror=s=>{const r=Kd(s.target.error);t(r)}}))}let Pm=!1;function Kd(n){const e=Hs.M(_t());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const s=new H("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Pm||(Pm=!0,setTimeout((()=>{throw s}),0)),s}}return n}const ja="IndexBackfiller";class VN{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){G(ja,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();G(ja,`Documents written: ${t}`)}catch(t){er(t)?G(ja,"Ignoring IndexedDB error during index backfill: ",t):await Gr(t)}await this.re(6e4)}))}}class LN{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const s=new Set;let r=t,a=!0;return V.doWhile((()=>a===!0&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((o=>{if(o!==null&&!s.has(o))return G(ja,`Processing collection: ${o}`),this.oe(e,o,r).next((c=>{r-=c,s.add(o)}));a=!1})))).next((()=>t-r))}oe(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,s).next((a=>{const o=a.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next((()=>this._e(r,a))).next((c=>(G(ja,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c)))).next((()=>o.size))}))))}_e(e,t){let s=e;return t.changes.forEach(((r,a)=>{const o=ay(a);Hd(o,s)>0&&(s=o)})),new pn(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}wn.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ir=-1;function lo(n){return n==null}function $a(n){return n===0&&1/n==-1/0}function ON(n){return typeof n=="number"&&Number.isInteger(n)&&!$a(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rc="";function Ut(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Dm(e)),e=MN(n.get(t),e);return Dm(e)}function MN(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const a=n.charAt(r);switch(a){case"\0":t+="";break;case Rc:t+="";break;default:t+=a}}return t}function Dm(n){return n+Rc+""}function $n(n){const e=n.length;if(ie(e>=2,64408,{path:n}),e===2)return ie(n.charAt(0)===Rc&&n.charAt(1)==="",56145,{path:n}),$e.emptyPath();const t=e-2,s=[];let r="";for(let a=0;a<e;){const o=n.indexOf(Rc,a);switch((o<0||o>t)&&ne(50515,{path:n}),n.charAt(o+1)){case"":const c=n.substring(a,o);let u;r.length===0?u=c:(r+=c,u=r,r=""),s.push(u);break;case"":r+=n.substring(a,o),r+="\0";break;case"":r+=n.substring(a,o+1);break;default:ne(61167,{path:n})}a=o+2}return new $e(s)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fr="remoteDocuments",uo="owner",ei="owner",qa="mutationQueues",UN="userId",Nn="mutations",Vm="batchId",_r="userMutationsIndex",Lm=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ac(n,e){return[n,Ut(e)]}function uy(n,e,t){return[n,Ut(e),t]}const FN={},ki="documentMutations",Pc="remoteDocumentsV14",BN=["prefixPath","collectionGroup","readTime","documentId"],oc="documentKeyIndex",$N=["prefixPath","collectionGroup","documentId"],dy="collectionGroupIndex",qN=["collectionGroup","readTime","prefixPath","documentId"],za="remoteDocumentGlobal",Fu="remoteDocumentGlobalKey",Ci="targets",hy="queryTargetsIndex",zN=["canonicalId","targetId"],Si="targetDocuments",GN=["targetId","path"],Wd="documentTargetsIndex",HN=["path","targetId"],Dc="targetGlobalKey",Tr="targetGlobal",Ga="collectionParents",KN=["collectionId","parent"],Ri="clientMetadata",WN="clientId",ul="bundles",QN="bundleId",dl="namedQueries",JN="name",Qd="indexConfiguration",YN="indexId",Bu="collectionGroupIndex",XN="collectionGroup",ka="indexState",ZN=["indexId","uid"],fy="sequenceNumberIndex",eE=["uid","sequenceNumber"],Ca="indexEntries",tE=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],my="documentKeyIndex",nE=["indexId","uid","orderedDocumentKey"],hl="documentOverlays",sE=["userId","collectionPath","documentId"],$u="collectionPathOverlayIndex",rE=["userId","collectionPath","largestBatchId"],py="collectionGroupOverlayIndex",iE=["userId","collectionGroup","largestBatchId"],Jd="globals",aE="name",gy=[qa,Nn,ki,fr,Ci,uo,Tr,Si,Ri,za,Ga,ul,dl],oE=[...gy,hl],xy=[qa,Nn,ki,Pc,Ci,uo,Tr,Si,Ri,za,Ga,ul,dl,hl],yy=xy,Yd=[...yy,Qd,ka,Ca],cE=Yd,_y=[...Yd,Jd],lE=_y;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu extends cy{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function wt(n,e){const t=we(n);return Hs.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Om(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function tr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function wy(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt{constructor(e,t){this.comparator=e,this.root=t||kt.EMPTY}insert(e,t){return new rt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,kt.BLACK,null,null))}remove(e){return new rt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,kt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Uo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Uo(this.root,e,this.comparator,!1)}getReverseIterator(){return new Uo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Uo(this.root,e,this.comparator,!0)}}class Uo{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=t?s(e.key,t):1,t&&r&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class kt{constructor(e,t,s,r,a){this.key=e,this.value=t,this.color=s??kt.RED,this.left=r??kt.EMPTY,this.right=a??kt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,a){return new kt(e??this.key,t??this.value,s??this.color,r??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const a=s(e,r.key);return r=a<0?r.copy(null,null,null,r.left.insert(e,t,s),null):a===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return kt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return kt.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,kt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,kt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ne(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ne(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ne(27949);return e+(this.isRed()?0:1)}}kt.EMPTY=null,kt.RED=!0,kt.BLACK=!1;kt.EMPTY=new class{constructor(){this.size=0}get key(){throw ne(57766)}get value(){throw ne(16141)}get color(){throw ne(16727)}get left(){throw ne(29726)}get right(){throw ne(36894)}copy(e,t,s,r,a){return this}insert(e,t,s){return new kt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ye{constructor(e){this.comparator=e,this.data=new rt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Mm(this.data.getIterator())}getIteratorFrom(e){return new Mm(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof Ye)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,a=s.getNext().key;if(this.comparator(r,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ye(this.comparator);return t.data=e,t}}class Mm{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ti(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e){this.fields=e,e.sort(it.comparator)}static empty(){return new Xt([])}unionWith(e){let t=new Ye(it.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new Xt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ji(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class by extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new by("Invalid base64 string: "+a):a}})(e);return new pt(t)}static fromUint8Array(e){const t=(function(r){let a="";for(let o=0;o<r.length;++o)a+=String.fromCharCode(r[o]);return a})(e);return new pt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pt.EMPTY_BYTE_STRING=new pt("");const uE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hs(n){if(ie(!!n,39018),typeof n=="string"){let e=0;const t=uE.exec(n);if(ie(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:nt(n.seconds),nanos:nt(n.nanos)}}function nt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function fs(n){return typeof n=="string"?pt.fromBase64String(n):pt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vy="server_timestamp",Iy="__type__",Ty="__previous_value__",Ny="__local_write_time__";function Xd(n){return(n?.mapValue?.fields||{})[Iy]?.stringValue===vy}function fl(n){const e=n.mapValue.fields[Ty];return Xd(e)?fl(e):e}function Ha(n){const e=hs(n.mapValue.fields[Ny].timestampValue);return new Qe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,t,s,r,a,o,c,u,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=d,this.isUsingEmulator=h}}const Vc="(default)";class Sr{constructor(e,t){this.projectId=e,this.database=t||Vc}static empty(){return new Sr("","")}get isDefaultDatabase(){return this.database===Vc}isEqual(e){return e instanceof Sr&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zd="__type__",Ey="__max__",Us={mapValue:{fields:{__type__:{stringValue:Ey}}}},eh="__vector__",Pi="value",cc={nullValue:"NULL_VALUE"};function Qs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Xd(n)?4:Ay(n)?9007199254740991:ml(n)?10:11:ne(28295,{value:n})}function Jn(n,e){if(n===e)return!0;const t=Qs(n);if(t!==Qs(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ha(n).isEqual(Ha(e));case 3:return(function(r,a){if(typeof r.timestampValue=="string"&&typeof a.timestampValue=="string"&&r.timestampValue.length===a.timestampValue.length)return r.timestampValue===a.timestampValue;const o=hs(r.timestampValue),c=hs(a.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,a){return fs(r.bytesValue).isEqual(fs(a.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,a){return nt(r.geoPointValue.latitude)===nt(a.geoPointValue.latitude)&&nt(r.geoPointValue.longitude)===nt(a.geoPointValue.longitude)})(n,e);case 2:return(function(r,a){if("integerValue"in r&&"integerValue"in a)return nt(r.integerValue)===nt(a.integerValue);if("doubleValue"in r&&"doubleValue"in a){const o=nt(r.doubleValue),c=nt(a.doubleValue);return o===c?$a(o)===$a(c):isNaN(o)&&isNaN(c)}return!1})(n,e);case 9:return ji(n.arrayValue.values||[],e.arrayValue.values||[],Jn);case 10:case 11:return(function(r,a){const o=r.mapValue.fields||{},c=a.mapValue.fields||{};if(Om(o)!==Om(c))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!Jn(o[u],c[u])))return!1;return!0})(n,e);default:return ne(52216,{left:n})}}function Ka(n,e){return(n.values||[]).find((t=>Jn(t,e)))!==void 0}function Js(n,e){if(n===e)return 0;const t=Qs(n),s=Qs(e);if(t!==s)return Ie(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ie(n.booleanValue,e.booleanValue);case 2:return(function(a,o){const c=nt(a.integerValue||a.doubleValue),u=nt(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1})(n,e);case 3:return Um(n.timestampValue,e.timestampValue);case 4:return Um(Ha(n),Ha(e));case 5:return Mu(n.stringValue,e.stringValue);case 6:return(function(a,o){const c=fs(a),u=fs(o);return c.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(a,o){const c=a.split("/"),u=o.split("/");for(let d=0;d<c.length&&d<u.length;d++){const h=Ie(c[d],u[d]);if(h!==0)return h}return Ie(c.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(a,o){const c=Ie(nt(a.latitude),nt(o.latitude));return c!==0?c:Ie(nt(a.longitude),nt(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Fm(n.arrayValue,e.arrayValue);case 10:return(function(a,o){const c=a.fields||{},u=o.fields||{},d=c[Pi]?.arrayValue,h=u[Pi]?.arrayValue,m=Ie(d?.values?.length||0,h?.values?.length||0);return m!==0?m:Fm(d,h)})(n.mapValue,e.mapValue);case 11:return(function(a,o){if(a===Us.mapValue&&o===Us.mapValue)return 0;if(a===Us.mapValue)return 1;if(o===Us.mapValue)return-1;const c=a.fields||{},u=Object.keys(c),d=o.fields||{},h=Object.keys(d);u.sort(),h.sort();for(let m=0;m<u.length&&m<h.length;++m){const p=Mu(u[m],h[m]);if(p!==0)return p;const w=Js(c[u[m]],d[h[m]]);if(w!==0)return w}return Ie(u.length,h.length)})(n.mapValue,e.mapValue);default:throw ne(23264,{he:t})}}function Um(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ie(n,e);const t=hs(n),s=hs(e),r=Ie(t.seconds,s.seconds);return r!==0?r:Ie(t.nanos,s.nanos)}function Fm(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const a=Js(t[r],s[r]);if(a)return a}return Ie(t.length,s.length)}function Di(n){return zu(n)}function zu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=hs(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return fs(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return Y.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const a of t.values||[])r?r=!1:s+=",",s+=zu(a);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",a=!0;for(const o of s)a?a=!1:r+=",",r+=`${o}:${zu(t.fields[o])}`;return r+"}"})(n.mapValue):ne(61005,{value:n})}function lc(n){switch(Qs(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=fl(n);return e?16+lc(e):16;case 5:return 2*n.stringValue.length;case 6:return fs(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,a)=>r+lc(a)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return tr(s.fields,((a,o)=>{r+=a.length+lc(o)})),r})(n.mapValue);default:throw ne(13486,{value:n})}}function Wa(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Gu(n){return!!n&&"integerValue"in n}function Qa(n){return!!n&&"arrayValue"in n}function Bm(n){return!!n&&"nullValue"in n}function $m(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function uc(n){return!!n&&"mapValue"in n}function ml(n){return(n?.mapValue?.fields||{})[Zd]?.stringValue===eh}function Sa(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return tr(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=Sa(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Sa(n.arrayValue.values[t]);return e}return{...n}}function Ay(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Ey}const jy={mapValue:{fields:{[Zd]:{stringValue:eh},[Pi]:{arrayValue:{}}}}};function hE(n){return"nullValue"in n?cc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Wa(Sr.empty(),Y.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?ml(n)?jy:{mapValue:{}}:ne(35942,{value:n})}function fE(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Wa(Sr.empty(),Y.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?jy:"mapValue"in n?ml(n)?{mapValue:{}}:Us:ne(61959,{value:n})}function qm(n,e){const t=Js(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function zm(n,e){const t=Js(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e){this.value=e}static empty(){return new Ct({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!uc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Sa(t)}setAll(e){let t=it.emptyPath(),s={},r=[];e.forEach(((o,c)=>{if(!t.isImmediateParentOf(c)){const u=this.getFieldsMap(t);this.applyChanges(u,s,r),s={},r=[],t=c.popLast()}o?s[c.lastSegment()]=Sa(o):r.push(c.lastSegment())}));const a=this.getFieldsMap(t);this.applyChanges(a,s,r)}delete(e){const t=this.field(e.popLast());uc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Jn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];uc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){tr(t,((r,a)=>e[r]=a));for(const r of s)delete e[r]}clone(){return new Ct(Sa(this.value))}}function ky(n){const e=[];return tr(n.fields,((t,s)=>{const r=new it([t]);if(uc(s)){const a=ky(s.mapValue).fields;if(a.length===0)e.push(r);else for(const o of a)e.push(r.child(o))}else e.push(r)})),new Xt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{constructor(e,t,s,r,a,o,c){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=a,this.data=o,this.documentState=c}static newInvalidDocument(e){return new st(e,0,le.min(),le.min(),le.min(),Ct.empty(),0)}static newFoundDocument(e,t,s,r){return new st(e,1,t,le.min(),s,r,0)}static newNoDocument(e,t){return new st(e,2,t,le.min(),le.min(),Ct.empty(),0)}static newUnknownDocument(e,t){return new st(e,3,t,le.min(),le.min(),Ct.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(le.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ct.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ct.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=le.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof st&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new st(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e,t){this.position=e,this.inclusive=t}}function Gm(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const a=e[r],o=n.position[r];if(a.field.isKeyField()?s=Y.comparator(Y.fromName(o.referenceValue),t.key):s=Js(o,t.data.field(a.field)),a.dir==="desc"&&(s*=-1),s!==0)break}return s}function Hm(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Jn(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(e,t="asc"){this.field=e,this.dir=t}}function mE(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cy{}class Le extends Cy{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new pE(e,t,s):t==="array-contains"?new yE(e,s):t==="in"?new Ly(e,s):t==="not-in"?new _E(e,s):t==="array-contains-any"?new wE(e,s):new Le(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new gE(e,s):new xE(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Js(t,this.value)):t!==null&&Qs(this.value)===Qs(t)&&this.matchesComparison(Js(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ne(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Je extends Cy{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Je(e,t)}matches(e){return Li(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Li(n){return n.op==="and"}function Hu(n){return n.op==="or"}function th(n){return Sy(n)&&Li(n)}function Sy(n){for(const e of n.filters)if(e instanceof Je)return!1;return!0}function Ku(n){if(n instanceof Le)return n.field.canonicalString()+n.op.toString()+Di(n.value);if(th(n))return n.filters.map((e=>Ku(e))).join(",");{const e=n.filters.map((t=>Ku(t))).join(",");return`${n.op}(${e})`}}function Ry(n,e){return n instanceof Le?(function(s,r){return r instanceof Le&&s.op===r.op&&s.field.isEqual(r.field)&&Jn(s.value,r.value)})(n,e):n instanceof Je?(function(s,r){return r instanceof Je&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((a,o,c)=>a&&Ry(o,r.filters[c])),!0):!1})(n,e):void ne(19439)}function Py(n,e){const t=n.filters.concat(e);return Je.create(t,n.op)}function Dy(n){return n instanceof Le?(function(t){return`${t.field.canonicalString()} ${t.op} ${Di(t.value)}`})(n):n instanceof Je?(function(t){return t.op.toString()+" {"+t.getFilters().map(Dy).join(" ,")+"}"})(n):"Filter"}class pE extends Le{constructor(e,t,s){super(e,t,s),this.key=Y.fromName(s.referenceValue)}matches(e){const t=Y.comparator(e.key,this.key);return this.matchesComparison(t)}}class gE extends Le{constructor(e,t){super(e,"in",t),this.keys=Vy("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class xE extends Le{constructor(e,t){super(e,"not-in",t),this.keys=Vy("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Vy(n,e){return(e.arrayValue?.values||[]).map((t=>Y.fromName(t.referenceValue)))}class yE extends Le{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Qa(t)&&Ka(t.arrayValue,this.value)}}class Ly extends Le{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ka(this.value.arrayValue,t)}}class _E extends Le{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ka(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ka(this.value.arrayValue,t)}}class wE extends Le{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Qa(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>Ka(this.value.arrayValue,s)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bE{constructor(e,t=null,s=[],r=[],a=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=a,this.startAt=o,this.endAt=c,this.Te=null}}function Wu(n,e=null,t=[],s=[],r=null,a=null,o=null){return new bE(n,e,t,s,r,a,o)}function Rr(n){const e=we(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>Ku(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(a){return a.field.canonicalString()+a.dir})(s))).join(","),lo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>Di(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>Di(s))).join(",")),e.Te=t}return e.Te}function ho(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!mE(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Ry(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Hm(n.startAt,e.startAt)&&Hm(n.endAt,e.endAt)}function Lc(n){return Y.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Oc(n,e){return n.filters.filter((t=>t instanceof Le&&t.field.isEqual(e)))}function Km(n,e,t){let s=cc,r=!0;for(const a of Oc(n,e)){let o=cc,c=!0;switch(a.op){case"<":case"<=":o=hE(a.value);break;case"==":case"in":case">=":o=a.value;break;case">":o=a.value,c=!1;break;case"!=":case"not-in":o=cc}qm({value:s,inclusive:r},{value:o,inclusive:c})<0&&(s=o,r=c)}if(t!==null){for(let a=0;a<n.orderBy.length;++a)if(n.orderBy[a].field.isEqual(e)){const o=t.position[a];qm({value:s,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}function Wm(n,e,t){let s=Us,r=!0;for(const a of Oc(n,e)){let o=Us,c=!0;switch(a.op){case">=":case">":o=fE(a.value),c=!1;break;case"==":case"in":case"<=":o=a.value;break;case"<":o=a.value,c=!1;break;case"!=":case"not-in":o=Us}zm({value:s,inclusive:r},{value:o,inclusive:c})>0&&(s=o,r=c)}if(t!==null){for(let a=0;a<n.orderBy.length;++a)if(n.orderBy[a].field.isEqual(e)){const o=t.position[a];zm({value:s,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e,t=null,s=[],r=[],a=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=a,this.limitType=o,this.startAt=c,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function vE(n,e,t,s,r,a,o,c){return new Gi(n,e,t,s,r,a,o,c)}function fo(n){return new Gi(n)}function Qm(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Oy(n){return n.collectionGroup!==null}function Ra(n){const e=we(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const a of e.explicitOrderBy)e.Ie.push(a),t.add(a.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new Ye(it.comparator);return o.filters.forEach((u=>{u.getFlattenedFilters().forEach((d=>{d.isInequality()&&(c=c.add(d.field))}))})),c})(e).forEach((a=>{t.has(a.canonicalString())||a.isKeyField()||e.Ie.push(new Ja(a,s))})),t.has(it.keyField().canonicalString())||e.Ie.push(new Ja(it.keyField(),s))}return e.Ie}function bn(n){const e=we(n);return e.Ee||(e.Ee=IE(e,Ra(n))),e.Ee}function IE(n,e){if(n.limitType==="F")return Wu(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const a=r.dir==="desc"?"asc":"desc";return new Ja(r.field,a)}));const t=n.endAt?new Vi(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Vi(n.startAt.position,n.startAt.inclusive):null;return Wu(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function Qu(n,e){const t=n.filters.concat([e]);return new Gi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Mc(n,e,t){return new Gi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function pl(n,e){return ho(bn(n),bn(e))&&n.limitType===e.limitType}function My(n){return`${Rr(bn(n))}|lt:${n.limitType}`}function li(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>Dy(r))).join(", ")}]`),lo(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>Di(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>Di(r))).join(",")),`Target(${s})`})(bn(n))}; limitType=${n.limitType})`}function mo(n,e){return e.isFoundDocument()&&(function(s,r){const a=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(a):Y.isDocumentKey(s.path)?s.path.isEqual(a):s.path.isImmediateParentOf(a)})(n,e)&&(function(s,r){for(const a of Ra(s))if(!a.field.isKeyField()&&r.data.field(a.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const a of s.filters)if(!a.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(o,c,u){const d=Gm(o,c,u);return o.inclusive?d<=0:d<0})(s.startAt,Ra(s),r)||s.endAt&&!(function(o,c,u){const d=Gm(o,c,u);return o.inclusive?d>=0:d>0})(s.endAt,Ra(s),r))})(n,e)}function TE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Uy(n){return(e,t)=>{let s=!1;for(const r of Ra(n)){const a=NE(r,e,t);if(a!==0)return a;s=s||r.field.isKeyField()}return 0}}function NE(n,e,t){const s=n.field.isKeyField()?Y.comparator(e.key,t.key):(function(a,o,c){const u=o.data.field(a),d=c.data.field(a);return u!==null&&d!==null?Js(u,d):ne(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return ne(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,a]of s)if(this.equalsFn(r,e))return a}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let a=0;a<r.length;a++)if(this.equalsFn(r[a][0],e))return void(r[a]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){tr(this.inner,((t,s)=>{for(const[r,a]of s)e(r,a)}))}isEmpty(){return wy(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EE=new rt(Y.comparator);function hn(){return EE}const Fy=new rt(Y.comparator);function ya(...n){let e=Fy;for(const t of n)e=e.insert(t.key,t);return e}function By(n){let e=Fy;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function qn(){return Pa()}function $y(){return Pa()}function Pa(){return new ms((n=>n.toString()),((n,e)=>n.isEqual(e)))}const AE=new rt(Y.comparator),jE=new Ye(Y.comparator);function Se(...n){let e=jE;for(const t of n)e=e.add(t);return e}const kE=new Ye(Ie);function CE(){return kE}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nh(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$a(e)?"-0":e}}function qy(n){return{integerValue:""+n}}function zy(n,e){return ON(e)?qy(e):nh(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gl{constructor(){this._=void 0}}function SE(n,e,t){return n instanceof Oi?(function(r,a){const o={fields:{[Iy]:{stringValue:vy},[Ny]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return a&&Xd(a)&&(a=fl(a)),a&&(o.fields[Ty]=a),{mapValue:o}})(t,e):n instanceof Pr?Hy(n,e):n instanceof Mi?Ky(n,e):(function(r,a){const o=Gy(r,a),c=Jm(o)+Jm(r.Ae);return Gu(o)&&Gu(r.Ae)?qy(c):nh(r.serializer,c)})(n,e)}function RE(n,e,t){return n instanceof Pr?Hy(n,e):n instanceof Mi?Ky(n,e):t}function Gy(n,e){return n instanceof Ui?(function(s){return Gu(s)||(function(a){return!!a&&"doubleValue"in a})(s)})(e)?e:{integerValue:0}:null}class Oi extends gl{}class Pr extends gl{constructor(e){super(),this.elements=e}}function Hy(n,e){const t=Wy(e);for(const s of n.elements)t.some((r=>Jn(r,s)))||t.push(s);return{arrayValue:{values:t}}}class Mi extends gl{constructor(e){super(),this.elements=e}}function Ky(n,e){let t=Wy(e);for(const s of n.elements)t=t.filter((r=>!Jn(r,s)));return{arrayValue:{values:t}}}class Ui extends gl{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Jm(n){return nt(n.integerValue||n.doubleValue)}function Wy(n){return Qa(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xl{constructor(e,t){this.field=e,this.transform=t}}function PE(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof Pr&&r instanceof Pr||s instanceof Mi&&r instanceof Mi?ji(s.elements,r.elements,Jn):s instanceof Ui&&r instanceof Ui?Jn(s.Ae,r.Ae):s instanceof Oi&&r instanceof Oi})(n.transform,e.transform)}class DE{constructor(e,t){this.version=e,this.transformResults=t}}class dt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new dt}static exists(e){return new dt(void 0,e)}static updateTime(e){return new dt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function dc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class yl{}function Qy(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new po(n.key,dt.none()):new Hi(n.key,n.data,dt.none());{const t=n.data,s=Ct.empty();let r=new Ye(it.comparator);for(let a of e.fields)if(!r.has(a)){let o=t.field(a);o===null&&a.length>1&&(a=a.popLast(),o=t.field(a)),o===null?s.delete(a):s.set(a,o),r=r.add(a)}return new ps(n.key,s,new Xt(r.toArray()),dt.none())}}function VE(n,e,t){n instanceof Hi?(function(r,a,o){const c=r.value.clone(),u=Xm(r.fieldTransforms,a,o.transformResults);c.setAll(u),a.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(n,e,t):n instanceof ps?(function(r,a,o){if(!dc(r.precondition,a))return void a.convertToUnknownDocument(o.version);const c=Xm(r.fieldTransforms,a,o.transformResults),u=a.data;u.setAll(Jy(r)),u.setAll(c),a.convertToFoundDocument(o.version,u).setHasCommittedMutations()})(n,e,t):(function(r,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function Da(n,e,t,s){return n instanceof Hi?(function(a,o,c,u){if(!dc(a.precondition,o))return c;const d=a.value.clone(),h=Zm(a.fieldTransforms,u,o);return d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null})(n,e,t,s):n instanceof ps?(function(a,o,c,u){if(!dc(a.precondition,o))return c;const d=Zm(a.fieldTransforms,u,o),h=o.data;return h.setAll(Jy(a)),h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),c===null?null:c.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map((m=>m.field)))})(n,e,t,s):(function(a,o,c){return dc(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c})(n,e,t)}function LE(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),a=Gy(s.transform,r||null);a!=null&&(t===null&&(t=Ct.empty()),t.set(s.field,a))}return t||null}function Ym(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&ji(s,r,((a,o)=>PE(a,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Hi extends yl{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ps extends yl{constructor(e,t,s,r,a=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function Jy(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function Xm(n,e,t){const s=new Map;ie(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const a=n[r],o=a.transform,c=e.data.field(a.field);s.set(a.field,RE(o,c,t[r]))}return s}function Zm(n,e,t){const s=new Map;for(const r of n){const a=r.transform,o=t.data.field(r.field);s.set(r.field,SE(a,o,e))}return s}class po extends yl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sh extends yl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const a=this.mutations[r];a.key.isEqual(e.key)&&VE(a,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Da(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Da(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=$y();return this.mutations.forEach((r=>{const a=e.get(r.key),o=a.overlayedDocument;let c=this.applyToLocalView(o,a.mutatedFields);c=t.has(r.key)?null:c;const u=Qy(o,c);u!==null&&s.set(r.key,u),o.isValidDocument()||o.convertToNoDocument(le.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Se())}isEqual(e){return this.batchId===e.batchId&&ji(this.mutations,e.mutations,((t,s)=>Ym(t,s)))&&ji(this.baseMutations,e.baseMutations,((t,s)=>Ym(t,s)))}}class ih{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){ie(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return AE})();const a=e.mutations;for(let o=0;o<a.length;o++)r=r.insert(a[o].key,s[o].version);return new ih(e,t,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ft,Fe;function Yy(n){switch(n){case B.OK:return ne(64938);case B.CANCELLED:case B.UNKNOWN:case B.DEADLINE_EXCEEDED:case B.RESOURCE_EXHAUSTED:case B.INTERNAL:case B.UNAVAILABLE:case B.UNAUTHENTICATED:return!1;case B.INVALID_ARGUMENT:case B.NOT_FOUND:case B.ALREADY_EXISTS:case B.PERMISSION_DENIED:case B.FAILED_PRECONDITION:case B.ABORTED:case B.OUT_OF_RANGE:case B.UNIMPLEMENTED:case B.DATA_LOSS:return!0;default:return ne(15467,{code:n})}}function Xy(n){if(n===void 0)return Gt("GRPC error has no .code"),B.UNKNOWN;switch(n){case ft.OK:return B.OK;case ft.CANCELLED:return B.CANCELLED;case ft.UNKNOWN:return B.UNKNOWN;case ft.DEADLINE_EXCEEDED:return B.DEADLINE_EXCEEDED;case ft.RESOURCE_EXHAUSTED:return B.RESOURCE_EXHAUSTED;case ft.INTERNAL:return B.INTERNAL;case ft.UNAVAILABLE:return B.UNAVAILABLE;case ft.UNAUTHENTICATED:return B.UNAUTHENTICATED;case ft.INVALID_ARGUMENT:return B.INVALID_ARGUMENT;case ft.NOT_FOUND:return B.NOT_FOUND;case ft.ALREADY_EXISTS:return B.ALREADY_EXISTS;case ft.PERMISSION_DENIED:return B.PERMISSION_DENIED;case ft.FAILED_PRECONDITION:return B.FAILED_PRECONDITION;case ft.ABORTED:return B.ABORTED;case ft.OUT_OF_RANGE:return B.OUT_OF_RANGE;case ft.UNIMPLEMENTED:return B.UNIMPLEMENTED;case ft.DATA_LOSS:return B.DATA_LOSS;default:return ne(39323,{code:n})}}(Fe=ft||(ft={}))[Fe.OK=0]="OK",Fe[Fe.CANCELLED=1]="CANCELLED",Fe[Fe.UNKNOWN=2]="UNKNOWN",Fe[Fe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Fe[Fe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Fe[Fe.NOT_FOUND=5]="NOT_FOUND",Fe[Fe.ALREADY_EXISTS=6]="ALREADY_EXISTS",Fe[Fe.PERMISSION_DENIED=7]="PERMISSION_DENIED",Fe[Fe.UNAUTHENTICATED=16]="UNAUTHENTICATED",Fe[Fe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Fe[Fe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Fe[Fe.ABORTED=10]="ABORTED",Fe[Fe.OUT_OF_RANGE=11]="OUT_OF_RANGE",Fe[Fe.UNIMPLEMENTED=12]="UNIMPLEMENTED",Fe[Fe.INTERNAL=13]="INTERNAL",Fe[Fe.UNAVAILABLE=14]="UNAVAILABLE",Fe[Fe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ME(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UE=new Gs([4294967295,4294967295],0);function ep(n){const e=ME().encode(n),t=new Jx;return t.update(e),new Uint8Array(t.digest())}function tp(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new Gs([t,s],0),new Gs([r,a],0)]}class oh{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new _a(`Invalid padding: ${t}`);if(s<0)throw new _a(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new _a(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new _a(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Gs.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(Gs.fromNumber(s)));return r.compare(UE)===1&&(r=new Gs([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=ep(e),[s,r]=tp(t);for(let a=0;a<this.hashCount;a++){const o=this.ye(s,r,a);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new oh(a,r,t);return s.forEach((c=>o.insert(c))),o}insert(e){if(this.ge===0)return;const t=ep(e),[s,r]=tp(t);for(let a=0;a<this.hashCount;a++){const o=this.ye(s,r,a);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class _a extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l{constructor(e,t,s,r,a){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,go.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new _l(le.min(),r,new rt(Ie),hn(),Se())}}class go{constructor(e,t,s,r,a){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new go(s,t,Se(),Se(),Se())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class Zy{constructor(e,t){this.targetId=e,this.Ce=t}}class e_{constructor(e,t,s=pt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class np{constructor(){this.ve=0,this.Fe=sp(),this.Me=pt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Se(),t=Se(),s=Se();return this.Fe.forEach(((r,a)=>{switch(a){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:ne(38017,{changeType:a})}})),new go(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=sp()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ie(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class FE{constructor(e){this.Ge=e,this.ze=new Map,this.je=hn(),this.Je=Fo(),this.He=Fo(),this.Ye=new rt(Ie)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:ne(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const a=r.target;if(Lc(a))if(s===0){const o=new Y(a.path);this.et(t,o,st.newNoDocument(o,le.min()))}else ie(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const c=this.ut(e),u=c?this.ct(c,e,o):1;if(u!==0){this.it(t);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:a=0}=t;let o,c;try{o=fs(s).toUint8Array()}catch(u){if(u instanceof by)return Ua("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new oh(o,r,a)}catch(u){return Ua(u instanceof _a?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.ge===0?null:c}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((a=>{const o=this.Ge.ht(),c=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(c)||(this.et(t,a,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((a,o)=>{const c=this.ot(o);if(c){if(a.current&&Lc(c.target)){const u=new Y(c.target.path);this.It(u).has(o)||this.Et(o,u)||this.et(o,u,st.newNoDocument(u,e))}a.Be&&(t.set(o,a.ke()),a.qe())}}));let s=Se();this.He.forEach(((a,o)=>{let c=!0;o.forEachWhile((u=>{const d=this.ot(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(s=s.add(a))})),this.je.forEach(((a,o)=>o.setReadTime(e)));const r=new _l(e,t,this.Ye,this.je,s);return this.je=hn(),this.Je=Fo(),this.He=Fo(),this.Ye=new rt(Ie),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new np,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Ye(Ie),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Ye(Ie),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||G("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new np),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Fo(){return new rt(Y.comparator)}function sp(){return new rt(Y.comparator)}const BE={asc:"ASCENDING",desc:"DESCENDING"},$E={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qE={and:"AND",or:"OR"};class zE{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ju(n,e){return n.useProto3Json||lo(e)?e:{value:e}}function Fi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function t_(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function GE(n,e){return Fi(n,e.toTimestamp())}function Nt(n){return ie(!!n,49232),le.fromTimestamp((function(t){const s=hs(t);return new Qe(s.seconds,s.nanos)})(n))}function ch(n,e){return Yu(n,e).canonicalString()}function Yu(n,e){const t=(function(r){return new $e(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function n_(n){const e=$e.fromString(n);return ie(d_(e),10190,{key:e.toString()}),e}function Ya(n,e){return ch(n.databaseId,e.path)}function cs(n,e){const t=n_(e);if(t.get(1)!==n.databaseId.projectId)throw new H(B.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new H(B.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Y(i_(t))}function s_(n,e){return ch(n.databaseId,e)}function r_(n){const e=n_(n);return e.length===4?$e.emptyPath():i_(e)}function Xu(n){return new $e(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function i_(n){return ie(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function rp(n,e,t){return{name:Ya(n,e),fields:t.value.mapValue.fields}}function HE(n,e,t){const s=cs(n,e.name),r=Nt(e.updateTime),a=e.createTime?Nt(e.createTime):le.min(),o=new Ct({mapValue:{fields:e.fields}}),c=st.newFoundDocument(s,r,a,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function KE(n,e){return"found"in e?(function(s,r){ie(!!r.found,43571),r.found.name,r.found.updateTime;const a=cs(s,r.found.name),o=Nt(r.found.updateTime),c=r.found.createTime?Nt(r.found.createTime):le.min(),u=new Ct({mapValue:{fields:r.found.fields}});return st.newFoundDocument(a,o,c,u)})(n,e):"missing"in e?(function(s,r){ie(!!r.missing,3894),ie(!!r.readTime,22933);const a=cs(s,r.missing),o=Nt(r.readTime);return st.newNoDocument(a,o)})(n,e):ne(7234,{result:e})}function WE(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:ne(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],a=(function(d,h){return d.useProto3Json?(ie(h===void 0||typeof h=="string",58123),pt.fromBase64String(h||"")):(ie(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),pt.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&(function(d){const h=d.code===void 0?B.UNKNOWN:Xy(d.code);return new H(h,d.message||"")})(o);t=new e_(s,r,a,c||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=cs(n,s.document.name),a=Nt(s.document.updateTime),o=s.document.createTime?Nt(s.document.createTime):le.min(),c=new Ct({mapValue:{fields:s.document.fields}}),u=st.newFoundDocument(r,a,o,c),d=s.targetIds||[],h=s.removedTargetIds||[];t=new hc(d,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=cs(n,s.document),a=s.readTime?Nt(s.readTime):le.min(),o=st.newNoDocument(r,a),c=s.removedTargetIds||[];t=new hc([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=cs(n,s.document),a=s.removedTargetIds||[];t=new hc([],a,r,null)}else{if(!("filter"in e))return ne(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:a}=s,o=new OE(r,a),c=s.targetId;t=new Zy(c,o)}}return t}function Xa(n,e){let t;if(e instanceof Hi)t={update:rp(n,e.key,e.value)};else if(e instanceof po)t={delete:Ya(n,e.key)};else if(e instanceof ps)t={update:rp(n,e.key,e.data),updateMask:eA(e.fieldMask)};else{if(!(e instanceof sh))return ne(16599,{Vt:e.type});t={verify:Ya(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(a,o){const c=o.transform;if(c instanceof Oi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Pr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Mi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Ui)return{fieldPath:o.field.canonicalString(),increment:c.Ae};throw ne(20930,{transform:o.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,a){return a.updateTime!==void 0?{updateTime:GE(r,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:ne(27497)})(n,e.precondition)),t}function Zu(n,e){const t=e.currentDocument?(function(a){return a.updateTime!==void 0?dt.updateTime(Nt(a.updateTime)):a.exists!==void 0?dt.exists(a.exists):dt.none()})(e.currentDocument):dt.none(),s=e.updateTransforms?e.updateTransforms.map((r=>(function(o,c){let u=null;if("setToServerValue"in c)ie(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),u=new Oi;else if("appendMissingElements"in c){const h=c.appendMissingElements.values||[];u=new Pr(h)}else if("removeAllFromArray"in c){const h=c.removeAllFromArray.values||[];u=new Mi(h)}else"increment"in c?u=new Ui(o,c.increment):ne(16584,{proto:c});const d=it.fromServerFormat(c.fieldPath);return new xl(d,u)})(n,r))):[];if(e.update){e.update.name;const r=cs(n,e.update.name),a=new Ct({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=(function(u){const d=u.fieldPaths||[];return new Xt(d.map((h=>it.fromServerFormat(h))))})(e.updateMask);return new ps(r,a,o,t,s)}return new Hi(r,a,t,s)}if(e.delete){const r=cs(n,e.delete);return new po(r,t)}if(e.verify){const r=cs(n,e.verify);return new sh(r,t)}return ne(1463,{proto:e})}function QE(n,e){return n&&n.length>0?(ie(e!==void 0,14353),n.map((t=>(function(r,a){let o=r.updateTime?Nt(r.updateTime):Nt(a);return o.isEqual(le.min())&&(o=Nt(a)),new DE(o,r.transformResults||[])})(t,e)))):[]}function a_(n,e){return{documents:[s_(n,e.path)]}}function o_(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=s_(n,r);const a=(function(d){if(d.length!==0)return u_(Je.create(d,"and"))})(e.filters);a&&(t.structuredQuery.where=a);const o=(function(d){if(d.length!==0)return d.map((h=>(function(p){return{field:ui(p.field),direction:YE(p.dir)}})(h)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const c=Ju(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:r}}function c_(n){let e=r_(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){ie(s===1,65062);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let a=[];t.where&&(a=(function(m){const p=l_(m);return p instanceof Je&&th(p)?p.getFilters():[p]})(t.where));let o=[];t.orderBy&&(o=(function(m){return m.map((p=>(function(v){return new Ja(di(v.field),(function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(v.direction))})(p)))})(t.orderBy));let c=null;t.limit&&(c=(function(m){let p;return p=typeof m=="object"?m.value:m,lo(p)?null:p})(t.limit));let u=null;t.startAt&&(u=(function(m){const p=!!m.before,w=m.values||[];return new Vi(w,p)})(t.startAt));let d=null;return t.endAt&&(d=(function(m){const p=!m.before,w=m.values||[];return new Vi(w,p)})(t.endAt)),vE(e,r,o,a,c,"F",u,d)}function JE(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ne(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function l_(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=di(t.unaryFilter.field);return Le.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=di(t.unaryFilter.field);return Le.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=di(t.unaryFilter.field);return Le.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=di(t.unaryFilter.field);return Le.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ne(61313);default:return ne(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Le.create(di(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ne(58110);default:return ne(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Je.create(t.compositeFilter.filters.map((s=>l_(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return ne(1026)}})(t.compositeFilter.op))})(n):ne(30097,{filter:n})}function YE(n){return BE[n]}function XE(n){return $E[n]}function ZE(n){return qE[n]}function ui(n){return{fieldPath:n.canonicalString()}}function di(n){return it.fromServerFormat(n.fieldPath)}function u_(n){return n instanceof Le?(function(t){if(t.op==="=="){if($m(t.value))return{unaryFilter:{field:ui(t.field),op:"IS_NAN"}};if(Bm(t.value))return{unaryFilter:{field:ui(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if($m(t.value))return{unaryFilter:{field:ui(t.field),op:"IS_NOT_NAN"}};if(Bm(t.value))return{unaryFilter:{field:ui(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ui(t.field),op:XE(t.op),value:t.value}}})(n):n instanceof Je?(function(t){const s=t.getFilters().map((r=>u_(r)));return s.length===1?s[0]:{compositeFilter:{op:ZE(t.op),filters:s}}})(n):ne(54877,{filter:n})}function eA(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function d_(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(e,t,s,r,a=le.min(),o=le.min(),c=pt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new os(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new os(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new os(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new os(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h_{constructor(e){this.yt=e}}function tA(n,e){let t;if(e.document)t=HE(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=Y.fromSegments(e.noDocument.path),r=Vr(e.noDocument.readTime);t=st.newNoDocument(s,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ne(56709);{const s=Y.fromSegments(e.unknownDocument.path),r=Vr(e.unknownDocument.version);t=st.newUnknownDocument(s,r)}}return e.readTime&&t.setReadTime((function(r){const a=new Qe(r[0],r[1]);return le.fromTimestamp(a)})(e.readTime)),t}function ip(n,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Uc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=(function(a,o){return{name:Ya(a,o.key),fields:o.data.value.mapValue.fields,updateTime:Fi(a,o.version.toTimestamp()),createTime:Fi(a,o.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:Dr(e.version)};else{if(!e.isUnknownDocument())return ne(57904,{document:e});s.unknownDocument={path:t.path.toArray(),version:Dr(e.version)}}return s}function Uc(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Dr(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Vr(n){const e=new Qe(n.seconds,n.nanoseconds);return le.fromTimestamp(e)}function pr(n,e){const t=(e.baseMutations||[]).map((a=>Zu(n.yt,a)));for(let a=0;a<e.mutations.length-1;++a){const o=e.mutations[a];if(a+1<e.mutations.length&&e.mutations[a+1].transform!==void 0){const c=e.mutations[a+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(a+1,1),++a}}const s=e.mutations.map((a=>Zu(n.yt,a))),r=Qe.fromMillis(e.localWriteTimeMs);return new rh(e.batchId,r,t,s)}function wa(n){const e=Vr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Vr(n.lastLimboFreeSnapshotVersion):le.min();let s;return s=(function(a){return a.documents!==void 0})(n.query)?(function(a){const o=a.documents.length;return ie(o===1,1966,{count:o}),bn(fo(r_(a.documents[0])))})(n.query):(function(a){return bn(c_(a))})(n.query),new os(s,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,pt.fromBase64String(n.resumeToken))}function f_(n,e){const t=Dr(e.snapshotVersion),s=Dr(e.lastLimboFreeSnapshotVersion);let r;r=Lc(e.target)?a_(n.yt,e.target):o_(n.yt,e.target).ft;const a=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Rr(e.target),readTime:t,resumeToken:a,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:r}}function m_(n){const e=c_({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Mc(e,e.limit,"L"):e}function au(n,e){return new ah(e.largestBatchId,Zu(n.yt,e.overlayMutation))}function ap(n,e){const t=e.path.lastSegment();return[n,Ut(e.path.popLast()),t]}function op(n,e,t,s){return{indexId:n,uid:e,sequenceNumber:t,readTime:Dr(s.readTime),documentKey:Ut(s.documentKey.path),largestBatchId:s.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nA{getBundleMetadata(e,t){return cp(e).get(t).next((s=>{if(s)return(function(a){return{id:a.bundleId,createTime:Vr(a.createTime),version:a.version}})(s)}))}saveBundleMetadata(e,t){return cp(e).put((function(r){return{bundleId:r.id,createTime:Dr(Nt(r.createTime)),version:r.version}})(t))}getNamedQuery(e,t){return lp(e).get(t).next((s=>{if(s)return(function(a){return{name:a.name,query:m_(a.bundledQuery),readTime:Vr(a.readTime)}})(s)}))}saveNamedQuery(e,t){return lp(e).put((function(r){return{name:r.name,readTime:Dr(Nt(r.readTime)),bundledQuery:r.bundledQuery}})(t))}}function cp(n){return wt(n,ul)}function lp(n){return wt(n,dl)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wl{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const s=t.uid||"";return new wl(e,s)}getOverlay(e,t){return ua(e).get(ap(this.userId,t)).next((s=>s?au(this.serializer,s):null))}getOverlays(e,t){const s=qn();return V.forEach(t,(r=>this.getOverlay(e,r).next((a=>{a!==null&&s.set(r,a)})))).next((()=>s))}saveOverlays(e,t,s){const r=[];return s.forEach(((a,o)=>{const c=new ah(t,o);r.push(this.St(e,c))})),V.waitFor(r)}removeOverlaysForBatchId(e,t,s){const r=new Set;t.forEach((o=>r.add(Ut(o.getCollectionPath()))));const a=[];return r.forEach((o=>{const c=IDBKeyRange.bound([this.userId,o,s],[this.userId,o,s+1],!1,!0);a.push(ua(e).Z($u,c))})),V.waitFor(a)}getOverlaysForCollection(e,t,s){const r=qn(),a=Ut(t),o=IDBKeyRange.bound([this.userId,a,s],[this.userId,a,Number.POSITIVE_INFINITY],!0);return ua(e).J($u,o).next((c=>{for(const u of c){const d=au(this.serializer,u);r.set(d.getKey(),d)}return r}))}getOverlaysForCollectionGroup(e,t,s,r){const a=qn();let o;const c=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ua(e).ee({index:py,range:c},((u,d,h)=>{const m=au(this.serializer,d);a.size()<r||m.largestBatchId===o?(a.set(m.getKey(),m),o=m.largestBatchId):h.done()})).next((()=>a))}St(e,t){return ua(e).put((function(r,a,o){const[c,u,d]=ap(a,o.mutation.key);return{userId:a,collectionPath:u,documentId:d,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Xa(r.yt,o.mutation)}})(this.serializer,this.userId,t))}}function ua(n){return wt(n,hl)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sA{bt(e){return wt(e,Jd)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const s=t?.value;return s?pt.fromUint8Array(s):pt.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(nt(e.integerValue));else if("doubleValue"in e){const s=nt(e.doubleValue);isNaN(s)?this.Ft(t,13):(this.Ft(t,15),$a(s)?t.Mt(0):t.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(t,20),typeof s=="string"&&(s=hs(s)),t.xt(`${s.seconds||""}`),t.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(fs(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Ft(t,45),t.Mt(s.latitude||0),t.Mt(s.longitude||0)}else"mapValue"in e?Ay(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):ml(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ne(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const s=e.fields||{};this.Ft(t,55);for(const r of Object.keys(s))this.Ot(r,t),this.Ct(s[r],t)}kt(e,t){const s=e.fields||{};this.Ft(t,53);const r=Pi,a=s[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(nt(a)),this.Ot(r,t),this.Ct(s[r],t)}Qt(e,t){const s=e.values||[];this.Ft(t,50);for(const r of s)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),Y.fromName(e).path.forEach((s=>{this.Ft(t,60),this.Ut(s,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}gr.Kt=new gr;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ni=255;function rA(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function up(n){const e=64-(function(s){let r=0;for(let a=0;a<8;++a){const o=rA(255&s[a]);if(r+=o,o!==8)break}return r})(n);return Math.ceil(e/8)}class iA{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Gt(s.value),s=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Jt(s.value),s=t.next();this.Ht()}Yt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Gt(s);else if(s<2048)this.Gt(960|s>>>6),this.Gt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s);else{const r=t.codePointAt(0);this.Gt(240|r>>>18),this.Gt(128|63&r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r)}}this.zt()}Zt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Jt(s);else if(s<2048)this.Jt(960|s>>>6),this.Jt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s);else{const r=t.codePointAt(0);this.Jt(240|r>>>18),this.Jt(128|63&r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r)}}this.Ht()}Xt(e){const t=this.en(e),s=up(t);this.tn(1+s),this.buffer[this.position++]=255&s;for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=255&t[r]}nn(e){const t=this.en(e),s=up(t);this.tn(1+s),this.buffer[this.position++]=~(255&s);for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}rn(){this.sn(ni),this.sn(255)}_n(){this.an(ni),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(a){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,a,!1),new Uint8Array(o.buffer)})(e),s=!!(128&t[0]);t[0]^=s?255:128;for(let r=1;r<t.length;++r)t[r]^=s?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===ni?(this.sn(ni),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===ni?(this.an(ni),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const r=new Uint8Array(s);r.set(this.buffer),this.buffer=r}}class aA{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class oA{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class da{constructor(){this.cn=new iA,this.ln=new aA(this.cn),this.hn=new oA(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(e,t,s,r){this.Tn=e,this.In=t,this.En=s,this.dn=r}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,s=new Uint8Array(t);return s.set(this.dn,0),t!==e?s.set([0],this.dn.length):++s[s.length-1],new xr(this.Tn,this.In,this.En,s)}Rn(e,t,s){return{indexId:this.Tn,uid:e,arrayValue:fc(this.En),directionalValue:fc(this.dn),orderedDocumentKey:fc(t),documentKey:s.path.toArray()}}Vn(e,t,s){const r=this.Rn(e,t,s);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function js(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=dp(n.En,e.En),t!==0?t:(t=dp(n.dn,e.dn),t!==0?t:Y.comparator(n.In,e.In)))}function dp(n,e){for(let t=0;t<n.length&&t<e.length;++t){const s=n[t]-e[t];if(s!==0)return s}return n.length-e.length}function fc(n){return hx()?(function(t){let s="";for(let r=0;r<t.length;r++)s+=String.fromCharCode(t[r]);return s})(n):n}function hp(n){return typeof n!="string"?n:(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(n)}class fp{constructor(e){this.mn=new Ye(((t,s)=>it.comparator(t.field,s.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const s=t;s.isInequality()?this.mn=this.mn.add(s):this.gn.push(s)}}get pn(){return this.mn.size>1}yn(e){if(ie(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Uu(e);if(t!==void 0&&!this.wn(t))return!1;const s=hr(e);let r=new Set,a=0,o=0;for(;a<s.length&&this.wn(s[a]);++a)r=r.add(s[a].fieldPath.canonicalString());if(a===s.length)return!0;if(this.mn.size>0){const c=this.mn.getIterator().getNext();if(!r.has(c.field.canonicalString())){const u=s[a];if(!this.Sn(c,u)||!this.bn(this.fn[o++],u))return!1}++a}for(;a<s.length;++a){const c=s[a];if(o>=this.fn.length||!this.bn(this.fn[o++],c))return!1}return!0}Dn(){if(this.pn)return null;let e=new Ye(it.comparator);const t=[];for(const s of this.gn)if(!s.field.isKeyField())if(s.op==="array-contains"||s.op==="array-contains-any")t.push(new ic(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new ic(s.field,0))}for(const s of this.fn)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new ic(s.field,s.dir==="asc"?0:1)));return new Sc(Sc.UNKNOWN_ID,this.collectionId,t,Ba.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const s=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===s}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p_(n){if(ie(n instanceof Le||n instanceof Je,20012),n instanceof Le){if(n instanceof Ly){const t=n.value.arrayValue?.values?.map((s=>Le.create(n.field,"==",s)))||[];return Je.create(t,"or")}return n}const e=n.filters.map((t=>p_(t)));return Je.create(e,n.op)}function cA(n){if(n.getFilters().length===0)return[];const e=nd(p_(n));return ie(g_(e),7391),ed(e)||td(e)?[e]:e.getFilters()}function ed(n){return n instanceof Le}function td(n){return n instanceof Je&&th(n)}function g_(n){return ed(n)||td(n)||(function(t){if(t instanceof Je&&Hu(t)){for(const s of t.getFilters())if(!ed(s)&&!td(s))return!1;return!0}return!1})(n)}function nd(n){if(ie(n instanceof Le||n instanceof Je,34018),n instanceof Le)return n;if(n.filters.length===1)return nd(n.filters[0]);const e=n.filters.map((s=>nd(s)));let t=Je.create(e,n.op);return t=Fc(t),g_(t)?t:(ie(t instanceof Je,64498),ie(Li(t),40251),ie(t.filters.length>1,57927),t.filters.reduce(((s,r)=>lh(s,r))))}function lh(n,e){let t;return ie(n instanceof Le||n instanceof Je,38388),ie(e instanceof Le||e instanceof Je,25473),t=n instanceof Le?e instanceof Le?(function(r,a){return Je.create([r,a],"and")})(n,e):mp(n,e):e instanceof Le?mp(e,n):(function(r,a){if(ie(r.filters.length>0&&a.filters.length>0,48005),Li(r)&&Li(a))return Py(r,a.getFilters());const o=Hu(r)?r:a,c=Hu(r)?a:r,u=o.filters.map((d=>lh(d,c)));return Je.create(u,"or")})(n,e),Fc(t)}function mp(n,e){if(Li(e))return Py(e,n.getFilters());{const t=e.filters.map((s=>lh(n,s)));return Je.create(t,"or")}}function Fc(n){if(ie(n instanceof Le||n instanceof Je,11850),n instanceof Le)return n;const e=n.getFilters();if(e.length===1)return Fc(e[0]);if(Sy(n))return n;const t=e.map((r=>Fc(r))),s=[];return t.forEach((r=>{r instanceof Le?s.push(r):r instanceof Je&&(r.op===n.op?s.push(...r.filters):s.push(r))})),s.length===1?s[0]:Je.create(s,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lA{constructor(){this.Cn=new uh}addToCollectionParentIndex(e,t){return this.Cn.add(t),V.resolve()}getCollectionParents(e,t){return V.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return V.resolve()}deleteFieldIndex(e,t){return V.resolve()}deleteAllFieldIndexes(e){return V.resolve()}createTargetIndexes(e,t){return V.resolve()}getDocumentsMatchingTarget(e,t){return V.resolve(null)}getIndexType(e,t){return V.resolve(0)}getFieldIndexes(e,t){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,t){return V.resolve(pn.min())}getMinOffsetFromCollectionGroup(e,t){return V.resolve(pn.min())}updateCollectionGroup(e,t,s){return V.resolve()}updateIndexEntries(e,t){return V.resolve()}}class uh{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Ye($e.comparator),a=!r.has(s);return this.index[t]=r.add(s),a}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Ye($e.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pp="IndexedDbIndexManager",Bo=new Uint8Array(0);class uA{constructor(e,t){this.databaseId=t,this.vn=new uh,this.Fn=new ms((s=>Rr(s)),((s,r)=>ho(s,r))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const s=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const a={collectionId:s,parent:Ut(r)};return gp(e).put(a)}return V.resolve()}getCollectionParents(e,t){const s=[],r=IDBKeyRange.bound([t,""],[sy(t),""],!1,!0);return gp(e).J(r).next((a=>{for(const o of a){if(o.collectionId!==t)break;s.push($n(o.parent))}return s}))}addFieldIndex(e,t){const s=ha(e),r=(function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map((u=>[u.fieldPath.canonicalString(),u.kind]))}})(t);delete r.indexId;const a=s.add(r);if(t.indexState){const o=ri(e);return a.next((c=>{o.put(op(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return a.next()}deleteFieldIndex(e,t){const s=ha(e),r=ri(e),a=si(e);return s.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>a.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=ha(e),s=si(e),r=ri(e);return t.Z().next((()=>s.Z())).next((()=>r.Z()))}createTargetIndexes(e,t){return V.forEach(this.Mn(t),(s=>this.getIndexType(e,s).next((r=>{if(r===0||r===1){const a=new fp(s).Dn();if(a!=null)return this.addFieldIndex(e,a)}}))))}getDocumentsMatchingTarget(e,t){const s=si(e);let r=!0;const a=new Map;return V.forEach(this.Mn(t),(o=>this.xn(e,o).next((c=>{r&&(r=!!c),a.set(o,c)})))).next((()=>{if(r){let o=Se();const c=[];return V.forEach(a,((u,d)=>{G(pp,`Using index ${(function(C){return`id=${C.indexId}|cg=${C.collectionGroup}|f=${C.fields.map((S=>`${S.fieldPath}:${S.kind}`)).join(",")}`})(u)} to execute ${Rr(t)}`);const h=(function(C,S){const D=Uu(S);if(D===void 0)return null;for(const M of Oc(C,D.fieldPath))switch(M.op){case"array-contains-any":return M.value.arrayValue.values||[];case"array-contains":return[M.value]}return null})(d,u),m=(function(C,S){const D=new Map;for(const M of hr(S))for(const _ of Oc(C,M.fieldPath))switch(_.op){case"==":case"in":D.set(M.fieldPath.canonicalString(),_.value);break;case"not-in":case"!=":return D.set(M.fieldPath.canonicalString(),_.value),Array.from(D.values())}return null})(d,u),p=(function(C,S){const D=[];let M=!0;for(const _ of hr(S)){const y=_.kind===0?Km(C,_.fieldPath,C.startAt):Wm(C,_.fieldPath,C.startAt);D.push(y.value),M&&(M=y.inclusive)}return new Vi(D,M)})(d,u),w=(function(C,S){const D=[];let M=!0;for(const _ of hr(S)){const y=_.kind===0?Wm(C,_.fieldPath,C.endAt):Km(C,_.fieldPath,C.endAt);D.push(y.value),M&&(M=y.inclusive)}return new Vi(D,M)})(d,u),v=this.On(u,d,p),j=this.On(u,d,w),k=this.Nn(u,d,m),P=this.Bn(u.indexId,h,v,p.inclusive,j,w.inclusive,k);return V.forEach(P,(R=>s.Y(R,t.limit).next((C=>{C.forEach((S=>{const D=Y.fromSegments(S.documentKey);o.has(D)||(o=o.add(D),c.push(D))}))}))))})).next((()=>c))}return V.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=cA(Je.create(e.filters,"and")).map((s=>Wu(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,s,r,a,o,c){const u=(t!=null?t.length:1)*Math.max(s.length,a.length),d=u/(t!=null?t.length:1),h=[];for(let m=0;m<u;++m){const p=t?this.Ln(t[m/d]):Bo,w=this.kn(e,p,s[m%d],r),v=this.qn(e,p,a[m%d],o),j=c.map((k=>this.kn(e,p,k,!0)));h.push(...this.createRange(w,v,j))}return h}kn(e,t,s,r){const a=new xr(e,Y.empty(),t,s);return r?a:a.An()}qn(e,t,s,r){const a=new xr(e,Y.empty(),t,s);return r?a.An():a}xn(e,t){const s=new fp(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((a=>{let o=null;for(const c of a)s.yn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o}))}getIndexType(e,t){let s=2;const r=this.Mn(t);return V.forEach(r,(a=>this.xn(e,a).next((o=>{o?s!==0&&o.fields.length<(function(u){let d=new Ye(it.comparator),h=!1;for(const m of u.filters)for(const p of m.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:d=d.add(p.field));for(const m of u.orderBy)m.field.isKeyField()||(d=d.add(m.field));return d.size+(h?1:0)})(a)&&(s=1):s=0})))).next((()=>(function(o){return o.limit!==null})(t)&&r.length>1&&s===2?1:s))}Qn(e,t){const s=new da;for(const r of hr(e)){const a=t.data.field(r.fieldPath);if(a==null)return null;const o=s.Pn(r.kind);gr.Kt.Dt(a,o)}return s.un()}Ln(e){const t=new da;return gr.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const s=new da;return gr.Kt.Dt(Wa(this.databaseId,t),s.Pn((function(a){const o=hr(a);return o.length===0?0:o[o.length-1].kind})(e))),s.un()}Nn(e,t,s){if(s===null)return[];let r=[];r.push(new da);let a=0;for(const o of hr(e)){const c=s[a++];for(const u of r)if(this.Un(t,o.fieldPath)&&Qa(c))r=this.Kn(r,o,c);else{const d=u.Pn(o.kind);gr.Kt.Dt(c,d)}}return this.Wn(r)}On(e,t,s){return this.Nn(e,t,s.position)}Wn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].un();return t}Kn(e,t,s){const r=[...e],a=[];for(const o of s.arrayValue.values||[])for(const c of r){const u=new da;u.seed(c.un()),gr.Kt.Dt(o,u.Pn(t.kind)),a.push(u)}return a}Un(e,t){return!!e.filters.find((s=>s instanceof Le&&s.field.isEqual(t)&&(s.op==="in"||s.op==="not-in")))}getFieldIndexes(e,t){const s=ha(e),r=ri(e);return(t?s.J(Bu,IDBKeyRange.bound(t,t)):s.J()).next((a=>{const o=[];return V.forEach(a,(c=>r.get([c.indexId,this.uid]).next((u=>{o.push((function(h,m){const p=m?new Ba(m.sequenceNumber,new pn(Vr(m.readTime),new Y($n(m.documentKey)),m.largestBatchId)):Ba.empty(),w=h.fields.map((([v,j])=>new ic(it.fromServerFormat(v),j)));return new Sc(h.indexId,h.collectionGroup,w,p)})(c,u))})))).next((()=>o))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((s,r)=>{const a=s.indexState.sequenceNumber-r.indexState.sequenceNumber;return a!==0?a:Ie(s.collectionGroup,r.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,s){const r=ha(e),a=ri(e);return this.Gn(e).next((o=>r.J(Bu,IDBKeyRange.bound(t,t)).next((c=>V.forEach(c,(u=>a.put(op(u.indexId,this.uid,o,s))))))))}updateIndexEntries(e,t){const s=new Map;return V.forEach(t,((r,a)=>{const o=s.get(r.collectionGroup);return(o?V.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next((c=>(s.set(r.collectionGroup,c),V.forEach(c,(u=>this.zn(e,r,u).next((d=>{const h=this.jn(a,u);return d.isEqual(h)?V.resolve():this.Jn(e,a,u,d,h)})))))))}))}Hn(e,t,s,r){return si(e).put(r.Rn(this.uid,this.$n(s,t.key),t.key))}Yn(e,t,s,r){return si(e).delete(r.Vn(this.uid,this.$n(s,t.key),t.key))}zn(e,t,s){const r=si(e);let a=new Ye(js);return r.ee({index:my,range:IDBKeyRange.only([s.indexId,this.uid,fc(this.$n(s,t))])},((o,c)=>{a=a.add(new xr(s.indexId,t,hp(c.arrayValue),hp(c.directionalValue)))})).next((()=>a))}jn(e,t){let s=new Ye(js);const r=this.Qn(t,e);if(r==null)return s;const a=Uu(t);if(a!=null){const o=e.data.field(a.fieldPath);if(Qa(o))for(const c of o.arrayValue.values||[])s=s.add(new xr(t.indexId,e.key,this.Ln(c),r))}else s=s.add(new xr(t.indexId,e.key,Bo,r));return s}Jn(e,t,s,r,a){G(pp,"Updating index entries for document '%s'",t.key);const o=[];return(function(u,d,h,m,p){const w=u.getIterator(),v=d.getIterator();let j=ti(w),k=ti(v);for(;j||k;){let P=!1,R=!1;if(j&&k){const C=h(j,k);C<0?R=!0:C>0&&(P=!0)}else j!=null?R=!0:P=!0;P?(m(k),k=ti(v)):R?(p(j),j=ti(w)):(j=ti(w),k=ti(v))}})(r,a,js,(c=>{o.push(this.Hn(e,t,s,c))}),(c=>{o.push(this.Yn(e,t,s,c))})),V.waitFor(o)}Gn(e){let t=1;return ri(e).ee({index:fy,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((s,r,a)=>{a.done(),t=r.sequenceNumber+1})).next((()=>t))}createRange(e,t,s){s=s.sort(((o,c)=>js(o,c))).filter(((o,c,u)=>!c||js(o,u[c-1])!==0));const r=[];r.push(e);for(const o of s){const c=js(o,e),u=js(o,t);if(c===0)r[0]=e.An();else if(c>0&&u<0)r.push(o),r.push(o.An());else if(u>0)break}r.push(t);const a=[];for(let o=0;o<r.length;o+=2){if(this.Zn(r[o],r[o+1]))return[];const c=r[o].Vn(this.uid,Bo,Y.empty()),u=r[o+1].Vn(this.uid,Bo,Y.empty());a.push(IDBKeyRange.bound(c,u))}return a}Zn(e,t){return js(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(xp)}getMinOffset(e,t){return V.mapArray(this.Mn(t),(s=>this.xn(e,s).next((r=>r||ne(44426))))).next(xp)}}function gp(n){return wt(n,Ga)}function si(n){return wt(n,Ca)}function ha(n){return wt(n,Qd)}function ri(n){return wt(n,ka)}function xp(n){ie(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<n.length;s++){const r=n[s].indexState.offset;Hd(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new pn(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},x_=41943040;class Ot{static withCacheSize(e){return new Ot(e,Ot.DEFAULT_COLLECTION_PERCENTILE,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y_(n,e,t){const s=n.store(Nn),r=n.store(ki),a=[],o=IDBKeyRange.only(t.batchId);let c=0;const u=s.ee({range:o},((h,m,p)=>(c++,p.delete())));a.push(u.next((()=>{ie(c===1,47070,{batchId:t.batchId})})));const d=[];for(const h of t.mutations){const m=uy(e,h.key.path,t.batchId);a.push(r.delete(m)),d.push(h.key)}return V.waitFor(a).next((()=>d))}function Bc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ne(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ot.DEFAULT_COLLECTION_PERCENTILE=10,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ot.DEFAULT=new Ot(x_,Ot.DEFAULT_COLLECTION_PERCENTILE,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ot.DISABLED=new Ot(-1,0,0);class bl{constructor(e,t,s,r){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=r,this.Xn={}}static wt(e,t,s,r){ie(e.uid!=="",64387);const a=e.isAuthenticated()?e.uid:"";return new bl(a,t,s,r)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ks(e).ee({index:_r,range:s},((r,a,o)=>{t=!1,o.done()})).next((()=>t))}addMutationBatch(e,t,s,r){const a=hi(e),o=ks(e);return o.add({}).next((c=>{ie(typeof c=="number",49019);const u=new rh(c,t,s,r),d=(function(w,v,j){const k=j.baseMutations.map((R=>Xa(w.yt,R))),P=j.mutations.map((R=>Xa(w.yt,R)));return{userId:v,batchId:j.batchId,localWriteTimeMs:j.localWriteTime.toMillis(),baseMutations:k,mutations:P}})(this.serializer,this.userId,u),h=[];let m=new Ye(((p,w)=>Ie(p.canonicalString(),w.canonicalString())));for(const p of r){const w=uy(this.userId,p.key.path,c);m=m.add(p.key.path.popLast()),h.push(o.put(d)),h.push(a.put(w,FN))}return m.forEach((p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))})),e.addOnCommittedListener((()=>{this.Xn[c]=u.keys()})),V.waitFor(h).next((()=>u))}))}lookupMutationBatch(e,t){return ks(e).get(t).next((s=>s?(ie(s.userId===this.userId,48,"Unexpected user for mutation batch",{userId:s.userId,batchId:t}),pr(this.serializer,s)):null))}er(e,t){return this.Xn[t]?V.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((s=>{if(s){const r=s.keys();return this.Xn[t]=r,r}return null}))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=IDBKeyRange.lowerBound([this.userId,s]);let a=null;return ks(e).ee({index:_r,range:r},((o,c,u)=>{c.userId===this.userId&&(ie(c.batchId>=s,47524,{tr:s}),a=pr(this.serializer,c)),u.done()})).next((()=>a))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=Ir;return ks(e).ee({index:_r,range:t,reverse:!0},((r,a,o)=>{s=a.batchId,o.done()})).next((()=>s))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Ir],[this.userId,Number.POSITIVE_INFINITY]);return ks(e).J(_r,t).next((s=>s.map((r=>pr(this.serializer,r)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=ac(this.userId,t.path),r=IDBKeyRange.lowerBound(s),a=[];return hi(e).ee({range:r},((o,c,u)=>{const[d,h,m]=o,p=$n(h);if(d===this.userId&&t.path.isEqual(p))return ks(e).get(m).next((w=>{if(!w)throw ne(61480,{nr:o,batchId:m});ie(w.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:w.userId,batchId:m}),a.push(pr(this.serializer,w))}));u.done()})).next((()=>a))}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ye(Ie);const r=[];return t.forEach((a=>{const o=ac(this.userId,a.path),c=IDBKeyRange.lowerBound(o),u=hi(e).ee({range:c},((d,h,m)=>{const[p,w,v]=d,j=$n(w);p===this.userId&&a.path.isEqual(j)?s=s.add(v):m.done()}));r.push(u)})),V.waitFor(r).next((()=>this.rr(e,s)))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1,a=ac(this.userId,s),o=IDBKeyRange.lowerBound(a);let c=new Ye(Ie);return hi(e).ee({range:o},((u,d,h)=>{const[m,p,w]=u,v=$n(p);m===this.userId&&s.isPrefixOf(v)?v.length===r&&(c=c.add(w)):h.done()})).next((()=>this.rr(e,c)))}rr(e,t){const s=[],r=[];return t.forEach((a=>{r.push(ks(e).get(a).next((o=>{if(o===null)throw ne(35274,{batchId:a});ie(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:a}),s.push(pr(this.serializer,o))})))})),V.waitFor(r).next((()=>s))}removeMutationBatch(e,t){return y_(e.le,this.userId,t).next((s=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),V.forEach(s,(r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return V.resolve();const s=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),r=[];return hi(e).ee({range:s},((a,o,c)=>{if(a[0]===this.userId){const u=$n(a[1]);r.push(u)}else c.done()})).next((()=>{ie(r.length===0,56720,{sr:r.map((a=>a.canonicalString()))})}))}))}containsKey(e,t){return __(e,this.userId,t)}_r(e){return w_(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Ir,lastStreamToken:""}))}}function __(n,e,t){const s=ac(e,t.path),r=s[1],a=IDBKeyRange.lowerBound(s);let o=!1;return hi(n).ee({range:a,X:!0},((c,u,d)=>{const[h,m,p]=c;h===e&&m===r&&(o=!0),d.done()})).next((()=>o))}function ks(n){return wt(n,Nn)}function hi(n){return wt(n,ki)}function w_(n){return wt(n,qa)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lr{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Lr(0)}static cr(){return new Lr(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const s=new Lr(t.highestTargetId);return t.highestTargetId=s.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>le.fromTimestamp(new Qe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,s){return this.lr(e).next((r=>(r.highestListenSequenceNumber=t,s&&(r.lastRemoteSnapshotVersion=s.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((s=>(s.targetCount+=1,this.Tr(t,s),this.hr(e,s))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>ii(e).delete(t.targetId))).next((()=>this.lr(e))).next((s=>(ie(s.targetCount>0,8065),s.targetCount-=1,this.hr(e,s))))}removeTargets(e,t,s){let r=0;const a=[];return ii(e).ee(((o,c)=>{const u=wa(c);u.sequenceNumber<=t&&s.get(u.targetId)===null&&(r++,a.push(this.removeTargetData(e,u)))})).next((()=>V.waitFor(a))).next((()=>r))}forEachTarget(e,t){return ii(e).ee(((s,r)=>{const a=wa(r);t(a)}))}lr(e){return _p(e).get(Dc).next((t=>(ie(t!==null,2888),t)))}hr(e,t){return _p(e).put(Dc,t)}Pr(e,t){return ii(e).put(f_(this.serializer,t))}Tr(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const s=Rr(t),r=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let a=null;return ii(e).ee({range:r,index:hy},((o,c,u)=>{const d=wa(c);ho(t,d.target)&&(a=d,u.done())})).next((()=>a))}addMatchingKeys(e,t,s){const r=[],a=Ls(e);return t.forEach((o=>{const c=Ut(o.path);r.push(a.put({targetId:s,path:c})),r.push(this.referenceDelegate.addReference(e,s,o))})),V.waitFor(r)}removeMatchingKeys(e,t,s){const r=Ls(e);return V.forEach(t,(a=>{const o=Ut(a.path);return V.waitFor([r.delete([s,o]),this.referenceDelegate.removeReference(e,s,a)])}))}removeMatchingKeysForTargetId(e,t){const s=Ls(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(r)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ls(e);let a=Se();return r.ee({range:s,X:!0},((o,c,u)=>{const d=$n(o[1]),h=new Y(d);a=a.add(h)})).next((()=>a))}containsKey(e,t){const s=Ut(t.path),r=IDBKeyRange.bound([s],[sy(s)],!1,!0);let a=0;return Ls(e).ee({index:Wd,X:!0,range:r},(([o,c],u,d)=>{o!==0&&(a++,d.done())})).next((()=>a>0))}At(e,t){return ii(e).get(t).next((s=>s?wa(s):null))}}function ii(n){return wt(n,Ci)}function _p(n){return wt(n,Tr)}function Ls(n){return wt(n,Si)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wp="LruGarbageCollector",b_=1048576;function bp([n,e],[t,s]){const r=Ie(n,t);return r===0?Ie(e,s):r}class hA{constructor(e){this.Ir=e,this.buffer=new Ye(bp),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();bp(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class v_{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){G(wp,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){er(t)?G(wp,"Ignoring IndexedDB error during garbage collection: ",t):await Gr(t)}await this.Vr(3e5)}))}}class fA{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return V.resolve(wn.ce);const s=new hA(t);return this.mr.forEachTarget(e,(r=>s.Ar(r.sequenceNumber))).next((()=>this.mr.pr(e,(r=>s.Ar(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(G("LruGarbageCollector","Garbage collection skipped; disabled"),V.resolve(yp)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(G("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),yp):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,a,o,c,u,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(G("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),r=this.params.maximumSequenceNumbersToCollect):r=m,o=Date.now(),this.nthSequenceNumber(e,r)))).next((m=>(s=m,c=Date.now(),this.removeTargets(e,s,t)))).next((m=>(a=m,u=Date.now(),this.removeOrphanedDocuments(e,s)))).next((m=>(d=Date.now(),ci()<=Ve.DEBUG&&G("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${r} in `+(c-o)+`ms
	Removed ${a} targets in `+(u-c)+`ms
	Removed ${m} documents in `+(d-u)+`ms
Total Duration: ${d-h}ms`),V.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:a,documentsRemoved:m}))))}}function I_(n,e){return new fA(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mA{constructor(e,t){this.db=e,this.garbageCollector=I_(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((s,r)=>t(r)))}addReference(e,t,s){return $o(e,s)}removeReference(e,t,s){return $o(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return $o(e,t)}br(e,t){return(function(r,a){let o=!1;return w_(r).te((c=>__(r,c,a).next((u=>(u&&(o=!0),V.resolve(!u)))))).next((()=>o))})(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let a=0;return this.Sr(e,((o,c)=>{if(c<=t){const u=this.br(e,o).next((d=>{if(!d)return a++,s.getEntry(e,o).next((()=>(s.removeEntry(o,le.min()),Ls(e).delete((function(m){return[0,Ut(m.path)]})(o)))))}));r.push(u)}})).next((()=>V.waitFor(r))).next((()=>s.apply(e))).next((()=>a))}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return $o(e,t)}Sr(e,t){const s=Ls(e);let r,a=wn.ce;return s.ee({index:Wd},(([o,c],{path:u,sequenceNumber:d})=>{o===0?(a!==wn.ce&&t(new Y($n(r)),a),a=d,r=u):a=wn.ce})).next((()=>{a!==wn.ce&&t(new Y($n(r)),a)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function $o(n,e){return Ls(n).put((function(s,r){return{targetId:0,path:Ut(s.path),sequenceNumber:r}})(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T_{constructor(){this.changes=new ms((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,st.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?V.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pA{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return ur(e).put(s)}removeEntry(e,t,s){return ur(e).delete((function(a,o){const c=a.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Uc(o),c[c.length-1]]})(t,s))}updateMetadata(e,t){return this.getMetadata(e).next((s=>(s.byteSize+=t,this.Dr(e,s))))}getEntry(e,t){let s=st.newInvalidDocument(t);return ur(e).ee({index:oc,range:IDBKeyRange.only(fa(t))},((r,a)=>{s=this.Cr(t,a)})).next((()=>s))}vr(e,t){let s={size:0,document:st.newInvalidDocument(t)};return ur(e).ee({index:oc,range:IDBKeyRange.only(fa(t))},((r,a)=>{s={document:this.Cr(t,a),size:Bc(a)}})).next((()=>s))}getEntries(e,t){let s=hn();return this.Fr(e,t,((r,a)=>{const o=this.Cr(r,a);s=s.insert(r,o)})).next((()=>s))}Mr(e,t){let s=hn(),r=new rt(Y.comparator);return this.Fr(e,t,((a,o)=>{const c=this.Cr(a,o);s=s.insert(a,c),r=r.insert(a,Bc(o))})).next((()=>({documents:s,Or:r})))}Fr(e,t,s){if(t.isEmpty())return V.resolve();let r=new Ye(Tp);t.forEach((u=>r=r.add(u)));const a=IDBKeyRange.bound(fa(r.first()),fa(r.last())),o=r.getIterator();let c=o.getNext();return ur(e).ee({index:oc,range:a},((u,d,h)=>{const m=Y.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;c&&Tp(c,m)<0;)s(c,null),c=o.getNext();c&&c.isEqual(m)&&(s(c,d),c=o.hasNext()?o.getNext():null),c?h.j(fa(c)):h.done()})).next((()=>{for(;c;)s(c,null),c=o.hasNext()?o.getNext():null}))}getDocumentsMatchingQuery(e,t,s,r,a){const o=t.path,c=[o.popLast().toArray(),o.lastSegment(),Uc(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ur(e).J(IDBKeyRange.bound(c,u,!0)).next((d=>{a?.incrementDocumentReadCount(d.length);let h=hn();for(const m of d){const p=this.Cr(Y.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(mo(t,p)||r.has(p.key))&&(h=h.insert(p.key,p))}return h}))}getAllFromCollectionGroup(e,t,s,r){let a=hn();const o=Ip(t,s),c=Ip(t,pn.max());return ur(e).ee({index:dy,range:IDBKeyRange.bound(o,c,!0)},((u,d,h)=>{const m=this.Cr(Y.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);a=a.insert(m.key,m),a.size===r&&h.done()})).next((()=>a))}newChangeBuffer(e){return new gA(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return vp(e).get(Fu).next((t=>(ie(!!t,20021),t)))}Dr(e,t){return vp(e).put(Fu,t)}Cr(e,t){if(t){const s=tA(this.serializer,t);if(!(s.isNoDocument()&&s.version.isEqual(le.min())))return s}return st.newInvalidDocument(e)}}function N_(n){return new pA(n)}class gA extends T_{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new ms((s=>s.toString()),((s,r)=>s.isEqual(r)))}applyChanges(e){const t=[];let s=0,r=new Ye(((a,o)=>Ie(a.canonicalString(),o.canonicalString())));return this.changes.forEach(((a,o)=>{const c=this.Br.get(a);if(t.push(this.Nr.removeEntry(e,a,c.readTime)),o.isValidDocument()){const u=ip(this.Nr.serializer,o);r=r.add(a.path.popLast());const d=Bc(u);s+=d-c.size,t.push(this.Nr.addEntry(e,a,u))}else if(s-=c.size,this.trackRemovals){const u=ip(this.Nr.serializer,o.convertToNoDocument(le.min()));t.push(this.Nr.addEntry(e,a,u))}})),r.forEach((a=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,a))})),t.push(this.Nr.updateMetadata(e,s)),V.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((s=>(this.Br.set(t,{size:s.size,readTime:s.document.readTime}),s.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:s,Or:r})=>(r.forEach(((a,o)=>{this.Br.set(a,{size:o,readTime:s.get(a).readTime})})),s)))}}function vp(n){return wt(n,za)}function ur(n){return wt(n,Pc)}function fa(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ip(n,e){const t=e.documentKey.path.toArray();return[n,Uc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Tp(n,e){const t=n.path.toArray(),s=e.path.toArray();let r=0;for(let a=0;a<t.length-2&&a<s.length-2;++a)if(r=Ie(t[a],s[a]),r)return r;return r=Ie(t.length,s.length),r||(r=Ie(t[t.length-2],s[s.length-2]),r||Ie(t[t.length-1],s[s.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xA{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&Da(s.mutation,r,Xt.empty(),Qe.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,Se()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=Se()){const r=qn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((a=>{let o=ya();return a.forEach(((c,u)=>{o=o.insert(c,u.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const s=qn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,Se())))}populateOverlays(e,t,s){const r=[];return s.forEach((a=>{t.has(a)||r.push(a)})),this.documentOverlayCache.getOverlays(e,r).next((a=>{a.forEach(((o,c)=>{t.set(o,c)}))}))}computeViews(e,t,s,r){let a=hn();const o=Pa(),c=(function(){return Pa()})();return t.forEach(((u,d)=>{const h=s.get(d.key);r.has(d.key)&&(h===void 0||h.mutation instanceof ps)?a=a.insert(d.key,d):h!==void 0?(o.set(d.key,h.mutation.getFieldMask()),Da(h.mutation,d,h.mutation.getFieldMask(),Qe.now())):o.set(d.key,Xt.empty())})),this.recalculateAndSaveOverlays(e,a).next((u=>(u.forEach(((d,h)=>o.set(d,h))),t.forEach(((d,h)=>c.set(d,new xA(h,o.get(d)??null)))),c)))}recalculateAndSaveOverlays(e,t){const s=Pa();let r=new rt(((o,c)=>o-c)),a=Se();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const c of o)c.keys().forEach((u=>{const d=t.get(u);if(d===null)return;let h=s.get(u)||Xt.empty();h=c.applyToLocalView(d,h),s.set(u,h);const m=(r.get(c.batchId)||Se()).add(u);r=r.insert(c.batchId,m)}))})).next((()=>{const o=[],c=r.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),d=u.key,h=u.value,m=$y();h.forEach((p=>{if(!a.has(p)){const w=Qy(t.get(p),s.get(p));w!==null&&m.set(p,w),a=a.add(p)}})),o.push(this.documentOverlayCache.saveOverlays(e,d,m))}return V.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return(function(o){return Y.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Oy(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((a=>{const o=r-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-a.size):V.resolve(qn());let c=Fa,u=a;return o.next((d=>V.forEach(d,((h,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),a.get(h)?V.resolve():this.remoteDocumentCache.getEntry(e,h).next((p=>{u=u.insert(h,p)}))))).next((()=>this.populateOverlays(e,d,a))).next((()=>this.computeViews(e,u,d,Se()))).next((h=>({batchId:c,changes:By(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Y(t)).next((s=>{let r=ya();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const a=t.collectionGroup;let o=ya();return this.indexManager.getCollectionParents(e,a).next((c=>V.forEach(c,(u=>{const d=(function(m,p){return new Gi(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(a));return this.getDocumentsMatchingCollectionQuery(e,d,s,r).next((h=>{h.forEach(((m,p)=>{o=o.insert(m,p)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let a;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,a,r)))).next((o=>{a.forEach(((u,d)=>{const h=d.getKey();o.get(h)===null&&(o=o.insert(h,st.newInvalidDocument(h)))}));let c=ya();return o.forEach(((u,d)=>{const h=a.get(u);h!==void 0&&Da(h.mutation,d,Xt.empty(),Qe.now()),mo(t,d)&&(c=c.insert(u,d))})),c}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yA{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return V.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:Nt(r.createTime)}})(t)),V.resolve()}getNamedQuery(e,t){return V.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(r){return{name:r.name,query:m_(r.bundledQuery),readTime:Nt(r.readTime)}})(t)),V.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _A{constructor(){this.overlays=new rt(Y.comparator),this.qr=new Map}getOverlay(e,t){return V.resolve(this.overlays.get(t))}getOverlays(e,t){const s=qn();return V.forEach(t,(r=>this.getOverlay(e,r).next((a=>{a!==null&&s.set(r,a)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,a)=>{this.St(e,t,a)})),V.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach((a=>this.overlays=this.overlays.remove(a))),this.qr.delete(s)),V.resolve()}getOverlaysForCollection(e,t,s){const r=qn(),a=t.length+1,o=new Y(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const u=c.getNext().value,d=u.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===a&&u.largestBatchId>s&&r.set(u.getKey(),u)}return V.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let a=new rt(((d,h)=>d-h));const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>s){let h=a.get(d.largestBatchId);h===null&&(h=qn(),a=a.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const c=qn(),u=a.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((d,h)=>c.set(d,h))),!(c.size()>=r)););return V.resolve(c)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new ah(t,s));let a=this.qr.get(t);a===void 0&&(a=Se(),this.qr.set(t,a)),this.qr.set(t,a.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wA{constructor(){this.sessionToken=pt.EMPTY_BYTE_STRING}getSessionToken(e){return V.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,V.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dh{constructor(){this.Qr=new Ye(vt.$r),this.Ur=new Ye(vt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new vt(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Gr(new vt(e,t))}zr(e,t){e.forEach((s=>this.removeReference(s,t)))}jr(e){const t=new Y(new $e([])),s=new vt(t,e),r=new vt(t,e+1),a=[];return this.Ur.forEachInRange([s,r],(o=>{this.Gr(o),a.push(o.key)})),a}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Y(new $e([])),s=new vt(t,e),r=new vt(t,e+1);let a=Se();return this.Ur.forEachInRange([s,r],(o=>{a=a.add(o.key)})),a}containsKey(e){const t=new vt(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class vt{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Y.comparator(e.key,t.key)||Ie(e.Yr,t.Yr)}static Kr(e,t){return Ie(e.Yr,t.Yr)||Y.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bA{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Ye(vt.$r)}checkEmpty(e){return V.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const a=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new rh(a,t,s,r);this.mutationQueue.push(o);for(const c of r)this.Zr=this.Zr.add(new vt(c.key,a)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return V.resolve(o)}lookupMutationBatch(e,t){return V.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),a=r<0?0:r;return V.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(this.mutationQueue.length===0?Ir:this.tr-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new vt(t,0),r=new vt(t,Number.POSITIVE_INFINITY),a=[];return this.Zr.forEachInRange([s,r],(o=>{const c=this.Xr(o.Yr);a.push(c)})),V.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ye(Ie);return t.forEach((r=>{const a=new vt(r,0),o=new vt(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([a,o],(c=>{s=s.add(c.Yr)}))})),V.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let a=s;Y.isDocumentKey(a)||(a=a.child(""));const o=new vt(new Y(a),0);let c=new Ye(Ie);return this.Zr.forEachWhile((u=>{const d=u.key.path;return!!s.isPrefixOf(d)&&(d.length===r&&(c=c.add(u.Yr)),!0)}),o),V.resolve(this.ti(c))}ti(e){const t=[];return e.forEach((s=>{const r=this.Xr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){ie(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return V.forEach(t.mutations,(r=>{const a=new vt(r.key,t.batchId);return s=s.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=s}))}ir(e){}containsKey(e,t){const s=new vt(t,0),r=this.Zr.firstAfterOrEqual(s);return V.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,V.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vA{constructor(e){this.ri=e,this.docs=(function(){return new rt(Y.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),a=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return V.resolve(s?s.document.mutableCopy():st.newInvalidDocument(t))}getEntries(e,t){let s=hn();return t.forEach((r=>{const a=this.docs.get(r);s=s.insert(r,a?a.document.mutableCopy():st.newInvalidDocument(r))})),V.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let a=hn();const o=t.path,c=new Y(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:d,value:{document:h}}=u.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||Hd(ay(h),s)<=0||(r.has(h.key)||mo(t,h))&&(a=a.insert(h.key,h.mutableCopy()))}return V.resolve(a)}getAllFromCollectionGroup(e,t,s,r){ne(9500)}ii(e,t){return V.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new IA(this)}getSize(e){return V.resolve(this.size)}}class IA extends T_{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)})),V.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TA{constructor(e){this.persistence=e,this.si=new ms((t=>Rr(t)),ho),this.lastRemoteSnapshotVersion=le.min(),this.highestTargetId=0,this.oi=0,this._i=new dh,this.targetCount=0,this.ai=Lr.ur()}forEachTarget(e,t){return this.si.forEach(((s,r)=>t(r))),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),V.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Lr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,V.resolve()}updateTargetData(e,t){return this.Pr(t),V.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,t,s){let r=0;const a=[];return this.si.forEach(((o,c)=>{c.sequenceNumber<=t&&s.get(c.targetId)===null&&(this.si.delete(o),a.push(this.removeMatchingKeysForTargetId(e,c.targetId)),r++)})),V.waitFor(a).next((()=>r))}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return V.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),V.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,a=[];return r&&t.forEach((o=>{a.push(r.markPotentiallyOrphaned(e,o))})),V.waitFor(a)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),V.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return V.resolve(s)}containsKey(e,t){return V.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hh{constructor(e,t){this.ui={},this.overlays={},this.ci=new wn(0),this.li=!1,this.li=!0,this.hi=new wA,this.referenceDelegate=e(this),this.Pi=new TA(this),this.indexManager=new lA,this.remoteDocumentCache=(function(r){return new vA(r)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new h_(t),this.Ii=new yA(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _A,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new bA(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){G("MemoryPersistence","Starting transaction:",e);const r=new NA(this.ci.next());return this.referenceDelegate.Ei(),s(r).next((a=>this.referenceDelegate.di(r).next((()=>a)))).toPromise().then((a=>(r.raiseOnCommittedEvent(),a)))}Ai(e,t){return V.or(Object.values(this.ui).map((s=>()=>s.containsKey(e,t))))}}class NA extends cy{constructor(e){super(),this.currentSequenceNumber=e}}class vl{constructor(e){this.persistence=e,this.Ri=new dh,this.Vi=null}static mi(e){return new vl(e)}get fi(){if(this.Vi)return this.Vi;throw ne(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),V.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),V.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),V.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((r=>this.fi.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((a=>this.fi.add(a.toString())))})).next((()=>s.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.fi,(s=>{const r=Y.fromPath(s);return this.gi(e,r).next((a=>{a||t.removeEntry(r,le.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return V.or([()=>V.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class $c{constructor(e,t){this.persistence=e,this.pi=new ms((s=>Ut(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=I_(this,t)}static mi(e,t){return new $c(e,t)}Ei(){}di(e){return V.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}pr(e,t){return V.forEach(this.pi,((s,r)=>this.br(e,s,r).next((a=>a?V.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),a=r.newChangeBuffer();return r.ii(e,(o=>this.br(e,o,t).next((c=>{c||(s++,a.removeEntry(o,le.min()))})))).next((()=>a.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),V.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),V.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=lc(e.data.value)),t}br(e,t,s){return V.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return V.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EA{constructor(e){this.serializer=e}k(e,t,s,r){const a=new ll("createOrUpgrade",t);s<1&&r>=1&&((function(u){u.createObjectStore(uo)})(e),(function(u){u.createObjectStore(qa,{keyPath:UN}),u.createObjectStore(Nn,{keyPath:Vm,autoIncrement:!0}).createIndex(_r,Lm,{unique:!0}),u.createObjectStore(ki)})(e),Np(e),(function(u){u.createObjectStore(fr)})(e));let o=V.resolve();return s<3&&r>=3&&(s!==0&&((function(u){u.deleteObjectStore(Si),u.deleteObjectStore(Ci),u.deleteObjectStore(Tr)})(e),Np(e)),o=o.next((()=>(function(u){const d=u.store(Tr),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:le.min().toTimestamp(),targetCount:0};return d.put(Dc,h)})(a)))),s<4&&r>=4&&(s!==0&&(o=o.next((()=>(function(u,d){return d.store(Nn).J().next((m=>{u.deleteObjectStore(Nn),u.createObjectStore(Nn,{keyPath:Vm,autoIncrement:!0}).createIndex(_r,Lm,{unique:!0});const p=d.store(Nn),w=m.map((v=>p.put(v)));return V.waitFor(w)}))})(e,a)))),o=o.next((()=>{(function(u){u.createObjectStore(Ri,{keyPath:WN})})(e)}))),s<5&&r>=5&&(o=o.next((()=>this.yi(a)))),s<6&&r>=6&&(o=o.next((()=>((function(u){u.createObjectStore(za)})(e),this.wi(a))))),s<7&&r>=7&&(o=o.next((()=>this.Si(a)))),s<8&&r>=8&&(o=o.next((()=>this.bi(e,a)))),s<9&&r>=9&&(o=o.next((()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)}))),s<10&&r>=10&&(o=o.next((()=>this.Di(a)))),s<11&&r>=11&&(o=o.next((()=>{(function(u){u.createObjectStore(ul,{keyPath:QN})})(e),(function(u){u.createObjectStore(dl,{keyPath:JN})})(e)}))),s<12&&r>=12&&(o=o.next((()=>{(function(u){const d=u.createObjectStore(hl,{keyPath:sE});d.createIndex($u,rE,{unique:!1}),d.createIndex(py,iE,{unique:!1})})(e)}))),s<13&&r>=13&&(o=o.next((()=>(function(u){const d=u.createObjectStore(Pc,{keyPath:BN});d.createIndex(oc,$N),d.createIndex(dy,qN)})(e))).next((()=>this.Ci(e,a))).next((()=>e.deleteObjectStore(fr)))),s<14&&r>=14&&(o=o.next((()=>this.Fi(e,a)))),s<15&&r>=15&&(o=o.next((()=>(function(u){u.createObjectStore(Qd,{keyPath:YN,autoIncrement:!0}).createIndex(Bu,XN,{unique:!1}),u.createObjectStore(ka,{keyPath:ZN}).createIndex(fy,eE,{unique:!1}),u.createObjectStore(Ca,{keyPath:tE}).createIndex(my,nE,{unique:!1})})(e)))),s<16&&r>=16&&(o=o.next((()=>{t.objectStore(ka).clear()})).next((()=>{t.objectStore(Ca).clear()}))),s<17&&r>=17&&(o=o.next((()=>{(function(u){u.createObjectStore(Jd,{keyPath:aE})})(e)}))),s<18&&r>=18&&hx()&&(o=o.next((()=>{t.objectStore(ka).clear()})).next((()=>{t.objectStore(Ca).clear()}))),o}wi(e){let t=0;return e.store(fr).ee(((s,r)=>{t+=Bc(r)})).next((()=>{const s={byteSize:t};return e.store(za).put(Fu,s)}))}yi(e){const t=e.store(qa),s=e.store(Nn);return t.J().next((r=>V.forEach(r,(a=>{const o=IDBKeyRange.bound([a.userId,Ir],[a.userId,a.lastAcknowledgedBatchId]);return s.J(_r,o).next((c=>V.forEach(c,(u=>{ie(u.userId===a.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});const d=pr(this.serializer,u);return y_(e,a.userId,d).next((()=>{}))}))))}))))}Si(e){const t=e.store(Si),s=e.store(fr);return e.store(Tr).get(Dc).next((r=>{const a=[];return s.ee(((o,c)=>{const u=new $e(o),d=(function(m){return[0,Ut(m)]})(u);a.push(t.get(d).next((h=>h?V.resolve():(m=>t.put({targetId:0,path:Ut(m),sequenceNumber:r.highestListenSequenceNumber}))(u))))})).next((()=>V.waitFor(a)))}))}bi(e,t){e.createObjectStore(Ga,{keyPath:KN});const s=t.store(Ga),r=new uh,a=o=>{if(r.add(o)){const c=o.lastSegment(),u=o.popLast();return s.put({collectionId:c,parent:Ut(u)})}};return t.store(fr).ee({X:!0},((o,c)=>{const u=new $e(o);return a(u.popLast())})).next((()=>t.store(ki).ee({X:!0},(([o,c,u],d)=>{const h=$n(c);return a(h.popLast())}))))}Di(e){const t=e.store(Ci);return t.ee(((s,r)=>{const a=wa(r),o=f_(this.serializer,a);return t.put(o)}))}Ci(e,t){const s=t.store(fr),r=[];return s.ee(((a,o)=>{const c=t.store(Pc),u=(function(m){return m.document?new Y($e.fromString(m.document.name).popFirst(5)):m.noDocument?Y.fromSegments(m.noDocument.path):m.unknownDocument?Y.fromSegments(m.unknownDocument.path):ne(36783)})(o).path.toArray(),d={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(c.put(d))})).next((()=>V.waitFor(r)))}Fi(e,t){const s=t.store(Nn),r=N_(this.serializer),a=new hh(vl.mi,this.serializer.yt);return s.J().next((o=>{const c=new Map;return o.forEach((u=>{let d=c.get(u.userId)??Se();pr(this.serializer,u).keys().forEach((h=>d=d.add(h))),c.set(u.userId,d)})),V.forEach(c,((u,d)=>{const h=new qt(d),m=wl.wt(this.serializer,h),p=a.getIndexManager(h),w=bl.wt(h,this.serializer,p,a.referenceDelegate);return new E_(r,w,m,p).recalculateAndSaveOverlaysForDocumentKeys(new qu(t,wn.ce),u).next()}))}))}}function Np(n){n.createObjectStore(Si,{keyPath:GN}).createIndex(Wd,HN,{unique:!0}),n.createObjectStore(Ci,{keyPath:"targetId"}).createIndex(hy,zN,{unique:!0}),n.createObjectStore(Tr)}const Cs="IndexedDbPersistence",ou=18e5,cu=5e3,lu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",AA="main";class fh{constructor(e,t,s,r,a,o,c,u,d,h,m=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Mi=a,this.window=o,this.document=c,this.xi=d,this.Oi=h,this.Ni=m,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!fh.v())throw new H(B.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new mA(this,r),this.$i=t+AA,this.serializer=new h_(u),this.Ui=new Hs(this.$i,this.Ni,new EA(this.serializer)),this.hi=new sA,this.Pi=new dA(this.referenceDelegate,this.serializer),this.remoteDocumentCache=N_(this.serializer),this.Ii=new nA,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&Gt(Cs,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new H(B.FAILED_PRECONDITION,lu);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new wn(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>qo(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(er(e))return G(Cs,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return G(Cs,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return ma(e).get(ei).next((t=>V.resolve(this.es(t))))}ts(e){return qo(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,ou)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const s=wt(t,Ri);return s.J().next((r=>{const a=this.ss(r,ou),o=r.filter((c=>a.indexOf(c)===-1));return V.forEach(o,(c=>s.delete(c.clientId))).next((()=>o))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?V.resolve(!0):ma(e).get(ei).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,cu)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new H(B.FAILED_PRECONDITION,lu);return!1}}return!(!this.networkEnabled||!this.inForeground)||qo(e).J().next((s=>this.ss(s,cu).find((r=>{if(this.clientId!==r.clientId){const a=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,c=this.networkEnabled===r.networkEnabled;if(a||o&&c)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&G(Cs,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[uo,Ri],(e=>{const t=new qu(e,wn.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((s=>this.rs(s.updateTimeMs,t)&&!this.us(s.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>qo(e).J().next((t=>this.ss(t,ou).map((s=>s.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return bl.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new uA(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return wl.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,s){G(Cs,"Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",a=(function(u){return u===18?lE:u===17?_y:u===16?cE:u===15?Yd:u===14?yy:u===13?xy:u===12?oE:u===11?gy:void ne(60245)})(this.Ni);let o;return this.Ui.runTransaction(e,r,a,(c=>(o=new qu(c,this.ci?this.ci.next():wn.ce),t==="readwrite-primary"?this.Hi(o).next((u=>!!u||this.Yi(o))).next((u=>{if(!u)throw Gt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new H(B.FAILED_PRECONDITION,oy);return s(o)})).next((u=>this.Xi(o).next((()=>u)))):this.Is(o).next((()=>s(o)))))).then((c=>(o.raiseOnCommittedEvent(),c)))}Is(e){return ma(e).get(ei).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,cu)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new H(B.FAILED_PRECONDITION,lu)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ma(e).put(ei,t)}static v(){return Hs.v()}Zi(e){const t=ma(e);return t.get(ei).next((s=>this.es(s)?(G(Cs,"Releasing primary lease."),t.delete(ei)):V.resolve()))}rs(e,t){const s=Date.now();return!(e<s-t)&&(!(e>s)||(Gt(`Detected an update time that is in the future: ${e} > ${s}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;dx()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return G(Cs,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return Gt(Cs,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Gt("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ma(n){return wt(n,uo)}function qo(n){return wt(n,Ri)}function jA(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mh{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=Se(),r=Se();for(const a of t.docChanges)switch(a.type){case 0:s=s.add(a.doc.key);break;case 1:r=r.add(a.doc.key)}return new mh(e,t.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kA{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return dx()?8:ly(_t())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const a={result:null};return this.ys(e,t).next((o=>{a.result=o})).next((()=>{if(!a.result)return this.ws(e,t,r,s).next((o=>{a.result=o}))})).next((()=>{if(a.result)return;const o=new kA;return this.Ss(e,t,o).next((c=>{if(a.result=c,this.Vs)return this.bs(e,t,o,c.size)}))})).next((()=>a.result))}bs(e,t,s,r){return s.documentReadCount<this.fs?(ci()<=Ve.DEBUG&&G("QueryEngine","SDK will not create cache indexes for query:",li(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),V.resolve()):(ci()<=Ve.DEBUG&&G("QueryEngine","Query:",li(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(ci()<=Ve.DEBUG&&G("QueryEngine","The SDK decides to create cache indexes for query:",li(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,bn(t))):V.resolve())}ys(e,t){if(Qm(t))return V.resolve(null);let s=bn(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=Mc(t,null,"F"),s=bn(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((a=>{const o=Se(...a);return this.ps.getDocuments(e,o).next((c=>this.indexManager.getMinOffset(e,s).next((u=>{const d=this.Ds(t,c);return this.Cs(t,d,o,u.readTime)?this.ys(e,Mc(t,null,"F")):this.vs(e,d,t,u)}))))})))))}ws(e,t,s,r){return Qm(t)||r.isEqual(le.min())?V.resolve(null):this.ps.getDocuments(e,s).next((a=>{const o=this.Ds(t,a);return this.Cs(t,o,s,r)?V.resolve(null):(ci()<=Ve.DEBUG&&G("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),li(t)),this.vs(e,o,t,RN(r,Fa)).next((c=>c)))}))}Ds(e,t){let s=new Ye(Uy(e));return t.forEach(((r,a)=>{mo(e,a)&&(s=s.add(a))})),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const a=e.limitType==="F"?t.last():t.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(r)>0)}Ss(e,t,s){return ci()<=Ve.DEBUG&&G("QueryEngine","Using full collection scan to execute query:",li(t)),this.ps.getDocumentsMatchingQuery(e,t,pn.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next((a=>(t.forEach((o=>{a=a.insert(o.key,o)})),a)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ph="LocalStore",CA=3e8;class SA{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new rt(Ie),this.xs=new ms((a=>Rr(a)),ho),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new E_(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function j_(n,e,t,s){return new SA(n,e,t,s)}async function k_(n,e){const t=we(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((a=>(r=a,t.Bs(e),t.mutationQueue.getAllMutationBatches(s)))).next((a=>{const o=[],c=[];let u=Se();for(const d of r){o.push(d.batchId);for(const h of d.mutations)u=u.add(h.key)}for(const d of a){c.push(d.batchId);for(const h of d.mutations)u=u.add(h.key)}return t.localDocuments.getDocuments(s,u).next((d=>({Ls:d,removedBatchIds:o,addedBatchIds:c})))}))}))}function RA(n,e){const t=we(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),a=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,u,d,h){const m=d.batch,p=m.keys();let w=V.resolve();return p.forEach((v=>{w=w.next((()=>h.getEntry(u,v))).next((j=>{const k=d.docVersions.get(v);ie(k!==null,48541),j.version.compareTo(k)<0&&(m.applyToRemoteDocument(j,d),j.isValidDocument()&&(j.setReadTime(d.commitVersion),h.addEntry(j)))}))})),w.next((()=>c.mutationQueue.removeMutationBatch(u,m)))})(t,s,e,a).next((()=>a.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(c){let u=Se();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(u=u.add(c.batch.mutations[d].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function C_(n){const e=we(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function PA(n,e){const t=we(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(a=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const c=[];e.targetChanges.forEach(((h,m)=>{const p=r.get(m);if(!p)return;c.push(t.Pi.removeMatchingKeys(a,h.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(a,h.addedDocuments,m))));let w=p.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(m)!==null?w=w.withResumeToken(pt.EMPTY_BYTE_STRING,le.min()).withLastLimboFreeSnapshotVersion(le.min()):h.resumeToken.approximateByteSize()>0&&(w=w.withResumeToken(h.resumeToken,s)),r=r.insert(m,w),(function(j,k,P){return j.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-j.snapshotVersion.toMicroseconds()>=CA?!0:P.addedDocuments.size+P.modifiedDocuments.size+P.removedDocuments.size>0})(p,w,h)&&c.push(t.Pi.updateTargetData(a,w))}));let u=hn(),d=Se();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(a,h))})),c.push(DA(a,o,e.documentUpdates).next((h=>{u=h.ks,d=h.qs}))),!s.isEqual(le.min())){const h=t.Pi.getLastRemoteSnapshotVersion(a).next((m=>t.Pi.setTargetsMetadata(a,a.currentSequenceNumber,s)));c.push(h)}return V.waitFor(c).next((()=>o.apply(a))).next((()=>t.localDocuments.getLocalViewOfDocuments(a,u,d))).next((()=>u))})).then((a=>(t.Ms=r,a)))}function DA(n,e,t){let s=Se(),r=Se();return t.forEach((a=>s=s.add(a))),e.getEntries(n,s).next((a=>{let o=hn();return t.forEach(((c,u)=>{const d=a.get(c);u.isFoundDocument()!==d.isFoundDocument()&&(r=r.add(c)),u.isNoDocument()&&u.version.isEqual(le.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):G(ph,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",u.version)})),{ks:o,qs:r}}))}function VA(n,e){const t=we(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=Ir),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function LA(n,e){const t=we(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.Pi.getTargetData(s,e).next((a=>a?(r=a,V.resolve(r)):t.Pi.allocateTargetId(s).next((o=>(r=new os(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s}))}async function sd(n,e,t){const s=we(n),r=s.Ms.get(e),a=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",a,(o=>s.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!er(o))throw o;G(ph,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function Ep(n,e,t){const s=we(n);let r=le.min(),a=Se();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(u,d,h){const m=we(u),p=m.xs.get(h);return p!==void 0?V.resolve(m.Ms.get(p)):m.Pi.getTargetData(d,h)})(s,o,bn(e)).next((c=>{if(c)return r=c.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,c.targetId).next((u=>{a=u}))})).next((()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:le.min(),t?a:Se()))).next((c=>(OA(s,TE(e),c),{documents:c,Qs:a})))))}function OA(n,e,t){let s=n.Os.get(e)||le.min();t.forEach(((r,a)=>{a.readTime.compareTo(s)>0&&(s=a.readTime)})),n.Os.set(e,s)}class Ap{constructor(){this.activeTargetIds=CE()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class S_{constructor(){this.Mo=new Ap,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Ap,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MA{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jp="ConnectivityMonitor";class kp{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){G(jp,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){G(jp,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zo=null;function rd(){return zo===null?zo=(function(){return 268435456+Math.round(2147483648*Math.random())})():zo++,"0x"+zo.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu="RestConnection",UA={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class FA{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===Vc?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,a){const o=rd(),c=this.zo(e,t.toUriEncodedString());G(uu,`Sending RPC '${e}' ${o}:`,c,s);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,r,a);const{host:d}=new URL(c),h=Zn(d);return this.Jo(e,c,u,s,h).then((m=>(G(uu,`Received RPC '${e}' ${o}: `,m),m)),(m=>{throw Ua(uu,`RPC '${e}' ${o} failed with error: `,m,"url: ",c,"request:",s),m}))}Ho(e,t,s,r,a,o){return this.Go(e,t,s,r,a)}jo(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+zi})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,a)=>e[a]=r)),s&&s.headers.forEach(((r,a)=>e[a]=r))}zo(e,t){const s=UA[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BA{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lt="WebChannelConnection";class $A extends FA{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,a){const o=rd();return new Promise(((c,u)=>{const d=new Yx;d.setWithCredentials(!0),d.listenOnce(Xx.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case rc.NO_ERROR:const m=d.getResponseJson();G(Lt,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(m)),c(m);break;case rc.TIMEOUT:G(Lt,`RPC '${e}' ${o} timed out`),u(new H(B.DEADLINE_EXCEEDED,"Request time out"));break;case rc.HTTP_ERROR:const p=d.getStatus();if(G(Lt,`RPC '${e}' ${o} failed with status:`,p,"response text:",d.getResponseText()),p>0){let w=d.getResponseJson();Array.isArray(w)&&(w=w[0]);const v=w?.error;if(v&&v.status&&v.message){const j=(function(P){const R=P.toLowerCase().replace(/_/g,"-");return Object.values(B).indexOf(R)>=0?R:B.UNKNOWN})(v.status);u(new H(j,v.message))}else u(new H(B.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new H(B.UNAVAILABLE,"Connection failed."));break;default:ne(9055,{l_:e,streamId:o,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{G(Lt,`RPC '${e}' ${o} completed.`)}}));const h=JSON.stringify(r);G(Lt,`RPC '${e}' ${o} sending request:`,r),d.send(t,"POST",h,s,15)}))}T_(e,t,s){const r=rd(),a=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ty(),c=ey(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,s),u.encodeInitMessageHeaders=!0;const h=a.join("");G(Lt,`Creating RPC '${e}' stream ${r}: ${h}`,u);const m=o.createWebChannel(h,u);this.I_(m);let p=!1,w=!1;const v=new BA({Yo:k=>{w?G(Lt,`Not sending because RPC '${e}' stream ${r} is closed:`,k):(p||(G(Lt,`Opening RPC '${e}' stream ${r} transport.`),m.open(),p=!0),G(Lt,`RPC '${e}' stream ${r} sending:`,k),m.send(k))},Zo:()=>m.close()}),j=(k,P,R)=>{k.listen(P,(C=>{try{R(C)}catch(S){setTimeout((()=>{throw S}),0)}}))};return j(m,xa.EventType.OPEN,(()=>{w||(G(Lt,`RPC '${e}' stream ${r} transport opened.`),v.o_())})),j(m,xa.EventType.CLOSE,(()=>{w||(w=!0,G(Lt,`RPC '${e}' stream ${r} transport closed`),v.a_(),this.E_(m))})),j(m,xa.EventType.ERROR,(k=>{w||(w=!0,Ua(Lt,`RPC '${e}' stream ${r} transport errored. Name:`,k.name,"Message:",k.message),v.a_(new H(B.UNAVAILABLE,"The operation could not be completed")))})),j(m,xa.EventType.MESSAGE,(k=>{if(!w){const P=k.data[0];ie(!!P,16349);const R=P,C=R?.error||R[0]?.error;if(C){G(Lt,`RPC '${e}' stream ${r} received error:`,C);const S=C.status;let D=(function(y){const b=ft[y];if(b!==void 0)return Xy(b)})(S),M=C.message;D===void 0&&(D=B.INTERNAL,M="Unknown error status: "+S+" with message "+C.message),w=!0,v.a_(new H(D,M)),m.close()}else G(Lt,`RPC '${e}' stream ${r} received:`,P),v.u_(P)}})),j(c,Zx.STAT_EVENT,(k=>{k.stat===Ou.PROXY?G(Lt,`RPC '${e}' stream ${r} detected buffering proxy`):k.stat===Ou.NOPROXY&&G(Lt,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{v.__()}),0),v}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qA(){return typeof window<"u"?window:null}function mc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(n){return new zE(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh{constructor(e,t,s=1e3,r=1.5,a=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=a,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&G("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cp="PersistentStream";class R_{constructor(e,t,s,r,a,o,c,u){this.Mi=e,this.S_=s,this.b_=r,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new gh(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===B.RESOURCE_EXHAUSTED?(Gt(t.toString()),Gt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===B.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new H(B.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.J_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return G(Cp,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(G(Cp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class zA extends R_{constructor(e,t,s,r,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=a}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=WE(this.serializer,e),s=(function(a){if(!("targetChange"in a))return le.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?le.min():o.readTime?Nt(o.readTime):le.min()})(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=Xu(this.serializer),t.addTarget=(function(a,o){let c;const u=o.target;if(c=Lc(u)?{documents:a_(a,u)}:{query:o_(a,u).ft},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=t_(a,o.resumeToken);const d=Ju(a,o.expectedCount);d!==null&&(c.expectedCount=d)}else if(o.snapshotVersion.compareTo(le.min())>0){c.readTime=Fi(a,o.snapshotVersion.toTimestamp());const d=Ju(a,o.expectedCount);d!==null&&(c.expectedCount=d)}return c})(this.serializer,e);const s=JE(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=Xu(this.serializer),t.removeTarget=e,this.q_(t)}}class GA extends R_{constructor(e,t,s,r,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=a}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ie(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ie(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ie(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=QE(e.writeResults,e.commitTime),s=Nt(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=Xu(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>Xa(this.serializer,s)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HA{}class KA extends HA{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new H(B.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,o])=>this.connection.Go(e,Yu(t,s),r,a,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new H(B.UNKNOWN,a.toString())}))}Ho(e,t,s,r,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,c])=>this.connection.Ho(e,Yu(t,s),r,o,c,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new H(B.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class WA{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Gt(t),this.aa=!1):G("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Or="RemoteStore";class QA{constructor(e,t,s,r,a){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=a,this.Aa.Oo((o=>{s.enqueueAndForget((async()=>{Hr(this)&&(G(Or,"Restarting streams for network reachability change."),await(async function(u){const d=we(u);d.Ea.add(4),await xo(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Tl(d)})(this))}))})),this.Ra=new WA(s,r)}}async function Tl(n){if(Hr(n))for(const e of n.da)await e(!0)}async function xo(n){for(const e of n.da)await e(!1)}function P_(n,e){const t=we(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),wh(t)?_h(t):Ki(t).O_()&&yh(t,e))}function xh(n,e){const t=we(n),s=Ki(t);t.Ia.delete(e),s.O_()&&D_(t,e),t.Ia.size===0&&(s.O_()?s.L_():Hr(t)&&t.Ra.set("Unknown"))}function yh(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(le.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ki(n).Y_(e)}function D_(n,e){n.Va.Ue(e),Ki(n).Z_(e)}function _h(n){n.Va=new FE({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Ki(n).start(),n.Ra.ua()}function wh(n){return Hr(n)&&!Ki(n).x_()&&n.Ia.size>0}function Hr(n){return we(n).Ea.size===0}function V_(n){n.Va=void 0}async function JA(n){n.Ra.set("Online")}async function YA(n){n.Ia.forEach(((e,t)=>{yh(n,e)}))}async function XA(n,e){V_(n),wh(n)?(n.Ra.ha(e),_h(n)):n.Ra.set("Unknown")}async function ZA(n,e,t){if(n.Ra.set("Online"),e instanceof e_&&e.state===2&&e.cause)try{await(async function(r,a){const o=a.cause;for(const c of a.targetIds)r.Ia.has(c)&&(await r.remoteSyncer.rejectListen(c,o),r.Ia.delete(c),r.Va.removeTarget(c))})(n,e)}catch(s){G(Or,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await qc(n,s)}else if(e instanceof hc?n.Va.Ze(e):e instanceof Zy?n.Va.st(e):n.Va.tt(e),!t.isEqual(le.min()))try{const s=await C_(n.localStore);t.compareTo(s)>=0&&await(function(a,o){const c=a.Va.Tt(o);return c.targetChanges.forEach(((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const h=a.Ia.get(d);h&&a.Ia.set(d,h.withResumeToken(u.resumeToken,o))}})),c.targetMismatches.forEach(((u,d)=>{const h=a.Ia.get(u);if(!h)return;a.Ia.set(u,h.withResumeToken(pt.EMPTY_BYTE_STRING,h.snapshotVersion)),D_(a,u);const m=new os(h.target,u,d,h.sequenceNumber);yh(a,m)})),a.remoteSyncer.applyRemoteEvent(c)})(n,t)}catch(s){G(Or,"Failed to raise snapshot:",s),await qc(n,s)}}async function qc(n,e,t){if(!er(e))throw e;n.Ea.add(1),await xo(n),n.Ra.set("Offline"),t||(t=()=>C_(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{G(Or,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Tl(n)}))}function L_(n,e){return e().catch((t=>qc(n,t,e)))}async function yo(n){const e=we(n),t=Ys(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ir;for(;ej(e);)try{const r=await VA(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,tj(e,r)}catch(r){await qc(e,r)}O_(e)&&M_(e)}function ej(n){return Hr(n)&&n.Ta.length<10}function tj(n,e){n.Ta.push(e);const t=Ys(n);t.O_()&&t.X_&&t.ea(e.mutations)}function O_(n){return Hr(n)&&!Ys(n).x_()&&n.Ta.length>0}function M_(n){Ys(n).start()}async function nj(n){Ys(n).ra()}async function sj(n){const e=Ys(n);for(const t of n.Ta)e.ea(t.mutations)}async function rj(n,e,t){const s=n.Ta.shift(),r=ih.from(s,e,t);await L_(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await yo(n)}async function ij(n,e){e&&Ys(n).X_&&await(async function(s,r){if((function(o){return Yy(o)&&o!==B.ABORTED})(r.code)){const a=s.Ta.shift();Ys(s).B_(),await L_(s,(()=>s.remoteSyncer.rejectFailedWrite(a.batchId,r))),await yo(s)}})(n,e),O_(n)&&M_(n)}async function Sp(n,e){const t=we(n);t.asyncQueue.verifyOperationInProgress(),G(Or,"RemoteStore received new credentials");const s=Hr(t);t.Ea.add(3),await xo(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Tl(t)}async function aj(n,e){const t=we(n);e?(t.Ea.delete(2),await Tl(t)):e||(t.Ea.add(2),await xo(t),t.Ra.set("Unknown"))}function Ki(n){return n.ma||(n.ma=(function(t,s,r){const a=we(t);return a.sa(),new zA(s,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,r)})(n.datastore,n.asyncQueue,{Xo:JA.bind(null,n),t_:YA.bind(null,n),r_:XA.bind(null,n),H_:ZA.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),wh(n)?_h(n):n.Ra.set("Unknown")):(await n.ma.stop(),V_(n))}))),n.ma}function Ys(n){return n.fa||(n.fa=(function(t,s,r){const a=we(t);return a.sa(),new GA(s,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,r)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:nj.bind(null,n),r_:ij.bind(null,n),ta:sj.bind(null,n),na:rj.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await yo(n)):(await n.fa.stop(),n.Ta.length>0&&(G(Or,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(e,t,s,r,a){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=a,this.deferred=new jn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,a){const o=Date.now()+s,c=new bh(e,t,o,r,a);return c.start(s),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new H(B.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function vh(n,e){if(Gt("AsyncQueue",`${e}: ${n}`),er(n))return new H(B.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{static emptySet(e){return new vi(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||Y.comparator(t.key,s.key):(t,s)=>Y.comparator(t.key,s.key),this.keyedMap=ya(),this.sortedSet=new rt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof vi)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,a=s.getNext().key;if(!r.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new vi;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(){this.ga=new rt(Y.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ne(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class Bi{constructor(e,t,s,r,a,o,c,u,d){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,t,s,r,a){const o=[];return t.forEach((c=>{o.push({type:0,doc:c})})),new Bi(e,t,vi.emptySet(t),o,s,r,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&pl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oj{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class cj{constructor(){this.queries=Pp(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=we(t),a=r.queries;r.queries=Pp(),a.forEach(((o,c)=>{for(const u of c.Sa)u.onError(s)}))})(this,new H(B.ABORTED,"Firestore shutting down"))}}function Pp(){return new ms((n=>My(n)),pl)}async function Ih(n,e){const t=we(n);let s=3;const r=e.query;let a=t.queries.get(r);a?!a.ba()&&e.Da()&&(s=2):(a=new oj,s=e.Da()?0:1);try{switch(s){case 0:a.wa=await t.onListen(r,!0);break;case 1:a.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const c=vh(o,`Initialization of query '${li(e.query)}' failed`);return void e.onError(c)}t.queries.set(r,a),a.Sa.push(e),e.va(t.onlineState),a.wa&&e.Fa(a.wa)&&Nh(t)}async function Th(n,e){const t=we(n),s=e.query;let r=3;const a=t.queries.get(s);if(a){const o=a.Sa.indexOf(e);o>=0&&(a.Sa.splice(o,1),a.Sa.length===0?r=e.Da()?0:1:!a.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function lj(n,e){const t=we(n);let s=!1;for(const r of e){const a=r.query,o=t.queries.get(a);if(o){for(const c of o.Sa)c.Fa(r)&&(s=!0);o.wa=r}}s&&Nh(t)}function uj(n,e,t){const s=we(n),r=s.queries.get(e);if(r)for(const a of r.Sa)a.onError(t);s.queries.delete(e)}function Nh(n){n.Ca.forEach((e=>{e.next()}))}var id,Dp;(Dp=id||(id={})).Ma="default",Dp.Cache="cache";class Eh{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Bi(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Bi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==id.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U_{constructor(e){this.key=e}}class F_{constructor(e){this.key=e}}class dj{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Se(),this.mutatedKeys=Se(),this.eu=Uy(e),this.tu=new vi(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new Rp,r=t?t.tu:this.tu;let a=t?t.mutatedKeys:this.mutatedKeys,o=r,c=!1;const u=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,d=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((h,m)=>{const p=r.get(h),w=mo(this.query,m)?m:null,v=!!p&&this.mutatedKeys.has(p.key),j=!!w&&(w.hasLocalMutations||this.mutatedKeys.has(w.key)&&w.hasCommittedMutations);let k=!1;p&&w?p.data.isEqual(w.data)?v!==j&&(s.track({type:3,doc:w}),k=!0):this.su(p,w)||(s.track({type:2,doc:w}),k=!0,(u&&this.eu(w,u)>0||d&&this.eu(w,d)<0)&&(c=!0)):!p&&w?(s.track({type:0,doc:w}),k=!0):p&&!w&&(s.track({type:1,doc:p}),k=!0,(u||d)&&(c=!0)),k&&(w?(o=o.add(w),a=j?a.add(h):a.delete(h)):(o=o.delete(h),a=a.delete(h)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),a=a.delete(h.key),s.track({type:1,doc:h})}return{tu:o,iu:s,Cs:c,mutatedKeys:a}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const a=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((h,m)=>(function(w,v){const j=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ne(20277,{Rt:k})}};return j(w)-j(v)})(h.type,m.type)||this.eu(h.doc,m.doc))),this.ou(s),r=r??!1;const c=t&&!r?this._u():[],u=this.Xa.size===0&&this.current&&!r?1:0,d=u!==this.Za;return this.Za=u,o.length!==0||d?{snapshot:new Bi(this.query,e.tu,a,o,e.mutatedKeys,u===0,d,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Rp,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Se(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const t=[];return e.forEach((s=>{this.Xa.has(s)||t.push(new F_(s))})),this.Xa.forEach((s=>{e.has(s)||t.push(new U_(s))})),t}cu(e){this.Ya=e.Qs,this.Xa=Se();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Bi.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Ah="SyncEngine";class hj{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class fj{constructor(e){this.key=e,this.hu=!1}}class mj{constructor(e,t,s,r,a,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new ms((c=>My(c)),pl),this.Iu=new Map,this.Eu=new Set,this.du=new rt(Y.comparator),this.Au=new Map,this.Ru=new dh,this.Vu={},this.mu=new Map,this.fu=Lr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function pj(n,e,t=!0){const s=H_(n);let r;const a=s.Tu.get(e);return a?(s.sharedClientState.addLocalQueryTarget(a.targetId),r=a.view.lu()):r=await B_(s,e,t,!0),r}async function gj(n,e){const t=H_(n);await B_(t,e,!0,!1)}async function B_(n,e,t,s){const r=await LA(n.localStore,bn(e)),a=r.targetId,o=n.sharedClientState.addLocalQueryTarget(a,t);let c;return s&&(c=await xj(n,e,a,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&P_(n.remoteStore,r),c}async function xj(n,e,t,s,r){n.pu=(m,p,w)=>(async function(j,k,P,R){let C=k.view.ru(P);C.Cs&&(C=await Ep(j.localStore,k.query,!1).then((({documents:_})=>k.view.ru(_,C))));const S=R&&R.targetChanges.get(k.targetId),D=R&&R.targetMismatches.get(k.targetId)!=null,M=k.view.applyChanges(C,j.isPrimaryClient,S,D);return Lp(j,k.targetId,M.au),M.snapshot})(n,m,p,w);const a=await Ep(n.localStore,e,!0),o=new dj(e,a.Qs),c=o.ru(a.documents),u=go.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),d=o.applyChanges(c,n.isPrimaryClient,u);Lp(n,t,d.au);const h=new hj(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function yj(n,e,t){const s=we(n),r=s.Tu.get(e),a=s.Iu.get(r.targetId);if(a.length>1)return s.Iu.set(r.targetId,a.filter((o=>!pl(o,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await sd(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&xh(s.remoteStore,r.targetId),ad(s,r.targetId)})).catch(Gr)):(ad(s,r.targetId),await sd(s.localStore,r.targetId,!0))}async function _j(n,e){const t=we(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),xh(t.remoteStore,s.targetId))}async function wj(n,e,t){const s=K_(n);try{const r=await(function(o,c){const u=we(o),d=Qe.now(),h=c.reduce(((w,v)=>w.add(v.key)),Se());let m,p;return u.persistence.runTransaction("Locally write mutations","readwrite",(w=>{let v=hn(),j=Se();return u.Ns.getEntries(w,h).next((k=>{v=k,v.forEach(((P,R)=>{R.isValidDocument()||(j=j.add(P))}))})).next((()=>u.localDocuments.getOverlayedDocuments(w,v))).next((k=>{m=k;const P=[];for(const R of c){const C=LE(R,m.get(R.key).overlayedDocument);C!=null&&P.push(new ps(R.key,C,ky(C.value.mapValue),dt.exists(!0)))}return u.mutationQueue.addMutationBatch(w,d,P,c)})).next((k=>{p=k;const P=k.applyToLocalDocumentSet(m,j);return u.documentOverlayCache.saveOverlays(w,k.batchId,P)}))})).then((()=>({batchId:p.batchId,changes:By(m)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(o,c,u){let d=o.Vu[o.currentUser.toKey()];d||(d=new rt(Ie)),d=d.insert(c,u),o.Vu[o.currentUser.toKey()]=d})(s,r.batchId,t),await _o(s,r.changes),await yo(s.remoteStore)}catch(r){const a=vh(r,"Failed to persist write");t.reject(a)}}async function $_(n,e){const t=we(n);try{const s=await PA(t.localStore,e);e.targetChanges.forEach(((r,a)=>{const o=t.Au.get(a);o&&(ie(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?ie(o.hu,14607):r.removedDocuments.size>0&&(ie(o.hu,42227),o.hu=!1))})),await _o(t,s,e)}catch(s){await Gr(s)}}function Vp(n,e,t){const s=we(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((a,o)=>{const c=o.view.va(e);c.snapshot&&r.push(c.snapshot)})),(function(o,c){const u=we(o);u.onlineState=c;let d=!1;u.queries.forEach(((h,m)=>{for(const p of m.Sa)p.va(c)&&(d=!0)})),d&&Nh(u)})(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function bj(n,e,t){const s=we(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),a=r&&r.key;if(a){let o=new rt(Y.comparator);o=o.insert(a,st.newNoDocument(a,le.min()));const c=Se().add(a),u=new _l(le.min(),new Map,new rt(Ie),o,c);await $_(s,u),s.du=s.du.remove(a),s.Au.delete(e),jh(s)}else await sd(s.localStore,e,!1).then((()=>ad(s,e,t))).catch(Gr)}async function vj(n,e){const t=we(n),s=e.batch.batchId;try{const r=await RA(t.localStore,e);z_(t,s,null),q_(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await _o(t,r)}catch(r){await Gr(r)}}async function Ij(n,e,t){const s=we(n);try{const r=await(function(o,c){const u=we(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let h;return u.mutationQueue.lookupMutationBatch(d,c).next((m=>(ie(m!==null,37113),h=m.keys(),u.mutationQueue.removeMutationBatch(d,m)))).next((()=>u.mutationQueue.performConsistencyCheck(d))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(d,h,c))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h))).next((()=>u.localDocuments.getDocuments(d,h)))}))})(s.localStore,e);z_(s,e,t),q_(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await _o(s,r)}catch(r){await Gr(r)}}function q_(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function z_(n,e,t){const s=we(n);let r=s.Vu[s.currentUser.toKey()];if(r){const a=r.get(e);a&&(t?a.reject(t):a.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function ad(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((s=>{n.Ru.containsKey(s)||G_(n,s)}))}function G_(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(xh(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),jh(n))}function Lp(n,e,t){for(const s of t)s instanceof U_?(n.Ru.addReference(s.key,e),Tj(n,s)):s instanceof F_?(G(Ah,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||G_(n,s.key)):ne(19791,{wu:s})}function Tj(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(G(Ah,"New document in limbo: "+t),n.Eu.add(s),jh(n))}function jh(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Y($e.fromString(e)),s=n.fu.next();n.Au.set(s,new fj(t)),n.du=n.du.insert(t,s),P_(n.remoteStore,new os(bn(fo(t.path)),s,"TargetPurposeLimboResolution",wn.ce))}}async function _o(n,e,t){const s=we(n),r=[],a=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((c,u)=>{o.push(s.pu(u,e,t).then((d=>{if((d||t)&&s.isPrimaryClient){const h=d?!d.fromCache:t?.targetChanges.get(u.targetId)?.current;s.sharedClientState.updateQueryState(u.targetId,h?"current":"not-current")}if(d){r.push(d);const h=mh.As(u.targetId,d);a.push(h)}})))})),await Promise.all(o),s.Pu.H_(r),await(async function(u,d){const h=we(u);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>V.forEach(d,(p=>V.forEach(p.Es,(w=>h.persistence.referenceDelegate.addReference(m,p.targetId,w))).next((()=>V.forEach(p.ds,(w=>h.persistence.referenceDelegate.removeReference(m,p.targetId,w)))))))))}catch(m){if(!er(m))throw m;G(ph,"Failed to update sequence numbers: "+m)}for(const m of d){const p=m.targetId;if(!m.fromCache){const w=h.Ms.get(p),v=w.snapshotVersion,j=w.withLastLimboFreeSnapshotVersion(v);h.Ms=h.Ms.insert(p,j)}}})(s.localStore,a))}async function Nj(n,e){const t=we(n);if(!t.currentUser.isEqual(e)){G(Ah,"User change. New user:",e.toKey());const s=await k_(t.localStore,e);t.currentUser=e,(function(a,o){a.mu.forEach((c=>{c.forEach((u=>{u.reject(new H(B.CANCELLED,o))}))})),a.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await _o(t,s.Ls)}}function Ej(n,e){const t=we(n),s=t.Au.get(e);if(s&&s.hu)return Se().add(s.key);{let r=Se();const a=t.Iu.get(e);if(!a)return r;for(const o of a){const c=t.Tu.get(o);r=r.unionWith(c.view.nu)}return r}}function H_(n){const e=we(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=$_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ej.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bj.bind(null,e),e.Pu.H_=lj.bind(null,e.eventManager),e.Pu.yu=uj.bind(null,e.eventManager),e}function K_(n){const e=we(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=vj.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ij.bind(null,e),e}class Za{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Il(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return j_(this.persistence,new A_,e.initialUser,this.serializer)}Cu(e){return new hh(vl.mi,this.serializer)}Du(e){return new S_}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Za.provider={build:()=>new Za};class Aj extends Za{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ie(this.persistence.referenceDelegate instanceof $c,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new v_(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ot.withCacheSize(this.cacheSizeBytes):Ot.DEFAULT;return new hh((s=>$c.mi(s,t)),this.serializer)}}class jj extends Za{constructor(e,t,s){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await K_(this.xu.syncEngine),await yo(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return j_(this.persistence,new A_,e.initialUser,this.serializer)}Fu(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new v_(s,e.asyncQueue,t)}Mu(e,t){const s=new LN(t,this.persistence);return new VN(e.asyncQueue,s)}Cu(e){const t=jA(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=this.cacheSizeBytes!==void 0?Ot.withCacheSize(this.cacheSizeBytes):Ot.DEFAULT;return new fh(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,qA(),mc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new S_}}class zc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Vp(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Nj.bind(null,this.syncEngine),await aj(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new cj})()}createDatastore(e){const t=Il(e.databaseInfo.databaseId),s=(function(a){return new $A(a)})(e.databaseInfo);return(function(a,o,c,u){return new KA(a,o,c,u)})(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,a,o,c){return new QA(s,r,a,o,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>Vp(this.syncEngine,t,0)),(function(){return kp.v()?new kp:new MA})())}createSyncEngine(e,t){return(function(r,a,o,c,u,d,h){const m=new mj(r,a,o,c,u,d);return h&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=we(t);G(Or,"RemoteStore shutting down."),s.Ea.add(5),await xo(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}zc.provider={build:()=>new zc};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Gt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kj{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new H(B.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(r,a){const o=we(r),c={documents:a.map((m=>Ya(o.serializer,m)))},u=await o.Ho("BatchGetDocuments",o.serializer.databaseId,$e.emptyPath(),c,a.length),d=new Map;u.forEach((m=>{const p=KE(o.serializer,m);d.set(p.key.toString(),p)}));const h=[];return a.forEach((m=>{const p=d.get(m.toString());ie(!!p,55234,{key:m}),h.push(p)})),h})(this.datastore,e);return t.forEach((s=>this.recordVersion(s))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(s){this.lastTransactionError=s}this.writtenDocs.add(e.toString())}delete(e){this.write(new po(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,s)=>{const r=Y.fromPath(s);this.mutations.push(new sh(r,this.precondition(r)))})),await(async function(s,r){const a=we(s),o={writes:r.map((c=>Xa(a.serializer,c)))};await a.Go("Commit",a.serializer.databaseId,$e.emptyPath(),o)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ne(50498,{Gu:e.constructor.name});t=le.min()}const s=this.readVersions.get(e.key.toString());if(s){if(!t.isEqual(s))throw new H(B.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(le.min())?dt.exists(!1):dt.updateTime(t):dt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(le.min()))throw new H(B.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return dt.updateTime(t)}return dt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{constructor(e,t,s,r,a){this.asyncQueue=e,this.datastore=t,this.options=s,this.updateFunction=r,this.deferred=a,this.zu=s.maxAttempts,this.M_=new gh(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const e=new kj(this.datastore),t=this.Hu(e);t&&t.then((s=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(s)})).catch((r=>{this.Yu(r)}))))})).catch((s=>{this.Yu(s)}))}))}Hu(e){try{const t=this.updateFunction(e);return!lo(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(e)}Zu(e){if(e?.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Yy(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xs="FirestoreClient";class Sj{constructor(e,t,s,r,a){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=qt.UNAUTHENTICATED,this.clientId=Gd.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(s,(async o=>{G(Xs,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(G(Xs,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new jn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=vh(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function du(n,e){n.asyncQueue.verifyOperationInProgress(),G(Xs,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await k_(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Op(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Rj(n);G(Xs,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>Sp(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>Sp(e.remoteStore,r))),n._onlineComponents=e}async function Rj(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){G(Xs,"Using user provided OfflineComponentProvider");try{await du(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===B.FAILED_PRECONDITION||r.code===B.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;Ua("Error using user provided cache. Falling back to memory cache: "+t),await du(n,new Za)}}else G(Xs,"Using default OfflineComponentProvider"),await du(n,new Aj(void 0));return n._offlineComponents}async function Ch(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(G(Xs,"Using user provided OnlineComponentProvider"),await Op(n,n._uninitializedComponentsProvider._online)):(G(Xs,"Using default OnlineComponentProvider"),await Op(n,new zc))),n._onlineComponents}function Pj(n){return Ch(n).then((e=>e.syncEngine))}function Dj(n){return Ch(n).then((e=>e.datastore))}async function Gc(n){const e=await Ch(n),t=e.eventManager;return t.onListen=pj.bind(null,e.syncEngine),t.onUnlisten=yj.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=gj.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=_j.bind(null,e.syncEngine),t}function Vj(n,e,t={}){const s=new jn;return n.asyncQueue.enqueueAndForget((async()=>(function(a,o,c,u,d){const h=new kh({next:p=>{h.Nu(),o.enqueueAndForget((()=>Th(a,m)));const w=p.docs.has(c);!w&&p.fromCache?d.reject(new H(B.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&p.fromCache&&u&&u.source==="server"?d.reject(new H(B.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(p)},error:p=>d.reject(p)}),m=new Eh(fo(c.path),h,{includeMetadataChanges:!0,qa:!0});return Ih(a,m)})(await Gc(n),n.asyncQueue,e,t,s))),s.promise}function Lj(n,e,t={}){const s=new jn;return n.asyncQueue.enqueueAndForget((async()=>(function(a,o,c,u,d){const h=new kh({next:p=>{h.Nu(),o.enqueueAndForget((()=>Th(a,m))),p.fromCache&&u.source==="server"?d.reject(new H(B.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(p)},error:p=>d.reject(p)}),m=new Eh(c,h,{includeMetadataChanges:!0,qa:!0});return Ih(a,m)})(await Gc(n),n.asyncQueue,e,t,s))),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W_(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mp=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oj="firestore.googleapis.com",Up=!0;class Fp{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new H(B.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Oj,this.ssl=Up}else this.host=e.host,this.ssl=e.ssl??Up;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=x_;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<b_)throw new H(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}SN("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=W_(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new H(B.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new H(B.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new H(B.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Sh{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Fp({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new H(B.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new H(B.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Fp(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new vN;switch(s.type){case"firstParty":return new NN(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new H(B.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=Mp.get(t);s&&(G("ComponentProvider","Removing Datastore"),Mp.delete(t),s.terminate())})(this),Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new gs(this.firestore,e,this._query)}}class at{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ks(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new at(this.firestore,e,this._key)}toJSON(){return{type:at._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(co(t,at._jsonSchema))return new at(e,s||null,new Y($e.fromString(t.referencePath)))}}at._jsonSchemaVersion="firestore/documentReference/1.0",at._jsonSchema={type:mt("string",at._jsonSchemaVersion),referencePath:mt("string")};class Ks extends gs{constructor(e,t,s){super(e,t,fo(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new at(this.firestore,null,new Y(e))}withConverter(e){return new Ks(this.firestore,e,this._path)}}function sn(n,e,...t){if(n=Ge(n),ry("collection","path",e),n instanceof Sh){const s=$e.fromString(e,...t);return Cm(s),new Ks(n,null,s)}{if(!(n instanceof at||n instanceof Ks))throw new H(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child($e.fromString(e,...t));return Cm(s),new Ks(n.firestore,null,s)}}function be(n,e,...t){if(n=Ge(n),arguments.length===1&&(e=Gd.newId()),ry("doc","path",e),n instanceof Sh){const s=$e.fromString(e,...t);return km(s),new at(n,null,new Y(s))}{if(!(n instanceof at||n instanceof Ks))throw new H(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child($e.fromString(e,...t));return km(s),new at(n.firestore,n instanceof Ks?n.converter:null,new Y(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bp="AsyncQueue";class $p{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new gh(this,"async_queue_retry"),this._c=()=>{const s=mc();s&&G(Bp,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=mc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=mc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new jn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!er(e))throw e;G(Bp,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,Gt("INTERNAL UNHANDLED ERROR: ",qp(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=bh.createAndSchedule(this,e,t,s,(a=>this.hc(a)));return this.tc.push(r),r}uc(){this.nc&&ne(47125,{Pc:qp(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function qp(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zp(n){return(function(t,s){if(typeof t!="object"||t===null)return!1;const r=t;for(const a of s)if(a in r&&typeof r[a]=="function")return!0;return!1})(n,["next","error","complete"])}class Yn extends Sh{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new $p,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new $p(e),this._firestoreClient=void 0,await e}}}function Mj(n,e,t){t||(t=Vc);const s=Rn(n,"firestore");if(s.isInitialized(t)){const r=s.getImmediate({identifier:t}),a=s.getOptions(t);if(ls(a,e))return r;throw new H(B.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new H(B.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<b_)throw new H(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Zn(e.host)&&rl(e.host),s.initialize({options:e,instanceIdentifier:t})}function wo(n){if(n._terminated)throw new H(B.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Uj(n),n._firestoreClient}function Uj(n){const e=n._freezeSettings(),t=(function(r,a,o,c){return new dE(r,a,o,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,W_(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Sj(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(r){const a=r?._online.build();return{_offline:r?._offline.build(a),_online:a}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new dn(pt.fromBase64String(e))}catch(t){throw new H(B.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new dn(pt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:dn._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(co(e,dn._jsonSchema))return dn.fromBase64String(e.bytes)}}dn._jsonSchemaVersion="firestore/bytes/1.0",dn._jsonSchema={type:mt("string",dn._jsonSchemaVersion),bytes:mt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new H(B.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new it(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new H(B.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new H(B.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ie(this._lat,e._lat)||Ie(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Kn._jsonSchemaVersion}}static fromJSON(e){if(co(e,Kn._jsonSchema))return new Kn(e.latitude,e.longitude)}}Kn._jsonSchemaVersion="firestore/geoPoint/1.0",Kn._jsonSchema={type:mt("string",Kn._jsonSchemaVersion),latitude:mt("number"),longitude:mt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let a=0;a<s.length;++a)if(s[a]!==r[a])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Wn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(co(e,Wn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Wn(e.vectorValues);throw new H(B.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Wn._jsonSchemaVersion="firestore/vectorValue/1.0",Wn._jsonSchema={type:mt("string",Wn._jsonSchemaVersion),vectorValues:mt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fj=/^__.*__$/;class Bj{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new ps(e,this.data,this.fieldMask,t,this.fieldTransforms):new Hi(e,this.data,t,this.fieldTransforms)}}class Q_{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new ps(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function J_(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ne(40011,{Ac:n})}}class Nl{constructor(e,t,s,r,a,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,a===void 0&&this.Rc(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Nl({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Hc(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(J_(this.Ac)&&Fj.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class $j{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Il(e)}Cc(e,t,s,r=!1){return new Nl({Ac:e,methodName:t,Dc:s,path:it.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vo(n){const e=n._freezeSettings(),t=Il(n._databaseId);return new $j(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Rh(n,e,t,s,r,a={}){const o=n.Cc(a.merge||a.mergeFields?2:0,e,t,r);Lh("Data must be an object, but it was:",o,s);const c=Z_(s,o);let u,d;if(a.merge)u=new Xt(o.fieldMask),d=o.fieldTransforms;else if(a.mergeFields){const h=[];for(const m of a.mergeFields){const p=od(e,m,t);if(!o.contains(p))throw new H(B.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);tw(h,p)||h.push(p)}u=new Xt(h),d=o.fieldTransforms.filter((m=>u.covers(m.field)))}else u=null,d=o.fieldTransforms;return new Bj(new Ct(c),u,d)}class El extends Wi{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof El}}function qj(n,e,t){return new Nl({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Ph extends Wi{_toFieldTransform(e){return new xl(e.path,new Oi)}isEqual(e){return e instanceof Ph}}class Dh extends Wi{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=qj(this,e,!0),s=this.vc.map((a=>Qi(a,t))),r=new Pr(s);return new xl(e.path,r)}isEqual(e){return e instanceof Dh&&ls(this.vc,e.vc)}}class Vh extends Wi{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Ui(e.serializer,zy(e.serializer,this.Fc));return new xl(e.path,t)}isEqual(e){return e instanceof Vh&&this.Fc===e.Fc}}function Y_(n,e,t,s){const r=n.Cc(1,e,t);Lh("Data must be an object, but it was:",r,s);const a=[],o=Ct.empty();tr(s,((u,d)=>{const h=Oh(e,u,t);d=Ge(d);const m=r.yc(h);if(d instanceof El)a.push(h);else{const p=Qi(d,m);p!=null&&(a.push(h),o.set(h,p))}}));const c=new Xt(a);return new Q_(o,c,r.fieldTransforms)}function X_(n,e,t,s,r,a){const o=n.Cc(1,e,t),c=[od(e,s,t)],u=[r];if(a.length%2!=0)throw new H(B.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<a.length;p+=2)c.push(od(e,a[p])),u.push(a[p+1]);const d=[],h=Ct.empty();for(let p=c.length-1;p>=0;--p)if(!tw(d,c[p])){const w=c[p];let v=u[p];v=Ge(v);const j=o.yc(w);if(v instanceof El)d.push(w);else{const k=Qi(v,j);k!=null&&(d.push(w),h.set(w,k))}}const m=new Xt(d);return new Q_(h,m,o.fieldTransforms)}function zj(n,e,t,s=!1){return Qi(t,n.Cc(s?4:3,e))}function Qi(n,e){if(ew(n=Ge(n)))return Lh("Unsupported field value:",e,n),Z_(n,e);if(n instanceof Wi)return(function(s,r){if(!J_(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const a=s._toFieldTransform(r);a&&r.fieldTransforms.push(a)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(s,r){const a=[];let o=0;for(const c of s){let u=Qi(c,r.wc(o));u==null&&(u={nullValue:"NULL_VALUE"}),a.push(u),o++}return{arrayValue:{values:a}}})(n,e)}return(function(s,r){if((s=Ge(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return zy(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const a=Qe.fromDate(s);return{timestampValue:Fi(r.serializer,a)}}if(s instanceof Qe){const a=new Qe(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Fi(r.serializer,a)}}if(s instanceof Kn)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof dn)return{bytesValue:t_(r.serializer,s._byteString)};if(s instanceof at){const a=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(a))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:ch(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof Wn)return(function(o,c){return{mapValue:{fields:{[Zd]:{stringValue:eh},[Pi]:{arrayValue:{values:o.toArray().map((d=>{if(typeof d!="number")throw c.Sc("VectorValues must only contain numeric values.");return nh(c.serializer,d)}))}}}}}})(s,r);throw r.Sc(`Unsupported field value: ${cl(s)}`)})(n,e)}function Z_(n,e){const t={};return wy(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):tr(n,((s,r)=>{const a=Qi(r,e.mc(s));a!=null&&(t[s]=a)})),{mapValue:{fields:t}}}function ew(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Qe||n instanceof Kn||n instanceof dn||n instanceof at||n instanceof Wi||n instanceof Wn)}function Lh(n,e,t){if(!ew(t)||!iy(t)){const s=cl(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function od(n,e,t){if((e=Ge(e))instanceof bo)return e._internalPath;if(typeof e=="string")return Oh(n,e);throw Hc("Field path arguments must be of type string or ",n,!1,void 0,t)}const Gj=new RegExp("[~\\*/\\[\\]]");function Oh(n,e,t){if(e.search(Gj)>=0)throw Hc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new bo(...e.split("."))._internalPath}catch{throw Hc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Hc(n,e,t,s,r){const a=s&&!s.isEmpty(),o=r!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(a||o)&&(u+=" (found",a&&(u+=` in field ${s}`),o&&(u+=` in document ${r}`),u+=")"),new H(B.INVALID_ARGUMENT,c+n+u)}function tw(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e,t,s,r,a){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new at(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Hj(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Al("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Hj extends Kc{data(){return super.data()}}function Al(n,e){return typeof e=="string"?Oh(n,e):e instanceof bo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new H(B.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Mh{}class Uh extends Mh{}function xs(n,e,...t){let s=[];e instanceof Mh&&s.push(e),s=s.concat(t),(function(a){const o=a.filter((u=>u instanceof Fh)).length,c=a.filter((u=>u instanceof jl)).length;if(o>1||o>0&&c>0)throw new H(B.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(s);for(const r of s)n=r._apply(n);return n}class jl extends Uh{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new jl(e,t,s)}_apply(e){const t=this._parse(e);return iw(e._query,t),new gs(e.firestore,e.converter,Qu(e._query,t))}_parse(e){const t=vo(e.firestore);return(function(a,o,c,u,d,h,m){let p;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new H(B.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){Hp(m,h);const v=[];for(const j of m)v.push(Gp(u,a,j));p={arrayValue:{values:v}}}else p=Gp(u,a,m)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||Hp(m,h),p=zj(c,o,m,h==="in"||h==="not-in");return Le.create(d,h,p)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Kr(n,e,t){const s=e,r=Al("where",n);return jl._create(r,s,t)}class Fh extends Mh{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Fh(e,t)}_parse(e){const t=this._queryConstraints.map((s=>s._parse(e))).filter((s=>s.getFilters().length>0));return t.length===1?t[0]:Je.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(r,a){let o=r;const c=a.getFlattenedFilters();for(const u of c)iw(o,u),o=Qu(o,u)})(e._query,t),new gs(e.firestore,e.converter,Qu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Bh extends Uh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Bh(e,t)}_apply(e){const t=(function(r,a,o){if(r.startAt!==null)throw new H(B.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new H(B.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ja(a,o)})(e._query,this._field,this._direction);return new gs(e.firestore,e.converter,(function(r,a){const o=r.explicitOrderBy.concat([a]);return new Gi(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)})(e._query,t))}}function sw(n,e="asc"){const t=e,s=Al("orderBy",n);return Bh._create(s,t)}class $h extends Uh{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new $h(e,t,s)}_apply(e){return new gs(e.firestore,e.converter,Mc(e._query,this._limit,this._limitType))}}function rw(n){return $h._create("limit",n,"F")}function Gp(n,e,t){if(typeof(t=Ge(t))=="string"){if(t==="")throw new H(B.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Oy(e)&&t.indexOf("/")!==-1)throw new H(B.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child($e.fromString(t));if(!Y.isDocumentKey(s))throw new H(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Wa(n,new Y(s))}if(t instanceof at)return Wa(n,t._key);throw new H(B.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${cl(t)}.`)}function Hp(n,e){if(!Array.isArray(n)||n.length===0)throw new H(B.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function iw(n,e){const t=(function(r,a){for(const o of r)for(const c of o.getFlattenedFilters())if(a.indexOf(c.op)>=0)return c.op;return null})(n.filters,(function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new H(B.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new H(B.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class aw{convertValue(e,t="none"){switch(Qs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(fs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ne(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return tr(e,((r,a)=>{s[r]=this.convertValue(a,t)})),s}convertVectorValue(e){const t=e.fields?.[Pi].arrayValue?.values?.map((s=>nt(s.doubleValue)));return new Wn(t)}convertGeoPoint(e){return new Kn(nt(e.latitude),nt(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=fl(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Ha(e));default:return null}}convertTimestamp(e){const t=hs(e);return new Qe(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=$e.fromString(e);ie(d_(s),9688,{name:e});const r=new Sr(s.get(1),s.get(3)),a=new Y(s.popFirst(5));return r.isEqual(t)||Gt(`Document ${a} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qh(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class Kj extends aw{constructor(e){super(),this.firestore=e}convertBytes(e){return new dn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new at(this.firestore,null,t)}}class fi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ws extends Kc{constructor(e,t,s,r,a,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new pc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Al("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new H(B.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ws._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Ws._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ws._jsonSchema={type:mt("string",Ws._jsonSchemaVersion),bundleSource:mt("string","DocumentSnapshot"),bundleName:mt("string"),bundle:mt("string")};class pc extends Ws{data(e={}){return super.data(e)}}class Nr{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new fi(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new pc(this._firestore,this._userDataWriter,s.key,s,new fi(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new H(B.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,a){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map((c=>{const u=new pc(r._firestore,r._userDataWriter,c.doc.key,c.doc,new fi(r._snapshot.mutatedKeys.has(c.doc.key),r._snapshot.fromCache),r.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}}))}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((c=>a||c.type!==3)).map((c=>{const u=new pc(r._firestore,r._userDataWriter,c.doc.key,c.doc,new fi(r._snapshot.mutatedKeys.has(c.doc.key),r._snapshot.fromCache),r.query.converter);let d=-1,h=-1;return c.type!==0&&(d=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),h=o.indexOf(c.doc.key)),{type:Wj(c.type),doc:u,oldIndex:d,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new H(B.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Nr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Gd.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((a=>{a._document!==null&&(t.push(a._document),s.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),r.push(a.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Wj(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ne(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cn(n){n=tn(n,at);const e=tn(n.firestore,Yn);return Vj(wo(e),n._key).then((t=>ow(e,n,t)))}Nr._jsonSchemaVersion="firestore/querySnapshot/1.0",Nr._jsonSchema={type:mt("string",Nr._jsonSchemaVersion),bundleSource:mt("string","QuerySnapshot"),bundleName:mt("string"),bundle:mt("string")};class kl extends aw{constructor(e){super(),this.firestore=e}convertBytes(e){return new dn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new at(this.firestore,null,t)}}function Sn(n){n=tn(n,gs);const e=tn(n.firestore,Yn),t=wo(e),s=new kl(e);return nw(n._query),Lj(t,n._query).then((r=>new Nr(e,s,n,r)))}function kn(n,e,t){n=tn(n,at);const s=tn(n.firestore,Yn),r=qh(n.converter,e,t);return Cl(s,[Rh(vo(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,dt.none())])}function ct(n,e,t,...s){n=tn(n,at);const r=tn(n.firestore,Yn),a=vo(r);let o;return o=typeof(e=Ge(e))=="string"||e instanceof bo?X_(a,"updateDoc",n._key,e,t,s):Y_(a,"updateDoc",n._key,e),Cl(r,[o.toMutation(n._key,dt.exists(!0))])}function Wc(n){return Cl(tn(n.firestore,Yn),[new po(n._key,dt.none())])}function cd(n,e){const t=tn(n.firestore,Yn),s=be(n),r=qh(n.converter,e);return Cl(t,[Rh(vo(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,dt.exists(!1))]).then((()=>s))}function Io(n,...e){n=Ge(n);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||zp(e[s])||(t=e[s++]);const r={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(zp(e[s])){const u=e[s];e[s]=u.next?.bind(u),e[s+1]=u.error?.bind(u),e[s+2]=u.complete?.bind(u)}let a,o,c;if(n instanceof at)o=tn(n.firestore,Yn),c=fo(n._key.path),a={next:u=>{e[s]&&e[s](ow(o,n,u))},error:e[s+1],complete:e[s+2]};else{const u=tn(n,gs);o=tn(u.firestore,Yn),c=u._query;const d=new kl(o);a={next:h=>{e[s]&&e[s](new Nr(o,d,u,h))},error:e[s+1],complete:e[s+2]},nw(n._query)}return(function(d,h,m,p){const w=new kh(p),v=new Eh(h,w,m);return d.asyncQueue.enqueueAndForget((async()=>Ih(await Gc(d),v))),()=>{w.Nu(),d.asyncQueue.enqueueAndForget((async()=>Th(await Gc(d),v)))}})(wo(o),c,r,a)}function Cl(n,e){return(function(s,r){const a=new jn;return s.asyncQueue.enqueueAndForget((async()=>wj(await Pj(s),r,a))),a.promise})(wo(n),e)}function ow(n,e,t){const s=t.docs.get(e._key),r=new kl(n);return new Ws(n,r,e._key,s,new fi(t.hasPendingWrites,t.fromCache),e.converter)}class Qj{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=Xj(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function Jj(n){return new Qj(n)}class Yj{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=zc.provider,this._offlineComponentProvider={build:t=>new jj(t,e?.cacheSizeBytes,this.forceOwnership)}}}function Xj(n){return new Yj(n?.forceOwnership)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zj={maxAttempts:5};function ba(n,e){if((n=Ge(n)).firestore!==e)throw new H(B.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ek{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=vo(e)}get(e){const t=ba(e,this._firestore),s=new Kj(this._firestore);return this._transaction.lookup([t._key]).then((r=>{if(!r||r.length!==1)return ne(24041);const a=r[0];if(a.isFoundDocument())return new Kc(this._firestore,s,a.key,a,t.converter);if(a.isNoDocument())return new Kc(this._firestore,s,t._key,null,t.converter);throw ne(18433,{doc:a})}))}set(e,t,s){const r=ba(e,this._firestore),a=qh(r.converter,t,s),o=Rh(this._dataReader,"Transaction.set",r._key,a,r.converter!==null,s);return this._transaction.set(r._key,o),this}update(e,t,s,...r){const a=ba(e,this._firestore);let o;return o=typeof(t=Ge(t))=="string"||t instanceof bo?X_(this._dataReader,"Transaction.update",a._key,t,s,r):Y_(this._dataReader,"Transaction.update",a._key,t),this._transaction.update(a._key,o),this}delete(e){const t=ba(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk extends ek{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ba(e,this._firestore),s=new kl(this._firestore);return super.get(e).then((r=>new Ws(this._firestore,s,t._key,r._document,new fi(!1,!1),t.converter)))}}function cw(n,e,t){n=tn(n,Yn);const s={...Zj,...t};return(function(a){if(a.maxAttempts<1)throw new H(B.INVALID_ARGUMENT,"Max attempts must be at least 1")})(s),(function(a,o,c){const u=new jn;return a.asyncQueue.enqueueAndForget((async()=>{const d=await Dj(a);new Cj(a.asyncQueue,d,c,o,u).ju()})),u.promise})(wo(n),(r=>e(new tk(n,r))),s)}function Yt(){return new Ph("serverTimestamp")}function nk(...n){return new Dh("arrayUnion",n)}function zt(n){return new Vh("increment",n)}(function(e,t=!0){(function(r){zi=r})(qr),nn(new Kt("firestore",((s,{instanceIdentifier:r,options:a})=>{const o=s.getProvider("app").getImmediate(),c=new Yn(new IN(s.getProvider("auth-internal")),new EN(o,s.getProvider("app-check-internal")),(function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new H(B.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Sr(d.options.projectId,h)})(o,r),o);return a={useFetchStreams:t,...a},c._setSettings(a),c}),"PUBLIC").setMultipleInstances(!0)),St(Nm,Em,e),St(Nm,Em,"esm2020")})();const lw="@firebase/installations",zh="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uw=1e4,dw=`w:${zh}`,hw="FIS_v2",sk="https://firebaseinstallations.googleapis.com/v1",rk=3600*1e3,ik="installations",ak="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ok={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Mr=new Zs(ik,ak,ok);function fw(n){return n instanceof gn&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw({projectId:n}){return`${sk}/projects/${n}/installations`}function pw(n){return{token:n.token,requestStatus:2,expiresIn:lk(n.expiresIn),creationTime:Date.now()}}async function gw(n,e){const s=(await e.json()).error;return Mr.create("request-failed",{requestName:n,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function xw({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function ck(n,{refreshToken:e}){const t=xw(n);return t.append("Authorization",uk(e)),t}async function yw(n){const e=await n();return e.status>=500&&e.status<600?n():e}function lk(n){return Number(n.replace("s","000"))}function uk(n){return`${hw} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dk({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const s=mw(n),r=xw(n),a=e.getImmediate({optional:!0});if(a){const d=await a.getHeartbeatsHeader();d&&r.append("x-firebase-client",d)}const o={fid:t,authVersion:hw,appId:n.appId,sdkVersion:dw},c={method:"POST",headers:r,body:JSON.stringify(o)},u=await yw(()=>fetch(s,c));if(u.ok){const d=await u.json();return{fid:d.fid||t,registrationStatus:2,refreshToken:d.refreshToken,authToken:pw(d.authToken)}}else throw await gw("Create Installation",u)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _w(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hk(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk=/^[cdef][\w-]{21}$/,ld="";function mk(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=pk(n);return fk.test(t)?t:ld}catch{return ld}}function pk(n){return hk(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sl(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ww=new Map;function bw(n,e){const t=Sl(n);vw(t,e),gk(t,e)}function vw(n,e){const t=ww.get(n);if(t)for(const s of t)s(e)}function gk(n,e){const t=xk();t&&t.postMessage({key:n,fid:e}),yk()}let wr=null;function xk(){return!wr&&"BroadcastChannel"in self&&(wr=new BroadcastChannel("[Firebase] FID Change"),wr.onmessage=n=>{vw(n.data.key,n.data.fid)}),wr}function yk(){ww.size===0&&wr&&(wr.close(),wr=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _k="firebase-installations-database",wk=1,Ur="firebase-installations-store";let hu=null;function Gh(){return hu||(hu=gx(_k,wk,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Ur)}}})),hu}async function Qc(n,e){const t=Sl(n),r=(await Gh()).transaction(Ur,"readwrite"),a=r.objectStore(Ur),o=await a.get(t);return await a.put(e,t),await r.done,(!o||o.fid!==e.fid)&&bw(n,e.fid),e}async function Iw(n){const e=Sl(n),s=(await Gh()).transaction(Ur,"readwrite");await s.objectStore(Ur).delete(e),await s.done}async function Rl(n,e){const t=Sl(n),r=(await Gh()).transaction(Ur,"readwrite"),a=r.objectStore(Ur),o=await a.get(t),c=e(o);return c===void 0?await a.delete(t):await a.put(c,t),await r.done,c&&(!o||o.fid!==c.fid)&&bw(n,c.fid),c}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hh(n){let e;const t=await Rl(n.appConfig,s=>{const r=bk(s),a=vk(n,r);return e=a.registrationPromise,a.installationEntry});return t.fid===ld?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function bk(n){const e=n||{fid:mk(),registrationStatus:0};return Tw(e)}function vk(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const r=Promise.reject(Mr.create("app-offline"));return{installationEntry:e,registrationPromise:r}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=Ik(n,t);return{installationEntry:t,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Tk(n)}:{installationEntry:e}}async function Ik(n,e){try{const t=await dk(n,e);return Qc(n.appConfig,t)}catch(t){throw fw(t)&&t.customData.serverCode===409?await Iw(n.appConfig):await Qc(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function Tk(n){let e=await Kp(n.appConfig);for(;e.registrationStatus===1;)await _w(100),e=await Kp(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:s}=await Hh(n);return s||t}return e}function Kp(n){return Rl(n,e=>{if(!e)throw Mr.create("installation-not-found");return Tw(e)})}function Tw(n){return Nk(n)?{fid:n.fid,registrationStatus:0}:n}function Nk(n){return n.registrationStatus===1&&n.registrationTime+uw<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ek({appConfig:n,heartbeatServiceProvider:e},t){const s=Ak(n,t),r=ck(n,t),a=e.getImmediate({optional:!0});if(a){const d=await a.getHeartbeatsHeader();d&&r.append("x-firebase-client",d)}const o={installation:{sdkVersion:dw,appId:n.appId}},c={method:"POST",headers:r,body:JSON.stringify(o)},u=await yw(()=>fetch(s,c));if(u.ok){const d=await u.json();return pw(d)}else throw await gw("Generate Auth Token",u)}function Ak(n,{fid:e}){return`${mw(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kh(n,e=!1){let t;const s=await Rl(n.appConfig,a=>{if(!Nw(a))throw Mr.create("not-registered");const o=a.authToken;if(!e&&Ck(o))return a;if(o.requestStatus===1)return t=jk(n,e),a;{if(!navigator.onLine)throw Mr.create("app-offline");const c=Rk(a);return t=kk(n,c),c}});return t?await t:s.authToken}async function jk(n,e){let t=await Wp(n.appConfig);for(;t.authToken.requestStatus===1;)await _w(100),t=await Wp(n.appConfig);const s=t.authToken;return s.requestStatus===0?Kh(n,e):s}function Wp(n){return Rl(n,e=>{if(!Nw(e))throw Mr.create("not-registered");const t=e.authToken;return Pk(t)?{...e,authToken:{requestStatus:0}}:e})}async function kk(n,e){try{const t=await Ek(n,e),s={...e,authToken:t};return await Qc(n.appConfig,s),t}catch(t){if(fw(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Iw(n.appConfig);else{const s={...e,authToken:{requestStatus:0}};await Qc(n.appConfig,s)}throw t}}function Nw(n){return n!==void 0&&n.registrationStatus===2}function Ck(n){return n.requestStatus===2&&!Sk(n)}function Sk(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+rk}function Rk(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function Pk(n){return n.requestStatus===1&&n.requestTime+uw<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dk(n){const e=n,{installationEntry:t,registrationPromise:s}=await Hh(e);return s?s.catch(console.error):Kh(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vk(n,e=!1){const t=n;return await Lk(t),(await Kh(t,e)).token}async function Lk(n){const{registrationPromise:e}=await Hh(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ok(n){if(!n||!n.options)throw fu("App Configuration");if(!n.name)throw fu("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw fu(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function fu(n){return Mr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ew="installations",Mk="installations-internal",Uk=n=>{const e=n.getProvider("app").getImmediate(),t=Ok(e),s=Rn(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},Fk=n=>{const e=n.getProvider("app").getImmediate(),t=Rn(e,Ew).getImmediate();return{getId:()=>Dk(t),getToken:r=>Vk(t,r)}};function Bk(){nn(new Kt(Ew,Uk,"PUBLIC")),nn(new Kt(Mk,Fk,"PRIVATE"))}Bk();St(lw,zh);St(lw,zh,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jc="analytics",$k="firebase_id",qk="origin",zk=60*1e3,Gk="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Wh="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ht=new so("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},mn=new Zs("analytics","Analytics",Hk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kk(n){if(!n.startsWith(Wh)){const e=mn.create("invalid-gtag-resource",{gtagURL:n});return Ht.warn(e.message),""}return n}function Aw(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function Wk(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function Qk(n,e){const t=Wk("firebase-js-sdk-policy",{createScriptURL:Kk}),s=document.createElement("script"),r=`${Wh}?l=${n}&id=${e}`;s.src=t?t?.createScriptURL(r):r,s.async=!0,document.head.appendChild(s)}function Jk(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function Yk(n,e,t,s,r,a){const o=s[r];try{if(o)await e[o];else{const u=(await Aw(t)).find(d=>d.measurementId===r);u&&await e[u.appId]}}catch(c){Ht.error(c)}n("config",r,a)}async function Xk(n,e,t,s,r){try{let a=[];if(r&&r.send_to){let o=r.send_to;Array.isArray(o)||(o=[o]);const c=await Aw(t);for(const u of o){const d=c.find(m=>m.measurementId===u),h=d&&e[d.appId];if(h)a.push(h);else{a=[];break}}}a.length===0&&(a=Object.values(e)),await Promise.all(a),n("event",s,r||{})}catch(a){Ht.error(a)}}function Zk(n,e,t,s){async function r(a,...o){try{if(a==="event"){const[c,u]=o;await Xk(n,e,t,c,u)}else if(a==="config"){const[c,u]=o;await Yk(n,e,t,s,c,u)}else if(a==="consent"){const[c,u]=o;n("consent",c,u)}else if(a==="get"){const[c,u,d]=o;n("get",c,u,d)}else if(a==="set"){const[c]=o;n("set",c)}else n(a,...o)}catch(c){Ht.error(c)}}return r}function eC(n,e,t,s,r){let a=function(...o){window[s].push(arguments)};return window[r]&&typeof window[r]=="function"&&(a=window[r]),window[r]=Zk(a,n,e,t),{gtagCore:a,wrappedGtag:window[r]}}function tC(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Wh)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nC=30,sC=1e3;class rC{constructor(e={},t=sC){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const jw=new rC;function iC(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function aC(n){const{appId:e,apiKey:t}=n,s={method:"GET",headers:iC(t)},r=Gk.replace("{app-id}",e),a=await fetch(r,s);if(a.status!==200&&a.status!==304){let o="";try{const c=await a.json();c.error?.message&&(o=c.error.message)}catch{}throw mn.create("config-fetch-failed",{httpStatus:a.status,responseMessage:o})}return a.json()}async function oC(n,e=jw,t){const{appId:s,apiKey:r,measurementId:a}=n.options;if(!s)throw mn.create("no-app-id");if(!r){if(a)return{measurementId:a,appId:s};throw mn.create("no-api-key")}const o=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new uC;return setTimeout(async()=>{c.abort()},zk),kw({appId:s,apiKey:r,measurementId:a},o,c,e)}async function kw(n,{throttleEndTimeMillis:e,backoffCount:t},s,r=jw){const{appId:a,measurementId:o}=n;try{await cC(s,e)}catch(c){if(o)return Ht.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${c?.message}]`),{appId:a,measurementId:o};throw c}try{const c=await aC(n);return r.deleteThrottleMetadata(a),c}catch(c){const u=c;if(!lC(u)){if(r.deleteThrottleMetadata(a),o)return Ht.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u?.message}]`),{appId:a,measurementId:o};throw c}const d=Number(u?.customData?.httpStatus)===503?ju(t,r.intervalMillis,nC):ju(t,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+d,backoffCount:t+1};return r.setThrottleMetadata(a,h),Ht.debug(`Calling attemptFetch again in ${d} millis`),kw(n,h,s,r)}}function cC(n,e){return new Promise((t,s)=>{const r=Math.max(e-Date.now(),0),a=setTimeout(t,r);n.addEventListener(()=>{clearTimeout(a),s(mn.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function lC(n){if(!(n instanceof gn)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class uC{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function dC(n,e,t,s,r){if(r&&r.global){n("event",t,s);return}else{const a=await e,o={...s,send_to:a};n("event",t,o)}}async function hC(n,e,t,s){if(s&&s.global){const r={};for(const a of Object.keys(t))r[`user_properties.${a}`]=t[a];return n("set",r),Promise.resolve()}else{const r=await e;n("config",r,{update:!0,user_properties:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fC(){if(qi())try{await Rd()}catch(n){return Ht.warn(mn.create("indexeddb-unavailable",{errorInfo:n?.toString()}).message),!1}else return Ht.warn(mn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function mC(n,e,t,s,r,a,o){const c=oC(n);c.then(p=>{t[p.measurementId]=p.appId,n.options.measurementId&&p.measurementId!==n.options.measurementId&&Ht.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>Ht.error(p)),e.push(c);const u=fC().then(p=>{if(p)return s.getId()}),[d,h]=await Promise.all([c,u]);tC(a)||Qk(a,d.measurementId),r("js",new Date);const m=o?.config??{};return m[qk]="firebase",m.update=!0,h!=null&&(m[$k]=h),r("config",d.measurementId,m),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pC{constructor(e){this.app=e}_delete(){return delete Ii[this.app.options.appId],Promise.resolve()}}let Ii={},Qp=[];const Jp={};let mu="dataLayer",gC="gtag",Yp,Qh,Xp=!1;function xC(){const n=[];if(Sd()&&n.push("This is a browser extension environment."),fx()||n.push("Cookies are not available."),n.length>0){const e=n.map((s,r)=>`(${r+1}) ${s}`).join(" "),t=mn.create("invalid-analytics-context",{errorInfo:e});Ht.warn(t.message)}}function yC(n,e,t){xC();const s=n.options.appId;if(!s)throw mn.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Ht.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw mn.create("no-api-key");if(Ii[s]!=null)throw mn.create("already-exists",{id:s});if(!Xp){Jk(mu);const{wrappedGtag:a,gtagCore:o}=eC(Ii,Qp,Jp,mu,gC);Qh=a,Yp=o,Xp=!0}return Ii[s]=mC(n,Qp,Jp,e,Yp,mu,t),new pC(n)}function _C(n=ro()){n=Ge(n);const e=Rn(n,Jc);return e.isInitialized()?e.getImmediate():wC(n)}function wC(n,e={}){const t=Rn(n,Jc);if(t.isInitialized()){const r=t.getImmediate();if(ls(e,t.getOptions()))return r;throw mn.create("already-initialized")}return t.initialize({options:e})}async function bC(){if(Sd()||!fx()||!qi())return!1;try{return await Rd()}catch{return!1}}function vC(n,e,t){n=Ge(n),hC(Qh,Ii[n.app.options.appId],e,t).catch(s=>Ht.error(s))}function IC(n,e,t,s){n=Ge(n),dC(Qh,Ii[n.app.options.appId],e,t,s).catch(r=>Ht.error(r))}const Zp="@firebase/analytics",eg="0.10.19";function TC(){nn(new Kt(Jc,(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();return yC(s,r,t)},"PUBLIC")),nn(new Kt("analytics-internal",n,"PRIVATE")),St(Zp,eg),St(Zp,eg,"esm2020");function n(e){try{const t=e.getProvider(Jc).getImmediate();return{logEvent:(s,r,a)=>IC(t,s,r,a),setUserProperties:(s,r)=>vC(t,s,r)}}catch(t){throw mn.create("interop-component-reg-failed",{reason:t})}}}TC();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ud=new Map,Cw={activated:!1,tokenObservers:[]},NC={initialized:!1,enabled:!1};function yt(n){return ud.get(n)||{...Cw}}function EC(n,e){return ud.set(n,e),ud.get(n)}function Pl(){return NC}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sw="https://content-firebaseappcheck.googleapis.com/v1",AC="exchangeRecaptchaEnterpriseToken",jC="exchangeDebugToken",tg={RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},kC=1440*60*1e3;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CC{constructor(e,t,s,r,a){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=s,this.lowerBound=r,this.upperBound=a,this.pending=null,this.nextErrorWaitInterval=r,r>a)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Oa,this.pending.promise.catch(t=>{}),await SC(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new Oa,this.pending.promise.catch(t=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}function SC(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RC={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Zt=new Zs("appCheck","AppCheck",RC);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ng(n=!1){return n?self.grecaptcha?.enterprise:self.grecaptcha}function Jh(n){if(!yt(n).activated)throw Zt.create("use-before-activation",{appName:n.name})}function Rw(n){const e=Math.round(n/1e3),t=Math.floor(e/(3600*24)),s=Math.floor((e-t*3600*24)/3600),r=Math.floor((e-t*3600*24-s*3600)/60),a=e-t*3600*24-s*3600-r*60;let o="";return t&&(o+=Go(t)+"d:"),s&&(o+=Go(s)+"h:"),o+=Go(r)+"m:"+Go(a)+"s",o}function Go(n){return n===0?"00":n>=10?n.toString():"0"+n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yh({url:n,body:e},t){const s={"Content-Type":"application/json"},r=t.getImmediate({optional:!0});if(r){const m=await r.getHeartbeatsHeader();m&&(s["X-Firebase-Client"]=m)}const a={method:"POST",body:JSON.stringify(e),headers:s};let o;try{o=await fetch(n,a)}catch(m){throw Zt.create("fetch-network-error",{originalErrorMessage:m?.message})}if(o.status!==200)throw Zt.create("fetch-status-error",{httpStatus:o.status});let c;try{c=await o.json()}catch(m){throw Zt.create("fetch-parse-error",{originalErrorMessage:m?.message})}const u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Zt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});const d=Number(u[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}}function PC(n,e){const{projectId:t,appId:s,apiKey:r}=n.options;return{url:`${Sw}/projects/${t}/apps/${s}:${AC}?key=${r}`,body:{recaptcha_enterprise_token:e}}}function Pw(n,e){const{projectId:t,appId:s,apiKey:r}=n.options;return{url:`${Sw}/projects/${t}/apps/${s}:${jC}?key=${r}`,body:{debug_token:e}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DC="firebase-app-check-database",VC=1,eo="firebase-app-check-store",Dw="debug-token";let Ho=null;function Vw(){return Ho||(Ho=new Promise((n,e)=>{try{const t=indexedDB.open(DC,VC);t.onsuccess=s=>{n(s.target.result)},t.onerror=s=>{e(Zt.create("storage-open",{originalErrorMessage:s.target.error?.message}))},t.onupgradeneeded=s=>{const r=s.target.result;switch(s.oldVersion){case 0:r.createObjectStore(eo,{keyPath:"compositeKey"})}}}catch(t){e(Zt.create("storage-open",{originalErrorMessage:t?.message}))}}),Ho)}function LC(n){return Ow(Mw(n))}function OC(n,e){return Lw(Mw(n),e)}function MC(n){return Lw(Dw,n)}function UC(){return Ow(Dw)}async function Lw(n,e){const s=(await Vw()).transaction(eo,"readwrite"),a=s.objectStore(eo).put({compositeKey:n,value:e});return new Promise((o,c)=>{a.onsuccess=u=>{o()},s.onerror=u=>{c(Zt.create("storage-set",{originalErrorMessage:u.target.error?.message}))}})}async function Ow(n){const t=(await Vw()).transaction(eo,"readonly"),r=t.objectStore(eo).get(n);return new Promise((a,o)=>{r.onsuccess=c=>{const u=c.target.result;a(u?u.value:void 0)},t.onerror=c=>{o(Zt.create("storage-get",{originalErrorMessage:c.target.error?.message}))}})}function Mw(n){return`${n.options.appId}-${n.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fs=new so("@firebase/app-check");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FC(n){if(qi()){let e;try{e=await LC(n)}catch(t){Fs.warn(`Failed to read token from IndexedDB. Error: ${t}`)}return e}}function pu(n,e){return qi()?OC(n,e).catch(t=>{Fs.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}async function BC(){let n;try{n=await UC()}catch{}if(n)return n;{const e=crypto.randomUUID();return MC(e).catch(t=>Fs.warn(`Failed to persist debug token to IndexedDB. Error: ${t}`)),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xh(){return Pl().enabled}async function Zh(){const n=Pl();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function $C(){const n=kd(),e=Pl();if(e.initialized=!0,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN!="string"&&n.FIREBASE_APPCHECK_DEBUG_TOKEN!==!0)return;e.enabled=!0;const t=new Oa;e.token=t,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN=="string"?t.resolve(n.FIREBASE_APPCHECK_DEBUG_TOKEN):t.resolve(BC())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qC={error:"UNKNOWN_ERROR"};function zC(n){return jd.encodeString(JSON.stringify(n),!1)}async function dd(n,e=!1,t=!1){const s=n.app;Jh(s);const r=yt(s);let a=r.token,o;if(a&&!mi(a)&&(r.token=void 0,a=void 0),!a){const d=await r.cachedTokenPromise;d&&(mi(d)?a=d:await pu(s,void 0))}if(!e&&a&&mi(a))return{token:a.token};let c=!1;if(Xh())try{r.exchangeTokenPromise||(r.exchangeTokenPromise=Yh(Pw(s,await Zh()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),c=!0);const d=await r.exchangeTokenPromise;return await pu(s,d),r.token=d,{token:d.token}}catch(d){return d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?Fs.warn(d.message):t&&Fs.error(d),gu(d)}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),c=!0),a=await yt(s).exchangeTokenPromise}catch(d){d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?Fs.warn(d.message):t&&Fs.error(d),o=d}let u;return a?o?mi(a)?u={token:a.token,internalError:o}:u=gu(o):(u={token:a.token},r.token=a,await pu(s,a)):u=gu(o),c&&Bw(s,u),u}async function GC(n){const e=n.app;Jh(e);const{provider:t}=yt(e);if(Xh()){const s=await Zh(),{token:r}=await Yh(Pw(e,s),n.heartbeatServiceProvider);return{token:r}}else{const{token:s}=await t.getToken();return{token:s}}}function Uw(n,e,t,s){const{app:r}=n,a=yt(r),o={next:t,error:s,type:e};if(a.tokenObservers=[...a.tokenObservers,o],a.token&&mi(a.token)){const c=a.token;Promise.resolve().then(()=>{t({token:c.token}),sg(n)}).catch(()=>{})}a.cachedTokenPromise.then(()=>sg(n))}function Fw(n,e){const t=yt(n),s=t.tokenObservers.filter(r=>r.next!==e);s.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=s}function sg(n){const{app:e}=n,t=yt(e);let s=t.tokenRefresher;s||(s=HC(n),t.tokenRefresher=s),!s.isRunning()&&t.isTokenAutoRefreshEnabled&&s.start()}function HC(n){const{app:e}=n;return new CC(async()=>{const t=yt(e);let s;if(t.token?s=await dd(n,!0):s=await dd(n),s.error)throw s.error;if(s.internalError)throw s.internalError},()=>!0,()=>{const t=yt(e);if(t.token){let s=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5;const r=t.token.expireTimeMillis-300*1e3;return s=Math.min(s,r),Math.max(0,s-Date.now())}else return 0},tg.RETRIAL_MIN_WAIT,tg.RETRIAL_MAX_WAIT)}function Bw(n,e){const t=yt(n).tokenObservers;for(const s of t)try{s.type==="EXTERNAL"&&e.error!=null?s.error(e.error):s.next(e)}catch{}}function mi(n){return n.expireTimeMillis-Date.now()>0}function gu(n){return{token:zC(qC),error:n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=yt(this.app);for(const t of e)Fw(this.app,t.next);return Promise.resolve()}}function WC(n,e){return new KC(n,e)}function QC(n){return{getToken:e=>dd(n,e),getLimitedUseToken:()=>GC(n),addTokenListener:e=>Uw(n,"INTERNAL",e),removeTokenListener:e=>Fw(n.app,e)}}const JC="@firebase/app-check",YC="0.11.0",XC="https://www.google.com/recaptcha/enterprise.js";function ZC(n,e){const t=new Oa,s=yt(n);s.reCAPTCHAState={initialized:t};const r=eS(n),a=ng(!0);return a?rg(n,e,a,r,t):sS(()=>{const o=ng(!0);if(!o)throw new Error("no recaptcha");rg(n,e,o,r,t)}),t.promise}function rg(n,e,t,s,r){t.ready(()=>{nS(n,e,t,s),r.resolve(t)})}function eS(n){const e=`fire_app_check_${n.name}`,t=document.createElement("div");return t.id=e,t.style.display="none",document.body.appendChild(t),e}async function tS(n){Jh(n);const t=await yt(n).reCAPTCHAState.initialized.promise;return new Promise((s,r)=>{const a=yt(n).reCAPTCHAState;t.ready(()=>{s(t.execute(a.widgetId,{action:"fire_app_check"}))})})}function nS(n,e,t,s){const r=t.render(s,{sitekey:e,size:"invisible",callback:()=>{yt(n).reCAPTCHAState.succeeded=!0},"error-callback":()=>{yt(n).reCAPTCHAState.succeeded=!1}}),a=yt(n);a.reCAPTCHAState={...a.reCAPTCHAState,widgetId:r}}function sS(n){const e=document.createElement("script");e.src=XC,e.onload=n,document.head.appendChild(e)}class ef{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){iS(this._throttleData);const e=await tS(this._app).catch(s=>{throw Zt.create("recaptcha-error")});if(!yt(this._app).reCAPTCHAState?.succeeded)throw Zt.create("recaptcha-error");let t;try{t=await Yh(PC(this._app,e),this._heartbeatServiceProvider)}catch(s){throw s.code?.includes("fetch-status-error")?(this._throttleData=rS(Number(s.customData?.httpStatus),this._throttleData),Zt.create("initial-throttle",{time:Rw(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):s}return this._throttleData=null,t}initialize(e){this._app=e,this._heartbeatServiceProvider=Rn(e,"heartbeat"),ZC(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof ef?this._siteKey===e._siteKey:!1}}function rS(n,e){if(n===404||n===403)return{backoffCount:1,allowRequestsAfter:Date.now()+kC,httpStatus:n};{const t=e?e.backoffCount:0,s=ju(t,1e3,2);return{backoffCount:t+1,allowRequestsAfter:Date.now()+s,httpStatus:n}}}function iS(n){if(n&&Date.now()-n.allowRequestsAfter<=0)throw Zt.create("throttled",{time:Rw(n.allowRequestsAfter-Date.now()),httpStatus:n.httpStatus})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aS(n=ro(),e){n=Ge(n);const t=Rn(n,"app-check");if(Pl().initialized||$C(),Xh()&&Zh().then(r=>console.log(`App Check debug token: ${r}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),t.isInitialized()){const r=t.getImmediate(),a=t.getOptions();if(a.isTokenAutoRefreshEnabled===e.isTokenAutoRefreshEnabled&&a.provider.isEqual(e.provider))return r;throw Zt.create("already-initialized",{appName:n.name})}const s=t.initialize({options:e});return oS(n,e.provider,e.isTokenAutoRefreshEnabled),yt(n).isTokenAutoRefreshEnabled&&Uw(s,"INTERNAL",()=>{}),s}function oS(n,e,t=!1){const s=EC(n,{...Cw});s.activated=!0,s.provider=e,s.cachedTokenPromise=FC(n).then(r=>(r&&mi(r)&&(s.token=r,Bw(n,{token:r.token})),r)),s.isTokenAutoRefreshEnabled=t&&n.automaticDataCollectionEnabled,!n.automaticDataCollectionEnabled&&t&&Fs.warn("`isTokenAutoRefreshEnabled` is true but `automaticDataCollectionEnabled` was set to false during `initializeApp()`. This blocks automatic token refresh."),s.provider.initialize(n)}const cS="app-check",ig="app-check-internal";function lS(){nn(new Kt(cS,n=>{const e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return WC(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(ig).initialize()})),nn(new Kt(ig,n=>{const e=n.getProvider("app-check").getImmediate();return QC(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),St(JC,YC)}lS();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $w="firebasestorage.googleapis.com",qw="storageBucket",uS=120*1e3,dS=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ut extends gn{constructor(e,t,s=0){super(xu(e),`Firebase Storage: ${t} (${xu(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ut.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return xu(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var lt;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(lt||(lt={}));function xu(n){return"storage/"+n}function tf(){const n="An unknown error occurred, please check the error payload for server response.";return new ut(lt.UNKNOWN,n)}function hS(n){return new ut(lt.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function fS(n){return new ut(lt.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function mS(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ut(lt.UNAUTHENTICATED,n)}function pS(){return new ut(lt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function gS(n){return new ut(lt.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function xS(){return new ut(lt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function yS(){return new ut(lt.CANCELED,"User canceled the upload/download.")}function _S(n){return new ut(lt.INVALID_URL,"Invalid URL '"+n+"'.")}function wS(n){return new ut(lt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function bS(){return new ut(lt.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+qw+"' property when initializing the app?")}function vS(){return new ut(lt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function IS(){return new ut(lt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function TS(n){return new ut(lt.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function hd(n){return new ut(lt.INVALID_ARGUMENT,n)}function zw(){return new ut(lt.APP_DELETED,"The Firebase app was deleted.")}function NS(n){return new ut(lt.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Va(n,e){return new ut(lt.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function pa(n){throw new ut(lt.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let s;try{s=fn.makeFromUrl(e,t)}catch{return new fn(e,"")}if(s.path==="")return s;throw wS(e)}static makeFromUrl(e,t){let s=null;const r="([A-Za-z0-9.\\-_]+)";function a(S){S.path.charAt(S.path.length-1)==="/"&&(S.path_=S.path_.slice(0,-1))}const o="(/(.*))?$",c=new RegExp("^gs://"+r+o,"i"),u={bucket:1,path:3};function d(S){S.path_=decodeURIComponent(S.path)}const h="v[A-Za-z0-9_]+",m=t.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",w=new RegExp(`^https?://${m}/${h}/b/${r}/o${p}`,"i"),v={bucket:1,path:3},j=t===$w?"(?:storage.googleapis.com|storage.cloud.google.com)":t,k="([^?#]*)",P=new RegExp(`^https?://${j}/${r}/${k}`,"i"),C=[{regex:c,indices:u,postModify:a},{regex:w,indices:v,postModify:d},{regex:P,indices:{bucket:1,path:2},postModify:d}];for(let S=0;S<C.length;S++){const D=C[S],M=D.regex.exec(e);if(M){const _=M[D.indices.bucket];let y=M[D.indices.path];y||(y=""),s=new fn(_,y),D.postModify(s);break}}if(s==null)throw _S(e);return s}}class ES{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AS(n,e,t){let s=1,r=null,a=null,o=!1,c=0;function u(){return c===2}let d=!1;function h(...k){d||(d=!0,e.apply(null,k))}function m(k){r=setTimeout(()=>{r=null,n(w,u())},k)}function p(){a&&clearTimeout(a)}function w(k,...P){if(d){p();return}if(k){p(),h.call(null,k,...P);return}if(u()||o){p(),h.call(null,k,...P);return}s<64&&(s*=2);let C;c===1?(c=2,C=0):C=(s+Math.random())*1e3,m(C)}let v=!1;function j(k){v||(v=!0,p(),!d&&(r!==null?(k||(c=2),clearTimeout(r),m(0)):k||(c=1)))}return m(0),a=setTimeout(()=>{o=!0,j(!0)},t),j}function jS(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kS(n){return n!==void 0}function CS(n){return typeof n=="object"&&!Array.isArray(n)}function nf(n){return typeof n=="string"||n instanceof String}function ag(n){return sf()&&n instanceof Blob}function sf(){return typeof Blob<"u"}function og(n,e,t,s){if(s<e)throw hd(`Invalid value for '${n}'. Expected ${e} or greater.`);if(s>t)throw hd(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rf(n,e,t){let s=e;return t==null&&(s=`https://${e}`),`${t}://${s}/v0${n}`}function Gw(n){const e=encodeURIComponent;let t="?";for(const s in n)if(n.hasOwnProperty(s)){const r=e(s)+"="+e(n[s]);t=t+r+"&"}return t=t.slice(0,-1),t}var Er;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Er||(Er={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SS(n,e){const t=n>=500&&n<600,r=[408,429].indexOf(n)!==-1,a=e.indexOf(n)!==-1;return t||r||a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RS{constructor(e,t,s,r,a,o,c,u,d,h,m,p=!0,w=!1){this.url_=e,this.method_=t,this.headers_=s,this.body_=r,this.successCodes_=a,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=u,this.timeout_=d,this.progressCallback_=h,this.connectionFactory_=m,this.retry=p,this.isUsingEmulator=w,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,j)=>{this.resolve_=v,this.reject_=j,this.start_()})}start_(){const e=(s,r)=>{if(r){s(!1,new Ko(!1,null,!0));return}const a=this.connectionFactory_();this.pendingConnection_=a;const o=c=>{const u=c.loaded,d=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,d)};this.progressCallback_!==null&&a.addUploadProgressListener(o),a.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&a.removeUploadProgressListener(o),this.pendingConnection_=null;const c=a.getErrorCode()===Er.NO_ERROR,u=a.getStatus();if(!c||SS(u,this.additionalRetryCodes_)&&this.retry){const h=a.getErrorCode()===Er.ABORT;s(!1,new Ko(!1,null,h));return}const d=this.successCodes_.indexOf(u)!==-1;s(!0,new Ko(d,a))})},t=(s,r)=>{const a=this.resolve_,o=this.reject_,c=r.connection;if(r.wasSuccessCode)try{const u=this.callback_(c,c.getResponse());kS(u)?a(u):a()}catch(u){o(u)}else if(c!==null){const u=tf();u.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,u)):o(u)}else if(r.canceled){const u=this.appDelete_?zw():yS();o(u)}else{const u=xS();o(u)}};this.canceled_?t(!1,new Ko(!1,null,!0)):this.backoffId_=AS(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&jS(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ko{constructor(e,t,s){this.wasSuccessCode=e,this.connection=t,this.canceled=!!s}}function PS(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function DS(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function VS(n,e){e&&(n["X-Firebase-GMPID"]=e)}function LS(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function OS(n,e,t,s,r,a,o=!0,c=!1){const u=Gw(n.urlParams),d=n.url+u,h=Object.assign({},n.headers);return VS(h,e),PS(h,t),DS(h,a),LS(h,s),new RS(d,n.method,h,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,r,o,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MS(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function US(...n){const e=MS();if(e!==void 0){const t=new e;for(let s=0;s<n.length;s++)t.append(n[s]);return t.getBlob()}else{if(sf())return new Blob(n);throw new ut(lt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function FS(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BS(n){if(typeof atob>"u")throw TS("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zn={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class yu{constructor(e,t){this.data=e,this.contentType=t||null}}function $S(n,e){switch(n){case zn.RAW:return new yu(Hw(e));case zn.BASE64:case zn.BASE64URL:return new yu(Kw(n,e));case zn.DATA_URL:return new yu(zS(e),GS(e))}throw tf()}function Hw(n){const e=[];for(let t=0;t<n.length;t++){let s=n.charCodeAt(t);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const a=s,o=n.charCodeAt(++t);s=65536|(a&1023)<<10|o&1023,e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(e)}function qS(n){let e;try{e=decodeURIComponent(n)}catch{throw Va(zn.DATA_URL,"Malformed data URL.")}return Hw(e)}function Kw(n,e){switch(n){case zn.BASE64:{const r=e.indexOf("-")!==-1,a=e.indexOf("_")!==-1;if(r||a)throw Va(n,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case zn.BASE64URL:{const r=e.indexOf("+")!==-1,a=e.indexOf("/")!==-1;if(r||a)throw Va(n,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=BS(e)}catch(r){throw r.message.includes("polyfill")?r:Va(n,"Invalid character found")}const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}class Ww{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Va(zn.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=t[1]||null;s!=null&&(this.base64=HS(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}}function zS(n){const e=new Ww(n);return e.base64?Kw(zn.BASE64,e.rest):qS(e.rest)}function GS(n){return new Ww(n).contentType}function HS(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os{constructor(e,t){let s=0,r="";ag(e)?(this.data_=e,s=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(ag(this.data_)){const s=this.data_,r=FS(s,e,t);return r===null?null:new Os(r)}else{const s=new Uint8Array(this.data_.buffer,e,t-e);return new Os(s,!0)}}static getBlob(...e){if(sf()){const t=e.map(s=>s instanceof Os?s.data_:s);return new Os(US.apply(null,t))}else{const t=e.map(o=>nf(o)?$S(zn.RAW,o).data:o.data_);let s=0;t.forEach(o=>{s+=o.byteLength});const r=new Uint8Array(s);let a=0;return t.forEach(o=>{for(let c=0;c<o.length;c++)r[a++]=o[c]}),new Os(r,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qw(n){let e;try{e=JSON.parse(n)}catch{return null}return CS(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KS(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function WS(n,e){const t=e.split("/").filter(s=>s.length>0).join("/");return n.length===0?t:n+"/"+t}function Jw(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QS(n,e){return e}class $t{constructor(e,t,s,r){this.server=e,this.local=t||e,this.writable=!!s,this.xform=r||QS}}let Wo=null;function JS(n){return!nf(n)||n.length<2?n:Jw(n)}function Yw(){if(Wo)return Wo;const n=[];n.push(new $t("bucket")),n.push(new $t("generation")),n.push(new $t("metageneration")),n.push(new $t("name","fullPath",!0));function e(a,o){return JS(o)}const t=new $t("name");t.xform=e,n.push(t);function s(a,o){return o!==void 0?Number(o):o}const r=new $t("size");return r.xform=s,n.push(r),n.push(new $t("timeCreated")),n.push(new $t("updated")),n.push(new $t("md5Hash",null,!0)),n.push(new $t("cacheControl",null,!0)),n.push(new $t("contentDisposition",null,!0)),n.push(new $t("contentEncoding",null,!0)),n.push(new $t("contentLanguage",null,!0)),n.push(new $t("contentType",null,!0)),n.push(new $t("metadata","customMetadata",!0)),Wo=n,Wo}function YS(n,e){function t(){const s=n.bucket,r=n.fullPath,a=new fn(s,r);return e._makeStorageReference(a)}Object.defineProperty(n,"ref",{get:t})}function XS(n,e,t){const s={};s.type="file";const r=t.length;for(let a=0;a<r;a++){const o=t[a];s[o.local]=o.xform(s,e[o.server])}return YS(s,n),s}function Xw(n,e,t){const s=Qw(e);return s===null?null:XS(n,s,t)}function ZS(n,e,t,s){const r=Qw(e);if(r===null||!nf(r.downloadTokens))return null;const a=r.downloadTokens;if(a.length===0)return null;const o=encodeURIComponent;return a.split(",").map(d=>{const h=n.bucket,m=n.fullPath,p="/b/"+o(h)+"/o/"+o(m),w=rf(p,t,s),v=Gw({alt:"media",token:d});return w+v})[0]}function eR(n,e){const t={},s=e.length;for(let r=0;r<s;r++){const a=e[r];a.writable&&(t[a.server]=n[a.local])}return JSON.stringify(t)}class Zw{constructor(e,t,s,r){this.url=e,this.method=t,this.handler=s,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eb(n){if(!n)throw tf()}function tR(n,e){function t(s,r){const a=Xw(n,r,e);return eb(a!==null),a}return t}function nR(n,e){function t(s,r){const a=Xw(n,r,e);return eb(a!==null),ZS(a,r,n.host,n._protocol)}return t}function tb(n){function e(t,s){let r;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?r=pS():r=mS():t.getStatus()===402?r=fS(n.bucket):t.getStatus()===403?r=gS(n.path):r=s,r.status=t.getStatus(),r.serverResponse=s.serverResponse,r}return e}function sR(n){const e=tb(n);function t(s,r){let a=e(s,r);return s.getStatus()===404&&(a=hS(n.path)),a.serverResponse=r.serverResponse,a}return t}function rR(n,e,t){const s=e.fullServerUrl(),r=rf(s,n.host,n._protocol),a="GET",o=n.maxOperationRetryTime,c=new Zw(r,a,nR(n,t),o);return c.errorHandler=sR(e),c}function iR(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function aR(n,e,t){const s=Object.assign({},t);return s.fullPath=n.path,s.size=e.size(),s.contentType||(s.contentType=iR(null,e)),s}function oR(n,e,t,s,r){const a=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function c(){let C="";for(let S=0;S<2;S++)C=C+Math.random().toString().slice(2);return C}const u=c();o["Content-Type"]="multipart/related; boundary="+u;const d=aR(e,s,r),h=eR(d,t),m="--"+u+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+u+`\r
Content-Type: `+d.contentType+`\r
\r
`,p=`\r
--`+u+"--",w=Os.getBlob(m,s,p);if(w===null)throw vS();const v={name:d.fullPath},j=rf(a,n.host,n._protocol),k="POST",P=n.maxUploadRetryTime,R=new Zw(j,k,tR(n,t),P);return R.urlParams=v,R.headers=o,R.body=w.uploadData(),R.errorHandler=tb(e),R}class cR{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Er.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Er.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Er.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,s,r,a){if(this.sent_)throw pa("cannot .send() more than once");if(Zn(e)&&s&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),a!==void 0)for(const o in a)a.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,a[o].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw pa("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw pa("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw pa("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw pa("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class lR extends cR{initXhr(){this.xhr_.responseType="text"}}function nb(){return new lR}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fr{constructor(e,t){this._service=e,t instanceof fn?this._location=t:this._location=fn.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Fr(e,t)}get root(){const e=new fn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Jw(this._location.path)}get storage(){return this._service}get parent(){const e=KS(this._location.path);if(e===null)return null;const t=new fn(this._location.bucket,e);return new Fr(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw NS(e)}}function uR(n,e,t){n._throwIfRoot("uploadBytes");const s=oR(n.storage,n._location,Yw(),new Os(e,!0),t);return n.storage.makeRequestWithTokens(s,nb).then(r=>({metadata:r,ref:n}))}function dR(n){n._throwIfRoot("getDownloadURL");const e=rR(n.storage,n._location,Yw());return n.storage.makeRequestWithTokens(e,nb).then(t=>{if(t===null)throw IS();return t})}function hR(n,e){const t=WS(n._location.path,e),s=new fn(n._location.bucket,t);return new Fr(n.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fR(n){return/^[A-Za-z]+:\/\//.test(n)}function mR(n,e){return new Fr(n,e)}function sb(n,e){if(n instanceof af){const t=n;if(t._bucket==null)throw bS();const s=new Fr(t,t._bucket);return e!=null?sb(s,e):s}else return e!==void 0?hR(n,e):n}function pR(n,e){if(e&&fR(e)){if(n instanceof af)return mR(n,e);throw hd("To use ref(service, url), the first argument must be a Storage instance.")}else return sb(n,e)}function cg(n,e){const t=e?.[qw];return t==null?null:fn.makeFromBucketSpec(t,n)}function gR(n,e,t,s={}){n.host=`${e}:${t}`;const r=Zn(e);r&&(rl(`https://${n.host}/b`),Cd("Storage",!0)),n._isUsingEmulator=!0,n._protocol=r?"https":"http";const{mockUserToken:a}=s;a&&(n._overrideAuthToken=typeof a=="string"?a:Kv(a,n.app.options.projectId))}class af{constructor(e,t,s,r,a,o=!1){this.app=e,this._authProvider=t,this._appCheckProvider=s,this._url=r,this._firebaseVersion=a,this._isUsingEmulator=o,this._bucket=null,this._host=$w,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=uS,this._maxUploadRetryTime=dS,this._requests=new Set,r!=null?this._bucket=fn.makeFromBucketSpec(r,this._host):this._bucket=cg(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=fn.makeFromBucketSpec(this._url,e):this._bucket=cg(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){og("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){og("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(un(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Fr(this,e)}_makeRequest(e,t,s,r,a=!0){if(this._deleted)return new ES(zw());{const o=OS(e,this._appId,s,r,t,this._firebaseVersion,a,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[s,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,s,r).getPromise()}}const lg="@firebase/storage",ug="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rb="storage";function xR(n,e,t){return n=Ge(n),uR(n,e,t)}function yR(n){return n=Ge(n),dR(n)}function _R(n,e){return n=Ge(n),pR(n,e)}function wR(n=ro(),e){n=Ge(n);const s=Rn(n,rb).getImmediate({identifier:e}),r=ox("storage");return r&&bR(s,...r),s}function bR(n,e,t,s={}){gR(n,e,t,s)}function vR(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),s=n.getProvider("auth-internal"),r=n.getProvider("app-check-internal");return new af(t,s,r,e,qr)}function IR(){nn(new Kt(rb,vR,"PUBLIC").setMultipleInstances(!0)),St(lg,ug,""),St(lg,ug,"esm2020")}IR();const TR={apiKey:"AIzaSyBYpxHaQ-WDuj-c7pTT4zu7Kf5Kpx7FgUk",authDomain:"dddd-e6a52.firebaseapp.com",projectId:"dddd-e6a52",storageBucket:"dddd-e6a52.firebasestorage.app",messagingSenderId:"852428184810",appId:"1:852428184810:web:c97e9be32fe18600ae4b93",measurementId:"G-RH3Y682M53"},Ji=xx(TR);if(typeof window<"u"){const n="6LeA4B0sAAAAAEf9UN-uyRJlqnH5pozFf0X-Me4C";aS(Ji,{provider:new ef(n),isTokenAutoRefreshEnabled:!0})}const ae=Mj(Ji,{localCache:Jj()});bC().then(n=>{n&&_C(Ji)});const Ne=xN(Ji),NR=wR(Ji),dg=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function ER({onGoogleLogin:n,onShowTerms:e,onShowPrivacy:t}){const s=x.useMemo(()=>Array.from({length:30},(p,w)=>({id:w,symbol:dg[Math.floor(Math.random()*dg.length)],x:Math.random()*100,y:Math.random()*100,size:16+Math.random()*24,duration:5+Math.random()*5,delay:Math.random()*8,opacity:.15+Math.random()*.2})),[]),[r,a]=x.useState(!1),[o,c]=x.useState(!1);x.useEffect(()=>{console.log("[LoginScreen] isLoggingIn :",o)},[o]);const u=x.useCallback(async()=>{if(!r||o)return;c(!0);const p=new rs;try{const w=await ET(Ne,p);console.log("  :",w.user.uid,w.user.email),n(w.user)}catch(w){console.error("  :",w),alert("   .     ."),c(!1)}},[r,o,n]),d=x.useCallback(p=>{a(p)},[]),h=x.useCallback(p=>{p.preventDefault(),e()},[e]),m=x.useCallback(p=>{p.preventDefault(),t()},[t]);return x.useEffect(()=>{const p=document.documentElement,w=p.classList.contains("dark");return p.classList.remove("dark"),()=>{w&&p.classList.add("dark")}},[]),i.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-slate-50 via-gray-100 to-slate-200 flex items-center justify-center relative overflow-hidden force-light-mode",children:[i.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:s.map(p=>{const w=p.opacity<.2?"fadeInOut1":p.opacity<.25?"fadeInOut2":"fadeInOut3";return i.jsx("div",{className:"floating-symbol text-slate-600",ref:v=>{v&&(v.style.setProperty("--symbol-x",`${p.x}%`),v.style.setProperty("--symbol-y",`${p.y}%`),v.style.setProperty("--symbol-size",`${p.size}px`),v.style.setProperty("--symbol-animation",`${w} ${p.duration}s ease-in-out ${p.delay}s infinite both`))},children:p.symbol},p.id)})}),i.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none",children:i.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[i.jsxs("defs",{children:[i.jsxs("pattern",{id:"loginComplexGrid",x:"0",y:"0",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:[i.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"#64748b",strokeWidth:"1"}),i.jsx("circle",{cx:"20",cy:"20",r:"2",fill:"#64748b",opacity:"0.4"})]}),i.jsx("pattern",{id:"loginDiagonalLines",x:"0",y:"0",width:"60",height:"60",patternUnits:"userSpaceOnUse",children:i.jsx("path",{d:"M 0 60 L 60 0",stroke:"#64748b",strokeWidth:"1",opacity:"0.3"})})]}),i.jsx("rect",{width:"100%",height:"100%",fill:"url(#loginComplexGrid)"}),i.jsx("rect",{width:"100%",height:"100%",fill:"url(#loginDiagonalLines)"})]})}),i.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[i.jsx("div",{className:"absolute top-20 left-10 w-3 h-3 bg-slate-700 opacity-20 animate-pulse transform rotate-45"}),i.jsx("div",{className:"absolute top-40 right-20 w-2 h-2 bg-slate-800 opacity-25 animate-bounce"}),i.jsx("div",{className:"absolute bottom-32 left-20 w-4 h-4 bg-slate-900 opacity-15 rotate-45 animate-spin custom-spin-8s"}),i.jsx("div",{className:"absolute bottom-20 right-10 w-2 h-2 bg-slate-800 opacity-20 animate-pulse delay-1000"}),i.jsx("div",{className:"absolute top-60 left-6 w-1 h-8 bg-slate-600 opacity-20 animate-pulse delay-500"}),i.jsx("div",{className:"absolute bottom-60 right-6 w-8 h-1 bg-slate-600 opacity-20 animate-pulse delay-700"}),i.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:i.jsxs("div",{className:"w-32 h-32 relative",children:[i.jsx("div",{className:"absolute top-0 left-1/2 w-1 h-1 bg-slate-700 opacity-30 animate-spin geometric-orbit-1"}),i.jsx("div",{className:"absolute top-0 left-1/2 w-1 h-1 bg-slate-600 opacity-25 animate-spin geometric-orbit-2"})]})})]}),i.jsxs($,{className:"w-full bg-white/95 backdrop-blur-xl border border-slate-300 shadow-2xl shadow-slate-500/20 relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/50 via-transparent to-slate-100/30 pointer-events-none"}),i.jsx(q,{className:"p-8 relative",children:i.jsxs("div",{className:"text-center space-y-8",children:[i.jsxs("div",{className:"space-y-6",children:[i.jsx("div",{className:"w-32 h-32 mx-auto relative",children:i.jsx("img",{src:Uv,alt:" ",className:"w-full h-full rounded-3xl shadow-2xl shadow-slate-500/30 ring-4 ring-white/50"})}),i.jsx("div",{className:"space-y-4",children:i.jsxs("h1",{className:"text-3xl font-mono text-slate-900 tracking-wider relative",children:["",i.jsx("div",{className:"absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-16 h-0.5 bg-gradient-to-r from-transparent via-slate-400 to-transparent"})]})})]}),i.jsxs("div",{className:"border border-slate-300 rounded-xl p-4 bg-gradient-to-br from-slate-50 to-white relative overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-slate-300 to-transparent"}),i.jsxs("div",{className:"flex items-center justify-center gap-2.5",children:[i.jsx(yi,{id:"terms-agreement",checked:r,onCheckedChange:d,className:"flex-shrink-0"}),i.jsxs(Mt,{htmlFor:"terms-agreement",className:"text-sm text-slate-700 leading-relaxed cursor-pointer",children:[i.jsx("button",{type:"button",onClick:h,className:"text-slate-900 hover:text-black transition-colors underline decoration-dotted underline-offset-2 font-medium",children:""})," ",""," ",i.jsx("button",{type:"button",onClick:m,className:"text-slate-900 hover:text-black transition-colors underline decoration-dotted underline-offset-2 font-medium",children:" "})]})]})]}),i.jsx("div",{className:"space-y-6",children:i.jsxs(z,{onClick:u,disabled:!r||o,className:"w-full h-16 bg-gradient-to-r from-slate-800 via-slate-900 to-black hover:from-slate-700 hover:via-slate-800 hover:to-slate-900 border border-slate-400 text-white transition-all duration-500 hover:shadow-lg hover:shadow-slate-500/30 relative overflow-hidden group disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-none",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/0 via-white/5 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"}),i.jsxs("div",{className:"flex items-center justify-center space-x-3 relative",children:[i.jsx("span",{className:"font-mono tracking-wide",children:o?" ...":""}),i.jsx("svg",{className:"w-4 h-4 opacity-70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})]})})]})})]})]})}const Br=x.forwardRef(({className:n,type:e,...t},s)=>i.jsx("input",{type:e,ref:s,"data-slot":"input",className:qe("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",n),...t}));Br.displayName="Input";const rn=x.forwardRef(({className:n,...e},t)=>i.jsx(zg,{ref:t,"data-slot":"avatar",className:qe("relative flex size-10 shrink-0 overflow-hidden rounded-full",n),...e}));rn.displayName=zg.displayName;const vn=x.forwardRef(({className:n,...e},t)=>i.jsx(Gg,{ref:t,"data-slot":"avatar-image",className:qe("aspect-square size-full",n),...e}));vn.displayName=Gg.displayName;const an=x.forwardRef(({className:n,...e},t)=>i.jsx(Hg,{ref:t,"data-slot":"avatar-fallback",className:qe("bg-muted flex size-full items-center justify-center rounded-full",n),...e}));an.displayName=Hg.displayName;const AR=["","","","","","",""," ","","","","","","","","","","","1","","","1",""];function hg(n){return(n||"").toLowerCase().replace(/[0-9\s~!@#$%^&*()\-_=+\[\]{};:'",.<>/?\\|`]/g,"")}function Bs(n){const e=hg(n);return e?AR.some(t=>{const s=hg(t);return s?e.includes(s):!1}):!1}const fg=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function jR({item:n}){const e=n.opacity<.2?"fadeInOut1":n.opacity<.25?"fadeInOut2":"fadeInOut3",t=x.useCallback(s=>{s&&(s.style.setProperty("--symbol-x",`${n.x}%`),s.style.setProperty("--symbol-y",`${n.y}%`),s.style.setProperty("--symbol-size",`${n.size}px`),s.style.setProperty("--symbol-animation",`${e} ${n.duration}s ease-in-out ${n.delay}s infinite both`))},[n.x,n.y,n.size,e,n.duration,n.delay]);return i.jsx("div",{className:"floating-symbol text-slate-600",ref:t,children:n.symbol},n.id)}function kR({onBack:n,onComplete:e,userEmail:t}){const[s,r]=x.useState(""),[a,o]=x.useState(""),[c,u]=x.useState(!1),d=x.useMemo(()=>Array.from({length:30},(w,v)=>({id:v,symbol:fg[Math.floor(Math.random()*fg.length)],x:Math.random()*100,y:Math.random()*100,size:16+Math.random()*24,duration:5+Math.random()*5,delay:Math.random()*8,opacity:.15+Math.random()*.2})),[]),h=x.useCallback(w=>{r(w.target.value),o("")},[]),m=x.useCallback(async()=>{if(c)return;const w=s.trim();if(w.length<2||w.length>12){o(" 2~12 .");return}if(!/^[-a-zA-Z0-9]+$/.test(w)){o(", ,    .");return}if(Bs(w)){o("   .");return}u(!0);try{const v=xs(sn(ae,"users"),Kr("nickname","==",w),rw(1));if(!(await Sn(v)).empty){o("   ."),u(!1);return}if(u(!1),!window.confirm(`       .
  ?`)){console.log("[NicknameScreen]   ");return}console.log("[NicknameScreen]   :",w),e(w)}catch(v){console.error("   :",v),o("    .    ."),u(!1)}},[s,c,e]),p=x.useCallback(()=>{const w=["","","","","","",""],v=w[Math.floor(Math.random()*w.length)]+(Math.floor(Math.random()*9e3)+1e3);r(v),o("")},[]);return i.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-slate-50 via-gray-100 to-slate-200 flex items-center justify-center relative overflow-hidden force-light-mode",children:[i.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:d.map(w=>i.jsx(jR,{item:w},w.id))}),i.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none",children:i.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[i.jsxs("defs",{children:[i.jsxs("pattern",{id:"nicknameComplexGrid",x:"0",y:"0",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:[i.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"#64748b",strokeWidth:"1"}),i.jsx("circle",{cx:"20",cy:"20",r:"2",fill:"#64748b",opacity:"0.4"})]}),i.jsx("pattern",{id:"nicknameDiagonalLines",x:"0",y:"0",width:"60",height:"60",patternUnits:"userSpaceOnUse",children:i.jsx("path",{d:"M 0 60 L 60 0",stroke:"#64748b",strokeWidth:"1",opacity:"0.3"})})]}),i.jsx("rect",{width:"100%",height:"100%",fill:"url(#nicknameComplexGrid)"}),i.jsx("rect",{width:"100%",height:"100%",fill:"url(#nicknameDiagonalLines)"})]})}),i.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[i.jsx("div",{className:"absolute top-20 left-10 w-3 h-3 bg-slate-700 opacity-20 animate-pulse transform rotate-45"}),i.jsx("div",{className:"absolute top-40 right-20 w-2 h-2 bg-slate-800 opacity-25 animate-bounce"}),i.jsx("div",{className:"absolute bottom-32 left-20 w-4 h-4 bg-slate-900 opacity-15 rotate-45 animate-spin custom-spin-8s"}),i.jsx("div",{className:"absolute bottom-20 right-10 w-2 h-2 bg-slate-800 opacity-20 animate-pulse delay-1000"}),i.jsx("div",{className:"absolute top-60 left-6 w-1 h-8 bg-slate-600 opacity-20 animate-pulse delay-500"}),i.jsx("div",{className:"absolute bottom-60 right-6 w-8 h-1 bg-slate-600 opacity-20 animate-pulse delay-700"}),i.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:i.jsxs("div",{className:"w-32 h-32 relative",children:[i.jsx("div",{className:"absolute top-0 left-1/2 w-1 h-1 bg-slate-700 opacity-30 animate-spin geometric-orbit-1"}),i.jsx("div",{className:"absolute top-0 left-1/2 w-1 h-1 bg-slate-600 opacity-25 animate-spin geometric-orbit-2"})]})})]}),i.jsx(z,{variant:"ghost",size:"icon",onClick:n,className:"absolute top-4 left-4 z-10 hover:bg-slate-200/50",children:i.jsx(Et,{className:"w-5 h-5 text-slate-700"})}),i.jsxs($,{className:"w-full max-w-md bg-white/95 backdrop-blur-xl border border-slate-300 shadow-2xl relative",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/50 via-transparent to-slate-100/30 pointer-events-none"}),i.jsx(ge,{className:"text-center pb-4 relative",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs(rn,{className:"w-24 h-24 mx-auto ring-2 ring-slate-200",children:[i.jsx(vn,{src:""}),i.jsx(an,{className:"text-2xl bg-gradient-to-br from-slate-800 via-slate-900 to-black text-white",children:s?s.charAt(0).toUpperCase():"?"})]}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-mono text-slate-900 tracking-wider",children:" "}),i.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"   "}),t&&i.jsx("p",{className:"text-xs text-slate-500 mt-2 font-mono",children:t})]})]})}),i.jsxs(q,{className:"space-y-6 relative",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(Mt,{htmlFor:"nickname",children:""}),i.jsxs("div",{className:"relative",children:[i.jsx(Br,{id:"nickname",value:s,onChange:h,placeholder:" ",className:`pr-10 ${a?"border-red-500 focus-visible:ring-red-500":""}`,maxLength:12,onKeyDown:w=>{w.key==="Enter"&&m()}}),!a&&s.length>=2&&i.jsx(to,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-green-600"})]}),i.jsx("div",{className:"h-4 text-xs",children:a?i.jsxs("span",{className:"text-red-500 flex items-center gap-1",children:[i.jsx(Tu,{className:"w-3 h-3"})," ",a]}):i.jsx("span",{className:"text-slate-400",children:c?"  ...":"2~12 , , "})})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs(z,{onClick:m,disabled:s.length<2||c,className:"w-full h-12 bg-gradient-to-r from-slate-800 via-slate-900 to-black hover:from-slate-700 hover:via-slate-800 hover:to-slate-900 text-white transition-all relative overflow-hidden group",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/0 via-white/5 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"}),i.jsx("span",{className:"relative",children:c?" ...":""})]}),i.jsx(z,{variant:"ghost",className:"w-full hover:bg-slate-100 text-slate-700 font-mono",onClick:p,children:"  "})]})]})]})]})}const Ss={stroke:"currentColor",fill:"none",display:"block"};function fd({onBack:n,onContinue:e,isAlreadyAgreed:t=!1,hideBackButton:s=!1,disableBack:r=!1}){const[a,o]=x.useState(t),[c,u]=x.useState(t),[d,h]=x.useState(t),m=x.useMemo(()=>a&&c&&d,[a,c,d]),p=x.useCallback(()=>{e&&m?e():n()},[e,m,n]),w=x.useCallback(k=>{t||o(k===!0)},[t]),v=x.useCallback(k=>{t||u(k===!0)},[t]),j=x.useCallback(k=>{t||h(k===!0)},[t]);return i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[!s&&i.jsx(z,{variant:"ghost",size:"icon",onClick:n,className:"touch-target transition-transform active:scale-95",children:i.jsx(Et,{className:"w-5 h-5",style:Ss})}),i.jsxs("h1",{className:"flex items-center gap-2",children:[i.jsx(Ti,{className:"w-5 h-5",style:Ss}),"  "]})]})})}),i.jsx("div",{className:"flex-1 scroll-container no-scrollbar",children:i.jsxs("div",{className:"p-4 space-y-6 pb-24",children:[i.jsxs($,{className:"border-primary/30 bg-primary/5",children:[i.jsx(ge,{children:i.jsxs(ye,{className:"flex items-center gap-2",children:[i.jsx(Tu,{className:"w-5 h-5",style:Ss})," "]})}),i.jsxs(q,{className:"space-y-3 leading-relaxed",children:[i.jsx("p",{className:"text-lg font-medium",children:"  "}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"    ,       .         ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsxs(ye,{className:"flex items-center gap-2",children:[i.jsx(ev,{className:"w-5 h-5 text-green-600 dark:text-green-400",style:Ss}),"1.  "]})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{className:"font-medium",children:"      ."}),i.jsxs("ul",{className:"space-y-2 list-disc pl-5 text-muted-foreground",children:[i.jsx("li",{children:"  .   ."}),i.jsx("li",{children:"     ."}),i.jsx("li",{children:"   ,   ."}),i.jsx("li",{children:"     ."})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsxs(ye,{className:"flex items-center gap-2",children:[i.jsx(Tu,{className:"w-5 h-5 text-blue-600 dark:text-blue-400",style:Ss}),"2.   "]})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{className:"font-medium",children:"    ,    ."}),i.jsxs("ul",{className:"space-y-2 list-disc pl-5 text-muted-foreground",children:[i.jsx("li",{children:"      ."}),i.jsx("li",{children:"    ."}),i.jsx("li",{children:"    ."}),i.jsx("li",{children:"     ."})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsxs(ye,{className:"flex items-center gap-2",children:[i.jsx(Ti,{className:"w-5 h-5 text-purple-600 dark:text-purple-400",style:Ss}),"3.  "]})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{className:"font-medium",children:"    ."}),i.jsxs("ul",{className:"space-y-2 list-disc pl-5 text-muted-foreground",children:[i.jsx("li",{children:"    ."}),i.jsx("li",{children:"   ."}),i.jsx("li",{children:"      ."}),i.jsx("li",{children:"     ."})]})]})]}),i.jsxs($,{className:"border-destructive/30 bg-destructive/5",children:[i.jsx(ge,{children:i.jsxs(ye,{className:"flex items-center gap-2 text-destructive",children:[i.jsx(tv,{className:"w-5 h-5",style:Ss}),"4.  "]})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{className:"font-medium text-destructive",children:"   ."}),i.jsxs("ul",{className:"space-y-2 list-disc pl-5 text-muted-foreground",children:[i.jsx("li",{children:", ,  "}),i.jsx("li",{children:"  "}),i.jsx("li",{children:",  "}),i.jsx("li",{children:"  "}),i.jsx("li",{children:"  (  )"}),i.jsx("li",{children:"  "})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsxs(ye,{className:"flex items-center gap-2",children:[i.jsx(tl,{className:"w-5 h-5 text-orange-600 dark:text-orange-400",style:Ss}),"5.   "]})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{className:"font-medium",children:"      ."}),i.jsxs("ul",{className:"space-y-2 list-disc pl-5 text-muted-foreground",children:[i.jsx("li",{children:"  ."}),i.jsx("li",{children:"      ."}),i.jsx("li",{children:"      ."}),i.jsx("li",{children:"  ,  ."})]})]})]}),i.jsx($,{className:"border-primary/30 bg-primary/5",children:i.jsxs(q,{className:"pt-6 space-y-2 text-center",children:[i.jsx("p",{className:"text-base font-medium",children:"   "}),i.jsxs("p",{className:"text-sm text-muted-foreground leading-relaxed",children:["    .",i.jsx("br",{}),"  ,  !"]})]})})]})}),e&&i.jsxs("div",{className:"bg-background/95 backdrop-blur-xl border-t border-border p-4 space-y-4 safe-nav-bottom flex-shrink-0 mb-4",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg border border-border hover:border-primary/30 active:border-primary/40 active:bg-primary/5 transition-colors transition-transform active:scale-[0.99]",children:[i.jsx(yi,{id:"agreement1",checked:a,onCheckedChange:w,disabled:t,className:"mt-0.5"}),i.jsxs(Mt,{htmlFor:"agreement1",className:"flex-1 cursor-pointer leading-relaxed",children:[i.jsx("span",{className:"font-medium",children:"   "}),i.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"   ,    ."})]})]}),i.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg border border-border hover:border-primary/30 active:border-primary/40 active:bg-primary/5 transition-colors transition-transform active:scale-[0.99]",children:[i.jsx(yi,{id:"agreement2",checked:c,onCheckedChange:v,disabled:t,className:"mt-0.5"}),i.jsxs(Mt,{htmlFor:"agreement2",className:"flex-1 cursor-pointer leading-relaxed",children:[i.jsx("span",{className:"font-medium",children:"   "}),i.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"     ."})]})]}),i.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg border border-border hover:border-primary/30 active:border-primary/40 active:bg-primary/5 transition-colors transition-transform active:scale-[0.99]",children:[i.jsx(yi,{id:"agreement3",checked:d,onCheckedChange:j,disabled:t,className:"mt-0.5"}),i.jsxs(Mt,{htmlFor:"agreement3",className:"flex-1 cursor-pointer leading-relaxed",children:[i.jsx("span",{className:"font-medium",children:"  "}),i.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"     ."})]})]})]}),!m&&!t&&i.jsx("div",{className:"text-center text-sm text-destructive",children:"  "}),i.jsx(z,{onClick:p,disabled:!m&&!t,className:"w-full transition-transform active:scale-95 disabled:active:scale-100",size:"lg",children:" "})]}),!e&&i.jsx("div",{className:"bg-background/95 backdrop-blur-xl border-t border-border p-6 pb-8 safe-nav-bottom flex-shrink-0 mb-4",children:i.jsx(z,{onClick:n,className:"w-full transition-transform active:scale-95",size:"lg",children:""})})]})}function Xn(n){const{className:e,...t}=n;return i.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[i.jsx("path",{d:"M8 6h8l1 2v8c0 1.1-0.9 2-2 2H9c-1.1 0-2-0.9-2-2V8l1-2z"}),i.jsx("path",{d:"M7 6c0-1.1 0.9-2 2-2h6c1.1 0 2 0.9 2 2v0.5H7V6z"}),i.jsx("rect",{x:"10",y:"2",width:"4",height:"2",rx:"0.5"}),i.jsx("circle",{cx:"12",cy:"12",r:"2.5"}),i.jsx("rect",{x:"11.5",y:"9.5",width:"1",height:"5",rx:"0.5"}),i.jsx("rect",{x:"9.5",y:"11.5",width:"5",height:"1",rx:"0.5"}),i.jsx("rect",{x:"11.5",y:"18",width:"1",height:"2",rx:"0.5"})]})}function Tt(n){return i.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",...n,children:[i.jsx("path",{d:"M8 6h8l1 2v8c0 1-1 2-2 2H9c-1 0-2-1-2-2V8l1-2z",fillOpacity:.8}),i.jsx("path",{d:"M7 6c0-1 1-2 2-2h6c1 0 2 1 2 2z"}),i.jsx("rect",{x:"10",y:"2",width:"4",height:"2"}),i.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor",fillOpacity:.3}),i.jsx("rect",{x:"11.5",y:"18",width:"1",height:"2"})]})}const mg=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function CR({item:n}){const e=n.opacity<.2?"fadeInOut1":n.opacity<.25?"fadeInOut2":"fadeInOut3",t=x.useCallback(s=>{s&&(s.style.setProperty("--symbol-x",`${n.x}%`),s.style.setProperty("--symbol-y",`${n.y}%`),s.style.setProperty("--symbol-size",`${n.size}px`),s.style.setProperty("--symbol-animation",`${e} ${n.duration}s ease-in-out ${n.delay}s infinite both`))},[n.x,n.y,n.size,e,n.duration,n.delay]);return i.jsx("div",{className:"floating-symbol text-slate-600",ref:t,children:n.symbol})}function SR({nickname:n,onRestart:e,onStartApp:t}){const s=x.useMemo(()=>Array.from({length:30},(r,a)=>({id:a,symbol:mg[Math.floor(Math.random()*mg.length)],x:Math.random()*100,y:Math.random()*100,size:16+Math.random()*24,duration:5+Math.random()*5,delay:Math.random()*8,opacity:.15+Math.random()*.2})),[]);return i.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-slate-50 via-gray-100 to-slate-200 flex items-center justify-center relative overflow-hidden force-light-mode",children:[i.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:s.map(r=>i.jsx(CR,{item:r},r.id))}),i.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none",children:i.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[i.jsxs("defs",{children:[i.jsxs("pattern",{id:"welcomeComplexGrid",x:"0",y:"0",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:[i.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"#64748b",strokeWidth:"1"}),i.jsx("circle",{cx:"20",cy:"20",r:"2",fill:"#64748b",opacity:"0.4"})]}),i.jsx("pattern",{id:"welcomeDiagonalLines",x:"0",y:"0",width:"60",height:"60",patternUnits:"userSpaceOnUse",children:i.jsx("path",{d:"M 0 60 L 60 0",stroke:"#64748b",strokeWidth:"1",opacity:"0.3"})})]}),i.jsx("rect",{width:"100%",height:"100%",fill:"url(#welcomeComplexGrid)"}),i.jsx("rect",{width:"100%",height:"100%",fill:"url(#welcomeDiagonalLines)"})]})}),i.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[i.jsx("div",{className:"absolute top-20 left-10 w-3 h-3 bg-slate-700 opacity-20 animate-pulse transform rotate-45"}),i.jsx("div",{className:"absolute top-40 right-20 w-2 h-2 bg-slate-800 opacity-25 animate-bounce"}),i.jsx("div",{className:"absolute bottom-32 left-20 w-4 h-4 bg-slate-900 opacity-15 rotate-45 animate-spin custom-spin-8s"}),i.jsx("div",{className:"absolute bottom-20 right-10 w-2 h-2 bg-slate-800 opacity-20 animate-pulse delay-1000"}),i.jsx("div",{className:"absolute top-60 left-6 w-1 h-8 bg-slate-600 opacity-20 animate-pulse delay-500"}),i.jsx("div",{className:"absolute bottom-60 right-6 w-8 h-1 bg-slate-600 opacity-20 animate-pulse delay-700"}),i.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:i.jsxs("div",{className:"w-32 h-32 relative",children:[i.jsx("div",{className:"absolute top-0 left-1/2 w-1 h-1 bg-slate-700 opacity-30 animate-spin geometric-orbit-1"}),i.jsx("div",{className:"absolute top-0 left-1/2 w-1 h-1 bg-slate-600 opacity-25 animate-spin geometric-orbit-2"})]})})]}),i.jsxs($,{className:"w-full bg-white/95 backdrop-blur-xl border border-slate-300 shadow-2xl shadow-slate-500/20 relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/50 via-transparent to-slate-100/30 pointer-events-none"}),i.jsx(q,{className:"p-8 relative",children:i.jsxs("div",{className:"text-center space-y-6",children:[i.jsxs("div",{className:"relative mx-auto w-20 h-20",children:[i.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-amber-400 via-yellow-500 to-amber-600 rounded-full flex items-center justify-center shadow-lg shadow-amber-400/30",children:i.jsx(Xn,{className:"w-10 h-10 text-white"})}),i.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center border-2 border-white shadow-md",children:i.jsx(to,{className:"w-5 h-5 text-white"})})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("h1",{className:"text-2xl font-bold text-slate-900 font-mono",children:["  ",i.jsx("br",{}),"!"]}),i.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed px-2",children:["     .",i.jsx("br",{}),i.jsx("span",{className:"font-semibold text-slate-800",children:'""'})," ,       ."]})]}),i.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-white border border-slate-200 rounded-xl p-4 space-y-2.5",children:[i.jsxs("p",{className:"text-xs text-slate-700 leading-relaxed",children:["  ,",i.jsx("br",{}),"      ."]}),i.jsxs("p",{className:"text-xs text-gray-600 font-semibold leading-relaxed",children:[i.jsx("span",{className:"inline-block",children:""}),"       ."]}),i.jsx("p",{className:"text-xs text-amber-700 font-semibold italic leading-relaxed",children:" ,     ."})]}),i.jsxs("div",{className:"bg-slate-100 border border-slate-200 rounded-2xl p-4 space-y-3",children:[i.jsx(rn,{className:"w-16 h-16 mx-auto ring-2 ring-slate-200",children:i.jsx(an,{className:"text-xl bg-gradient-to-br from-slate-700 to-black text-white font-mono",children:n.charAt(0).toUpperCase()})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-slate-900 font-mono",children:n}),i.jsx("p",{className:"text-sm text-slate-600",children:"  "})]})]}),i.jsxs("div",{className:"space-y-4.5",children:[i.jsxs(z,{className:"w-full h-12 bg-gradient-to-r from-slate-800 via-slate-900 to-black hover:from-slate-700 hover:via-slate-800 hover:to-slate-900 border border-slate-400 text-white transition-all duration-500 hover:shadow-lg hover:shadow-slate-500/30 font-mono relative overflow-hidden group",onClick:t,children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/0 via-white/5 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"}),i.jsx("span",{className:"relative",children:" "})]}),i.jsxs(z,{variant:"outline",className:"w-full h-10 border-slate-400 hover:bg-slate-100 font-mono",onClick:e,children:[i.jsx(Kg,{className:"w-4 h-4 mr-2"}),""]})]}),i.jsx("div",{className:"bg-slate-100 border border-slate-300 rounded-xl p-3",children:i.jsx("p",{className:"text-xs text-slate-700 leading-relaxed",children:"      ."})})]})})]})]})}x.createContext(null);function md(){try{const n=localStorage.getItem("toastEnabled");return n===null?!0:n==="true"}catch(n){return console.error("Failed to get toast setting:",n),!0}}function RR(n){try{localStorage.setItem("toastEnabled",n.toString())}catch(e){console.error("Failed to save toast setting:",e)}}const J={success:(n,e)=>{if(md())return ss.success(n,e)},error:(n,e)=>ss.error(n,e),info:(n,e)=>{if(md())return ss.info(n,e)},warning:(n,e)=>ss.warning(n,e),promise:ss.promise,loading:ss.loading,custom:ss.custom,message:ss.message,dismiss:ss.dismiss},pg=(n,e)=>sn(ae,"user_lanterns",n,e),gg=(n,e)=>be(ae,"user_lanterns",n,"posts",e),xg=(n,e)=>be(ae,"user_lanterns",n,"replies",String(e));function PR({posts:n,setPosts:e,selectedPost:t,setSelectedPost:s,userNickname:r,userActivity:a,updateActivity:o,userPostLanterns:c,setUserPostLanterns:u,userReplyLanterns:d,setUserReplyLanterns:h,addLumensWithTrust:m,updateTrust:p}){const[w,v]=x.useState(new Set),[j,k]=x.useState(new Set);x.useEffect(()=>{const D=Ne.currentUser?.uid??null;if(!D)return;(async()=>{try{const y=(await Sn(pg(D,"posts"))).docs.map(T=>T.id);v(new Set(y));const I=(await Sn(pg(D,"replies"))).docs.map(T=>Number(T.id)).filter(T=>!Number.isNaN(T));k(new Set(I))}catch(_){console.error("   :",_)}})()},[]);const P=x.useCallback(async D=>{const M=String(D),_=new Set;w.forEach(A=>_.add(String(A)));const y=_.has(M),b=new Set(_),I=n.map(A=>{if(String(A.id)===M){const F=typeof A.lanterns=="number"?A.lanterns:0;return y?(b.delete(M),{...A,lanterns:Math.max(0,F-1)}):(b.add(M),{...A,lanterns:F+1})}return A});v(b),e(I);const T=Ne.currentUser?.uid??null;if(T)try{y?await Wc(gg(T,M)):await kn(gg(T,M),{postId:M,createdAt:Yt()},{merge:!0})}catch(A){console.error("    :",A)}if(t&&String(t.id)===M){const A=I.find(N=>String(N.id)===M);A&&s(A)}try{await ct(be(ae,"posts",M),{lanterns:zt(y?-1:1)})}catch(A){console.error("Firestore    :",A)}if(!y){const A=n.find(N=>String(N.id)===M);A&&A.author===r?(u(N=>{const F=N+1;return localStorage.setItem("userPostLanterns",F.toString()),F}),o({lanternsReceived:a.lanternsReceived+1})):A&&o({lanternsGiven:a.lanternsGiven+1});try{const N=Ne.currentUser?.uid??null,F=A&&typeof A.authorUid=="string"?A.authorUid:null;F&&await ct(be(ae,"users",F),{lanternsReceived:zt(1),postLanternsReceived:zt(1)}),N&&await ct(be(ae,"users",N),{lanternsGiven:zt(1)})}catch(N){console.error("Firestore     :",N)}J.success(" ! ")}},[w,n,t,a,r,o,e,s,u]),R=x.useCallback(async(D,M)=>{const _=String(M),y=j.has(D),b=new Set(j),I=n.map(A=>{if(String(A.id)===_){const N=A.replies.map(F=>F.id===D?y?(b.delete(D),{...F,lanterns:Math.max(0,F.lanterns-1)}):(b.add(D),{...F,lanterns:F.lanterns+1}):F);return{...A,replies:N}}return A});k(b),e(I);try{const A=I.find(N=>String(N.id)===_);A&&await ct(be(ae,"posts",_),{replies:A.replies})}catch(A){console.error("Firestore  replies   :",A)}const T=Ne.currentUser?.uid??null;if(T)try{y?await Wc(xg(T,D)):await kn(xg(T,D),{replyId:D,postId:M,createdAt:Yt()},{merge:!0})}catch(A){console.error("     :",A)}if(t&&String(t.id)===_){const A=I.find(N=>String(N.id)===_);A&&s(A)}if(!y){const A=String(M),F=n.find(Z=>Z.id===A)?.replies.find(Z=>Z.id===D);F&&F.author===r&&(h(Z=>{const Ee=Z+1;localStorage.setItem("userReplyLanterns",Ee.toString());const xe=Math.floor(Z/100),ee=Math.floor(Ee/100)-xe;return ee>0&&m(ee,"  "),Ee}),p(.1)),F&&F.author===r?o({lanternsReceived:a.lanternsReceived+1}):o({lanternsGiven:a.lanternsGiven+1});try{const Z=Ne.currentUser?.uid??null,Ee=F?.authorUid;Ee&&typeof Ee=="string"&&await ct(be(ae,"users",Ee),{lanternsReceived:zt(1),replyLanternsReceived:zt(1)}),Z&&await ct(be(ae,"users",Z),{lanternsGiven:zt(1)})}catch(Z){console.error("Firestore     :",Z)}J.success(" ! ")}},[j,n,t,a,r,o,e,s,h,m,p]),C=x.useCallback(D=>w.has(String(D)),[w]),S=x.useCallback(D=>j.has(D),[j]);return{lanternedPosts:w,lanternedReplies:j,handleLanternToggle:P,handleReplyLanternToggle:R,isPostLanterned:C,isReplyLanterned:S}}const yg=n=>sn(ae,"user_bookmarks",n,"posts"),_g=(n,e)=>be(ae,"user_bookmarks",n,"posts",String(e));function DR({userNickname:n}){const[e,t]=x.useState(new Set);x.useEffect(()=>{const a=Ne.currentUser?.uid??null;if(!a)return;(async()=>{try{const u=(await Sn(yg(a))).docs.map(d=>d.id);t(new Set(u))}catch(c){console.error("  :",c)}})()},[]),x.useEffect(()=>{const a=Ne.currentUser?.uid??null;if(!a){t(new Set);return}(async()=>{try{const c=await Sn(yg(a)),u=new Set;c.forEach(d=>{const h=d.data(),m=(h&&h.postId)??d.id;u.add(String(m))}),t(u)}catch(c){console.error("Firestore   :",c)}})()},[n]);const s=x.useCallback(async a=>{const o=String(a),c=e.has(o),u=Ne.currentUser?.uid??null;if(t(d=>{const h=new Set(d);return c?h.delete(o):h.add(o),h}),u)try{c?(await Wc(_g(u,o)),J.success(" ")):(await kn(_g(u,o),{postId:o,createdAt:Yt()},{merge:!0}),J.success(" "))}catch(d){console.error("  :",d),t(h=>{const m=new Set(h);return c?m.add(o):m.delete(o),m}),J.error("  ")}else J.error(" "),t(d=>{const h=new Set(d);return c?h.add(o):h.delete(o),h})},[e]),r=x.useCallback(a=>e.has(String(a)),[e]);return{bookmarkedPosts:e,handleBookmarkToggle:s,isBookmarked:r}}const We={setItem:(n,e)=>{try{localStorage.setItem(n,e)}catch(t){console.warn(`Failed to save ${n} to localStorage:`,t)}},getItem:n=>{try{return localStorage.getItem(n)}catch(e){return console.warn(`Failed to get ${n} from localStorage:`,e),null}},setJSON:(n,e)=>{try{localStorage.setItem(n,JSON.stringify(e))}catch(t){console.warn(`Failed to save ${n} to localStorage:`,t)}},getJSON:(n,e)=>{try{const t=localStorage.getItem(n);return t===null?e:JSON.parse(t)}catch(t){return console.warn(`Failed to parse ${n} from localStorage:`,t),e}},getNumber:(n,e)=>{try{const t=localStorage.getItem(n);if(t===null)return e;const s=parseInt(t);return isNaN(s)?e:s}catch(t){return console.warn(`Failed to get number ${n} from localStorage:`,t),e}}},_u=3;function VR({posts:n,setPosts:e,selectedPost:t,setSelectedPost:s,userNickname:r,userGuideCount:a,setUserGuideCount:o,addLumensWithTrust:c,updateActivity:u,updateTrust:d}){const[h,m]=x.useState(new Set),[p,w]=x.useState(new Map);x.useEffect(()=>{const C=We.getJSON("guideReplies",[]);Array.isArray(C)&&m(new Set(C));const S=We.getJSON("postGuides",{});if(typeof S=="object"&&S!==null){const D=Object.entries(S).filter(([,M])=>typeof M=="number");w(new Map(D))}},[]);const v=x.useCallback(async(C,S,D)=>{const M=String(D),_=n.find(F=>String(F.id)===M);if(!_){J.error("    .");return}const y=p.get(M),b=_.guideReplyId;if(y!==void 0||typeof b=="number"){J.error("   .");return}if(S===r){J.error("    .");return}if(_.author!==r){J.error("     .");return}const I=new Set(h);I.add(C),m(I);const T=new Map(p);T.set(M,C),w(T),We.setJSON("guideReplies",Array.from(I)),We.setJSON("postGuides",Object.fromEntries(T));const A=n.map(F=>{if(String(F.id)===M){const Z=(F.replies||[]).map(Ee=>({...Ee,isGuide:Ee.id===C}));return{...F,replies:Z}}return F});if(e(A),t&&String(t.id)===M){const F=A.find(Z=>String(Z.id)===M);F&&s(F)}A.find(F=>String(F.id)===M)?.replies||_.replies;try{const F=(_.replies||[]).map(K=>({...K,isGuide:K.id===C})),Ee=F.find(K=>K.id===C)?.authorUid;Ee&&typeof Ee=="string"&&await ct(be(ae,"users",Ee),{guideCount:zt(1),lumenBalance:zt(_u),lumenTotalEarned:zt(_u)});const xe=typeof _.id=="string"?_.id:String(_.id);await ct(be(ae,"posts",xe),{guideReplyId:C,guideReplyAuthor:S,replies:F})}catch(F){console.error("  Firestore  :",F)}J.success(`${S}  ! `)},[n,t,r,h,p,e,s]),j=x.useCallback(()=>{o(C=>{const S=C+1;return We.setItem("userGuideCount",String(S)),S}),c(_u,"  "),d(1),u({guideCount:a+1})},[a,o,c,d,u]),k=x.useCallback(C=>h.has(C),[h]),P=x.useCallback(C=>p.has(String(C)),[p]),R=x.useCallback(C=>p.get(String(C)),[p]);return{guideReplies:h,postGuides:p,handleGuideSelect:v,handleGuideReceived:j,isGuideReply:k,hasGuide:P,getGuideReplyId:R}}async function LR(n){if(!n)return null;const e=sn(ae,"users"),t=xs(e,Kr("nickname","==",n)),s=await Sn(t);if(s.empty)return null;const r=s.docs[0],a=r.data();return{uid:r.id,nickname:a?.nickname??n,photoURL:a?.photoURL??""}}async function ib(n){if(!n)return{followerCount:0,followingCount:0,followingNicknames:[]};const e=be(ae,"users",n),t=await Cn(e),s=(t.exists()?t.data():{})??{},r=typeof s.followerCount=="number"?s.followerCount:0,a=typeof s.followingCount=="number"?s.followingCount:0,o=sn(ae,"follows"),c=xs(o,Kr("followerUid","==",n)),u=await Sn(c),d=new Set;return u.forEach(h=>{const p=h.data()?.followingNickname;p&&d.add(p)}),{followerCount:r,followingCount:a,followingNicknames:Array.from(d)}}async function OR(n){const{currentUid:e,currentNickname:t,targetNickname:s}=n;if(!e)throw new Error("CURRENT_USER_REQUIRED");if(!s)throw new Error("TARGET_NICKNAME_REQUIRED");if(t===s)return{isFollowing:!1,followerCount:0,followingCount:0};const r=await LR(s);if(!r)throw new Error("TARGET_USER_NOT_FOUND");const a=be(ae,"users",e),o=be(ae,"users",r.uid),c=`${e}_${r.uid}`,u=be(ae,"follows",c);return await cw(ae,async h=>{const[m,p,w]=await Promise.all([h.get(u),h.get(a),h.get(o)]),v=(p.exists()?p.data():{})??{},j=(w.exists()?w.data():{})??{};let k=typeof v.followerCount=="number"?v.followerCount:0,P=typeof v.followingCount=="number"?v.followingCount:0,R=typeof j.followerCount=="number"?j.followerCount:0;return m.exists()?(h.delete(u),P=Math.max(0,P-1),R=Math.max(0,R-1),h.set(a,{followingCount:P},{merge:!0}),h.set(o,{followerCount:R},{merge:!0}),{isFollowing:!1,followerCount:k,followingCount:P}):(P+=1,R+=1,h.set(u,{followerUid:e,followerNickname:t,followingUid:r.uid,followingNickname:r.nickname,createdAt:Yt()}),h.set(a,{followingCount:P},{merge:!0}),h.set(o,{followerCount:R},{merge:!0}),{isFollowing:!0,followerCount:k,followingCount:P})})}async function ab(n){if(!n)return[];const e=sn(ae,"follows"),t=xs(e,Kr("followingUid","==",n)),s=await Sn(t),r=new Set;return s.forEach(a=>{const c=a.data()?.followerNickname;c&&r.add(c)}),Array.from(r)}async function wg(n){if(!n.length)return[];const e=n.slice(0,10),t=sn(ae,"users"),s=xs(t,Kr("nickname","in",e)),r=await Sn(s),a=new Map;return r.forEach(o=>{const c=o.data(),u=c.nickname;a.set(u,{nickname:u,avatarUrl:c.profileImageUrl||c.photoURL||"",bio:c.profileDescription||"",title:c.currentTitle||""})}),n.map(o=>a.get(o)||{nickname:o})}function MR({userNickname:n}){const[e,t]=x.useState([]),[s,r]=x.useState(0),[a,o]=x.useState([]),[c,u]=x.useState([]),[d,h]=x.useState([]);x.useEffect(()=>{const j=Ne.currentUser?.uid??null;if(!j)return;let k=!1;const P=async()=>{try{const C=await ib(j);if(k)return;r(C.followerCount??0),t(C.followingNicknames??[])}catch(C){k||console.error("   :",C)}};P();const R=setInterval(P,5e3);return()=>{k=!0,clearInterval(R)}},[]);const m=x.useCallback(async()=>{const j=Ne.currentUser?.uid??null;if(j)try{const k=await ab(j);o(k??[]),r(Array.isArray(k)?k.length:0)}catch(k){console.error("   :",k)}},[]);x.useEffect(()=>{let j=!1;const k=async()=>{try{const P=await wg(a);j||u(P)}catch(P){console.error("    :",P)}};return a.length?k():u([]),()=>{j=!0}},[a]),x.useEffect(()=>{let j=!1;const k=async()=>{try{const P=await wg(e);j||h(P)}catch(P){console.error("    :",P)}};return e.length?k():h([]),()=>{j=!0}},[e]);const p=x.useCallback(async j=>{if(!j||j===n)return;const k=Ne.currentUser?.uid??null;if(!k){J.error("  .");return}try{const P=await OR({currentUid:k,currentNickname:n,targetNickname:j});t(R=>{const C=R.includes(j);return P.isFollowing&&!C?[...R,j]:!P.isFollowing&&C?R.filter(S=>S!==j):R}),P.isFollowing?J.success(`${j} .`):J.success(`${j} .`)}catch(P){console.error("/ :",P),(typeof P?.message=="string"?P.message:"").includes("TARGET_USER_NOT_FOUND")?J.error("     ."):J.error("   .    .")}},[n]),w=x.useCallback(j=>e.includes(j),[e]),v=e.length;return{followingUsers:e,followerUsers:a,followerCount:s,followingCount:v,handleToggleFollowUser:p,isFollowing:w,fetchFollowerUsers:m,setFollowerCount:r,followerUsersDetailed:c,followingUsersDetailed:d}}const Rs=n=>{const e=Ne.currentUser?.uid;return e?`${n}_${e}`:n};function UR({lumenBalance:n,spendLumens:e}){const[t,s]=x.useState([]),[r,a]=x.useState(""),[o,c]=x.useState(!1);x.useEffect(()=>{const w=Rs("ownedTitles"),v=Rs("currentTitle"),j=We.getJSON(w,[]);Array.isArray(j)&&s(j);const k=We.getItem(v);k&&a(k)},[]),x.useEffect(()=>{const w=Ne.currentUser?.uid;if(!w)return;(async()=>{try{const j=be(ae,"users",w),k=await Cn(j);if(!k.exists()){c(!0);return}const P=k.data();if(Array.isArray(P.ownedTitles)){const R=P.ownedTitles.filter(C=>typeof C=="string");R.length>0&&s(C=>{const S=Array.from(new Set([...C,...R])),D=Rs("ownedTitles");return We.setJSON(D,S),S})}if(typeof P.currentTitle=="string"){const R=Rs("currentTitle");P.currentTitle?(a(P.currentTitle),We.setItem(R,P.currentTitle)):(a(""),We.setItem(R,""))}}catch(j){console.error("   :",j)}finally{c(!0)}})()},[]),x.useEffect(()=>{if(!o)return;const w=Ne.currentUser?.uid??null;if(!w)return;(async()=>{try{const j=be(ae,"users",w);await ct(j,{ownedTitles:t,currentTitle:r||null})}catch(j){console.error("   :",j)}})()},[t,r,o]);const u=x.useCallback((w,v)=>o?v<0?(console.error("[titles] cost    .",{titleId:w,cost:v}),J.error("  .   ."),!1):t.includes(w)?(J.error("  ."),!1):v>0&&n<v?(J.error(" ."),!1):v>0&&!e(v," ",w)?(J.error(" ."),!1):(s(j=>{if(j.includes(w))return j;const k=[...j,w],P=Rs("ownedTitles");return We.setJSON(P,k),k}),J.success(" ! "),!0):(J.error("!    ."),!1),[t,n,e,o]),d=x.useCallback(w=>{if(!t.includes(w))return J.error("  ."),!1;if(r===w)return J.info("   ."),!1;a(w);const v=Rs("currentTitle");return We.setItem(v,w),J.success(" ! "),!0},[t,r]),h=x.useCallback(()=>{if(!r)return J.info("   ."),!1;a("");const w=Rs("currentTitle");return We.setItem(w,""),J.success(" ."),!0},[r]),m=x.useCallback((w,v)=>{s(j=>{if(j.includes(w))return j;const k=[...j,w],P=Rs("ownedTitles");return We.setJSON(P,k),console.log(`  '${v}' !`),k})},[]),p=x.useCallback(w=>t.includes(w),[t]);return{ownedTitles:t,currentTitle:r,titlesSyncReady:o,handleTitlePurchase:u,handleTitleEquip:d,handleTitleUnequip:h,addSpecialTitle:m,hasTitle:p,setOwnedTitles:s,setCurrentTitle:a}}function bg(n){let e;if(n.createdAt instanceof Date)e=n.createdAt;else if(n.createdAt&&typeof n.createdAt.toDate=="function")e=n.createdAt.toDate();else if(typeof n.createdAt=="string"||typeof n.createdAt=="number"){const t=new Date(n.createdAt);e=Number.isNaN(t.getTime())?new Date:t}else e=new Date;return{id:n.id??Date.now(),content:n.content??"",author:n.author??"",authorUid:n.authorUid??null,authorAvatar:typeof n.authorAvatar=="string"?n.authorAvatar:null,timeAgo:n.timeAgo??"",lanterns:typeof n.lanterns=="number"?n.lanterns:0,isGuide:!!n.isGuide,createdAt:e,authorTitleId:n.authorTitleId??null}}function FR({posts:n,setPosts:e,selectedPost:t,setSelectedPost:s,userNickname:r,clampedTrust:a,updateActivity:o,userProfileImage:c}){const[u,d]=x.useState(""),h=x.useRef(null),m=x.useCallback(P=>{d(P.target.value)},[]),p=x.useCallback(P=>{P&&(d(R=>{if(!R)return`@${P} `;const C=!R.endsWith(" ");return`${R}${C?" ":""}@${P} `}),h.current&&h.current.focus())},[]),w=x.useCallback(async()=>{if(!t||!u.trim())return;if(a<=0){J.error(" 0    .");return}if(Bs(u)){J.error("   .");return}const P=Ne.currentUser?.uid??null;let R=null;if(P)try{const _=be(ae,"users",P),y=await Cn(_);y.exists()&&(R=y.data().currentTitle??null)}catch(_){console.error("    :",_)}const C={id:Date.now(),content:u.trim(),author:r,authorUid:P,authorAvatar:c??null,timeAgo:"",lanterns:0,isGuide:!1,createdAt:new Date,authorTitleId:R},S=[...t.replies||[],C],D=S.map(_=>bg(_)),M=n.map(_=>String(_.id)===String(t.id)?{..._,replies:S,replyCount:S.length,comments:typeof _.comments=="number"?_.comments+1:S.length}:_);e(M),s({...t,replies:S,replyCount:S.length,comments:typeof t.comments=="number"?t.comments+1:S.length}),d(""),J.success(" !"),o({replies:1});try{let _=typeof t.id=="string"?t.id:null;if(!_){const y=n.find(b=>String(b.id)===String(t.id));y&&typeof y.id=="string"&&(_=y.id)}if(!_){console.warn("[handleReplySubmit] Firestore  :  ID  .",{selectedPostId:t.id});return}if(await ct(be(ae,"posts",_),{replies:D,replyCount:D.length,comments:typeof t.comments=="number"?t.comments+1:D.length}),P)try{await ct(be(ae,"users",P),{replyCount:zt(1)})}catch(y){console.error(" replyCount  :",y)}}catch(_){console.error("Firestore   :",_)}},[t,u,r,n,a,e,s,o,c]),v=x.useCallback(async P=>{if(!t)return;const R=t.replies?.find(D=>D.id===P);if(!R||R.author!==r){J.error("    .");return}const C=t.replies.filter(D=>D.id!==P),S=n.map(D=>String(D.id)===String(t.id)?{...D,replies:C,replyCount:C.length,comments:C.length}:D);e(S),s({...t,replies:C,replyCount:C.length}),J.success(" .");try{let D=typeof t.id=="string"?t.id:null;if(!D){const M=n.find(_=>String(_.id)===String(t.id));M&&typeof M.id=="string"&&(D=M.id)}if(D){const M=C.map(y=>bg(y)),_=JSON.parse(JSON.stringify(M));await ct(be(ae,"posts",D),{replies:_,replyCount:_.length,comments:_.length})}}catch(D){console.error("Firestore   :",D)}},[t,r,n,e,s]),j=x.useCallback((P,R)=>{if(!P)return null;const C=[],S=/@([^\s@]+)/g;let D=0,M;for(;(M=S.exec(P))!==null;){const _=M[0],y=M[1],b=M.index;b>D&&C.push(P.slice(D,b)),C.push(i.jsx("span",{"data-nickname":y,className:"text-primary font-semibold hover:underline cursor-pointer",onClick:()=>R(y),children:_},`mention-${b}-${y}`)),D=b+_.length}return D<P.length&&C.push(P.slice(D)),C},[]),k=a>0;return{newReplyContent:u,replyInputRef:h,handleReplyContentChange:m,handleInsertMention:p,handleReplySubmit:w,handleDeleteReply:v,renderContentWithMentions:j,canSubmitReply:k,setNewReplyContent:d}}function BR({posts:n,onPostSelect:e}){const[t,s]=x.useState([]),[r,a]=x.useState(!0),[o,c]=x.useState(!1);x.useEffect(()=>{const v=We.getJSON("notifications",[]);if(Array.isArray(v)){s(v);const j=v.some(k=>!k.isRead);a(j)}},[]),x.useEffect(()=>{We.setJSON("notifications",t);const v=t.some(j=>!j.isRead);a(v)},[t]);const u=x.useCallback(v=>{if(s(j=>j.map(k=>k.id===v.id?{...k,isRead:!0}:k)),c(!1),v.postId){const j=n.find(k=>String(k.id)===String(v.postId));j&&e(j)}},[n,e]),d=x.useCallback(()=>{s(v=>v.map(j=>({...j,isRead:!0}))),J.success("   ")},[]),h=x.useCallback(v=>{const j={...v,id:`notif-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};s(k=>[j,...k])},[]),m=x.useCallback(v=>{s(j=>j.filter(k=>k.id!==v))},[]),p=x.useCallback(()=>{s([]),J.success("  ")},[]),w=x.useCallback(v=>{c(j=>v!==void 0?v:!j)},[]);return{notifications:t,hasNotifications:r,showNotifications:o,handleNotificationClick:u,handleMarkAllNotificationsRead:d,addNotification:h,removeNotification:m,clearAllNotifications:p,toggleNotifications:w,setShowNotifications:c}}function $R({posts:n,setPosts:e,userNickname:t,userProfileImage:s,clampedTrust:r,updateActivity:a}){const[o,c]=x.useState(!1),[u,d]=x.useState(!1),h=x.useCallback(P=>r<=0?(J.error(" 0    ."),!1):u||localStorage.getItem("hidePostWarning")==="true"?(P(),!0):(c(!0),!0),[r,u]),m=x.useCallback(P=>{if(u&&localStorage.setItem("hidePostWarning","true"),c(!1),r<=0){J.error(" 0    .");return}P()},[u,r]),p=x.useCallback(async P=>{if(r<=0)return J.error(" 0    ."),null;if(Bs(P.title)||Bs(P.content))return J.error("   ."),null;const R=Ne.currentUser?.uid??null,C={...P,author:t,authorUid:R,authorAvatar:s,createdAt:new Date,lanterns:0,replies:[],replyCount:0,comments:0,views:0,isBookmarked:!1,isOwner:!0};try{const D={id:(await cd(sn(ae,"posts"),{...C,createdAt:Yt()})).id,...C,createdAt:new Date,title:"",content:"",category:"",subCategory:"",type:"",tags:[],author:"",authorUid:null,authorAvatar:"",lanterns:0,replies:[],replyCount:0,comments:0,views:0,isBookmarked:!1,isOwner:!1};if(e(M=>[D,...M]),R)try{await ct(be(ae,"users",R),{postCount:zt(1)})}catch(M){console.error(" postCount  :",M)}return P.type==="question"?a({explorePosts:1}):a({sharePosts:1}),J.success(" !"),D}catch(S){return console.error("  :",S),J.error("  ."),null}},[t,s,r,e,a]),w=x.useCallback(async P=>{const R=String(P),C=n.find(M=>String(M.id)===R);if(!C||C.author!==t)return J.error("    ."),!1;const S=C.createdAt instanceof Date?C.createdAt:new Date(C.createdAt),D=new Date(Date.now()-1800*1e3);if(S<D)return J.error("  30     ."),!1;try{return typeof C.id=="string"&&await Wc(be(ae,"posts",C.id)),e(M=>M.filter(_=>String(_.id)!==R)),J.success(" ."),!0}catch(M){return console.error("  :",M),J.error("  ."),!1}},[n,t,e]),v=x.useCallback(async P=>{const R=Ne.currentUser?.uid;if(!R)return;const C=String(P),S=n.find(_=>String(_.id)===C);if(!S||typeof S.id!="string")return;const D=be(ae,"posts",S.id),M=be(ae,"postViews",`${S.id}_${R}`);try{await cw(ae,async y=>(await y.get(M)).exists()?!1:(y.set(M,{postId:S.id,viewerUid:R,viewedAt:Yt()}),y.update(D,{views:zt(1)}),!0))&&e(y=>y.map(b=>String(b.id)===C?{...b,views:(b.views||0)+1}:b))}catch(_){console.error("  :",_)}},[n,e]),j=x.useCallback(P=>{const R=String(P),C=n.find(M=>String(M.id)===R);if(!C||C.author!==t)return!1;const S=C.createdAt instanceof Date?C.createdAt:new Date(C.createdAt),D=new Date(Date.now()-1800*1e3);return S>=D},[n,t]);return{showPostWarning:o,setShowPostWarning:c,dontShowWarningAgain:u,setDontShowWarningAgain:d,handleStartWriting:h,handleWarningConfirm:m,createPost:p,deletePost:w,incrementViews:v,canDeletePost:j,checkboxConfig:{checked:u,onCheckedChange:d,label:"  "}}}function qR({addLumens:n}){const[e,t]=x.useState(30);x.useEffect(()=>{const u=We.getNumber("trustScore",30);t(u)},[]),x.useEffect(()=>{const u=Ne.currentUser?.uid;if(!u)return;(async()=>{try{const h=be(ae,"users",u),m=await Cn(h);if(m.exists()){const p=m.data();typeof p.trustScore=="number"&&(t(p.trustScore),We.setItem("trustScore",String(p.trustScore)))}}catch(h){console.error("  :",h)}})()},[]);const s=x.useMemo(()=>Math.max(0,Math.min(100,e)),[e]),r=x.useMemo(()=>s<=10?.5:1,[s]),a=x.useCallback(u=>{t(d=>{const h=Math.max(0,Math.min(100,d+u));We.setItem("trustScore",h.toString());const m=Ne.currentUser?.uid??null;if(m){const p=be(ae,"users",m);ct(p,{trustScore:h}).catch(w=>{console.error(" Firestore  :",w)})}return h})},[]),o=x.useCallback((u,d,h)=>{if(s<=0)return;const m=Math.floor(u*r);m<=0||n(m,d??"",h)},[n,s,r]),c=s>0;return{trustScore:e,clampedTrust:s,lumenMultiplier:r,updateTrust:a,addLumensWithTrust:o,canWrite:c}}function zR({posts:n,userNickname:e}){const[t,s]=x.useState(0),[r,a]=x.useState(0),[o,c]=x.useState(0),[u,d]=x.useState(""),[h,m]=x.useState(""),[p,w]=x.useState({}),[v,j]=x.useState({}),[k,P]=x.useState({});x.useEffect(()=>{s(We.getNumber("userPostLanterns",0)),a(We.getNumber("userReplyLanterns",0)),c(We.getNumber("userGuideCount",0));const _=We.getItem("profileDescription");_&&d(_);const y=We.getItem("profileInterests");y&&m(y)},[]),x.useEffect(()=>{const _=Ne.currentUser?.uid;if(!_)return;const y=be(ae,"users",_),b=Io(y,I=>{if(!I.exists())return;const T=I.data();typeof T.guideCount=="number"&&(c(T.guideCount),We.setItem("userGuideCount",String(T.guideCount))),typeof T.postLanternsReceived=="number"&&(s(T.postLanternsReceived),We.setItem("userPostLanterns",String(T.postLanternsReceived))),typeof T.replyLanternsReceived=="number"&&(a(T.replyLanternsReceived),We.setItem("userReplyLanterns",String(T.replyLanternsReceived)))},I=>{console.error("    :",I)});return()=>{b()}},[]),x.useEffect(()=>{const _=new Date;_.setDate(_.getDate()-7);const y={};n.forEach(b=>{if(b.createdAt<_)return;const I=b.replies?.find(Z=>Z.isGuide);if(!I)return;const T=I.author??"  ",A=typeof I.authorUid=="string"?I.authorUid:null,N=A||T,F=y[N];y[N]={author:T,authorUid:A,count:(F?.count??0)+1}}),w(y)},[n]),x.useEffect(()=>{const _={};n.forEach(y=>{const b=y.replies?.find(F=>F.isGuide);if(!b)return;const I=b.author??"  ",T=typeof b.authorUid=="string"?b.authorUid:null,A=T||I,N=_[A];_[A]={author:I,authorUid:T,count:(N?.count??0)+1}}),j(_)},[n]),x.useEffect(()=>{const _=new Date;_.setDate(_.getDate()-7);const y={};n.forEach(b=>{const I=b.createdAt instanceof Date?b.createdAt:new Date(b.createdAt);if(I<_)return;const T=typeof b.lanterns=="number"?b.lanterns:0;if(T>0&&b.author){const A=b.author,N=typeof b.authorUid=="string"?b.authorUid:null,F=N||A,Z=y[F];y[F]={author:A,authorUid:N,count:(Z?.count??0)+T}}Array.isArray(b.replies)&&b.replies.forEach(A=>{const N=typeof A.lanterns=="number"?A.lanterns:0,F=A.author;if(!F||N<=0||((A.createdAt instanceof Date?A.createdAt:null)??I)<_)return;const xe=typeof A.authorUid=="string"?A.authorUid:null,K=xe||F,ee=y[K];y[K]={author:F,authorUid:xe,count:(ee?.count??0)+N}})}),P(y)},[n]);const R=x.useCallback(_=>{d(_),We.setItem("profileDescription",_)},[]),C=x.useCallback(_=>{m(_),We.setItem("profileInterests",_)},[]),S=x.useMemo(()=>n.filter(_=>_.author===e),[n,e]),D=x.useMemo(()=>n.flatMap(_=>(_.replies||[]).filter(y=>y.author===e).map(y=>({...y,postTitle:_.title,postAuthor:_.author,postId:_.id}))),[n,e]),M=x.useMemo(()=>Object.values(p).sort((y,b)=>b.count-y.count).slice(0,10).map((y,b)=>({rank:b+1,nickname:y.author,guideCount:y.count})),[p]);return{userPostLanterns:t,setUserPostLanterns:s,userReplyLanterns:r,setUserReplyLanterns:a,userGuideCount:o,setUserGuideCount:c,profileDescription:u,profileInterests:h,handleProfileDescriptionChange:R,handleProfileInterestsChange:C,weeklyGuideRanking:p,totalGuideRanking:v,weeklyLanternRanking:k,userPosts:S,userReplies:D,topGuideUsers:M}}const GR=vd("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function me({className:n,variant:e,asChild:t=!1,...s}){const r=t?Vg:"span";return i.jsx(r,{"data-slot":"badge",className:qe(GR({variant:e}),n),...s})}const To=x.forwardRef(({className:n,...e},t)=>i.jsx("textarea",{ref:t,"data-slot":"textarea",className:qe("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),...e}));To.displayName="Textarea";const of=Ob,Dl=x.forwardRef(({...n},e)=>i.jsx(Lg,{ref:e,"data-slot":"popover-trigger",...n}));Dl.displayName=Lg.displayName;const Vl=x.forwardRef(({className:n,align:e="center",sideOffset:t=4,...s},r)=>i.jsx(Lb,{children:i.jsx(Og,{ref:r,"data-slot":"popover-content",align:e,sideOffset:t,className:qe("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",n),...s})}));Vl.displayName=Og.displayName;function Wr({key:n,debounceMs:e=100}){const t=x.useRef(null),s=x.useRef(null),r=x.useRef(!1);return x.useEffect(()=>{const a=t.current;if(!a)return;const o=sessionStorage.getItem(`scroll-${n}`);o&&!r.current&&(r.current=!0,requestAnimationFrame(()=>{a.scrollTop=parseInt(o,10),setTimeout(()=>{r.current=!1},100)}));const c=()=>{r.current||(s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{sessionStorage.setItem(`scroll-${n}`,a.scrollTop.toString())},e))};return a.addEventListener("scroll",c,{passive:!0}),()=>{a.removeEventListener("scroll",c),s.current&&clearTimeout(s.current)}},[n,e]),t}const ob={best_contributor:" ",captain_captain:"",community_fellow:" ",curiosity_spark:" ",diligent_visitor:" ",discussion_expert:" ",discussion_maestro:" ",economy_analyst:" ",economy_expert:" ",engineering_curious:" ",engineering_destroyer:" ",engineering_first_light:"  ",engineering_focused:" ",explore_brave_questioner:"  ",explore_inquirer:"",explore_investigator:"",explore_philosopher:"",explore_steady_questioner:" ",famous_guide:" ",first_explore:"",guide_guide:"",guide_luminary:"",guide_navigator:"",guide_pathfinder:"",guide_sprout:" ",honorary_scholar:" ",immortal_lantern:"",insight_collector:" ",it_consultant:" ",it_expert:" ",kind_guide:" ",knowledge_sage:" ",language_expert:" ",language_tutor:" ",lantern_campfire:"",lantern_candle:"",lantern_furnace:"",lantern_giver:" ",lantern_giver_captain:"",lantern_giver_small:" ",lantern_lantern:"",little_guide:" ",master_on_path:"  ",multi_specialist:" ",ordinary_guide:" ",philosopher_soul:" ",popular_questioner:" ",reply_advisor:"",reply_challenger:" ",reply_helper:"",reply_mentor:"",reply_persistent_helper:"  ",reply_scholar:"",share_archivist:" ",share_curator:"",share_publisher:"",share_sharer:"",sherpa:"",specialized_replier:" ",streak_pillar:"",streak_regular:"",streak_resident:"",streak_visitor:"",thought_architect:" ",truth_seeker:" ",wisdom_lighthouse:" "},Ll=(n,e,t)=>{const s=n??"";return!s||s!==e||!t?"":ob[t]??""},$r=n=>n?ob[n]??"":"";function cf(n,e){if(!n)return"";const s=(e??new Date).getTime()-n.getTime(),r=Math.floor(s/1e3),a=Math.floor(r/60),o=Math.floor(a/60);if(Math.floor(o/24)<1)return r<60?" ":a<60?`${a} `:`${o} `;const u=n.getFullYear(),d=String(n.getMonth()+1).padStart(2,"0"),h=String(n.getDate()).padStart(2,"0");return`${u}.${d}.${h}`}function cb(n=6e4){const[e,t]=x.useState(()=>new Date);return x.useEffect(()=>{const s=setInterval(()=>{t(new Date)},n);return()=>clearInterval(s)},[n]),e}const Qo=new Map,vg=new Map;function No(n){const e=Array.from(new Set((n||[]).filter(r=>typeof r=="string"&&r.length>0))),[t,s]=x.useState({});return x.useEffect(()=>{if(e.length===0){s({});return}let r=!1;const a={};return e.forEach(o=>{const c=Qo.get(o);c&&(a[o]={nickname:c.nickname,profileImage:c.profileImage,currentTitleId:c.currentTitleId,profileDescription:c.profileDescription})}),s(a),e.forEach(o=>{if(vg.has(o))return;const c=be(ae,"users",o),u=Io(c,d=>{if(!d.exists())Qo.delete(o);else{const h=d.data(),m={nickname:typeof h.nickname=="string"?h.nickname:"",profileImage:typeof h.profileImage=="string"?h.profileImage:null,currentTitleId:typeof h.currentTitle=="string"?h.currentTitle:null,profileDescription:typeof h.profileDescription=="string"?h.profileDescription:null};Qo.set(o,m)}if(!r){const h={};e.forEach(m=>{const p=Qo.get(m);p&&(h[m]={nickname:p.nickname,profileImage:p.profileImage,currentTitleId:p.currentTitleId,profileDescription:p.profileDescription})}),s(h)}},d=>{console.error("[useUserProfiles] users   :",d)});vg.set(o,u)}),()=>{r=!0}},[e.join("|")]),t}function HR(n){const[e,t]=x.useState(null);return x.useEffect(()=>{if(!n){t(null);return}const s=sn(ae,"users"),r=xs(s,Kr("nickname","==",n)),a=Io(r,o=>{if(o.empty){t(null);return}const c=o.docs[0].data();t({nickname:typeof c.nickname=="string"?c.nickname:"",profileImage:typeof c.profileImage=="string"?c.profileImage:null,currentTitleId:typeof c.currentTitle=="string"?c.currentTitle:null,profileDescription:typeof c.profileDescription=="string"?c.profileDescription:null})},o=>{console.error("[useUserProfileByNickname] users   :",o)});return()=>{a()}},[n]),e}function lb(n){if(!n)return"";let e=null;if(n instanceof Date)e=n;else if(n&&typeof n.toDate=="function")e=n.toDate();else if(typeof n=="string"||typeof n=="number"){const t=new Date(n);Number.isNaN(t.getTime())||(e=t)}return e?e.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}function KR({post:n,userNickname:e,userProfileImage:t,currentTitle:s,isDarkMode:r,isPostLanterned:a,isReplyLanterned:o,onLanternToggle:c,onReplyLanternToggle:u,isBookmarked:d,onBookmarkToggle:h,isGuideReply:m,hasGuide:p,onGuideSelect:w,newReplyContent:v,onReplyContentChange:j,onReplySubmit:k,replyInputRef:P,onClose:R,onAuthorClick:C,onMentionAuthor:S,onMentionReplyAuthor:D,onReplyAuthorClick:M,onReport:_,onDelete:y,onReportReply:b,renderContentWithMentions:I,canSubmitReply:T}){const A=Wr({key:`post-detail-${n.id}`}),N=cb(6e4),F=n.replies?.map(se=>se.authorUid).filter(se=>typeof se=="string"&&se.length>0)??[],Z=x.useMemo(()=>Array.from(new Set([n.authorUid,...F].filter(se=>typeof se=="string"&&se.length>0))),[n.authorUid,F.join("|")]),Ee=No(Z),xe=x.useCallback(se=>{se.key==="Enter"&&!se.shiftKey&&(se.preventDefault(),k())},[k]),K=n.authorUid?Ee[n.authorUid]:void 0,ee=K?.currentTitleId??null,oe=$r(ee),Ae=K?.profileImage??n.authorAvatar??null,je=Ll(n.author??"",e,s),ke=oe||je,De=lb(n.createdAt);let Re=null;if(n.createdAt instanceof Date)Re=n.createdAt;else if(n.createdAt&&typeof n.createdAt.toDate=="function")Re=n.createdAt.toDate();else if(typeof n.createdAt=="string"||typeof n.createdAt=="number"){const se=new Date(n.createdAt);Number.isNaN(se.getTime())||(Re=se)}const Me=Re?cf(Re,N):"";return i.jsxs("div",{className:"h-full flex flex-col",children:[i.jsx("div",{className:"bg-card/95 border-b border-border p-4 flex-shrink-0",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",onClick:R,children:i.jsx(Et,{className:"w-5 h-5"})}),i.jsx("h2",{className:"font-medium",children:" "})]})}),i.jsx("div",{ref:A,className:"flex-1 scroll-container",children:i.jsxs("div",{className:"px-4 py-3 pb-24 space-y-4",children:[i.jsx($,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm",children:i.jsx(q,{className:"p-6",children:i.jsxs("div",{className:"space-y-5",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsxs(rn,{className:"w-12 h-12 ring-2 ring-border/30 cursor-pointer",onClick:C,children:[Ae&&i.jsx(vn,{src:Ae}),i.jsx(an,{className:"bg-gradient-to-br from-primary/20 to-primary/40 text-foreground font-semibold text-lg",children:n.author?.charAt(0)?.toUpperCase()||"?"})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("p",{className:"font-semibold text-base cursor-pointer hover:text-primary transition-colors duration-200",onClick:S,children:n.author}),ke&&i.jsx(me,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:ke})]}),i.jsx("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:Me&&i.jsx("span",{title:De||void 0,children:Me})})]})]}),i.jsx("div",{className:"flex items-center space-x-2",children:i.jsxs(of,{children:[i.jsx(Dl,{asChild:!0,children:i.jsx(z,{variant:"ghost",size:"icon",className:"touch-target",children:i.jsx(Wg,{className:"w-4 h-4"})})}),i.jsx(Vl,{className:"w-48 p-2",align:"end",children:i.jsxs("div",{className:"space-y-1",children:[n.isOwner&&i.jsxs(z,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-500",onClick:y,children:[i.jsx(Id,{className:"w-4 h-4 mr-2"}),""]}),!n.isOwner&&i.jsxs(z,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-500",onClick:_,children:[i.jsx(tl,{className:"w-4 h-4 mr-2"}),""]})]})})]})})]}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-medium mb-3",children:n.title}),i.jsx("p",{className:"text-muted-foreground leading-relaxed",children:I(n.content)})]}),n.tags&&n.tags.length>0&&i.jsx("div",{className:"flex flex-wrap gap-2",children:n.tags.map(se=>i.jsxs(me,{variant:"secondary",children:["#",se]},se))}),i.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[n.author!==e?i.jsxs(z,{variant:"ghost",size:"sm",onClick:c,className:`space-x-2 touch-target ${a?"text-amber-500":""}`,children:[a?i.jsx(Tt,{className:"w-4 h-4 text-amber-500"}):i.jsx(Xn,{className:"w-4 h-4"}),i.jsx("span",{children:n.lanterns})]}):i.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[i.jsx(Xn,{className:"w-4 h-4"}),i.jsx("span",{children:n.lanterns})]}),i.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[i.jsx(It,{className:"w-4 h-4"}),i.jsx("span",{children:n.comments??n.replies?.length??0})]}),i.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[i.jsx(nv,{className:"w-4 h-4"}),i.jsx("span",{children:n.views??0})]})]}),i.jsx(z,{variant:d?"default":"ghost",size:"sm",onClick:h,className:"flex items-center space-x-1 touch-target",children:i.jsx(gi,{className:`w-4 h-4 ${d?"fill-current":""}`})})]})]})})}),i.jsx("div",{className:"space-y-3",children:n.replies?.map(se=>i.jsx(WR,{reply:se,userNickname:e,userProfileImage:t,currentTitle:s,isPostAuthor:n.author===e,isLanterned:o(se.id),isGuide:se.isGuide||n.guideReplyId===se.id,hasGuideAlready:p,onLanternToggle:()=>u(se.id,n.id),onGuideSelect:()=>w(se.id,se.author,n.id),onMention:()=>D(se.author),onAuthorClick:()=>M(se.author),onReport:()=>b(se),renderContentWithMentions:I,userProfiles:Ee},se.id))}),i.jsx($,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm",children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-4",children:[i.jsx(To,{ref:P,placeholder:T?"    .":" 0    ",value:v,onChange:j,onKeyDown:xe,disabled:!T,className:"min-h-[100px] resize-none border-border/60 focus:border-primary/50 transition-colors duration-200 bg-background/50"}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("span",{className:"text-xs text-muted-foreground",children:[v.length,"/1000"]}),i.jsxs(z,{onClick:k,disabled:!v.trim()||!T,size:"sm",className:"touch-target px-6 py-2 rounded-xl transition-all duration-200 disabled:opacity-50",children:[i.jsx(Qg,{className:"w-4 h-4 mr-2"})," "]})]})]})})})]})})]})}function WR({reply:n,userNickname:e,userProfileImage:t,currentTitle:s,isPostAuthor:r,isLanterned:a,isGuide:o,hasGuideAlready:c,onLanternToggle:u,onGuideSelect:d,onMention:h,onAuthorClick:m,onReport:p,renderContentWithMentions:w,userProfiles:v}){const j=cb(6e4),k=n.author===e,P=n.authorUid?v[n.authorUid]:void 0,R=P?.currentTitleId??null,C=$r(R),S=P?.profileImage??n.authorAvatar??null,D=Ll(n.author??"",e,s),M=C||D;let _=null;if(n.createdAt instanceof Date)_=n.createdAt;else if(n.createdAt&&typeof n.createdAt.toDate=="function")_=n.createdAt.toDate();else if(typeof n.createdAt=="string"||typeof n.createdAt=="number"){const I=new Date(n.createdAt);Number.isNaN(I.getTime())||(_=I)}let y="";_?y=cf(_,j):typeof n.timeAgo=="string"&&n.timeAgo.length>0&&(y=n.timeAgo);const b=_?lb(_):"";return i.jsx($,{className:`border-border/60 shadow-sm bg-card/40 backdrop-blur-sm list-optimized ${o?"ring-2 ring-amber-500/50 bg-amber-500/5":""}`,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsxs(rn,{className:"w-9 h-9 ring-2 ring-border/20 cursor-pointer",onClick:m,children:[S&&i.jsx(vn,{src:S}),i.jsx(an,{className:"bg-gradient-to-br from-primary/20 to-primary/40 text-foreground font-medium",children:n.author?.charAt(0)?.toUpperCase()||"?"})]}),i.jsx("div",{children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("p",{className:"font-medium text-sm cursor-pointer hover:text-primary transition-colors duration-200",onClick:h,children:n.author}),M&&i.jsx(me,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:M}),o&&i.jsxs(me,{className:"bg-amber-500 text-white text-[10px] px-2 py-0 flex items-center",children:[i.jsx(Gn,{className:"w-3 h-3 mr-1"}),""]})]})})]}),!k&&i.jsxs(of,{children:[i.jsx(Dl,{asChild:!0,children:i.jsx(z,{variant:"ghost",size:"icon",className:"w-8 h-8",children:i.jsx(Wg,{className:"w-4 h-4"})})}),i.jsx(Vl,{className:"w-48 p-2",align:"end",children:i.jsxs("div",{className:"space-y-1",children:[r&&!c&&!o&&i.jsxs(z,{variant:"ghost",size:"sm",className:"w-full justify-start text-amber-600",onClick:d,children:[i.jsx(Gn,{className:"w-4 h-4 mr-2"})," "]}),i.jsxs(z,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-500",onClick:p,children:[i.jsx(tl,{className:"w-4 h-4 mr-2"}),""]})]})})]})]}),i.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:w(n.content)}),i.jsxs("div",{className:"flex items-center justify-between pt-2",children:[i.jsx("div",{className:"flex items-center space-x-3",children:k?i.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground px-2",children:[i.jsx(Xn,{className:"w-4 h-4"}),i.jsx("span",{className:"text-xs",children:n.lanterns})]}):i.jsxs(z,{variant:"ghost",size:"sm",onClick:u,className:`space-x-1 h-8 ${a?"text-amber-500":""}`,children:[a?i.jsx(Tt,{className:"w-4 h-4 text-amber-500"}):i.jsx(Xn,{className:"w-4 h-4"}),i.jsx("span",{className:"text-xs",children:n.lanterns})]})}),i.jsx("div",{className:"flex flex-col items-end leading-tight text-xs text-muted-foreground",children:y&&i.jsx("span",{title:b||void 0,children:y})})]})]})})})}function QR({value:n,options:e,onChange:t,className:s,triggerClassName:r}){const[a,o]=x.useState(!1),c=x.useRef(null),u=e.find(h=>h.value===n);x.useEffect(()=>{const h=m=>{c.current&&!c.current.contains(m.target)&&o(!1)};return a&&(document.addEventListener("mousedown",h),document.addEventListener("touchstart",h)),()=>{document.removeEventListener("mousedown",h),document.removeEventListener("touchstart",h)}},[a]);const d=h=>{t(h),o(!1)};return i.jsxs("div",{ref:c,className:qe("relative inline-block",s),children:[i.jsxs("button",{type:"button",onClick:()=>o(!a),className:qe("inline-flex items-center justify-between gap-2 rounded-lg border border-border/60 bg-background/50 px-3 py-1.5 text-xs transition-colors hover:bg-accent/50",r),children:[i.jsx("span",{children:u?.label}),i.jsx(Jg,{size:14,style:{stroke:"currentColor",fill:"none",display:"block",width:"14px",height:"14px",transform:a?"rotate(180deg)":"rotate(0deg)",transition:"transform 200ms ease"}})]}),a&&i.jsx("div",{className:"absolute right-0 top-full mt-1 z-[9999] min-w-[6rem] rounded-md border border-border bg-popover shadow-lg animate-in fade-in-0 zoom-in-95 slide-in-from-top-2",children:i.jsx("div",{className:"p-1",children:e.map(h=>i.jsxs("button",{type:"button",onClick:()=>d(h.value),className:qe("relative w-full flex items-center justify-between gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors cursor-pointer","hover:bg-accent hover:text-accent-foreground",h.value===n?"bg-accent/50 text-accent-foreground":"text-popover-foreground"),children:[i.jsx("span",{children:h.label}),h.value===n&&i.jsx(to,{size:16,style:{stroke:"currentColor",fill:"none",display:"block",width:"16px",height:"16px"}})]},h.value))})})]})}const JR=[{label:"",value:"latest"},{label:"",value:"oldest"},{label:"",value:"lanterns"}];function YR({posts:n,userNickname:e,userProfileImage:t,activeCategory:s,activeSubCategory:r,sortBy:a,categories:o,onSubCategoryChange:c,onSortChange:u,isPostLanterned:d,isBookmarked:h,onPostClick:m,onLanternToggle:p,onBookmarkToggle:w,onStartWriting:v,currentTitle:j}){const k=Wr({key:`main-posts-${s}-${r}`}),P=x.useMemo(()=>Array.from(new Set(n.map(I=>I.authorUid).filter(I=>typeof I=="string"&&I.length>0))),[n]),R=No(P),C=x.useMemo(()=>o.find(I=>I.id===s),[o,s]),S=x.useMemo(()=>C?.subCategories??[],[C]),D=x.useCallback(I=>{const T=I.currentTarget.getAttribute("data-sub-id");T&&c(T)},[c]),M=x.useMemo(()=>{let I=n;return s!==""&&(I=I.filter(T=>T.category===s)),r!==""&&(I=I.filter(T=>T.subCategory===r)),[...I].sort((T,A)=>{switch(a){case"lanterns":return A.lanterns-T.lanterns;case"oldest":{const N=T.createdAt?T.createdAt.getTime():0,F=A.createdAt?A.createdAt.getTime():0;return N-F}default:{const N=T.createdAt?T.createdAt.getTime():0;return(A.createdAt?A.createdAt.getTime():0)-N}}})},[n,s,r,a]),_=x.useCallback(I=>cf(I),[]),y=x.useCallback(I=>I?I.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",[]),b=x.useMemo(()=>S.map(I=>i.jsx(z,{variant:r===I.id?"default":"ghost",size:"sm","data-sub-id":I.id,onClick:D,className:`whitespace-nowrap flex-shrink-0 rounded-full px-4 transition-all duration-200 ${r===I.id?"bg-primary text-primary-foreground shadow-sm":"hover:bg-accent/80"}`,children:I.name},I.id)),[S,r,D]);return i.jsxs("div",{className:"h-full flex flex-col",children:[i.jsxs("div",{className:"bg-card/98 glass-effect border-b border-border px-4 py-3 flex-shrink-0 shadow-sm relative z-20",children:[S.length>1&&i.jsx("div",{className:"flex space-x-2 overflow-x-auto scrollbar-hide mb-3",children:b}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("span",{className:"text-sm text-muted-foreground",children:[M.length," "]}),i.jsx(QR,{value:a,onChange:u,options:JR,triggerClassName:"w-24 h-8"})]})]}),i.jsx("div",{ref:k,className:"flex-1 scroll-container scrollbar-hide",children:i.jsx("div",{className:"px-4 py-3 pb-24 space-y-3",children:M.length===0?i.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-center px-4",children:[i.jsxs("div",{className:"relative mb-8",children:[i.jsx("div",{className:"absolute inset-0 bg-amber-500/30 dark:bg-amber-400/30 blur-3xl rounded-full animate-pulse"}),i.jsx("div",{className:"relative w-32 h-32 rounded-full bg-amber-100 dark:bg-amber-900/40 flex items-center justify-center border-4 border-amber-400 dark:border-amber-600 shadow-lg",children:i.jsx(Xn,{className:"w-20 h-20 text-amber-900 dark:text-amber-200"})})]}),i.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"  "}),i.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-64",children:"      !"}),i.jsxs(z,{onClick:v,className:"bg-primary text-primary-foreground px-6 py-2 rounded-xl",children:[i.jsx(Td,{className:"w-4 h-4 mr-2"}),"  "]})]}):M.map(I=>i.jsx(XR,{post:I,userNickname:e,userProfileImage:t,isLanterned:d(I.id),isBookmarked:h(I.id),timeAgo:_(I.createdAt),createdAtText:y(I.createdAt),currentTitle:j,onClick:()=>m(I),onLanternClick:T=>{T.stopPropagation(),p(I.id)},onBookmarkClick:T=>{T.stopPropagation(),w(I.id)},userProfiles:R},I.id))})})]})}function XR({post:n,userNickname:e,userProfileImage:t,isLanterned:s,isBookmarked:r,timeAgo:a,createdAtText:o,currentTitle:c,onClick:u,onLanternClick:d,onBookmarkClick:h,userProfiles:m}){const p=n.author===e,w=n.authorUid?m[n.authorUid]:void 0,v=w?.currentTitleId??null,j=$r(v),k=w?.profileImage??(p?t:n.authorAvatar??""),P=Ll(n.author??"",e,c),R=j||P;return i.jsx($,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm hover:shadow-md transition-shadow cursor-pointer list-optimized",onClick:u,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsxs(rn,{className:"w-10 h-10 ring-2 ring-border/20",children:[k&&i.jsx(vn,{src:k}),i.jsx(an,{className:"bg-gradient-to-br from-primary/20 to-primary/40 text-foreground font-medium",children:n.author?.charAt(0)?.toUpperCase()||"?"})]}),i.jsx("div",{className:"w-full",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("p",{className:"text-sm font-medium",children:n.author}),R&&i.jsx(me,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:R})]}),i.jsx("div",{className:"text-xs text-muted-foreground",children:(n.timeAgo??a)&&i.jsx("span",{title:o||void 0,children:n.timeAgo??a})})]}),n.type==="guide"&&i.jsx("div",{className:"mt-1",children:i.jsx("span",{className:"px-1.5 py-0.5 rounded-full bg-amber-500/10 text-amber-600 text-[10px] font-semibold",children:" "})})]})})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium text-base mb-1 line-clamp-1",children:n.title}),i.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:n.content})]}),n.tags&&n.tags.length>0&&i.jsxs("div",{className:"flex space-x-1",children:[n.tags[0]&&i.jsxs(me,{variant:"secondary",className:"text-xs px-1.5 py-0.5",children:["#",n.tags[0]]}),n.tags[1]&&i.jsxs(me,{variant:"secondary",className:"text-xs px-1.5 py-0.5",children:["#",n.tags[1]]})]}),i.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[i.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[p?i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(Xn,{className:"w-4 h-4"}),i.jsx("span",{className:"text-xs",children:n.lanterns??0})]}):i.jsxs(z,{variant:"ghost",size:"sm",onClick:d,className:`h-8 px-2 space-x-1 ${s?"text-amber-500":"text-muted-foreground"}`,children:[s?i.jsx(Tt,{className:"w-4 h-4"}):i.jsx(Xn,{className:"w-4 h-4"}),i.jsx("span",{className:"text-xs",children:n.lanterns??0})]}),i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(It,{className:"w-4 h-4"}),i.jsx("span",{className:"text-xs",children:n.comments??n.replies?.length??0})]}),i.jsxs("span",{children:[" ",n.views??0]})]}),i.jsx(z,{variant:"ghost",size:"sm",onClick:h,className:`h-8 px-2 ${r?"text-primary":"text-muted-foreground"}`,children:i.jsx(gi,{className:`w-4 h-4 ${r?"fill-current":""}`})})]})]})})})}function ZR({isDarkMode:n,onToggleDarkMode:e,hasNotifications:t,showNotifications:s,onNotificationsToggle:r,notifications:a,onNotificationClick:o,onMarkAllNotificationsRead:c,onNotificationSettingsClick:u,activeCategory:d,activeSubCategory:h,onCategoryClick:m,onGuidelinesClick:p,onTitleShopClick:w}){return i.jsx("header",{className:"bg-card/98 glass-effect border-b border-border/60 flex-shrink-0 z-40 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200",onClick:m,children:i.jsx(sv,{className:"w-5 h-5"})}),i.jsx("div",{children:i.jsxs("h1",{className:"text-lg font-semibold",children:[d,h!==""&&`  ${h}`]})})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(z,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200 text-foreground",onClick:p,"aria-label":" ",children:i.jsx($s,{className:"w-5 h-5"})}),i.jsx(z,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200 text-foreground",onClick:w,children:i.jsx(Yg,{className:"w-5 h-5"})}),i.jsx(z,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200",onClick:e,children:n?i.jsx(Nd,{className:"w-4 h-4"}):i.jsx(Ed,{className:"w-4 h-4"})}),i.jsxs(of,{open:s,onOpenChange:r,children:[i.jsx(Dl,{asChild:!0,children:i.jsxs(z,{variant:"ghost",size:"icon",className:"relative",children:[i.jsx(bc,{className:"w-4 h-4"}),t&&i.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"})]})}),i.jsxs(Vl,{className:"w-80 p-0",align:"end",side:"bottom",sideOffset:5,children:[i.jsx("div",{className:"p-4 border-b border-border",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h3",{className:"font-medium",children:""}),i.jsxs("div",{className:"flex items-center space-x-2",children:[a.some(v=>!v.isRead)&&i.jsx(z,{variant:"outline",size:"sm",onClick:c,className:"text-xs h-7 px-2",children:" "}),i.jsx(z,{variant:"ghost",size:"icon",onClick:u,children:i.jsx(nl,{className:"w-4 h-4"})})]})]})}),i.jsx("div",{className:"max-h-80 scroll-optimized",children:a.length===0?i.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"  "}):i.jsx(i.Fragment,{children:a.map(v=>i.jsx("div",{className:`p-4 border-b border-border hover:bg-muted/50 transition-colors cursor-pointer ${v.isRead?"":"bg-muted/30"}`,onClick:()=>o(v),children:i.jsxs("div",{className:"flex items-start space-x-3",children:[i.jsxs("div",{className:"flex-shrink-0 mt-1",children:[v.type==="reply"&&i.jsx(It,{className:"w-4 h-4 text-blue-500"}),v.type==="lantern"&&i.jsx(Tt,{className:"w-4 h-4 text-amber-500"}),v.type==="popular"&&i.jsx(Gn,{className:"w-4 h-4 text-primary"})]}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm",children:v.message}),i.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[v.postTitle,"  ",v.time]})]}),!v.isRead&&i.jsx("div",{className:"w-2 h-2 bg-primary rounded-full flex-shrink-0"})]})},v.id))})})]})]})]})]})})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e1="type.googleapis.com/google.protobuf.Int64Value",t1="type.googleapis.com/google.protobuf.UInt64Value";function ub(n,e){const t={};for(const s in n)n.hasOwnProperty(s)&&(t[s]=e(n[s]));return t}function Yc(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>Yc(e));if(typeof n=="function"||typeof n=="object")return ub(n,e=>Yc(e));throw new Error("Data cannot be encoded in JSON: "+n)}function $i(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case e1:case t1:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>$i(e)):typeof n=="function"||typeof n=="object"?ub(n,e=>$i(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lf="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ig={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class en extends gn{constructor(e,t,s){super(`${lf}/${e}`,t||""),this.details=s,Object.setPrototypeOf(this,en.prototype)}}function n1(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Xc(n,e){let t=n1(n),s=t,r;try{const a=e&&e.error;if(a){const o=a.status;if(typeof o=="string"){if(!Ig[o])return new en("internal","internal");t=Ig[o],s=o}const c=a.message;typeof c=="string"&&(s=c),r=a.details,r!==void 0&&(r=$i(r))}}catch{}return t==="ok"?null:new en(t,s,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s1{constructor(e,t,s,r){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,un(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=s.getImmediate({optional:!0}),this.auth||t.get().then(a=>this.auth=a,()=>{}),this.messaging||s.get().then(a=>this.messaging=a,()=>{}),this.appCheck||r?.get().then(a=>this.appCheck=a,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),s=await this.getMessagingToken(),r=await this.getAppCheckToken(e);return{authToken:t,messagingToken:s,appCheckToken:r}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pd="us-central1",r1=/^data: (.*?)(?:\n|$)/;function i1(n){let e=null;return{promise:new Promise((t,s)=>{e=setTimeout(()=>{s(new en("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class a1{constructor(e,t,s,r,a=pd,o=(...c)=>fetch(...c)){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new s1(e,t,s,r),this.cancelAllRequests=new Promise(c=>{this.deleteService=()=>Promise.resolve(c())});try{const c=new URL(a);this.customDomain=c.origin+(c.pathname==="/"?"":c.pathname),this.region=pd}catch{this.customDomain=null,this.region=a}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function o1(n,e,t){const s=Zn(e);n.emulatorOrigin=`http${s?"s":""}://${e}:${t}`,s&&(rl(n.emulatorOrigin+"/backends"),Cd("Functions",!0))}function c1(n,e,t){const s=r=>u1(n,e,r,{});return s.stream=(r,a)=>h1(n,e,r,a),s}function db(n){return n.emulatorOrigin&&Zn(n.emulatorOrigin)?"include":void 0}async function l1(n,e,t,s,r){t["Content-Type"]="application/json";let a;try{a=await s(n,{method:"POST",body:JSON.stringify(e),headers:t,credentials:db(r)})}catch{return{status:0,json:null}}let o=null;try{o=await a.json()}catch{}return{status:a.status,json:o}}async function hb(n,e){const t={},s=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return s.authToken&&(t.Authorization="Bearer "+s.authToken),s.messagingToken&&(t["Firebase-Instance-ID-Token"]=s.messagingToken),s.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=s.appCheckToken),t}function u1(n,e,t,s){const r=n._url(e);return d1(n,r,t,s)}async function d1(n,e,t,s){t=Yc(t);const r={data:t},a=await hb(n,s),o=s.timeout||7e4,c=i1(o),u=await Promise.race([l1(e,r,a,n.fetchImpl,n),c.promise,n.cancelAllRequests]);if(c.cancel(),!u)throw new en("cancelled","Firebase Functions instance was deleted.");const d=Xc(u.status,u.json);if(d)throw d;if(!u.json)throw new en("internal","Response is not valid JSON object.");let h=u.json.data;if(typeof h>"u"&&(h=u.json.result),typeof h>"u")throw new en("internal","Response is missing data field.");return{data:$i(h)}}function h1(n,e,t,s){const r=n._url(e);return f1(n,r,t,s||{})}async function f1(n,e,t,s){t=Yc(t);const r={data:t},a=await hb(n,s);a["Content-Type"]="application/json",a.Accept="text/event-stream";let o;try{o=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(r),headers:a,signal:s?.signal,credentials:db(n)})}catch(p){if(p instanceof Error&&p.name==="AbortError"){const v=new en("cancelled","Request was cancelled.");return{data:Promise.reject(v),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(v)}}}}}}const w=Xc(0,null);return{data:Promise.reject(w),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(w)}}}}}}let c,u;const d=new Promise((p,w)=>{c=p,u=w});s?.signal?.addEventListener("abort",()=>{const p=new en("cancelled","Request was cancelled.");u(p)});const h=o.body.getReader(),m=m1(h,c,u,s?.signal);return{stream:{[Symbol.asyncIterator](){const p=m.getReader();return{async next(){const{value:w,done:v}=await p.read();return{value:w,done:v}},async return(){return await p.cancel(),{done:!0,value:void 0}}}}},data:d}}function m1(n,e,t,s){const r=(o,c)=>{const u=o.match(r1);if(!u)return;const d=u[1];try{const h=JSON.parse(d);if("result"in h){e($i(h.result));return}if("message"in h){c.enqueue($i(h.message));return}if("error"in h){const m=Xc(0,h);c.error(m),t(m);return}}catch(h){if(h instanceof en){c.error(h),t(h);return}}},a=new TextDecoder;return new ReadableStream({start(o){let c="";return u();async function u(){if(s?.aborted){const d=new en("cancelled","Request was cancelled");return o.error(d),t(d),Promise.resolve()}try{const{value:d,done:h}=await n.read();if(h){c.trim()&&r(c.trim(),o),o.close();return}if(s?.aborted){const p=new en("cancelled","Request was cancelled");o.error(p),t(p),await n.cancel();return}c+=a.decode(d,{stream:!0});const m=c.split(`
`);c=m.pop()||"";for(const p of m)p.trim()&&r(p.trim(),o);return u()}catch(d){const h=d instanceof en?d:Xc(0,null);o.error(h),t(h)}}},cancel(){return n.cancel()}})}const Tg="@firebase/functions",Ng="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p1="auth-internal",g1="app-check-internal",x1="messaging-internal";function y1(n){const e=(t,{instanceIdentifier:s})=>{const r=t.getProvider("app").getImmediate(),a=t.getProvider(p1),o=t.getProvider(x1),c=t.getProvider(g1);return new a1(r,a,o,c,s)};nn(new Kt(lf,e,"PUBLIC").setMultipleInstances(!0)),St(Tg,Ng,n),St(Tg,Ng,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _1(n=ro(),e=pd){const s=Rn(Ge(n),lf).getImmediate({identifier:e}),r=ox("functions");return r&&w1(s,...r),s}function w1(n,e,t){o1(Ge(n),e,t)}function fb(n,e,t){return c1(Ge(n),e)}y1();const mb=_1(Ji,"asia-northeast3"),b1=fb(mb,"awardLumens"),v1=fb(mb,"purchaseTitle");function Eg(n){const e={id:n.id,amount:n.amount,reason:n.reason,timestamp:n.timestamp};return n.achievementId!=null&&(e.achievementId=n.achievementId),n.titleId!=null&&(e.titleId=n.titleId),e}const ga=100,pb="app_lumens",ai={balance:0,totalEarned:0,totalSpent:0,transactions:[]};function I1(){if(typeof window>"u")return null;try{if(!("localStorage"in window))return null}catch{return null}try{const n=window.localStorage.getItem(pb);if(!n)return null;const e=JSON.parse(n);if(!e||typeof e!="object")return null;const t=typeof e.balance=="number"&&!Number.isNaN(e.balance)?e.balance:0,s=typeof e.totalEarned=="number"&&!Number.isNaN(e.totalEarned)?e.totalEarned:0,r=typeof e.totalSpent=="number"&&!Number.isNaN(e.totalSpent)?e.totalSpent:0,a=Array.isArray(e.transactions)?e.transactions.map(o=>{if(!o)return null;const c=String(o.id??""),u=Number(o.amount??0),d=String(o.reason??""),h=Number(o.timestamp??0);return!c||!d||Number.isNaN(u)||Number.isNaN(h)?null:{id:c,amount:u,reason:d,timestamp:h,achievementId:o.achievementId,titleId:o.titleId}}).filter(o=>o!==null).sort((o,c)=>c.timestamp-o.timestamp):[];return{balance:t,totalEarned:s,totalSpent:r,transactions:a}}catch(n){return console.error(" localStorage    :",n),null}}function T1(){const[n,e]=x.useState(ai);x.useEffect(()=>{const c=Ne.currentUser?.uid;if(!c)return;let u=!1;return(async()=>{try{const h=be(ae,"users",c),m=await Cn(h);if(m.exists()){const v=m.data(),j={balance:typeof v.lumenBalance=="number"?v.lumenBalance:ai.balance,totalEarned:typeof v.lumenTotalEarned=="number"?v.lumenTotalEarned:ai.totalEarned,totalSpent:typeof v.lumenTotalSpent=="number"?v.lumenTotalSpent:ai.totalSpent,transactions:Array.isArray(v.lumenTransactions)?v.lumenTransactions.map(k=>{if(!k)return null;const P=String(k.id??""),R=Number(k.amount??0),C=String(k.reason??""),S=Number(k.timestamp??0);return!P||!C||Number.isNaN(R)||Number.isNaN(S)?null:{id:P,amount:R,reason:C,timestamp:S,achievementId:k.achievementId,titleId:k.titleId}}).filter(k=>k!==null).sort((k,P)=>P.timestamp-k.timestamp).slice(0,ga):[]};u||e(j);return}const p=I1(),w=p??ai;if(u||e({...w,transactions:w.transactions.slice(0,ga)}),await kn(h,{lumenBalance:w.balance,lumenTotalEarned:w.totalEarned,lumenTotalSpent:w.totalSpent,lumenTransactions:w.transactions.slice(0,ga).map(Eg)},{merge:!0}),p)try{window.localStorage.removeItem(pb)}catch{}}catch(h){console.error(" Firestore  :",h)}})(),()=>{u=!0}},[]);const t=x.useCallback((c,u,d)=>{if(c<=0)return console.error(" 0   "),!1;if(!(Ne.currentUser?.uid??null))return console.error("     "),!1;const m={id:Date.now().toString()+Math.random().toString(36).substr(2,9),amount:c,reason:u,timestamp:Date.now(),achievementId:d};return e(p=>{const w=[m,...p.transactions].slice(0,ga);return{balance:p.balance+c,totalEarned:p.totalEarned+c,totalSpent:p.totalSpent,transactions:w}}),b1({amount:c,reason:u,achievementId:d}).then(p=>{const w=p.data;w.success||console.warn("[lumens] awardLumens  success=false .",w)}).catch(p=>{console.error("[lumens] awardLumens Cloud Function  ",p)}),!0},[]),s=x.useCallback((c,u,d)=>{if(c<=0)return console.error(" 0   "),!1;if(n.balance<c)return console.error(` ! : ${c}, : ${n.balance}`),!1;const h=Ne.currentUser?.uid??null;if(!h)return console.error("     "),!1;const m={id:`${Date.now()}-${Math.random()}`,amount:-c,reason:u,timestamp:Date.now(),titleId:d};if(e(w=>{if(w.balance<c)return console.error(` ! : ${c}, : ${w.balance}`),w;const v=[m,...w.transactions].slice(0,ga);return{balance:w.balance-c,totalEarned:w.totalEarned,totalSpent:w.totalSpent+c,transactions:v}}),d)return v1({titleId:d}).then(w=>{const v=w.data;v.success||console.warn("[lumens] purchaseTitle  success=false .",v)}).catch(w=>{console.error("[lumens] purchaseTitle Cloud Function  ",w)}),!0;const p=be(ae,"users",h);return ct(p,{lumenBalance:zt(-c),lumenTotalSpent:zt(c),lumenTransactions:nk(Eg(m))}).catch(w=>{console.error(" Firestore  ():",w)}),!0},[n.balance]),r=x.useCallback(c=>n.transactions.some(u=>u.achievementId===c&&u.amount>0),[n.transactions]),a=x.useCallback((c=10)=>n.transactions.slice(0,c),[n.transactions]),o=x.useCallback(()=>{const c=Ne.currentUser?.uid??null;if(e(ai),c){const u=be(ae,"users",c);ct(u,{lumenBalance:0,lumenTotalEarned:0,lumenTotalSpent:0,lumenTransactions:[]}).catch(d=>{console.error(" Firestore  :",d)})}},[]);return{balance:n.balance,totalEarned:n.totalEarned,totalSpent:n.totalSpent,transactions:n.transactions,addLumens:t,spendLumens:s,hasReceivedRewardForAchievement:r,getRecentTransactions:a,resetLumens:o}}const gd=[{id:"first_explore",name:" ",description:"    ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:1},reward:{lumens:0}},{id:"first_share",name:" ",description:"     ",category:"share",hidden:!1,condition:{type:"share_post_count",target:1},reward:{lumens:0}},{id:"first_reply",name:" ",description:"   ",category:"reply",hidden:!1,condition:{type:"reply_count",target:1},reward:{lumens:0}},{id:"first_guide",name:" ",description:"   -     ",category:"guide",hidden:!1,condition:{type:"guide_count",target:1},reward:{lumens:0}},{id:"first_lantern_received",name:" ",description:"  ",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:1},reward:{lumens:0}},{id:"first_login_streak",name:" ",description:" 3 ",category:"streak",hidden:!1,condition:{type:"login_streak",target:3},reward:{lumens:0}},{id:"explore_seeker",name:"",description:"  10 ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:10},reward:{lumens:0,specialTitle:""}},{id:"explore_inquirer",name:"",description:"  30 ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:30},reward:{lumens:1,specialTitle:""}},{id:"explore_investigator",name:"",description:"  100 ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:100},reward:{lumens:3,specialTitle:""}},{id:"explore_philosopher",name:"",description:"  300 ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:300},reward:{lumens:5,specialTitle:""}},{id:"reply_helper",name:"",description:" 10    10  -     ",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:10,minLanterns:10},reward:{lumens:0,specialTitle:""}},{id:"reply_advisor",name:"",description:" 10    30  -     ",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:30,minLanterns:10},reward:{lumens:1,specialTitle:""}},{id:"reply_mentor",name:"",description:" 10    100  -    ",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:100,minLanterns:10},reward:{lumens:3,specialTitle:""}},{id:"reply_scholar",name:"",description:" 10    300  -     ",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:300,minLanterns:10},reward:{lumens:5,specialTitle:""}},{id:"guide_guide",name:"",description:" 5  -    ",category:"guide",hidden:!1,condition:{type:"guide_count",target:5},reward:{lumens:0,specialTitle:""}},{id:"guide_navigator",name:"",description:" 20  -    ",category:"guide",hidden:!1,condition:{type:"guide_count",target:20},reward:{lumens:1,specialTitle:""}},{id:"guide_pathfinder",name:"",description:" 50  -    ",category:"guide",hidden:!1,condition:{type:"guide_count",target:50},reward:{lumens:3,specialTitle:""}},{id:"guide_luminary",name:"",description:" 100  -   ",category:"guide",hidden:!1,condition:{type:"guide_count",target:100},reward:{lumens:5,specialTitle:""}},{id:"lantern_candle",name:"",description:" 50  -      ",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:50},reward:{lumens:0,specialTitle:""}},{id:"lantern_campfire",name:"",description:" 200  -      ",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:200},reward:{lumens:1,specialTitle:""}},{id:"lantern_lantern",name:"",description:" 500  -     ",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:500},reward:{lumens:3,specialTitle:""}},{id:"lantern_furnace",name:"",description:" 1500  -    ",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:1500},reward:{lumens:5,specialTitle:""}},{id:"share_sharer",name:"",description:" 3      10 ",category:"share",hidden:!1,condition:{type:"share_post_count",target:10,minLanterns:3},reward:{lumens:0,specialTitle:""}},{id:"share_curator",name:"",description:" 3      30 ",category:"share",hidden:!1,condition:{type:"share_post_count",target:30,minLanterns:3},reward:{lumens:1,specialTitle:""}},{id:"share_publisher",name:"",description:" 3      100 ",category:"share",hidden:!1,condition:{type:"share_post_count",target:100,minLanterns:3},reward:{lumens:3,specialTitle:""}},{id:"share_archivist",name:" ",description:" 3      300 ",category:"share",hidden:!1,condition:{type:"share_post_count",target:300,minLanterns:3},reward:{lumens:5,specialTitle:" "}},{id:"streak_visitor",name:"",description:" 7 ",category:"streak",hidden:!1,condition:{type:"login_streak",target:7},reward:{lumens:0,specialTitle:""}},{id:"streak_regular",name:"",description:" 30 ",category:"streak",hidden:!1,condition:{type:"login_streak",target:30},reward:{lumens:0,specialTitle:""}},{id:"streak_resident",name:"",description:" 100 ",category:"streak",hidden:!1,condition:{type:"login_streak",target:100},reward:{lumens:0,specialTitle:""}},{id:"streak_pillar",name:"",description:" 365 ",category:"streak",hidden:!1,condition:{type:"login_streak",target:365},reward:{lumens:0,specialTitle:""}},{id:"captain_captain",name:"",description:" 100 ",category:"captain",hidden:!1,condition:{type:"follower_count",target:100},reward:{lumens:0,specialTitle:""}},{id:"economy_analyst",name:" ",description:"   5    40 ",category:"economy",hidden:!1,condition:{type:"category_quality_reply",target:40,minAverageLanterns:5},reward:{lumens:2,specialTitle:" "}},{id:"economy_expert",name:" ",description:"   10    150 ",category:"economy",hidden:!1,condition:{type:"category_quality_reply",target:150,minAverageLanterns:10},reward:{lumens:5,specialTitle:" "}},{id:"it_consultant",name:" ",description:"IT   5    40 ",category:"it",hidden:!1,condition:{type:"category_quality_reply",target:40,minAverageLanterns:5},reward:{lumens:2,specialTitle:" "}},{id:"it_expert",name:" ",description:"IT   10    150 ",category:"it",hidden:!1,condition:{type:"category_quality_reply",target:150,minAverageLanterns:10},reward:{lumens:5,specialTitle:" "}},{id:"language_tutor",name:" ",description:"   5    40 ",category:"language",hidden:!1,condition:{type:"category_quality_reply",target:40,minAverageLanterns:5},reward:{lumens:2,specialTitle:" "}},{id:"language_expert",name:" ",description:"   10    150 ",category:"language",hidden:!1,condition:{type:"category_quality_reply",target:150,minAverageLanterns:10},reward:{lumens:5,specialTitle:" "}},{id:"engineering_curious",name:" ",description:"    10 ",category:"explore",hidden:!1,condition:{type:"category_explore_count",target:10},reward:{lumens:1,specialTitle:" "}},{id:"engineering_focused",name:" ",description:"    40 ",category:"reply",hidden:!0,condition:{type:"single_category_posts",target:40},reward:{lumens:2,specialTitle:" "}},{id:"engineering_first_light",name:"  ",description:"    ",category:"lantern",hidden:!1,condition:{type:"category_first_lantern",target:1},reward:{lumens:1,specialTitle:"  "}},{id:"engineering_destroyer",name:" ",description:"   50 ",category:"reply",hidden:!1,condition:{type:"category_reply_count",target:50},reward:{lumens:3,specialTitle:" "}},{id:"explore_brave_questioner",name:"  ",description:"    5  -      ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:5},reward:{lumens:1,specialTitle:"  "}},{id:"explore_steady_questioner",name:" ",description:"    20  -   ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:20},reward:{lumens:2,specialTitle:" "}},{id:"reply_challenger",name:" ",description:" ,      10  -    ",category:"reply",hidden:!1,condition:{type:"reply_count",target:10},reward:{lumens:1,specialTitle:" "}},{id:"reply_persistent_helper",name:"  ",description:"    50  -     ",category:"reply",hidden:!1,condition:{type:"reply_count",target:50},reward:{lumens:3,specialTitle:"  "}},{id:"lantern_giver_small",name:" ",description:"    50  -     ",category:"lantern",hidden:!1,condition:{type:"lanterns_given",target:50},reward:{lumens:1,specialTitle:" "}},{id:"lantern_giver_captain",name:"",description:"    200  -    ",category:"lantern",hidden:!1,condition:{type:"lanterns_given",target:200},reward:{lumens:3,specialTitle:""}}],xd=[{id:"multi_specialist",name:" ",description:"3    ",category:"reply",hidden:!0,condition:{type:"multi_field_expert",target:3},reward:{lumens:10,specialTitle:" "}},{id:"discussion_expert",name:" ",description:"   15  ",category:"reply",hidden:!0,condition:{type:"discussion_exchanges",target:15},reward:{lumens:5,specialTitle:" "}},{id:"best_contributor",name:" ",description:"   100  ",category:"lantern",hidden:!0,condition:{type:"max_post_lanterns",target:100},reward:{lumens:10,specialTitle:" "}},{id:"community_fellow",name:" ",description:"   3  ",category:"guide",hidden:!0,condition:{type:"all_categories_tier3",target:1},reward:{lumens:15,specialTitle:" "}},{id:"honorary_scholar",name:" ",description:"   4() ",category:"guide",hidden:!0,condition:{type:"all_categories_tier4",target:1},reward:{lumens:50,specialTitle:" "}},{id:"lantern_giver",name:" ",description:"   500 ",category:"lantern",hidden:!0,condition:{type:"lanterns_given",target:500},reward:{lumens:3,specialTitle:" "}},{id:"diligent_visitor",name:" ",description:" 30  27  ",category:"streak",hidden:!0,condition:{type:"monthly_login_rate",target:27},reward:{lumens:0,specialTitle:" "}},{id:"popular_questioner",name:" ",description:"      30  ,     ",category:"explore",hidden:!0,condition:{type:"max_post_lanterns",target:30},reward:{lumens:2,specialTitle:" "}},{id:"specialized_replier",name:" ",description:"   300 ",category:"reply",hidden:!0,condition:{type:"single_category_replies",target:300},reward:{lumens:3,specialTitle:" "}}],gb=[...gd,...xd];function N1(n){return{guide:"",explore:"",share:" ",reply:"",lantern:"",streak:"",captain:"",economy:"",it:"IT",language:""}[n]}const pi={explorePosts:0,sharePosts:0,replies:0,qualityReplies:0,lanternsReceived:0,lanternsGiven:0,guideCount:0,bookmarks:0,loginStreak:0,maxPostReplies:0,maxPostLanterns:0,maxDiscussionExchanges:0,followerCount:0},Zc={ACHIEVED_ACHIEVEMENTS:"app_achieved_achievements",USER_ACTIVITY:"app_user_activity"};function E1(){if(typeof window>"u")return null;try{const n=window.localStorage.getItem(Zc.ACHIEVED_ACHIEVEMENTS),e=window.localStorage.getItem(Zc.USER_ACTIVITY);if(!n&&!e)return null;let t=[],s={...pi};if(n)try{const r=JSON.parse(n);Array.isArray(r)&&(t=r.map(a=>!a||typeof a!="object"||typeof a.achievementId!="string"||typeof a.achievedAt!="string"?null:{achievementId:a.achievementId,achievedAt:a.achievedAt,rewardClaimed:typeof a.rewardClaimed=="boolean"?a.rewardClaimed:!0}).filter(a=>a!==null))}catch(r){console.error("legacy achievedAchievements  :",r)}if(e)try{const r=JSON.parse(e);r&&typeof r=="object"&&(s={...pi,...r})}catch(r){console.error("legacy userActivity  :",r)}return{achieved:t,activity:s}}catch(n){return console.error("legacy    :",n),null}}function xb(n,e){const[t,s]=x.useState([]),[r,a]=x.useState(pi),[o,c]=x.useState(!1),u=x.useRef(!1),d=x.useCallback(C=>t.find(S=>S.achievementId===C),[t]);x.useEffect(()=>{const C=Ne.currentUser?.uid;if(!C)return;let S=!1;return(async()=>{try{const M=be(ae,"users",C),_=await Cn(M);if(_.exists()){const T=_.data(),A=T.userActivity&&typeof T.userActivity=="object"?{...pi,...T.userActivity}:{...pi};let N=[];Array.isArray(T.achievedAchievements)&&(N=T.achievedAchievements.filter(F=>F&&typeof F.achievementId=="string"&&typeof F.achievedAt=="string").map(F=>({achievementId:F.achievementId,achievedAt:F.achievedAt,rewardClaimed:typeof F.rewardClaimed=="boolean"?F.rewardClaimed:!0}))),S||(a(A),s(N));return}const y=E1(),b=y?.activity??{...pi},I=y?.achieved??[];if(S||(a(b),s(I)),await kn(M,{userActivity:b,achievedAchievements:I},{merge:!0}),y)try{window.localStorage.removeItem(Zc.USER_ACTIVITY),window.localStorage.removeItem(Zc.ACHIEVED_ACHIEVEMENTS)}catch{}}catch(M){console.error(" /   :",M)}finally{S||c(!0)}})(),()=>{S=!0}},[]),x.useEffect(()=>{const C=Ne.currentUser?.uid;if(!C||!o)return;if(!u.current){u.current=!0;return}const S=be(ae,"users",C);ct(S,{userActivity:r,achievedAchievements:t}).catch(D=>{console.error(" / Firestore  :",D)})},[r,t,o]);const h=x.useCallback(C=>t.some(S=>S.achievementId===C),[t]),m=x.useCallback((C,S)=>{const{condition:D}=C;switch(D.type){case"explore_post_count":return S.explorePosts>=D.target;case"share_post_count":return S.sharePosts>=D.target;case"quality_reply_count":return S.qualityReplies>=D.target;case"reply_count":return S.replies>=D.target;case"lanterns_received":return S.lanternsReceived>=D.target;case"lanterns_given":return S.lanternsGiven>=D.target;case"guide_count":return S.guideCount>=D.target;case"bookmark_count":return S.bookmarks>=D.target;case"login_streak":return S.loginStreak>=D.target;case"follower_count":return S.followerCount>=D.target;case"discussion_exchanges":return S.maxDiscussionExchanges>=D.target;case"max_post_lanterns":return S.maxPostLanterns>=D.target;case"category_quality_reply":return C.category==="economy"?(S.economyReplies||0)>=D.target&&(S.economyAverageLanterns||0)>=(D.minAverageLanterns||0):C.category==="it"?(S.itReplies||0)>=D.target&&(S.itAverageLanterns||0)>=(D.minAverageLanterns||0):C.category==="language"?(S.languageReplies||0)>=D.target&&(S.languageAverageLanterns||0)>=(D.minAverageLanterns||0):!1;case"multi_field_expert":return(S.unlockedFieldExpertCount||0)>=D.target;case"all_categories_tier3":return(S.tier3AchievementsCount||0)>=6;case"all_categories_tier4":return(S.tier4AchievementsCount||0)>=6;case"category_explore_count":return(S.engineeringExplorePosts||0)>=D.target;case"single_category_posts":return(S.engineeringOnlyPosts||0)>=D.target;case"category_first_lantern":return S.engineeringFirstLanternReceived===!0;case"category_reply_count":return(S.engineeringTotalReplies||0)>=D.target;case"monthly_login_rate":return(S.monthlyLoginDays||0)>=D.target;case"own_post_guide_selected":return(S.ownPostGuideSelected||0)>=D.target;case"single_category_replies":return(S.singleCategoryMaxReplies||0)>=D.target;default:return!1}},[]),p=x.useCallback(C=>{const S=t.find(I=>I.achievementId===C.id);if(S&&S.rewardClaimed)return;const{reward:D}=C,M=!S||!S.rewardClaimed;M&&(D.lumens>0&&n&&n(D.lumens,` : ${C.name}`,C.id),D.specialTitle&&e&&e(C.id,D.specialTitle));const _=new Date().toISOString(),y=S?{...S,achievedAt:S.achievedAt||_,rewardClaimed:!0}:{achievementId:C.id,achievedAt:_,rewardClaimed:!0};s(I=>{const T=I.findIndex(N=>N.achievementId===C.id);if(T===-1)return[...I,y];const A=[...I];return A[T]=y,A});let b=`${C.name}  !`;M&&(D.lumens>0&&D.specialTitle?b+=` ( ${D.lumens} +  "${D.specialTitle}" )`:D.lumens>0?b+=` ( ${D.lumens} )`:D.specialTitle&&(b+=` (  "${D.specialTitle}" )`)),C.hidden?J.success(`   ! 
${b}`,{duration:5e3}):J.success(` ${b}`,{duration:4e3})},[t,n,e]),w=x.useCallback(C=>{gb.forEach(S=>{h(S.id)||m(S,C)&&p(S)})},[m,p,h]),v=x.useCallback(C=>{a(S=>{const D={...S,...C};return setTimeout(()=>{w(D)},100),D})},[w]),j=t.filter(C=>gd.some(S=>S.id===C.achievementId)).length,k=t.filter(C=>xd.some(S=>S.id===C.achievementId)).length,P=gd.length,R=xd.length;return{achievedAchievements:t,userActivity:r,isAchievementUnlocked:h,getAchievementInfo:d,updateActivity:v,checkAchievements:w,achievedNormalCount:j,achievedHiddenCount:k,normalCount:P,hiddenCount:R}}function A1(){const[n,e]=x.useState([]);return x.useEffect(()=>{const t=sn(ae,"posts"),s=xs(t,sw("createdAt","desc")),r=Io(s,async a=>{const o=Ne.currentUser?.uid??null,c=await Promise.all(a.docs.map(async u=>{const d=u.data(),h=d.createdAt&&typeof d.createdAt.toDate=="function"?d.createdAt.toDate():d.createdAt instanceof Date?d.createdAt:new Date;let m=[];Array.isArray(d.replies)&&(m=d.replies.map(v=>{let j;if(v?.createdAt&&typeof v.createdAt.toDate=="function")j=v.createdAt.toDate();else if(v?.createdAt instanceof Date)j=v.createdAt;else if(typeof v?.createdAt=="string"||typeof v?.createdAt=="number"){const k=new Date(v.createdAt);j=Number.isNaN(k.getTime())?new Date:k}else j=new Date;return{id:typeof v.id=="number"||typeof v.id=="string"?v.id:Date.now(),content:v.content??"",author:v.author??"  ",authorUid:typeof v.authorUid=="string"?v.authorUid:null,authorAvatar:typeof v.authorAvatar=="string"?v.authorAvatar:null,timeAgo:v.timeAgo??"",lanterns:typeof v.lanterns=="number"?v.lanterns:0,isGuide:!!v.isGuide,createdAt:j,authorTitleId:v.authorTitleId??null}}));let p=null,w=null;if(d.authorUid)try{const v=be(ae,"users",d.authorUid),j=await Cn(v);if(j.exists()){const k=j.data();p=k.currentTitle??null,k.currentTitleName&&(w=k.currentTitleName)}}catch(v){console.error("    :",v)}return{id:u.id,title:d.title??"",content:d.content??"",category:d.category??"",subCategory:d.subCategory??"",type:d.type??"question",tags:Array.isArray(d.tags)?d.tags:[],author:d.author??"  ",authorUid:d.authorUid??null,authorAvatar:d.authorAvatar??"",createdAt:h,lanterns:d.lanterns??0,replies:m,replyCount:typeof d.replyCount=="number"?d.replyCount:m.length,comments:typeof d.comments=="number"?d.comments:m.length,views:d.views??0,isBookmarked:!1,isOwner:o&&d.authorUid?o===d.authorUid:!1,authorTitleId:p,authorTitleName:w}}));e(c)},a=>{console.error("Firestore   :",a)});return()=>r()},[]),{posts:n,setPosts:e}}function j1({viewedNickname:n,currentUserNickname:e}){const[t,s]=x.useState(null);return x.useEffect(()=>{if(!n||n===e){s(null);return}let r=!1;return(async()=>{try{s(k=>k?{...k,loading:!0}:{followerCount:0,followingCount:0,followerUsers:[],followingUsers:[],loading:!0});const o=sn(ae,"users"),c=xs(o,Kr("nickname","==",n)),u=await Sn(c);if(r)return;if(u.empty){console.warn("[follow]     :",n),s({followerCount:0,followingCount:0,followerUsers:[],followingUsers:[],loading:!1});return}const d=u.docs[0],m=d.data().uid??d.id,p=await ib(m);if(r)return;const w=p.followerCount??0,v=p.followingNicknames??[],j=await ab(m);if(r)return;s({followerCount:w,followingCount:v.length,followerUsers:Array.isArray(j)?j:[],followingUsers:v,loading:!1})}catch(o){r||(console.error("[follow]      :",o),s({followerCount:0,followingCount:0,followerUsers:[],followingUsers:[],loading:!1}))}})(),()=>{r=!0}},[n,e]),t}const Jo={stroke:"currentColor",fill:"none",display:"block",width:"20px",height:"20px"},k1={stroke:"#ffffff",fill:"none",display:"block",width:"24px",height:"24px"};function Mn({onHomeClick:n,onRankingClick:e,onBookmarksClick:t,onMyPageClick:s,onWriteClick:r,activeTab:a="home"}){const o=x.useCallback((p,w)=>{const v=w.currentTarget;v.blur(),setTimeout(()=>{v.style.backgroundColor="transparent",v.classList.remove("focus:bg-accent","focus-visible:bg-accent")},0),p()},[]),c=x.useCallback(p=>{o(n,p)},[o,n]),u=x.useCallback(p=>{o(e,p)},[o,e]),d=x.useCallback(p=>{r&&o(r,p)},[o,r]),h=x.useCallback(p=>{o(t,p)},[o,t]),m=x.useCallback(p=>{o(s,p)},[o,s]);return i.jsx("nav",{className:"bg-card/98 glass-effect border-t border-border flex-shrink-0 shadow-[0_-2px_8px_rgba(0,0,0,0.04)] dark:shadow-[0_-2px_8px_rgba(0,0,0,0.2)] safe-nav-bottom",children:i.jsx("div",{className:"px-2 py-2",children:i.jsxs("div",{className:"flex items-center justify-around max-w-md mx-auto",children:[i.jsxs(z,{variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${a==="home"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:c,children:[i.jsx(rv,{size:20,strokeWidth:2,style:Jo,className:`transition-transform duration-200 ${a==="home"?"scale-110":""}`}),i.jsx("span",{className:"text-xs font-medium",children:""})]}),i.jsxs(z,{variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${a==="ranking"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:u,children:[i.jsx(Ms,{size:20,strokeWidth:2,style:Jo,className:`transition-transform duration-200 ${a==="ranking"?"scale-110":""}`}),i.jsx("span",{className:"text-xs font-medium",children:""})]}),r&&i.jsxs(z,{className:"write-button rounded-full w-14 h-14 bg-primary hover:bg-primary/90 shadow-lg hover:shadow-xl relative overflow-hidden",onClick:d,children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/80 to-primary rounded-full"}),i.jsx(Td,{size:24,strokeWidth:2.5,style:k1,className:"relative z-10"})]}),i.jsxs(z,{variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${a==="bookmarks"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:h,children:[i.jsx(gi,{size:20,strokeWidth:2,style:Jo,className:`transition-transform duration-200 ${a==="bookmarks"?"scale-110":""}`}),i.jsx("span",{className:"text-xs font-medium",children:""})]}),i.jsxs(z,{variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${a==="profile"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:m,children:[i.jsx(iv,{size:20,strokeWidth:2,style:Jo,className:`transition-transform duration-200 ${a==="profile"?"scale-110":""}`}),i.jsx("span",{className:"text-xs font-medium",children:" "})]})]})})})}const Eo=(...n)=>n.filter(Boolean).join(" "),wu=Ub,C1=Fb,S1=Mb,yb=x.forwardRef(({className:n,...e},t)=>i.jsx(Mg,{ref:t,className:Eo("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...e}));yb.displayName=Mg.displayName;const gc=x.forwardRef(({className:n,children:e,...t},s)=>i.jsxs(S1,{children:[i.jsx(yb,{}),i.jsx(Ug,{ref:s,className:Eo("fixed left-1/2 top-1/2 z-50 -translate-x-1/2 -translate-y-1/2","w-[360px] max-w-[90vw]","rounded-lg border border-border bg-card p-6 shadow-lg outline-none","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-top-4 data-[state=open]:slide-in-from-top-4",n),...t,children:e})]}));gc.displayName=Ug.displayName;const xc=({className:n,...e})=>i.jsx("div",{className:Eo("flex flex-col space-y-1.5 text-center sm:text-left",n),...e});xc.displayName="DialogHeader";const yc=x.forwardRef(({className:n,...e},t)=>i.jsx(Fg,{ref:t,className:Eo("text-lg font-semibold leading-none tracking-tight",n),...e}));yc.displayName=Fg.displayName;const _c=x.forwardRef(({className:n,...e},t)=>i.jsx(Bg,{ref:t,className:Eo("text-sm text-muted-foreground",n),...e}));_c.displayName=Bg.displayName;function uf({className:n,...e}){return i.jsx(Gb,{"data-slot":"tabs",className:qe("flex flex-col gap-2",n),...e})}function df({className:n,...e}){return i.jsx(Hb,{"data-slot":"tabs-list",className:qe("bg-muted text-muted-foreground inline-flex h-11 w-fit items-center justify-center rounded-xl p-[3px] flex",n),...e})}function Ar({className:n,...e}){return i.jsx(Kb,{"data-slot":"tabs-trigger",className:qe("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-1 py-0.5 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",n),...e})}function jr({className:n,...e}){return i.jsx(Wb,{"data-slot":"tabs-content",className:qe("flex-1 outline-none",n),...e})}function Fn({className:n,...e}){return i.jsx(Qb,{"data-slot":"switch",className:qe("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",n),...e,children:i.jsx(Jb,{"data-slot":"switch-thumb",className:qe("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function yd({className:n,orientation:e="horizontal",decorative:t=!0,...s}){return i.jsx(Yb,{"data-slot":"separator-root",decorative:t,orientation:e,className:qe("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",n),...s})}const Ag="userSettings";function R1({onBack:n,isDarkMode:e,onToggleDarkMode:t,onShowPrivacy:s,onShowTerms:r,onShowGuidelines:a,onLogout:o,onShowOpenSourceLicenses:c,onShowAttributions:u}){const[d,h]=x.useState(!0),[m,p]=x.useState(!0),[w,v]=x.useState(!0),[j,k]=x.useState(!0),[P,R]=x.useState(!0);x.useEffect(()=>{try{const F=localStorage.getItem(Ag);if(!F)return;const Z=JSON.parse(F);typeof Z.notificationsEnabled=="boolean"&&h(Z.notificationsEnabled),typeof Z.newPostNotifications=="boolean"&&p(Z.newPostNotifications),typeof Z.replyNotifications=="boolean"&&v(Z.replyNotifications),typeof Z.lanternNotifications=="boolean"&&k(Z.lanternNotifications),typeof Z.autoSave=="boolean"&&R(Z.autoSave)}catch(F){console.error("Failed to load user settings",F)}},[]);const C=x.useCallback(F=>{const Z={notificationsEnabled:d,newPostNotifications:m,replyNotifications:w,lanternNotifications:j,autoSave:P,...F};try{localStorage.setItem(Ag,JSON.stringify(Z))}catch(Ee){console.error("Failed to save user settings",Ee)}},[d,m,w,j,P]),S=x.useCallback(F=>{h(F),C({notificationsEnabled:F})},[C]),D=x.useCallback(F=>{p(F),C({newPostNotifications:F})},[C]),M=x.useCallback(F=>{v(F),C({replyNotifications:F})},[C]),_=x.useCallback(F=>{k(F),C({lanternNotifications:F})},[C]),y=x.useCallback(F=>{R(F),C({autoSave:F})},[C]),b=x.useCallback(()=>{J.success(" ")},[]),I=x.useCallback(()=>{window.confirm("  ?     .")&&(J.success("  "),o())},[o]),[T,A]=x.useState(md()),N=x.useCallback(F=>{A(F),RR(F),J.success(F?"  ":"  ")},[]);return i.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-y-auto scrollbar-hide",children:[i.jsx("header",{className:"bg-background/95 backdrop-blur-xl border-b border-border sticky top-0 z-20 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",onClick:n,className:"hover:bg-accent",children:i.jsx(Et,{className:"w-5 h-5"})}),i.jsx("h1",{className:"text-lg font-medium",children:""})]})})}),i.jsxs("div",{className:"p-4 space-y-6",children:[i.jsxs($,{className:"bg-card border-border",children:[i.jsx(ge,{children:i.jsxs(ye,{className:"flex items-center space-x-2",children:[i.jsx(av,{className:"w-5 h-5"}),i.jsx("span",{children:" "})]})}),i.jsx(q,{className:"space-y-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[e?i.jsx(Ed,{className:"w-4 h-4"}):i.jsx(Nd,{className:"w-4 h-4"}),i.jsx(Mt,{className:"text-foreground",children:" "})]}),i.jsx("div",{className:"-m-2 p-2 inline-flex items-center",children:i.jsx(Fn,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11
                  [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5
                  [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:e,onCheckedChange:t})})]})})]}),i.jsxs($,{className:"bg-card border-border",children:[i.jsx(ge,{children:i.jsxs(ye,{className:"flex items-center space-x-2",children:[i.jsx(bc,{className:"w-5 h-5"}),i.jsx("span",{children:" "})]})}),i.jsxs(q,{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(Mt,{className:"text-foreground",children:" "}),i.jsx(Fn,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11
                [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5
                [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:d,onCheckedChange:S})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(ov,{className:"w-4 h-4 text-gray-700"}),i.jsx(Mt,{className:"text-gray-900",children:"  "})]}),i.jsx("p",{className:"text-xs text-gray-600 mt-1",children:'" "    '})]}),i.jsx(Fn,{checked:T,onCheckedChange:N})]}),d&&i.jsxs(i.Fragment,{children:[i.jsx(yd,{}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(Mt,{className:"text-foreground",children:"  "}),i.jsx(Fn,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11
                    [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5
                    [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:m,onCheckedChange:D})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(Mt,{className:"text-foreground",children:" "}),i.jsx(Fn,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11
                    [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5
                    [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:w,onCheckedChange:M})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(Mt,{className:"text-foreground",children:" "}),i.jsx(Fn,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11
                    [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5
                    [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:j,onCheckedChange:_})]})]})]})]}),i.jsxs($,{className:"bg-card border-border",children:[i.jsx(ge,{children:i.jsxs(ye,{className:"flex items-center space-x-2",children:[i.jsx(Xg,{className:"w-5 h-5"}),i.jsx("span",{children:" "})]})}),i.jsx(q,{className:"space-y-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx(Mt,{className:"text-foreground",children:" "}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"    "})]}),i.jsx(Fn,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11
                [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5
                [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:P,onCheckedChange:y})]})})]}),i.jsxs($,{className:"bg-card border-border",children:[i.jsx(ge,{children:i.jsxs(ye,{className:"flex items-center space-x-2 text-gray-900",children:[i.jsx(cv,{className:"w-5 h-5 text-gray-700"}),i.jsx("span",{children:" "})]})}),i.jsxs(q,{className:"space-y-3",children:[i.jsxs(z,{variant:"outline",className:"w-full justify-start",onClick:b,children:[i.jsx(lv,{className:"w-4 h-4 mr-2"})," "]}),i.jsxs(z,{variant:"destructive",className:"w-full justify-start bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:I,children:[i.jsx(Zg,{className:"w-4 h-4 mr-3"}),i.jsx("div",{className:"text-left",children:i.jsx("p",{className:"font-medium",children:" "})})]})]})]}),i.jsxs($,{className:"bg-card border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:" "})}),i.jsxs(q,{className:"space-y-3",children:[r&&i.jsx(z,{variant:"outline",className:"w-full justify-start bg-white border-gray-300 text-gray-900 hover:bg-gray-50",onClick:r,children:""}),s&&i.jsx(z,{variant:"outline",className:"w-full justify-start bg-white border-gray-300 text-gray-900 hover:bg-gray-50",onClick:s,children:" "}),a&&i.jsx(z,{variant:"outline",className:"w-full justify-start bg-white border-gray-300 text-gray-900 hover:bg-gray-50",onClick:a,children:" "}),c&&i.jsx(z,{variant:"outline",className:"w-full justify-start bg-white border-gray-300 text-gray-900 hover:bg-gray-50",onClick:c,children:" "}),u&&i.jsx(z,{variant:"outline",className:"w-full justify-start bg-white border-gray-300 text-gray-900 hover:bg-gray-50",onClick:u,children:" "})]})]}),i.jsxs($,{className:"bg-card border-border",children:[i.jsx(ge,{children:i.jsx(ye,{className:"text-gray-900",children:" "})}),i.jsxs(q,{className:"space-y-2",children:[i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:""}),i.jsx("span",{className:"",children:"1.0.0"})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:""}),i.jsx("span",{className:"",children:"2025.01.01"})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:""}),i.jsx("span",{className:"",children:" "})]})]})]})]})]})}function Ol({title:n,icon:e,onBack:t,rightSlot:s}){return i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[t&&i.jsx(z,{variant:"ghost",size:"icon",onClick:t,children:i.jsx(Et,{className:"w-5 h-5"})}),i.jsxs("div",{className:"flex items-center space-x-2",children:[e,i.jsx("h1",{className:"font-medium",children:n})]})]}),s&&i.jsx("div",{className:"flex items-center space-x-1",children:s})]})})})}function P1(n){return n<=10?"text-red-400":n<=30?"text-orange-400":n<=70?"text-emerald-400":"text-blue-400"}function D1(n){return n<=10?"     .      .":n<=30?"  .    ,    .":n<=70?" .       .":"  .    ,     ."}function V1({userNickname:n,userProfileImage:e="",onProfileImageChange:t,onBack:s,onLogout:r,isDarkMode:a,onToggleDarkMode:o,onShowPrivacy:c,onShowTerms:u,onShowGuidelines:d,onShowOpenSourceLicenses:h,onShowAttributions:m,userPosts:p=[],userReplies:w=[],bookmarkedPosts:v=[],currentTitle:j="",userGuideCount:k=0,trustScore:P=30,profileDescription:R="",onProfileDescriptionChange:C,onAchievementsClick:S,onTitlesCollectionClick:D,followerCount:M=0,followingCount:_=0,onFollowerCardClick:y,onFollowingCardClick:b,onMyPostsCardClick:I,onMyRepliesCardClick:T,onPostClick:A,onReplyClick:N,autoOpenSettings:F,onAutoSettingsOpened:Z}){const[Ee,xe]=x.useState(R);x.useEffect(()=>{xe(R)},[R]);const[K,ee]=x.useState(!1),[oe,Ae]=x.useState(""),je=80,[ke,De]=x.useState(!1);x.useEffect(()=>{F&&(De(!0),Z&&Z())},[F,Z]);const Re=Wr({key:"mypage"}),[Me,se]=x.useState(!1),[Ue,He]=x.useState(!1),Rt=x.useCallback(()=>{window.confirm(" ?")&&r()},[r]),Oe=x.useCallback(te=>{const Te=te.target.files?.[0];if(Te&&t){if(Te.size>5*1024*1024){J.error("  5MB  .");return}if(!Te.type.startsWith("image/")){J.error("   .");return}t(Te),J.success("  !")}},[t]),O=[{id:"guide_sprout",name:" ",requiredGuideCount:1},{id:"little_guide",name:" ",requiredGuideCount:1},{id:"ordinary_guide",name:" ",requiredGuideCount:5},{id:"kind_guide",name:" ",requiredGuideCount:15},{id:"famous_guide",name:" ",requiredGuideCount:30},{id:"master_on_path",name:"  ",requiredGuideCount:50},{id:"sherpa",name:"",requiredGuideCount:100},{id:"immortal_lantern",name:" ",requiredGuideCount:200}],ue=()=>O.find(Te=>Te.id===j)?.name||"",re=p,de=w,pe=x.useMemo(()=>!re||re.length===0?null:re.reduce((te,Te)=>{const Pe=typeof te?.lanterns=="number"?te.lanterns:0;return(typeof Te?.lanterns=="number"?Te.lanterns:0)>Pe?Te:te},re[0]),[re]),Ke=x.useMemo(()=>!de||de.length===0?null:de.reduce((te,Te)=>{const Pe=typeof te?.lanterns=="number"?te.lanterns:0;return(typeof Te?.lanterns=="number"?Te.lanterns:0)>Pe?Te:te},de[0]),[de]),W=v,he=Math.max(0,Math.min(100,P)),Be=P1(he),Pt=D1(he),Pn={postsCount:re.length,guidesReceived:k,commentsCount:de.length,bookmarksCount:W.length},Dn=p?[...p].sort((te,Te)=>(Te.lanterns||0)-(te.lanterns||0)).slice(0,1):[],es=w?[...w].sort((te,Te)=>(Te.lanterns||0)-(te.lanterns||0)).slice(0,1):[],ht=x.useCallback(async()=>{const te=oe.trim();if(!te){J.error("  .");return}if(te.length>je){J.error(` ${je}   .`);return}try{const Te=Ne.currentUser;if(!Te){J.error("  .");return}const Pe=be(ae,"users",Te.uid);await ct(Pe,{profileDescription:te}),xe(te),C?.(te),J.success("  !"),ee(!1),Ae("")}catch(Te){console.error("[MyPage]    ",Te),J.error("   .    .")}},[oe,C]),ze=x.useCallback(()=>{De(!1)},[]),ts=x.useCallback(te=>{const Te=te.target.value,Pe=te.nativeEvent?.isComposing;Ae(Pe?Te:Te.slice(0,je))},[]),ys=x.useCallback(()=>{ee(!1)},[]),Yi=x.useCallback(te=>{ee(te),te&&Ae(Ee)},[Ee]),Xi=x.useCallback(()=>{De(!0)},[]),ns=x.useCallback(()=>{Ae(te=>te.slice(0,je))},[]),nr=x.useCallback(()=>{I?I():se(!0)},[I]),In=x.useCallback(()=>{T?T():He(!0)},[T]),sr=x.useCallback(()=>{se(!1)},[]),Vn=x.useCallback(()=>{He(!1)},[]),tt=x.useCallback(te=>{se(!1),A?.(te)},[A]),_s=x.useCallback((te,Te)=>{He(!1),N?.(te,Te)},[N]),xn=x.useCallback(te=>{const Te=te.currentTarget.getAttribute("data-post-id");Te&&tt(Te)},[tt]),gt=x.useCallback(te=>{const Te=te.currentTarget.getAttribute("data-post-id"),Pe=te.currentTarget.getAttribute("data-reply-id");if(!Te||!Pe)return;const yn=Number(Pe);Number.isNaN(yn)||_s(Te,yn)},[_s]);return ke?i.jsx(R1,{onBack:ze,isDarkMode:a,onToggleDarkMode:o,onShowPrivacy:c,onShowTerms:u,onShowGuidelines:d,onShowOpenSourceLicenses:h,onShowAttributions:m,onLogout:r}):i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:[i.jsx(Ol,{title:"",onBack:s,rightSlot:i.jsx(z,{variant:"ghost",size:"icon",onClick:o,children:a?i.jsx(Nd,{className:"w-4 h-4"}):i.jsx(Ed,{className:"w-4 h-4"})})}),i.jsxs("div",{ref:Re,className:"flex-1 scroll-container scrollbar-hide p-4 pb-24 space-y-4",children:[i.jsx($,{children:i.jsx(q,{className:"p-6",children:i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsxs("div",{className:"relative",children:[i.jsxs(rn,{className:"w-20 h-20 rounded-full overflow-hidden",children:[e&&i.jsx(vn,{src:e,className:"w-full h-full object-cover"}),i.jsx(an,{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 text-white text-xl flex items-center justify-center rounded-full",children:n?.charAt(0)?.toUpperCase()||"?"})]}),i.jsxs("div",{className:"absolute -bottom-1 -right-1",children:[i.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"profile-image-upload",onChange:Oe}),i.jsx(z,{size:"icon",asChild:!0,className:"w-9 h-9 rounded-full cursor-pointer touch-target",children:i.jsx("label",{htmlFor:"profile-image-upload",children:i.jsx(uv,{className:"w-4 h-4"})})})]})]}),i.jsxs("div",{className:"flex-1 min-h-20 flex flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[i.jsx("h2",{className:"text-xl font-semibold truncate",children:n}),ue()&&i.jsx(me,{variant:"secondary",className:"text-xs shrink-0",children:ue()})]}),i.jsxs(wu,{open:K,onOpenChange:Yi,children:[i.jsx(C1,{asChild:!0,children:i.jsx(z,{variant:"ghost",size:"icon",className:"touch-target",children:i.jsx(dv,{className:"w-4 h-4"})})}),i.jsxs(gc,{children:[i.jsxs(xc,{children:[i.jsx(yc,{children:" "}),i.jsx(_c,{children:"  ,    ."})]}),i.jsx("div",{className:"space-y-4 py-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx(Mt,{htmlFor:"description",children:""}),i.jsx(To,{id:"description",placeholder:":        .",value:oe,onChange:ts,onCompositionEnd:ns,maxLength:je,className:"min-h-[100px]"}),i.jsxs("div",{className:"text-right text-xs text-muted-foreground",children:[oe.length,"/",je]})]})}),i.jsxs("div",{className:"flex justify-end space-x-2",children:[i.jsx(z,{variant:"outline",onClick:ys,children:""}),i.jsx(z,{onClick:ht,children:""})]})]})]})]}),Ee&&i.jsx("p",{className:"mt-1 text-sm text-muted-foreground whitespace-pre-wrap break-words leading-snug line-clamp-2",children:Ee})]})]})})}),i.jsx($,{className:"border-border/70 shadow-sm rounded-xl mt-3",children:i.jsxs(q,{className:"p-4 flex flex-col items-center text-center gap-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ex,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("span",{className:"text-sm font-medium",children:[""," ",i.jsxs("span",{className:`font-semibold ${Be}`,children:[Math.round(he),""]})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground leading-snug",children:Pt})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx($,{className:"cursor-pointer",onClick:y,children:i.jsxs(q,{className:"p-6 text-center",children:[i.jsx(Ti,{className:"w-6 h-6 mx-auto mb-2 text-amber-500"}),i.jsx("div",{className:"text-lg font-medium",children:M}),i.jsx("div",{className:"text-xs text-muted-foreground leading-snug",children:""})]})}),i.jsx($,{className:"cursor-pointer",onClick:b,children:i.jsxs(q,{className:"p-6 text-center",children:[i.jsx(vc,{className:"w-6 h-6 mx-auto mb-2 text-amber-500"}),i.jsx("div",{className:"text-lg font-medium",children:_}),i.jsx("div",{className:"text-xs text-muted-foreground leading-snug",children:" "})]})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx($,{className:"cursor-pointer hover:shadow-md transition-shadow active:scale-[0.98]",onClick:nr,children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(Bn,{className:"w-6 h-6 mx-auto mb-2 text-blue-500"}),i.jsx("div",{className:"text-lg font-medium",children:Pn.postsCount}),i.jsx("div",{className:"text-xs text-muted-foreground",children:" "})]})}),i.jsx($,{className:"cursor-pointer hover:shadow-md transition-shadow active:scale-[0.98]",onClick:In,children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(It,{className:"w-6 h-6 mx-auto mb-2 text-green-500"}),i.jsx("div",{className:"text-lg font-medium",children:Pn.commentsCount}),i.jsx("div",{className:"text-xs text-muted-foreground",children:""})]})}),i.jsx($,{children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(br,{className:"w-6 h-6 mx-auto mb-2 text-primary"}),i.jsx("div",{className:"text-lg font-medium",children:Pn.guidesReceived}),i.jsx("div",{className:"text-xs text-muted-foreground",children:""})]})}),i.jsx($,{children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(Gn,{className:"w-6 h-6 mx-auto mb-2 text-yellow-500"}),i.jsx("div",{className:"text-lg font-medium",children:Pn.bookmarksCount}),i.jsx("div",{className:"text-xs text-muted-foreground",children:""})]})})]}),i.jsxs(uf,{defaultValue:"posts",className:"w-full",children:[i.jsxs(df,{className:"grid w-full grid-cols-2",children:[i.jsxs(Ar,{value:"posts",className:"text-xs",children:[i.jsx(Bn,{className:"w-4 h-4 mr-1"})," "]}),i.jsxs(Ar,{value:"replies",className:"text-xs",children:[i.jsx(It,{className:"w-4 h-4 mr-1"})," "]})]}),i.jsx(jr,{value:"posts",className:"space-y-3 mt-4",children:pe?i.jsx($,{className:"hover:shadow-md transition-shadow cursor-pointer list-optimized","data-post-id":pe.id,onClick:xn,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(me,{variant:"outline",className:"text-xs",children:pe.subCategory}),i.jsx("span",{className:"text-xs text-muted-foreground",children:pe.timeAgo})]}),i.jsx("h3",{className:"font-medium text-sm",children:pe.title}),i.jsx("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(Tt,{className:"w-3 h-3 text-amber-500"}),i.jsx("span",{className:"text-xs text-amber-600",children:pe.lanterns})]}),i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(It,{className:"w-3 h-3 text-muted-foreground"}),i.jsx("span",{className:"text-xs text-muted-foreground",children:pe.comments})]})]})})]})})},pe.id):i.jsx($,{children:i.jsxs(q,{className:"p-8 text-center",children:[i.jsxs("div",{className:"relative mb-4",children:[i.jsx("div",{className:"absolute inset-0 bg-blue-500/30 dark:bg-blue-400/30 blur-2xl rounded-full"}),i.jsx("div",{className:"relative w-20 h-20 rounded-full bg-blue-100 dark:bg-blue-900/40 flex items-center justify-center border-4 border-blue-400 dark:border-blue-600 shadow-lg mx-auto",children:i.jsx(Bn,{className:"w-12 h-12 text-blue-900 dark:text-blue-200",strokeWidth:2.5})})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"   .     ."})]})})}),i.jsx(jr,{value:"replies",className:"space-y-3 mt-4",children:Ke?i.jsx($,{className:"hover:shadow-md transition-shadow cursor-pointer list-optimized","data-post-id":Ke.postId,"data-reply-id":Ke.id,onClick:gt,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("span",{className:"text-xs font-medium text-primary",children:[Ke.postAuthor,"  "]}),i.jsx("span",{className:"text-xs text-muted-foreground",children:Ke.timeAgo})]}),i.jsxs("h4",{className:"text-sm text-muted-foreground",children:['"',Ke.postTitle,'"']}),i.jsx("p",{className:"text-sm leading-relaxed",children:Ke.content}),i.jsxs("div",{className:"flex items-center space-x-1 pt-1",children:[i.jsx(Tt,{className:"w-3 h-3 text-amber-500"}),i.jsx("span",{className:"text-xs text-amber-600",children:Ke.lanterns})]})]})})},Ke.id):i.jsx($,{children:i.jsxs(q,{className:"p-8 text-center",children:[i.jsxs("div",{className:"relative mb-4",children:[i.jsx("div",{className:"absolute inset-0 bg-green-500/30 dark:bg-green-400/30 blur-2xl rounded-full"}),i.jsx("div",{className:"relative w-20 h-20 rounded-full bg-green-100 dark:bg-green-900/40 flex items-center justify-center border-4 border-green-400 dark:border-green-600 shadow-lg mx-auto",children:i.jsx(It,{className:"w-12 h-12 text-green-900 dark:text-green-200",strokeWidth:2.5})})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"   .       ."})]})})})]}),i.jsxs("div",{className:"space-y-2 mt-6",children:[D&&i.jsxs(z,{variant:"ghost",className:"w-full justify-start p-4 h-auto",onClick:D,children:[i.jsx($s,{className:"w-5 h-5 mr-3 text-purple-500"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium",children:" "}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"      ."})]})]}),S&&i.jsxs(z,{variant:"ghost",className:"w-full justify-start p-4 h-auto",onClick:S,children:[i.jsx(Ms,{className:"w-5 h-5 mr-3 text-amber-500"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium",children:""}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"      ."})]})]}),i.jsxs(z,{variant:"ghost",className:"w-full justify-start p-4 h-auto",onClick:Xi,children:[i.jsx(nl,{className:"w-5 h-5 mr-3"}),i.jsx("div",{className:"text-left",children:i.jsx("p",{className:"font-medium",children:""})})]}),i.jsxs(z,{variant:"ghost",className:"w-full justify-start p-4 h-auto text-destructive hover:text-destructive",onClick:Rt,children:[i.jsx(Kg,{className:"w-5 h-5 mr-3"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium",children:""}),i.jsx("p",{className:"text-sm text-muted-foreground",children:" "})]})]})]})]}),i.jsx(wu,{open:Me,onOpenChange:se,children:i.jsxs(gc,{className:"w-[340px] max-w-[90vw] max-h-[70vh] overflow-hidden flex flex-col",children:[i.jsxs(xc,{children:[i.jsx(yc,{children:" 3  "}),i.jsx(_c,{children:" 3    ."})]}),i.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 py-2",children:Dn.length>0?Dn.map(te=>i.jsx($,{"data-post-id":te.id,className:"cursor-pointer hover:shadow-md transition-shadow active:scale-[0.98]",onClick:xn,children:i.jsxs(q,{className:"p-3",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx(me,{variant:"outline",className:"text-xs",children:te.subCategory||te.category}),i.jsx("span",{className:"text-xs text-muted-foreground",children:te.timeAgo})]}),i.jsx("h4",{className:"text-sm font-medium line-clamp-2",children:te.title}),i.jsxs("div",{className:"flex items-center space-x-3 mt-2",children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(Tt,{className:"w-3 h-3 text-amber-500"}),i.jsx("span",{className:"text-xs text-amber-600",children:te.lanterns})]}),i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(It,{className:"w-3 h-3 text-muted-foreground"}),i.jsx("span",{className:"text-xs text-muted-foreground",children:te.comments})]})]})]})},te.id)):i.jsxs("div",{className:"py-8 text-center",children:[i.jsx(Bn,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground/40"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:" 3   "})]})}),i.jsx(z,{variant:"outline",onClick:sr,className:"mt-2",children:""})]})}),i.jsx(wu,{open:Ue,onOpenChange:He,children:i.jsxs(gc,{className:"w-[340px] max-w-[90vw] max-h-[70vh] overflow-hidden flex flex-col",children:[i.jsxs(xc,{children:[i.jsx(yc,{children:" 3  "}),i.jsx(_c,{children:" 3    ."})]}),i.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 py-2",children:es.length>0?es.map(te=>i.jsx($,{"data-post-id":te.postId,"data-reply-id":te.id,className:"cursor-pointer hover:shadow-md transition-shadow active:scale-[0.98]",onClick:gt,children:i.jsxs(q,{className:"p-3",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsxs("span",{className:"text-xs font-medium text-primary truncate max-w-[60%]",children:[te.postAuthor," "]}),i.jsx("span",{className:"text-xs text-muted-foreground",children:te.timeAgo})]}),i.jsxs("p",{className:"text-xs text-muted-foreground mb-1 line-clamp-1",children:['"',te.postTitle,'"']}),i.jsx("p",{className:"text-sm line-clamp-2",children:te.content}),i.jsxs("div",{className:"flex items-center space-x-1 mt-2",children:[i.jsx(Tt,{className:"w-3 h-3 text-amber-500"}),i.jsx("span",{className:"text-xs text-amber-600",children:te.lanterns})]})]})},te.id)):i.jsxs("div",{className:"py-8 text-center",children:[i.jsx(It,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground/40"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:" 3   "})]})}),i.jsx(z,{variant:"outline",onClick:Vn,className:"mt-2",children:""})]})})]})}function L1({onBack:n,categories:e,activeCategory:t,activeSubCategory:s,onCategorySelect:r,posts:a,onPostSelect:o}){const[c,u]=x.useState(""),[d,h]=x.useState("category"),m=Wr({key:`category-${d}`}),p=e.filter(_=>_.name.toLowerCase().includes(c.toLowerCase())||_.subCategories.some(y=>y.name.toLowerCase().includes(c.toLowerCase()))),w=a.filter(_=>_.title.toLowerCase().includes(c.toLowerCase())||_.content.toLowerCase().includes(c.toLowerCase())||_.author.toLowerCase().includes(c.toLowerCase())||_.tags&&_.tags.some(y=>y.toLowerCase().includes(c.toLowerCase()))),v=x.useCallback(_=>{r(_,""),n()},[r,n]),j=x.useCallback((_,y)=>{r(_,y),n()},[r,n]),k=x.useCallback(_=>{u(_.target.value)},[]),P=x.useCallback(()=>{h("category"),u("")},[]),R=x.useCallback(()=>{h("post"),u("")},[]),C=x.useCallback(_=>{o(_),n()},[o,n]),S=x.useCallback(_=>{const y=_.currentTarget.dataset.categoryId;y&&v(y)},[v]),D=x.useCallback(_=>{const y=_.currentTarget.dataset.categoryId,b=_.currentTarget.dataset.subCategoryId;y&&b&&j(y,b)},[j]),M=x.useCallback(_=>{const y=Number(_.currentTarget.dataset.postId),b=a.find(I=>I.id===y);b&&C(b)},[a,C]);return i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:i.jsxs("div",{className:"px-4 py-3",children:[i.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[i.jsx(z,{variant:"ghost",size:"icon",onClick:n,children:i.jsx(Et,{className:"w-5 h-5"})}),i.jsx("h1",{className:"font-medium",children:" "})]}),i.jsxs("div",{className:"flex space-x-2 mb-3",children:[i.jsx(z,{variant:d==="category"?"default":"outline",size:"sm",onClick:P,className:"flex-1",children:" "}),i.jsx(z,{variant:d==="post"?"default":"outline",size:"sm",onClick:R,className:"flex-1",children:" "})]}),i.jsxs("div",{className:"relative",children:[i.jsx(La,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Br,{type:"text",placeholder:d==="category"?" ...":" , ,  ...",value:c,onChange:k,className:"pl-10 h-9"})]})]})}),i.jsx("div",{ref:m,className:"flex-1 scroll-container scrollbar-hide",children:i.jsx("div",{className:"p-4 space-y-4",children:d==="category"?i.jsxs(i.Fragment,{children:[p.map(_=>{const y=_.icon,b=t===_.id;return i.jsx($,{className:`transition-all list-optimized ${b?"ring-2 ring-primary":""}`,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between cursor-pointer hover:bg-accent/50 p-3 rounded-md -m-2 touch-target","data-category-id":_.id,onClick:S,children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-primary/10 to-primary/20 flex items-center justify-center",children:i.jsx(y,{className:"w-5 h-5 text-primary"})}),i.jsx("div",{children:i.jsx("h3",{className:"font-medium",children:_.name})})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[b&&i.jsx(me,{variant:"default",className:"text-xs",children:""}),i.jsx(me,{variant:"secondary",className:"text-xs tabular-nums",children:_.count})]})]}),_.id!==""&&_.subCategories.length>1&&i.jsx("div",{className:"ml-4 space-y-2",children:i.jsx("div",{className:"border-l-2 border-border pl-4 space-y-2",children:_.subCategories.filter(I=>I.id!=="").filter(I=>c===""||I.name.toLowerCase().includes(c.toLowerCase())).map(I=>{const T=b&&s===I.id;return i.jsxs("div",{className:`flex items-center justify-between cursor-pointer hover:bg-accent/50 p-3 rounded-md transition-colors touch-target ${T?"bg-accent":""}`,"data-category-id":_.id,"data-sub-category-id":I.id,onClick:D,children:[i.jsx("div",{children:i.jsx("p",{className:"text-sm font-medium",children:I.name})}),i.jsx("div",{className:"flex items-center space-x-2",children:T&&i.jsx(me,{variant:"default",className:"text-xs",children:""})})]},I.id)})})})]})})},_.id)}),p.length===0&&c&&i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-muted-foreground",children:"  ."})})]}):i.jsxs(i.Fragment,{children:[w.map(_=>i.jsx($,{className:"cursor-pointer hover:shadow-md transition-shadow list-optimized","data-post-id":_.id,onClick:M,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(rn,{className:"w-8 h-8",children:i.jsx(an,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white",children:_.author.charAt(0).toUpperCase()})}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-sm",children:_.author}),i.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[i.jsx("span",{children:_.timeAgo}),i.jsx("span",{children:""}),i.jsx(me,{variant:"outline",className:"text-xs",children:_.subCategory})]})]})]})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium mb-2",children:_.title}),i.jsx("p",{className:"text-muted-foreground text-sm line-clamp-3 leading-relaxed",children:_.content})]}),i.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(Tt,{className:"w-4 h-4 text-amber-500"}),i.jsx("span",{className:"text-sm text-muted-foreground",children:_.lanterns})]}),i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(It,{className:"w-4 h-4 text-muted-foreground"}),i.jsx("span",{className:"text-sm text-muted-foreground",children:_.comments})]})]}),_.tags&&_.tags.length>0&&i.jsx("div",{className:"flex space-x-1",children:_.tags.slice(0,2).map(y=>i.jsxs(me,{variant:"secondary",className:"text-xs",children:["#",y]},y))})]})]})})},_.id)),w.length===0&&c&&i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-muted-foreground",children:"  ."})}),c===""&&i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-muted-foreground",children:" ."})})]})})})]})}function hf(){const[n,e]=x.useState({isVisible:!1,height:0});return x.useEffect(()=>{if(typeof window>"u")return;let t=window.visualViewport?.height||window.innerHeight;const s=()=>{if(window.visualViewport){const o=window.visualViewport.height,u=window.innerHeight-o,d=u>150;e({isVisible:d,height:d?u:0})}else{const o=window.innerHeight,c=t-o,u=c>150;e({isVisible:u,height:u?c:0})}},r=()=>{setTimeout(s,300)},a=()=>{setTimeout(()=>{e({isVisible:!1,height:0})},100)};return window.visualViewport?window.visualViewport.addEventListener("resize",s):window.addEventListener("resize",s),window.addEventListener("focusin",r),window.addEventListener("focusout",a),()=>{window.visualViewport?window.visualViewport.removeEventListener("resize",s):window.removeEventListener("resize",s),window.removeEventListener("focusin",r),window.removeEventListener("focusout",a)}},[]),n}function wc(n={}){const{enabled:e=!0,delay:t=300,offset:s=20,behavior:r="smooth",block:a="center"}=n,o=x.useRef(null);return x.useEffect(()=>{if(!e)return;const c=o.current;if(!c)return;const u=()=>{setTimeout(()=>{if(!c)return;const d=c.getBoundingClientRect(),h=d.top+window.scrollY,m=d.height,p=window.visualViewport?.height||window.innerHeight;if(d.bottom>p-s){const j=h-p/2+m/2;window.scrollTo({top:Math.max(0,j),behavior:r})}else c.scrollIntoView({behavior:r,block:a,inline:"nearest"})},t)};return c.addEventListener("focus",u),()=>{c.removeEventListener("focus",u)}},[e,t,s,r,a]),o}function _b({className:n,variant:e="outline",size:t="sm",showIcon:s=!0,text:r=""}){const{isVisible:a}=hf(),o=()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()};return a?i.jsxs(z,{type:"button",variant:e,size:t,onClick:o,className:qe("fixed bottom-4 right-4 z-50 shadow-lg","safe-nav-bottom","transition-all duration-200","animate-in slide-in-from-bottom-2",n),children:[s&&i.jsx(Jg,{className:"w-4 h-4"}),r&&i.jsx("span",{className:"ml-1",children:r})]}):null}function Ao(){const[n,e]=x.useState(typeof navigator<"u"?navigator.onLine:!0),[t,s]=x.useState(!1),[r,a]=x.useState({});return x.useEffect(()=>{const o=()=>{if("connection"in navigator){const h=navigator.connection;a({downlink:h?.downlink,effectiveType:h?.effectiveType,saveData:h?.saveData})}},c=()=>{e(!0),n||(s(!0),setTimeout(()=>s(!1),5e3)),o()},u=()=>{e(!1),o()},d=()=>{o()};return o(),window.addEventListener("online",c),window.addEventListener("offline",u),"connection"in navigator&&navigator.connection?.addEventListener("change",d),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",u),"connection"in navigator&&navigator.connection?.removeEventListener("change",d)}},[n]),{isOnline:n,wasOffline:t,...r}}const O1=vd("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function _d({className:n,variant:e,...t}){return i.jsx("div",{"data-slot":"alert",role:"alert",className:qe(O1({variant:e}),n),...t})}function va({className:n,...e}){return i.jsx("div",{"data-slot":"alert-description",className:qe("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",n),...e})}function M1({position:n="top",variant:e="banner",showReconnectButton:t=!0,onReconnect:s}){const{isOnline:r,wasOffline:a}=Ao(),[o,c]=x.useState(!r),[u,d]=x.useState(!1);x.useEffect(()=>{if(!r)c(!0),d(!1);else if(a){d(!0),c(!0);const m=setTimeout(()=>{c(!1),d(!1)},3e3);return()=>clearTimeout(m)}else c(!1),d(!1)},[r,a]);const h=()=>{s?s():window.location.reload()};return o?e==="badge"?i.jsx(me,{variant:r?"default":"destructive",className:qe("fixed z-50 flex items-center gap-1.5 px-3 py-1.5",n==="top"?"top-4 right-4":"bottom-4 right-4","animate-in slide-in-from-top-2 fade-in","safe-top"),children:r?i.jsxs(i.Fragment,{children:[i.jsx(tx,{className:"w-3.5 h-3.5"}),i.jsx("span",{className:"text-xs",children:""})]}):i.jsxs(i.Fragment,{children:[i.jsx(Zo,{className:"w-3.5 h-3.5"}),i.jsx("span",{className:"text-xs",children:""})]})}):e==="toast"?i.jsx("div",{className:qe("fixed z-50 left-1/2 -translate-x-1/2",n==="top"?"top-4 safe-top":"bottom-4 safe-nav-bottom","animate-in slide-in-from-top-2 fade-in"),children:i.jsx(_d,{className:qe("shadow-lg border-2",u?"bg-success/10 border-success text-success-foreground":"bg-destructive/10 border-destructive text-destructive-foreground"),children:i.jsx("div",{className:"flex items-center gap-3",children:u?i.jsxs(i.Fragment,{children:[i.jsx(Gf,{className:"w-5 h-5"}),i.jsx(va,{className:"text-sm font-medium",children:"  "})]}):i.jsxs(i.Fragment,{children:[i.jsx(Zo,{className:"w-5 h-5"}),i.jsx(va,{className:"text-sm font-medium",children:"  "})]})})})}):i.jsx("div",{className:qe("fixed left-0 right-0 z-50",n==="top"?"top-0 safe-top":"bottom-0 safe-nav-bottom","animate-in slide-in-from-top-2 fade-in"),children:i.jsx(_d,{className:qe("rounded-none border-x-0 border-t-0",u?"bg-success/10 border-success":"bg-destructive/10 border-destructive"),children:i.jsxs("div",{className:"flex items-center justify-between px-4",children:[i.jsx("div",{className:"flex items-center gap-3",children:u?i.jsxs(i.Fragment,{children:[i.jsx(Gf,{className:"w-5 h-5 text-success"}),i.jsxs("div",{children:[i.jsx(va,{className:"font-medium text-success",children:"  "}),i.jsx("p",{className:"text-xs text-success/80 mt-0.5",children:"     "})]})]}):i.jsxs(i.Fragment,{children:[i.jsx(Zo,{className:"w-5 h-5 text-destructive"}),i.jsxs("div",{children:[i.jsx(va,{className:"font-medium text-destructive",children:"  "}),i.jsx("p",{className:"text-xs text-destructive/80 mt-0.5",children:"    "})]})]})}),!u&&t&&i.jsxs(z,{size:"sm",variant:"outline",onClick:h,className:"flex items-center gap-1.5",children:[i.jsx(hv,{className:"w-3.5 h-3.5"}),i.jsx("span",{children:""})]})]})})}):null}function U1(){const{isOnline:n,effectiveType:e}=Ao();return i.jsx("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:n?i.jsxs(i.Fragment,{children:[i.jsx(tx,{className:"w-3.5 h-3.5 text-success"}),e&&i.jsx("span",{className:"hidden sm:inline",children:e==="4g"?"":e==="3g"?"":""})]}):i.jsxs(i.Fragment,{children:[i.jsx(Zo,{className:"w-3.5 h-3.5 text-destructive"}),i.jsx("span",{className:"hidden sm:inline",children:""})]})})}function F1(){const{isOnline:n,effectiveType:e,downlink:t}=Ao(),[s,r]=x.useState(!1);return x.useEffect(()=>{if(!n){r(!1);return}const a=e==="slow-2g"||e==="2g"||t!==void 0&&t<.5;r(a)},[n,e,t]),s?i.jsxs(_d,{variant:"default",className:"bg-warning/10 border-warning",children:[i.jsx(Zg,{className:"w-4 h-4 text-warning"}),i.jsxs(va,{className:"text-sm",children:[i.jsx("span",{className:"font-medium text-warning",children:"  "}),i.jsx("p",{className:"text-xs text-warning/80 mt-1",children:"     "})]})]}):null}function B1({onBack:n,posts:e,onPostSelect:t}){const[s,r]=x.useState(""),[a,o]=x.useState([]),[c,u]=x.useState([]),[d,h]=x.useState(!0),[m,p]=x.useState(!1),[w,v]=x.useState([]),[j,k]=x.useState(!1),[P]=x.useState(["AI","","","","","","","","","","","","",""]),[R,C]=x.useState(!1),S=s.trim().length>0,D=hf(),M=wc({delay:350,offset:80});x.useEffect(()=>{if(typeof window>"u"){u([]),h(!0),C(!0);return}let K=[],ee=!0;try{const ke=localStorage.getItem("recentSearches");if(ke){const De=JSON.parse(ke);Array.isArray(De)&&(K=De.filter(Re=>typeof Re=="string"))}}catch(ke){console.error("recentSearches  :",ke)}try{const ke=localStorage.getItem("searchAutoSave");ke!==null&&(ee=ke!=="false")}catch(ke){console.error("searchAutoSave  :",ke)}const oe=Ne.currentUser?.uid;if(!oe){u(K),h(ee),C(!0);return}let Ae=!1;const je=be(ae,"users",oe);return(async()=>{try{const ke=await Cn(je);if(ke.exists()){const Re=ke.data().searchSettings;if(Re&&typeof Re=="object"){const Me=typeof Re.autoSave=="boolean"?Re.autoSave:ee,se=Array.isArray(Re.recentSearches)?Re.recentSearches.filter(Ue=>typeof Ue=="string"):K;if(!Ae){u(se),h(Me);try{localStorage.setItem("recentSearches",JSON.stringify(se)),localStorage.setItem("searchAutoSave",Me.toString())}catch{}}}else Ae||(u(K),h(ee)),await ct(je,{searchSettings:{autoSave:ee,recentSearches:K}})}else Ae||(u(K),h(ee)),await kn(je,{searchSettings:{autoSave:ee,recentSearches:K}},{merge:!0})}catch(ke){console.error("  Firestore  :",ke),Ae||(u(K),h(ee))}finally{Ae||C(!0)}})(),()=>{Ae=!0}},[]);const _=x.useCallback(async(K,ee)=>{if(typeof window<"u")try{localStorage.setItem("recentSearches",JSON.stringify(K)),localStorage.setItem("searchAutoSave",ee.toString())}catch(ke){console.error("  localStorage  :",ke)}const oe=Ne.currentUser?.uid;if(!oe)return;const Ae=be(ae,"users",oe),je={autoSave:ee,recentSearches:K};try{await ct(Ae,{searchSettings:je})}catch(ke){console.error("  Firestore  :",ke)}},[]),y=x.useCallback(()=>{p(K=>!K)},[]),b=x.useCallback(K=>{r(K.target.value)},[]),I=x.useCallback(K=>{K&&K.style.setProperty("--dynamic-padding-bottom",D.isVisible?`${D.height}px`:"0px")},[D.isVisible,D.height]),T=x.useCallback(K=>{if(!K.trim()){o([]);return}const ee=K.toLowerCase().trim(),oe=e.filter(Ae=>{const je=Ae.title.toLowerCase(),ke=Ae.content.toLowerCase(),De=Ae.author.toLowerCase(),Re=Ae.category.toLowerCase(),Me=Ae.subCategory.toLowerCase(),se=Ae.tags.map(Ue=>Ue.toLowerCase());return je===ee||De===ee||Re===ee||Me===ee||se.some(Ue=>Ue===ee)||je.startsWith(ee)||De.startsWith(ee)||Re.startsWith(ee)||Me.startsWith(ee)||se.some(Ue=>Ue.startsWith(ee))?!0:je.includes(ee)||ke.includes(ee)||De.includes(ee)||Re.includes(ee)||Me.includes(ee)||se.some(Ue=>Ue.includes(ee))}).sort((Ae,je)=>{const ke=Ae.title.toLowerCase(),De=je.title.toLowerCase();return ke.startsWith(ee)&&!De.startsWith(ee)?-1:!ke.startsWith(ee)&&De.startsWith(ee)?1:je.lanterns!==Ae.lanterns?je.lanterns-Ae.lanterns:je.createdAt.getTime()-Ae.createdAt.getTime()});o(oe),k(!1)},[e]),A=x.useCallback(K=>{if(K.preventDefault(),!!s.trim()&&(T(s),d)){const ee=[s,...c.filter(oe=>oe!==s)].slice(0,10);u(ee),_(ee,d)}},[s,T,d,c,_]),N=x.useCallback(()=>{r(""),o([]),k(!1),n()},[n]),F=x.useCallback(K=>{r(K),T(K),k(!1)},[T]),Z=x.useCallback(K=>{r(K),T(K),k(!1)},[T]),Ee=x.useCallback(()=>{u([]),_([],d)},[d,_]),xe=x.useCallback(()=>{if(!d)h(!0),_(c,!0);else{let ee=c;c.length>0&&confirm(`   ?
    .`)&&(ee=[],u([])),h(!1),_(ee,!1)}},[d,c,_]);return R?i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:i.jsxs("div",{className:"px-4 py-3",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",onClick:N,children:i.jsx(Et,{className:"w-5 h-5"})}),i.jsx("h1",{className:"font-medium",children:""})]}),i.jsx(z,{variant:"ghost",size:"icon",onClick:y,children:i.jsx(nl,{className:"w-5 h-5"})})]}),i.jsxs("form",{onSubmit:A,className:"relative",children:[i.jsx(La,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Br,{ref:M,type:"text",placeholder:" , , ,  ...",value:s,onChange:b,className:"pl-10 h-10 input-keyboard-safe",autoFocus:!0})]}),m&&i.jsx("div",{className:"mt-3 p-3 bg-muted/30 rounded-lg border border-border",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium",children:"  "}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"   "})]}),i.jsx(Fn,{checked:d,onCheckedChange:xe})]})})]})}),i.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide keyboard-aware-container dynamic-container",ref:I,children:i.jsxs("div",{className:"p-4 pb-24",children:[i.jsx("div",{className:"mb-4",children:i.jsx(F1,{})}),S&&a.length>0&&i.jsxs("div",{className:"space-y-3",children:[i.jsx("div",{className:"flex items-center justify-between mb-4",children:i.jsxs("p",{className:"text-sm text-muted-foreground",children:["'",s,"'  ",a.length,"  "]})}),a.map(K=>i.jsx($,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>t(K),children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsxs(rn,{className:"w-8 h-8",children:[K.authorAvatar&&i.jsx(vn,{src:K.authorAvatar}),i.jsx(an,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white text-sm",children:K.author.charAt(0).toUpperCase()})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-sm",children:K.author}),i.jsx("p",{className:"text-xs text-muted-foreground",children:K.timeAgo})]})]}),i.jsx(me,{variant:"outline",className:"text-xs",children:K.subCategory})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium mb-2 text-sm",children:K.title}),i.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed line-clamp-3",children:K.content})]}),i.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(Tt,{className:"w-4 h-4 text-amber-500"}),i.jsx("span",{className:"text-xs text-muted-foreground",children:K.lanterns})]}),i.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",K.comments]})]}),K.tags.length>0&&i.jsx("div",{className:"flex flex-wrap gap-1",children:K.tags.slice(0,2).map(ee=>i.jsxs(me,{variant:"secondary",className:"text-xs",children:["#",ee]},ee))})]})]})})},K.id))]}),S&&a.length===0&&i.jsxs("div",{className:"text-center py-16 px-4",children:[i.jsxs("div",{className:"relative mb-6",children:[i.jsx("div",{className:"absolute inset-0 bg-slate-500/30 dark:bg-slate-400/30 blur-2xl rounded-full"}),i.jsx("div",{className:"relative w-24 h-24 rounded-full bg-slate-100 dark:bg-slate-700/40 flex items-center justify-center border-4 border-slate-400 dark:border-slate-600 shadow-lg mx-auto",children:i.jsx(La,{className:"w-14 h-14 text-slate-900 dark:text-slate-200",strokeWidth:2.5})})]}),i.jsxs("p",{className:"text-muted-foreground font-medium mb-1",children:["'",s,"'    ."]}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"  ."})]}),!S&&i.jsxs("div",{className:"space-y-6",children:[c.length>0&&i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("h2",{className:"font-medium flex items-center space-x-2",children:[i.jsx(fv,{className:"w-4 h-4"}),i.jsx("span",{children:" "})]}),i.jsx(z,{variant:"ghost",size:"sm",onClick:Ee,className:"text-muted-foreground hover:text-foreground",children:" "})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:c.map((K,ee)=>i.jsx(z,{variant:"outline",size:"sm",onClick:()=>Z(K),className:"text-xs h-8",children:K},ee))})]}),i.jsxs("div",{children:[i.jsxs("h2",{className:"font-medium mb-3 flex items-center space-x-2",children:[i.jsx(nx,{className:"w-4 h-4"}),i.jsx("span",{children:" "})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(K=>i.jsxs(z,{variant:"secondary",size:"sm",onClick:()=>F(K),className:"text-xs h-8",children:["#",K]},K))})]}),i.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[i.jsx("h3",{className:"font-medium mb-2 text-sm",children:" "}),i.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[i.jsx("li",{children:"   , ,    "}),i.jsx("li",{children:" #   "}),i.jsx("li",{children:"   "})]})]})]})]})}),i.jsx(_b,{})]}):i.jsx("div",{className:"w-full h-full flex items-center justify-center",children:i.jsx("span",{className:"text-sm text-muted-foreground",children:"   ..."})})}function el({open:n,onOpenChange:e,title:t,description:s,confirmText:r="",onConfirm:a,checkbox:o}){if(!n)return null;const c=()=>{a?.(),e(!1)},u=()=>{o&&o.onCheckedChange(!1),e(!1)};return i.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:i.jsxs($,{className:"w-full max-w-md",children:[i.jsxs(ge,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(ye,{className:"text-lg",children:t}),i.jsx(z,{variant:"ghost",size:"icon",onClick:u,children:i.jsx(Id,{className:"w-4 h-4"})})]}),i.jsxs(q,{className:"space-y-4",children:[i.jsx("p",{className:"text-muted-foreground",children:s}),o&&i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(yi,{id:"dont-show-again",checked:o.checked,onCheckedChange:o.onCheckedChange}),i.jsx("label",{htmlFor:"dont-show-again",className:"text-sm cursor-pointer",children:o.label})]}),i.jsxs("div",{className:"flex justify-end space-x-2",children:[i.jsx(z,{variant:"outline",onClick:u,children:""}),i.jsx(z,{onClick:c,children:r})]})]})]})})}const oi={getItem:n=>{try{return localStorage.getItem(n)}catch(e){return console.error("localStorage getItem error:",e),null}},setItem:(n,e)=>{try{localStorage.setItem(n,e)}catch(t){console.error("localStorage setItem error:",t)}},removeItem:n=>{try{localStorage.removeItem(n)}catch(e){console.error("localStorage removeItem error:",e)}}},$1=3600*1e3;function q1({onBack:n,onSubmit:e,categories:t}){const[s,r]=x.useState(""),[a,o]=x.useState(""),[c,u]=x.useState("question"),[d,h]=x.useState(""),[m,p]=x.useState(""),[w,v]=x.useState([]),[j,k]=x.useState(""),[P,R]=x.useState(!1),[C,S]=x.useState(!1),[D,M]=x.useState(!1),[_,y]=x.useState(null),[b,I]=x.useState(!0),T=x.useRef(null),A=x.useRef(!1),N=hf(),F=wc({delay:350,offset:100}),Z=wc({delay:350,offset:100}),Ee=wc({delay:350,offset:100}),{isOnline:xe}=Ao(),K=t.find(W=>W.id===d),ee=K?.subCategories||[],oe=b?"     .    1   .":"    .      .";x.useEffect(()=>{try{const W=oi.getItem("userSettings");if(!W)return;const he=JSON.parse(W);typeof he.autoSave=="boolean"&&I(he.autoSave)}catch(W){console.error("Failed to load userSettings in WriteScreen:",W)}},[]),x.useEffect(()=>{const W=oi.getItem("draftPost");if(W)try{const he=JSON.parse(W);if(he.savedAt){const Be=new Date(he.savedAt).getTime();if(!Be||Number.isNaN(Be)){oi.removeItem("draftPost");return}if(Date.now()-Be>$1){oi.removeItem("draftPost");return}}r(he.title||""),o(he.content||""),u(he.postType||"question"),h(he.category||""),p(he.subCategory||""),v(he.tags||[]),y(he.savedAt?new Date(he.savedAt):null),J.success("   .")}catch(he){console.error("Failed to load draft:",he)}},[]);const Ae=x.useCallback(()=>{if(!s.trim()&&!a.trim())return;const W={title:s,content:a,postType:c,category:d,subCategory:m,tags:w,savedAt:new Date().toISOString()};oi.setItem("draftPost",JSON.stringify(W)),y(new Date),A.current=!1},[s,a,c,d,m,w]);x.useEffect(()=>{if(!b){T.current&&clearTimeout(T.current);return}return(s.trim()||a.trim())&&(A.current=!0,T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{Ae()},3e3)),()=>{T.current&&clearTimeout(T.current)}},[s,a,c,d,m,w,Ae,b]);const je=x.useCallback(()=>{u("question")},[]),ke=x.useCallback(()=>{u("guide")},[]),De=x.useCallback(()=>{R(W=>!W)},[]),Re=x.useCallback(()=>{p("")},[]),Me=x.useCallback(W=>{r(W.target.value)},[]),se=x.useCallback(W=>{o(W.target.value)},[]),Ue=x.useCallback(()=>{S(W=>!W)},[]),He=x.useCallback(W=>{k(W.target.value)},[]),Rt=x.useCallback(W=>{W&&W.style.setProperty("--dynamic-padding-bottom",N.isVisible?`${N.height}px`:"0px")},[N.isVisible,N.height]),Oe=x.useCallback(()=>{oi.removeItem("draftPost"),A.current=!1},[]);x.useEffect(()=>{d&&p("")},[d]);const O=x.useCallback(()=>{if(!xe){J.error("  .    .");return}if(!s.trim()){J.error(" .");return}if(!a.trim()){J.error(" .");return}if(!d){J.error(" .");return}if(Bs(s)){J.error("    ");return}if(Bs(a)){J.error("    ");return}if(w.some(W=>Bs(W))){J.error("    ");return}e({title:s.trim(),content:a.trim(),category:d,subCategory:m,type:c,tags:w}),Oe()},[xe,s,a,d,c,m,w,e,Oe]),ue=x.useCallback(()=>{s.trim()||a.trim()?M(!0):(Oe(),n())},[s,a,n,Oe]),re=x.useCallback(()=>{M(!1),b||Oe(),n()},[n,b,Oe]),de=x.useCallback(()=>{const W=j.trim();if(W){if(Bs(W)){J.error("    .");return}if(w.includes(W)){J.error("  .");return}if(w.length>=5){J.error("  5   .");return}v([...w,W]),k("")}},[j,w]),pe=x.useCallback(W=>{v(w.filter(he=>he!==W))},[w]),Ke=x.useCallback(W=>{W.key==="Enter"&&(W.preventDefault(),de())},[de]);return i.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-hidden flex flex-col",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",onClick:ue,children:i.jsx(Et,{className:"w-5 h-5"})}),i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h1",{className:"font-medium",children:"  "}),i.jsx(U1,{})]}),_&&i.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[i.jsx(mv,{className:"w-3 h-3"}),new Date().getTime()-_.getTime()<6e4?" ":`${Math.floor((new Date().getTime()-_.getTime())/6e4)}  `]})]})]}),i.jsxs(z,{onClick:O,className:"flex items-center space-x-2",disabled:!s.trim()||!a.trim()||!d||!xe,children:[i.jsx(Qg,{className:"w-4 h-4"}),i.jsx("span",{children:""})]})]})})}),i.jsx("main",{className:"flex-1 overflow-y-auto scrollbar-hide keyboard-aware-container dynamic-container",ref:Rt,children:i.jsxs("div",{className:"p-4 space-y-4 pb-24",children:[i.jsx($,{children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"text-sm font-medium",children:" "}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs(z,{variant:c==="question"?"default":"outline",onClick:je,className:"flex items-center space-x-2 h-12",children:[i.jsx(It,{className:"w-4 h-4"}),i.jsx("span",{children:""})]}),i.jsxs(z,{variant:c==="guide"?"default":"outline",onClick:ke,className:"flex items-center space-x-2 h-12",children:[i.jsx(br,{className:"w-4 h-4"}),i.jsx("span",{children:""})]})]})]})})}),i.jsx($,{children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("label",{className:"text-sm font-medium",children:""}),i.jsxs(z,{variant:"ghost",size:"sm",onClick:De,className:"flex items-center space-x-1",children:[i.jsx(Hf,{className:"w-4 h-4"}),i.jsx("span",{children:""})]})]}),P&&i.jsxs("div",{className:"space-y-3 border-2 border-primary bg-muted/30 p-4 rounded-lg",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"text-xs text-muted-foreground",children:"  "}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:t.filter(W=>W.id!=="").map(W=>i.jsx(z,{variant:d===W.id?"default":"outline",onClick:()=>h(W.id),className:"h-auto py-3",children:W.name},W.id))})]}),d&&d!==""&&ee.length>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"text-xs text-muted-foreground",children:"   ()"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsx(z,{variant:m===""?"default":"outline",onClick:Re,size:"sm",children:""}),ee.filter(W=>W.id!=="").map(W=>i.jsx(z,{variant:m===W.id?"default":"outline",onClick:()=>p(W.id),size:"sm",children:W.name},W.id))]})]})]}),d&&i.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[i.jsx(Hf,{className:"w-4 h-4"}),i.jsxs("span",{children:[K?.name,d!==""&&m&&m!==""&&ee.find(W=>W.id===m)&&` > ${ee.find(W=>W.id===m)?.name}`]})]})]})})}),i.jsx($,{children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"text-sm font-medium",children:""}),i.jsx(Br,{ref:F,value:s,onChange:Me,placeholder:" ",maxLength:100,className:"input-keyboard-safe"}),i.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[s.length,"/100"]})]})})}),i.jsx($,{children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"text-sm font-medium",children:""}),i.jsx(To,{ref:Z,value:a,onChange:se,placeholder:" ",className:"min-h-[200px] resize-none input-keyboard-safe",maxLength:2e3}),i.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[a.length,"/2000"]}),i.jsx("div",{className:"pt-2 border-t border-border/50",children:i.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:" ,                 ."})})]})})}),i.jsx($,{children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("label",{className:"text-sm font-medium",children:""}),i.jsxs(z,{variant:"ghost",size:"sm",onClick:Ue,className:"flex items-center space-x-1",children:[i.jsx(Nu,{className:"w-4 h-4"}),i.jsx("span",{children:""})]})]}),C&&i.jsxs("div",{className:"flex space-x-2",children:[i.jsx(Br,{ref:Ee,value:j,onChange:He,onKeyPress:Ke,placeholder:"  ( 5)",maxLength:20,disabled:w.length>=5,className:"input-keyboard-safe"}),i.jsx(z,{onClick:de,disabled:!j.trim()||w.length>=5,size:"sm",children:i.jsx(Td,{className:"w-4 h-4"})})]}),w.length>0&&i.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(W=>i.jsxs(me,{variant:"secondary",className:"flex items-center space-x-1 px-2 py-1",children:[i.jsxs("span",{children:["#",W]}),i.jsx(z,{variant:"ghost",size:"sm",onClick:()=>pe(W),className:"h-auto p-1 hover:bg-transparent touch-extended ml-1",children:i.jsx(Id,{className:"w-3 h-3"})})]},W))}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"  5   ."})]})})})]})}),i.jsx(_b,{}),i.jsx(el,{open:D,onOpenChange:M,title:" ?",description:oe,confirmText:"",onConfirm:re})]})}function z1({onBack:n,userReplyLanterns:e,userGuideCount:t,userLumens:s,ownedTitles:r,currentTitle:a,onTitlePurchase:o,onTitleEquip:c}){const u=[{id:"guide_sprout",name:" ",description:"    ",cost:0,tier:1,icon:Gn,requiredReplyLanterns:0,requiredGuideCount:1,color:"text-green-500"},{id:"little_guide",name:" ",description:"     ",cost:3,tier:1,icon:Gn,requiredReplyLanterns:0,requiredGuideCount:1,color:"text-green-500"},{id:"ordinary_guide",name:" ",description:"      ",cost:8,tier:2,icon:$s,requiredReplyLanterns:0,requiredGuideCount:5,color:"text-blue-500"},{id:"kind_guide",name:" ",description:"      ",cost:15,tier:3,icon:Ia,requiredReplyLanterns:20,requiredGuideCount:15,color:"text-purple-500"},{id:"famous_guide",name:" ",description:"      ",cost:25,tier:4,icon:xi,requiredReplyLanterns:50,requiredGuideCount:30,color:"text-orange-500"},{id:"master_on_path",name:"  ",description:"       ",cost:40,tier:5,icon:br,requiredReplyLanterns:100,requiredGuideCount:50,color:"text-red-500"},{id:"sherpa",name:"",description:"     ",cost:60,tier:6,icon:pv,requiredReplyLanterns:200,requiredGuideCount:100,color:"text-amber-500"},{id:"immortal_lantern",name:"",description:"     ",cost:80,tier:7,icon:Tt,requiredReplyLanterns:400,requiredGuideCount:200,color:"text-yellow-500"},{id:"curiosity_spark",name:" ",description:"     ",cost:5,tier:1,icon:Ia,requiredReplyLanterns:5,requiredGuideCount:1,color:"text-amber-500"},{id:"truth_seeker",name:" ",description:"     ",cost:10,tier:2,icon:br,requiredReplyLanterns:15,requiredGuideCount:3,color:"text-blue-500"},{id:"thought_architect",name:" ",description:"     ",cost:15,tier:3,icon:$s,requiredReplyLanterns:40,requiredGuideCount:5,color:"text-blue-500"},{id:"insight_collector",name:" ",description:"     ",cost:20,tier:3,icon:xi,requiredReplyLanterns:70,requiredGuideCount:7,color:"text-orange-500"},{id:"knowledge_sage",name:" ",description:"     ",cost:30,tier:4,icon:$s,requiredReplyLanterns:110,requiredGuideCount:10,color:"text-purple-500"},{id:"discussion_maestro",name:" ",description:"      ",cost:35,tier:4,icon:xi,requiredReplyLanterns:150,requiredGuideCount:10,color:"text-red-500"},{id:"wisdom_lighthouse",name:" ",description:"      ",cost:45,tier:5,icon:Tt,requiredReplyLanterns:200,requiredGuideCount:30,color:"text-amber-500"},{id:"philosopher_soul",name:" ",description:"    ",cost:50,tier:5,icon:Ia,requiredReplyLanterns:250,requiredGuideCount:40,color:"text-purple-500"}],d=m=>!(r.includes(m.id)||m.requiredReplyLanterns>e||m.requiredGuideCount>t||m.cost>s),h=m=>{if(m.cost>s){J.error(` ! (: ${m.cost}, : ${s})`);return}if(m.requiredReplyLanterns>e){J.error(`  ! (: ${m.requiredReplyLanterns})`);return}if(m.requiredGuideCount>t){J.error(`  ! (: ${m.requiredGuideCount})`);return}o(m.id,m.cost)};return i.jsxs("div",{className:"w-full h-full bg-background flex flex-col",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"sm",onClick:n,className:"p-0 h-8 w-8",children:i.jsx(Et,{className:"h-5 w-5"})}),i.jsx("h1",{className:"text-lg font-bold",children:" "})]}),i.jsxs("div",{className:"flex items-center space-x-2 bg-amber-500/10 px-3 py-1.5 rounded-full",children:[i.jsx("span",{className:"text-amber-500 text-lg"}),i.jsx("span",{className:"font-bold text-amber-500",children:s}),i.jsx("span",{className:"text-xs text-muted-foreground",children:""})]})]})})}),i.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide p-4 space-y-3",children:u.map(m=>{const p=r.includes(m.id),w=a===m.id,v=d(m),j=m.cost>s;return i.jsx($,{className:w?"border-2 border-primary":"",children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[i.jsx("h3",{className:"font-bold",children:m.name}),w&&i.jsx(me,{variant:"default",className:"text-xs",children:" "})]}),i.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:m.description}),i.jsxs("div",{className:"flex items-center space-x-3 text-xs",children:[i.jsxs("div",{className:`flex items-center space-x-1 ${j?"text-red-500":"text-amber-500"}`,children:[i.jsx("span",{}),i.jsxs("span",{className:"font-medium",children:[m.cost," "]})]}),m.requiredReplyLanterns>0&&i.jsxs("div",{className:`flex items-center space-x-1 ${m.requiredReplyLanterns>e?"text-red-500":"text-muted-foreground"}`,children:[i.jsx(Tt,{className:"w-3 h-3"}),i.jsx("span",{children:m.requiredReplyLanterns})]}),m.requiredGuideCount>0&&i.jsxs("div",{className:`flex items-center space-x-1 ${m.requiredGuideCount>t?"text-red-500":"text-muted-foreground"}`,children:[i.jsx(br,{className:"w-3 h-3"}),i.jsx("span",{children:m.requiredGuideCount})]})]})]}),i.jsx("div",{className:"ml-4",children:p?w?i.jsxs(me,{variant:"outline",className:"text-xs",children:[i.jsx(to,{className:"w-3 h-3 mr-1"})," "]}):i.jsx(z,{size:"sm",variant:"outline",onClick:()=>c(m.id),children:""}):i.jsx(z,{size:"sm",disabled:!v,onClick:()=>h(m),className:j?"opacity-50":"",children:j?i.jsxs(i.Fragment,{children:[i.jsx(Ta,{className:"w-3 h-3 mr-1"})," "]}):v?i.jsx(i.Fragment,{children:""}):i.jsxs(i.Fragment,{children:[i.jsx(Ta,{className:"w-3 h-3 mr-1"}),""]})})})]})})},m.id)})})]})}const bu=[{id:"guide_sprout",name:" ",description:"    ",price:0,type:"shop",requiredReplyLanterns:0,requiredGuideCount:1},{id:"little_guide",name:" ",description:"     ",price:3,type:"shop",requiredReplyLanterns:0,requiredGuideCount:1},{id:"ordinary_guide",name:" ",description:"      ",price:8,type:"shop",requiredReplyLanterns:0,requiredGuideCount:5},{id:"kind_guide",name:" ",description:"      ",price:15,type:"shop",requiredReplyLanterns:20,requiredGuideCount:15},{id:"famous_guide",name:" ",description:"      ",price:25,type:"shop",requiredReplyLanterns:50,requiredGuideCount:30},{id:"master_on_path",name:"  ",description:"       ",price:40,type:"shop",requiredReplyLanterns:100,requiredGuideCount:50},{id:"sherpa",name:"",description:"     ",price:60,type:"shop",requiredReplyLanterns:200,requiredGuideCount:100},{id:"immortal_lantern",name:"",description:"     ",price:80,type:"shop",requiredReplyLanterns:400,requiredGuideCount:200},{id:"curiosity_spark",name:" ",description:"     ",price:5,type:"shop",requiredReplyLanterns:5,requiredGuideCount:1},{id:"truth_seeker",name:" ",description:"     ",price:10,type:"shop",requiredReplyLanterns:15,requiredGuideCount:3},{id:"thought_architect",name:" ",description:"     ",price:15,type:"shop",requiredReplyLanterns:40,requiredGuideCount:5},{id:"insight_collector",name:" ",description:"     ",price:20,type:"shop",requiredReplyLanterns:70,requiredGuideCount:7},{id:"knowledge_sage",name:" ",description:"     ",price:30,type:"shop",requiredReplyLanterns:110,requiredGuideCount:10},{id:"discussion_maestro",name:" ",description:"      ",price:35,type:"shop",requiredReplyLanterns:150,requiredGuideCount:10},{id:"wisdom_lighthouse",name:" ",description:"      ",price:45,type:"shop",requiredReplyLanterns:200,requiredGuideCount:30},{id:"philosopher_soul",name:" ",description:"    ",price:50,type:"shop",requiredReplyLanterns:250,requiredGuideCount:40}],jg=[{id:"explore_brave_questioner",name:"  ",description:"    5  -      ",type:"achievement"},{id:"explore_steady_questioner",name:" ",description:"    20  -   ",type:"achievement"},{id:"explore_seeker",name:"",description:"  10 ",type:"achievement"},{id:"explore_inquirer",name:"",description:"  30 ",type:"achievement"},{id:"explore_investigator",name:"",description:"  100 ",type:"achievement"},{id:"explore_philosopher",name:"",description:"  300 ",type:"achievement"},{id:"reply_challenger",name:" ",description:" ,      10  -    ",type:"achievement"},{id:"reply_persistent_helper",name:"  ",description:"    50  -     ",type:"achievement"},{id:"reply_helper",name:"",description:" 10    10 ",type:"achievement"},{id:"reply_advisor",name:"",description:" 10    30 ",type:"achievement"},{id:"reply_mentor",name:"",description:" 10    100 ",type:"achievement"},{id:"reply_scholar",name:"",description:" 10    300 ",type:"achievement"},{id:"guide_guide",name:"",description:" 5 ",type:"achievement"},{id:"guide_navigator",name:"",description:" 20 ",type:"achievement"},{id:"guide_pathfinder",name:"",description:" 50 ",type:"achievement"},{id:"guide_luminary",name:"",description:" 100 ",type:"achievement"},{id:"lantern_candle",name:"",description:" 50 ",type:"achievement"},{id:"lantern_campfire",name:"",description:" 200 ",type:"achievement"},{id:"lantern_lantern",name:"",description:" 500 ",type:"achievement"},{id:"lantern_furnace",name:"",description:" 1500 ",type:"achievement"},{id:"lantern_giver_small",name:" ",description:"    50  -     ",type:"achievement"},{id:"lantern_giver_captain",name:"",description:"    200  -    ",type:"achievement"},{id:"share_sharer",name:"",description:" 3      10 ",type:"achievement"},{id:"share_curator",name:"",description:" 3      30 ",type:"achievement"},{id:"share_publisher",name:"",description:" 3      100 ",type:"achievement"},{id:"share_archivist",name:" ",description:" 3      300 ",type:"achievement"},{id:"streak_visitor",name:"",description:" 7 ",type:"achievement"},{id:"streak_regular",name:"",description:" 30 ",type:"achievement"},{id:"streak_resident",name:"",description:" 100 ",type:"achievement"},{id:"streak_pillar",name:"",description:" 365 ",type:"achievement"},{id:"captain_captain",name:"",description:" 100 ",type:"achievement"},{id:"economy_analyst",name:" ",description:"   5    20 ",type:"achievement"},{id:"economy_expert",name:" ",description:"   10    100 ",type:"achievement"},{id:"it_consultant",name:" ",description:"IT   5    20 ",type:"achievement"},{id:"it_expert",name:" ",description:"IT   10    100 ",type:"achievement"},{id:"language_tutor",name:" ",description:"   5    20 ",type:"achievement"},{id:"language_expert",name:" ",description:"   10    100 ",type:"achievement"},{id:"multi_specialist",name:" ",description:"3    ",type:"achievement",isHidden:!0},{id:"discussion_expert",name:" ",description:"   15  ",type:"achievement",isHidden:!0},{id:"best_contributor",name:" ",description:"   100  ",type:"achievement",isHidden:!0},{id:"community_fellow",name:" ",description:"   3  ",type:"achievement",isHidden:!0},{id:"honorary_scholar",name:" ",description:"   4() ",type:"achievement",isHidden:!0},{id:"lantern_giver",name:" ",description:"   500 ",type:"achievement",isHidden:!0},{id:"engineering_curious",name:" ",description:"    10 ",type:"achievement"},{id:"engineering_focused",name:" ",description:"    40 ",type:"achievement",isHidden:!0},{id:"engineering_first_light",name:"  ",description:"    ",type:"achievement"},{id:"engineering_destroyer",name:" ",description:"   50 ",type:"achievement"},{id:"diligent_visitor",name:" ",description:" 30  27  ",type:"achievement",isHidden:!0},{id:"popular_questioner",name:" ",description:"      30  ,     ",type:"achievement",isHidden:!0},{id:"specialized_replier",name:" ",description:"   200 ",type:"achievement",isHidden:!0}];function G1({onBack:n,userTitles:e,equippedTitle:t,onTitleEquip:s,onTitleUnequip:r}){const a=jg.filter(m=>!m.isHidden),c=jg.filter(m=>m.isHidden).filter(m=>e.includes(m.id)),u=[...bu,...a,...c],d=u.length,h=e.filter(m=>u.some(p=>p.id===m)).length;return i.jsxs("div",{className:"w-full h-full bg-background flex flex-col",children:[i.jsx("header",{className:"bg-card/98 glass-effect border-b border-border/60 flex-shrink-0 z-40 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200",onClick:n,children:i.jsx(Et,{className:"h-5 w-5"})}),i.jsx("h1",{className:"text-lg font-bold",children:" "})]})})})}),i.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-hide p-4 space-y-6",children:[i.jsx($,{className:"bg-purple-50 dark:bg-purple-950/20 border-purple-200 dark:border-purple-800 min-h-[120px]",children:i.jsx(q,{className:"p-6",children:i.jsxs("div",{className:"flex items-center justify-between min-h-[72px]",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($s,{className:"w-5 h-5 text-yellow-500"}),i.jsx("span",{className:"text-lg font-bold text-gray-100 dark:text-gray-100",children:" "})]}),i.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[" : ",h,"/",d]})]}),i.jsxs("div",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:[d>0?Math.round(h/d*100):0,"%"]})]})})}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-2 px-1",children:[i.jsx(Yg,{className:"w-5 h-5 text-gray-300 dark:text-gray-300"}),i.jsx("h3",{className:"text-lg font-bold text-gray-300 dark:text-gray-400",children:" "}),i.jsxs(me,{variant:"outline",className:"text-xs",children:[bu.length,""]})]}),i.jsx("div",{className:"space-y-2",children:bu.map(m=>{const p=e.includes(m.id),w=t===m.id;return i.jsx($,{className:`transition-all min-h-[88px] ${p?"border-purple-200 dark:border-purple-800 bg-purple-50 dark:bg-purple-950/10":"opacity-50 bg-gray-50 dark:bg-gray-900/20"}`,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"flex items-center justify-between gap-3 min-h-[56px]",children:[i.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[i.jsx("div",{className:`p-2 rounded-lg ${p?"bg-purple-100 dark:bg-purple-900/30":"bg-gray-200 dark:bg-gray-800"}`,children:i.jsx(Ms,{className:`w-5 h-5 ${p?"text-purple-600 dark:text-purple-400":"text-gray-400 dark:text-gray-600"}`})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("span",{className:"font-bold truncate text-gray-300 dark:text-gray-400",children:m.name}),w&&i.jsx(me,{variant:"default",className:"text-xs bg-purple-600 text-white shrink-0",children:" "})]}),i.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:m.description}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Ia,{className:"w-3 h-3 text-amber-500"}),i.jsxs("span",{className:"text-xs text-amber-600 dark:text-amber-400 font-medium",children:[m.price," "]})]}),m.requiredReplyLanterns!==void 0&&m.requiredReplyLanterns>0&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Tt,{className:"w-3 h-3 text-yellow-500"}),i.jsxs("span",{className:"text-[10px] text-gray-600 dark:text-gray-400",children:["  ",m.requiredReplyLanterns," "]})]}),m.requiredGuideCount!==void 0&&m.requiredGuideCount>0&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(br,{className:"w-3 h-3 text-sky-500"}),i.jsxs("span",{className:"text-[10px] text-gray-600 dark:text-gray-400",children:["  ",m.requiredGuideCount," "]})]})]})]})]}),i.jsx("div",{className:"shrink-0",children:p?w?i.jsx(z,{size:"sm",variant:"outline",onClick:r,children:""}):i.jsx(z,{size:"sm",onClick:()=>s(m.id),children:""}):i.jsxs(me,{variant:"outline",className:"text-xs",children:[i.jsx(Ta,{className:"w-3 h-3 mr-1"}),""]})})]})})},m.id)})})]}),c.length>0&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-2 px-1",children:[i.jsx(Ms,{className:"w-5 h-5 text-gray-300 dark:text-gray-300"}),i.jsx("h3",{className:"text-lg font-bold text-gray-300 dark:text-gray-300",children:" "}),i.jsxs(me,{variant:"outline",className:"text-xs",children:[c.length,""]})]}),i.jsx("div",{className:"space-y-2",children:c.map(m=>{const p=t===m.id;return i.jsx($,{className:"transition-all min-h-[88px] border-amber-300 dark:border-amber-700 bg-amber-50 dark:bg-amber-950/20",children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"flex items-center justify-between gap-3 min-h-[56px]",children:[i.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[i.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/40",children:i.jsx(Ia,{className:"w-5 h-5"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("span",{className:"font-bold truncate text-gray-300 dark:text-gray-200",children:m.name}),i.jsx(me,{variant:"default",className:"text-xs bg-amber-600 text-white shrink-0",children:""}),p&&i.jsx(me,{variant:"default",className:"text-xs bg-purple-600 text-white shrink-0",children:" "})]}),i.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-1",children:m.description})]})]}),i.jsx("div",{className:"shrink-0",children:p?i.jsx(z,{size:"sm",variant:"outline",onClick:r,children:""}):i.jsx(z,{size:"sm",onClick:()=>s(m.id),children:""})})]})})},m.id)})})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-2 px-1",children:[i.jsx(Ms,{className:"w-5 h-5 text-gray-300 dark:text-gray-300"}),i.jsx("h3",{className:"text-lg font-bold text-gray-300 dark:text-gray-300",children:" "}),i.jsxs(me,{variant:"outline",className:"text-xs",children:[a.length,""]})]}),i.jsx("div",{className:"space-y-2",children:a.map(m=>{const p=e.includes(m.id),w=t===m.id;return i.jsx($,{className:`transition-all min-h-[88px] ${p?"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-950/10":"opacity-30 bg-gray-50 dark:bg-gray-900/20"}`,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"flex items-center justify-between gap-3 min-h-[56px]",children:[i.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[i.jsx("div",{className:`p-2 rounded-lg ${p?"bg-amber-100 dark:bg-amber-900/30":"bg-gray-200 dark:bg-gray-800"}`,children:p?i.jsx(Ms,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"}):i.jsx(Ta,{className:"w-5 h-5 text-gray-400 dark:text-gray-600"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("span",{className:"font-bold truncate text-gray-300 dark:text-gray-400",children:m.name}),w&&i.jsx(me,{variant:"default",className:"text-xs bg-amber-600 text-white shrink-0",children:" "})]}),i.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-1",children:m.description})]})]}),i.jsx("div",{className:"shrink-0",children:p?w?i.jsx(z,{size:"sm",variant:"outline",onClick:r,children:""}):i.jsx(z,{size:"sm",onClick:()=>s(m.id),children:""}):i.jsxs(me,{variant:"outline",className:"text-xs",children:[i.jsx(Ta,{className:"w-3 h-3 mr-1"}),""]})})]})})},m.id)})})]})]})]})}function H1({onBack:n,weeklyGuideRanking:e,totalGuideRanking:t,weeklyLanternRanking:s}){const[r,a]=x.useState("weekly"),o=Wr({key:`ranking-${r}`}),d=(()=>{const y=new Date,b=new Date,I=(7-y.getDay()+1)%7||7;return b.setDate(y.getDate()+I),b.setHours(8,0,0,0),y.getDay()===1&&y.getHours()<8&&b.setDate(y.getDate()),b})().getTime()-new Date().getTime(),h=Math.floor(d/(1e3*60*60*24)),m=Math.floor(d%(1e3*60*60*24)/(1e3*60*60)),p=x.useMemo(()=>Object.values(e??{}).map(y=>({author:y.author,count:y.count,authorUid:y.authorUid})).sort((y,b)=>b.count-y.count).slice(0,5),[e]),w=x.useMemo(()=>Object.values(t??{}).map(y=>({author:y.author,count:y.count,authorUid:y.authorUid})).sort((y,b)=>b.count-y.count).slice(0,5),[t]),v=x.useMemo(()=>Object.values(s??{}).map(y=>({author:y.author,count:y.count,authorUid:y.authorUid})).sort((y,b)=>b.count-y.count).slice(0,5),[s]),[j,k]=x.useState([]),[P,R]=x.useState([]);x.useEffect(()=>{(async()=>{try{const b=sn(ae,"weekly_stats"),I=xs(b,sw("periodEnd","desc"),rw(1)),T=await Sn(I);if(T.empty){k([]),R([]);return}const N=T.docs[0].data(),F=typeof N.weekEnding=="string"?N.weekEnding:"",Z=Array.isArray(N.guideRewards)?N.guideRewards:[];k(Z.map((xe,K)=>({rank:typeof xe.rank=="number"?xe.rank:K+1,author:String(xe.author??""),lumens:typeof xe.lumens=="number"?xe.lumens:0,weekEnding:typeof xe.weekEnding=="string"?xe.weekEnding:F})));const Ee=Array.isArray(N.lanternRewards)?N.lanternRewards:[];R(Ee.map((xe,K)=>({rank:typeof xe.rank=="number"?xe.rank:K+1,author:String(xe.author??""),lumens:typeof xe.lumens=="number"?xe.lumens:0,weekEnding:typeof xe.weekEnding=="string"?xe.weekEnding:F})))}catch(b){console.error("    :",b),k([]),R([])}})()},[]);const C=Array.from(new Set([...p,...w,...v].map(y=>y.authorUid).filter(y=>!!y))),S=No(C),D=y=>{switch(y){case 0:return i.jsx(Wl,{className:"w-5 h-5 text-amber-500"});case 1:return i.jsx(xi,{className:"w-5 h-5 text-gray-400"});case 2:return i.jsx(xv,{className:"w-5 h-5 text-amber-700"});default:return i.jsx("div",{className:"w-5 h-5 flex items-center justify-center text-sm font-medium text-muted-foreground",children:y+1})}},M=y=>{switch(y){case 0:return i.jsx(me,{className:"bg-gradient-to-r from-amber-500 to-yellow-600 text-white text-xs",children:"1"});case 1:return i.jsx(me,{className:"bg-gradient-to-r from-gray-400 to-gray-500 text-white text-xs",children:"2"});case 2:return i.jsx(me,{className:"bg-gradient-to-r from-amber-700 to-amber-800 text-white text-xs",children:"3"});default:return i.jsxs(me,{variant:"outline",className:"text-xs",children:[y+1,""]})}},_=(y,b)=>i.jsx("div",{className:"space-y-3",children:y.length===0?i.jsx($,{children:i.jsxs(q,{className:"p-8 text-center",children:[i.jsxs("div",{className:"relative mb-6",children:[i.jsx("div",{className:`absolute inset-0 ${b==="guide"?"bg-amber-500/30 dark:bg-amber-400/30":"bg-yellow-500/30 dark:bg-yellow-400/30"} blur-2xl rounded-full`}),i.jsx("div",{className:`relative w-24 h-24 rounded-full ${b==="guide"?"bg-amber-100 dark:bg-amber-900/40 border-4 border-amber-400 dark:border-amber-600":"bg-yellow-100 dark:bg-yellow-900/40 border-4 border-yellow-400 dark:border-yellow-600"} shadow-lg flex items-center justify-center mx-auto`,children:b==="guide"?i.jsx(Gn,{className:"w-14 h-14 text-amber-900 dark:text-amber-200",strokeWidth:2.5}):i.jsx(Ql,{className:"w-14 h-14 text-yellow-900 dark:text-yellow-200",strokeWidth:2.5})})]}),i.jsx("h3",{className:"font-medium text-foreground mb-2",children:"  "}),i.jsx("p",{className:"text-sm text-muted-foreground",children:b==="guide"?"    ":"   "})]})}):y.map((I,T)=>{const A=I.authorUid&&S[I.authorUid]?S[I.authorUid]:void 0,N=A?.currentTitleId??null,F=$r(N),Z=A?.profileImage;return i.jsx($,{className:`list-optimized ${T<3?"bg-gradient-to-r from-muted/50 to-muted/30":""}`,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"flex-shrink-0",children:D(T)}),i.jsxs(rn,{className:"w-10 h-10",children:[Z&&i.jsx(vn,{src:Z}),i.jsx(an,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white",children:I.author?.charAt(0)?.toUpperCase()||"?"})]}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("p",{className:"font-medium text-sm truncate",children:I.author}),M(T)]}),F&&i.jsx(me,{variant:"secondary",className:"text-xs px-1.5 py-0.5 mt-1 w-fit",children:F}),i.jsx("div",{className:"flex items-center space-x-1 mt-1",children:b==="guide"?i.jsxs(i.Fragment,{children:[i.jsx(Gn,{className:"w-3 h-3 text-amber-500"}),i.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",I.count,""]})]}):i.jsxs(i.Fragment,{children:[i.jsx(Ql,{className:"w-3 h-3 text-amber-500"}),i.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",I.count,""]})]})})]})]})})},I.author)})});return i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",onClick:n,children:i.jsx(Et,{className:"w-5 h-5"})}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(nx,{className:"w-5 h-5 text-primary"}),i.jsx("h1",{className:"font-medium",children:""})]})]})})}),i.jsx("div",{ref:o,className:"flex-1 scroll-container",children:i.jsx("div",{className:"p-4 pb-24",children:i.jsxs(uf,{value:r,onValueChange:a,children:[i.jsxs(df,{className:"grid w-full grid-cols-3 !h-8",children:[i.jsx(Ar,{value:"weekly",className:"text-xs",children:" "}),i.jsx(Ar,{value:"total",className:"text-xs",children:" "}),i.jsx(Ar,{value:"lantern",className:"text-xs",children:" "})]}),i.jsx(jr,{value:"weekly",className:"mt-4",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(gv,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"    "}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[": ",h," ",m," "]})]})]}),i.jsx(me,{variant:"secondary",className:"text-xs",children:"Weekly"})]}),i.jsx($,{className:"bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/20",children:i.jsxs(q,{className:"p-3",children:[i.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[i.jsx(Wl,{className:"w-4 h-4 text-amber-500"}),i.jsx("p",{className:"text-sm font-medium",children:" "})]}),i.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[i.jsx("div",{children:" 1:  5"}),i.jsx("div",{children:" 2:  3"}),i.jsx("div",{children:" 3:  1"})]})]})}),j.length>0&&i.jsx($,{children:i.jsxs(q,{className:"p-3",children:[i.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[i.jsx(xi,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("p",{className:"text-sm font-medium",children:["   (",j[0].weekEnding," )"]})]}),i.jsx("div",{className:"space-y-2",children:j.map(y=>i.jsxs("div",{className:"flex items-center justify-between text-xs",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsxs("span",{className:"font-medium",children:[y.rank,""]}),i.jsx("span",{children:y.author})]}),i.jsxs("span",{className:"text-amber-500",children:["+",y.lumens," "]})]},y.author))})]})}),_(p,"guide")]})}),i.jsx(jr,{value:"total",className:"mt-4",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Gn,{className:"w-4 h-4 text-muted-foreground"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"    ()"})]}),i.jsx(me,{variant:"secondary",className:"text-xs",children:"Total"})]}),_(w,"guide")]})}),i.jsx(jr,{value:"lantern",className:"mt-4",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Ql,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"    "}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[": ",h," ",m," "]})]})]}),i.jsx(me,{variant:"secondary",className:"text-xs",children:"Weekly"})]}),i.jsx($,{className:"bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/20",children:i.jsxs(q,{className:"p-3",children:[i.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[i.jsx(Wl,{className:"w-4 h-4 text-amber-500"}),i.jsx("p",{className:"text-sm font-medium",children:" "})]}),i.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[i.jsx("div",{children:" 1:  5"}),i.jsx("div",{children:" 2:  3"}),i.jsx("div",{children:" 3:  1"})]})]})}),P.length>0&&i.jsx($,{children:i.jsxs(q,{className:"p-3",children:[i.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[i.jsx(xi,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("p",{className:"text-sm font-medium",children:["   (",P[0].weekEnding," )"]})]}),i.jsx("div",{className:"space-y-2",children:P.map(y=>i.jsxs("div",{className:"flex items-center justify-between text-xs",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsxs("span",{className:"font-medium",children:[y.rank,""]}),i.jsx("span",{children:y.author})]}),i.jsxs("span",{className:"text-amber-500",children:["+",y.lumens," "]})]},y.author))})]})}),_(v,"lantern")]})})]})})})]})}function K1({className:n,value:e,...t}){return i.jsx(Xb,{"data-slot":"progress",className:qe("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",n),...t,children:i.jsx(Zb,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(e||0)}%)`}})})}function W1({onBack:n,userNickname:e,isDarkMode:t}){const s=Wr({key:"achievements"}),{isAchievementUnlocked:r,getAchievementInfo:a}=xb(),o=gb.filter(m=>m.hidden?r(m.id):!0),u=o.filter(m=>r(m.id)).length,d=o.length,h=d>0?u/d*100:0;return i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",onClick:n,children:i.jsx(Et,{className:"w-5 h-5"})}),i.jsx("h1",{className:"text-lg font-medium",children:""})]})})})}),i.jsxs("div",{ref:s,className:"flex-1 scroll-container no-scrollbar p-4 pb-24 space-y-4",children:[i.jsx($,{children:i.jsx(q,{className:"p-6",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-2xl font-bold text-primary",children:[u," / ",d]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:" "})]}),i.jsx(Ms,{className:"w-12 h-12 text-amber-500"})]}),i.jsx(K1,{value:h,className:"h-2"})]})})}),i.jsx("div",{className:"space-y-3",children:o.map(m=>{const p=r(m.id),w=m.hidden,v=a(m.id);return i.jsx($,{className:p?"":"opacity-60",children:i.jsx(q,{className:"p-4",children:i.jsx("div",{className:"space-y-3",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[i.jsx("h3",{className:"font-medium",children:m.name}),w&&i.jsx(me,{variant:"outline",className:"text-xs",children:""}),p&&i.jsx(me,{variant:"secondary",className:"text-xs",children:""})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:m.description}),p&&v?.achievedAt&&i.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[": ",new Date(v.achievedAt).toLocaleString("ko-KR")]})]}),p&&i.jsx(me,{variant:"outline",className:"text-xs ml-2",children:N1(m.category)})]})})})},m.id)})})]})]})}function Q1({onBack:n,bookmarkedPosts:e,posts:t,onPostSelect:s,userNickname:r,currentTitle:a}){const[o,c]=x.useState(""),u=Wr({key:"bookmarks"}),d=t.filter(v=>e.has(String(v.id))),h=d.filter(v=>v.title?.toLowerCase().includes(o.toLowerCase())||v.content?.toLowerCase().includes(o.toLowerCase())||v.author?.toLowerCase().includes(o.toLowerCase())),m=x.useCallback(v=>{c(v.target.value)},[]),p=x.useCallback(v=>{const j=Number(v.currentTarget.dataset.postId),k=t.find(P=>P.id===j);k&&s(k)},[t,s]),w=x.useCallback(v=>Ll(v,r,a),[r,a]);return i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",onClick:n,children:i.jsx(Et,{className:"w-5 h-5"})}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(gi,{className:"w-5 h-5 text-primary"}),i.jsx("h1",{className:"font-medium",children:""})]}),i.jsxs(me,{variant:"secondary",className:"ml-auto",children:[d.length,""]})]})})}),i.jsx("div",{className:"border-b border-border p-4 flex-shrink-0",children:i.jsxs("div",{className:"relative",children:[i.jsx(La,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Br,{placeholder:"  ...",value:o,onChange:m,className:"pl-10"})]})}),i.jsx("div",{ref:u,className:"flex-1 scroll-container",children:h.length===0?i.jsx("div",{className:"flex flex-col items-center justify-center h-full p-8",children:i.jsx("div",{className:"text-center space-y-4",children:d.length===0?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"relative mb-4",children:[i.jsx("div",{className:"absolute inset-0 bg-blue-500/30 dark:bg-blue-400/30 blur-2xl rounded-full"}),i.jsx("div",{className:"relative w-24 h-24 rounded-full bg-blue-100 dark:bg-blue-900/40 flex items-center justify-center border-4 border-blue-400 dark:border-blue-600 shadow-lg mx-auto",children:i.jsx(gi,{className:"w-14 h-14 text-blue-900 dark:text-blue-200",strokeWidth:2.5})})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium mb-2",children:"  "}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"      "})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"relative mb-4",children:[i.jsx("div",{className:"absolute inset-0 bg-slate-500/30 dark:bg-slate-400/30 blur-2xl rounded-full"}),i.jsx("div",{className:"relative w-24 h-24 rounded-full bg-slate-100 dark:bg-slate-700/40 flex items-center justify-center border-4 border-slate-400 dark:border-slate-600 shadow-lg mx-auto",children:i.jsx(La,{className:"w-14 h-14 text-slate-900 dark:text-slate-200",strokeWidth:2.5})})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium mb-2",children:"  "}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"  "})]})]})})}):i.jsx("div",{className:"p-4 pb-24 space-y-3",children:h.map(v=>i.jsx($,{className:"cursor-pointer hover:shadow-md transition-shadow list-optimized",children:i.jsx(q,{className:"p-4","data-post-id":v.id,onClick:p,children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[i.jsxs(rn,{className:"w-8 h-8 flex-shrink-0",children:[v.authorAvatar&&i.jsx(vn,{src:v.authorAvatar}),i.jsx(an,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white",children:v.author?.charAt(0)?.toUpperCase()||"?"})]}),i.jsxs("div",{className:"min-w-0 flex-1",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("p",{className:"font-medium text-sm truncate",children:v.author}),w(v.author)&&i.jsx(me,{variant:"secondary",className:"text-xs px-1.5 py-0.5 flex-shrink-0",children:w(v.author)})]}),i.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[i.jsx("span",{children:v.timeAgo}),i.jsx("span",{children:""}),i.jsx("span",{children:v.category})]})]})]}),i.jsx(gi,{className:"w-4 h-4 text-primary fill-current flex-shrink-0"})]}),i.jsxs("div",{className:"flex items-start space-x-2",children:[i.jsx("div",{className:"flex-shrink-0 mt-1",children:v.type==="question"?i.jsx(It,{className:"w-4 h-4 text-blue-500"}):i.jsx(br,{className:"w-4 h-4 text-primary"})}),i.jsx("h3",{className:"font-medium line-clamp-2 leading-relaxed flex-1",children:v.title})]}),v.content&&i.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 leading-relaxed pl-6",children:v.content}),v.tags&&v.tags.length>0&&i.jsxs("div",{className:"flex flex-wrap gap-1 pl-6",children:[v.tags.slice(0,3).map(j=>i.jsxs(me,{variant:"outline",className:"text-xs px-1.5 py-0.5",children:["#",j]},j)),v.tags.length>3&&i.jsxs(me,{variant:"outline",className:"text-xs px-1.5 py-0.5",children:["+",v.tags.length-3]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(Xn,{className:"w-4 h-4 text-muted-foreground"}),i.jsx("span",{className:"text-sm text-muted-foreground",children:v.lanterns})]}),i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(It,{className:"w-4 h-4 text-muted-foreground"}),i.jsx("span",{className:"text-sm text-muted-foreground",children:v.comments})]})]}),i.jsx(me,{variant:v.type==="question"?"secondary":"default",className:"text-xs",children:v.type==="question"?"":""})]})]})})},v.id))})})]})}const J1=x.memo(function({nickname:e,mode:t,avatarUrl:s,bio:r,title:a,onUserClick:o}){const c=x.useCallback(()=>{e&&o?.(e)},[o,e]),u=e||"",d=u.slice(0,2),h=$r(a);return i.jsx($,{className:"cursor-pointer rounded-xl",onClick:c,children:i.jsxs(q,{className:"p-4 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[s?i.jsx("img",{src:s,alt:u,className:"w-10 h-10 rounded-full object-cover"}):i.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center text-xs font-medium",children:d}),i.jsxs("div",{className:"flex flex-col min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-1 max-w-[180px]",children:[i.jsx("span",{className:"text-base font-medium truncate",children:u}),h&&i.jsx("span",{className:`\r
                    text-[10px] px-1.5 py-0.5 rounded-full\r
                    bg-amber-50 text-amber-700 border border-amber-200\r
                    truncate\r
                    `,children:h})]}),r&&i.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[180px]",children:r})]})]}),t==="following"?i.jsx(vc,{className:"w-4 h-4 text-amber-500"}):i.jsx(Ti,{className:"w-4 h-4 text-amber-500"})]})})});function wd({mode:n,users:e,onBack:t,onUserClick:s}){const r=n==="followers"?" ":" ",a=n==="followers"?"  .":"   .",o=(e||[]).filter(c=>c!=null).map(c=>typeof c=="string"?{nickname:c}:c.nickname?c:{nickname:""}).filter(c=>c.nickname);return i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col scrollbar-hide",children:[i.jsx(Ol,{title:r,onBack:t}),i.jsx("main",{className:"flex-1 overflow-y-auto px-4 py-3",children:o.length===0?i.jsx("div",{className:"h-full flex items-center justify-center",children:i.jsx("p",{className:"text-sm text-muted-foreground text-center px-6",children:a})}):i.jsx("div",{className:"space-y-2",children:o.map((c,u)=>i.jsx(J1,{nickname:c.nickname,avatarUrl:c.avatarUrl,bio:c.bio,title:c.title,mode:n,onUserClick:s},c.nickname||`user-${u}`))})})]})}function bd({mode:n,posts:e=[],replies:t=[],onBack:s,onPostClick:r,onReplyClick:a}){const o=n==="posts",c=[...new Set([...e.map(p=>p.authorUid).filter(p=>typeof p=="string"&&p.length>0),...t.map(p=>p.authorUid).filter(p=>typeof p=="string"&&p.length>0)])],u=No(c),d=o?"  ":"  ",h=x.useCallback(p=>{const w=p.currentTarget.getAttribute("data-post-id");w&&r?.(w)},[r]),m=x.useCallback(p=>{const w=p.currentTarget.getAttribute("data-post-id"),v=p.currentTarget.getAttribute("data-reply-id");if(!w||!v)return;const j=Number(v);Number.isNaN(j)||a?.(w,j)},[a]);return i.jsxs("div",{className:"flex-1 flex flex-col scrollbar-hide",children:[i.jsx(Ol,{title:d,onBack:s,icon:i.jsx(Bn,{className:"w-4 h-4"})}),i.jsx("main",{className:"flex-1 scroll-container px-4 py-3 pb-24",children:o?e.length===0?i.jsx("div",{className:"h-full flex items-center justify-center",children:i.jsxs("div",{className:"flex flex-col items-center text-center",children:[i.jsx(Bn,{className:"w-10 h-10 mb-3 text-muted-foreground/60"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"   ."})]})}):i.jsx("div",{className:"space-y-3",children:e.map(p=>{const w=p.authorUid?u[p.authorUid]:void 0,v=w?.profileImage??p.authorAvatar??"",j=w?.currentTitleId?$r(w.currentTitleId):null;return i.jsx($,{"data-post-id":p.id,className:"hover:shadow-md transition-shadow cursor-pointer list-optimized",onClick:h,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsxs(rn,{className:"w-9 h-9 ring-2 ring-border/20",children:[v&&i.jsx(vn,{src:v}),i.jsx(an,{className:"bg-gradient-to-br from-primary/20 to-primary/40 text-foreground font-medium",children:p.author?.charAt(0)?.toUpperCase()||"?"})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("p",{className:"font-medium text-sm",children:p.author}),j&&i.jsx(me,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:j})]}),i.jsx("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground mt-1",children:p.timeAgo&&i.jsx("span",{children:p.timeAgo})})]})]})}),p.title&&i.jsx("h2",{className:"text-sm font-medium line-clamp-1",children:p.title}),p.content&&i.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:p.content}),i.jsxs("div",{className:"flex items-center justify-between pt-1",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[p.type==="guide"&&i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(Xn,{className:"w-4 h-4 text-muted-foreground"}),i.jsx("span",{className:"text-sm text-muted-foreground",children:p.lanterns})]}),i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(It,{className:"w-4 h-4 text-muted-foreground"}),i.jsx("span",{className:"text-sm text-muted-foreground",children:p.comments})]})]}),p.tags&&p.tags.length>0&&i.jsxs("div",{className:"flex space-x-1",children:[p.tags[0]&&i.jsxs(me,{variant:"secondary",className:"text-xs px-1.5 py-0.5",children:["#",p.tags[0]]}),p.tags[1]&&i.jsxs(me,{variant:"secondary",className:"text-xs px-1.5 py-0.5",children:["#",p.tags[1]]})]})]})]})})},p.id)})}):t.length===0?i.jsx("div",{className:"h-full flex items-center justify-center",children:i.jsxs("div",{className:"flex flex-col items-center text-center",children:[i.jsx(It,{className:"w-10 h-10 mb-3 text-muted-foreground/60"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"   ."})]})}):i.jsx("div",{className:"space-y-3",children:t.map(p=>{const w=p.authorUid?u[p.authorUid]:void 0,v=w?.profileImage??p.authorAvatar??"",j=w?.currentTitleId?$r(w.currentTitleId):null;return i.jsx($,{"data-post-id":p.postId,"data-reply-id":p.id,className:"hover:shadow-md transition-shadow cursor-pointer list-optimized",onClick:m,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsxs(rn,{className:"w-8 h-8 ring-2 ring-border/20",children:[v&&i.jsx(vn,{src:v}),i.jsx(an,{className:"bg-gradient-to-br from-primary/20 to-primary/40 text-foreground text-xs font-medium",children:p.author?.charAt(0)?.toUpperCase()||"?"})]}),i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("span",{className:"text-xs font-medium",children:p.author}),j&&i.jsx(me,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:j})]}),i.jsxs("span",{className:"text-[11px] text-muted-foreground",children:[p.postAuthor," "]})]})]}),p.timeAgo&&i.jsx("span",{className:"text-xs text-muted-foreground",children:p.timeAgo})]}),i.jsx("p",{className:"text-sm line-clamp-2",children:p.content}),i.jsxs("div",{className:"flex items-center space-x-1 mt-2",children:[i.jsx(Tt,{className:"w-3 h-3 text-amber-500"}),i.jsx("span",{className:"text-xs text-amber-600",children:p.lanterns})]})]})})},p.id)})})})]})}function Y1(n){return n<=10?"text-red-400":n<=30?"text-orange-400":n<=70?"text-emerald-400":"text-blue-400"}function X1(n){return n<=10?"   ,      .":n<=30?"  .       .":n<=70?" .       .":"  .      ."}function vu(n){return n?n instanceof Date?n.toLocaleString("ko-KR"):String(n):""}function Z1({onBack:n,userName:e,userAvatar:t,username:s,userBio:r,posts:a=[],trustScore:o=30,reportCount:c=0,achievementCount:u=0,titleCount:d=0,guideCount:h=0,followerCount:m=0,followingCount:p=0,followerUsers:w=[],followingUsers:v=[],onPostClick:j,onReplyClick:k,isMyself:P=!1,isFollowing:R=!1,onToggleFollowUser:C,onFollowUserClick:S,activeSection:D,onChangeSection:M}){const _=s||e||"",[y,b]=x.useState("profile"),I=D??y,T=M??b,A=x.useCallback(()=>{T("profile")},[T]),N=x.useCallback(()=>{T("followers")},[T]),F=x.useCallback(()=>{T("following")},[T]),Z=x.useCallback(()=>{T("posts")},[T]),Ee=x.useCallback(()=>{T("replies")},[T]),xe=x.useMemo(()=>Math.max(0,Math.min(100,o)),[o]),K=Y1(xe),ee=X1(xe),oe=x.useMemo(()=>{const Re=a.length;let Me=0,se=0,Ue=null;a.forEach(Oe=>{const O=Oe.lanterns??0,ue=Oe.comments??(Array.isArray(Oe.replies)?Oe.replies.length:0);Me+=O,se+=ue,(!Ue||O>Ue.lanterns)&&(Ue={id:Oe.id,title:Oe.title,lanterns:O,comments:ue,category:Oe.category,timeAgo:vu(Oe.timeAgo||Oe.createdAtText||Oe.createdAt||"")})});let He=null;const Rt=s||e;return a.forEach(Oe=>{(Oe.replies??[]).forEach(ue=>{if(!Rt||ue.author!==Rt)return;const re=ue.lanterns??0;(!He||re>He.lanterns)&&(He={id:ue.id,content:ue.content,lanterns:re,timeAgo:vu(ue.timeAgo||ue.createdAtText||ue.createdAt||""),postTitle:Oe.title,postId:Oe.id})})}),{nickname:_,totalPosts:Re,totalLanterns:Me,totalComments:se,bio:r||"    .",bestPost:Ue,bestReply:He}},[_,a,s,e,r]),Ae=x.useMemo(()=>{const Re=[],Me=s||e;return a.forEach(se=>{(se.replies??[]).forEach(He=>{!Me||He.author!==Me||Re.push({id:He.id,postId:se.id,postAuthor:se.author||se.nickname||se.userName||" ",postTitle:se.title,content:He.content,lanterns:He.lanterns??0,timeAgo:vu(He.timeAgo||He.createdAtText||He.createdAt||"")})})}),Re},[a,s,e]),je=x.useCallback(()=>{j&&oe.bestPost?.id!=null&&j(oe.bestPost.id)},[j,oe]),ke=x.useCallback(()=>{k&&oe.bestReply?.postId!=null&&oe.bestReply?.id!=null&&k(oe.bestReply.postId,oe.bestReply.id)},[k,oe]),De=x.useCallback(()=>{!C||P||C(_)},[C,P,_]);return I==="followers"?i.jsx("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:i.jsx(wd,{mode:"followers",users:w,onBack:A,onUserClick:S})}):I==="following"?i.jsx("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:i.jsx(wd,{mode:"following",users:v,onBack:A,onUserClick:S})}):I==="posts"?i.jsx("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:i.jsx(bd,{mode:"posts",posts:a,onBack:A,onPostClick:j})}):I==="replies"?i.jsx("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:i.jsx(bd,{mode:"replies",replies:Ae,onBack:A,onReplyClick:k})}):i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:[i.jsx(Ol,{title:" ",onBack:n}),i.jsx("main",{className:"flex-1 scroll-container scrollbar-hide",children:i.jsxs("div",{className:"w-full max-w-md sm:max-w-lg md:max-w-2xl lg:max-w-3xl xl:max-w-4xl mx-auto p-4 space-y-4",children:[i.jsx($,{className:"border-border/70 shadow-sm rounded-xl",children:i.jsxs(q,{className:"p-4 flex items-center justify-between gap-4",children:[i.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[i.jsxs(rn,{className:"w-16 h-16 rounded-full overflow-hidden",children:[t&&i.jsx(vn,{src:t,className:"w-full h-full object-cover"}),i.jsx(an,{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 text-white text-xl flex items-center justify-center rounded-full",children:_.charAt(0).toUpperCase()})]}),i.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[i.jsx("h3",{className:"font-semibold text-base",children:oe.nickname}),i.jsx("p",{className:"text-xs text-muted-foreground leading-snug",children:oe.bio})]})]}),!P&&C&&i.jsx("div",{className:"flex flex-col items-end gap-2",children:i.jsx(z,{size:"sm",className:"h-8 px-3 rounded-full text-xs",variant:R?"outline":"default",onClick:De,children:R?i.jsxs(i.Fragment,{children:[i.jsx(vc,{className:"w-3 h-3 mr-1"}),""]}):i.jsxs(i.Fragment,{children:[i.jsx(yv,{className:"w-3 h-3 mr-1"}),""]})})})]})}),i.jsx($,{className:"border-border/70 shadow-sm rounded-xl",children:i.jsxs(q,{className:"p-4 flex flex-col items-center text-center gap-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ex,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("span",{className:"text-sm font-medium",children:[""," ",i.jsxs("span",{className:`font-semibold ${K}`,children:[Math.round(xe),""]})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground leading-snug",children:ee}),c>0&&i.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["  ",c,"     ."]})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx($,{className:"cursor-pointer",onClick:N,children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(Ti,{className:"w-6 h-6 mx-auto mb-2 text-amber-500"}),i.jsx("div",{className:"text-lg font-medium",children:m}),i.jsx("div",{className:"text-xs text-muted-foreground leading-snug",children:""})]})}),i.jsx($,{className:"cursor-pointer",onClick:F,children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(vc,{className:"w-6 h-6 mx-auto mb-2 text-amber-500"}),i.jsx("div",{className:"text-lg font-medium",children:p}),i.jsx("div",{className:"text-xs text-muted-foreground leading-snug",children:" "})]})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx($,{className:"cursor-pointer",onClick:Z,children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(Bn,{className:"w-6 h-6 mx-auto mb-2 text-blue-500"}),i.jsx("div",{className:"text-lg font-medium",children:oe.totalPosts}),i.jsx("div",{className:"text-xs text-muted-foreground",children:" "})]})}),i.jsx($,{className:"cursor-pointer",onClick:Ee,children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(It,{className:"w-6 h-6 mx-auto mb-2 text-green-500"}),i.jsx("div",{className:"text-lg font-medium",children:oe.totalComments}),i.jsx("div",{className:"text-xs text-muted-foreground",children:""})]})}),i.jsx($,{children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(Ms,{className:"w-6 h-6 mx-auto mb-2 text-amber-500"}),i.jsx("div",{className:"text-lg font-medium",children:u}),i.jsx("div",{className:"text-xs text-muted-foreground",children:" "})]})}),i.jsx($,{children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx($s,{className:"w-6 h-6 mx-auto mb-2 text-purple-500"}),i.jsx("div",{className:"text-lg font-medium",children:d}),i.jsx("div",{className:"text-xs text-muted-foreground",children:" "})]})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx($,{children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(Tt,{className:"w-6 h-6 mx-auto mb-2 text-amber-500"}),i.jsx("div",{className:"text-lg font-medium",children:oe.totalLanterns}),i.jsx("div",{className:"text-xs text-muted-foreground",children:" "})]})}),i.jsx($,{children:i.jsxs(q,{className:"p-4 text-center",children:[i.jsx(Gn,{className:"w-6 h-6 mx-auto mb-2 text-primary"}),i.jsx("div",{className:"text-lg font-medium",children:h}),i.jsx("div",{className:"text-xs text-muted-foreground",children:" "})]})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs(uf,{defaultValue:"bestPost",className:"w-full",children:[i.jsxs(df,{className:"grid w-full grid-cols-2 gap-2 bg-transparent p-0 border-0",children:[i.jsxs(Ar,{value:"bestPost",className:`
                    text-xs rounded-xl border border-border/70 bg-card/60
                    flex items-center justify-center gap-1 py-2
                    data-[state=active]:bg-card
                    data-[state=active]:text-foreground
                    data-[state=active]:shadow-sm
                  `,children:[i.jsx(Bn,{className:"w-4 h-4"}),i.jsx("span",{children:" "})]}),i.jsxs(Ar,{value:"bestReply",className:`
                    text-xs rounded-xl border border-border/70 bg-card/60
                    flex items-center justify-center gap-1 py-2
                    data-[state=active]:bg-card
                    data-[state=active]:text-foreground
                    data-[state=active]:shadow-sm
                  `,children:[i.jsx(It,{className:"w-4 h-4"}),i.jsx("span",{children:" "})]})]}),i.jsx(jr,{value:"bestPost",className:"mt-4 border-t border-border pt-4",children:oe.bestPost?i.jsx($,{className:"hover:shadow-md transition-shadow cursor-pointer list-optimized",onClick:je,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(me,{variant:"outline",className:"text-xs",children:oe.bestPost.category}),oe.bestPost.timeAgo&&i.jsx("span",{className:"text-xs text-muted-foreground",children:oe.bestPost.timeAgo})]}),i.jsx("h3",{className:"font-medium text-sm line-clamp-1",children:oe.bestPost.title}),i.jsxs("div",{className:"flex items-center space-x-3 pt-2 border-t border-border",children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(Tt,{className:"w-3 h-3 text-amber-500"}),i.jsx("span",{className:"text-xs text-amber-600",children:oe.bestPost.lanterns})]}),i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(It,{className:"w-3 h-3 text-muted-foreground"}),i.jsx("span",{className:"text-xs text-muted-foreground",children:oe.bestPost.comments})]})]})]})})}):i.jsx("div",{className:"py-10 flex justify-center",children:i.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"   ."})})}),i.jsx(jr,{value:"bestReply",className:"mt-4 border-t border-border pt-4",children:oe.bestReply?i.jsx($,{className:"hover:shadow-md transition-shadow list-optimized cursor-pointer",onClick:ke,children:i.jsx(q,{className:"p-4",children:i.jsxs("div",{className:"space-y-2",children:[oe.bestReply.postTitle&&i.jsx("p",{className:"text-[11px] text-muted-foreground line-clamp-1",children:oe.bestReply.postTitle}),i.jsx("p",{className:"text-sm line-clamp-2",children:oe.bestReply.content}),i.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx(Tt,{className:"w-3 h-3 text-amber-500"}),i.jsx("span",{className:"text-xs text-amber-600",children:oe.bestReply.lanterns})]}),oe.bestReply.timeAgo&&i.jsx("span",{className:"text-xs text-muted-foreground",children:oe.bestReply.timeAgo})]})]})})}):i.jsx("div",{className:"py-10 flex justify-center",children:i.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"   ."})})})]})})]})})]})}const Yo={getItem:n=>{try{return typeof window>"u"?null:localStorage.getItem(n)}catch(e){return console.error("localStorage getItem error:",e),null}},setItem:(n,e)=>{try{if(typeof window>"u")return;localStorage.setItem(n,e)}catch(t){console.error("localStorage setItem error:",t)}}};function eP({onBack:n,categories:e}){const[t,s]=x.useState(new Set),[r,a]=x.useState(!0),[o,c]=x.useState(!1),u=x.useCallback((R,C)=>{const S=Array.from(R);Yo.setItem("notificationSettings",JSON.stringify(S)),Yo.setItem("allNotificationsEnabled",C.toString())},[]),d=x.useCallback(async(R,C)=>{u(R,C);const S=Ne.currentUser?.uid;if(!S)return;const D=be(ae,"users",S),M={allEnabled:C,enabledCategories:Array.from(R)};try{await ct(D,{notificationSettings:M})}catch(_){console.error("  Firestore  :",_)}},[u]);x.useEffect(()=>{const R=e.map(I=>I.id);let C=new Set(R),S=!0;const D=Yo.getItem("notificationSettings"),M=Yo.getItem("allNotificationsEnabled");if(D)try{const I=JSON.parse(D);Array.isArray(I)&&(C=new Set(I.filter(T=>R.includes(T))))}catch(I){console.error("notificationSettings  :",I)}M!==null&&(S=M==="true");const _=Ne.currentUser?.uid;if(!_){s(C),a(S),c(!0);return}let y=!1;const b=be(ae,"users",_);return(async()=>{try{const I=await Cn(b);if(I.exists()){const A=I.data().notificationSettings;if(A&&typeof A=="object"){const N=typeof A.allEnabled=="boolean"?A.allEnabled:S,Z=(Array.isArray(A.enabledCategories)?A.enabledCategories:Array.from(C)).filter(xe=>R.includes(xe)),Ee=new Set(N?Z.length>0?Z:R:Z);y||(s(Ee),a(N),u(Ee,N))}else{y||(s(C),a(S),u(C,S));const N={allEnabled:S,enabledCategories:Array.from(C)};await ct(b,{notificationSettings:N})}}else{y||(s(C),a(S),u(C,S));const T={allEnabled:S,enabledCategories:Array.from(C)};await kn(b,{notificationSettings:T},{merge:!0})}}catch(I){console.error("  Firestore  :",I),y||(s(C),a(S))}finally{y||c(!0)}})(),()=>{y=!0}},[e,u]);const h=x.useCallback(R=>{const C=new Set(t),S=C.has(R);S?C.delete(R):C.add(R),s(C),d(C,r);const D=e.find(M=>M.id===R)?.name;J.success(S?`${D}  `:`${D}  `)},[t,e,r,d]),m=x.useCallback(R=>()=>{h(R)},[h]),p=x.useCallback(R=>{if(a(R),R){const C=e.map(D=>D.id),S=new Set(C);s(S),d(S,!0),J.success("  ")}else{const C=new Set;s(C),d(C,!1),J.success("  ")}},[e,d]),w=x.useCallback(()=>{const R=e.map(S=>S.id),C=new Set(R);s(C),d(C,r),J.success("   ")},[e,r,d]),v=x.useCallback(()=>{const R=new Set;s(R),d(R,r),J.success("   ")},[r,d]);x.useCallback(()=>{n()},[n]);const j=x.useCallback(R=>i.jsx(R,{className:"w-4 h-4"}),[]),k=x.useMemo(()=>e.filter(R=>R.id!==""),[e]),P=x.useMemo(()=>t.size,[t]);return o?i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"sm",onClick:n,className:"p-0 h-8 w-8",children:i.jsx(Et,{className:"h-5 w-5"})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(nl,{className:"w-5 h-5"}),i.jsx("h1",{className:"text-lg font-bold",children:" "})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"       ."})]})]})})}),i.jsx("main",{className:"flex-1 overflow-y-auto scrollbar-hide",children:i.jsxs("div",{className:"p-4 space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(bc,{className:"w-4 h-4 text-primary"}),i.jsx("span",{className:"font-medium",children:" "})]}),i.jsx(Fn,{checked:r,onCheckedChange:p})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"      "})]}),i.jsx(yd,{}),r&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h3",{className:"font-medium",children:" "}),i.jsxs("div",{className:"space-x-2",children:[i.jsx(z,{variant:"outline",size:"sm",onClick:w,className:"touch-target px-3 text-xs",children:" "}),i.jsx(z,{variant:"outline",size:"sm",onClick:v,className:"touch-target px-3 text-xs",children:" "})]})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"       "}),i.jsx("div",{className:"space-y-3",children:k.map(R=>i.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[j(R.icon),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:R.name}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[R.count," "]})]})]}),i.jsx(Fn,{checked:t.has(R.id),onCheckedChange:m(R.id)})]},R.id))}),i.jsx("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg",children:i.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[i.jsx(bc,{className:"w-4 h-4"}),i.jsxs("span",{children:[""," ",i.jsxs("span",{className:"font-medium text-primary",children:[P," "]}),"   "]})]})})]}),i.jsx(yd,{}),i.jsx("div",{className:"pt-2",children:i.jsx(z,{onClick:n,className:"w-full",children:""})})]})})]}):i.jsx("div",{className:"w-full h-full flex items-center justify-center",children:i.jsx("span",{className:"text-sm text-muted-foreground",children:"   ..."})})}function kg({children:n,onReport:e,open:t,onOpenChange:s,targetType:r="",onSubmit:a}){const[o,c]=x.useState([]),[u,d]=x.useState(""),[h,m]=x.useState(!1),p=t!==void 0,w=p?t:h,v=x.useCallback(()=>{},[]),j=p?s||v:m,k=[{value:"spam",label:"  "},{value:"harassment",label:"  "},{value:"inappropriate",label:" "},{value:"copyright",label:" "},{value:"misinformation",label:" "},{value:"other",label:""}],P=x.useCallback((b,I)=>{c(T=>I?[...T,b]:T.filter(A=>A!==b))},[]),R=x.useCallback(b=>{d(b.target.value)},[]),C=x.useCallback(()=>{if(o.length===0){J.error("    .");return}const b=a||e;b&&b(o,u),c([]),d(""),j(!1)},[o,u,a,e,j]),S=x.useCallback(()=>{j(!1)},[j]),D=x.useCallback(b=>{b.stopPropagation(),C()},[C]),M=x.useCallback(b=>I=>{P(b,I)},[P]),_=x.useCallback(()=>{j(!1)},[j]),y=x.useCallback(b=>{b.stopPropagation()},[]);return i.jsxs(i.Fragment,{children:[n&&i.jsx("span",{onClick:()=>j(!0),style:{display:"inline-block"},children:n}),w&&i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:_,children:i.jsx("div",{className:"w-[360px] max-w-[90vw] rounded-lg border border-border bg-card p-6 shadow-lg",onClick:y,children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[i.jsx(tl,{className:"w-4 h-4"}),i.jsxs("h2",{className:"text-lg font-semibold",children:[r," "]})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"     . (  )"})]}),i.jsxs("div",{children:[i.jsx(Mt,{className:"text-sm font-medium",children:"  (  )"}),i.jsx("div",{className:"mt-2 space-y-3",children:k.map(b=>i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(yi,{id:b.value,checked:o.includes(b.value),onCheckedChange:M(b.value)}),i.jsx(Mt,{htmlFor:b.value,className:"text-sm cursor-pointer",children:b.label})]},b.value))})]}),i.jsxs("div",{children:[i.jsx(Mt,{htmlFor:"details",className:"text-sm font-medium",children:"  ()"}),i.jsx(To,{id:"details",placeholder:"     ...",value:u,onChange:R,className:"mt-2 min-h-[80px]"})]}),i.jsxs("div",{className:"flex space-x-2 pt-2",children:[i.jsx(z,{variant:"outline",onClick:S,className:"flex-1",children:""}),i.jsx(z,{onClick:D,className:"flex-1",children:""})]})]})})})]})}const tP=[{id:"",name:"",icon:_v,count:0,subCategories:[{id:"",name:"",count:0}]},{id:"",name:"",icon:wv,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:Nu,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:bv,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:$s,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:Ti,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:vv,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:Nu,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0}]}],Cg=Object.freeze([]);function nP({userNickname:n,userProfileImage:e,onProfileImageChange:t,onLogout:s,isDarkMode:r,onToggleDarkMode:a,onRequestExit:o,onShowTerms:c,onShowPrivacy:u,onShowOpenSourceLicenses:d,onShowAttributions:h,shouldOpenMyPageOnMain:m,shouldOpenSettingsOnMyPage:p,onMainScreenReady:w,onSettingsOpenedFromMain:v}){const[j,k]=x.useState("home"),[P,R]=x.useState(null),[C,S]=x.useState("home"),[D,M]=x.useState(""),[_,y]=x.useState(""),[b,I]=x.useState("latest"),[T,A]=x.useState(!1),[N,F]=x.useState(!1),[Z,Ee]=x.useState(!1),[xe,K]=x.useState(!1),[ee,oe]=x.useState(!1),[Ae,je]=x.useState(!1),[ke,De]=x.useState(!1),[Re,Me]=x.useState(!1),[se,Ue]=x.useState(!1),[He,Rt]=x.useState(!1),[Oe,O]=x.useState(null),[ue,re]=x.useState(null),[de,pe]=x.useState(null),[Ke,W]=x.useState(null),[he,Be]=x.useState(null),[Pt,Pn]=x.useState(null),[Dn]=x.useState(tP),[es,ht]=x.useState("profile"),{posts:ze,setPosts:ts}=A1(),{balance:ys,addLumens:Yi,spendLumens:Xi}=T1();x.useEffect(()=>{if(!P)return;const X=ze.find(ce=>ce.id===P.id);X&&X!==P&&R(X)},[ze,P]);const{clampedTrust:ns,updateTrust:nr,addLumensWithTrust:In}=qR({addLumens:Yi}),{userActivity:sr,updateActivity:Vn}=xb(In,(X,ce)=>{gt.addSpecialTitle(X,ce)}),tt=zR({posts:ze,userNickname:n}),[_s,xn]=x.useState("");x.useEffect(()=>{const X=Ne.currentUser?.uid;if(!X){xn("");return}const ce=be(ae,"users",X),ve=Io(ce,Ze=>{if(!Ze.exists()){xn("");return}const jt=Ze.data(),Tn=typeof jt.profileDescription=="string"?jt.profileDescription:"";xn(Tn)},Ze=>{console.error("[MainScreen] users.profileDescription  :",Ze)});return()=>{ve()}},[]);const gt=UR({lumenBalance:ys,spendLumens:Xi}),te=PR({posts:ze,setPosts:ts,selectedPost:P,setSelectedPost:R,userNickname:n,userActivity:sr,updateActivity:Vn,userPostLanterns:tt.userPostLanterns,setUserPostLanterns:tt.setUserPostLanterns,userReplyLanterns:tt.userReplyLanterns,setUserReplyLanterns:tt.setUserReplyLanterns,addLumensWithTrust:In,updateTrust:nr}),Te=DR({userNickname:n}),Pe=MR({userNickname:n});HR(de&&de!==n?de:null);const yn=x.useMemo(()=>{if(!de)return null;const X=ze.find(ce=>ce.author===de&&(typeof ce.authorUid=="string"||typeof ce.uid=="string"));return X?X.authorUid??X.uid??null:null},[de,ze]),rr=No(yn?[yn]:[]),ws=yn?rr[yn]??null:null,Qr=j1({viewedNickname:de,currentUserNickname:n}),Zi=VR({posts:ze,setPosts:ts,selectedPost:P,setSelectedPost:R,userNickname:n,userGuideCount:tt.userGuideCount,setUserGuideCount:tt.setUserGuideCount,addLumensWithTrust:In,updateActivity:Vn,updateTrust:nr}),Dt=FR({posts:ze,setPosts:ts,selectedPost:P,setSelectedPost:R,userNickname:n,clampedTrust:ns,updateActivity:Vn,userProfileImage:e}),bs=BR({posts:ze,onPostSelect:X=>R(X)}),At=$R({posts:ze,setPosts:ts,userNickname:n,userProfileImage:e,clampedTrust:ns,updateActivity:Vn}),ir=x.useCallback((X,ce)=>{S(ce),R(X),At.incrementViews(X.id)},[At]),Wt=x.useCallback(()=>{R(null),A(!1),Me(!1),Ue(!1),je(!1),De(!1),pe(null),re(null),O(null),ht("profile"),M(""),y(""),k("home")},[]),Qt=x.useCallback(()=>{R(null),A(!1),Me(!0),pe(null),re(null),O(null),k("ranking")},[]),Ft=x.useCallback(()=>{R(null),A(!1),Me(!1),pe(null),re(null),O(null),k("bookmarks")},[]),Vt=x.useCallback(()=>{R(null),Me(!1),je(!1),De(!1),Ue(!1),A(!0),pe(null),re(null),O(null),k("profile")},[]),Ml=x.useCallback(()=>{je(!1),De(!1),Ue(!0),A(!1),R(null),k("achievements")},[]);x.useEffect(()=>{m&&(A(!0),k("profile"),w?.())},[m,w]);const _n=x.useRef({showWriteScreen:ee,selectedPost:P,showTitlesCollection:ke,showTitleShop:Ae,showAchievements:se,showMyPage:T,showCategoryScreen:N,showNotificationSettings:xe,showRanking:Re,showGuidelines:He,showMyContentList:ue,showFollowList:Oe,showUserProfile:de,userProfileSection:es,lastUserProfileNickname:Ke,currentScreen:j,postDetailSource:C});x.useEffect(()=>{_n.current={showWriteScreen:ee,selectedPost:P,showTitlesCollection:ke,showTitleShop:Ae,showAchievements:se,showMyPage:T,showCategoryScreen:N,showNotificationSettings:xe,showRanking:Re,showGuidelines:He,showMyContentList:ue,showFollowList:Oe,showUserProfile:de,userProfileSection:es,lastUserProfileNickname:Ke,currentScreen:j,postDetailSource:C}});const Jr=x.useCallback(X=>{const ce=X??_n.current;if(ce.selectedPost){if(ce.postDetailSource==="myPostsList")R(null),re("posts"),A(!1),k("profile");else if(ce.postDetailSource==="myRepliesList")R(null),re("replies"),A(!1),k("profile");else if(ce.postDetailSource==="followList")R(null),O(ce.showFollowList??"followers"),A(!1),k("profile");else if(ce.postDetailSource==="myPage")R(null),A(!0),k("profile");else if(ce.postDetailSource==="userProfilePosts"){R(null);const ve=ce.lastUserProfileNickname??ce.showUserProfile;ve?(pe(ve),ht("posts")):(pe(null),ht("profile")),k("home")}else if(ce.postDetailSource==="userProfileReplies"){R(null);const ve=ce.lastUserProfileNickname??ce.showUserProfile;ve?(pe(ve),ht("replies")):(pe(null),ht("profile")),k("home")}else R(null);S("home")}},[]);x.useEffect(()=>{Oe==="followers"&&Pe.fetchFollowerUsers()},[Oe]),x.useEffect(()=>{let X=null;return(async()=>{X=await Au.addListener("backButton",()=>{const ve=_n.current;if(ve.showWriteScreen){oe(!1);return}if(ve.selectedPost){Jr(ve);return}if(ve.showTitlesCollection){De(!1),A(!0);return}if(ve.showTitleShop){je(!1);return}if(ve.showAchievements){Ue(!1),A(!0);return}if(ve.showUserProfile){ve.userProfileSection&&ve.userProfileSection!=="profile"?ht("profile"):pe(null);return}if(ve.showMyContentList){re(null),A(!0),k("profile");return}if(ve.showFollowList){O(null),A(!0),k("profile");return}if(ve.showMyPage){A(!1),k("home");return}if(ve.showGuidelines){Rt(!1);return}if(ve.showCategoryScreen){F(!1);return}if(ve.showRanking){Me(!1),k("home");return}ve.currentScreen==="home"&&!ve.selectedPost&&o?.()})})(),()=>{X?.remove()}},[o]);const Bt=x.useCallback(()=>{At.handleStartWriting(()=>{oe(!0),A(!1),Me(!1),Ue(!1),je(!1)})},[At]),ea=x.useCallback(async X=>{const ce=await At.createPost(X);ce&&(oe(!1),R(ce))},[At]),Yr=x.useCallback(X=>{pe(X)},[]),jo=x.useCallback(X=>Dt.renderContentWithMentions(X??"",Yr),[Dt,Yr]);if(T){const X=ze.filter(Ze=>Ze.author===n),ce=ze.flatMap(Ze=>(Ze.replies??[]).filter(jt=>jt.author===n).map(jt=>({...jt,postTitle:Ze.title,postAuthor:Ze.author,postId:Ze.id}))),ve=ze.filter(Ze=>Te.isBookmarked(Ze.id));return i.jsxs("div",{className:`w-full h-full ${r?"dark":""}`,children:[i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx(V1,{userNickname:n,userProfileImage:e,onProfileImageChange:t,onBack:()=>{A(!1),k("home")},onLogout:s,isDarkMode:r,onToggleDarkMode:a,onShowTerms:c,onShowPrivacy:u,onShowGuidelines:()=>Rt(!0),onShowOpenSourceLicenses:d,onShowAttributions:h,userPosts:X,userReplies:ce,bookmarkedPosts:ve,currentTitle:gt.currentTitle,userGuideCount:tt.userGuideCount,trustScore:ns,profileDescription:_s,onProfileDescriptionChange:xn,onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onWriteClick:Bt,onTitleShopClick:()=>{De(!1),Ue(!1),je(!0)},onAchievementsClick:Ml,onTitlesCollectionClick:()=>{je(!1),De(!0),A(!1)},followerCount:Pe.followerCount,followingCount:Pe.followingCount,onFollowerCardClick:()=>{O("followers"),A(!1)},onFollowingCardClick:()=>{O("following"),A(!1)},onMyPostsCardClick:()=>{re("posts"),A(!1)},onMyRepliesCardClick:()=>{re("replies"),A(!1)},onPostClick:Ze=>{const jt=ze.find(Tn=>Tn.id===Ze);jt&&(ir(jt,"myPage"),re(null),A(!1),k("home"))},onReplyClick:Ze=>{const jt=ze.find(Tn=>Tn.id===Ze);jt&&(S("myPage"),R(jt),re(null),A(!1),k("home"))},autoOpenSettings:p,onAutoSettingsOpened:v}),i.jsx(Mn,{onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onMyPageClick:Vt,onWriteClick:Bt,activeTab:j})]}),i.jsx(el,{open:At.showPostWarning,onOpenChange:At.setShowPostWarning,title:"  ",description:"  30    ",confirmText:"",onConfirm:()=>{At.handleWarningConfirm(()=>{A(!1),oe(!0)})},checkbox:At.checkboxConfig}),He&&i.jsx("div",{className:"fixed inset-0 z-50 bg-background",children:i.jsx(fd,{onBack:()=>Rt(!1),isAlreadyAgreed:!0})})]})}if(N)return i.jsx(L1,{onBack:()=>F(!1),categories:Dn,activeCategory:D,activeSubCategory:_,onCategorySelect:(X,ce)=>{M(X),y(ce||"")},posts:ze,onPostSelect:X=>{R(X),F(!1)}});if(Ae)return i.jsx("div",{className:`w-full h-full ${r?"dark":""}`,children:i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide",children:i.jsx(z1,{onBack:()=>je(!1),userLumens:ys,userPostLanterns:tt.userPostLanterns,userReplyLanterns:tt.userReplyLanterns,userGuideCount:tt.userGuideCount,ownedTitles:gt.ownedTitles,currentTitle:gt.currentTitle,onTitlePurchase:gt.handleTitlePurchase,onTitleEquip:gt.handleTitleEquip})}),i.jsx(Mn,{onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onMyPageClick:Vt,onWriteClick:Bt,activeTab:j})]})});if(de){const X=ze.filter(Jt=>Jt.author===de),ce=de===n,ve=ce?Pe.followerCount:Qr?.followerCount??0,Ze=ce?Pe.followingCount:Qr?.followingCount??0,jt=ce?Pe.followerUsers:Qr?.followerUsers??Cg,Tn=ce?Pe.followingUsers:Qr?.followingUsers??Cg;return i.jsx("div",{className:`w-full h-full ${r?"dark":""}`,children:i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx(Z1,{onBack:()=>{es!=="profile"?ht("profile"):pe(null)},username:de,userAvatar:ce?e:ws?.profileImage??X[0]?.authorAvatar??"",userBio:ce?_s:ws?.profileDescription??"",posts:X,trustScore:ce?ns:void 0,reportCount:0,achievementCount:0,titleCount:0,guideCount:0,followerCount:ve,followingCount:Ze,followerUsers:jt,followingUsers:Tn,onPostClick:Jt=>{const on=ze.find(ar=>ar.id===Jt);on&&(S("userProfilePosts"),W(de),O(null),A(!1),R(on),pe(null))},onReplyClick:Jt=>{const on=ze.find(ar=>ar.id===Jt);on&&(S("userProfileReplies"),W(de),O(null),A(!1),R(on),pe(null))},isMyself:ce,isFollowing:Pe.isFollowing(de),onToggleFollowUser:Pe.handleToggleFollowUser,onFollowUserClick:Jt=>{ht("profile"),W(Jt),pe(Jt)},activeSection:es,onChangeSection:ht}),i.jsx(Mn,{activeTab:j,onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onMyPageClick:Vt,onWriteClick:Bt})]})})}if(ke)return i.jsx("div",{className:`w-full h-full ${r?"dark":""}`,children:i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx("div",{className:"flex-1 overflow-y-auto",children:i.jsx(G1,{onBack:()=>{De(!1),A(!0),k("profile")},userTitles:gt.ownedTitles,equippedTitle:gt.currentTitle,onTitleEquip:gt.handleTitleEquip,onTitleUnequip:gt.handleTitleUnequip})}),i.jsx(Mn,{onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onMyPageClick:Vt,onWriteClick:Bt,activeTab:j})]})});if(Oe){const X=Oe==="followers"?Pe.followerUsersDetailed:Pe.followingUsersDetailed;return i.jsx("div",{className:`w-full h-full ${r?"dark":""}`,children:i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx(wd,{mode:Oe,users:X,onBack:()=>{O(null),A(!0),k("profile")},onUserClick:ce=>{ht("profile"),W(ce),pe(ce)}}),i.jsx(Mn,{onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onMyPageClick:Vt,onWriteClick:Bt,activeTab:j})]})})}return ue?i.jsx("div",{className:`w-full h-full ${r?"dark":""}`,children:i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx(bd,{mode:ue,onBack:()=>{re(null),A(!0),k("profile")},posts:ze.filter(X=>X.author===n),replies:ze.flatMap(X=>(X.replies??[]).filter(ce=>ce.author===n).map(ce=>({...ce,postTitle:X.title,postAuthor:X.author,postId:X.id,postAuthorUid:typeof X.authorUid=="string"?X.authorUid:typeof X.uid=="string"?X.uid:null}))),onPostClick:X=>{const ce=ze.find(ve=>ve.id===X);ce&&(S(ue==="posts"?"myPostsList":"myRepliesList"),R(ce),re(null),A(!1),k("home"))},onReplyClick:(X,ce)=>{const ve=ze.find(Ze=>Ze.id===X);ve&&(S("myRepliesList"),R(ve),re(null),A(!1),k("home"))}}),i.jsx(Mn,{onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onMyPageClick:Vt,onWriteClick:Bt,activeTab:j})]})}):Re?i.jsx("div",{className:`w-full h-full ${r?"dark":""}`,children:i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx(H1,{onBack:()=>{Me(!1),k("home")},weeklyGuideRanking:tt.weeklyGuideRanking,totalGuideRanking:tt.totalGuideRanking,weeklyLanternRanking:tt.weeklyLanternRanking}),i.jsx(Mn,{onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onMyPageClick:Vt,onWriteClick:Bt,activeTab:j})]})}):se?i.jsx("div",{className:`w-full h-full ${r?"dark":""}`,children:i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx(W1,{onBack:()=>{Ue(!1),A(!0),k("profile")},userNickname:n,isDarkMode:r}),i.jsx(Mn,{onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onMyPageClick:Vt,onWriteClick:Bt,activeTab:j})]})}):j==="bookmarks"?i.jsx("div",{className:`w-full h-full ${r?"dark":""}`,children:i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx(Q1,{onBack:()=>{k("home")},bookmarkedPosts:Te.bookmarkedPosts,posts:ze,onPostSelect:X=>{R(X)},userNickname:n,currentTitle:gt.currentTitle}),i.jsx(Mn,{onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onMyPageClick:Vt,onWriteClick:Bt,activeTab:j})]})}):ee?i.jsx(q1,{onBack:()=>oe(!1),onSubmit:ea,categories:Dn}):Z?i.jsx(B1,{onBack:()=>Ee(!1),posts:ze,onPostSelect:X=>{R(X),Ee(!1)}}):i.jsxs("div",{className:`w-full h-full ${r?"dark":""}`,children:[i.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[i.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:P?i.jsx(KR,{post:P,userNickname:n,userProfileImage:e,currentTitle:gt.currentTitle,isDarkMode:r,isPostLanterned:te.isPostLanterned(P.id),isReplyLanterned:te.isReplyLanterned,onLanternToggle:()=>te.handleLanternToggle(P.id),onReplyLanternToggle:te.handleReplyLanternToggle,isBookmarked:Te.isBookmarked(P.id),onBookmarkToggle:()=>Te.handleBookmarkToggle(P.id),isGuideReply:Zi.isGuideReply,hasGuide:Zi.hasGuide(P.id),onGuideSelect:Zi.handleGuideSelect,newReplyContent:Dt.newReplyContent,onReplyContentChange:Dt.handleReplyContentChange,onReplySubmit:Dt.handleReplySubmit,replyInputRef:Dt.replyInputRef,onClose:()=>Jr(),onAuthorClick:()=>{ht("profile"),W(P.author),pe(P.author)},onMentionAuthor:()=>Dt.handleInsertMention(P.author),onMentionReplyAuthor:Dt.handleInsertMention,onReplyAuthorClick:X=>{ht("profile"),W(X),pe(X)},onReport:()=>Be(P),onDelete:()=>{At.deletePost(P.id),Jr()},onReportReply:X=>Pn(X),renderContentWithMentions:jo,canSubmitReply:Dt.canSubmitReply}):i.jsxs(i.Fragment,{children:[i.jsx(ZR,{isDarkMode:r,onToggleDarkMode:a,hasNotifications:bs.hasNotifications,showNotifications:bs.showNotifications,onNotificationsToggle:bs.setShowNotifications,notifications:bs.notifications,onNotificationClick:bs.handleNotificationClick,onMarkAllNotificationsRead:bs.handleMarkAllNotificationsRead,onNotificationSettingsClick:()=>K(!0),activeCategory:D,activeSubCategory:_,onCategoryClick:()=>F(!0),onGuidelinesClick:()=>Rt(!0),onTitleShopClick:()=>je(!0)}),i.jsx(YR,{posts:ze,userNickname:n,userProfileImage:e,activeCategory:D,activeSubCategory:_,sortBy:b,categories:Dn,onSubCategoryChange:y,onSortChange:I,isPostLanterned:te.isPostLanterned,isBookmarked:Te.isBookmarked,onPostClick:X=>ir(X,"home"),onLanternToggle:te.handleLanternToggle,onBookmarkToggle:Te.handleBookmarkToggle,onStartWriting:Bt,currentTitle:gt.currentTitle})]})}),i.jsx(Mn,{onHomeClick:Wt,onRankingClick:Qt,onBookmarksClick:Ft,onMyPageClick:Vt,onWriteClick:Bt,activeTab:j})]}),xe&&i.jsx("div",{className:"fixed inset-0 z-50 bg-background",children:i.jsx(eP,{onBack:()=>K(!1),categories:Dn})}),he&&i.jsx(kg,{open:!!he,onOpenChange:X=>!X&&Be(null),targetType:"",onSubmit:async(X,ce)=>{if(he)try{const ve=Ne.currentUser?.uid??null;await cd(sn(ae,"reports"),{targetType:"post",targetId:he.id,targetAuthorUid:he.authorUid??he.uid??null,reporterUid:ve,reasons:X,details:ce,createdAt:Yt(),status:"pending",autoHidden:!1,priority:"normal"}),J.success(" .   .")}catch(ve){console.error("[report]    ",ve),J.error("    .    .")}finally{Be(null)}}}),Pt&&i.jsx(kg,{open:!!Pt,onOpenChange:X=>!X&&Pn(null),targetType:"",onSubmit:async(X,ce)=>{if(Pt)try{const ve=Ne.currentUser?.uid??null;await cd(sn(ae,"reports"),{targetType:"reply",targetId:String(Pt.id),targetAuthorUid:Pt.authorUid??null,reporterUid:ve,reasons:X,details:ce,createdAt:Yt(),status:"pending",autoHidden:!1,priority:"normal"}),J.success(" .   .")}catch(ve){console.error("[report]    ",ve),J.error("    .    .")}finally{Pn(null)}}}),He&&i.jsx("div",{className:"fixed inset-0 z-50 bg-background",children:i.jsx(fd,{onBack:()=>Rt(!1),isAlreadyAgreed:!0})}),i.jsx(el,{open:At.showPostWarning,onOpenChange:At.setShowPostWarning,title:"  ",description:"  30    ",confirmText:"",onConfirm:()=>{At.handleWarningConfirm(()=>{oe(!0)})},checkbox:At.checkboxConfig})]})}const Sg={stroke:"currentColor",fill:"none",display:"block"};function sP({onBack:n}){return i.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-y-auto scrollbar-hide",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border sticky top-0 z-20",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",onClick:n,className:"touch-target",children:i.jsx(Et,{className:"w-5 h-5",style:Sg})}),i.jsxs("h1",{className:"flex items-center gap-2",children:[i.jsx(Xg,{className:"w-5 h-5",style:Sg})," "]})]})})}),i.jsxs("div",{className:"p-4 space-y-6 pb-20",children:[i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"1.     "})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:'( "")     .         ,       18         .'}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsx("p",{children:"    :   ,   "}),i.jsx("p",{children:"  :  ,   "}),i.jsx("p",{children:"  :  ,  ,   "}),i.jsx("p",{children:"   :   ,   "})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"2.   "})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"     :"}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsx("p",{children:i.jsx("strong",{children:" :"})}),i.jsx("p",{className:"pl-4",children:"   (  )"}),i.jsx("p",{className:"pl-4",children:" "}),i.jsx("p",{className:"pl-4",children:"   ()"}),i.jsx("br",{}),i.jsx("p",{children:i.jsx("strong",{children:"  :"})}),i.jsx("p",{className:"pl-4",children:"   "}),i.jsx("p",{className:"pl-4",children:"  "}),i.jsx("p",{className:"pl-4",children:"     "})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"3.     "})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"               ."}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsxs("p",{children:[" ",i.jsx("strong",{children:" :"}),"    (  )"]}),i.jsxs("p",{children:[" ",i.jsx("strong",{children:"  :"}),'   :   30   / ,      " "  .']}),i.jsxs("p",{children:[" ",i.jsx("strong",{children:"  :"}),"     "]}),i.jsxs("p",{children:[" ",i.jsx("strong",{children:"  :"}),"    "]})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"4.   "})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"       :"}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsxs("p",{children:[" ",i.jsx("strong",{children:" :"}),"     "]}),i.jsxs("p",{children:[" ",i.jsx("strong",{children:" :"}),"   "]})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"5.  3 "})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"   3  . ,    :"}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsx("p",{children:"    "}),i.jsx("p",{children:"   ,           "})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"6.    "})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"             :"}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsx("p",{children:"   "}),i.jsx("p",{children:"      "}),i.jsx("p",{children:"  "}),i.jsx("p",{children:"   "})]}),i.jsx("p",{className:"mt-4",children:'     " "  ""  " "   ,     .'})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"7.         "})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"     (Local Storage) .     ,       ."}),i.jsxs("div",{className:"pl-4 space-y-2 mt-3",children:[i.jsx("p",{children:i.jsx("strong",{children:" :"})}),i.jsx("p",{className:"pl-4",children:"   "}),i.jsx("p",{className:"pl-4",children:"    ( )"}),i.jsx("p",{className:"pl-4",children:"    "}),i.jsx("p",{className:"pl-4",children:"   "})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"8.  "})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"      ,               :"}),i.jsxs("div",{className:"pl-4 space-y-2 mt-3",children:[i.jsxs("p",{children:[" ",i.jsx("strong",{children:" :"}),"  "]}),i.jsxs("p",{children:[" ",i.jsx("strong",{children:":"})," stillimproving0@gmail.com"]})]}),i.jsx("p",{className:"mt-4 text-muted-foreground text-xs",children:"         , ,         ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"9.   "})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"   2025 1 1 ,      ,        7     ."}),i.jsxs("p",{className:"mt-4 text-muted-foreground",children:[i.jsx("strong",{children:":"})," 2025 1 1",i.jsx("br",{}),i.jsx("strong",{children:":"})," 2025 1 1"]})]})]}),i.jsx($,{className:"border-primary/20 bg-primary/5",children:i.jsx(q,{className:"pt-6",children:i.jsxs("p",{className:"text-xs text-muted-foreground leading-relaxed",children:[i.jsx("strong",{className:"text-foreground",children:" :"}),i.jsx("br",{}),"   (PII)       .     ,   .      ."]})})})]})]})}const Rg={stroke:"currentColor",fill:"none",display:"block"};function rP({onBack:n}){return i.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-y-auto scrollbar-hide",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border sticky top-0 z-20",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"ghost",size:"icon",onClick:n,className:"touch-target",children:i.jsx(Et,{className:"w-5 h-5",style:Rg})}),i.jsxs("h1",{className:"flex items-center gap-2",children:[i.jsx(Bn,{className:"w-5 h-5",style:Rg}),""]})]})})}),i.jsxs("div",{className:"p-4 space-y-6 pb-20",children:[i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"1 ()"})}),i.jsx(q,{className:"space-y-3 text-sm leading-relaxed",children:i.jsx("p",{children:'  ( "")   ( "")     ,   ,      .'})})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"2 ()"})}),i.jsx(q,{className:"space-y-3 text-sm leading-relaxed",children:i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsx("p",{children:'1. ""  (PC,      )  ""        .'}),i.jsx("p",{children:'2. ""           .'}),i.jsx("p",{children:'3. ""      (ID)   .'}),i.jsx("p",{children:'4. "" "" ""   ""  , ,       .'}),i.jsx("p",{children:'5. ""         .'}),i.jsx("p",{children:'6. ""   10 1   ,   .'})]})})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"3 (  )"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"1.             ."}),i.jsx("p",{children:"2.     ,                  ."}),i.jsx("p",{children:"3.           1      7    ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"4 (   )"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"    :"}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsx("p",{children:"1.     "}),i.jsx("p",{children:"2.   "}),i.jsx("p",{children:"3.   "}),i.jsx("p",{children:"4.     "}),i.jsx("p",{children:"5.   "}),i.jsx("p",{children:"6.    "})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"5 ( )"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"1.          , 1 24   ."}),i.jsx("p",{children:"2.       ,             ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"6 ()"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"1.                ."}),i.jsx("p",{children:"2.  1               :"}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsx("p",{children:"          "}),i.jsx("p",{children:"   , ,   "}),i.jsx("p",{children:"           "})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"7 (     )"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"1.           ."}),i.jsx("p",{children:"2.       ,       :"}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsx("p",{children:"       "}),i.jsx("p",{children:"             "}),i.jsx("p",{children:"            "})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"8 (  )"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"1.      ,          ."}),i.jsx("p",{children:"2.       7         ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"9 (   )"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"1.          ."}),i.jsx("p",{children:"2.               ,        , ,    ."}),i.jsx("p",{children:"3.  2        , ,        ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"10 (  ) "})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{className:"font-medium text-primary",children:"         :"}),i.jsxs("div",{className:"pl-4 space-y-2 mt-3",children:[i.jsxs("p",{children:["1. ",i.jsx("strong",{children:"  :"}),"    30  ,     ."]}),i.jsxs("p",{children:["2. ",i.jsx("strong",{children:"  :"}),"       ."]}),i.jsxs("p",{children:["3. ",i.jsx("strong",{children:" :"}),"        :"]}),i.jsxs("div",{className:"pl-4 space-y-1",children:[i.jsx("p",{children:"   "}),i.jsx("p",{children:"    "}),i.jsx("p",{children:"   "}),i.jsx("p",{children:"      "})]})]}),i.jsx("p",{className:"mt-4 text-muted-foreground text-xs",children:"       ,     ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"11 (   )"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsxs("p",{children:["1. ",i.jsx("strong",{children:" :"}),"         ."]}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsx("p",{children:"  :   ."}),i.jsx("p",{children:"  :    (10  1)."})]}),i.jsxs("p",{className:"mt-3",children:["2. ",i.jsx("strong",{children:":"}),"       ,     ."]}),i.jsxs("p",{className:"mt-3",children:["3. ",i.jsx("strong",{children:" :"}),"            ,     5 ."]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"12 ( )"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"1.       ."}),i.jsx("p",{children:"2.      8 ,     ."}),i.jsx("p",{children:"3.     ,    ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"13 ()"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"     :"}),i.jsxs("div",{className:"pl-4 space-y-2",children:[i.jsx("p",{children:"1.       "}),i.jsx("p",{children:"2.   "}),i.jsx("p",{children:"3.    "}),i.jsx("p",{children:"4.     (  )    "}),i.jsx("p",{children:"5.   3     "}),i.jsx("p",{children:"6.   3     "}),i.jsx("p",{children:"7.    , , ,         "}),i.jsx("p",{children:"8. , ,       "}),i.jsx("p",{children:"9. ,   "}),i.jsx("p",{children:"10.       "})]})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"14 ()"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"1.                 ."}),i.jsx("p",{children:"2.           ."}),i.jsx("p",{children:"3.              ."}),i.jsx("p",{children:"4.    , ,  ,       ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"15 ()"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"1.             ."}),i.jsx("p",{children:"2.                    ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"16 (  )"})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"1.             ,        ."}),i.jsx("p",{children:"2.         ."})]})]}),i.jsx($,{className:"border-primary/20 bg-primary/5",children:i.jsx(q,{className:"pt-6",children:i.jsxs("p",{className:"text-sm leading-relaxed",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),i.jsx("span",{className:"text-muted-foreground",children:"  2025 1 1 ."})]})})})]})]})}const iP=({isDarkMode:n=!1,...e})=>i.jsx($b,{theme:n?"dark":"light",className:"toaster group",closeButton:!1,richColors:!0,position:"top-center",duration:2e3,...e}),Pg={stroke:"currentColor",fill:"none",display:"block"};function aP({onBack:n}){return i.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-y-auto scrollbar-hide",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border sticky top-0 z-20 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"outline",size:"icon",onClick:n,className:`\r
                                touch-target\r
                                bg-gray-200 text-gray-800 hover:bg-gray-300\r
                                dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600\r
                                border-none shadow-none\r
                                `,children:i.jsx(Et,{className:"w-5 h-5",style:Pg})}),i.jsxs("h1",{className:"flex items-center gap-2",children:[i.jsx(Bn,{className:"w-5 h-5",style:Pg})," "]})]})})}),i.jsxs("div",{className:"p-4 space-y-6 pb-20",children:[i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:""})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"      ,    ."}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"     .        ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"1. shadcn/ui (MIT License)"})}),i.jsxs(q,{className:"space-y-2 text-sm leading-relaxed",children:[i.jsx("p",{children:"UI   shadcn/ui     ."}),i.jsxs("ul",{className:"list-disc pl-4 text-muted-foreground space-y-1",children:[i.jsx("li",{children:"    "}),i.jsx("li",{children:"  "}),i.jsx("li",{children:"        "})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"  shadcn/ui GitHub  LICENSE   ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"2. Lucide Icons / lucide-react (ISC & MIT)"})}),i.jsxs(q,{className:"space-y-2 text-sm leading-relaxed",children:[i.jsx("p",{children:"     Lucide   ."}),i.jsxs("ul",{className:"list-disc pl-4 text-muted-foreground space-y-1",children:[i.jsx("li",{children:"ISC   Feather   MIT "}),i.jsx("li",{children:" , ,  "}),i.jsx("li",{children:"       "})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"  lucide.dev   GitHub  LICENSE  ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"3.   "})}),i.jsxs(q,{className:"space-y-4 text-sm text-muted-foreground",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-foreground mb-1",children:"  / "}),i.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[i.jsx("li",{children:"React, React DOM (MIT)"}),i.jsx("li",{children:"Vite (MIT)"}),i.jsx("li",{children:"@capacitor/app (MIT)"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-foreground mb-1",children:"UI    "}),i.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[i.jsxs("li",{children:["Radix UI Primitives",i.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:"(@radix-ui/react-accordion , MIT)"})]}),i.jsx("li",{children:"Vaul    (MIT)"}),i.jsx("li",{children:"Embla Carousel React    (MIT)"}),i.jsx("li",{children:"React Day Picker    (MIT)"}),i.jsx("li",{children:"React Resizable Panels    (MIT)"}),i.jsx("li",{children:"cmdk     (MIT)"}),i.jsx("li",{children:"input-otp  OTP   (MIT)"}),i.jsx("li",{children:"Lucide React    (ISC & MIT)"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-foreground mb-1",children:"    "}),i.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[i.jsx("li",{children:"React Hook Form   / (MIT)"}),i.jsxs("li",{children:["Class Variance Authority (CVA)",i.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:"(Apache-2.0)"})]}),i.jsx("li",{children:"clsx  className  (MIT)"}),i.jsx("li",{children:"tailwind-merge  Tailwind   (MIT)"}),i.jsx("li",{children:"date-fns    (MIT)"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-foreground mb-1",children:"    "}),i.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[i.jsx("li",{children:"Motion    (MIT)"}),i.jsx("li",{children:"Recharts  /  (MIT)"}),i.jsx("li",{children:"Sonner  /  (MIT)"})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"    ,      .   LICENSE        ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"4.  "})}),i.jsxs(q,{className:"space-y-2 text-sm leading-relaxed",children:[i.jsx("p",{children:"       ,       LICENSE  ."}),i.jsxs("p",{children:["    (:"," ",i.jsx("code",{className:"text-xs",children:"third-party-licenses.txt"}),")   ,             ."]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"        ,          ."})]})]})]})]})}const Dg={stroke:"currentColor",fill:"none",display:"block"};function oP({onBack:n}){return i.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-y-auto scrollbar-hide",children:[i.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border sticky top-0 z-20 safe-top",children:i.jsx("div",{className:"px-4 py-3",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(z,{variant:"outline",size:"icon",onClick:n,className:`\r
                                touch-target\r
                                bg-gray-200 text-gray-800 hover:bg-gray-300\r
                                dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600\r
                                border-none shadow-none\r
                                `,children:i.jsx(Et,{className:"w-5 h-5",style:Dg})}),i.jsxs("h1",{className:"flex items-center gap-2",children:[i.jsx(Iv,{className:"w-5 h-5",style:Dg})," "]})]})})}),i.jsxs("div",{className:"p-4 space-y-6 pb-20",children:[i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:""})}),i.jsxs(q,{className:"space-y-3 text-sm leading-relaxed",children:[i.jsx("p",{children:"         ."}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"        .        ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"1. Unsplash "})}),i.jsxs(q,{className:"space-y-2 text-sm leading-relaxed",children:[i.jsx("p",{children:"     Unsplash     ."}),i.jsxs("ul",{className:"list-disc pl-4 text-muted-foreground space-y-1",children:[i.jsx("li",{children:"    "}),i.jsx("li",{children:"   "}),i.jsx("li",{children:"Unsplash     "})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"  Unsplash     ."})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"2. "})}),i.jsxs(q,{className:"space-y-2 text-sm leading-relaxed",children:[i.jsx("p",{children:"   Lucide      ."}),i.jsx("p",{className:"text-xs text-muted-foreground",children:'    " "    .'})]})]}),i.jsxs($,{className:"border-border",children:[i.jsx(ge,{children:i.jsx(ye,{children:"3.  "})}),i.jsxs(q,{className:"space-y-2 text-sm leading-relaxed",children:[i.jsx("p",{children:"   UI , ,      ,    ."}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"      ,       ."})]})]})]})]})}async function cP(n){const e=Ne.currentUser;if(!e)throw new Error("  .");const t=e.uid,s=_R(NR,`profileImages/${t}`);await xR(s,n);const r=await yR(s);return await rT(e,{photoURL:r}),await kn(be(ae,"users",t),{photoURL:r,updatedAt:Yt()},{merge:!0}),r}const fe={getItem:n=>{try{return localStorage.getItem(n)}catch(e){return console.error("localStorage getItem error:",e),null}},setItem:(n,e)=>{try{localStorage.setItem(n,e)}catch(t){console.error("localStorage setItem error:",t)}},removeItem:n=>{try{localStorage.removeItem(n)}catch(e){console.error("localStorage removeItem error:",e)}}},Xo=(n,e)=>`${e}_${n}`,Iu=()=>Ne.currentUser?.uid||null;function lP(){const[n,e]=x.useState("login"),[t,s]=x.useState("login"),[r,a]=x.useState(!1),[o,c]=x.useState(!1),[u,d]=x.useState(""),[h,m]=x.useState(""),[p,w]=x.useState(""),[v,j]=x.useState(!1),[k,P]=x.useState(!0),[R,C]=x.useState(!0),[S,D]=x.useState(!1),[M,_]=x.useState(null),[y,b]=x.useState(!1),I=x.useRef(n);x.useEffect(()=>{I.current=n},[n]),Ao(),x.useEffect(()=>{const O=ue=>{const re=ue.state;re?.screen?e(re.screen):(D(!0),window.history.pushState({screen:I.current},""))};return window.addEventListener("popstate",O),()=>{window.removeEventListener("popstate",O)}},[]),x.useEffect(()=>{R||window.history.replaceState({screen:n},"")},[n,R]),x.useEffect(()=>{const O=()=>{const ue=!navigator.onLine;b(ue),ue||_(re=>re&&(re.includes("")||re.includes("")?null:re))};return O(),window.addEventListener("online",O),window.addEventListener("offline",O),()=>{window.removeEventListener("online",O),window.removeEventListener("offline",O)}},[]),x.useEffect(()=>{if(n==="main")return;let O=null;return(async()=>{O=await Au.addListener("backButton",()=>{const re=I.current;if(re==="login"){D(!0);return}if(re==="privacy"||re==="terms"){e(t);return}if(re==="nickname"){console.log("    Firebase "),su(Ne).catch(de=>{console.error("Firebase signOut error:",de)}),m(""),w(""),fe.removeItem("currentUserUID"),fe.removeItem("userEmail"),fe.removeItem("userProfileImage"),e("login");return}if(re==="guidelines"){D(!0);return}if(re==="welcome"){e("guidelines");return}})})(),()=>{O&&O.remove()}},[n,t]);const T=x.useCallback(()=>{P(O=>{const ue=!O;return fe.setItem("darkMode",ue.toString()),document.documentElement.classList.toggle("dark",ue),ue})},[]),A=x.useCallback(async O=>{console.log("[App] processAuthenticatedUser ",O.uid),j(!0);const ue=Xo(O.uid,"userNickname"),re=Xo(O.uid,"onboardingComplete"),de=fe.getItem(ue),pe=fe.getItem(re)==="true";try{console.log(`[${O.uid}] Firestore    `);const Ke=be(ae,"users",O.uid),W=await Cn(Ke);if(W.exists()){const he=W.data(),Be=he?.nickname,Pt=he?.onboardingComplete===!0||he?.communityGuidelinesAgreed===!0;if(Be&&Pt){console.log(`[${O.uid}] Firestore   :`,Be),d(Be),m(O.email||""),O.photoURL&&w(O.photoURL),fe.setItem(ue,Be),fe.setItem(re,"true"),fe.setItem("isLoggedIn","true"),fe.setItem("currentUserUID",O.uid),O.email&&fe.setItem("userEmail",O.email),O.photoURL&&fe.setItem("userProfileImage",O.photoURL),e("main"),j(!1);return}if(Be&&!Pt){console.log(`[${O.uid}] Firestore       `),d(Be),m(O.email||""),O.photoURL&&w(O.photoURL),fe.setItem(ue,Be),fe.setItem("currentUserUID",O.uid),O.email&&fe.setItem("userEmail",O.email),O.photoURL&&fe.setItem("userProfileImage",O.photoURL),e("guidelines"),j(!1);return}console.log(`[${O.uid}] Firestore   nickname     `),m(O.email||""),O.photoURL&&(w(O.photoURL),fe.setItem("userProfileImage",O.photoURL)),fe.setItem("currentUserUID",O.uid),e("nickname"),j(!1);return}if(console.log(`[${O.uid}] Firestore    localStorage   `),de&&pe){console.log(`[${O.uid}] localStorage      Firestore    `),d(de),m(O.email||""),O.photoURL&&w(O.photoURL);const he=O.photoURL??p??"";await kn(Ke,{email:O.email??"",nickname:de,photoURL:he,profileImage:he,onboardingComplete:!0,communityGuidelinesAgreed:!0,updatedAt:Yt()},{merge:!0}),fe.setItem("isLoggedIn","true"),fe.setItem("currentUserUID",O.uid),fe.setItem(ue,de),fe.setItem(re,"true"),O.email&&fe.setItem("userEmail",O.email),O.photoURL&&fe.setItem("userProfileImage",O.photoURL),e("main"),j(!1);return}if(de&&!pe){console.log(`[${O.uid}] localStorage     `),d(de),m(O.email||""),O.photoURL&&w(O.photoURL),fe.setItem("currentUserUID",O.uid),O.email&&fe.setItem("userEmail",O.email),O.photoURL&&fe.setItem("userProfileImage",O.photoURL),e("guidelines"),j(!1);return}console.log(`[${O.uid}] Firestore/       `),m(O.email||""),O.photoURL&&(w(O.photoURL),fe.setItem("userProfileImage",O.photoURL)),fe.setItem("currentUserUID",O.uid),e("nickname"),j(!1);return}catch(Ke){if(console.error(`[${O.uid}] Firestore     localStorage  `,Ke),_("     .       ."),de&&pe){console.log(`[${O.uid}] Firestore  localStorage      `),d(de),m(O.email||""),O.photoURL&&w(O.photoURL),fe.setItem("isLoggedIn","true"),fe.setItem("currentUserUID",O.uid),e("main"),j(!1);return}m(O.email||""),O.photoURL&&w(O.photoURL),fe.setItem("currentUserUID",O.uid),e(de?"guidelines":"nickname"),j(!1)}},[]);x.useEffect(()=>{const O=fe.getItem("darkMode"),ue=O!==null?O==="true":!0;P(ue),document.documentElement.classList.toggle("dark",ue);const re=Ne.onAuthStateChanged(async de=>{if(!de){e("login"),C(!1);return}try{await A(de)}catch(pe){console.error("[App] onAuthStateChanged   :",pe),e("login")}finally{C(!1)}});return()=>re()},[A]);const N=x.useCallback(async O=>{console.log("[App] handleGoogleLogin ",O.uid),await A(O)},[A]),F=x.useCallback(async O=>{console.log("[App] handleNicknameComplete ",O);const ue=Iu();if(!ue){console.error("  :   ");return}d(O);const re=Xo(ue,"userNickname");fe.setItem(re,O),console.log(`[${ue}]    :`,O);try{const de=be(ae,"users",ue);await kn(de,{nickname:O,updatedAt:Yt()},{merge:!0}),console.log(`[${ue}] Firestore   `)}catch(de){console.error(`[${ue}] Firestore    (  ):`,de)}e("guidelines"),window.history.pushState({screen:"guidelines"},"")},[]),Z=x.useCallback(async()=>{const O=Iu();if(console.log(` [handleGuidelinesComplete]  - UID: ${O}, : ${u}`),!O){console.error(" Firestore  :   "),fe.setItem("isLoggedIn","true"),e("welcome"),window.history.pushState({screen:"welcome"},"");return}const ue=Xo(O,"onboardingComplete"),re=Ne.currentUser;if(!re){console.error(" Firebase Auth  "),fe.setItem(ue,"true"),fe.setItem("isLoggedIn","true"),e("welcome"),window.history.pushState({screen:"welcome"},"");return}if(!u){console.error("  "),fe.setItem(ue,"true"),fe.setItem("isLoggedIn","true"),e("welcome"),window.history.pushState({screen:"welcome"},"");return}console.log(` [${O}] Firestore  :`,{email:re.email??h??"",nickname:u,photoURL:re.photoURL??p??""});const de=be(ae,"users",O);try{const pe=re.photoURL??p??"",Ke={email:re.email??h??"",nickname:u,photoURL:pe,profileImage:pe,createdAt:Yt(),updatedAt:Yt(),onboardingComplete:!0,communityGuidelinesAgreed:!0,communityGuidelinesAgreedAt:Yt()};console.log(` [${O}] setDoc  ...`,Ke),console.log(`[${O}] navigator.onLine =`,navigator.onLine);const W=setTimeout(()=>{console.warn(` [${O}] setDoc 10   (/  )`)},1e4);await kn(de,Ke,{merge:!0}),clearTimeout(W),console.log(` [${O}] Firestore  !`);const he=await Cn(de);he.exists()?console.log(` [${O}]   :`,he.data()):console.warn(` [${O}]   !`)}catch(pe){console.error(` [${O}] Firestore  :`,{error:pe,code:pe?.code,message:pe?.message,name:pe?.name,stack:pe?.stack})}fe.setItem(ue,"true"),console.log(` [${O}] welcome  `),fe.setItem("isLoggedIn","true"),e("welcome"),window.history.pushState({screen:"welcome"},"")},[u,h,p]),Ee=x.useCallback(O=>{if(!Ne.currentUser){console.error("[App]      .");return}const re=p,de=new FileReader;de.onload=pe=>{const Ke=pe.target?.result;Ke&&(w(Ke),fe.setItem("userProfileImage",Ke)),(async()=>{try{const W=await cP(O);w(W),fe.setItem("userProfileImage",W),console.log("[App]     :",W)}catch(W){console.error("[App]   / :",W),re&&(w(re),fe.setItem("userProfileImage",re))}})()},de.onerror=()=>{console.error("     .")},de.readAsDataURL(O)},[p]),xe=x.useCallback(()=>{e("guidelines")},[]),K=x.useCallback(()=>{a(!1)},[]),ee=x.useCallback(()=>{c(!1)},[]),oe=x.useCallback(()=>{const O=Iu();su(Ne).catch(ue=>{console.error("Firebase signOut error:",ue)}),e("login"),d(""),m(""),w(""),fe.setItem("isLoggedIn","false"),fe.removeItem("currentUserUID"),fe.removeItem("userEmail"),fe.removeItem("userProfileImage"),console.log(`[${O||"unknown"}]   ( )`),window.history.pushState({screen:"login"},"")},[]),Ae=x.useCallback(()=>{console.log("    Firebase "),su(Ne).catch(O=>{console.error("Firebase signOut error:",O)}),m(""),w(""),fe.removeItem("currentUserUID"),fe.removeItem("userEmail"),fe.removeItem("userProfileImage"),e("login"),window.history.pushState({screen:"login"},"")},[]),je=x.useCallback(()=>{e("nickname"),window.history.pushState({screen:"nickname"},"")},[]),ke=x.useCallback(()=>{e("main"),window.history.pushState({screen:"main"},"")},[]),De=x.useCallback(()=>{s(n);const O=n==="main";a(O),c(O),e("privacy"),window.history.pushState({screen:"privacy"},"")},[n]),Re=x.useCallback(()=>{s(n);const O=n==="main";a(O),c(O),e("terms"),window.history.pushState({screen:"terms"},"")},[n]),Me=x.useCallback(()=>{a(!0),c(!0),e("openSourceLicenses"),window.history.pushState({screen:"openSourceLicenses"},"")},[]),se=x.useCallback(()=>{a(!0),c(!0),e("attributions"),window.history.pushState({screen:"attributions"},"")},[]),Ue=x.useCallback(()=>{e("main"),window.history.pushState({screen:"main"},"")},[]),He=x.useCallback(()=>{e(t),window.history.pushState({screen:t},"")},[t]),Rt=x.useCallback(()=>{D(!0)},[]),Oe=x.useCallback(()=>{D(!1),Au.exitApp()},[]);return R?i.jsx("div",{className:`w-full h-screen ${k?"dark bg-background text-foreground":"bg-white text-gray-900"} flex items-center justify-center`,children:i.jsxs("div",{className:"flex flex-col items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-primary/30 border-t-primary rounded-full animate-spin"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:" ..."})]})}):i.jsxs("div",{className:`w-full h-screen ${k?"dark bg-background text-foreground":"bg-white text-gray-900"}`,children:[n==="login"&&i.jsx(ER,{onGoogleLogin:N,onShowTerms:Re,onShowPrivacy:De}),n==="privacy"&&i.jsx(sP,{onBack:He}),n==="terms"&&i.jsx(rP,{onBack:He}),n==="openSourceLicenses"&&i.jsx(aP,{onBack:Ue}),n==="attributions"&&i.jsx(oP,{onBack:Ue}),n==="nickname"&&i.jsx(kR,{onBack:Ae,onComplete:F,userEmail:h}),n==="guidelines"&&i.jsx(fd,{onBack:je,onContinue:Z,hideBackButton:!0}),n==="welcome"&&i.jsx(SR,{nickname:u,onRestart:oe,onStartApp:ke}),n==="main"&&i.jsx(nP,{userNickname:u,userProfileImage:p,onProfileImageChange:Ee,onLogout:oe,isDarkMode:k,onToggleDarkMode:T,onRequestExit:Rt,onShowTerms:Re,onShowPrivacy:De,onShowGuidelines:xe,onShowOpenSourceLicenses:Me,onShowAttributions:se,shouldOpenMyPageOnMain:r,shouldOpenSettingsOnMyPage:o,onMainScreenReady:K,onSettingsOpenedFromMain:ee}),n==="main"&&i.jsx(M1,{position:"top",variant:"toast",showReconnectButton:!0}),i.jsx(iP,{isDarkMode:k}),i.jsx(el,{open:S,onOpenChange:D,title:" ?",description:"  ?",onConfirm:Oe})]})}Tv.createRoot(document.getElementById("root")).render(i.jsx(lP,{}));export{sx as W};
