import{r as t,j as e}from"./vendor-radix-common-Lw-R5L56.js";import{n as fe,p as z,r as he,t as o,s as k,j as d,v as ge,C as j,i as v,I as J,T as pe,B as je,K as ve,k as Ne}from"./index-zqdvtYl2.js";import{A as be,a5 as Ce,f as ye,c as Se,G as ke,a6 as V,a1 as we,P as Te,X as Ie}from"./vendor-icons-B8UqI-Qt.js";import"./vendor-react-BjpLs-I5.js";import"./vendor-utils-NdZ4-hto.js";import"./vendor-radix-extra-SjO53O2I.js";const g={getItem:m=>{try{return localStorage.getItem(m)}catch(u){return console.error("localStorage getItem error:",u),null}},setItem:(m,u)=>{try{localStorage.setItem(m,u)}catch(N){console.error("localStorage setItem error:",N)}},removeItem:m=>{try{localStorage.removeItem(m)}catch(u){console.error("localStorage removeItem error:",u)}}},De=3600*1e3;function Ke({onBack:m,onSubmit:u,categories:N}){const[l,O]=t.useState(""),[c,L]=t.useState(""),[x,w]=t.useState("question"),[n,K]=t.useState(""),[i,b]=t.useState("전체"),[r,T]=t.useState([]),[C,q]=t.useState(""),[$,G]=t.useState(!1),[W,X]=t.useState(!1),[_,I]=t.useState(!1),[D,F]=t.useState(null),[p,H]=t.useState(!0),f=t.useRef(null),E=t.useRef(!1),y=fe(),Q=z({delay:350,offset:100}),U=z({delay:350,offset:100}),Y=z({delay:350,offset:100}),{isOnline:P}=he(),M=N.find(s=>s.id===n),S=M?.subCategories||[],Z=p?"작성 중인 내용은 자동으로 임시 저장됩니다. 임시 저장된 내용은 1시간 후 자동으로 삭제됩니다.":"작성 중인 내용은 저장되지 않습니다. 나가면 현재 작성 중인 내용이 사라집니다.";t.useEffect(()=>{try{const s=g.getItem("userSettings");if(!s)return;const a=JSON.parse(s);typeof a.autoSave=="boolean"&&H(a.autoSave)}catch(s){console.error("Failed to load userSettings in WriteScreen:",s)}},[]),t.useEffect(()=>{const s=g.getItem("draftPost");if(s)try{const a=JSON.parse(s);if(a.savedAt){const R=new Date(a.savedAt).getTime();if(!R||Number.isNaN(R)){g.removeItem("draftPost");return}if(Date.now()-R>De){g.removeItem("draftPost");return}}O(a.title||""),L(a.content||""),w(a.postType||"question"),K(a.category||""),b(a.subCategory||"전체"),T(a.tags||[]),F(a.savedAt?new Date(a.savedAt):null),o.success("임시 저장된 글을 불러왔습니다.")}catch(a){console.error("Failed to load draft:",a)}},[]);const B=t.useCallback(()=>{if(!l.trim()&&!c.trim())return;const s={title:l,content:c,postType:x,category:n,subCategory:i,tags:r,savedAt:new Date().toISOString()};g.setItem("draftPost",JSON.stringify(s)),F(new Date),E.current=!1},[l,c,x,n,i,r]);t.useEffect(()=>{if(!p){f.current&&clearTimeout(f.current);return}return(l.trim()||c.trim())&&(E.current=!0,f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{B()},3e3)),()=>{f.current&&clearTimeout(f.current)}},[l,c,x,n,i,r,B,p]);const ee=t.useCallback(()=>{w("question")},[]),se=t.useCallback(()=>{w("guide")},[]),te=t.useCallback(()=>{G(s=>!s)},[]),ae=t.useCallback(()=>{b("전체")},[]),re=t.useCallback(s=>{O(s.target.value)},[]),ne=t.useCallback(s=>{L(s.target.value)},[]),le=t.useCallback(()=>{X(s=>!s)},[]),ce=t.useCallback(s=>{q(s.target.value)},[]),ie=t.useCallback(s=>{s&&s.style.setProperty("--dynamic-padding-bottom",y.isVisible?`${y.height}px`:"0px")},[y.isVisible,y.height]),h=t.useCallback(()=>{g.removeItem("draftPost"),E.current=!1},[]);t.useEffect(()=>{n&&b("전체")},[n]);const oe=t.useCallback(()=>{if(!P){o.error("인터넷 연결이 필요합니다. 연결 후 다시 시도해주세요.");return}if(!l.trim()){o.error("제목을 입력해주세요.");return}if(!c.trim()){o.error("내용을 입력해주세요.");return}if(!n){o.error("카테고리를 선택해주세요.");return}if(k(l)){o.error("제목에 부적절한 단어가 포함되어 있습니다");return}if(k(c)){o.error("내용에 부적절한 단어가 포함되어 있습니다");return}if(r.some(s=>k(s))){o.error("태그에 부적절한 단어가 포함되어 있습니다");return}u({title:l.trim(),content:c.trim(),category:n,subCategory:i,type:x,tags:r}),h()},[P,l,c,n,x,i,r,u,h]),de=t.useCallback(()=>{l.trim()||c.trim()?I(!0):(h(),m())},[l,c,m,h]),me=t.useCallback(()=>{I(!1),p||h(),m()},[m,p,h]),A=t.useCallback(()=>{const s=C.trim();if(s){if(k(s)){o.error("태그에 부적절한 단어가 포함되어 있습니다.");return}if(r.includes(s)){o.error("이미 추가된 태그입니다.");return}if(r.length>=5){o.error("태그는 최대 5개까지 추가할 수 있습니다.");return}T([...r,s]),q("")}},[C,r]),ue=t.useCallback(s=>{T(r.filter(a=>a!==s))},[r]),xe=t.useCallback(s=>{s.key==="Enter"&&(s.preventDefault(),A())},[A]);return e.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-hidden flex flex-col",children:[e.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:de,children:e.jsx(be,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"font-medium",children:"새 글 작성"}),e.jsx(ge,{})]}),D&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(Ce,{className:"w-3 h-3"}),new Date().getTime()-D.getTime()<6e4?"방금 저장됨":`${Math.floor((new Date().getTime()-D.getTime())/6e4)}분 전 저장됨`]})]})]}),e.jsxs(d,{onClick:oe,className:"flex items-center space-x-2",disabled:!l.trim()||!c.trim()||!n||!P,children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"게시"})]})]})})}),e.jsx("main",{className:"flex-1 overflow-y-auto scrollbar-hide keyboard-aware-container dynamic-container",ref:ie,children:e.jsxs("div",{className:"p-4 space-y-4 pb-24",children:[e.jsx(j,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"게시글 유형"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(d,{variant:x==="question"?"default":"outline",onClick:ee,className:"flex items-center space-x-2 h-12",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:"질문글"})]}),e.jsxs(d,{variant:x==="guide"?"default":"outline",onClick:se,className:"flex items-center space-x-2 h-12",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{children:"길잡이글"})]})]})]})})}),e.jsx(j,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"카테고리"}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:te,className:"flex items-center space-x-1",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"선택"})]})]}),$&&e.jsxs("div",{className:"space-y-3 border-2 border-primary bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"메인 카테고리를 선택하세요"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:N.filter(s=>s.id!=="전체").map(s=>e.jsx(d,{variant:n===s.id?"default":"outline",onClick:()=>K(s.id),className:"h-auto py-3",children:s.name},s.id))})]}),n&&n!=="전체"&&S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"세부 카테고리를 선택하세요 (선택사항)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(d,{variant:i==="전체"?"default":"outline",onClick:ae,size:"sm",children:"전체"}),S.filter(s=>s.id!=="전체").map(s=>e.jsx(d,{variant:i===s.id?"default":"outline",onClick:()=>b(s.id),size:"sm",children:s.name},s.id))]})]})]}),n&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsxs("span",{children:[M?.name,n!=="전체"&&i&&i!=="전체"&&S.find(s=>s.id===i)&&` > ${S.find(s=>s.id===i)?.name}`]})]})]})})}),e.jsx(j,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"제목"}),e.jsx(J,{ref:Q,value:l,onChange:re,placeholder:"제목을 입력하세요",maxLength:100,className:"input-keyboard-safe"}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[l.length,"/100"]})]})})}),e.jsx(j,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"내용"}),e.jsx(pe,{ref:U,value:c,onChange:ne,placeholder:"내용을 입력하세요",className:"min-h-[200px] resize-none input-keyboard-safe",maxLength:2e3}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[c.length,"/2000"]}),e.jsx("div",{className:"pt-2 border-t border-border/50",children:e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"⚠️ 욕설, 타인을 비난하는 글 등 게시판 이용 방향과 위배되는 글들은 경고 없이 삭제 및 사용자 이용 정지 조치됩니다."})})]})})}),e.jsx(j,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"태그"}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:le,className:"flex items-center space-x-1",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{children:"추가"})]})]}),W&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(J,{ref:Y,value:C,onChange:ce,onKeyPress:xe,placeholder:"태그를 입력하세요 (최대 5개)",maxLength:20,disabled:r.length>=5,className:"input-keyboard-safe"}),e.jsx(d,{onClick:A,disabled:!C.trim()||r.length>=5,size:"sm",children:e.jsx(Te,{className:"w-4 h-4"})})]}),r.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(s=>e.jsxs(je,{variant:"secondary",className:"flex items-center space-x-1 px-2 py-1",children:[e.jsxs("span",{children:["#",s]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>ue(s),className:"h-auto p-1 hover:bg-transparent touch-extended ml-1",children:e.jsx(Ie,{className:"w-3 h-3"})})]},s))}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"태그는 최대 5개까지 추가할 수 있습니다."})]})})})]})}),e.jsx(ve,{}),e.jsx(Ne,{open:_,onOpenChange:I,title:"작성을 취소하시겠습니까?",description:Z,confirmText:"나가기",onConfirm:me})]})}export{Ke as WriteScreen};
