const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-BfCRv3Pi.js","assets/vendor-radix-common-Lw-R5L56.js","assets/vendor-react-BjpLs-I5.js","assets/vendor-utils-NdZ4-hto.js","assets/vendor-radix-extra-SjO53O2I.js","assets/vendor-icons-B8UqI-Qt.js","assets/web-BocqmiDs.js","assets/AdminReportScreen-RmHHYNmq.js","assets/WriteScreen-DRc0QXB6.js","assets/TitleShop-ZBx0B6zr.js","assets/shopTitles-CnbRAQQb.js","assets/TitlesCollection-Dx1l-vnF.js","assets/AchievementsScreen-D1hjBdih.js","assets/FollowListScreen-D3oJ7Oax.js","assets/UserProfileDialog-1UJeoVL_.js","assets/NotificationSettingsDialog-l0eT2zm0.js","assets/ReportDialog-C9-VDcfY.js"])))=>i.map(i=>d[i]);
import{_ as Qf,r as y,j as o,S as zw,o as DT,m as le,p as OT,q as LT,T as VT,s as MT,C as UT,A as FT,t as $w,v as BT,w as qw,x as zT,n as $T,O as Hw,y as qT,z as Ww,B as Gw,D as Kw,E as HT}from"./vendor-radix-common-Lw-R5L56.js";import{b as WT}from"./vendor-react-BjpLs-I5.js";import{c as Yf,t as Qw,a as Yw,b as hs,T as GT}from"./vendor-utils-NdZ4-hto.js";import{C as KT,a as QT,R as Xw,I as Jw,F as Zw,b as YT,L as XT,T as JT,c as ZT,d as eE,e as tE,f as nE}from"./vendor-radix-extra-SjO53O2I.js";import{C as yc,S as ro,M as so,A as Gn,a as Gh,U as gu,T as rE,B as sE,F as Xf,L as Kh,b as oi,E as e_,X as t_,c as Ln,d as iE,e as ai,f as oE,g as n_,P as r_,h as aE,i as s_,j as cE,k as i_,l as Jf,m as yu,n as xu,o as yg,H as lE,p as uE,q as dE,r as xg,s as o_,D as hE,t as fE,u as a_,v as mE,w as pE,x as gE,y as yE,z as Ks,G as xE,I as c_,J as xc,W as l_,K as Yl,R as wE,N as _E,O as u_,Q as d_,Z as Zf,V as vE,Y as h_,_ as bE,$ as IE,a0 as TE,a1 as wg,a2 as EE,a3 as NE,a4 as kE}from"./vendor-icons-B8UqI-Qt.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var AE=WT();const CE="modulepreload",SE=function(n){return"/"+n},_g={},_r=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let a=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),l=c?.nonce||c?.getAttribute("nonce");s=a(t.map(d=>{if(d=SE(d),d in _g)return;_g[d]=!0;const h=d.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":CE,h||(f.as="script"),f.crossOrigin="",f.href=d,l&&f.setAttribute("nonce",l),document.head.appendChild(f),h)return new Promise((w,k)=>{f.addEventListener("load",w),f.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return s.then(a=>{for(const c of a||[])c.status==="rejected"&&i(c.reason);return e().catch(i)})};/*! Capacitor: https://capacitorjs.com/ - MIT License */var Go;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Go||(Go={}));class fh extends Error{constructor(e,t,r){super(e),this.message=e,this.code=t,this.data=r}}const RE=n=>{var e,t;return n?.androidBridge?"android":!((t=(e=n?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},jE=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},r=t.Plugins=t.Plugins||{},s=()=>e!==null?e.name:RE(n),i=()=>s()!=="web",a=m=>{const f=d.get(m);return!!(f?.platforms.has(s())||c(m))},c=m=>{var f;return(f=t.PluginHeaders)===null||f===void 0?void 0:f.find(w=>w.name===m)},l=m=>n.console.error(m),d=new Map,h=(m,f={})=>{const w=d.get(m);if(w)return console.warn(`Capacitor plugin "${m}" already registered. Cannot register plugins twice.`),w.proxy;const k=s(),C=c(m);let b;const N=async()=>(!b&&k in f?b=typeof f[k]=="function"?b=await f[k]():b=f[k]:e!==null&&!b&&"web"in f&&(b=typeof f.web=="function"?b=await f.web():b=f.web),b),I=(x,v)=>{var A,S;if(C){const D=C?.methods.find(T=>v===T.name);if(D)return D.rtype==="promise"?T=>t.nativePromise(m,v.toString(),T):(T,L)=>t.nativeCallback(m,v.toString(),T,L);if(x)return(A=x[v])===null||A===void 0?void 0:A.bind(x)}else{if(x)return(S=x[v])===null||S===void 0?void 0:S.bind(x);throw new fh(`"${m}" plugin is not implemented on ${k}`,Go.Unimplemented)}},E=x=>{let v;const A=(...S)=>{const D=N().then(T=>{const L=I(T,x);if(L){const F=L(...S);return v=F?.remove,F}else throw new fh(`"${m}.${x}()" is not implemented on ${k}`,Go.Unimplemented)});return x==="addListener"&&(D.remove=async()=>v()),D};return A.toString=()=>`${x.toString()}() { [capacitor code] }`,Object.defineProperty(A,"name",{value:x,writable:!1,configurable:!1}),A},R=E("addListener"),P=E("removeListener"),O=(x,v)=>{const A=R({eventName:x},v),S=async()=>{const T=await A;P({eventName:x,callbackId:T},v)},D=new Promise(T=>A.then(()=>T({remove:S})));return D.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await S()},D},g=new Proxy({},{get(x,v){switch(v){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return C?O:R;case"removeListener":return P;default:return E(v)}}});return r[m]=g,d.set(m,{name:m,proxy:g,platforms:new Set([...Object.keys(f),...C?[k]:[]])}),g};return t.convertFileSrc||(t.convertFileSrc=m=>m),t.getPlatform=s,t.handleError=l,t.isNativePlatform=i,t.isPluginAvailable=a,t.registerPlugin=h,t.Exception=fh,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},PE=n=>n.Capacitor=jE(n),Li=PE(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),rd=Li.registerPlugin;class f_{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(t);const i=this.windowListeners[e];i&&!i.registered&&this.addWindowListener(i),r&&this.sendRetainedArgumentsForEvent(e);const a=async()=>this.removeListener(e,t);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,r){const s=this.listeners[e];if(!s){if(r){let i=this.retainedEventArguments[e];i||(i=[]),i.push(t),this.retainedEventArguments[e]=i}return}s.forEach(i=>i(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:r=>{this.notifyListeners(t,r)}}}unimplemented(e="not implemented"){return new Li.Exception(e,Go.Unimplemented)}unavailable(e="not available"){return new Li.Exception(e,Go.Unavailable)}async removeListener(e,t){const r=this.listeners[e];if(!r)return;const s=r.indexOf(t);this.listeners[e].splice(s,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(r=>{this.notifyListeners(e,r)}))}}const vg=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),bg=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class DE extends f_{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(r=>{if(r.length<=0)return;let[s,i]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=bg(s).trim(),i=bg(i).trim(),t[s]=i}),t}async setCookie(e){try{const t=vg(e.key),r=vg(e.value),s=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),a=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${r||""}${s}; path=${i}; ${a};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}rd("CapacitorCookies",{web:()=>new DE});const OE=async n=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{const s=r.result;e(s.indexOf(",")>=0?s.split(",")[1]:s)},r.onerror=s=>t(s),r.readAsDataURL(n)}),LE=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(s=>s.toLocaleLowerCase()).reduce((s,i,a)=>(s[i]=n[e[a]],s),{})},VE=(n,e=!0)=>n?Object.entries(n).reduce((r,s)=>{const[i,a]=s;let c,l;return Array.isArray(a)?(l="",a.forEach(d=>{c=e?encodeURIComponent(d):d,l+=`${i}=${c}&`}),l.slice(0,-1)):(c=e?encodeURIComponent(a):a,l=`${i}=${c}`),`${r}&${l}`},"").substr(1):null,ME=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),s=LE(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(s.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[a,c]of Object.entries(n.data||{}))i.set(a,c);t.body=i.toString()}else if(s.includes("multipart/form-data")||n.data instanceof FormData){const i=new FormData;if(n.data instanceof FormData)n.data.forEach((c,l)=>{i.append(l,c)});else for(const c of Object.keys(n.data))i.append(c,n.data[c]);t.body=i;const a=new Headers(t.headers);a.delete("content-type"),t.headers=a}else(s.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class UE extends f_{async request(e){const t=ME(e,e.webFetchExtra),r=VE(e.params,e.shouldEncodeUrlParams),s=r?`${e.url}?${r}`:e.url,i=await fetch(s,t),a=i.headers.get("content-type")||"";let{responseType:c="text"}=i.ok?e:{};a.includes("application/json")&&(c="json");let l,d;switch(c){case"arraybuffer":case"blob":d=await i.blob(),l=await OE(d);break;case"json":l=await i.json();break;case"document":case"text":default:l=await i.text()}const h={};return i.headers.forEach((m,f)=>{h[f]=m}),{data:l,headers:h,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}rd("CapacitorHttp",{web:()=>new UE});const wu=rd("App",{web:()=>_r(()=>import("./web-BfCRv3Pi.js"),__vite__mapDeps([0,1,2,3,4,5])).then(n=>new n.AppWeb)}),FE=()=>{};var Ig={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m_=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},BE=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],c=n[t++],l=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},em={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,c=a?n[s+1]:0,l=s+2<n.length,d=l?n[s+2]:0,h=i>>2,m=(i&3)<<4|c>>4;let f=(c&15)<<2|d>>6,w=d&63;l||(w=64,a||(f=64)),r.push(t[h],t[m],t[f],t[w])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(m_(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):BE(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],c=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||c==null||d==null||m==null)throw new zE;const f=i<<2|c>>4;if(r.push(f),d!==64){const w=c<<4&240|d>>2;if(r.push(w),m!==64){const k=d<<6&192|m;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class zE extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const $E=function(n){const e=m_(n);return em.encodeByteArray(e,!0)},_u=function(n){return $E(n).replace(/\./g,"")},p_=function(n){try{return em.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tm(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qE=()=>tm().__FIREBASE_DEFAULTS__,HE=()=>{if(typeof process>"u"||typeof Ig>"u")return;const n=Ig.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},WE=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&p_(n[1]);return e&&JSON.parse(e)},sd=()=>{try{return FE()||qE()||HE()||WE()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},g_=n=>{var e,t;return(t=(e=sd())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},y_=n=>{const e=g_(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},x_=()=>{var n;return(n=sd())===null||n===void 0?void 0:n.config},w_=n=>{var e;return(e=sd())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ns(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function id(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GE(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[_u(JSON.stringify(t)),_u(JSON.stringify(a)),""].join(".")}const Xa={};function KE(){const n={prod:[],emulator:[]};for(const e of Object.keys(Xa))Xa[e]?n.emulator.push(e):n.prod.push(e);return n}function QE(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Tg=!1;function nm(n,e){if(typeof window>"u"||typeof document>"u"||!Ns(window.location.host)||Xa[n]===e||Xa[n]||Tg)return;Xa[n]=e;function t(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=KE().prod.length>0;function a(){const f=document.getElementById(r);f&&f.remove()}function c(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function l(f,w){f.setAttribute("width","24"),f.setAttribute("id",w),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function d(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{Tg=!0,a()},f}function h(f,w){f.setAttribute("id",w),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function m(){const f=QE(r),w=t("text"),k=document.getElementById(w)||document.createElement("span"),C=t("learnmore"),b=document.getElementById(C)||document.createElement("a"),N=t("preprendIcon"),I=document.getElementById(N)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const E=f.element;c(E),h(b,C);const R=d();l(I,N),E.append(I,k,b,R),document.body.appendChild(E)}i?(k.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",w)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $t(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function YE(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($t())}function __(){var n;const e=(n=sd())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function XE(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function rm(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function JE(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ZE(){const n=$t();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function v_(){return!__()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function b_(){return!__()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function ha(){try{return typeof indexedDB=="object"}catch{return!1}}function sm(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function I_(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eN="FirebaseError";class Kn extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=eN,Object.setPrototypeOf(this,Kn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,pi.prototype.create)}}class pi{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?tN(i,r):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new Kn(s,c,r)}}function tN(n,e){return n.replace(nN,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const nN=/\{\$([^}]+)}/g;function rN(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function xs(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(Eg(i)&&Eg(a)){if(!xs(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Eg(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fa(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function za(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function $a(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function sN(n,e){const t=new iN(n,e);return t.subscribe.bind(t)}class iN{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");oN(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=mh),s.error===void 0&&(s.error=mh),s.complete===void 0&&(s.complete=mh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function oN(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function mh(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aN=1e3,cN=2,lN=14400*1e3,uN=.5;function Qh(n,e=aN,t=cN){const r=e*Math.pow(t,n),s=Math.round(uN*r*(Math.random()-.5)*2);return Math.min(lN,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n){return n&&n._delegate?n._delegate:n}class Rn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ci="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dN{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new wc;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e?.identifier),s=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(fN(e))try{this.getOrInitializeService({instanceIdentifier:Ci})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ci){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ci){return this.instances.has(e)}getOptions(e=Ci){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);r===c&&a.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:hN(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ci){return this.component?this.component.multipleInstances?e:Ci:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function hN(n){return n===Ci?void 0:n}function fN(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mN{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new dN(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Fe||(Fe={}));const pN={debug:Fe.DEBUG,verbose:Fe.VERBOSE,info:Fe.INFO,warn:Fe.WARN,error:Fe.ERROR,silent:Fe.SILENT},gN=Fe.INFO,yN={[Fe.DEBUG]:"log",[Fe.VERBOSE]:"log",[Fe.INFO]:"info",[Fe.WARN]:"warn",[Fe.ERROR]:"error"},xN=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=yN[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Wc{constructor(e){this.name=e,this._logLevel=gN,this._logHandler=xN,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Fe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?pN[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Fe.DEBUG,...e),this._logHandler(this,Fe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Fe.VERBOSE,...e),this._logHandler(this,Fe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Fe.INFO,...e),this._logHandler(this,Fe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Fe.WARN,...e),this._logHandler(this,Fe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Fe.ERROR,...e),this._logHandler(this,Fe.ERROR,...e)}}const wN=(n,e)=>e.some(t=>n instanceof t);let Ng,kg;function _N(){return Ng||(Ng=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function vN(){return kg||(kg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const T_=new WeakMap,Yh=new WeakMap,E_=new WeakMap,ph=new WeakMap,im=new WeakMap;function bN(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(Zs(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&T_.set(t,n)}).catch(()=>{}),im.set(e,n),e}function IN(n){if(Yh.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Yh.set(n,e)}let Xh={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Yh.get(n);if(e==="objectStoreNames")return n.objectStoreNames||E_.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Zs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function TN(n){Xh=n(Xh)}function EN(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(gh(this),e,...t);return E_.set(r,e.sort?e.sort():[e]),Zs(r)}:vN().includes(n)?function(...e){return n.apply(gh(this),e),Zs(T_.get(this))}:function(...e){return Zs(n.apply(gh(this),e))}}function NN(n){return typeof n=="function"?EN(n):(n instanceof IDBTransaction&&IN(n),wN(n,_N())?new Proxy(n,Xh):n)}function Zs(n){if(n instanceof IDBRequest)return bN(n);if(ph.has(n))return ph.get(n);const e=NN(n);return e!==n&&(ph.set(n,e),im.set(e,n)),e}const gh=n=>im.get(n);function N_(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),c=Zs(a);return r&&a.addEventListener("upgradeneeded",l=>{r(Zs(a.result),l.oldVersion,l.newVersion,Zs(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const kN=["get","getKey","getAll","getAllKeys","count"],AN=["put","add","delete","clear"],yh=new Map;function Ag(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(yh.get(e))return yh.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=AN.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||kN.includes(t)))return;const i=async function(a,...c){const l=this.transaction(a,s?"readwrite":"readonly");let d=l.store;return r&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),s&&l.done]))[0]};return yh.set(e,i),i}TN(n=>({...n,get:(e,t,r)=>Ag(e,t)||n.get(e,t,r),has:(e,t)=>!!Ag(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CN{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(SN(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function SN(n){const e=n.getComponent();return e?.type==="VERSION"}const Jh="@firebase/app",Cg="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ws=new Wc("@firebase/app"),RN="@firebase/app-compat",jN="@firebase/analytics-compat",PN="@firebase/analytics",DN="@firebase/app-check-compat",ON="@firebase/app-check",LN="@firebase/auth",VN="@firebase/auth-compat",MN="@firebase/database",UN="@firebase/data-connect",FN="@firebase/database-compat",BN="@firebase/functions",zN="@firebase/functions-compat",$N="@firebase/installations",qN="@firebase/installations-compat",HN="@firebase/messaging",WN="@firebase/messaging-compat",GN="@firebase/performance",KN="@firebase/performance-compat",QN="@firebase/remote-config",YN="@firebase/remote-config-compat",XN="@firebase/storage",JN="@firebase/storage-compat",ZN="@firebase/firestore",ek="@firebase/ai",tk="@firebase/firestore-compat",nk="firebase",rk="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zh="[DEFAULT]",sk={[Jh]:"fire-core",[RN]:"fire-core-compat",[PN]:"fire-analytics",[jN]:"fire-analytics-compat",[ON]:"fire-app-check",[DN]:"fire-app-check-compat",[LN]:"fire-auth",[VN]:"fire-auth-compat",[MN]:"fire-rtdb",[UN]:"fire-data-connect",[FN]:"fire-rtdb-compat",[BN]:"fire-fn",[zN]:"fire-fn-compat",[$N]:"fire-iid",[qN]:"fire-iid-compat",[HN]:"fire-fcm",[WN]:"fire-fcm-compat",[GN]:"fire-perf",[KN]:"fire-perf-compat",[QN]:"fire-rc",[YN]:"fire-rc-compat",[XN]:"fire-gcs",[JN]:"fire-gcs-compat",[ZN]:"fire-fst",[tk]:"fire-fst-compat",[ek]:"fire-vertex","fire-js":"fire-js",[nk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vu=new Map,ik=new Map,ef=new Map;function Sg(n,e){try{n.container.addComponent(e)}catch(t){ws.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Wn(n){const e=n.name;if(ef.has(e))return ws.debug(`There were multiple attempts to register component ${e}.`),!1;ef.set(e,n);for(const t of vu.values())Sg(t,n);for(const t of ik.values())Sg(t,n);return!0}function Or(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function At(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ok={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ei=new pi("app","Firebase",ok);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Rn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ei.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const io=rk;function k_(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Zh,automaticDataCollectionEnabled:!0},e),s=r.name;if(typeof s!="string"||!s)throw ei.create("bad-app-name",{appName:String(s)});if(t||(t=x_()),!t)throw ei.create("no-options");const i=vu.get(s);if(i){if(xs(t,i.options)&&xs(r,i.config))return i;throw ei.create("duplicate-app",{appName:s})}const a=new mN(s);for(const l of ef.values())a.addComponent(l);const c=new ak(t,r,a);return vu.set(s,c),c}function Gc(n=Zh){const e=vu.get(n);if(!e&&n===Zh&&x_())return k_();if(!e)throw ei.create("no-app",{appName:n});return e}function sn(n,e,t){var r;let s=(r=sk[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const c=[`Unable to register library "${s}" with version "${e}":`];i&&c.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ws.warn(c.join(" "));return}Wn(new Rn(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ck="firebase-heartbeat-database",lk=1,_c="firebase-heartbeat-store";let xh=null;function A_(){return xh||(xh=N_(ck,lk,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(_c)}catch(t){console.warn(t)}}}}).catch(n=>{throw ei.create("idb-open",{originalErrorMessage:n.message})})),xh}async function uk(n){try{const t=(await A_()).transaction(_c),r=await t.objectStore(_c).get(C_(n));return await t.done,r}catch(e){if(e instanceof Kn)ws.warn(e.message);else{const t=ei.create("idb-get",{originalErrorMessage:e?.message});ws.warn(t.message)}}}async function Rg(n,e){try{const r=(await A_()).transaction(_c,"readwrite");await r.objectStore(_c).put(e,C_(n)),await r.done}catch(t){if(t instanceof Kn)ws.warn(t.message);else{const r=ei.create("idb-set",{originalErrorMessage:t?.message});ws.warn(r.message)}}}function C_(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dk=1024,hk=30;class fk{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new pk(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=jg();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>hk){const a=gk(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ws.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=jg(),{heartbeatsToSend:r,unsentEntries:s}=mk(this._heartbeatsCache.heartbeats),i=_u(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ws.warn(t),""}}}function jg(){return new Date().toISOString().substring(0,10)}function mk(n,e=dk){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Pg(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Pg(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class pk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ha()?sm().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await uk(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Rg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Rg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Pg(n){return _u(JSON.stringify({version:2,heartbeats:n})).length}function gk(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yk(n){Wn(new Rn("platform-logger",e=>new CN(e),"PRIVATE")),Wn(new Rn("heartbeat",e=>new fk(e),"PRIVATE")),sn(Jh,Cg,n),sn(Jh,Cg,"esm2017"),sn("fire-js","")}yk("");function S_(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const xk=S_,R_=new pi("auth","Firebase",S_());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bu=new Wc("@firebase/auth");function wk(n,...e){bu.logLevel<=Fe.WARN&&bu.warn(`Auth (${io}): ${n}`,...e)}function Xl(n,...e){bu.logLevel<=Fe.ERROR&&bu.error(`Auth (${io}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wr(n,...e){throw am(n,...e)}function Fn(n,...e){return am(n,...e)}function om(n,e,t){const r=Object.assign(Object.assign({},xk()),{[e]:t});return new pi("auth","Firebase",r).create(e,{appName:n.name})}function Cn(n){return om(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function od(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&wr(n,"argument-error"),om(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function am(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return R_.create(n,...e)}function ae(n,e,...t){if(!n)throw am(e,...t)}function fs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Xl(e),new Error(e)}function _s(n,e){n||fs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vc(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function cm(){return Dg()==="http:"||Dg()==="https:"}function Dg(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _k(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(cm()||rm()||"connection"in navigator)?navigator.onLine:!0}function vk(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e,t){this.shortDelay=e,this.longDelay=t,_s(t>e,"Short delay should be less than long delay!"),this.isMobile=YE()||JE()}get(){return _k()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lm(n,e){_s(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j_{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;fs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;fs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;fs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ik=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Tk=new Kc(3e4,6e4);function qt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Ht(n,e,t,r,s={}){return P_(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const c=fa(Object.assign({key:n.config.apiKey},a)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const d=Object.assign({method:e,headers:l},i);return XE()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Ns(n.emulatorConfig.host)&&(d.credentials="include"),j_.fetch()(await D_(n,n.config.apiHost,t,c),d)})}async function P_(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},bk),e);try{const s=new Nk(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw qa(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const c=i.ok?a.errorMessage:a.error.message,[l,d]=c.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw qa(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw qa(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw qa(n,"user-disabled",a);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw om(n,h,d);wr(n,h)}}catch(s){if(s instanceof Kn)throw s;wr(n,"network-request-failed",{message:String(s)})}}async function ks(n,e,t,r,s={}){const i=await Ht(n,e,t,r,s);return"mfaPendingCredential"in i&&wr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function D_(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?lm(n.config,s):`${n.config.apiScheme}://${s}`;return Ik.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function Ek(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Nk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Fn(this.auth,"network-request-failed")),Tk.get())})}}function qa(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Fn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Og(n){return n!==void 0&&n.getResponse!==void 0}function Lg(n){return n!==void 0&&n.enterprise!==void 0}class O_{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Ek(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kk(n){return(await Ht(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function L_(n,e){return Ht(n,"GET","/v2/recaptchaConfig",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ak(n,e){return Ht(n,"POST","/v1/accounts:delete",e)}async function Ck(n,e){return Ht(n,"POST","/v1/accounts:update",e)}async function Iu(n,e){return Ht(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ja(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Sk(n,e=!1){const t=Ne(n),r=await t.getIdToken(e),s=ad(r);ae(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:Ja(wh(s.auth_time)),issuedAtTime:Ja(wh(s.iat)),expirationTime:Ja(wh(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function wh(n){return Number(n)*1e3}function ad(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Xl("JWT malformed, contained fewer than 3 sections"),null;try{const s=p_(t);return s?JSON.parse(s):(Xl("Failed to decode base64 JWT payload"),null)}catch(s){return Xl("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Vg(n){const e=ad(n);return ae(e,"internal-error"),ae(typeof e.exp<"u","internal-error"),ae(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qi(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Kn&&Rk(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Rk({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ja(this.lastLoginAt),this.creationTime=Ja(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bc(n){var e;const t=n.auth,r=await n.getIdToken(),s=await qi(n,Iu(t,{idToken:r}));ae(s?.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?V_(i.providerUserInfo):[],c=Dk(n.providerData,a),l=n.isAnonymous,d=!(n.email&&i.passwordHash)&&!c?.length,h=l?d:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new tf(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,m)}async function Pk(n){const e=Ne(n);await bc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Dk(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function V_(n){return n.map(e=>{var{providerId:t}=e,r=Qf(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ok(n,e){const t=await P_(n,{},async()=>{const r=fa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await D_(n,s,"/v1/token",`key=${i}`),c=await n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:c,body:r};return n.emulatorConfig&&Ns(n.emulatorConfig.host)&&(l.credentials="include"),j_.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Lk(n,e){return Ht(n,"POST","/v2/accounts:revokeToken",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ae(e.idToken,"internal-error"),ae(typeof e.idToken<"u","internal-error"),ae(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Vg(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ae(e.length!==0,"internal-error");const t=Vg(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ae(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await Ok(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new Mo;return r&&(ae(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(ae(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(ae(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Mo,this.toJSON())}_performRefresh(){return fs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vs(n,e){ae(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Sr{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Qf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new jk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new tf(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await qi(this,this.stsTokenManager.getToken(this.auth,e));return ae(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Sk(this,e)}reload(){return Pk(this)}_assign(e){this!==e&&(ae(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Sr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ae(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await bc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(At(this.auth.app))return Promise.reject(Cn(this.auth));const e=await this.getIdToken();return await qi(this,Ak(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,a,c,l,d,h;const m=(r=t.displayName)!==null&&r!==void 0?r:void 0,f=(s=t.email)!==null&&s!==void 0?s:void 0,w=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,k=(a=t.photoURL)!==null&&a!==void 0?a:void 0,C=(c=t.tenantId)!==null&&c!==void 0?c:void 0,b=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,N=(d=t.createdAt)!==null&&d!==void 0?d:void 0,I=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:E,emailVerified:R,isAnonymous:P,providerData:O,stsTokenManager:g}=t;ae(E&&g,e,"internal-error");const x=Mo.fromJSON(this.name,g);ae(typeof E=="string",e,"internal-error"),Vs(m,e.name),Vs(f,e.name),ae(typeof R=="boolean",e,"internal-error"),ae(typeof P=="boolean",e,"internal-error"),Vs(w,e.name),Vs(k,e.name),Vs(C,e.name),Vs(b,e.name),Vs(N,e.name),Vs(I,e.name);const v=new Sr({uid:E,auth:e,email:f,emailVerified:R,displayName:m,isAnonymous:P,photoURL:k,phoneNumber:w,tenantId:C,stsTokenManager:x,createdAt:N,lastLoginAt:I});return O&&Array.isArray(O)&&(v.providerData=O.map(A=>Object.assign({},A))),b&&(v._redirectEventId=b),v}static async _fromIdTokenResponse(e,t,r=!1){const s=new Mo;s.updateFromServerResponse(t);const i=new Sr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await bc(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ae(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?V_(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,c=new Mo;c.updateFromIdToken(r);const l=new Sr({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new tf(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(l,d),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mg=new Map;function ms(n){_s(n instanceof Function,"Expected a class definition");let e=Mg.get(n);return e?(_s(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Mg.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M_{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}M_.type="NONE";const Ug=M_;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jl(n,e,t){return`firebase:${n}:${e}:${t}`}class Uo{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Jl(this.userKey,s.apiKey,i),this.fullPersistenceKey=Jl("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Iu(this.auth,{idToken:e}).catch(()=>{});return t?Sr._fromGetAccountInfoResponse(this.auth,t,e):null}return Sr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Uo(ms(Ug),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||ms(Ug);const a=Jl(r,e.config.apiKey,e.name);let c=null;for(const d of t)try{const h=await d._get(a);if(h){let m;if(typeof h=="string"){const f=await Iu(e,{idToken:h}).catch(()=>{});if(!f)break;m=await Sr._fromGetAccountInfoResponse(e,f,h)}else m=Sr._fromJSON(e,h);d!==i&&(c=m),i=d;break}}catch{}const l=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Uo(i,e,r):(i=l[0],c&&await i._set(a,c.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new Uo(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fg(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(z_(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(U_(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(q_(e))return"Blackberry";if(H_(e))return"Webos";if(F_(e))return"Safari";if((e.includes("chrome/")||B_(e))&&!e.includes("edge/"))return"Chrome";if($_(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function U_(n=$t()){return/firefox\//i.test(n)}function F_(n=$t()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function B_(n=$t()){return/crios\//i.test(n)}function z_(n=$t()){return/iemobile/i.test(n)}function $_(n=$t()){return/android/i.test(n)}function q_(n=$t()){return/blackberry/i.test(n)}function H_(n=$t()){return/webos/i.test(n)}function um(n=$t()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Vk(n=$t()){var e;return um(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Mk(){return ZE()&&document.documentMode===10}function W_(n=$t()){return um(n)||$_(n)||H_(n)||q_(n)||/windows phone/i.test(n)||z_(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G_(n,e=[]){let t;switch(n){case"Browser":t=Fg($t());break;case"Worker":t=`${Fg($t())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${io}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,c)=>{try{const l=e(i);a(l)}catch(l){c(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fk(n,e={}){return Ht(n,"GET","/v2/passwordPolicy",qt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bk=6;class zk{constructor(e){var t,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:Bk,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,a,c;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(c=l.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Bg(this),this.idTokenSubscription=new Bg(this),this.beforeStateQueue=new Uk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=R_,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ms(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Uo.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Iu(this,{idToken:e}),r=await Sr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(At(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=s?._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===c)&&l?.user&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ae(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await bc(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=vk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(At(this.app))return Promise.reject(Cn(this));const t=e?Ne(e):null;return t&&ae(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ae(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return At(this.app)?Promise.reject(Cn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return At(this.app)?Promise.reject(Cn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ms(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Fk(this),t=new zk(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new pi("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Lk(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ms(e)||this._popupRedirectResolver;ae(t,this,"argument-error"),this.redirectPersistenceManager=await Uo.create(this,[ms(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(ae(c,this,"internal-error"),c.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ae(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=G_(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;if(At(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&wk(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Jt(n){return Ne(n)}class Bg{constructor(e){this.auth=e,this.observer=null,this.addObserver=sN(t=>this.observer=t)}get next(){return ae(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function qk(n){Qc=n}function dm(n){return Qc.loadJS(n)}function Hk(){return Qc.recaptchaV2Script}function Wk(){return Qc.recaptchaEnterpriseScript}function Gk(){return Qc.gapiScript}function K_(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk=500,Qk=6e4,Dl=1e12;class Yk{constructor(e){this.auth=e,this.counter=Dl,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new Zk(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Dl;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Dl;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Dl;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class Xk{constructor(){this.enterprise=new Jk}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Jk{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Zk{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;ae(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=eA(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},Qk)},Kk))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function eA(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const tA="recaptcha-enterprise",Za="NO_RECAPTCHA";class Q_{constructor(e){this.type=tA,this.auth=Jt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,c)=>{L_(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const d=new O_(l);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(l=>{c(l)})})}function s(i,a,c){const l=window.grecaptcha;Lg(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(Za)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Xk().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{r(this.auth).then(c=>{if(!t&&Lg(window.grecaptcha))s(c,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Wk();l.length!==0&&(l+=c),dm(l).then(()=>{s(c,i,a)}).catch(d=>{a(d)})}}).catch(c=>{a(c)})})}}async function Pa(n,e,t,r=!1,s=!1){const i=new Q_(n);let a;if(s)a=Za;else try{a=await i.verify(t)}catch{a=await i.verify(t,!0)}const c=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){const l=c.phoneEnrollmentInfo.phoneNumber,d=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const l=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return r?Object.assign(c,{captchaResp:a}):Object.assign(c,{captchaResponse:a}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function ti(n,e,t,r,s){var i,a;if(s==="EMAIL_PASSWORD_PROVIDER")if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const c=await Pa(n,e,t,t==="getOobCode");return r(n,c)}else return r(n,e).catch(async c=>{if(c.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Pa(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(c)});else if(s==="PHONE_PROVIDER")if(!((a=n._getRecaptchaConfig())===null||a===void 0)&&a.isProviderEnabled("PHONE_PROVIDER")){const c=await Pa(n,e,t);return r(n,c).catch(async l=>{var d;if(((d=n._getRecaptchaConfig())===null||d===void 0?void 0:d.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await Pa(n,e,t,!1,!0);return r(n,h)}return Promise.reject(l)})}else{const c=await Pa(n,e,t,!1,!0);return r(n,c)}else return Promise.reject(s+" provider is not supported.")}async function nA(n){const e=Jt(n),t=await L_(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new O_(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new Q_(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rA(n,e){const t=Or(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(xs(i,e??{}))return s;wr(s,"already-initialized")}return t.initialize({options:e})}function sA(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(ms);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function iA(n,e,t){const r=Jt(n);ae(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=Y_(e),{host:a,port:c}=oA(e),l=c===null?"":`:${c}`,d={url:`${i}//${a}${l}/`},h=Object.freeze({host:a,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){ae(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ae(xs(d,r.config.emulator)&&xs(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Ns(a)?(id(`${i}//${a}${l}`),nm("Auth",!0)):aA()}function Y_(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function oA(n){const e=Y_(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:zg(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:zg(a)}}}function zg(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function aA(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cd{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return fs("not implemented")}_getIdTokenResponse(e){return fs("not implemented")}_linkToIdToken(e,t){return fs("not implemented")}_getReauthenticationResolver(e){return fs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cA(n,e){return Ht(n,"POST","/v1/accounts:resetPassword",qt(n,e))}async function lA(n,e){return Ht(n,"POST","/v1/accounts:update",e)}async function uA(n,e){return Ht(n,"POST","/v1/accounts:signUp",e)}async function dA(n,e){return Ht(n,"POST","/v1/accounts:update",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hA(n,e){return ks(n,"POST","/v1/accounts:signInWithPassword",qt(n,e))}async function ld(n,e){return Ht(n,"POST","/v1/accounts:sendOobCode",qt(n,e))}async function fA(n,e){return ld(n,e)}async function mA(n,e){return ld(n,e)}async function pA(n,e){return ld(n,e)}async function gA(n,e){return ld(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yA(n,e){return ks(n,"POST","/v1/accounts:signInWithEmailLink",qt(n,e))}async function xA(n,e){return ks(n,"POST","/v1/accounts:signInWithEmailLink",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic extends cd{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Ic(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Ic(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ti(e,t,"signInWithPassword",hA,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return yA(e,{email:this._email,oobCode:this._password});default:wr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ti(e,r,"signUpPassword",uA,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return xA(e,{idToken:t,email:this._email,oobCode:this._password});default:wr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fo(n,e){return ks(n,"POST","/v1/accounts:signInWithIdp",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wA="http://localhost";class vs extends cd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new vs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):wr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Qf(t,["providerId","signInMethod"]);if(!r||!s)return null;const a=new vs(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Fo(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Fo(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Fo(e,t)}buildRequest(){const e={requestUri:wA,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=fa(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $g(n,e){return Ht(n,"POST","/v1/accounts:sendVerificationCode",qt(n,e))}async function _A(n,e){return ks(n,"POST","/v1/accounts:signInWithPhoneNumber",qt(n,e))}async function vA(n,e){const t=await ks(n,"POST","/v1/accounts:signInWithPhoneNumber",qt(n,e));if(t.temporaryProof)throw qa(n,"account-exists-with-different-credential",t);return t}const bA={USER_NOT_FOUND:"user-not-found"};async function IA(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return ks(n,"POST","/v1/accounts:signInWithPhoneNumber",qt(n,t),bA)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec extends cd{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ec({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ec({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return _A(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return vA(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return IA(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new ec({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TA(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function EA(n){const e=za($a(n)).link,t=e?za($a(e)).deep_link_id:null,r=za($a(n)).deep_link_id;return(r?za($a(r)).link:null)||r||t||e||n}class ud{constructor(e){var t,r,s,i,a,c;const l=za($a(e)),d=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,m=TA((s=l.mode)!==null&&s!==void 0?s:null);ae(d&&h&&m,"argument-error"),this.apiKey=d,this.operation=m,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=l.lang)!==null&&a!==void 0?a:null,this.tenantId=(c=l.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){const t=EA(e);try{return new ud(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(){this.providerId=oo.PROVIDER_ID}static credential(e,t){return Ic._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=ud.parseLink(t);return ae(r,"argument-error"),Ic._fromEmailAndCode(e,r.code,r.tenantId)}}oo.PROVIDER_ID="password";oo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";oo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa extends ma{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Zl extends pa{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return ae("providerId"in t&&"signInMethod"in t,"argument-error"),vs._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return ae(e.idToken||e.accessToken,"argument-error"),vs._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Zl.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Zl.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:a,providerId:c}=e;if(!r&&!s&&!t&&!i||!c)return null;try{return new Zl(c)._credential({idToken:t,accessToken:r,nonce:a,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s extends pa{constructor(){super("facebook.com")}static credential(e){return vs._fromParams({providerId:$s.PROVIDER_ID,signInMethod:$s.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $s.credentialFromTaggedObject(e)}static credentialFromError(e){return $s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return $s.credential(e.oauthAccessToken)}catch{return null}}}$s.FACEBOOK_SIGN_IN_METHOD="facebook.com";$s.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r extends pa{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return vs._fromParams({providerId:$r.PROVIDER_ID,signInMethod:$r.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return $r.credentialFromTaggedObject(e)}static credentialFromError(e){return $r.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return $r.credential(t,r)}catch{return null}}}$r.GOOGLE_SIGN_IN_METHOD="google.com";$r.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs extends pa{constructor(){super("github.com")}static credential(e){return vs._fromParams({providerId:qs.PROVIDER_ID,signInMethod:qs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qs.credentialFromTaggedObject(e)}static credentialFromError(e){return qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qs.credential(e.oauthAccessToken)}catch{return null}}}qs.GITHUB_SIGN_IN_METHOD="github.com";qs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs extends pa{constructor(){super("twitter.com")}static credential(e,t){return vs._fromParams({providerId:Hs.PROVIDER_ID,signInMethod:Hs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Hs.credentialFromTaggedObject(e)}static credentialFromError(e){return Hs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Hs.credential(t,r)}catch{return null}}}Hs.TWITTER_SIGN_IN_METHOD="twitter.com";Hs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X_(n,e){return ks(n,"POST","/v1/accounts:signUp",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Sr._fromIdTokenResponse(e,r,s),a=qg(r);return new Yr({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=qg(r);return new Yr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function qg(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R4(n){var e;if(At(n.app))return Promise.reject(Cn(n));const t=Jt(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Yr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await X_(t,{returnSecureToken:!0}),s=await Yr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu extends Kn{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Tu.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Tu(e,t,r,s)}}function J_(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Tu._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z_(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j4(n,e){const t=Ne(n);await dd(!0,t,e);const{providerUserInfo:r}=await Ck(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=Z_(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function ev(n,e,t=!1){const r=await qi(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Yr._forOperation(n,"link",r)}async function dd(n,e,t){await bc(e);const r=Z_(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";ae(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NA(n,e,t=!1){const{auth:r}=n;if(At(r.app))return Promise.reject(Cn(r));const s="reauthenticate";try{const i=await qi(n,J_(r,s,e,n),t);ae(i.idToken,r,"internal-error");const a=ad(i.idToken);ae(a,r,"internal-error");const{sub:c}=a;return ae(n.uid===c,r,"user-mismatch"),Yr._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&wr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tv(n,e,t=!1){if(At(n.app))return Promise.reject(Cn(n));const r="signIn",s=await J_(n,r,e),i=await Yr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function hd(n,e){return tv(Jt(n),e)}async function kA(n,e){const t=Ne(n);return await dd(!1,t,e.providerId),ev(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AA(n,e){return ks(n,"POST","/v1/accounts:signInWithCustomToken",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P4(n,e){if(At(n.app))return Promise.reject(Cn(n));const t=Jt(n),r=await AA(t,{token:e,returnSecureToken:!0}),s=await Yr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fd(n,e,t){var r;ae(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),ae(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),ae(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(ae(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(ae(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hm(n){const e=Jt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function D4(n,e,t){const r=Jt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&fd(r,s,t),await ti(r,s,"getOobCode",mA,"EMAIL_PASSWORD_PROVIDER")}async function O4(n,e,t){await cA(Ne(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&hm(n),r})}async function L4(n,e){await dA(Ne(n),{oobCode:e})}async function V4(n,e,t){if(At(n.app))return Promise.reject(Cn(n));const r=Jt(n),a=await ti(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",X_,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&hm(n),l}),c=await Yr._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(c.user),c}function M4(n,e,t){return At(n.app)?Promise.reject(Cn(n)):hd(Ne(n),oo.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&hm(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U4(n,e,t){const r=Jt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(a,c){ae(c.handleCodeInApp,r,"argument-error"),c&&fd(r,a,c)}i(s,t),await ti(r,s,"getOobCode",pA,"EMAIL_PASSWORD_PROVIDER")}function F4(n,e){const t=ud.parseLink(e);return t?.operation==="EMAIL_SIGNIN"}async function B4(n,e,t){if(At(n.app))return Promise.reject(Cn(n));const r=Ne(n),s=oo.credentialWithLink(e,t||vc());return ae(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),hd(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CA(n,e){return Ht(n,"POST","/v1/accounts:createAuthUri",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z4(n,e){const t=cm()?vc():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await CA(Ne(n),r);return s||[]}async function $4(n,e){const t=Ne(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&fd(t.auth,s,e);const{email:i}=await fA(t.auth,s);i!==n.email&&await n.reload()}async function q4(n,e,t){const r=Ne(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&fd(r.auth,i,t);const{email:a}=await gA(r.auth,i);a!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SA(n,e){return Ht(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RA(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Ne(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},a=await qi(r,SA(r.auth,i));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;const c=r.providerData.find(({providerId:l})=>l==="password");c&&(c.displayName=r.displayName,c.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}function H4(n,e){const t=Ne(n);return At(t.auth.app)?Promise.reject(Cn(t.auth)):nv(t,e,null)}function W4(n,e){return nv(Ne(n),null,e)}async function nv(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const a=await qi(n,lA(r,i));await n._updateTokensIfNecessary(a,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jA(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&n?.idToken){const a=(t=(e=ad(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(a){const c=a!=="anonymous"&&a!=="custom"?a:null;return new Bo(i,c)}}if(!r)return null;switch(r){case"facebook.com":return new PA(i,s);case"github.com":return new DA(i,s);case"google.com":return new OA(i,s);case"twitter.com":return new LA(i,s,n.screenName||null);case"custom":case"anonymous":return new Bo(i,null);default:return new Bo(i,r,s)}}class Bo{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class rv extends Bo{constructor(e,t,r,s){super(e,t,r),this.username=s}}class PA extends Bo{constructor(e,t){super(e,"facebook.com",t)}}class DA extends rv{constructor(e,t){super(e,"github.com",t,typeof t?.login=="string"?t?.login:null)}}class OA extends Bo{constructor(e,t){super(e,"google.com",t)}}class LA extends rv{constructor(e,t,r){super(e,"twitter.com",t,r)}}function G4(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:jA(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K4(n,e){return Ne(n).setPersistence(e)}function VA(n,e,t,r){return Ne(n).onIdTokenChanged(e,t,r)}function MA(n,e,t){return Ne(n).beforeAuthStateChanged(e,t)}function nf(n){return Ne(n).signOut()}function Q4(n,e){return Jt(n).revokeAccessToken(e)}async function Y4(n){return Ne(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hg(n,e){return Ht(n,"POST","/v2/accounts/mfaEnrollment:start",qt(n,e))}const Eu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sv{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Eu,"1"),this.storage.removeItem(Eu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UA=1e3,FA=10;class iv extends sv{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=W_(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,c,l)=>{this.notifyListeners(a,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);Mk()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,FA):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},UA)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}iv.type="LOCAL";const BA=iv;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ov extends sv{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ov.type="SESSION";const av=ov;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zA(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new md(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const c=Array.from(a).map(async d=>d(t.origin,i)),l=await zA(c);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}md.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pd(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $A{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((c,l)=>{const d=pd("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const f=m;if(f.data.eventId===d)switch(f.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(f.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lt(){return window}function qA(n){Lt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fm(){return typeof Lt().WorkerGlobalScope<"u"&&typeof Lt().importScripts=="function"}async function HA(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function WA(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function GA(){return fm()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cv="firebaseLocalStorageDb",KA=1,Nu="firebaseLocalStorage",lv="fbase_key";class Yc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function gd(n,e){return n.transaction([Nu],e?"readwrite":"readonly").objectStore(Nu)}function QA(){const n=indexedDB.deleteDatabase(cv);return new Yc(n).toPromise()}function rf(){const n=indexedDB.open(cv,KA);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Nu,{keyPath:lv})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Nu)?e(r):(r.close(),await QA(),e(await rf()))})})}async function Wg(n,e,t){const r=gd(n,!0).put({[lv]:e,value:t});return new Yc(r).toPromise()}async function YA(n,e){const t=gd(n,!1).get(e),r=await new Yc(t).toPromise();return r===void 0?null:r.value}function Gg(n,e){const t=gd(n,!0).delete(e);return new Yc(t).toPromise()}const XA=800,JA=3;class uv{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await rf(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>JA)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return fm()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=md._getInstance(GA()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await HA(),!this.activeServiceWorker)return;this.sender=new $A(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||WA()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await rf();return await Wg(e,Eu,"1"),await Gg(e,Eu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Wg(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>YA(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Gg(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=gd(s,!1).getAll();return new Yc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),XA)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}uv.type="LOCAL";const ZA=uv;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kg(n,e){return Ht(n,"POST","/v2/accounts/mfaSignIn:start",qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _h=K_("rcb"),eC=new Kc(3e4,6e4);class tC{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Lt().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return ae(nC(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Og(Lt().grecaptcha)?Promise.resolve(Lt().grecaptcha):new Promise((r,s)=>{const i=Lt().setTimeout(()=>{s(Fn(e,"network-request-failed"))},eC.get());Lt()[_h]=()=>{Lt().clearTimeout(i),delete Lt()[_h];const c=Lt().grecaptcha;if(!c||!Og(c)){s(Fn(e,"internal-error"));return}const l=c.render;c.render=(d,h)=>{const m=l(d,h);return this.counter++,m},this.hostLanguage=t,r(c)};const a=`${Hk()}?${fa({onload:_h,render:"explicit",hl:t})}`;dm(a).catch(()=>{clearTimeout(i),s(Fn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Lt().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function nC(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class rC{async load(e){return new Yk(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc="recaptcha",sC={theme:"light",type:"image"};class X4{constructor(e,t,r=Object.assign({},sC)){this.parameters=r,this.type=tc,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Jt(e),this.isInvisible=this.parameters.size==="invisible",ae(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;ae(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new rC:new tC,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=a=>{a&&(this.tokenChangeListeners.delete(i),s(a))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){ae(!this.parameters.sitekey,this.auth,"argument-error"),ae(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ae(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Lt()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){ae(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ae(cm()&&!fm(),this.auth,"internal-error"),await iC(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await kk(this.auth);ae(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ae(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function iC(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ec._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function J4(n,e,t){if(At(n.app))return Promise.reject(Cn(n));const r=Jt(n),s=await hv(r,e,Ne(t));return new dv(s,i=>hd(r,i))}async function Z4(n,e,t){const r=Ne(n);await dd(!1,r,"phone");const s=await hv(r.auth,e,Ne(t));return new dv(s,i=>kA(r,i))}async function hv(n,e,t){var r;if(!n._getRecaptchaConfig())try{await nA(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){ae(i.type==="enroll",n,"internal-error");const a={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await ti(n,a,"mfaSmsEnrollment",async(h,m)=>{if(m.phoneEnrollmentInfo.captchaResponse===Za){ae(t?.type===tc,h,"argument-error");const f=await vh(h,m,t);return Hg(h,f)}return Hg(h,m)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{ae(i.type==="signin",n,"internal-error");const a=((r=s.multiFactorHint)===null||r===void 0?void 0:r.uid)||s.multiFactorUid;ae(a,n,"missing-multi-factor-info");const c={mfaPendingCredential:i.credential,mfaEnrollmentId:a,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await ti(n,c,"mfaSmsSignIn",async(m,f)=>{if(f.phoneSignInInfo.captchaResponse===Za){ae(t?.type===tc,m,"argument-error");const w=await vh(m,f,t);return Kg(m,w)}return Kg(m,f)},"PHONE_PROVIDER").catch(m=>Promise.reject(m))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await ti(n,i,"sendVerificationCode",async(d,h)=>{if(h.captchaResponse===Za){ae(t?.type===tc,d,"argument-error");const m=await vh(d,h,t);return $g(d,m)}return $g(d,h)},"PHONE_PROVIDER").catch(d=>Promise.reject(d))).sessionInfo}}finally{t?._reset()}}async function vh(n,e,t){ae(t.type===tc,n,"argument-error");const r=await t.verify();ae(typeof r=="string",n,"argument-error");const s=Object.assign({},e);if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,a=s.phoneEnrollmentInfo.captchaResponse,c=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:a,clientType:c,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,a=s.phoneSignInInfo.clientType,c=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:a,recaptchaVersion:c}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xc(n,e){return e?ms(e):(ae(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm extends cd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Fo(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Fo(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Fo(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function oC(n){return tv(n.auth,new mm(n),n.bypassAuthState)}function aC(n){const{auth:e,user:t}=n;return ae(t,e,"internal-error"),NA(t,new mm(n),n.bypassAuthState)}async function cC(n){const{auth:e,user:t}=n;return ae(t,e,"internal-error"),ev(t,new mm(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:c}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(l))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return oC;case"linkViaPopup":case"linkViaRedirect":return cC;case"reauthViaPopup":case"reauthViaRedirect":return aC;default:wr(this.auth,"internal-error")}}resolve(e){_s(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_s(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lC=new Kc(2e3,1e4);async function uC(n,e,t){if(At(n.app))return Promise.reject(Fn(n,"operation-not-supported-in-this-environment"));const r=Jt(n);od(n,e,ma);const s=Xc(r,t);return new Qs(r,"signInViaPopup",e,s).executeNotNull()}async function eU(n,e,t){const r=Ne(n);od(r.auth,e,ma);const s=Xc(r.auth,t);return new Qs(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Qs extends fv{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Qs.currentPopupAction&&Qs.currentPopupAction.cancel(),Qs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ae(e,this.auth,"internal-error"),e}async onExecution(){_s(this.filter.length===1,"Popup operations only handle one event");const e=pd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Fn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Fn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Qs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,lC.get())};e()}}Qs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dC="pendingRedirect",eu=new Map;class hC extends fv{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=eu.get(this.auth._key());if(!e){try{const r=await fC(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}eu.set(this.auth._key(),e)}return this.bypassAuthState||eu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function fC(n,e){const t=gv(e),r=pv(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function mv(n,e){return pv(n)._set(gv(e),"true")}function mC(n,e){eu.set(n._key(),e)}function pv(n){return ms(n._redirectPersistence)}function gv(n){return Jl(dC,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tU(n,e,t){return pC(n,e,t)}async function pC(n,e,t){if(At(n.app))return Promise.reject(Cn(n));const r=Jt(n);od(n,e,ma),await r._initializationPromise;const s=Xc(r,t);return await mv(s,r),s._openRedirect(r,e,"signInViaRedirect")}function nU(n,e,t){return gC(n,e,t)}async function gC(n,e,t){const r=Ne(n);od(r.auth,e,ma),await r.auth._initializationPromise;const s=Xc(r.auth,t);await dd(!1,r,e.providerId),await mv(s,r.auth);const i=await yC(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function rU(n,e){return await Jt(n)._initializationPromise,yv(n,e,!1)}async function yv(n,e,t=!1){if(At(n.app))return Promise.reject(Cn(n));const r=Jt(n),s=Xc(r,e),a=await new hC(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}async function yC(n){const e=pd(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xC=600*1e3;class wC{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!_C(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!xv(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Fn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=xC&&this.cachedEventUids.clear(),this.cachedEventUids.has(Qg(e))}saveEventToCache(e){this.cachedEventUids.add(Qg(e)),this.lastProcessedEventTime=Date.now()}}function Qg(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function xv({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function _C(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return xv(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vC(n,e={}){return Ht(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bC=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,IC=/^https?/;async function TC(n){if(n.config.emulator)return;const{authorizedDomains:e}=await vC(n);for(const t of e)try{if(EC(t))return}catch{}wr(n,"unauthorized-domain")}function EC(n){const e=vc(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!IC.test(t))return!1;if(bC.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NC=new Kc(3e4,6e4);function Yg(){const n=Lt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function kC(n){return new Promise((e,t)=>{var r,s,i;function a(){Yg(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Yg(),t(Fn(n,"network-request-failed"))},timeout:NC.get()})}if(!((s=(r=Lt().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Lt().gapi)===null||i===void 0)&&i.load)a();else{const c=K_("iframefcb");return Lt()[c]=()=>{gapi.load?a():t(Fn(n,"network-request-failed"))},dm(`${Gk()}?onload=${c}`).catch(l=>t(l))}}).catch(e=>{throw tu=null,e})}let tu=null;function AC(n){return tu=tu||kC(n),tu}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CC=new Kc(5e3,15e3),SC="__/auth/iframe",RC="emulator/auth/iframe",jC={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},PC=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function DC(n){const e=n.config;ae(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?lm(e,RC):`https://${n.config.authDomain}/${SC}`,r={apiKey:e.apiKey,appName:n.name,v:io},s=PC.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${fa(r).slice(1)}`}async function OC(n){const e=await AC(n),t=Lt().gapi;return ae(t,n,"internal-error"),e.open({where:document.body,url:DC(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:jC,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=Fn(n,"network-request-failed"),c=Lt().setTimeout(()=>{i(a)},CC.get());function l(){Lt().clearTimeout(c),s(r)}r.ping(l).then(l,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LC={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},VC=500,MC=600,UC="_blank",FC="http://localhost";class Xg{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function BC(n,e,t,r=VC,s=MC){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const l=Object.assign(Object.assign({},LC),{width:r.toString(),height:s.toString(),top:i,left:a}),d=$t().toLowerCase();t&&(c=B_(d)?UC:t),U_(d)&&(e=e||FC,l.scrollbars="yes");const h=Object.entries(l).reduce((f,[w,k])=>`${f}${w}=${k},`,"");if(Vk(d)&&c!=="_self")return zC(e||"",c),new Xg(null);const m=window.open(e||"",c,h);ae(m,n,"popup-blocked");try{m.focus()}catch{}return new Xg(m)}function zC(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $C="__/auth/handler",qC="emulator/auth/handler",HC=encodeURIComponent("fac");async function Jg(n,e,t,r,s,i){ae(n.config.authDomain,n,"auth-domain-config-required"),ae(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:io,eventId:s};if(e instanceof ma){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",rN(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,m]of Object.entries({}))a[h]=m}if(e instanceof pa){const h=e.getScopes().filter(m=>m!=="");h.length>0&&(a.scopes=h.join(","))}n.tenantId&&(a.tid=n.tenantId);const c=a;for(const h of Object.keys(c))c[h]===void 0&&delete c[h];const l=await n._getAppCheckToken(),d=l?`#${HC}=${encodeURIComponent(l)}`:"";return`${WC(n)}?${fa(c).slice(1)}${d}`}function WC({config:n}){return n.emulator?lm(n,qC):`https://${n.authDomain}/${$C}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bh="webStorageSupport";class GC{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=av,this._completeRedirectFn=yv,this._overrideRedirectResult=mC}async _openPopup(e,t,r,s){var i;_s((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await Jg(e,t,r,vc(),s);return BC(e,a,pd())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Jg(e,t,r,vc(),s);return qA(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(_s(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await OC(e),r=new wC(e);return t.register("authEvent",s=>(ae(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(bh,{type:bh},s=>{var i;const a=(i=s?.[0])===null||i===void 0?void 0:i[bh];a!==void 0&&t(!!a),wr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=TC(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return W_()||F_()||um()}}const KC=GC;var Zg="@firebase/auth",ey="1.10.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QC{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ae(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YC(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function XC(n){Wn(new Rn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;ae(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:G_(n)},d=new $k(r,s,i,l);return sA(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Wn(new Rn("auth-internal",e=>{const t=Jt(e.getProvider("auth").getImmediate());return(r=>new QC(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),sn(Zg,ey,YC(n)),sn(Zg,ey,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JC=300,ZC=w_("authIdTokenMaxAge")||JC;let ty=null;const eS=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>ZC)return;const s=t?.token;ty!==s&&(ty=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function tS(n=Gc()){const e=Or(n,"auth");if(e.isInitialized())return e.getImmediate();const t=rA(n,{popupRedirectResolver:KC,persistence:[ZA,BA,av]}),r=w_("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=eS(i.toString());MA(t,a,()=>a(t.currentUser)),VA(t,c=>a(c))}}const s=g_("auth");return s&&iA(t,`http://${s}`),t}function nS(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}qk({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Fn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",nS().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});XC("Browser");var rS="firebase",sS="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sn(rS,sS,"app");var ny=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ni,wv;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(g,x){function v(){}v.prototype=x.prototype,g.D=x.prototype,g.prototype=new v,g.prototype.constructor=g,g.C=function(A,S,D){for(var T=Array(arguments.length-2),L=2;L<arguments.length;L++)T[L-2]=arguments[L];return x.prototype[S].apply(A,T)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(g,x,v){v||(v=0);var A=Array(16);if(typeof x=="string")for(var S=0;16>S;++S)A[S]=x.charCodeAt(v++)|x.charCodeAt(v++)<<8|x.charCodeAt(v++)<<16|x.charCodeAt(v++)<<24;else for(S=0;16>S;++S)A[S]=x[v++]|x[v++]<<8|x[v++]<<16|x[v++]<<24;x=g.g[0],v=g.g[1],S=g.g[2];var D=g.g[3],T=x+(D^v&(S^D))+A[0]+3614090360&4294967295;x=v+(T<<7&4294967295|T>>>25),T=D+(S^x&(v^S))+A[1]+3905402710&4294967295,D=x+(T<<12&4294967295|T>>>20),T=S+(v^D&(x^v))+A[2]+606105819&4294967295,S=D+(T<<17&4294967295|T>>>15),T=v+(x^S&(D^x))+A[3]+3250441966&4294967295,v=S+(T<<22&4294967295|T>>>10),T=x+(D^v&(S^D))+A[4]+4118548399&4294967295,x=v+(T<<7&4294967295|T>>>25),T=D+(S^x&(v^S))+A[5]+1200080426&4294967295,D=x+(T<<12&4294967295|T>>>20),T=S+(v^D&(x^v))+A[6]+2821735955&4294967295,S=D+(T<<17&4294967295|T>>>15),T=v+(x^S&(D^x))+A[7]+4249261313&4294967295,v=S+(T<<22&4294967295|T>>>10),T=x+(D^v&(S^D))+A[8]+1770035416&4294967295,x=v+(T<<7&4294967295|T>>>25),T=D+(S^x&(v^S))+A[9]+2336552879&4294967295,D=x+(T<<12&4294967295|T>>>20),T=S+(v^D&(x^v))+A[10]+4294925233&4294967295,S=D+(T<<17&4294967295|T>>>15),T=v+(x^S&(D^x))+A[11]+2304563134&4294967295,v=S+(T<<22&4294967295|T>>>10),T=x+(D^v&(S^D))+A[12]+1804603682&4294967295,x=v+(T<<7&4294967295|T>>>25),T=D+(S^x&(v^S))+A[13]+4254626195&4294967295,D=x+(T<<12&4294967295|T>>>20),T=S+(v^D&(x^v))+A[14]+2792965006&4294967295,S=D+(T<<17&4294967295|T>>>15),T=v+(x^S&(D^x))+A[15]+1236535329&4294967295,v=S+(T<<22&4294967295|T>>>10),T=x+(S^D&(v^S))+A[1]+4129170786&4294967295,x=v+(T<<5&4294967295|T>>>27),T=D+(v^S&(x^v))+A[6]+3225465664&4294967295,D=x+(T<<9&4294967295|T>>>23),T=S+(x^v&(D^x))+A[11]+643717713&4294967295,S=D+(T<<14&4294967295|T>>>18),T=v+(D^x&(S^D))+A[0]+3921069994&4294967295,v=S+(T<<20&4294967295|T>>>12),T=x+(S^D&(v^S))+A[5]+3593408605&4294967295,x=v+(T<<5&4294967295|T>>>27),T=D+(v^S&(x^v))+A[10]+38016083&4294967295,D=x+(T<<9&4294967295|T>>>23),T=S+(x^v&(D^x))+A[15]+3634488961&4294967295,S=D+(T<<14&4294967295|T>>>18),T=v+(D^x&(S^D))+A[4]+3889429448&4294967295,v=S+(T<<20&4294967295|T>>>12),T=x+(S^D&(v^S))+A[9]+568446438&4294967295,x=v+(T<<5&4294967295|T>>>27),T=D+(v^S&(x^v))+A[14]+3275163606&4294967295,D=x+(T<<9&4294967295|T>>>23),T=S+(x^v&(D^x))+A[3]+4107603335&4294967295,S=D+(T<<14&4294967295|T>>>18),T=v+(D^x&(S^D))+A[8]+1163531501&4294967295,v=S+(T<<20&4294967295|T>>>12),T=x+(S^D&(v^S))+A[13]+2850285829&4294967295,x=v+(T<<5&4294967295|T>>>27),T=D+(v^S&(x^v))+A[2]+4243563512&4294967295,D=x+(T<<9&4294967295|T>>>23),T=S+(x^v&(D^x))+A[7]+1735328473&4294967295,S=D+(T<<14&4294967295|T>>>18),T=v+(D^x&(S^D))+A[12]+2368359562&4294967295,v=S+(T<<20&4294967295|T>>>12),T=x+(v^S^D)+A[5]+4294588738&4294967295,x=v+(T<<4&4294967295|T>>>28),T=D+(x^v^S)+A[8]+2272392833&4294967295,D=x+(T<<11&4294967295|T>>>21),T=S+(D^x^v)+A[11]+1839030562&4294967295,S=D+(T<<16&4294967295|T>>>16),T=v+(S^D^x)+A[14]+4259657740&4294967295,v=S+(T<<23&4294967295|T>>>9),T=x+(v^S^D)+A[1]+2763975236&4294967295,x=v+(T<<4&4294967295|T>>>28),T=D+(x^v^S)+A[4]+1272893353&4294967295,D=x+(T<<11&4294967295|T>>>21),T=S+(D^x^v)+A[7]+4139469664&4294967295,S=D+(T<<16&4294967295|T>>>16),T=v+(S^D^x)+A[10]+3200236656&4294967295,v=S+(T<<23&4294967295|T>>>9),T=x+(v^S^D)+A[13]+681279174&4294967295,x=v+(T<<4&4294967295|T>>>28),T=D+(x^v^S)+A[0]+3936430074&4294967295,D=x+(T<<11&4294967295|T>>>21),T=S+(D^x^v)+A[3]+3572445317&4294967295,S=D+(T<<16&4294967295|T>>>16),T=v+(S^D^x)+A[6]+76029189&4294967295,v=S+(T<<23&4294967295|T>>>9),T=x+(v^S^D)+A[9]+3654602809&4294967295,x=v+(T<<4&4294967295|T>>>28),T=D+(x^v^S)+A[12]+3873151461&4294967295,D=x+(T<<11&4294967295|T>>>21),T=S+(D^x^v)+A[15]+530742520&4294967295,S=D+(T<<16&4294967295|T>>>16),T=v+(S^D^x)+A[2]+3299628645&4294967295,v=S+(T<<23&4294967295|T>>>9),T=x+(S^(v|~D))+A[0]+4096336452&4294967295,x=v+(T<<6&4294967295|T>>>26),T=D+(v^(x|~S))+A[7]+1126891415&4294967295,D=x+(T<<10&4294967295|T>>>22),T=S+(x^(D|~v))+A[14]+2878612391&4294967295,S=D+(T<<15&4294967295|T>>>17),T=v+(D^(S|~x))+A[5]+4237533241&4294967295,v=S+(T<<21&4294967295|T>>>11),T=x+(S^(v|~D))+A[12]+1700485571&4294967295,x=v+(T<<6&4294967295|T>>>26),T=D+(v^(x|~S))+A[3]+2399980690&4294967295,D=x+(T<<10&4294967295|T>>>22),T=S+(x^(D|~v))+A[10]+4293915773&4294967295,S=D+(T<<15&4294967295|T>>>17),T=v+(D^(S|~x))+A[1]+2240044497&4294967295,v=S+(T<<21&4294967295|T>>>11),T=x+(S^(v|~D))+A[8]+1873313359&4294967295,x=v+(T<<6&4294967295|T>>>26),T=D+(v^(x|~S))+A[15]+4264355552&4294967295,D=x+(T<<10&4294967295|T>>>22),T=S+(x^(D|~v))+A[6]+2734768916&4294967295,S=D+(T<<15&4294967295|T>>>17),T=v+(D^(S|~x))+A[13]+1309151649&4294967295,v=S+(T<<21&4294967295|T>>>11),T=x+(S^(v|~D))+A[4]+4149444226&4294967295,x=v+(T<<6&4294967295|T>>>26),T=D+(v^(x|~S))+A[11]+3174756917&4294967295,D=x+(T<<10&4294967295|T>>>22),T=S+(x^(D|~v))+A[2]+718787259&4294967295,S=D+(T<<15&4294967295|T>>>17),T=v+(D^(S|~x))+A[9]+3951481745&4294967295,g.g[0]=g.g[0]+x&4294967295,g.g[1]=g.g[1]+(S+(T<<21&4294967295|T>>>11))&4294967295,g.g[2]=g.g[2]+S&4294967295,g.g[3]=g.g[3]+D&4294967295}r.prototype.u=function(g,x){x===void 0&&(x=g.length);for(var v=x-this.blockSize,A=this.B,S=this.h,D=0;D<x;){if(S==0)for(;D<=v;)s(this,g,D),D+=this.blockSize;if(typeof g=="string"){for(;D<x;)if(A[S++]=g.charCodeAt(D++),S==this.blockSize){s(this,A),S=0;break}}else for(;D<x;)if(A[S++]=g[D++],S==this.blockSize){s(this,A),S=0;break}}this.h=S,this.o+=x},r.prototype.v=function(){var g=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);g[0]=128;for(var x=1;x<g.length-8;++x)g[x]=0;var v=8*this.o;for(x=g.length-8;x<g.length;++x)g[x]=v&255,v/=256;for(this.u(g),g=Array(16),x=v=0;4>x;++x)for(var A=0;32>A;A+=8)g[v++]=this.g[x]>>>A&255;return g};function i(g,x){var v=c;return Object.prototype.hasOwnProperty.call(v,g)?v[g]:v[g]=x(g)}function a(g,x){this.h=x;for(var v=[],A=!0,S=g.length-1;0<=S;S--){var D=g[S]|0;A&&D==x||(v[S]=D,A=!1)}this.g=v}var c={};function l(g){return-128<=g&&128>g?i(g,function(x){return new a([x|0],0>x?-1:0)}):new a([g|0],0>g?-1:0)}function d(g){if(isNaN(g)||!isFinite(g))return m;if(0>g)return b(d(-g));for(var x=[],v=1,A=0;g>=v;A++)x[A]=g/v|0,v*=4294967296;return new a(x,0)}function h(g,x){if(g.length==0)throw Error("number format error: empty string");if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(g.charAt(0)=="-")return b(h(g.substring(1),x));if(0<=g.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=d(Math.pow(x,8)),A=m,S=0;S<g.length;S+=8){var D=Math.min(8,g.length-S),T=parseInt(g.substring(S,S+D),x);8>D?(D=d(Math.pow(x,D)),A=A.j(D).add(d(T))):(A=A.j(v),A=A.add(d(T)))}return A}var m=l(0),f=l(1),w=l(16777216);n=a.prototype,n.m=function(){if(C(this))return-b(this).m();for(var g=0,x=1,v=0;v<this.g.length;v++){var A=this.i(v);g+=(0<=A?A:4294967296+A)*x,x*=4294967296}return g},n.toString=function(g){if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(k(this))return"0";if(C(this))return"-"+b(this).toString(g);for(var x=d(Math.pow(g,6)),v=this,A="";;){var S=R(v,x).g;v=N(v,S.j(x));var D=((0<v.g.length?v.g[0]:v.h)>>>0).toString(g);if(v=S,k(v))return D+A;for(;6>D.length;)D="0"+D;A=D+A}},n.i=function(g){return 0>g?0:g<this.g.length?this.g[g]:this.h};function k(g){if(g.h!=0)return!1;for(var x=0;x<g.g.length;x++)if(g.g[x]!=0)return!1;return!0}function C(g){return g.h==-1}n.l=function(g){return g=N(this,g),C(g)?-1:k(g)?0:1};function b(g){for(var x=g.g.length,v=[],A=0;A<x;A++)v[A]=~g.g[A];return new a(v,~g.h).add(f)}n.abs=function(){return C(this)?b(this):this},n.add=function(g){for(var x=Math.max(this.g.length,g.g.length),v=[],A=0,S=0;S<=x;S++){var D=A+(this.i(S)&65535)+(g.i(S)&65535),T=(D>>>16)+(this.i(S)>>>16)+(g.i(S)>>>16);A=T>>>16,D&=65535,T&=65535,v[S]=T<<16|D}return new a(v,v[v.length-1]&-2147483648?-1:0)};function N(g,x){return g.add(b(x))}n.j=function(g){if(k(this)||k(g))return m;if(C(this))return C(g)?b(this).j(b(g)):b(b(this).j(g));if(C(g))return b(this.j(b(g)));if(0>this.l(w)&&0>g.l(w))return d(this.m()*g.m());for(var x=this.g.length+g.g.length,v=[],A=0;A<2*x;A++)v[A]=0;for(A=0;A<this.g.length;A++)for(var S=0;S<g.g.length;S++){var D=this.i(A)>>>16,T=this.i(A)&65535,L=g.i(S)>>>16,F=g.i(S)&65535;v[2*A+2*S]+=T*F,I(v,2*A+2*S),v[2*A+2*S+1]+=D*F,I(v,2*A+2*S+1),v[2*A+2*S+1]+=T*L,I(v,2*A+2*S+1),v[2*A+2*S+2]+=D*L,I(v,2*A+2*S+2)}for(A=0;A<x;A++)v[A]=v[2*A+1]<<16|v[2*A];for(A=x;A<2*x;A++)v[A]=0;return new a(v,0)};function I(g,x){for(;(g[x]&65535)!=g[x];)g[x+1]+=g[x]>>>16,g[x]&=65535,x++}function E(g,x){this.g=g,this.h=x}function R(g,x){if(k(x))throw Error("division by zero");if(k(g))return new E(m,m);if(C(g))return x=R(b(g),x),new E(b(x.g),b(x.h));if(C(x))return x=R(g,b(x)),new E(b(x.g),x.h);if(30<g.g.length){if(C(g)||C(x))throw Error("slowDivide_ only works with positive integers.");for(var v=f,A=x;0>=A.l(g);)v=P(v),A=P(A);var S=O(v,1),D=O(A,1);for(A=O(A,2),v=O(v,2);!k(A);){var T=D.add(A);0>=T.l(g)&&(S=S.add(v),D=T),A=O(A,1),v=O(v,1)}return x=N(g,S.j(x)),new E(S,x)}for(S=m;0<=g.l(x);){for(v=Math.max(1,Math.floor(g.m()/x.m())),A=Math.ceil(Math.log(v)/Math.LN2),A=48>=A?1:Math.pow(2,A-48),D=d(v),T=D.j(x);C(T)||0<T.l(g);)v-=A,D=d(v),T=D.j(x);k(D)&&(D=f),S=S.add(D),g=N(g,T)}return new E(S,g)}n.A=function(g){return R(this,g).h},n.and=function(g){for(var x=Math.max(this.g.length,g.g.length),v=[],A=0;A<x;A++)v[A]=this.i(A)&g.i(A);return new a(v,this.h&g.h)},n.or=function(g){for(var x=Math.max(this.g.length,g.g.length),v=[],A=0;A<x;A++)v[A]=this.i(A)|g.i(A);return new a(v,this.h|g.h)},n.xor=function(g){for(var x=Math.max(this.g.length,g.g.length),v=[],A=0;A<x;A++)v[A]=this.i(A)^g.i(A);return new a(v,this.h^g.h)};function P(g){for(var x=g.g.length+1,v=[],A=0;A<x;A++)v[A]=g.i(A)<<1|g.i(A-1)>>>31;return new a(v,g.h)}function O(g,x){var v=x>>5;x%=32;for(var A=g.g.length-v,S=[],D=0;D<A;D++)S[D]=0<x?g.i(D+v)>>>x|g.i(D+v+1)<<32-x:g.i(D+v);return new a(S,g.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,wv=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=h,ni=a}).apply(typeof ny<"u"?ny:typeof self<"u"?self:typeof window<"u"?window:{});var Ol=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var _v,Ha,vv,nu,sf,bv,Iv,Tv;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,_){return u==Array.prototype||u==Object.prototype||(u[p]=_.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ol=="object"&&Ol];for(var p=0;p<u.length;++p){var _=u[p];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var _=r;u=u.split(".");for(var j=0;j<u.length-1;j++){var M=u[j];if(!(M in _))break e;_=_[M]}u=u[u.length-1],j=_[u],p=p(j),p!=j&&p!=null&&e(_,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var _=0,j=!1,M={next:function(){if(!j&&_<u.length){var z=_++;return{value:p(z,u[z]),done:!1}}return j=!0,{done:!0,value:void 0}}};return M[Symbol.iterator]=function(){return M},M}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,_){return _})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},c=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function d(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function h(u,p,_){return u.call.apply(u.bind,arguments)}function m(u,p,_){if(!u)throw Error();if(2<arguments.length){var j=Array.prototype.slice.call(arguments,2);return function(){var M=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(M,j),u.apply(p,M)}}return function(){return u.apply(p,arguments)}}function f(u,p,_){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:m,f.apply(null,arguments)}function w(u,p){var _=Array.prototype.slice.call(arguments,1);return function(){var j=_.slice();return j.push.apply(j,arguments),u.apply(this,j)}}function k(u,p){function _(){}_.prototype=p.prototype,u.aa=p.prototype,u.prototype=new _,u.prototype.constructor=u,u.Qb=function(j,M,z){for(var ie=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)ie[ut-2]=arguments[ut];return p.prototype[M].apply(j,ie)}}function C(u){const p=u.length;if(0<p){const _=Array(p);for(let j=0;j<p;j++)_[j]=u[j];return _}return[]}function b(u,p){for(let _=1;_<arguments.length;_++){const j=arguments[_];if(l(j)){const M=u.length||0,z=j.length||0;u.length=M+z;for(let ie=0;ie<z;ie++)u[M+ie]=j[ie]}else u.push(j)}}class N{constructor(p,_){this.i=p,this.j=_,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function I(u){return/^[\s\xa0]*$/.test(u)}function E(){var u=c.navigator;return u&&(u=u.userAgent)?u:""}function R(u){return R[" "](u),u}R[" "]=function(){};var P=E().indexOf("Gecko")!=-1&&!(E().toLowerCase().indexOf("webkit")!=-1&&E().indexOf("Edge")==-1)&&!(E().indexOf("Trident")!=-1||E().indexOf("MSIE")!=-1)&&E().indexOf("Edge")==-1;function O(u,p,_){for(const j in u)p.call(_,u[j],j,u)}function g(u,p){for(const _ in u)p.call(void 0,u[_],_,u)}function x(u){const p={};for(const _ in u)p[_]=u[_];return p}const v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function A(u,p){let _,j;for(let M=1;M<arguments.length;M++){j=arguments[M];for(_ in j)u[_]=j[_];for(let z=0;z<v.length;z++)_=v[z],Object.prototype.hasOwnProperty.call(j,_)&&(u[_]=j[_])}}function S(u){var p=1;u=u.split(":");const _=[];for(;0<p&&u.length;)_.push(u.shift()),p--;return u.length&&_.push(u.join(":")),_}function D(u){c.setTimeout(()=>{throw u},0)}function T(){var u=B;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class L{constructor(){this.h=this.g=null}add(p,_){const j=F.get();j.set(p,_),this.h?this.h.next=j:this.g=j,this.h=j}}var F=new N(()=>new G,u=>u.reset());class G{constructor(){this.next=this.g=this.h=null}set(p,_){this.h=p,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let q,U=!1,B=new L,Y=()=>{const u=c.Promise.resolve(void 0);q=()=>{u.then(ue)}};var ue=()=>{for(var u;u=T();){try{u.h.call(u.g)}catch(_){D(_)}var p=F;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}U=!1};function J(){this.s=this.s,this.C=this.C}J.prototype.s=!1,J.prototype.ma=function(){this.s||(this.s=!0,this.N())},J.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function H(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}H.prototype.h=function(){this.defaultPrevented=!0};var we=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const _=()=>{};c.addEventListener("test",_,p),c.removeEventListener("test",_,p)}catch{}return u})();function Ae(u,p){if(H.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var _=this.type=u.type,j=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(P){e:{try{R(p.nodeName);var M=!0;break e}catch{}M=!1}M||(p=null)}}else _=="mouseover"?p=u.fromElement:_=="mouseout"&&(p=u.toElement);this.relatedTarget=p,j?(this.clientX=j.clientX!==void 0?j.clientX:j.pageX,this.clientY=j.clientY!==void 0?j.clientY:j.pageY,this.screenX=j.screenX||0,this.screenY=j.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:ct[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Ae.aa.h.call(this)}}k(Ae,H);var ct={2:"touch",3:"pen",4:"mouse"};Ae.prototype.h=function(){Ae.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var qe="closure_listenable_"+(1e6*Math.random()|0),re=0;function je(u,p,_,j,M){this.listener=u,this.proxy=null,this.src=p,this.type=_,this.capture=!!j,this.ha=M,this.key=++re,this.da=this.fa=!1}function ze(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function it(u){this.src=u,this.g={},this.h=0}it.prototype.add=function(u,p,_,j,M){var z=u.toString();u=this.g[z],u||(u=this.g[z]=[],this.h++);var ie=ot(u,p,j,M);return-1<ie?(p=u[ie],_||(p.fa=!1)):(p=new je(p,this.src,z,!!j,M),p.fa=_,u.push(p)),p};function Rt(u,p){var _=p.type;if(_ in u.g){var j=u.g[_],M=Array.prototype.indexOf.call(j,p,void 0),z;(z=0<=M)&&Array.prototype.splice.call(j,M,1),z&&(ze(p),u.g[_].length==0&&(delete u.g[_],u.h--))}}function ot(u,p,_,j){for(var M=0;M<u.length;++M){var z=u[M];if(!z.da&&z.listener==p&&z.capture==!!_&&z.ha==j)return M}return-1}var et="closure_lm_"+(1e6*Math.random()|0),ft={};function Ye(u,p,_,j,M){if(Array.isArray(p)){for(var z=0;z<p.length;z++)Ye(u,p[z],_,j,M);return null}return _=jt(_),u&&u[qe]?u.K(p,_,d(j)?!!j.capture:!1,M):Ve(u,p,_,!1,j,M)}function Ve(u,p,_,j,M,z){if(!p)throw Error("Invalid event type");var ie=d(M)?!!M.capture:!!M,ut=Gt(u);if(ut||(u[et]=ut=new it(u)),_=ut.add(p,_,j,ie,z),_.proxy)return _;if(j=Ue(),_.proxy=j,j.src=u,j.listener=_,u.addEventListener)we||(M=ie),M===void 0&&(M=!1),u.addEventListener(p.toString(),j,M);else if(u.attachEvent)u.attachEvent(Dn(p.toString()),j);else if(u.addListener&&u.removeListener)u.addListener(j);else throw Error("addEventListener and attachEvent are unavailable.");return _}function Ue(){function u(_){return p.call(u.src,u.listener,_)}const p=Lr;return u}function mt(u,p,_,j,M){if(Array.isArray(p))for(var z=0;z<p.length;z++)mt(u,p[z],_,j,M);else j=d(j)?!!j.capture:!!j,_=jt(_),u&&u[qe]?(u=u.i,p=String(p).toString(),p in u.g&&(z=u.g[p],_=ot(z,_,j,M),-1<_&&(ze(z[_]),Array.prototype.splice.call(z,_,1),z.length==0&&(delete u.g[p],u.h--)))):u&&(u=Gt(u))&&(p=u.g[p.toString()],u=-1,p&&(u=ot(p,_,j,M)),(_=-1<u?p[u]:null)&&Ge(_))}function Ge(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[qe])Rt(p.i,u);else{var _=u.type,j=u.proxy;p.removeEventListener?p.removeEventListener(_,j,u.capture):p.detachEvent?p.detachEvent(Dn(_),j):p.addListener&&p.removeListener&&p.removeListener(j),(_=Gt(p))?(Rt(_,u),_.h==0&&(_.src=null,p[et]=null)):ze(u)}}}function Dn(u){return u in ft?ft[u]:ft[u]="on"+u}function Lr(u,p){if(u.da)u=!0;else{p=new Ae(p,this);var _=u.listener,j=u.ha||u.src;u.fa&&Ge(u),u=_.call(j,p)}return u}function Gt(u){return u=u[et],u instanceof it?u:null}var Kt="__closure_events_fn_"+(1e9*Math.random()>>>0);function jt(u){return typeof u=="function"?u:(u[Kt]||(u[Kt]=function(p){return u.handleEvent(p)}),u[Kt])}function lt(){J.call(this),this.i=new it(this),this.M=this,this.F=null}k(lt,J),lt.prototype[qe]=!0,lt.prototype.removeEventListener=function(u,p,_,j){mt(this,u,p,_,j)};function pt(u,p){var _,j=u.F;if(j)for(_=[];j;j=j.F)_.push(j);if(u=u.M,j=p.type||p,typeof p=="string")p=new H(p,u);else if(p instanceof H)p.target=p.target||u;else{var M=p;p=new H(j,u),A(p,M)}if(M=!0,_)for(var z=_.length-1;0<=z;z--){var ie=p.g=_[z];M=On(ie,j,!0,p)&&M}if(ie=p.g=u,M=On(ie,j,!0,p)&&M,M=On(ie,j,!1,p)&&M,_)for(z=0;z<_.length;z++)ie=p.g=_[z],M=On(ie,j,!1,p)&&M}lt.prototype.N=function(){if(lt.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var _=u.g[p],j=0;j<_.length;j++)ze(_[j]);delete u.g[p],u.h--}}this.F=null},lt.prototype.K=function(u,p,_,j){return this.i.add(String(u),p,!1,_,j)},lt.prototype.L=function(u,p,_,j){return this.i.add(String(u),p,!0,_,j)};function On(u,p,_,j){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var M=!0,z=0;z<p.length;++z){var ie=p[z];if(ie&&!ie.da&&ie.capture==_){var ut=ie.listener,tn=ie.ha||ie.src;ie.fa&&Rt(u.i,ie),M=ut.call(tn,j)!==!1&&M}}return M&&!j.defaultPrevented}function lr(u,p,_){if(typeof u=="function")_&&(u=f(u,_));else if(u&&typeof u.handleEvent=="function")u=f(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:c.setTimeout(u,p||0)}function vr(u){u.g=lr(()=>{u.g=null,u.i&&(u.i=!1,vr(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class br extends J{constructor(p,_){super(),this.m=p,this.l=_,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:vr(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yn(u){J.call(this),this.h=u,this.g={}}k(Yn,J);var Rs=[];function Ir(u){O(u.g,function(p,_){this.g.hasOwnProperty(_)&&Ge(p)},u),u.g={}}Yn.prototype.N=function(){Yn.aa.N.call(this),Ir(this)},Yn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var es=c.JSON.stringify,ts=c.JSON.parse,bi=class{stringify(u){return c.JSON.stringify(u,void 0)}parse(u){return c.JSON.parse(u,void 0)}};function Vr(){}Vr.prototype.h=null;function ns(u){return u.h||(u.h=u.i())}function Qt(){}var Mr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function He(){H.call(this,"d")}k(He,H);function pe(){H.call(this,"c")}k(pe,H);var Ce={},vn=null;function Tr(){return vn=vn||new lt}Ce.La="serverreachability";function Er(u){H.call(this,Ce.La,u)}k(Er,H);function Nr(u){const p=Tr();pt(p,new Er(p))}Ce.STAT_EVENT="statevent";function fo(u,p){H.call(this,Ce.STAT_EVENT,u),this.stat=p}k(fo,H);function Pt(u){const p=Tr();pt(p,new fo(p,u))}Ce.Ma="timingevent";function Na(u,p){H.call(this,Ce.Ma,u),this.size=p}k(Na,H);function rs(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){u()},p)}function Ft(){this.g=!0}Ft.prototype.xa=function(){this.g=!1};function Zd(u,p,_,j,M,z){u.info(function(){if(u.g)if(z)for(var ie="",ut=z.split("&"),tn=0;tn<ut.length;tn++){var Xe=ut[tn].split("=");if(1<Xe.length){var fn=Xe[0];Xe=Xe[1];var mn=fn.split("_");ie=2<=mn.length&&mn[1]=="type"?ie+(fn+"="+Xe+"&"):ie+(fn+"=redacted&")}}else ie=null;else ie=z;return"XMLHTTP REQ ("+j+") [attempt "+M+"]: "+p+`
`+_+`
`+ie})}function mo(u,p,_,j,M,z,ie){u.info(function(){return"XMLHTTP RESP ("+j+") [ attempt "+M+"]: "+p+`
`+_+`
`+z+" "+ie})}function Ii(u,p,_,j){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+th(u,_)+(j?" "+j:"")})}function eh(u,p){u.info(function(){return"TIMEOUT: "+p})}Ft.prototype.info=function(){};function th(u,p){if(!u.g)return p;if(!p)return null;try{var _=JSON.parse(p);if(_){for(u=0;u<_.length;u++)if(Array.isArray(_[u])){var j=_[u];if(!(2>j.length)){var M=j[1];if(Array.isArray(M)&&!(1>M.length)){var z=M[0];if(z!="noop"&&z!="stop"&&z!="close")for(var ie=1;ie<M.length;ie++)M[ie]=""}}}}return es(_)}catch{return p}}var ss={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},on={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},po;function is(){}k(is,Vr),is.prototype.g=function(){return new XMLHttpRequest},is.prototype.i=function(){return{}},po=new is;function bn(u,p,_,j){this.j=u,this.i=p,this.l=_,this.R=j||1,this.U=new Yn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ur}function Ur(){this.i=null,this.g="",this.h=!1}var In={},js={};function os(u,p,_){u.L=1,u.v=wo(Jn(p)),u.m=_,u.P=!0,_l(u,null)}function _l(u,p){u.F=Date.now(),as(u),u.A=Jn(u.v);var _=u.A,j=u.R;Array.isArray(j)||(j=[String(j)]),hn(_.i,"t",j),u.C=0,_=u.j.J,u.h=new Ur,u.g=fg(u.j,_?p:null,!u.m),0<u.O&&(u.M=new br(f(u.Y,u,u.g),u.O)),p=u.U,_=u.g,j=u.ca;var M="readystatechange";Array.isArray(M)||(M&&(Rs[0]=M.toString()),M=Rs);for(var z=0;z<M.length;z++){var ie=Ye(_,M[z],j||p.handleEvent,!1,p.h||p);if(!ie)break;p.g[ie.key]=ie}p=u.H?x(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Nr(),Zd(u.i,u.u,u.A,u.l,u.R,u.m)}bn.prototype.ca=function(u){u=u.target;const p=this.M;p&&ds(u)==3?p.j():this.Y(u)},bn.prototype.Y=function(u){try{if(u==this.g)e:{const mn=ds(this.g);var p=this.g.Ba();const vo=this.g.Z();if(!(3>mn)&&(mn!=3||this.g&&(this.h.h||this.g.oa()||ng(this.g)))){this.J||mn!=4||p==7||(p==8||0>=vo?Nr(3):Nr(2)),Xn(this);var _=this.g.Z();this.X=_;t:if(vl(this)){var j=ng(this.g);u="";var M=j.length,z=ds(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){an(this),Ti(this);var ie="";break t}this.h.i=new c.TextDecoder}for(p=0;p<M;p++)this.h.h=!0,u+=this.h.i.decode(j[p],{stream:!(z&&p==M-1)});j.length=0,this.h.g+=u,this.C=0,ie=this.h.g}else ie=this.g.oa();if(this.o=_==200,mo(this.i,this.u,this.A,this.l,this.R,mn,_),this.o){if(this.T&&!this.K){t:{if(this.g){var ut,tn=this.g;if((ut=tn.g?tn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(ut)){var Xe=ut;break t}}Xe=null}if(_=Xe)Ii(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Tn(this,_);else{this.o=!1,this.s=3,Pt(12),an(this),Ti(this);break e}}if(this.P){_=!0;let kr;for(;!this.J&&this.C<ie.length;)if(kr=go(this,ie),kr==js){mn==4&&(this.s=4,Pt(14),_=!1),Ii(this.i,this.l,null,"[Incomplete Response]");break}else if(kr==In){this.s=4,Pt(15),Ii(this.i,this.l,ie,"[Invalid Chunk]"),_=!1;break}else Ii(this.i,this.l,kr,null),Tn(this,kr);if(vl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),mn!=4||ie.length!=0||this.h.h||(this.s=1,Pt(16),_=!1),this.o=this.o&&_,!_)Ii(this.i,this.l,ie,"[Invalid Chunked Response]"),an(this),Ti(this);else if(0<ie.length&&!this.W){this.W=!0;var fn=this.j;fn.g==this&&fn.ba&&!fn.M&&(fn.j.info("Great, no buffering proxy detected. Bytes received: "+ie.length),dh(fn),fn.M=!0,Pt(11))}}else Ii(this.i,this.l,ie,null),Tn(this,ie);mn==4&&an(this),this.o&&!this.J&&(mn==4?lg(this.j,this):(this.o=!1,as(this)))}else jT(this.g),_==400&&0<ie.indexOf("Unknown SID")?(this.s=3,Pt(12)):(this.s=0,Pt(13)),an(this),Ti(this)}}}catch{}finally{}};function vl(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function go(u,p){var _=u.C,j=p.indexOf(`
`,_);return j==-1?js:(_=Number(p.substring(_,j)),isNaN(_)?In:(j+=1,j+_>p.length?js:(p=p.slice(j,j+_),u.C=j+_,p)))}bn.prototype.cancel=function(){this.J=!0,an(this)};function as(u){u.S=Date.now()+u.I,yo(u,u.I)}function yo(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=rs(f(u.ba,u),p)}function Xn(u){u.B&&(c.clearTimeout(u.B),u.B=null)}bn.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(eh(this.i,this.A),this.L!=2&&(Nr(),Pt(17)),an(this),this.s=2,Ti(this)):yo(this,this.S-u)};function Ti(u){u.j.G==0||u.J||lg(u.j,u)}function an(u){Xn(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Ir(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Tn(u,p){try{var _=u.j;if(_.G!=0&&(_.g==u||dn(_.h,u))){if(!u.K&&dn(_.h,u)&&_.G==3){try{var j=_.Da.g.parse(p)}catch{j=null}if(Array.isArray(j)&&j.length==3){var M=j;if(M[0]==0){e:if(!_.u){if(_.g)if(_.g.F+3e3<u.F)Rl(_),Cl(_);else break e;uh(_),Pt(18)}}else _.za=M[1],0<_.za-_.T&&37500>M[2]&&_.F&&_.v==0&&!_.C&&(_.C=rs(f(_.Za,_),6e3));if(1>=un(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else ki(_,11)}else if((u.K||_.g==u)&&Rl(_),!I(p))for(M=_.Da.g.parse(p),p=0;p<M.length;p++){let Xe=M[p];if(_.T=Xe[0],Xe=Xe[1],_.G==2)if(Xe[0]=="c"){_.K=Xe[1],_.ia=Xe[2];const fn=Xe[3];fn!=null&&(_.la=fn,_.j.info("VER="+_.la));const mn=Xe[4];mn!=null&&(_.Aa=mn,_.j.info("SVER="+_.Aa));const vo=Xe[5];vo!=null&&typeof vo=="number"&&0<vo&&(j=1.5*vo,_.L=j,_.j.info("backChannelRequestTimeoutMs_="+j)),j=_;const kr=u.g;if(kr){const Pl=kr.g?kr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Pl){var z=j.h;z.g||Pl.indexOf("spdy")==-1&&Pl.indexOf("quic")==-1&&Pl.indexOf("h2")==-1||(z.j=z.l,z.g=new Set,z.h&&(ka(z,z.h),z.h=null))}if(j.D){const hh=kr.g?kr.g.getResponseHeader("X-HTTP-Session-Id"):null;hh&&(j.ya=hh,De(j.I,j.D,hh))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-u.F,_.j.info("Handshake RTT: "+_.R+"ms")),j=_;var ie=u;if(j.qa=hg(j,j.J?j.ia:null,j.W),ie.K){xo(j.h,ie);var ut=ie,tn=j.L;tn&&(ut.I=tn),ut.B&&(Xn(ut),as(ut)),j.g=ie}else ag(j);0<_.i.length&&Sl(_)}else Xe[0]!="stop"&&Xe[0]!="close"||ki(_,7);else _.G==3&&(Xe[0]=="stop"||Xe[0]=="close"?Xe[0]=="stop"?ki(_,7):lh(_):Xe[0]!="noop"&&_.l&&_.l.ta(Xe),_.v=0)}}Nr(4)}catch{}}var bl=class{constructor(u,p){this.g=u,this.map=p}};function cn(u){this.l=u||10,c.PerformanceNavigationTiming?(u=c.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ln(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function un(u){return u.h?1:u.g?u.g.size:0}function dn(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function ka(u,p){u.g?u.g.add(p):u.h=p}function xo(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}cn.prototype.cancel=function(){if(this.i=Il(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Il(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const _ of u.g.values())p=p.concat(_.D);return p}return C(u.i)}function nh(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],_=u.length,j=0;j<_;j++)p.push(u[j]);return p}p=[],_=0;for(j in u)p[_++]=u[j];return p}function rh(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var _=0;_<u;_++)p.push(_);return p}p=[],_=0;for(const j in u)p[_++]=j;return p}}}function Tl(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var _=rh(u),j=nh(u),M=j.length,z=0;z<M;z++)p.call(void 0,j[z],_&&_[z],u)}var El=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sh(u,p){if(u){u=u.split("&");for(var _=0;_<u.length;_++){var j=u[_].indexOf("="),M=null;if(0<=j){var z=u[_].substring(0,j);M=u[_].substring(j+1)}else z=u[_];p(z,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function cs(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof cs){this.h=u.h,Ke(this,u.j),this.o=u.o,this.g=u.g,ls(this,u.s),this.l=u.l;var p=u.i,_=new W;_.i=p.i,p.g&&(_.g=new Map(p.g),_.h=p.h),Dt(this,_),this.m=u.m}else u&&(p=String(u).match(El))?(this.h=!1,Ke(this,p[1]||"",!0),this.o=Ps(p[2]||""),this.g=Ps(p[3]||"",!0),ls(this,p[4]),this.l=Ps(p[5]||"",!0),Dt(this,p[6]||"",!0),this.m=Ps(p[7]||"")):(this.h=!1,this.i=new W(null,this.h))}cs.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Ei(p,Nl,!0),":");var _=this.g;return(_||p=="file")&&(u.push("//"),(p=this.o)&&u.push(Ei(p,Nl,!0),"@"),u.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_=this.s,_!=null&&u.push(":",String(_))),(_=this.l)&&(this.g&&_.charAt(0)!="/"&&u.push("/"),u.push(Ei(_,_.charAt(0)=="/"?Ds:kl,!0))),(_=this.i.toString())&&u.push("?",_),(_=this.m)&&u.push("#",Ei(_,oh)),u.join("")};function Jn(u){return new cs(u)}function Ke(u,p,_){u.j=_?Ps(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function ls(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Dt(u,p,_){p instanceof W?(u.i=p,Ni(u.i,u.h)):(_||(p=Ei(p,ih)),u.i=new W(p,u.h))}function De(u,p,_){u.i.set(p,_)}function wo(u){return De(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Ps(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Ei(u,p,_){return typeof u=="string"?(u=encodeURI(u).replace(p,Aa),_&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Aa(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Nl=/[#\/\?@]/g,kl=/[#\?:]/g,Ds=/[#\?]/g,ih=/[#\?@]/g,oh=/#/g;function W(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function K(u){u.g||(u.g=new Map,u.h=0,u.i&&sh(u.i,function(p,_){u.add(decodeURIComponent(p.replace(/\+/g," ")),_)}))}n=W.prototype,n.add=function(u,p){K(this),this.i=null,u=Zt(this,u);var _=this.g.get(u);return _||this.g.set(u,_=[]),_.push(p),this.h+=1,this};function fe(u,p){K(u),p=Zt(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Oe(u,p){return K(u),p=Zt(u,p),u.g.has(p)}n.forEach=function(u,p){K(this),this.g.forEach(function(_,j){_.forEach(function(M){u.call(p,M,j,this)},this)},this)},n.na=function(){K(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),_=[];for(let j=0;j<p.length;j++){const M=u[j];for(let z=0;z<M.length;z++)_.push(p[j])}return _},n.V=function(u){K(this);let p=[];if(typeof u=="string")Oe(this,u)&&(p=p.concat(this.g.get(Zt(this,u))));else{u=Array.from(this.g.values());for(let _=0;_<u.length;_++)p=p.concat(u[_])}return p},n.set=function(u,p){return K(this),this.i=null,u=Zt(this,u),Oe(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function hn(u,p,_){fe(u,p),0<_.length&&(u.i=null,u.g.set(Zt(u,p),C(_)),u.h+=_.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var _=0;_<p.length;_++){var j=p[_];const z=encodeURIComponent(String(j)),ie=this.V(j);for(j=0;j<ie.length;j++){var M=z;ie[j]!==""&&(M+="="+encodeURIComponent(String(ie[j]))),u.push(M)}}return this.i=u.join("&")};function Zt(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Ni(u,p){p&&!u.j&&(K(u),u.i=null,u.g.forEach(function(_,j){var M=j.toLowerCase();j!=M&&(fe(this,j),hn(this,M,_))},u)),u.j=p}function en(u,p){const _=new Ft;if(c.Image){const j=new Image;j.onload=w(us,_,"TestLoadImage: loaded",!0,p,j),j.onerror=w(us,_,"TestLoadImage: error",!1,p,j),j.onabort=w(us,_,"TestLoadImage: abort",!1,p,j),j.ontimeout=w(us,_,"TestLoadImage: timeout",!1,p,j),c.setTimeout(function(){j.ontimeout&&j.ontimeout()},1e4),j.src=u}else p(!1)}function ur(u,p){const _=new Ft,j=new AbortController,M=setTimeout(()=>{j.abort(),us(_,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:j.signal}).then(z=>{clearTimeout(M),z.ok?us(_,"TestPingServer: ok",!0,p):us(_,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(M),us(_,"TestPingServer: error",!1,p)})}function us(u,p,_,j,M){try{M&&(M.onload=null,M.onerror=null,M.onabort=null,M.ontimeout=null),j(_)}catch{}}function ah(){this.g=new bi}function Os(u,p,_){const j=_||"";try{Tl(u,function(M,z){let ie=M;d(M)&&(ie=es(M)),p.push(j+z+"="+encodeURIComponent(ie))})}catch(M){throw p.push(j+"type="+encodeURIComponent("_badmap")),M}}function dr(u){this.l=u.Ub||null,this.j=u.eb||!1}k(dr,Vr),dr.prototype.g=function(){return new Ls(this.l,this.j)},dr.prototype.i=(function(u){return function(){return u}})({});function Ls(u,p){lt.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Ls,lt),n=Ls.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Sa(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||c).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ca(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Sa(this)),this.g&&(this.readyState=3,Sa(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Yp(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Yp(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Ca(this):Sa(this),this.readyState==3&&Yp(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Ca(this))},n.Qa=function(u){this.g&&(this.response=u,Ca(this))},n.ga=function(){this.g&&Ca(this)};function Ca(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Sa(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var _=p.next();!_.done;)_=_.value,u.push(_[0]+": "+_[1]),_=p.next();return u.join(`\r
`)};function Sa(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Ls.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Xp(u){let p="";return O(u,function(_,j){p+=j,p+=":",p+=_,p+=`\r
`}),p}function ch(u,p,_){e:{for(j in _){var j=!1;break e}j=!0}j||(_=Xp(_),typeof u=="string"?_!=null&&encodeURIComponent(String(_)):De(u,p,_))}function Et(u){lt.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(Et,lt);var ST=/^https?$/i,RT=["POST","PUT"];n=Et.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,_,j){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():po.g(),this.v=this.o?ns(this.o):ns(po),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(z){Jp(this,z);return}if(u=_||"",_=new Map(this.headers),j)if(Object.getPrototypeOf(j)===Object.prototype)for(var M in j)_.set(M,j[M]);else if(typeof j.keys=="function"&&typeof j.get=="function")for(const z of j.keys())_.set(z,j.get(z));else throw Error("Unknown input type for opt_headers: "+String(j));j=Array.from(_.keys()).find(z=>z.toLowerCase()=="content-type"),M=c.FormData&&u instanceof c.FormData,!(0<=Array.prototype.indexOf.call(RT,p,void 0))||j||M||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[z,ie]of _)this.g.setRequestHeader(z,ie);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tg(this),this.u=!0,this.g.send(u),this.u=!1}catch(z){Jp(this,z)}};function Jp(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,Zp(u),Al(u)}function Zp(u){u.A||(u.A=!0,pt(u,"complete"),pt(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,pt(this,"complete"),pt(this,"abort"),Al(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Al(this,!0)),Et.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?eg(this):this.bb())},n.bb=function(){eg(this)};function eg(u){if(u.h&&typeof a<"u"&&(!u.v[1]||ds(u)!=4||u.Z()!=2)){if(u.u&&ds(u)==4)lr(u.Ea,0,u);else if(pt(u,"readystatechange"),ds(u)==4){u.h=!1;try{const ie=u.Z();e:switch(ie){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var _;if(!(_=p)){var j;if(j=ie===0){var M=String(u.D).match(El)[1]||null;!M&&c.self&&c.self.location&&(M=c.self.location.protocol.slice(0,-1)),j=!ST.test(M?M.toLowerCase():"")}_=j}if(_)pt(u,"complete"),pt(u,"success");else{u.m=6;try{var z=2<ds(u)?u.g.statusText:""}catch{z=""}u.l=z+" ["+u.Z()+"]",Zp(u)}}finally{Al(u)}}}}function Al(u,p){if(u.g){tg(u);const _=u.g,j=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||pt(u,"ready");try{_.onreadystatechange=j}catch{}}}function tg(u){u.I&&(c.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function ds(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<ds(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),ts(p)}};function ng(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function jT(u){const p={};u=(u.g&&2<=ds(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let j=0;j<u.length;j++){if(I(u[j]))continue;var _=S(u[j]);const M=_[0];if(_=_[1],typeof _!="string")continue;_=_.trim();const z=p[M]||[];p[M]=z,z.push(_)}g(p,function(j){return j.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ra(u,p,_){return _&&_.internalChannelParams&&_.internalChannelParams[u]||p}function rg(u){this.Aa=0,this.i=[],this.j=new Ft,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ra("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ra("baseRetryDelayMs",5e3,u),this.cb=Ra("retryDelaySeedMs",1e4,u),this.Wa=Ra("forwardChannelMaxRetries",2,u),this.wa=Ra("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new cn(u&&u.concurrentRequestLimit),this.Da=new ah,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=rg.prototype,n.la=8,n.G=1,n.connect=function(u,p,_,j){Pt(0),this.W=u,this.H=p||{},_&&j!==void 0&&(this.H.OSID=_,this.H.OAID=j),this.F=this.X,this.I=hg(this,null,this.W),Sl(this)};function lh(u){if(sg(u),u.G==3){var p=u.U++,_=Jn(u.I);if(De(_,"SID",u.K),De(_,"RID",p),De(_,"TYPE","terminate"),ja(u,_),p=new bn(u,u.j,p),p.L=2,p.v=wo(Jn(_)),_=!1,c.navigator&&c.navigator.sendBeacon)try{_=c.navigator.sendBeacon(p.v.toString(),"")}catch{}!_&&c.Image&&(new Image().src=p.v,_=!0),_||(p.g=fg(p.j,null),p.g.ea(p.v)),p.F=Date.now(),as(p)}dg(u)}function Cl(u){u.g&&(dh(u),u.g.cancel(),u.g=null)}function sg(u){Cl(u),u.u&&(c.clearTimeout(u.u),u.u=null),Rl(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&c.clearTimeout(u.s),u.s=null)}function Sl(u){if(!ln(u.h)&&!u.s){u.s=!0;var p=u.Ga;q||Y(),U||(q(),U=!0),B.add(p,u),u.B=0}}function PT(u,p){return un(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=rs(f(u.Ga,u,p),ug(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const M=new bn(this,this.j,u);let z=this.o;if(this.S&&(z?(z=x(z),A(z,this.S)):z=this.S),this.m!==null||this.O||(M.H=z,z=null),this.P)e:{for(var p=0,_=0;_<this.i.length;_++){t:{var j=this.i[_];if("__data__"in j.map&&(j=j.map.__data__,typeof j=="string")){j=j.length;break t}j=void 0}if(j===void 0)break;if(p+=j,4096<p){p=_;break e}if(p===4096||_===this.i.length-1){p=_+1;break e}}p=1e3}else p=1e3;p=og(this,M,p),_=Jn(this.I),De(_,"RID",u),De(_,"CVER",22),this.D&&De(_,"X-HTTP-Session-Id",this.D),ja(this,_),z&&(this.O?p="headers="+encodeURIComponent(String(Xp(z)))+"&"+p:this.m&&ch(_,this.m,z)),ka(this.h,M),this.Ua&&De(_,"TYPE","init"),this.P?(De(_,"$req",p),De(_,"SID","null"),M.T=!0,os(M,_,null)):os(M,_,p),this.G=2}}else this.G==3&&(u?ig(this,u):this.i.length==0||ln(this.h)||ig(this))};function ig(u,p){var _;p?_=p.l:_=u.U++;const j=Jn(u.I);De(j,"SID",u.K),De(j,"RID",_),De(j,"AID",u.T),ja(u,j),u.m&&u.o&&ch(j,u.m,u.o),_=new bn(u,u.j,_,u.B+1),u.m===null&&(_.H=u.o),p&&(u.i=p.D.concat(u.i)),p=og(u,_,1e3),_.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),ka(u.h,_),os(_,j,p)}function ja(u,p){u.H&&O(u.H,function(_,j){De(p,j,_)}),u.l&&Tl({},function(_,j){De(p,j,_)})}function og(u,p,_){_=Math.min(u.i.length,_);var j=u.l?f(u.l.Na,u.l,u):null;e:{var M=u.i;let z=-1;for(;;){const ie=["count="+_];z==-1?0<_?(z=M[0].g,ie.push("ofs="+z)):z=0:ie.push("ofs="+z);let ut=!0;for(let tn=0;tn<_;tn++){let Xe=M[tn].g;const fn=M[tn].map;if(Xe-=z,0>Xe)z=Math.max(0,M[tn].g-100),ut=!1;else try{Os(fn,ie,"req"+Xe+"_")}catch{j&&j(fn)}}if(ut){j=ie.join("&");break e}}}return u=u.i.splice(0,_),p.D=u,j}function ag(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;q||Y(),U||(q(),U=!0),B.add(p,u),u.v=0}}function uh(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=rs(f(u.Fa,u),ug(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,cg(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=rs(f(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Pt(10),Cl(this),cg(this))};function dh(u){u.A!=null&&(c.clearTimeout(u.A),u.A=null)}function cg(u){u.g=new bn(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=Jn(u.qa);De(p,"RID","rpc"),De(p,"SID",u.K),De(p,"AID",u.T),De(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&De(p,"TO",u.ja),De(p,"TYPE","xmlhttp"),ja(u,p),u.m&&u.o&&ch(p,u.m,u.o),u.L&&(u.g.I=u.L);var _=u.g;u=u.ia,_.L=1,_.v=wo(Jn(p)),_.m=null,_.P=!0,_l(_,u)}n.Za=function(){this.C!=null&&(this.C=null,Cl(this),uh(this),Pt(19))};function Rl(u){u.C!=null&&(c.clearTimeout(u.C),u.C=null)}function lg(u,p){var _=null;if(u.g==p){Rl(u),dh(u),u.g=null;var j=2}else if(dn(u.h,p))_=p.D,xo(u.h,p),j=1;else return;if(u.G!=0){if(p.o)if(j==1){_=p.m?p.m.length:0,p=Date.now()-p.F;var M=u.B;j=Tr(),pt(j,new Na(j,_)),Sl(u)}else ag(u);else if(M=p.s,M==3||M==0&&0<p.X||!(j==1&&PT(u,p)||j==2&&uh(u)))switch(_&&0<_.length&&(p=u.h,p.i=p.i.concat(_)),M){case 1:ki(u,5);break;case 4:ki(u,10);break;case 3:ki(u,6);break;default:ki(u,2)}}}function ug(u,p){let _=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(_*=2),_*p}function ki(u,p){if(u.j.info("Error code "+p),p==2){var _=f(u.fb,u),j=u.Xa;const M=!j;j=new cs(j||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Ke(j,"https"),wo(j),M?en(j.toString(),_):ur(j.toString(),_)}else Pt(2);u.G=0,u.l&&u.l.sa(p),dg(u),sg(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Pt(2)):(this.j.info("Failed to ping google.com"),Pt(1))};function dg(u){if(u.G=0,u.ka=[],u.l){const p=Il(u.h);(p.length!=0||u.i.length!=0)&&(b(u.ka,p),b(u.ka,u.i),u.h.i.length=0,C(u.i),u.i.length=0),u.l.ra()}}function hg(u,p,_){var j=_ instanceof cs?Jn(_):new cs(_);if(j.g!="")p&&(j.g=p+"."+j.g),ls(j,j.s);else{var M=c.location;j=M.protocol,p=p?p+"."+M.hostname:M.hostname,M=+M.port;var z=new cs(null);j&&Ke(z,j),p&&(z.g=p),M&&ls(z,M),_&&(z.l=_),j=z}return _=u.D,p=u.ya,_&&p&&De(j,_,p),De(j,"VER",u.la),ja(u,j),j}function fg(u,p,_){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Et(new dr({eb:_})):new Et(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function mg(){}n=mg.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function jl(){}jl.prototype.g=function(u,p){return new Zn(u,p)};function Zn(u,p){lt.call(this),this.g=new rg(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!I(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!I(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new _o(this)}k(Zn,lt),Zn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Zn.prototype.close=function(){lh(this.g)},Zn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var _={};_.__data__=u,u=_}else this.u&&(_={},_.__data__=es(u),u=_);p.i.push(new bl(p.Ya++,u)),p.G==3&&Sl(p)},Zn.prototype.N=function(){this.g.l=null,delete this.j,lh(this.g),delete this.g,Zn.aa.N.call(this)};function pg(u){He.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const _ in p){u=_;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}k(pg,He);function gg(){pe.call(this),this.status=1}k(gg,pe);function _o(u){this.g=u}k(_o,mg),_o.prototype.ua=function(){pt(this.g,"a")},_o.prototype.ta=function(u){pt(this.g,new pg(u))},_o.prototype.sa=function(u){pt(this.g,new gg)},_o.prototype.ra=function(){pt(this.g,"b")},jl.prototype.createWebChannel=jl.prototype.g,Zn.prototype.send=Zn.prototype.o,Zn.prototype.open=Zn.prototype.m,Zn.prototype.close=Zn.prototype.close,Tv=function(){return new jl},Iv=function(){return Tr()},bv=Ce,sf={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ss.NO_ERROR=0,ss.TIMEOUT=8,ss.HTTP_ERROR=6,nu=ss,on.COMPLETE="complete",vv=on,Qt.EventType=Mr,Mr.OPEN="a",Mr.CLOSE="b",Mr.ERROR="c",Mr.MESSAGE="d",lt.prototype.listen=lt.prototype.K,Ha=Qt,Et.prototype.listenOnce=Et.prototype.L,Et.prototype.getLastError=Et.prototype.Ka,Et.prototype.getLastErrorCode=Et.prototype.Ba,Et.prototype.getStatus=Et.prototype.Z,Et.prototype.getResponseJson=Et.prototype.Oa,Et.prototype.getResponseText=Et.prototype.oa,Et.prototype.send=Et.prototype.ea,Et.prototype.setWithCredentials=Et.prototype.Ha,_v=Et}).apply(typeof Ol<"u"?Ol:typeof self<"u"?self:typeof window<"u"?window:{});const ry="@firebase/firestore",sy="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}kn.UNAUTHENTICATED=new kn(null),kn.GOOGLE_CREDENTIALS=new kn("google-credentials-uid"),kn.FIRST_PARTY=new kn("first-party-uid"),kn.MOCK_USER=new kn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ga="11.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hi=new Wc("@firebase/firestore");function So(){return Hi.logLevel}function X(n,...e){if(Hi.logLevel<=Fe.DEBUG){const t=e.map(pm);Hi.debug(`Firestore (${ga}): ${n}`,...t)}}function An(n,...e){if(Hi.logLevel<=Fe.ERROR){const t=e.map(pm);Hi.error(`Firestore (${ga}): ${n}`,...t)}}function ci(n,...e){if(Hi.logLevel<=Fe.WARN){const t=e.map(pm);Hi.warn(`Firestore (${ga}): ${n}`,...t)}}function pm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function he(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Ev(n,r,t)}function Ev(n,e,t){let r=`FIRESTORE (${ga}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw An(r),new Error(r)}function ge(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||Ev(e,s,r)}function ke(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ne extends Kn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class oS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(kn.UNAUTHENTICATED)))}shutdown(){}}class aS{constructor(e){this.t=e,this.currentUser=kn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ge(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Rr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Rr,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await s(this.currentUser)}))},c=l=>{X("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((l=>c(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?c(l):(X("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Rr)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(X("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ge(typeof r.accessToken=="string",31837,{l:r}),new iS(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ge(e===null||typeof e=="string",2055,{h:e}),new kn(e)}}class cS{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=kn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class lS{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new cS(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(kn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class iy{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class uS{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,At(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ge(this.o===void 0,3512);const r=i=>{i.error!=null&&X("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,X("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{X("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):X("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new iy(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ge(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new iy(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dS(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nv(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=dS(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function Ee(n,e){return n<e?-1:n>e?1:0}function of(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=n.codePointAt(t),s=e.codePointAt(t);if(r!==s){if(r<128&&s<128)return Ee(r,s);{const i=Nv(),a=hS(i.encode(oy(n,t)),i.encode(oy(e,t)));return a!==0?a:Ee(r,s)}}t+=r>65535?2:1}return Ee(n.length,e.length)}function oy(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function hS(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return Ee(n[t],e[t]);return Ee(n.length,e.length)}function Ko(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}function kv(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ay="__name__";class Br{constructor(e,t,r){t===void 0?t=0:t>e.length&&he(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&he(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Br.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Br?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Br.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Ee(e.length,t.length)}static compareSegments(e,t){const r=Br.isNumericId(e),s=Br.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Br.extractNumericId(e).compare(Br.extractNumericId(t)):of(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ni.fromString(e.substring(4,e.length-2))}}class Qe extends Br{construct(e,t,r){return new Qe(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new ne($.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new Qe(t)}static emptyPath(){return new Qe([])}}const fS=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class It extends Br{construct(e,t,r){return new It(e,t,r)}static isValidIdentifier(e){return fS.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),It.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ay}static keyField(){return new It([ay])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ne($.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new ne($.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new ne($.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(r+=c,s++):(i(),s++)}if(i(),a)throw new ne($.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new It(t)}static emptyPath(){return new It([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ce{constructor(e){this.path=e}static fromPath(e){return new ce(Qe.fromString(e))}static fromName(e){return new ce(Qe.fromString(e).popFirst(5))}static empty(){return new ce(Qe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Qe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Qe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ce(new Qe(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Av(n,e,t){if(!t)throw new ne($.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function mS(n,e,t,r){if(e===!0&&r===!0)throw new ne($.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function cy(n){if(!ce.isDocumentKey(n))throw new ne($.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ly(n){if(ce.isDocumentKey(n))throw new ne($.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Cv(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function yd(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":he(12329,{type:typeof n})}function Bn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ne($.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=yd(n);throw new ne($.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function pS(n,e){if(e<=0)throw new ne($.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mt(n,e){const t={typeString:n};return e&&(t.value=e),t}function Jc(n,e){if(!Cv(n))throw new ne($.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new ne($.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uy=-62135596800,dy=1e6;class nt{static now(){return nt.fromMillis(Date.now())}static fromDate(e){return nt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*dy);return new nt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ne($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ne($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<uy)throw new ne($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ne($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/dy}_compareTo(e){return this.seconds===e.seconds?Ee(this.nanoseconds,e.nanoseconds):Ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:nt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Jc(e,nt._jsonSchema))return new nt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-uy;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}nt._jsonSchemaVersion="firestore/timestamp/1.0",nt._jsonSchema={type:Mt("string",nt._jsonSchemaVersion),seconds:Mt("number"),nanoseconds:Mt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xe{static fromTimestamp(e){return new xe(e)}static min(){return new xe(new nt(0,0))}static max(){return new xe(new nt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tc=-1;class ku{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function af(n){return n.fields.find((e=>e.kind===2))}function Si(n){return n.fields.filter((e=>e.kind!==2))}ku.UNKNOWN_ID=-1;class ru{constructor(e,t){this.fieldPath=e,this.kind=t}}class Ec{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ec(0,cr.min())}}function gS(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=xe.fromTimestamp(r===1e9?new nt(t+1,0):new nt(t,r));return new cr(s,ce.empty(),e)}function Sv(n){return new cr(n.readTime,n.key,Tc)}class cr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new cr(xe.min(),ce.empty(),Tc)}static max(){return new cr(xe.max(),ce.empty(),Tc)}}function ym(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ce.comparator(n.documentKey,e.documentKey),t!==0?t:Ee(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class jv{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ao(n){if(n.code!==$.FAILED_PRECONDITION||n.message!==Rv)throw n;X("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&he(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new V(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof V?t:V.resolve(t)}catch(t){return V.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):V.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):V.reject(t)}static resolve(e){return new V(((t,r)=>{t(e)}))}static reject(e){return new V(((t,r)=>{r(e)}))}static waitFor(e){return new V(((t,r)=>{let s=0,i=0,a=!1;e.forEach((c=>{++s,c.next((()=>{++i,a&&i===s&&t()}),(l=>r(l)))})),a=!0,i===s&&t()}))}static or(e){let t=V.resolve(!1);for(const r of e)t=t.next((s=>s?V.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new V(((r,s)=>{const i=e.length,a=new Array(i);let c=0;for(let l=0;l<i;l++){const d=l;t(e[d]).next((h=>{a[d]=h,++c,c===i&&r(a)}),(h=>s(h)))}}))}static doWhile(e,t){return new V(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tr="SimpleDb";class xd{static open(e,t,r,s){try{return new xd(t,e.transaction(s,r))}catch(i){throw new nc(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Rr,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new nc(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=xm(r.target.error);this.S.reject(new nc(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(X(tr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new xS(t)}}class ri{static delete(e){return X(tr,"Removing database:",e),ji(tm().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!ha())return!1;if(ri.F())return!0;const e=$t(),t=ri.M(e),r=0<t&&t<10,s=Pv(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.B=r,this.L=null,ri.M($t())===12.2&&An("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(X(tr,"Opening database:",this.name),this.db=await new Promise(((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;t(a)},s.onblocked=()=>{r(new nc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?r(new ne($.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new ne($.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new nc(e,a))},s.onupgradeneeded=i=>{X(tr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;if(this.L!==null&&this.L!==i.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${i.oldVersion}, event.newVersion=${i.newVersion}, db.version=${a.version}`);this.B.q(a,s.transaction,i.oldVersion,this.version).next((()=>{X(tr,"Database upgrade to version "+this.version+" complete")}))}})),this.db.addEventListener("close",(t=>{const r=t.target;this.L=r.version}),{passive:!0})),this.db.addEventListener("versionchange",(t=>{var r;t.newVersion===null&&(ci('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(r=this.databaseDeletedListener)===null||r===void 0||r.call(this))}),{passive:!0}),this.db}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}async runTransaction(e,t,r,s){const i=t==="readonly";let a=0;for(;;){++a;try{this.db=await this.k(e);const c=xd.open(this.db,e,i?"readonly":"readwrite",r),l=s(c).next((d=>(c.v(),d))).catch((d=>(c.abort(d),V.reject(d)))).toPromise();return l.catch((()=>{})),await c.D,l}catch(c){const l=c,d=l.name!=="FirebaseError"&&a<3;if(X(tr,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Pv(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class yS{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return ji(this.$.delete())}}class nc extends ne{constructor(e,t){super($.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function gi(n){return n.name==="IndexedDbTransactionError"}class xS{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(X(tr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(X(tr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ji(r)}add(e){return X(tr,"ADD",this.store.name,e,e),ji(this.store.add(e))}get(e){return ji(this.store.get(e)).next((t=>(t===void 0&&(t=null),X(tr,"GET",this.store.name,e,t),t)))}delete(e){return X(tr,"DELETE",this.store.name,e),ji(this.store.delete(e))}count(){return X(tr,"COUNT",this.store.name),ji(this.store.count())}j(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new V(((a,c)=>{i.onerror=l=>{c(l.target.error)},i.onsuccess=l=>{a(l.target.result)}}))}{const i=this.cursor(r),a=[];return this.J(i,((c,l)=>{a.push(l)})).next((()=>a))}}H(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new V(((s,i)=>{r.onerror=a=>{i(a.target.error)},r.onsuccess=a=>{s(a.target.result)}}))}Y(e,t){X(tr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.Z=!1;const s=this.cursor(r);return this.J(s,((i,a,c)=>c.delete()))}X(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.J(s,t)}ee(e){const t=this.cursor({});return new V(((r,s)=>{t.onerror=i=>{const a=xm(i.target.error);s(a)},t.onsuccess=i=>{const a=i.target.result;a?e(a.primaryKey,a.value).next((c=>{c?a.continue():r()})):r()}}))}J(e,t){const r=[];return new V(((s,i)=>{e.onerror=a=>{i(a.target.error)},e.onsuccess=a=>{const c=a.target.result;if(!c)return void s();const l=new yS(c),d=t(c.primaryKey,c.value,l);if(d instanceof V){const h=d.catch((m=>(l.done(),V.reject(m))));r.push(h)}l.isDone?s():l.W===null?c.continue():c.continue(l.W)}})).next((()=>V.waitFor(r)))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Z?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ji(n){return new V(((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=xm(r.target.error);t(s)}}))}let hy=!1;function xm(n){const e=ri.M($t());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new ne("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return hy||(hy=!0,setTimeout((()=>{throw r}),0)),r}}return n}const rc="IndexBackfiller";class wS{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(e){X(rc,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.te.re();X(rc,`Documents written: ${t}`)}catch(t){gi(t)?X(rc,"Ignoring IndexedDB error during index backfill: ",t):await ao(t)}await this.ne(6e4)}))}}class _S{constructor(e,t){this.localStore=e,this.persistence=t}async re(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.ie(t,e)))}ie(e,t){const r=new Set;let s=t,i=!0;return V.doWhile((()=>i===!0&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((a=>{if(a!==null&&!r.has(a))return X(rc,`Processing collection: ${a}`),this.se(e,a,s).next((c=>{s-=c,r.add(a)}));i=!1})))).next((()=>t-s))}se(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next((i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next((()=>this.oe(s,i))).next((c=>(X(rc,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c)))).next((()=>a.size))}))))}oe(e,t){let r=e;return t.changes.forEach(((s,i)=>{const a=Sv(i);ym(a,r)>0&&(r=a)})),new cr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this._e(r),this.ae=r=>t.writeSequenceNumber(r))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}mr.ue=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fi=-1;function Zc(n){return n==null}function Nc(n){return n===0&&1/n==-1/0}function vS(n){return typeof n=="number"&&Number.isInteger(n)&&!Nc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Au="";function wn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=fy(e)),e=bS(n.get(t),e);return fy(e)}function bS(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Au:t+="";break;default:t+=i}}return t}function fy(n){return n+Au+""}function qr(n){const e=n.length;if(ge(e>=2,64408,{path:n}),e===2)return ge(n.charAt(0)===Au&&n.charAt(1)==="",56145,{path:n}),Qe.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const a=n.indexOf(Au,i);switch((a<0||a>t)&&he(50515,{path:n}),n.charAt(a+1)){case"":const c=n.substring(i,a);let l;s.length===0?l=c:(s+=c,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,a),s+="\0";break;case"":s+=n.substring(i,a+1);break;default:he(61167,{path:n})}i=a+2}return new Qe(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ri="remoteDocuments",el="owner",bo="owner",kc="mutationQueues",IS="userId",Ar="mutations",my="batchId",Vi="userMutationsIndex",py=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function su(n,e){return[n,wn(e)]}function Dv(n,e,t){return[n,wn(e),t]}const TS={},Qo="documentMutations",Cu="remoteDocumentsV14",ES=["prefixPath","collectionGroup","readTime","documentId"],iu="documentKeyIndex",NS=["prefixPath","collectionGroup","documentId"],Ov="collectionGroupIndex",kS=["collectionGroup","readTime","prefixPath","documentId"],Ac="remoteDocumentGlobal",cf="remoteDocumentGlobalKey",Yo="targets",Lv="queryTargetsIndex",AS=["canonicalId","targetId"],Xo="targetDocuments",CS=["targetId","path"],wm="documentTargetsIndex",SS=["path","targetId"],Su="targetGlobalKey",Bi="targetGlobal",Cc="collectionParents",RS=["collectionId","parent"],Jo="clientMetadata",jS="clientId",wd="bundles",PS="bundleId",_d="namedQueries",DS="name",_m="indexConfiguration",OS="indexId",lf="collectionGroupIndex",LS="collectionGroup",sc="indexState",VS=["indexId","uid"],Vv="sequenceNumberIndex",MS=["uid","sequenceNumber"],ic="indexEntries",US=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Mv="documentKeyIndex",FS=["indexId","uid","orderedDocumentKey"],vd="documentOverlays",BS=["userId","collectionPath","documentId"],uf="collectionPathOverlayIndex",zS=["userId","collectionPath","largestBatchId"],Uv="collectionGroupOverlayIndex",$S=["userId","collectionGroup","largestBatchId"],vm="globals",qS="name",Fv=[kc,Ar,Qo,Ri,Yo,el,Bi,Xo,Jo,Ac,Cc,wd,_d],HS=[...Fv,vd],Bv=[kc,Ar,Qo,Cu,Yo,el,Bi,Xo,Jo,Ac,Cc,wd,_d,vd],zv=Bv,bm=[...zv,_m,sc,ic],WS=bm,$v=[...bm,vm],GS=$v;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df extends jv{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}}function Wt(n,e){const t=ke(n);return ri.N(t.ce,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gy(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function yi(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function qv(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e,t){this.comparator=e,this.root=t||nn.EMPTY}insert(e,t){return new bt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nn.BLACK,null,null))}remove(e){return new bt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ll(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ll(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ll(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ll(this.root,e,this.comparator,!0)}}class Ll{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??nn.RED,this.left=s??nn.EMPTY,this.right=i??nn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new nn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return nn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return nn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,nn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,nn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw he(43730,{key:this.key,value:this.value});if(this.right.isRed())throw he(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw he(27949);return e+(this.isRed()?0:1)}}nn.EMPTY=null,nn.RED=!0,nn.BLACK=!1;nn.EMPTY=new class{constructor(){this.size=0}get key(){throw he(57766)}get value(){throw he(16141)}get color(){throw he(16727)}get left(){throw he(29726)}get right(){throw he(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new nn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{constructor(e){this.comparator=e,this.data=new bt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new yy(this.data.getIterator())}getIteratorFrom(e){return new yy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof st)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new st(this.comparator);return t.data=e,t}}class yy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Io(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e){this.fields=e,e.sort(It.comparator)}static empty(){return new Vn([])}unionWith(e){let t=new st(It.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Vn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ko(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Hv("Invalid base64 string: "+i):i}})(e);return new Ut(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new Ut(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ut.EMPTY_BYTE_STRING=new Ut("");const KS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bs(n){if(ge(!!n,39018),typeof n=="string"){let e=0;const t=KS.exec(n);if(ge(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:_t(n.seconds),nanos:_t(n.nanos)}}function _t(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Is(n){return typeof n=="string"?Ut.fromBase64String(n):Ut.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wv="server_timestamp",Gv="__type__",Kv="__previous_value__",Qv="__local_write_time__";function Im(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Gv])===null||t===void 0?void 0:t.stringValue)===Wv}function bd(n){const e=n.mapValue.fields[Kv];return Im(e)?bd(e):e}function Sc(n){const e=bs(n.mapValue.fields[Qv].timestampValue);return new nt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QS{constructor(e,t,r,s,i,a,c,l,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=h}}const Ru="(default)";class Wi{constructor(e,t){this.projectId=e,this.database=t||Ru}static empty(){return new Wi("","")}get isDefaultDatabase(){return this.database===Ru}isEqual(e){return e instanceof Wi&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tm="__type__",Yv="__max__",Ys={mapValue:{fields:{__type__:{stringValue:Yv}}}},Em="__vector__",Zo="value",ou={nullValue:"NULL_VALUE"};function li(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Im(n)?4:Xv(n)?9007199254740991:Id(n)?10:11:he(28295,{value:n})}function Xr(n,e){if(n===e)return!0;const t=li(n);if(t!==li(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Sc(n).isEqual(Sc(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=bs(s.timestampValue),c=bs(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return Is(s.bytesValue).isEqual(Is(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return _t(s.geoPointValue.latitude)===_t(i.geoPointValue.latitude)&&_t(s.geoPointValue.longitude)===_t(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return _t(s.integerValue)===_t(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=_t(s.doubleValue),c=_t(i.doubleValue);return a===c?Nc(a)===Nc(c):isNaN(a)&&isNaN(c)}return!1})(n,e);case 9:return Ko(n.arrayValue.values||[],e.arrayValue.values||[],Xr);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(gy(a)!==gy(c))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!Xr(a[l],c[l])))return!1;return!0})(n,e);default:return he(52216,{left:n})}}function Rc(n,e){return(n.values||[]).find((t=>Xr(t,e)))!==void 0}function ui(n,e){if(n===e)return 0;const t=li(n),r=li(e);if(t!==r)return Ee(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ee(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const c=_t(i.integerValue||i.doubleValue),l=_t(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1})(n,e);case 3:return xy(n.timestampValue,e.timestampValue);case 4:return xy(Sc(n),Sc(e));case 5:return of(n.stringValue,e.stringValue);case 6:return(function(i,a){const c=Is(i),l=Is(a);return c.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const c=i.split("/"),l=a.split("/");for(let d=0;d<c.length&&d<l.length;d++){const h=Ee(c[d],l[d]);if(h!==0)return h}return Ee(c.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const c=Ee(_t(i.latitude),_t(a.latitude));return c!==0?c:Ee(_t(i.longitude),_t(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return wy(n.arrayValue,e.arrayValue);case 10:return(function(i,a){var c,l,d,h;const m=i.fields||{},f=a.fields||{},w=(c=m[Zo])===null||c===void 0?void 0:c.arrayValue,k=(l=f[Zo])===null||l===void 0?void 0:l.arrayValue,C=Ee(((d=w?.values)===null||d===void 0?void 0:d.length)||0,((h=k?.values)===null||h===void 0?void 0:h.length)||0);return C!==0?C:wy(w,k)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===Ys.mapValue&&a===Ys.mapValue)return 0;if(i===Ys.mapValue)return 1;if(a===Ys.mapValue)return-1;const c=i.fields||{},l=Object.keys(c),d=a.fields||{},h=Object.keys(d);l.sort(),h.sort();for(let m=0;m<l.length&&m<h.length;++m){const f=of(l[m],h[m]);if(f!==0)return f;const w=ui(c[l[m]],d[h[m]]);if(w!==0)return w}return Ee(l.length,h.length)})(n.mapValue,e.mapValue);default:throw he(23264,{le:t})}}function xy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ee(n,e);const t=bs(n),r=bs(e),s=Ee(t.seconds,r.seconds);return s!==0?s:Ee(t.nanos,r.nanos)}function wy(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=ui(t[s],r[s]);if(i)return i}return Ee(t.length,r.length)}function ea(n){return hf(n)}function hf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=bs(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Is(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return ce.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=hf(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${hf(t.fields[a])}`;return s+"}"})(n.mapValue):he(61005,{value:n})}function au(n){switch(li(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=bd(n);return e?16+au(e):16;case 5:return 2*n.stringValue.length;case 6:return Is(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+au(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return yi(r.fields,((i,a)=>{s+=i.length+au(a)})),s})(n.mapValue);default:throw he(13486,{value:n})}}function jc(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ff(n){return!!n&&"integerValue"in n}function Pc(n){return!!n&&"arrayValue"in n}function _y(n){return!!n&&"nullValue"in n}function vy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function cu(n){return!!n&&"mapValue"in n}function Id(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Tm])===null||t===void 0?void 0:t.stringValue)===Em}function oc(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return yi(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=oc(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=oc(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Xv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Yv}const Jv={mapValue:{fields:{[Tm]:{stringValue:Em},[Zo]:{arrayValue:{}}}}};function YS(n){return"nullValue"in n?ou:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?jc(Wi.empty(),ce.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Id(n)?Jv:{mapValue:{}}:he(35942,{value:n})}function XS(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?jc(Wi.empty(),ce.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Jv:"mapValue"in n?Id(n)?{mapValue:{}}:Ys:he(61959,{value:n})}function by(n,e){const t=ui(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Iy(n,e){const t=ui(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e){this.value=e}static empty(){return new rn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!cu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=oc(t)}setAll(e){let t=It.emptyPath(),r={},s=[];e.forEach(((a,c)=>{if(!t.isImmediateParentOf(c)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=c.popLast()}a?r[c.lastSegment()]=oc(a):s.push(c.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());cu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];cu(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){yi(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new rn(oc(this.value))}}function Zv(n){const e=[];return yi(n.fields,((t,r)=>{const s=new It([t]);if(cu(r)){const i=Zv(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)})),new Vn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e,t,r,s,i,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(e){return new vt(e,0,xe.min(),xe.min(),xe.min(),rn.empty(),0)}static newFoundDocument(e,t,r,s){return new vt(e,1,t,xe.min(),r,s,0)}static newNoDocument(e,t){return new vt(e,2,t,xe.min(),xe.min(),rn.empty(),0)}static newUnknownDocument(e,t){return new vt(e,3,t,xe.min(),xe.min(),rn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(xe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=xe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof vt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new vt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(e,t){this.position=e,this.inclusive=t}}function Ty(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=ce.comparator(ce.fromName(a.referenceValue),t.key):r=ui(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ey(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Xr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc{constructor(e,t="asc"){this.field=e,this.dir=t}}function JS(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb{}class Be extends eb{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new ZS(e,t,r):t==="array-contains"?new nR(e,r):t==="in"?new ob(e,r):t==="not-in"?new rR(e,r):t==="array-contains-any"?new sR(e,r):new Be(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new eR(e,r):new tR(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(ui(t,this.value)):t!==null&&li(this.value)===li(t)&&this.matchesComparison(ui(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return he(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rt extends eb{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new rt(e,t)}matches(e){return na(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function na(n){return n.op==="and"}function mf(n){return n.op==="or"}function Nm(n){return tb(n)&&na(n)}function tb(n){for(const e of n.filters)if(e instanceof rt)return!1;return!0}function pf(n){if(n instanceof Be)return n.field.canonicalString()+n.op.toString()+ea(n.value);if(Nm(n))return n.filters.map((e=>pf(e))).join(",");{const e=n.filters.map((t=>pf(t))).join(",");return`${n.op}(${e})`}}function nb(n,e){return n instanceof Be?(function(r,s){return s instanceof Be&&r.op===s.op&&r.field.isEqual(s.field)&&Xr(r.value,s.value)})(n,e):n instanceof rt?(function(r,s){return s instanceof rt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,c)=>i&&nb(a,s.filters[c])),!0):!1})(n,e):void he(19439)}function rb(n,e){const t=n.filters.concat(e);return rt.create(t,n.op)}function sb(n){return n instanceof Be?(function(t){return`${t.field.canonicalString()} ${t.op} ${ea(t.value)}`})(n):n instanceof rt?(function(t){return t.op.toString()+" {"+t.getFilters().map(sb).join(" ,")+"}"})(n):"Filter"}class ZS extends Be{constructor(e,t,r){super(e,t,r),this.key=ce.fromName(r.referenceValue)}matches(e){const t=ce.comparator(e.key,this.key);return this.matchesComparison(t)}}class eR extends Be{constructor(e,t){super(e,"in",t),this.keys=ib("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class tR extends Be{constructor(e,t){super(e,"not-in",t),this.keys=ib("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function ib(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map((r=>ce.fromName(r.referenceValue)))}class nR extends Be{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Pc(t)&&Rc(t.arrayValue,this.value)}}class ob extends Be{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Rc(this.value.arrayValue,t)}}class rR extends Be{constructor(e,t){super(e,"not-in",t)}matches(e){if(Rc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Rc(this.value.arrayValue,t)}}class sR extends Be{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Pc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Rc(this.value.arrayValue,r)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR{constructor(e,t=null,r=[],s=[],i=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.Pe=null}}function gf(n,e=null,t=[],r=[],s=null,i=null,a=null){return new iR(n,e,t,r,s,i,a)}function Gi(n){const e=ke(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>pf(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),Zc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>ea(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>ea(r))).join(",")),e.Pe=t}return e.Pe}function tl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!JS(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!nb(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ey(n.startAt,e.startAt)&&Ey(n.endAt,e.endAt)}function ju(n){return ce.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Pu(n,e){return n.filters.filter((t=>t instanceof Be&&t.field.isEqual(e)))}function Ny(n,e,t){let r=ou,s=!0;for(const i of Pu(n,e)){let a=ou,c=!0;switch(i.op){case"<":case"<=":a=YS(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,c=!1;break;case"!=":case"not-in":a=ou}by({value:r,inclusive:s},{value:a,inclusive:c})<0&&(r=a,s=c)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const a=t.position[i];by({value:r,inclusive:s},{value:a,inclusive:t.inclusive})<0&&(r=a,s=t.inclusive);break}}return{value:r,inclusive:s}}function ky(n,e,t){let r=Ys,s=!0;for(const i of Pu(n,e)){let a=Ys,c=!0;switch(i.op){case">=":case">":a=XS(i.value),c=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,c=!1;break;case"!=":case"not-in":a=Ys}Iy({value:r,inclusive:s},{value:a,inclusive:c})>0&&(r=a,s=c)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const a=t.position[i];Iy({value:r,inclusive:s},{value:a,inclusive:t.inclusive})>0&&(r=a,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(e,t=null,r=[],s=[],i=null,a="F",c=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=l,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function oR(n,e,t,r,s,i,a,c){return new ya(n,e,t,r,s,i,a,c)}function nl(n){return new ya(n)}function Ay(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function ab(n){return n.collectionGroup!==null}function ac(n){const e=ke(n);if(e.Te===null){e.Te=[];const t=new Set;for(const i of e.explicitOrderBy)e.Te.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new st(It.comparator);return a.filters.forEach((l=>{l.getFlattenedFilters().forEach((d=>{d.isInequality()&&(c=c.add(d.field))}))})),c})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Te.push(new Dc(i,r))})),t.has(It.keyField().canonicalString())||e.Te.push(new Dc(It.keyField(),r))}return e.Te}function xr(n){const e=ke(n);return e.Ie||(e.Ie=aR(e,ac(n))),e.Ie}function aR(n,e){if(n.limitType==="F")return gf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Dc(s.field,i)}));const t=n.endAt?new ta(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ta(n.startAt.position,n.startAt.inclusive):null;return gf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function yf(n,e){const t=n.filters.concat([e]);return new ya(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Du(n,e,t){return new ya(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Td(n,e){return tl(xr(n),xr(e))&&n.limitType===e.limitType}function cb(n){return`${Gi(xr(n))}|lt:${n.limitType}`}function Ro(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>sb(s))).join(", ")}]`),Zc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>ea(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>ea(s))).join(",")),`Target(${r})`})(xr(n))}; limitType=${n.limitType})`}function rl(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ce.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of ac(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,c,l){const d=Ty(a,c,l);return a.inclusive?d<=0:d<0})(r.startAt,ac(r),s)||r.endAt&&!(function(a,c,l){const d=Ty(a,c,l);return a.inclusive?d>=0:d>0})(r.endAt,ac(r),s))})(n,e)}function cR(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function lb(n){return(e,t)=>{let r=!1;for(const s of ac(n)){const i=lR(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function lR(n,e,t){const r=n.field.isKeyField()?ce.comparator(e.key,t.key):(function(i,a,c){const l=a.data.field(i),d=c.data.field(i);return l!==null&&d!==null?ui(l,d):he(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return he(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){yi(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return qv(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uR=new bt(ce.comparator);function sr(){return uR}const ub=new bt(ce.comparator);function Wa(...n){let e=ub;for(const t of n)e=e.insert(t.key,t);return e}function db(n){let e=ub;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Hr(){return cc()}function hb(){return cc()}function cc(){return new As((n=>n.toString()),((n,e)=>n.isEqual(e)))}const dR=new bt(ce.comparator),hR=new st(ce.comparator);function Me(...n){let e=hR;for(const t of n)e=e.add(t);return e}const fR=new st(Ee);function mR(){return fR}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function km(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Nc(e)?"-0":e}}function fb(n){return{integerValue:""+n}}function mb(n,e){return vS(e)?fb(e):km(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{constructor(){this._=void 0}}function pR(n,e,t){return n instanceof ra?(function(s,i){const a={fields:{[Gv]:{stringValue:Wv},[Qv]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Im(i)&&(i=bd(i)),i&&(a.fields[Kv]=i),{mapValue:a}})(t,e):n instanceof Ki?gb(n,e):n instanceof sa?yb(n,e):(function(s,i){const a=pb(s,i),c=Cy(a)+Cy(s.Ee);return ff(a)&&ff(s.Ee)?fb(c):km(s.serializer,c)})(n,e)}function gR(n,e,t){return n instanceof Ki?gb(n,e):n instanceof sa?yb(n,e):t}function pb(n,e){return n instanceof ia?(function(r){return ff(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class ra extends Ed{}class Ki extends Ed{constructor(e){super(),this.elements=e}}function gb(n,e){const t=xb(e);for(const r of n.elements)t.some((s=>Xr(s,r)))||t.push(r);return{arrayValue:{values:t}}}class sa extends Ed{constructor(e){super(),this.elements=e}}function yb(n,e){let t=xb(e);for(const r of n.elements)t=t.filter((s=>!Xr(s,r)));return{arrayValue:{values:t}}}class ia extends Ed{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function Cy(n){return _t(n.integerValue||n.doubleValue)}function xb(n){return Pc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{constructor(e,t){this.field=e,this.transform=t}}function yR(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Ki&&s instanceof Ki||r instanceof sa&&s instanceof sa?Ko(r.elements,s.elements,Xr):r instanceof ia&&s instanceof ia?Xr(r.Ee,s.Ee):r instanceof ra&&s instanceof ra})(n.transform,e.transform)}class xR{constructor(e,t){this.version=e,this.transformResults=t}}class Ct{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ct}static exists(e){return new Ct(void 0,e)}static updateTime(e){return new Ct(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function lu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class kd{}function wb(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new sl(n.key,Ct.none()):new xa(n.key,n.data,Ct.none());{const t=n.data,r=rn.empty();let s=new st(It.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Cs(n.key,r,new Vn(s.toArray()),Ct.none())}}function wR(n,e,t){n instanceof xa?(function(s,i,a){const c=s.value.clone(),l=Ry(s.fieldTransforms,i,a.transformResults);c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(n,e,t):n instanceof Cs?(function(s,i,a){if(!lu(s.precondition,i))return void i.convertToUnknownDocument(a.version);const c=Ry(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(_b(s)),l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function lc(n,e,t,r){return n instanceof xa?(function(i,a,c,l){if(!lu(i.precondition,a))return c;const d=i.value.clone(),h=jy(i.fieldTransforms,l,a);return d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof Cs?(function(i,a,c,l){if(!lu(i.precondition,a))return c;const d=jy(i.fieldTransforms,l,a),h=a.data;return h.setAll(_b(i)),h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((m=>m.field)))})(n,e,t,r):(function(i,a,c){return lu(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(n,e,t)}function _R(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=pb(r.transform,s||null);i!=null&&(t===null&&(t=rn.empty()),t.set(r.field,i))}return t||null}function Sy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ko(r,s,((i,a)=>yR(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class xa extends kd{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Cs extends kd{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function _b(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Ry(n,e,t){const r=new Map;ge(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,c=e.data.field(i.field);r.set(i.field,gR(a,c,t[s]))}return r}function jy(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,pR(i,a,e))}return r}class sl extends kd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Am extends kd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cm{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&wR(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=lc(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=lc(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=hb();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=t.has(s.key)?null:c;const l=wb(a,c);l!==null&&r.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(xe.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Me())}isEqual(e){return this.batchId===e.batchId&&Ko(this.mutations,e.mutations,((t,r)=>Sy(t,r)))&&Ko(this.baseMutations,e.baseMutations,((t,r)=>Sy(t,r)))}}class Sm{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ge(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let s=(function(){return dR})();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Sm(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ot,We;function vb(n){switch(n){case $.OK:return he(64938);case $.CANCELLED:case $.UNKNOWN:case $.DEADLINE_EXCEEDED:case $.RESOURCE_EXHAUSTED:case $.INTERNAL:case $.UNAVAILABLE:case $.UNAUTHENTICATED:return!1;case $.INVALID_ARGUMENT:case $.NOT_FOUND:case $.ALREADY_EXISTS:case $.PERMISSION_DENIED:case $.FAILED_PRECONDITION:case $.ABORTED:case $.OUT_OF_RANGE:case $.UNIMPLEMENTED:case $.DATA_LOSS:return!0;default:return he(15467,{code:n})}}function bb(n){if(n===void 0)return An("GRPC error has no .code"),$.UNKNOWN;switch(n){case Ot.OK:return $.OK;case Ot.CANCELLED:return $.CANCELLED;case Ot.UNKNOWN:return $.UNKNOWN;case Ot.DEADLINE_EXCEEDED:return $.DEADLINE_EXCEEDED;case Ot.RESOURCE_EXHAUSTED:return $.RESOURCE_EXHAUSTED;case Ot.INTERNAL:return $.INTERNAL;case Ot.UNAVAILABLE:return $.UNAVAILABLE;case Ot.UNAUTHENTICATED:return $.UNAUTHENTICATED;case Ot.INVALID_ARGUMENT:return $.INVALID_ARGUMENT;case Ot.NOT_FOUND:return $.NOT_FOUND;case Ot.ALREADY_EXISTS:return $.ALREADY_EXISTS;case Ot.PERMISSION_DENIED:return $.PERMISSION_DENIED;case Ot.FAILED_PRECONDITION:return $.FAILED_PRECONDITION;case Ot.ABORTED:return $.ABORTED;case Ot.OUT_OF_RANGE:return $.OUT_OF_RANGE;case Ot.UNIMPLEMENTED:return $.UNIMPLEMENTED;case Ot.DATA_LOSS:return $.DATA_LOSS;default:return he(39323,{code:n})}}(We=Ot||(Ot={}))[We.OK=0]="OK",We[We.CANCELLED=1]="CANCELLED",We[We.UNKNOWN=2]="UNKNOWN",We[We.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",We[We.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",We[We.NOT_FOUND=5]="NOT_FOUND",We[We.ALREADY_EXISTS=6]="ALREADY_EXISTS",We[We.PERMISSION_DENIED=7]="PERMISSION_DENIED",We[We.UNAUTHENTICATED=16]="UNAUTHENTICATED",We[We.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",We[We.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",We[We.ABORTED=10]="ABORTED",We[We.OUT_OF_RANGE=11]="OUT_OF_RANGE",We[We.UNIMPLEMENTED=12]="UNIMPLEMENTED",We[We.INTERNAL=13]="INTERNAL",We[We.UNAVAILABLE=14]="UNAVAILABLE",We[We.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bR=new ni([4294967295,4294967295],0);function Py(n){const e=Nv().encode(n),t=new wv;return t.update(e),new Uint8Array(t.digest())}function Dy(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ni([t,r],0),new ni([s,i],0)]}class jm{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ga(`Invalid padding: ${t}`);if(r<0)throw new Ga(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ga(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ga(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=ni.fromNumber(this.fe)}pe(e,t,r){let s=e.add(t.multiply(ni.fromNumber(r)));return s.compare(bR)===1&&(s=new ni([s.getBits(0),s.getBits(1)],0)),s.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;const t=Py(e),[r,s]=Dy(t);for(let i=0;i<this.hashCount;i++){const a=this.pe(r,s,i);if(!this.ye(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new jm(i,s,t);return r.forEach((c=>a.insert(c))),a}insert(e){if(this.fe===0)return;const t=Py(e),[r,s]=Dy(t);for(let i=0;i<this.hashCount;i++){const a=this.pe(r,s,i);this.we(a)}}we(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ga extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ad{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,il.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Ad(xe.min(),s,new bt(Ee),sr(),Me())}}class il{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new il(r,t,Me(),Me(),Me())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=s}}class Ib{constructor(e,t){this.targetId=e,this.De=t}}class Tb{constructor(e,t,r=Ut.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Oy{constructor(){this.ve=0,this.Ce=Ly(),this.Fe=Ut.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Me(),t=Me(),r=Me();return this.Ce.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:he(38017,{changeType:i})}})),new il(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=Ly()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,ge(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class IR{constructor(e){this.We=e,this.Ge=new Map,this.ze=sr(),this.je=Vl(),this.Je=Vl(),this.He=new bt(Ee)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,(t=>{const r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:he(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach(((r,s)=>{this.nt(s)&&t(s)}))}it(e){const t=e.targetId,r=e.De.count,s=this.st(t);if(s){const i=s.target;if(ju(i))if(r===0){const a=new ce(i.path);this.Xe(t,a,vt.newNoDocument(a,xe.min()))}else ge(r===1,20013,{expectedCount:r});else{const a=this.ot(t);if(a!==r){const c=this._t(e),l=c?this.ut(c,e,a):1;if(l!==0){this.rt(t);const d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,d)}}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,c;try{a=Is(r).toUint8Array()}catch(l){if(l instanceof Hv)return ci("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new jm(a,s,i)}catch(l){return ci(l instanceof Ga?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.fe===0?null:c}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){const r=this.We.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.We.lt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Xe(t,i,null),s++)})),s}Pt(e){const t=new Map;this.Ge.forEach(((i,a)=>{const c=this.st(a);if(c){if(i.current&&ju(c.target)){const l=new ce(c.target.path);this.Tt(l).has(a)||this.It(a,l)||this.Xe(a,l,vt.newNoDocument(l,e))}i.Ne&&(t.set(a,i.Le()),i.ke())}}));let r=Me();this.Je.forEach(((i,a)=>{let c=!0;a.forEachWhile((l=>{const d=this.st(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(r=r.add(i))})),this.ze.forEach(((i,a)=>a.setReadTime(e)));const s=new Ad(e,t,this.He,this.ze,r);return this.ze=sr(),this.je=Vl(),this.Je=Vl(),this.He=new bt(Ee),s}Ze(e,t){if(!this.nt(e))return;const r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;const s=this.tt(e);this.It(e,t)?s.qe(t,1):s.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Oy,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new st(Ee),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new st(Ee),this.je=this.je.insert(e,t)),t}nt(e){const t=this.st(e)!==null;return t||X("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Oy),this.We.getRemoteKeysForTarget(e).forEach((t=>{this.Xe(e,t,null)}))}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function Vl(){return new bt(ce.comparator)}function Ly(){return new bt(ce.comparator)}const TR={asc:"ASCENDING",desc:"DESCENDING"},ER={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},NR={and:"AND",or:"OR"};class kR{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function xf(n,e){return n.useProto3Json||Zc(e)?e:{value:e}}function oa(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Eb(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function AR(n,e){return oa(n,e.toTimestamp())}function Xt(n){return ge(!!n,49232),xe.fromTimestamp((function(t){const r=bs(t);return new nt(r.seconds,r.nanos)})(n))}function Pm(n,e){return wf(n,e).canonicalString()}function wf(n,e){const t=(function(s){return new Qe(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Nb(n){const e=Qe.fromString(n);return ge(Ob(e),10190,{key:e.toString()}),e}function Oc(n,e){return Pm(n.databaseId,e.path)}function ys(n,e){const t=Nb(e);if(t.get(1)!==n.databaseId.projectId)throw new ne($.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ne($.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ce(Cb(t))}function kb(n,e){return Pm(n.databaseId,e)}function Ab(n){const e=Nb(n);return e.length===4?Qe.emptyPath():Cb(e)}function _f(n){return new Qe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Cb(n){return ge(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Vy(n,e,t){return{name:Oc(n,e),fields:t.value.mapValue.fields}}function CR(n,e,t){const r=ys(n,e.name),s=Xt(e.updateTime),i=e.createTime?Xt(e.createTime):xe.min(),a=new rn({mapValue:{fields:e.fields}}),c=vt.newFoundDocument(r,s,i,a);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function SR(n,e){return"found"in e?(function(r,s){ge(!!s.found,43571),s.found.name,s.found.updateTime;const i=ys(r,s.found.name),a=Xt(s.found.updateTime),c=s.found.createTime?Xt(s.found.createTime):xe.min(),l=new rn({mapValue:{fields:s.found.fields}});return vt.newFoundDocument(i,a,c,l)})(n,e):"missing"in e?(function(r,s){ge(!!s.missing,3894),ge(!!s.readTime,22933);const i=ys(r,s.missing),a=Xt(s.readTime);return vt.newNoDocument(i,a)})(n,e):he(7234,{result:e})}function RR(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:he(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(d,h){return d.useProto3Json?(ge(h===void 0||typeof h=="string",58123),Ut.fromBase64String(h||"")):(ge(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Ut.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&(function(d){const h=d.code===void 0?$.UNKNOWN:bb(d.code);return new ne(h,d.message||"")})(a);t=new Tb(r,s,i,c||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ys(n,r.document.name),i=Xt(r.document.updateTime),a=r.document.createTime?Xt(r.document.createTime):xe.min(),c=new rn({mapValue:{fields:r.document.fields}}),l=vt.newFoundDocument(s,i,a,c),d=r.targetIds||[],h=r.removedTargetIds||[];t=new uu(d,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ys(n,r.document),i=r.readTime?Xt(r.readTime):xe.min(),a=vt.newNoDocument(s,i),c=r.removedTargetIds||[];t=new uu([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ys(n,r.document),i=r.removedTargetIds||[];t=new uu([],i,s,null)}else{if(!("filter"in e))return he(11601,{At:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new vR(s,i),c=r.targetId;t=new Ib(c,a)}}return t}function Lc(n,e){let t;if(e instanceof xa)t={update:Vy(n,e.key,e.value)};else if(e instanceof sl)t={delete:Oc(n,e.key)};else if(e instanceof Cs)t={update:Vy(n,e.key,e.data),updateMask:VR(e.fieldMask)};else{if(!(e instanceof Am))return he(16599,{Rt:e.type});t={verify:Oc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,a){const c=a.transform;if(c instanceof ra)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Ki)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof sa)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof ia)return{fieldPath:a.field.canonicalString(),increment:c.Ee};throw he(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:AR(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:he(27497)})(n,e.precondition)),t}function vf(n,e){const t=e.currentDocument?(function(i){return i.updateTime!==void 0?Ct.updateTime(Xt(i.updateTime)):i.exists!==void 0?Ct.exists(i.exists):Ct.none()})(e.currentDocument):Ct.none(),r=e.updateTransforms?e.updateTransforms.map((s=>(function(a,c){let l=null;if("setToServerValue"in c)ge(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),l=new ra;else if("appendMissingElements"in c){const h=c.appendMissingElements.values||[];l=new Ki(h)}else if("removeAllFromArray"in c){const h=c.removeAllFromArray.values||[];l=new sa(h)}else"increment"in c?l=new ia(a,c.increment):he(16584,{proto:c});const d=It.fromServerFormat(c.fieldPath);return new Nd(d,l)})(n,s))):[];if(e.update){e.update.name;const s=ys(n,e.update.name),i=new rn({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=(function(l){const d=l.fieldPaths||[];return new Vn(d.map((h=>It.fromServerFormat(h))))})(e.updateMask);return new Cs(s,i,a,t,r)}return new xa(s,i,t,r)}if(e.delete){const s=ys(n,e.delete);return new sl(s,t)}if(e.verify){const s=ys(n,e.verify);return new Am(s,t)}return he(1463,{proto:e})}function jR(n,e){return n&&n.length>0?(ge(e!==void 0,14353),n.map((t=>(function(s,i){let a=s.updateTime?Xt(s.updateTime):Xt(i);return a.isEqual(xe.min())&&(a=Xt(i)),new xR(a,s.transformResults||[])})(t,e)))):[]}function Sb(n,e){return{documents:[kb(n,e.path)]}}function Rb(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=kb(n,s);const i=(function(d){if(d.length!==0)return Db(rt.create(d,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(d){if(d.length!==0)return d.map((h=>(function(f){return{field:jo(f.field),direction:DR(f.dir)}})(h)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=xf(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{Vt:t,parent:s}}function jb(n){let e=Ab(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ge(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=(function(m){const f=Pb(m);return f instanceof rt&&Nm(f)?f.getFilters():[f]})(t.where));let a=[];t.orderBy&&(a=(function(m){return m.map((f=>(function(k){return new Dc(Po(k.field),(function(b){switch(b){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(f)))})(t.orderBy));let c=null;t.limit&&(c=(function(m){let f;return f=typeof m=="object"?m.value:m,Zc(f)?null:f})(t.limit));let l=null;t.startAt&&(l=(function(m){const f=!!m.before,w=m.values||[];return new ta(w,f)})(t.startAt));let d=null;return t.endAt&&(d=(function(m){const f=!m.before,w=m.values||[];return new ta(w,f)})(t.endAt)),oR(e,s,a,i,c,"F",l,d)}function PR(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return he(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Pb(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Po(t.unaryFilter.field);return Be.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Po(t.unaryFilter.field);return Be.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Po(t.unaryFilter.field);return Be.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Po(t.unaryFilter.field);return Be.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return he(61313);default:return he(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Be.create(Po(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return he(58110);default:return he(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return rt.create(t.compositeFilter.filters.map((r=>Pb(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return he(1026)}})(t.compositeFilter.op))})(n):he(30097,{filter:n})}function DR(n){return TR[n]}function OR(n){return ER[n]}function LR(n){return NR[n]}function jo(n){return{fieldPath:n.canonicalString()}}function Po(n){return It.fromServerFormat(n.fieldPath)}function Db(n){return n instanceof Be?(function(t){if(t.op==="=="){if(vy(t.value))return{unaryFilter:{field:jo(t.field),op:"IS_NAN"}};if(_y(t.value))return{unaryFilter:{field:jo(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(vy(t.value))return{unaryFilter:{field:jo(t.field),op:"IS_NOT_NAN"}};if(_y(t.value))return{unaryFilter:{field:jo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jo(t.field),op:OR(t.op),value:t.value}}})(n):n instanceof rt?(function(t){const r=t.getFilters().map((s=>Db(s)));return r.length===1?r[0]:{compositeFilter:{op:LR(t.op),filters:r}}})(n):he(54877,{filter:n})}function VR(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Ob(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e,t,r,s,i=xe.min(),a=xe.min(),c=Ut.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(e){return new ps(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ps(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ps(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ps(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lb{constructor(e){this.gt=e}}function MR(n,e){let t;if(e.document)t=CR(n.gt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ce.fromSegments(e.noDocument.path),s=Yi(e.noDocument.readTime);t=vt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return he(56709);{const r=ce.fromSegments(e.unknownDocument.path),s=Yi(e.unknownDocument.version);t=vt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime((function(s){const i=new nt(s[0],s[1]);return xe.fromTimestamp(i)})(e.readTime)),t}function My(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ou(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=(function(i,a){return{name:Oc(i,a.key),fields:a.data.value.mapValue.fields,updateTime:oa(i,a.version.toTimestamp()),createTime:oa(i,a.createTime.toTimestamp())}})(n.gt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Qi(e.version)};else{if(!e.isUnknownDocument())return he(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Qi(e.version)}}return r}function Ou(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Qi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Yi(n){const e=new nt(n.seconds,n.nanoseconds);return xe.fromTimestamp(e)}function Pi(n,e){const t=(e.baseMutations||[]).map((i=>vf(n.gt,i)));for(let i=0;i<e.mutations.length-1;++i){const a=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const c=e.mutations[i+1];a.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map((i=>vf(n.gt,i))),s=nt.fromMillis(e.localWriteTimeMs);return new Cm(e.batchId,s,t,r)}function Ka(n){const e=Yi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Yi(n.lastLimboFreeSnapshotVersion):xe.min();let r;return r=(function(i){return i.documents!==void 0})(n.query)?(function(i){const a=i.documents.length;return ge(a===1,1966,{count:a}),xr(nl(Ab(i.documents[0])))})(n.query):(function(i){return xr(jb(i))})(n.query),new ps(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ut.fromBase64String(n.resumeToken))}function Vb(n,e){const t=Qi(e.snapshotVersion),r=Qi(e.lastLimboFreeSnapshotVersion);let s;s=ju(e.target)?Sb(n.gt,e.target):Rb(n.gt,e.target).Vt;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Gi(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Mb(n){const e=jb({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Du(e,e.limit,"L"):e}function Ih(n,e){return new Rm(e.largestBatchId,vf(n.gt,e.overlayMutation))}function Uy(n,e){const t=e.path.lastSegment();return[n,wn(e.path.popLast()),t]}function Fy(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Qi(r.readTime),documentKey:wn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{getBundleMetadata(e,t){return By(e).get(t).next((r=>{if(r)return(function(i){return{id:i.bundleId,createTime:Yi(i.createTime),version:i.version}})(r)}))}saveBundleMetadata(e,t){return By(e).put((function(s){return{bundleId:s.id,createTime:Qi(Xt(s.createTime)),version:s.version}})(t))}getNamedQuery(e,t){return zy(e).get(t).next((r=>{if(r)return(function(i){return{name:i.name,query:Mb(i.bundledQuery),readTime:Yi(i.readTime)}})(r)}))}saveNamedQuery(e,t){return zy(e).put((function(s){return{name:s.name,readTime:Qi(Xt(s.readTime)),bundledQuery:s.bundledQuery}})(t))}}function By(n){return Wt(n,wd)}function zy(n){return Wt(n,_d)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){const r=t.uid||"";return new Cd(e,r)}getOverlay(e,t){return Da(e).get(Uy(this.userId,t)).next((r=>r?Ih(this.serializer,r):null))}getOverlays(e,t){const r=Hr();return V.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){const s=[];return r.forEach(((i,a)=>{const c=new Rm(t,a);s.push(this.wt(e,c))})),V.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach((a=>s.add(wn(a.getCollectionPath()))));const i=[];return s.forEach((a=>{const c=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);i.push(Da(e).Y(uf,c))})),V.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Hr(),i=wn(t),a=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Da(e).j(uf,a).next((c=>{for(const l of c){const d=Ih(this.serializer,l);s.set(d.getKey(),d)}return s}))}getOverlaysForCollectionGroup(e,t,r,s){const i=Hr();let a;const c=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Da(e).X({index:Uv,range:c},((l,d,h)=>{const m=Ih(this.serializer,d);i.size()<s||m.largestBatchId===a?(i.set(m.getKey(),m),a=m.largestBatchId):h.done()})).next((()=>i))}wt(e,t){return Da(e).put((function(s,i,a){const[c,l,d]=Uy(i,a.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Lc(s.gt,a.mutation)}})(this.serializer,this.userId,t))}}function Da(n){return Wt(n,vd)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FR{St(e){return Wt(e,vm)}getSessionToken(e){return this.St(e).get("sessionToken").next((t=>{const r=t?.value;return r?Ut.fromUint8Array(r):Ut.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(_t(e.integerValue));else if("doubleValue"in e){const r=_t(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),Nc(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=bs(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Is(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?Xv(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Id(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):he(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){const r=e.fields||{};this.Ct(t,55);for(const s of Object.keys(r))this.xt(s,t),this.Dt(r[s],t)}Lt(e,t){var r,s;const i=e.fields||{};this.Ct(t,53);const a=Zo,c=((s=(r=i[a].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.Ct(t,15),t.Ft(_t(c)),this.xt(a,t),this.Dt(i[a],t)}qt(e,t){const r=e.values||[];this.Ct(t,50);for(const s of r)this.Dt(s,t)}Bt(e,t){this.Ct(t,37),ce.fromName(e).path.forEach((r=>{this.Ct(t,60),this.$t(r,t)}))}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}Di.Ut=new Di;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const To=255;function BR(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function $y(n){const e=64-(function(r){let s=0;for(let i=0;i<8;++i){const a=BR(255&r[i]);if(s+=a,a!==8)break}return s})(n);return Math.ceil(e/8)}class zR{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Wt(r.value),r=t.next();this.Gt()}zt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.jt(r.value),r=t.next();this.Jt()}Ht(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Wt(r);else if(r<2048)this.Wt(960|r>>>6),this.Wt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Wt(480|r>>>12),this.Wt(128|63&r>>>6),this.Wt(128|63&r);else{const s=t.codePointAt(0);this.Wt(240|s>>>18),this.Wt(128|63&s>>>12),this.Wt(128|63&s>>>6),this.Wt(128|63&s)}}this.Gt()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.jt(r);else if(r<2048)this.jt(960|r>>>6),this.jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.jt(480|r>>>12),this.jt(128|63&r>>>6),this.jt(128|63&r);else{const s=t.codePointAt(0);this.jt(240|s>>>18),this.jt(128|63&s>>>12),this.jt(128|63&s>>>6),this.jt(128|63&s)}}this.Jt()}Zt(e){const t=this.Xt(e),r=$y(t);this.en(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}tn(e){const t=this.Xt(e),r=$y(t);this.en(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}nn(){this.rn(To),this.rn(255)}sn(){this._n(To),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){const t=(function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)})(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Wt(e){const t=255&e;t===0?(this.rn(0),this.rn(255)):t===To?(this.rn(To),this.rn(0)):this.rn(t)}jt(e){const t=255&e;t===0?(this._n(0),this._n(255)):t===To?(this._n(To),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class $R{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}}class qR{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}}class Oa{constructor(){this.un=new zR,this.cn=new $R(this.un),this.ln=new qR(this.un)}seed(e){this.un.seed(e)}hn(e){return e===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t,r,s){this.Pn=e,this.Tn=t,this.In=r,this.dn=s}En(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new Oi(this.Pn,this.Tn,this.In,r)}An(e,t,r){return{indexId:this.Pn,uid:e,arrayValue:du(this.In),directionalValue:du(this.dn),orderedDocumentKey:du(t),documentKey:r.path.toArray()}}Rn(e,t,r){const s=this.An(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Ms(n,e){let t=n.Pn-e.Pn;return t!==0?t:(t=qy(n.In,e.In),t!==0?t:(t=qy(n.dn,e.dn),t!==0?t:ce.comparator(n.Tn,e.Tn)))}function qy(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function du(n){return b_()?(function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r})(n):n}function Hy(n){return typeof n!="string"?n:(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(n)}class Wy{constructor(e){this.Vn=new st(((t,r)=>It.comparator(t.field,r.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Vn=this.Vn.add(r):this.fn.push(r)}}get gn(){return this.Vn.size>1}pn(e){if(ge(e.collectionGroup===this.collectionId,49279),this.gn)return!1;const t=af(e);if(t!==void 0&&!this.yn(t))return!1;const r=Si(e);let s=new Set,i=0,a=0;for(;i<r.length&&this.yn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){const c=this.Vn.getIterator().getNext();if(!s.has(c.field.canonicalString())){const l=r[i];if(!this.wn(c,l)||!this.Sn(this.mn[a++],l))return!1}++i}for(;i<r.length;++i){const c=r[i];if(a>=this.mn.length||!this.Sn(this.mn[a++],c))return!1}return!0}bn(){if(this.gn)return null;let e=new st(It.comparator);const t=[];for(const r of this.fn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new ru(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ru(r.field,0))}for(const r of this.mn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ru(r.field,r.dir==="asc"?0:1)));return new ku(ku.UNKNOWN_ID,this.collectionId,t,Ec.empty())}yn(e){for(const t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ub(n){var e,t;if(ge(n instanceof Be||n instanceof rt,20012),n instanceof Be){if(n instanceof ob){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map((i=>Be.create(n.field,"==",i))))||[];return rt.create(s,"or")}return n}const r=n.filters.map((s=>Ub(s)));return rt.create(r,n.op)}function HR(n){if(n.getFilters().length===0)return[];const e=Tf(Ub(n));return ge(Fb(e),7391),bf(e)||If(e)?[e]:e.getFilters()}function bf(n){return n instanceof Be}function If(n){return n instanceof rt&&Nm(n)}function Fb(n){return bf(n)||If(n)||(function(t){if(t instanceof rt&&mf(t)){for(const r of t.getFilters())if(!bf(r)&&!If(r))return!1;return!0}return!1})(n)}function Tf(n){if(ge(n instanceof Be||n instanceof rt,34018),n instanceof Be)return n;if(n.filters.length===1)return Tf(n.filters[0]);const e=n.filters.map((r=>Tf(r)));let t=rt.create(e,n.op);return t=Lu(t),Fb(t)?t:(ge(t instanceof rt,64498),ge(na(t),40251),ge(t.filters.length>1,57927),t.filters.reduce(((r,s)=>Dm(r,s))))}function Dm(n,e){let t;return ge(n instanceof Be||n instanceof rt,38388),ge(e instanceof Be||e instanceof rt,25473),t=n instanceof Be?e instanceof Be?(function(s,i){return rt.create([s,i],"and")})(n,e):Gy(n,e):e instanceof Be?Gy(e,n):(function(s,i){if(ge(s.filters.length>0&&i.filters.length>0,48005),na(s)&&na(i))return rb(s,i.getFilters());const a=mf(s)?s:i,c=mf(s)?i:s,l=a.filters.map((d=>Dm(d,c)));return rt.create(l,"or")})(n,e),Lu(t)}function Gy(n,e){if(na(e))return rb(e,n.getFilters());{const t=e.filters.map((r=>Dm(n,r)));return rt.create(t,"or")}}function Lu(n){if(ge(n instanceof Be||n instanceof rt,11850),n instanceof Be)return n;const e=n.getFilters();if(e.length===1)return Lu(e[0]);if(tb(n))return n;const t=e.map((s=>Lu(s))),r=[];return t.forEach((s=>{s instanceof Be?r.push(s):s instanceof rt&&(s.op===n.op?r.push(...s.filters):r.push(s))})),r.length===1?r[0]:rt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WR{constructor(){this.Dn=new Om}addToCollectionParentIndex(e,t){return this.Dn.add(t),V.resolve()}getCollectionParents(e,t){return V.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return V.resolve()}deleteFieldIndex(e,t){return V.resolve()}deleteAllFieldIndexes(e){return V.resolve()}createTargetIndexes(e,t){return V.resolve()}getDocumentsMatchingTarget(e,t){return V.resolve(null)}getIndexType(e,t){return V.resolve(0)}getFieldIndexes(e,t){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,t){return V.resolve(cr.min())}getMinOffsetFromCollectionGroup(e,t){return V.resolve(cr.min())}updateCollectionGroup(e,t,r){return V.resolve()}updateIndexEntries(e,t){return V.resolve()}}class Om{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new st(Qe.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new st(Qe.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ky="IndexedDbIndexManager",Ml=new Uint8Array(0);class GR{constructor(e,t){this.databaseId=t,this.vn=new Om,this.Cn=new As((r=>Gi(r)),((r,s)=>tl(r,s))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const i={collectionId:r,parent:wn(s)};return Qy(e).put(i)}return V.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[kv(t),""],!1,!0);return Qy(e).j(s).next((i=>{for(const a of i){if(a.collectionId!==t)break;r.push(qr(a.parent))}return r}))}addFieldIndex(e,t){const r=La(e),s=(function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map((l=>[l.fieldPath.canonicalString(),l.kind]))}})(t);delete s.indexId;const i=r.add(s);if(t.indexState){const a=No(e);return i.next((c=>{a.put(Fy(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const r=La(e),s=No(e),i=Eo(e);return r.delete(t.indexId).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=La(e),r=Eo(e),s=No(e);return t.Y().next((()=>r.Y())).next((()=>s.Y()))}createTargetIndexes(e,t){return V.forEach(this.Fn(t),(r=>this.getIndexType(e,r).next((s=>{if(s===0||s===1){const i=new Wy(r).bn();if(i!=null)return this.addFieldIndex(e,i)}}))))}getDocumentsMatchingTarget(e,t){const r=Eo(e);let s=!0;const i=new Map;return V.forEach(this.Fn(t),(a=>this.Mn(e,a).next((c=>{s&&(s=!!c),i.set(a,c)})))).next((()=>{if(s){let a=Me();const c=[];return V.forEach(i,((l,d)=>{X(Ky,`Using index ${(function(E){return`id=${E.indexId}|cg=${E.collectionGroup}|f=${E.fields.map((R=>`${R.fieldPath}:${R.kind}`)).join(",")}`})(l)} to execute ${Gi(t)}`);const h=(function(E,R){const P=af(R);if(P===void 0)return null;for(const O of Pu(E,P.fieldPath))switch(O.op){case"array-contains-any":return O.value.arrayValue.values||[];case"array-contains":return[O.value]}return null})(d,l),m=(function(E,R){const P=new Map;for(const O of Si(R))for(const g of Pu(E,O.fieldPath))switch(g.op){case"==":case"in":P.set(O.fieldPath.canonicalString(),g.value);break;case"not-in":case"!=":return P.set(O.fieldPath.canonicalString(),g.value),Array.from(P.values())}return null})(d,l),f=(function(E,R){const P=[];let O=!0;for(const g of Si(R)){const x=g.kind===0?Ny(E,g.fieldPath,E.startAt):ky(E,g.fieldPath,E.startAt);P.push(x.value),O&&(O=x.inclusive)}return new ta(P,O)})(d,l),w=(function(E,R){const P=[];let O=!0;for(const g of Si(R)){const x=g.kind===0?ky(E,g.fieldPath,E.endAt):Ny(E,g.fieldPath,E.endAt);P.push(x.value),O&&(O=x.inclusive)}return new ta(P,O)})(d,l),k=this.xn(l,d,f),C=this.xn(l,d,w),b=this.On(l,d,m),N=this.Nn(l.indexId,h,k,f.inclusive,C,w.inclusive,b);return V.forEach(N,(I=>r.H(I,t.limit).next((E=>{E.forEach((R=>{const P=ce.fromSegments(R.documentKey);a.has(P)||(a=a.add(P),c.push(P))}))}))))})).next((()=>c))}return V.resolve(null)}))}Fn(e){let t=this.Cn.get(e);return t||(e.filters.length===0?t=[e]:t=HR(rt.create(e.filters,"and")).map((r=>gf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt))),this.Cn.set(e,t),t)}Nn(e,t,r,s,i,a,c){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),d=l/(t!=null?t.length:1),h=[];for(let m=0;m<l;++m){const f=t?this.Bn(t[m/d]):Ml,w=this.Ln(e,f,r[m%d],s),k=this.kn(e,f,i[m%d],a),C=c.map((b=>this.Ln(e,f,b,!0)));h.push(...this.createRange(w,k,C))}return h}Ln(e,t,r,s){const i=new Oi(e,ce.empty(),t,r);return s?i:i.En()}kn(e,t,r,s){const i=new Oi(e,ce.empty(),t,r);return s?i.En():i}Mn(e,t){const r=new Wy(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next((i=>{let a=null;for(const c of i)r.pn(c)&&(!a||c.fields.length>a.fields.length)&&(a=c);return a}))}getIndexType(e,t){let r=2;const s=this.Fn(t);return V.forEach(s,(i=>this.Mn(e,i).next((a=>{a?r!==0&&a.fields.length<(function(l){let d=new st(It.comparator),h=!1;for(const m of l.filters)for(const f of m.getFlattenedFilters())f.field.isKeyField()||(f.op==="array-contains"||f.op==="array-contains-any"?h=!0:d=d.add(f.field));for(const m of l.orderBy)m.field.isKeyField()||(d=d.add(m.field));return d.size+(h?1:0)})(i)&&(r=1):r=0})))).next((()=>(function(a){return a.limit!==null})(t)&&s.length>1&&r===2?1:r))}qn(e,t){const r=new Oa;for(const s of Si(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const a=r.hn(s.kind);Di.Ut.bt(i,a)}return r.an()}Bn(e){const t=new Oa;return Di.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){const r=new Oa;return Di.Ut.bt(jc(this.databaseId,t),r.hn((function(i){const a=Si(i);return a.length===0?0:a[a.length-1].kind})(e))),r.an()}On(e,t,r){if(r===null)return[];let s=[];s.push(new Oa);let i=0;for(const a of Si(e)){const c=r[i++];for(const l of s)if(this.$n(t,a.fieldPath)&&Pc(c))s=this.Un(s,a,c);else{const d=l.hn(a.kind);Di.Ut.bt(c,d)}}return this.Kn(s)}xn(e,t,r){return this.On(e,t,r.position)}Kn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].an();return t}Un(e,t,r){const s=[...e],i=[];for(const a of r.arrayValue.values||[])for(const c of s){const l=new Oa;l.seed(c.an()),Di.Ut.bt(a,l.hn(t.kind)),i.push(l)}return i}$n(e,t){return!!e.filters.find((r=>r instanceof Be&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in")))}getFieldIndexes(e,t){const r=La(e),s=No(e);return(t?r.j(lf,IDBKeyRange.bound(t,t)):r.j()).next((i=>{const a=[];return V.forEach(i,(c=>s.get([c.indexId,this.uid]).next((l=>{a.push((function(h,m){const f=m?new Ec(m.sequenceNumber,new cr(Yi(m.readTime),new ce(qr(m.documentKey)),m.largestBatchId)):Ec.empty(),w=h.fields.map((([k,C])=>new ru(It.fromServerFormat(k),C)));return new ku(h.indexId,h.collectionGroup,w,f)})(c,l))})))).next((()=>a))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ee(r.collectionGroup,s.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,r){const s=La(e),i=No(e);return this.Wn(e).next((a=>s.j(lf,IDBKeyRange.bound(t,t)).next((c=>V.forEach(c,(l=>i.put(Fy(l.indexId,this.uid,a,r))))))))}updateIndexEntries(e,t){const r=new Map;return V.forEach(t,((s,i)=>{const a=r.get(s.collectionGroup);return(a?V.resolve(a):this.getFieldIndexes(e,s.collectionGroup)).next((c=>(r.set(s.collectionGroup,c),V.forEach(c,(l=>this.Gn(e,s,l).next((d=>{const h=this.zn(i,l);return d.isEqual(h)?V.resolve():this.jn(e,i,l,d,h)})))))))}))}Jn(e,t,r,s){return Eo(e).put(s.An(this.uid,this.Qn(r,t.key),t.key))}Hn(e,t,r,s){return Eo(e).delete(s.Rn(this.uid,this.Qn(r,t.key),t.key))}Gn(e,t,r){const s=Eo(e);let i=new st(Ms);return s.X({index:Mv,range:IDBKeyRange.only([r.indexId,this.uid,du(this.Qn(r,t))])},((a,c)=>{i=i.add(new Oi(r.indexId,t,Hy(c.arrayValue),Hy(c.directionalValue)))})).next((()=>i))}zn(e,t){let r=new st(Ms);const s=this.qn(t,e);if(s==null)return r;const i=af(t);if(i!=null){const a=e.data.field(i.fieldPath);if(Pc(a))for(const c of a.arrayValue.values||[])r=r.add(new Oi(t.indexId,e.key,this.Bn(c),s))}else r=r.add(new Oi(t.indexId,e.key,Ml,s));return r}jn(e,t,r,s,i){X(Ky,"Updating index entries for document '%s'",t.key);const a=[];return(function(l,d,h,m,f){const w=l.getIterator(),k=d.getIterator();let C=Io(w),b=Io(k);for(;C||b;){let N=!1,I=!1;if(C&&b){const E=h(C,b);E<0?I=!0:E>0&&(N=!0)}else C!=null?I=!0:N=!0;N?(m(b),b=Io(k)):I?(f(C),C=Io(w)):(C=Io(w),b=Io(k))}})(s,i,Ms,(c=>{a.push(this.Jn(e,t,r,c))}),(c=>{a.push(this.Hn(e,t,r,c))})),V.waitFor(a)}Wn(e){let t=1;return No(e).X({index:Vv,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((r,s,i)=>{i.done(),t=s.sequenceNumber+1})).next((()=>t))}createRange(e,t,r){r=r.sort(((a,c)=>Ms(a,c))).filter(((a,c,l)=>!c||Ms(a,l[c-1])!==0));const s=[];s.push(e);for(const a of r){const c=Ms(a,e),l=Ms(a,t);if(c===0)s[0]=e.En();else if(c>0&&l<0)s.push(a),s.push(a.En());else if(l>0)break}s.push(t);const i=[];for(let a=0;a<s.length;a+=2){if(this.Yn(s[a],s[a+1]))return[];const c=s[a].Rn(this.uid,Ml,ce.empty()),l=s[a+1].Rn(this.uid,Ml,ce.empty());i.push(IDBKeyRange.bound(c,l))}return i}Yn(e,t){return Ms(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Yy)}getMinOffset(e,t){return V.mapArray(this.Fn(t),(r=>this.Mn(e,r).next((s=>s||he(44426))))).next(Yy)}}function Qy(n){return Wt(n,Cc)}function Eo(n){return Wt(n,ic)}function La(n){return Wt(n,_m)}function No(n){return Wt(n,sc)}function Yy(n){ge(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;ym(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new cr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Bb=41943040;class gn{static withCacheSize(e){return new gn(e,gn.DEFAULT_COLLECTION_PERCENTILE,gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zb(n,e,t){const r=n.store(Ar),s=n.store(Qo),i=[],a=IDBKeyRange.only(t.batchId);let c=0;const l=r.X({range:a},((h,m,f)=>(c++,f.delete())));i.push(l.next((()=>{ge(c===1,47070,{batchId:t.batchId})})));const d=[];for(const h of t.mutations){const m=Dv(e,h.key.path,t.batchId);i.push(s.delete(m)),d.push(h.key)}return V.waitFor(i).next((()=>d))}function Vu(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw he(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gn.DEFAULT_COLLECTION_PERCENTILE=10,gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gn.DEFAULT=new gn(Bb,gn.DEFAULT_COLLECTION_PERCENTILE,gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gn.DISABLED=new gn(-1,0,0);class Sd{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Zn={}}static yt(e,t,r,s){ge(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Sd(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Us(e).X({index:Vi,range:r},((s,i,a)=>{t=!1,a.done()})).next((()=>t))}addMutationBatch(e,t,r,s){const i=Do(e),a=Us(e);return a.add({}).next((c=>{ge(typeof c=="number",49019);const l=new Cm(c,t,r,s),d=(function(w,k,C){const b=C.baseMutations.map((I=>Lc(w.gt,I))),N=C.mutations.map((I=>Lc(w.gt,I)));return{userId:k,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:b,mutations:N}})(this.serializer,this.userId,l),h=[];let m=new st(((f,w)=>Ee(f.canonicalString(),w.canonicalString())));for(const f of s){const w=Dv(this.userId,f.key.path,c);m=m.add(f.key.path.popLast()),h.push(a.put(d)),h.push(i.put(w,TS))}return m.forEach((f=>{h.push(this.indexManager.addToCollectionParentIndex(e,f))})),e.addOnCommittedListener((()=>{this.Zn[c]=l.keys()})),V.waitFor(h).next((()=>l))}))}lookupMutationBatch(e,t){return Us(e).get(t).next((r=>r?(ge(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Pi(this.serializer,r)):null))}Xn(e,t){return this.Zn[t]?V.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next((r=>{if(r){const s=r.keys();return this.Zn[t]=s,s}return null}))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Us(e).X({index:Vi,range:s},((a,c,l)=>{c.userId===this.userId&&(ge(c.batchId>=r,47524,{er:r}),i=Pi(this.serializer,c)),l.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Fi;return Us(e).X({index:Vi,range:t,reverse:!0},((s,i,a)=>{r=i.batchId,a.done()})).next((()=>r))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Fi],[this.userId,Number.POSITIVE_INFINITY]);return Us(e).j(Vi,t).next((r=>r.map((s=>Pi(this.serializer,s)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=su(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Do(e).X({range:s},((a,c,l)=>{const[d,h,m]=a,f=qr(h);if(d===this.userId&&t.path.isEqual(f))return Us(e).get(m).next((w=>{if(!w)throw he(61480,{tr:a,batchId:m});ge(w.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:w.userId,batchId:m}),i.push(Pi(this.serializer,w))}));l.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new st(Ee);const s=[];return t.forEach((i=>{const a=su(this.userId,i.path),c=IDBKeyRange.lowerBound(a),l=Do(e).X({range:c},((d,h,m)=>{const[f,w,k]=d,C=qr(w);f===this.userId&&i.path.isEqual(C)?r=r.add(k):m.done()}));s.push(l)})),V.waitFor(s).next((()=>this.nr(e,r)))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=su(this.userId,r),a=IDBKeyRange.lowerBound(i);let c=new st(Ee);return Do(e).X({range:a},((l,d,h)=>{const[m,f,w]=l,k=qr(f);m===this.userId&&r.isPrefixOf(k)?k.length===s&&(c=c.add(w)):h.done()})).next((()=>this.nr(e,c)))}nr(e,t){const r=[],s=[];return t.forEach((i=>{s.push(Us(e).get(i).next((a=>{if(a===null)throw he(35274,{batchId:i});ge(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),r.push(Pi(this.serializer,a))})))})),V.waitFor(s).next((()=>r))}removeMutationBatch(e,t){return zb(e.ce,this.userId,t).next((r=>(e.addOnCommittedListener((()=>{this.rr(t.batchId)})),V.forEach(r,(s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return V.resolve();const r=IDBKeyRange.lowerBound((function(a){return[a]})(this.userId)),s=[];return Do(e).X({range:r},((i,a,c)=>{if(i[0]===this.userId){const l=qr(i[1]);s.push(l)}else c.done()})).next((()=>{ge(s.length===0,56720,{ir:s.map((i=>i.canonicalString()))})}))}))}containsKey(e,t){return $b(e,this.userId,t)}sr(e){return qb(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Fi,lastStreamToken:""}))}}function $b(n,e,t){const r=su(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let a=!1;return Do(n).X({range:i,Z:!0},((c,l,d)=>{const[h,m,f]=c;h===e&&m===s&&(a=!0),d.done()})).next((()=>a))}function Us(n){return Wt(n,Ar)}function Do(n){return Wt(n,Qo)}function qb(n){return Wt(n,kc)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new Xi(0)}static ur(){return new Xi(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KR{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next((t=>{const r=new Xi(t.highestTargetId);return t.highestTargetId=r.next(),this.lr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.cr(e).next((t=>xe.fromTimestamp(new nt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.cr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,r){return this.cr(e).next((s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.lr(e,s))))}addTargetData(e,t){return this.hr(e,t).next((()=>this.cr(e).next((r=>(r.targetCount+=1,this.Pr(t,r),this.lr(e,r))))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>ko(e).delete(t.targetId))).next((()=>this.cr(e))).next((r=>(ge(r.targetCount>0,8065),r.targetCount-=1,this.lr(e,r))))}removeTargets(e,t,r){let s=0;const i=[];return ko(e).X(((a,c)=>{const l=Ka(c);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))})).next((()=>V.waitFor(i))).next((()=>s))}forEachTarget(e,t){return ko(e).X(((r,s)=>{const i=Ka(s);t(i)}))}cr(e){return Jy(e).get(Su).next((t=>(ge(t!==null,2888),t)))}lr(e,t){return Jy(e).put(Su,t)}hr(e,t){return ko(e).put(Vb(this.serializer,t))}Pr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.cr(e).next((t=>t.targetCount))}getTargetData(e,t){const r=Gi(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return ko(e).X({range:s,index:Lv},((a,c,l)=>{const d=Ka(c);tl(t,d.target)&&(i=d,l.done())})).next((()=>i))}addMatchingKeys(e,t,r){const s=[],i=Ws(e);return t.forEach((a=>{const c=wn(a.path);s.push(i.put({targetId:r,path:c})),s.push(this.referenceDelegate.addReference(e,r,a))})),V.waitFor(s)}removeMatchingKeys(e,t,r){const s=Ws(e);return V.forEach(t,(i=>{const a=wn(i.path);return V.waitFor([s.delete([r,a]),this.referenceDelegate.removeReference(e,r,i)])}))}removeMatchingKeysForTargetId(e,t){const r=Ws(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ws(e);let i=Me();return s.X({range:r,Z:!0},((a,c,l)=>{const d=qr(a[1]),h=new ce(d);i=i.add(h)})).next((()=>i))}containsKey(e,t){const r=wn(t.path),s=IDBKeyRange.bound([r],[kv(r)],!1,!0);let i=0;return Ws(e).X({index:wm,Z:!0,range:s},(([a,c],l,d)=>{a!==0&&(i++,d.done())})).next((()=>i>0))}Et(e,t){return ko(e).get(t).next((r=>r?Ka(r):null))}}function ko(n){return Wt(n,Yo)}function Jy(n){return Wt(n,Bi)}function Ws(n){return Wt(n,Xo)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zy="LruGarbageCollector",Hb=1048576;function ex([n,e],[t,r]){const s=Ee(n,t);return s===0?Ee(e,r):s}class QR{constructor(e){this.Tr=e,this.buffer=new st(ex),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();ex(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Wb{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){X(Zy,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){gi(t)?X(Zy,"Ignoring IndexedDB error during garbage collection: ",t):await ao(t)}await this.Rr(3e5)}))}}class YR{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return V.resolve(mr.ue);const r=new QR(t);return this.Vr.forEachTarget(e,(s=>r.Er(s.sequenceNumber))).next((()=>this.Vr.gr(e,(s=>r.Er(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(X("LruGarbageCollector","Garbage collection skipped; disabled"),V.resolve(Xy)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(X("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Xy):this.pr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,s,i,a,c,l,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(X("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(e,s)))).next((m=>(r=m,c=Date.now(),this.removeTargets(e,r,t)))).next((m=>(i=m,l=Date.now(),this.removeOrphanedDocuments(e,r)))).next((m=>(d=Date.now(),So()<=Fe.DEBUG&&X("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${i} targets in `+(l-c)+`ms
	Removed ${m} documents in `+(d-l)+`ms
Total Duration: ${d-h}ms`),V.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m}))))}}function Gb(n,e){return new YR(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XR{constructor(e,t){this.db=e,this.garbageCollector=Gb(this,t)}mr(e){const t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}yr(e){let t=0;return this.gr(e,(r=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,((r,s)=>t(s)))}addReference(e,t,r){return Ul(e,r)}removeReference(e,t,r){return Ul(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ul(e,t)}Sr(e,t){return(function(s,i){let a=!1;return qb(s).ee((c=>$b(s,c,i).next((l=>(l&&(a=!0),V.resolve(!l)))))).next((()=>a))})(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.wr(e,((a,c)=>{if(c<=t){const l=this.Sr(e,a).next((d=>{if(!d)return i++,r.getEntry(e,a).next((()=>(r.removeEntry(a,xe.min()),Ws(e).delete((function(m){return[0,wn(m.path)]})(a)))))}));s.push(l)}})).next((()=>V.waitFor(s))).next((()=>r.apply(e))).next((()=>i))}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ul(e,t)}wr(e,t){const r=Ws(e);let s,i=mr.ue;return r.X({index:wm},(([a,c],{path:l,sequenceNumber:d})=>{a===0?(i!==mr.ue&&t(new ce(qr(s)),i),i=d,s=l):i=mr.ue})).next((()=>{i!==mr.ue&&t(new ce(qr(s)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ul(n,e){return Ws(n).put((function(r,s){return{targetId:0,path:wn(r.path),sequenceNumber:s}})(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{constructor(){this.changes=new As((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,vt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?V.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JR{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ai(e).put(r)}removeEntry(e,t,r){return Ai(e).delete((function(i,a){const c=i.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Ou(a),c[c.length-1]]})(t,r))}updateMetadata(e,t){return this.getMetadata(e).next((r=>(r.byteSize+=t,this.br(e,r))))}getEntry(e,t){let r=vt.newInvalidDocument(t);return Ai(e).X({index:iu,range:IDBKeyRange.only(Va(t))},((s,i)=>{r=this.Dr(t,i)})).next((()=>r))}vr(e,t){let r={size:0,document:vt.newInvalidDocument(t)};return Ai(e).X({index:iu,range:IDBKeyRange.only(Va(t))},((s,i)=>{r={document:this.Dr(t,i),size:Vu(i)}})).next((()=>r))}getEntries(e,t){let r=sr();return this.Cr(e,t,((s,i)=>{const a=this.Dr(s,i);r=r.insert(s,a)})).next((()=>r))}Fr(e,t){let r=sr(),s=new bt(ce.comparator);return this.Cr(e,t,((i,a)=>{const c=this.Dr(i,a);r=r.insert(i,c),s=s.insert(i,Vu(a))})).next((()=>({documents:r,Mr:s})))}Cr(e,t,r){if(t.isEmpty())return V.resolve();let s=new st(rx);t.forEach((l=>s=s.add(l)));const i=IDBKeyRange.bound(Va(s.first()),Va(s.last())),a=s.getIterator();let c=a.getNext();return Ai(e).X({index:iu,range:i},((l,d,h)=>{const m=ce.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;c&&rx(c,m)<0;)r(c,null),c=a.getNext();c&&c.isEqual(m)&&(r(c,d),c=a.hasNext()?a.getNext():null),c?h.G(Va(c)):h.done()})).next((()=>{for(;c;)r(c,null),c=a.hasNext()?a.getNext():null}))}getDocumentsMatchingQuery(e,t,r,s,i){const a=t.path,c=[a.popLast().toArray(),a.lastSegment(),Ou(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ai(e).j(IDBKeyRange.bound(c,l,!0)).next((d=>{i?.incrementDocumentReadCount(d.length);let h=sr();for(const m of d){const f=this.Dr(ce.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);f.isFoundDocument()&&(rl(t,f)||s.has(f.key))&&(h=h.insert(f.key,f))}return h}))}getAllFromCollectionGroup(e,t,r,s){let i=sr();const a=nx(t,r),c=nx(t,cr.max());return Ai(e).X({index:Ov,range:IDBKeyRange.bound(a,c,!0)},((l,d,h)=>{const m=this.Dr(ce.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(m.key,m),i.size===s&&h.done()})).next((()=>i))}newChangeBuffer(e){return new ZR(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return tx(e).get(cf).next((t=>(ge(!!t,20021),t)))}br(e,t){return tx(e).put(cf,t)}Dr(e,t){if(t){const r=MR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(xe.min())))return r}return vt.newInvalidDocument(e)}}function Qb(n){return new JR(n)}class ZR extends Kb{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new As((r=>r.toString()),((r,s)=>r.isEqual(s)))}applyChanges(e){const t=[];let r=0,s=new st(((i,a)=>Ee(i.canonicalString(),a.canonicalString())));return this.changes.forEach(((i,a)=>{const c=this.Nr.get(i);if(t.push(this.Or.removeEntry(e,i,c.readTime)),a.isValidDocument()){const l=My(this.Or.serializer,a);s=s.add(i.path.popLast());const d=Vu(l);r+=d-c.size,t.push(this.Or.addEntry(e,i,l))}else if(r-=c.size,this.trackRemovals){const l=My(this.Or.serializer,a.convertToNoDocument(xe.min()));t.push(this.Or.addEntry(e,i,l))}})),s.forEach((i=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,i))})),t.push(this.Or.updateMetadata(e,r)),V.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next((r=>(this.Nr.set(t,{size:r.size,readTime:r.document.readTime}),r.document)))}getAllFromCache(e,t){return this.Or.Fr(e,t).next((({documents:r,Mr:s})=>(s.forEach(((i,a)=>{this.Nr.set(i,{size:a,readTime:r.get(i).readTime})})),r)))}}function tx(n){return Wt(n,Ac)}function Ai(n){return Wt(n,Cu)}function Va(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function nx(n,e){const t=e.documentKey.path.toArray();return[n,Ou(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function rx(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ee(t[i],r[i]),s)return s;return s=Ee(t.length,r.length),s||(s=Ee(t[t.length-2],r[r.length-2]),s||Ee(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yb{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&lc(r.mutation,s,Vn.empty(),nt.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,Me()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=Me()){const s=Hr();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=Wa();return i.forEach(((c,l)=>{a=a.insert(c,l.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Hr();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,Me())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,c)=>{t.set(a,c)}))}))}computeViews(e,t,r,s){let i=sr();const a=cc(),c=(function(){return cc()})();return t.forEach(((l,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof Cs)?i=i.insert(d.key,d):h!==void 0?(a.set(d.key,h.mutation.getFieldMask()),lc(h.mutation,d,h.mutation.getFieldMask(),nt.now())):a.set(d.key,Vn.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((d,h)=>a.set(d,h))),t.forEach(((d,h)=>{var m;return c.set(d,new ej(h,(m=a.get(d))!==null&&m!==void 0?m:null))})),c)))}recalculateAndSaveOverlays(e,t){const r=cc();let s=new bt(((a,c)=>a-c)),i=Me();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const c of a)c.keys().forEach((l=>{const d=t.get(l);if(d===null)return;let h=r.get(l)||Vn.empty();h=c.applyToLocalView(d,h),r.set(l,h);const m=(s.get(c.batchId)||Me()).add(l);s=s.insert(c.batchId,m)}))})).next((()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const l=c.getNext(),d=l.key,h=l.value,m=hb();h.forEach((f=>{if(!i.has(f)){const w=wb(t.get(f),r.get(f));w!==null&&m.set(f,w),i=i.add(f)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return V.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return ce.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ab(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):V.resolve(Hr());let c=Tc,l=i;return a.next((d=>V.forEach(d,((h,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),i.get(h)?V.resolve():this.remoteDocumentCache.getEntry(e,h).next((f=>{l=l.insert(h,f)}))))).next((()=>this.populateOverlays(e,d,i))).next((()=>this.computeViews(e,l,d,Me()))).next((h=>({batchId:c,changes:db(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ce(t)).next((r=>{let s=Wa();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=Wa();return this.indexManager.getCollectionParents(e,i).next((c=>V.forEach(c,(l=>{const d=(function(m,f){return new ya(f,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((h=>{h.forEach(((m,f)=>{a=a.insert(m,f)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((l,d)=>{const h=d.getKey();a.get(h)===null&&(a=a.insert(h,vt.newInvalidDocument(h)))}));let c=Wa();return a.forEach(((l,d)=>{const h=i.get(l);h!==void 0&&lc(h.mutation,d,Vn.empty(),nt.now()),rl(t,d)&&(c=c.insert(l,d))})),c}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return V.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Xt(s.createTime)}})(t)),V.resolve()}getNamedQuery(e,t){return V.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,(function(s){return{name:s.name,query:Mb(s.bundledQuery),readTime:Xt(s.readTime)}})(t)),V.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nj{constructor(){this.overlays=new bt(ce.comparator),this.kr=new Map}getOverlay(e,t){return V.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Hr();return V.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.wt(e,t,i)})),V.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.kr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.kr.delete(r)),V.resolve()}getOverlaysForCollection(e,t,r){const s=Hr(),i=t.length+1,a=new ce(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const l=c.getNext().value,d=l.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return V.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new bt(((d,h)=>d-h));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let h=i.get(d.largestBatchId);h===null&&(h=Hr(),i=i.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const c=Hr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((d,h)=>c.set(d,h))),!(c.size()>=s)););return V.resolve(c)}wt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.kr.get(s.largestBatchId).delete(r.key);this.kr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Rm(t,r));let i=this.kr.get(t);i===void 0&&(i=Me(),this.kr.set(t,i)),this.kr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rj{constructor(){this.sessionToken=Ut.EMPTY_BYTE_STRING}getSessionToken(e){return V.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,V.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lm{constructor(){this.qr=new st(Yt.Qr),this.$r=new st(Yt.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const r=new Yt(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Wr(new Yt(e,t))}Gr(e,t){e.forEach((r=>this.removeReference(r,t)))}zr(e){const t=new ce(new Qe([])),r=new Yt(t,e),s=new Yt(t,e+1),i=[];return this.$r.forEachInRange([r,s],(a=>{this.Wr(a),i.push(a.key)})),i}jr(){this.qr.forEach((e=>this.Wr(e)))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new ce(new Qe([])),r=new Yt(t,e),s=new Yt(t,e+1);let i=Me();return this.$r.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new Yt(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Yt{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return ce.comparator(e.key,t.key)||Ee(e.Hr,t.Hr)}static Ur(e,t){return Ee(e.Hr,t.Hr)||ce.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sj{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new st(Yt.Qr)}checkEmpty(e){return V.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Cm(i,t,r,s);this.mutationQueue.push(a);for(const c of s)this.Yr=this.Yr.add(new Yt(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return V.resolve(a)}lookupMutationBatch(e,t){return V.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),i=s<0?0:s;return V.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(this.mutationQueue.length===0?Fi:this.er-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Yt(t,0),s=new Yt(t,Number.POSITIVE_INFINITY),i=[];return this.Yr.forEachInRange([r,s],(a=>{const c=this.Zr(a.Hr);i.push(c)})),V.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new st(Ee);return t.forEach((s=>{const i=new Yt(s,0),a=new Yt(s,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([i,a],(c=>{r=r.add(c.Hr)}))})),V.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ce.isDocumentKey(i)||(i=i.child(""));const a=new Yt(new ce(i),0);let c=new st(Ee);return this.Yr.forEachWhile((l=>{const d=l.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(c=c.add(l.Hr)),!0)}),a),V.resolve(this.ei(c))}ei(e){const t=[];return e.forEach((r=>{const s=this.Zr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){ge(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return V.forEach(t.mutations,(s=>{const i=new Yt(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Yr=r}))}rr(e){}containsKey(e,t){const r=new Yt(t,0),s=this.Yr.firstAfterOrEqual(r);return V.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,V.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ij{constructor(e){this.ni=e,this.docs=(function(){return new bt(ce.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return V.resolve(r?r.document.mutableCopy():vt.newInvalidDocument(t))}getEntries(e,t){let r=sr();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():vt.newInvalidDocument(s))})),V.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=sr();const a=t.path,c=new ce(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){const{key:d,value:{document:h}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||ym(Sv(h),r)<=0||(s.has(h.key)||rl(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return V.resolve(i)}getAllFromCollectionGroup(e,t,r,s){he(9500)}ri(e,t){return V.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new oj(this)}getSize(e){return V.resolve(this.size)}}class oj extends Kb{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Or.addEntry(e,s)):this.Or.removeEntry(r)})),V.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(e){this.persistence=e,this.ii=new As((t=>Gi(t)),tl),this.lastRemoteSnapshotVersion=xe.min(),this.highestTargetId=0,this.si=0,this.oi=new Lm,this.targetCount=0,this._i=Xi.ar()}forEachTarget(e,t){return this.ii.forEach(((r,s)=>t(s))),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),V.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new Xi(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,V.resolve()}updateTargetData(e,t){return this.hr(t),V.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.ii.forEach(((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.ii.delete(a),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)})),V.waitFor(i).next((()=>s))}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,t){const r=this.ii.get(t)||null;return V.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),V.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),V.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),V.resolve()}getMatchingKeysForTargetId(e,t){const r=this.oi.Jr(t);return V.resolve(r)}containsKey(e,t){return V.resolve(this.oi.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e,t){this.ai={},this.overlays={},this.ui=new mr(0),this.ci=!1,this.ci=!0,this.li=new rj,this.referenceDelegate=e(this),this.hi=new aj(this),this.indexManager=new WR,this.remoteDocumentCache=(function(s){return new ij(s)})((r=>this.referenceDelegate.Pi(r))),this.serializer=new Lb(t),this.Ti=new tj(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new nj,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new sj(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){X("MemoryPersistence","Starting transaction:",e);const s=new cj(this.ui.next());return this.referenceDelegate.Ii(),r(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ei(e,t){return V.or(Object.values(this.ai).map((r=>()=>r.containsKey(e,t))))}}class cj extends jv{constructor(e){super(),this.currentSequenceNumber=e}}class Rd{constructor(e){this.persistence=e,this.Ai=new Lm,this.Ri=null}static Vi(e){return new Rd(e)}get mi(){if(this.Ri)return this.Ri;throw he(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),V.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),V.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),V.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach((s=>this.mi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.mi.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.mi,(r=>{const s=ce.fromPath(r);return this.fi(e,s).next((i=>{i||t.removeEntry(s,xe.min())}))})).next((()=>(this.Ri=null,t.apply(e))))}updateLimboDocument(e,t){return this.fi(e,t).next((r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())}))}Pi(e){return 0}fi(e,t){return V.or([()=>V.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Mu{constructor(e,t){this.persistence=e,this.gi=new As((r=>wn(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Gb(this,t)}static Vi(e,t){return new Mu(e,t)}Ii(){}di(e){return V.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}yr(e){let t=0;return this.gr(e,(r=>{t++})).next((()=>t))}gr(e,t){return V.forEach(this.gi,((r,s)=>this.Sr(e,r,s).next((i=>i?V.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ri(e,(a=>this.Sr(e,a,t).next((c=>{c||(r++,i.removeEntry(a,xe.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),V.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),V.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),V.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),V.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=au(e.data.value)),t}Sr(e,t,r){return V.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.gi.get(t);return V.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lj{constructor(e){this.serializer=e}q(e,t,r,s){const i=new xd("createOrUpgrade",t);r<1&&s>=1&&((function(l){l.createObjectStore(el)})(e),(function(l){l.createObjectStore(kc,{keyPath:IS}),l.createObjectStore(Ar,{keyPath:my,autoIncrement:!0}).createIndex(Vi,py,{unique:!0}),l.createObjectStore(Qo)})(e),sx(e),(function(l){l.createObjectStore(Ri)})(e));let a=V.resolve();return r<3&&s>=3&&(r!==0&&((function(l){l.deleteObjectStore(Xo),l.deleteObjectStore(Yo),l.deleteObjectStore(Bi)})(e),sx(e)),a=a.next((()=>(function(l){const d=l.store(Bi),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:xe.min().toTimestamp(),targetCount:0};return d.put(Su,h)})(i)))),r<4&&s>=4&&(r!==0&&(a=a.next((()=>(function(l,d){return d.store(Ar).j().next((m=>{l.deleteObjectStore(Ar),l.createObjectStore(Ar,{keyPath:my,autoIncrement:!0}).createIndex(Vi,py,{unique:!0});const f=d.store(Ar),w=m.map((k=>f.put(k)));return V.waitFor(w)}))})(e,i)))),a=a.next((()=>{(function(l){l.createObjectStore(Jo,{keyPath:jS})})(e)}))),r<5&&s>=5&&(a=a.next((()=>this.pi(i)))),r<6&&s>=6&&(a=a.next((()=>((function(l){l.createObjectStore(Ac)})(e),this.yi(i))))),r<7&&s>=7&&(a=a.next((()=>this.wi(i)))),r<8&&s>=8&&(a=a.next((()=>this.Si(e,i)))),r<9&&s>=9&&(a=a.next((()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)}))),r<10&&s>=10&&(a=a.next((()=>this.bi(i)))),r<11&&s>=11&&(a=a.next((()=>{(function(l){l.createObjectStore(wd,{keyPath:PS})})(e),(function(l){l.createObjectStore(_d,{keyPath:DS})})(e)}))),r<12&&s>=12&&(a=a.next((()=>{(function(l){const d=l.createObjectStore(vd,{keyPath:BS});d.createIndex(uf,zS,{unique:!1}),d.createIndex(Uv,$S,{unique:!1})})(e)}))),r<13&&s>=13&&(a=a.next((()=>(function(l){const d=l.createObjectStore(Cu,{keyPath:ES});d.createIndex(iu,NS),d.createIndex(Ov,kS)})(e))).next((()=>this.Di(e,i))).next((()=>e.deleteObjectStore(Ri)))),r<14&&s>=14&&(a=a.next((()=>this.Ci(e,i)))),r<15&&s>=15&&(a=a.next((()=>(function(l){l.createObjectStore(_m,{keyPath:OS,autoIncrement:!0}).createIndex(lf,LS,{unique:!1}),l.createObjectStore(sc,{keyPath:VS}).createIndex(Vv,MS,{unique:!1}),l.createObjectStore(ic,{keyPath:US}).createIndex(Mv,FS,{unique:!1})})(e)))),r<16&&s>=16&&(a=a.next((()=>{t.objectStore(sc).clear()})).next((()=>{t.objectStore(ic).clear()}))),r<17&&s>=17&&(a=a.next((()=>{(function(l){l.createObjectStore(vm,{keyPath:qS})})(e)}))),r<18&&s>=18&&b_()&&(a=a.next((()=>{t.objectStore(sc).clear()})).next((()=>{t.objectStore(ic).clear()}))),a}yi(e){let t=0;return e.store(Ri).X(((r,s)=>{t+=Vu(s)})).next((()=>{const r={byteSize:t};return e.store(Ac).put(cf,r)}))}pi(e){const t=e.store(kc),r=e.store(Ar);return t.j().next((s=>V.forEach(s,(i=>{const a=IDBKeyRange.bound([i.userId,Fi],[i.userId,i.lastAcknowledgedBatchId]);return r.j(Vi,a).next((c=>V.forEach(c,(l=>{ge(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const d=Pi(this.serializer,l);return zb(e,i.userId,d).next((()=>{}))}))))}))))}wi(e){const t=e.store(Xo),r=e.store(Ri);return e.store(Bi).get(Su).next((s=>{const i=[];return r.X(((a,c)=>{const l=new Qe(a),d=(function(m){return[0,wn(m)]})(l);i.push(t.get(d).next((h=>h?V.resolve():(m=>t.put({targetId:0,path:wn(m),sequenceNumber:s.highestListenSequenceNumber}))(l))))})).next((()=>V.waitFor(i)))}))}Si(e,t){e.createObjectStore(Cc,{keyPath:RS});const r=t.store(Cc),s=new Om,i=a=>{if(s.add(a)){const c=a.lastSegment(),l=a.popLast();return r.put({collectionId:c,parent:wn(l)})}};return t.store(Ri).X({Z:!0},((a,c)=>{const l=new Qe(a);return i(l.popLast())})).next((()=>t.store(Qo).X({Z:!0},(([a,c,l],d)=>{const h=qr(c);return i(h.popLast())}))))}bi(e){const t=e.store(Yo);return t.X(((r,s)=>{const i=Ka(s),a=Vb(this.serializer,i);return t.put(a)}))}Di(e,t){const r=t.store(Ri),s=[];return r.X(((i,a)=>{const c=t.store(Cu),l=(function(m){return m.document?new ce(Qe.fromString(m.document.name).popFirst(5)):m.noDocument?ce.fromSegments(m.noDocument.path):m.unknownDocument?ce.fromSegments(m.unknownDocument.path):he(36783)})(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(c.put(d))})).next((()=>V.waitFor(s)))}Ci(e,t){const r=t.store(Ar),s=Qb(this.serializer),i=new Vm(Rd.Vi,this.serializer.gt);return r.j().next((a=>{const c=new Map;return a.forEach((l=>{var d;let h=(d=c.get(l.userId))!==null&&d!==void 0?d:Me();Pi(this.serializer,l).keys().forEach((m=>h=h.add(m))),c.set(l.userId,h)})),V.forEach(c,((l,d)=>{const h=new kn(d),m=Cd.yt(this.serializer,h),f=i.getIndexManager(h),w=Sd.yt(h,this.serializer,f,i.referenceDelegate);return new Yb(s,w,m,f).recalculateAndSaveOverlaysForDocumentKeys(new df(t,mr.ue),l).next()}))}))}}function sx(n){n.createObjectStore(Xo,{keyPath:CS}).createIndex(wm,SS,{unique:!0}),n.createObjectStore(Yo,{keyPath:"targetId"}).createIndex(Lv,AS,{unique:!0}),n.createObjectStore(Bi)}const Fs="IndexedDbPersistence",Th=18e5,Eh=5e3,Nh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",uj="main";class Mm{constructor(e,t,r,s,i,a,c,l,d,h,m=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Fi=i,this.window=a,this.document=c,this.Mi=d,this.xi=h,this.Oi=m,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=f=>Promise.resolve(),!Mm.C())throw new ne($.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new XR(this,s),this.Qi=t+uj,this.serializer=new Lb(l),this.$i=new ri(this.Qi,this.Oi,new lj(this.serializer)),this.li=new FR,this.hi=new KR(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Qb(this.serializer),this.Ti=new UR,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,h===!1&&An(Fs,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ne($.FAILED_PRECONDITION,Nh);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.hi.getHighestSequenceNumber(e)))})).then((e=>{this.ui=new mr(e,this.Mi)})).then((()=>{this.ci=!0})).catch((e=>(this.$i&&this.$i.close(),Promise.reject(e))))}ji(e){return this.qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget((async()=>{this.started&&await this.Ki()})))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Fl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Ji(e).next((t=>{t||(this.isPrimary=!1,this.Fi.enqueueRetryable((()=>this.qi(!1))))}))})).next((()=>this.Hi(e))).next((t=>this.isPrimary&&!t?this.Yi(e).next((()=>!1)):!!t&&this.Zi(e).next((()=>!0)))))).catch((e=>{if(gi(e))return X(Fs,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return X(Fs,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable((()=>this.qi(e))),this.isPrimary=e}))}Ji(e){return Ma(e).get(bo).next((t=>V.resolve(this.Xi(t))))}es(e){return Fl(e).delete(this.clientId)}async ts(){if(this.isPrimary&&!this.ns(this.ki,Th)){this.ki=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const r=Wt(t,Jo);return r.j().next((s=>{const i=this.rs(s,Th),a=s.filter((c=>i.indexOf(c)===-1));return V.forEach(a,(c=>r.delete(c.clientId))).next((()=>a))}))})).catch((()=>[]));if(this.Ui)for(const t of e)this.Ui.removeItem(this.ss(t.clientId))}}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ki().then((()=>this.ts())).then((()=>this.zi()))))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?V.resolve(!0):Ma(e).get(bo).next((t=>{if(t!==null&&this.ns(t.leaseTimestampMs,Eh)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new ne($.FAILED_PRECONDITION,Nh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Fl(e).j().next((r=>this.rs(r,Eh).find((s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,c=this.networkEnabled===s.networkEnabled;if(i||a&&c)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&X(Fs,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),await this.$i.runTransaction("shutdown","readwrite",[el,Jo],(e=>{const t=new df(e,mr.ue);return this.Yi(t).next((()=>this.es(t)))})),this.$i.close(),this.hs()}rs(e,t){return e.filter((r=>this.ns(r.updateTimeMs,t)&&!this._s(r.clientId)))}Ps(){return this.runTransaction("getActiveClients","readonly",(e=>Fl(e).j().next((t=>this.rs(t,Th).map((r=>r.clientId))))))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return Sd.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new GR(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return Cd.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,r){X(Fs,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=(function(l){return l===18?GS:l===17?$v:l===16?WS:l===15?bm:l===14?zv:l===13?Bv:l===12?HS:l===11?Fv:void he(60245)})(this.Oi);let a;return this.$i.runTransaction(e,s,i,(c=>(a=new df(c,this.ui?this.ui.next():mr.ue),t==="readwrite-primary"?this.Ji(a).next((l=>!!l||this.Hi(a))).next((l=>{if(!l)throw An(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable((()=>this.qi(!1))),new ne($.FAILED_PRECONDITION,Rv);return r(a)})).next((l=>this.Zi(a).next((()=>l)))):this.Ts(a).next((()=>r(a)))))).then((c=>(a.raiseOnCommittedEvent(),c)))}Ts(e){return Ma(e).get(bo).next((t=>{if(t!==null&&this.ns(t.leaseTimestampMs,Eh)&&!this._s(t.ownerId)&&!this.Xi(t)&&!(this.xi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new ne($.FAILED_PRECONDITION,Nh)}))}Zi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ma(e).put(bo,t)}static C(){return ri.C()}Yi(e){const t=Ma(e);return t.get(bo).next((r=>this.Xi(r)?(X(Fs,"Releasing primary lease."),t.delete(bo)):V.resolve()))}ns(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(An(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki())))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Ni=()=>{this.us();const t=/(?:Version|Mobile)\/1[456]/;v_()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{const r=((t=this.Ui)===null||t===void 0?void 0:t.getItem(this.ss(e)))!==null;return X(Fs,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return An(Fs,"Failed to get zombied client id.",r),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){An("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ma(n){return Wt(n,el)}function Fl(n){return Wt(n,Jo)}function dj(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=s}static Es(e,t){let r=Me(),s=Me();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Um(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hj{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xb{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return v_()?8:Pv($t())>0?6:4})()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ps(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ys(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new hj;return this.ws(e,t,a).next((c=>{if(i.result=c,this.Rs)return this.Ss(e,t,a,c.size)}))})).next((()=>i.result))}Ss(e,t,r,s){return r.documentReadCount<this.Vs?(So()<=Fe.DEBUG&&X("QueryEngine","SDK will not create cache indexes for query:",Ro(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),V.resolve()):(So()<=Fe.DEBUG&&X("QueryEngine","Query:",Ro(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.fs*s?(So()<=Fe.DEBUG&&X("QueryEngine","The SDK decides to create cache indexes for query:",Ro(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xr(t))):V.resolve())}ps(e,t){if(Ay(t))return V.resolve(null);let r=xr(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Du(t,null,"F"),r=xr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=Me(...i);return this.gs.getDocuments(e,a).next((c=>this.indexManager.getMinOffset(e,r).next((l=>{const d=this.bs(t,c);return this.Ds(t,d,a,l.readTime)?this.ps(e,Du(t,null,"F")):this.vs(e,d,t,l)}))))})))))}ys(e,t,r,s){return Ay(t)||s.isEqual(xe.min())?V.resolve(null):this.gs.getDocuments(e,r).next((i=>{const a=this.bs(t,i);return this.Ds(t,a,r,s)?V.resolve(null):(So()<=Fe.DEBUG&&X("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ro(t)),this.vs(e,a,t,gS(s,Tc)).next((c=>c)))}))}bs(e,t){let r=new st(lb(e));return t.forEach(((s,i)=>{rl(e,i)&&(r=r.add(i))})),r}Ds(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ws(e,t,r){return So()<=Fe.DEBUG&&X("QueryEngine","Using full collection scan to execute query:",Ro(t)),this.gs.getDocumentsMatchingQuery(e,t,cr.min(),r)}vs(e,t,r,s){return this.gs.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fm="LocalStore",fj=3e8;class mj{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.Fs=new bt(Ee),this.Ms=new As((i=>Gi(i)),tl),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Yb(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Fs)))}}function Jb(n,e,t,r){return new mj(n,e,t,r)}async function Zb(n,e){const t=ke(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Ns(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],c=[];let l=Me();for(const d of s){a.push(d.batchId);for(const h of d.mutations)l=l.add(h.key)}for(const d of i){c.push(d.batchId);for(const h of d.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next((d=>({Bs:d,removedBatchIds:a,addedBatchIds:c})))}))}))}function pj(n,e){const t=ke(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.Os.newChangeBuffer({trackRemovals:!0});return(function(c,l,d,h){const m=d.batch,f=m.keys();let w=V.resolve();return f.forEach((k=>{w=w.next((()=>h.getEntry(l,k))).next((C=>{const b=d.docVersions.get(k);ge(b!==null,48541),C.version.compareTo(b)<0&&(m.applyToRemoteDocument(C,d),C.isValidDocument()&&(C.setReadTime(d.commitVersion),h.addEntry(C)))}))})),w.next((()=>c.mutationQueue.removeMutationBatch(l,m)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(c){let l=Me();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(l=l.add(c.batch.mutations[d].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function e0(n){const e=ke(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.hi.getLastRemoteSnapshotVersion(t)))}function gj(n,e){const t=ke(n),r=e.snapshotVersion;let s=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.Os.newChangeBuffer({trackRemovals:!0});s=t.Fs;const c=[];e.targetChanges.forEach(((h,m)=>{const f=s.get(m);if(!f)return;c.push(t.hi.removeMatchingKeys(i,h.removedDocuments,m).next((()=>t.hi.addMatchingKeys(i,h.addedDocuments,m))));let w=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?w=w.withResumeToken(Ut.EMPTY_BYTE_STRING,xe.min()).withLastLimboFreeSnapshotVersion(xe.min()):h.resumeToken.approximateByteSize()>0&&(w=w.withResumeToken(h.resumeToken,r)),s=s.insert(m,w),(function(C,b,N){return C.resumeToken.approximateByteSize()===0||b.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=fj?!0:N.addedDocuments.size+N.modifiedDocuments.size+N.removedDocuments.size>0})(f,w,h)&&c.push(t.hi.updateTargetData(i,w))}));let l=sr(),d=Me();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))})),c.push(yj(i,a,e.documentUpdates).next((h=>{l=h.Ls,d=h.ks}))),!r.isEqual(xe.min())){const h=t.hi.getLastRemoteSnapshotVersion(i).next((m=>t.hi.setTargetsMetadata(i,i.currentSequenceNumber,r)));c.push(h)}return V.waitFor(c).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,d))).next((()=>l))})).then((i=>(t.Fs=s,i)))}function yj(n,e,t){let r=Me(),s=Me();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=sr();return t.forEach(((c,l)=>{const d=i.get(c);l.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(c)),l.isNoDocument()&&l.version.isEqual(xe.min())?(e.removeEntry(c,l.readTime),a=a.insert(c,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(l),a=a.insert(c,l)):X(Fm,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",l.version)})),{Ls:a,ks:s}}))}function xj(n,e){const t=ke(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Fi),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function wj(n,e){const t=ke(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.hi.getTargetData(r,e).next((i=>i?(s=i,V.resolve(s)):t.hi.allocateTargetId(r).next((a=>(s=new ps(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Fs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r}))}async function Ef(n,e,t){const r=ke(n),s=r.Fs.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!gi(a))throw a;X(Fm,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(s.target)}function ix(n,e,t){const r=ke(n);let s=xe.min(),i=Me();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(l,d,h){const m=ke(l),f=m.Ms.get(h);return f!==void 0?V.resolve(m.Fs.get(f)):m.hi.getTargetData(d,h)})(r,a,xr(e)).next((c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(a,c.targetId).next((l=>{i=l}))})).next((()=>r.Cs.getDocumentsMatchingQuery(a,e,t?s:xe.min(),t?i:Me()))).next((c=>(_j(r,cR(e),c),{documents:c,qs:i})))))}function _j(n,e,t){let r=n.xs.get(e)||xe.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.xs.set(e,r)}class ox{constructor(){this.activeTargetIds=mR()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class t0{constructor(){this.Fo=new ox,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new ox,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vj{xo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ax="ConnectivityMonitor";class cx{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){X(ax,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){X(ax,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bl=null;function Nf(){return Bl===null?Bl=(function(){return 268435456+Math.round(2147483648*Math.random())})():Bl++,"0x"+Bl.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kh="RestConnection",bj={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ij{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.Ko=this.databaseId.database===Ru?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,i){const a=Nf(),c=this.Go(e,t.toUriEncodedString());X(kh,`Sending RPC '${e}' ${a}:`,c,r);const l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(l,s,i);const{host:d}=new URL(c),h=Ns(d);return this.jo(e,c,l,r,h).then((m=>(X(kh,`Received RPC '${e}' ${a}: `,m),m)),(m=>{throw ci(kh,`RPC '${e}' ${a} failed with error: `,m,"url: ",c,"request:",r),m}))}Jo(e,t,r,s,i,a){return this.Wo(e,t,r,s,i)}zo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+ga})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}Go(e,t){const r=bj[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tj{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pn="WebChannelConnection";class Ej extends Ij{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,s,i){const a=Nf();return new Promise(((c,l)=>{const d=new _v;d.setWithCredentials(!0),d.listenOnce(vv.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case nu.NO_ERROR:const m=d.getResponseJson();X(pn,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),c(m);break;case nu.TIMEOUT:X(pn,`RPC '${e}' ${a} timed out`),l(new ne($.DEADLINE_EXCEEDED,"Request time out"));break;case nu.HTTP_ERROR:const f=d.getStatus();if(X(pn,`RPC '${e}' ${a} failed with status:`,f,"response text:",d.getResponseText()),f>0){let w=d.getResponseJson();Array.isArray(w)&&(w=w[0]);const k=w?.error;if(k&&k.status&&k.message){const C=(function(N){const I=N.toLowerCase().replace(/_/g,"-");return Object.values($).indexOf(I)>=0?I:$.UNKNOWN})(k.status);l(new ne(C,k.message))}else l(new ne($.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new ne($.UNAVAILABLE,"Connection failed."));break;default:he(9055,{c_:e,streamId:a,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{X(pn,`RPC '${e}' ${a} completed.`)}}));const h=JSON.stringify(s);X(pn,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",h,r,15)}))}P_(e,t,r){const s=Nf(),i=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Tv(),c=Iv(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.zo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");X(pn,`Creating RPC '${e}' stream ${s}: ${h}`,l);const m=a.createWebChannel(h,l);this.T_(m);let f=!1,w=!1;const k=new Tj({Ho:b=>{w?X(pn,`Not sending because RPC '${e}' stream ${s} is closed:`,b):(f||(X(pn,`Opening RPC '${e}' stream ${s} transport.`),m.open(),f=!0),X(pn,`RPC '${e}' stream ${s} sending:`,b),m.send(b))},Yo:()=>m.close()}),C=(b,N,I)=>{b.listen(N,(E=>{try{I(E)}catch(R){setTimeout((()=>{throw R}),0)}}))};return C(m,Ha.EventType.OPEN,(()=>{w||(X(pn,`RPC '${e}' stream ${s} transport opened.`),k.s_())})),C(m,Ha.EventType.CLOSE,(()=>{w||(w=!0,X(pn,`RPC '${e}' stream ${s} transport closed`),k.__(),this.I_(m))})),C(m,Ha.EventType.ERROR,(b=>{w||(w=!0,ci(pn,`RPC '${e}' stream ${s} transport errored. Name:`,b.name,"Message:",b.message),k.__(new ne($.UNAVAILABLE,"The operation could not be completed")))})),C(m,Ha.EventType.MESSAGE,(b=>{var N;if(!w){const I=b.data[0];ge(!!I,16349);const E=I,R=E?.error||((N=E[0])===null||N===void 0?void 0:N.error);if(R){X(pn,`RPC '${e}' stream ${s} received error:`,R);const P=R.status;let O=(function(v){const A=Ot[v];if(A!==void 0)return bb(A)})(P),g=R.message;O===void 0&&(O=$.INTERNAL,g="Unknown error status: "+P+" with message "+R.message),w=!0,k.__(new ne(O,g)),m.close()}else X(pn,`RPC '${e}' stream ${s} received:`,I),k.a_(I)}})),C(c,bv.STAT_EVENT,(b=>{b.stat===sf.PROXY?X(pn,`RPC '${e}' stream ${s} detected buffering proxy`):b.stat===sf.NOPROXY&&X(pn,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{k.o_()}),0),k}terminate(){this.u_.forEach((e=>e.close())),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nj(){return typeof window<"u"?window:null}function hu(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jd(n){return new kR(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bm{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=s,this.A_=i,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),s=Math.max(0,t-r);s>0&&X("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,s,(()=>(this.m_=Date.now(),e()))),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lx="PersistentStream";class n0{constructor(e,t,r,s,i,a,c,l){this.Fi=e,this.w_=r,this.S_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Bm(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,(()=>this.L_())))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===$.RESOURCE_EXHAUSTED?(An(t.toString()),An("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===$.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.b_===t&&this.W_(r,s)}),(r=>{e((()=>{const s=new ne($.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(s)}))}))}W_(e,t){const r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo((()=>{r((()=>this.listener.Zo()))})),this.stream.e_((()=>{r((()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,(()=>(this.x_()&&(this.state=3),Promise.resolve()))),this.listener.e_())))})),this.stream.n_((s=>{r((()=>this.G_(s)))})),this.stream.onMessage((s=>{r((()=>++this.C_==1?this.j_(s):this.onNext(s)))}))}O_(){this.state=5,this.F_.g_((async()=>{this.state=0,this.start()}))}G_(e){return X(lx,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget((()=>this.b_===e?t():(X(lx,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class kj extends n0{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=RR(this.serializer,e),r=(function(i){if(!("targetChange"in i))return xe.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?xe.min():a.readTime?Xt(a.readTime):xe.min()})(e);return this.listener.J_(t,r)}H_(e){const t={};t.database=_f(this.serializer),t.addTarget=(function(i,a){let c;const l=a.target;if(c=ju(l)?{documents:Sb(i,l)}:{query:Rb(i,l).Vt},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Eb(i,a.resumeToken);const d=xf(i,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(xe.min())>0){c.readTime=oa(i,a.snapshotVersion.toTimestamp());const d=xf(i,a.expectedCount);d!==null&&(c.expectedCount=d)}return c})(this.serializer,e);const r=PR(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){const t={};t.database=_f(this.serializer),t.removeTarget=e,this.k_(t)}}class Aj extends n0{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return ge(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ge(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){ge(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=jR(e.writeResults,e.commitTime),r=Xt(e.commitTime);return this.listener.ta(r,t)}na(){const e={};e.database=_f(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>Lc(this.serializer,r)))};this.k_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{}class Sj extends Cj{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ra=!1}ia(){if(this.ra)throw new ne($.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Wo(e,wf(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ne($.UNKNOWN,i.toString())}))}Jo(e,t,r,s,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,c])=>this.connection.Jo(e,wf(t,r),s,a,c,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new ne($.UNKNOWN,a.toString())}))}terminate(){this.ra=!0,this.connection.terminate()}}class Rj{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve()))))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(An(t),this._a=!1):X("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ji="RemoteStore";class jj{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=i,this.Ea.xo((a=>{r.enqueueAndForget((async()=>{co(this)&&(X(Ji,"Restarting streams for network reachability change."),await(async function(l){const d=ke(l);d.Ia.add(4),await ol(d),d.Aa.set("Unknown"),d.Ia.delete(4),await Pd(d)})(this))}))})),this.Aa=new Rj(r,s)}}async function Pd(n){if(co(n))for(const e of n.da)await e(!0)}async function ol(n){for(const e of n.da)await e(!1)}function r0(n,e){const t=ke(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),Hm(t)?qm(t):wa(t).x_()&&$m(t,e))}function zm(n,e){const t=ke(n),r=wa(t);t.Ta.delete(e),r.x_()&&s0(t,e),t.Ta.size===0&&(r.x_()?r.B_():co(t)&&t.Aa.set("Unknown"))}function $m(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(xe.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}wa(n).H_(e)}function s0(n,e){n.Ra.$e(e),wa(n).Y_(e)}function qm(n){n.Ra=new IR({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),wa(n).start(),n.Aa.aa()}function Hm(n){return co(n)&&!wa(n).M_()&&n.Ta.size>0}function co(n){return ke(n).Ia.size===0}function i0(n){n.Ra=void 0}async function Pj(n){n.Aa.set("Online")}async function Dj(n){n.Ta.forEach(((e,t)=>{$m(n,e)}))}async function Oj(n,e){i0(n),Hm(n)?(n.Aa.la(e),qm(n)):n.Aa.set("Unknown")}async function Lj(n,e,t){if(n.Aa.set("Online"),e instanceof Tb&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const c of i.targetIds)s.Ta.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.Ta.delete(c),s.Ra.removeTarget(c))})(n,e)}catch(r){X(Ji,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Uu(n,r)}else if(e instanceof uu?n.Ra.Ye(e):e instanceof Ib?n.Ra.it(e):n.Ra.et(e),!t.isEqual(xe.min()))try{const r=await e0(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const c=i.Ra.Pt(a);return c.targetChanges.forEach(((l,d)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ta.get(d);h&&i.Ta.set(d,h.withResumeToken(l.resumeToken,a))}})),c.targetMismatches.forEach(((l,d)=>{const h=i.Ta.get(l);if(!h)return;i.Ta.set(l,h.withResumeToken(Ut.EMPTY_BYTE_STRING,h.snapshotVersion)),s0(i,l);const m=new ps(h.target,l,d,h.sequenceNumber);$m(i,m)})),i.remoteSyncer.applyRemoteEvent(c)})(n,t)}catch(r){X(Ji,"Failed to raise snapshot:",r),await Uu(n,r)}}async function Uu(n,e,t){if(!gi(e))throw e;n.Ia.add(1),await ol(n),n.Aa.set("Offline"),t||(t=()=>e0(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{X(Ji,"Retrying IndexedDB access"),await t(),n.Ia.delete(1),await Pd(n)}))}function o0(n,e){return e().catch((t=>Uu(n,t,e)))}async function al(n){const e=ke(n),t=di(e);let r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Fi;for(;Vj(e);)try{const s=await xj(e.localStore,r);if(s===null){e.Pa.length===0&&t.B_();break}r=s.batchId,Mj(e,s)}catch(s){await Uu(e,s)}a0(e)&&c0(e)}function Vj(n){return co(n)&&n.Pa.length<10}function Mj(n,e){n.Pa.push(e);const t=di(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function a0(n){return co(n)&&!di(n).M_()&&n.Pa.length>0}function c0(n){di(n).start()}async function Uj(n){di(n).na()}async function Fj(n){const e=di(n);for(const t of n.Pa)e.X_(t.mutations)}async function Bj(n,e,t){const r=n.Pa.shift(),s=Sm.from(r,e,t);await o0(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await al(n)}async function zj(n,e){e&&di(n).Z_&&await(async function(r,s){if((function(a){return vb(a)&&a!==$.ABORTED})(s.code)){const i=r.Pa.shift();di(r).N_(),await o0(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await al(r)}})(n,e),a0(n)&&c0(n)}async function ux(n,e){const t=ke(n);t.asyncQueue.verifyOperationInProgress(),X(Ji,"RemoteStore received new credentials");const r=co(t);t.Ia.add(3),await ol(t),r&&t.Aa.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),await Pd(t)}async function $j(n,e){const t=ke(n);e?(t.Ia.delete(2),await Pd(t)):e||(t.Ia.add(2),await ol(t),t.Aa.set("Unknown"))}function wa(n){return n.Va||(n.Va=(function(t,r,s){const i=ke(t);return i.ia(),new kj(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Zo:Pj.bind(null,n),e_:Dj.bind(null,n),n_:Oj.bind(null,n),J_:Lj.bind(null,n)}),n.da.push((async e=>{e?(n.Va.N_(),Hm(n)?qm(n):n.Aa.set("Unknown")):(await n.Va.stop(),i0(n))}))),n.Va}function di(n){return n.ma||(n.ma=(function(t,r,s){const i=ke(t);return i.ia(),new Aj(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:Uj.bind(null,n),n_:zj.bind(null,n),ea:Fj.bind(null,n),ta:Bj.bind(null,n)}),n.da.push((async e=>{e?(n.ma.N_(),await al(n)):(await n.ma.stop(),n.Pa.length>0&&(X(Ji,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Rr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,c=new Wm(e,t,a,s,i);return c.start(r),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ne($.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gm(n,e){if(An("AsyncQueue",`${e}: ${n}`),gi(n))return new ne($.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{static emptySet(e){return new zo(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||ce.comparator(t.key,r.key):(t,r)=>ce.comparator(t.key,r.key),this.keyedMap=Wa(),this.sortedSet=new bt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof zo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new zo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dx{constructor(){this.fa=new bt(ce.comparator)}track(e){const t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):he(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal(((t,r)=>{e.push(r)})),e}}class aa{constructor(e,t,r,s,i,a,c,l,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((c=>{a.push({type:0,doc:c})})),new aa(e,t,zo.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Td(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qj{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some((e=>e.ba()))}}class Hj{constructor(){this.queries=hx(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){const s=ke(t),i=s.queries;s.queries=hx(),i.forEach(((a,c)=>{for(const l of c.wa)l.onError(r)}))})(this,new ne($.ABORTED,"Firestore shutting down"))}}function hx(){return new As((n=>cb(n)),Td)}async function Km(n,e){const t=ke(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.Sa()&&e.ba()&&(r=2):(i=new qj,r=e.ba()?0:1);try{switch(r){case 0:i.ya=await t.onListen(s,!0);break;case 1:i.ya=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const c=Gm(a,`Initialization of query '${Ro(e.query)}' failed`);return void e.onError(c)}t.queries.set(s,i),i.wa.push(e),e.va(t.onlineState),i.ya&&e.Ca(i.ya)&&Ym(t)}async function Qm(n,e){const t=ke(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.wa.indexOf(e);a>=0&&(i.wa.splice(a,1),i.wa.length===0?s=e.ba()?0:1:!i.Sa()&&e.ba()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Wj(n,e){const t=ke(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const c of a.wa)c.Ca(s)&&(r=!0);a.ya=s}}r&&Ym(t)}function Gj(n,e,t){const r=ke(n),s=r.queries.get(e);if(s)for(const i of s.wa)i.onError(t);r.queries.delete(e)}function Ym(n){n.Da.forEach((e=>{e.next()}))}var kf,fx;(fx=kf||(kf={})).Fa="default",fx.Cache="cache";class Xm{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new aa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;const r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;const t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=aa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==kf.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0{constructor(e){this.key=e}}class u0{constructor(e){this.key=e}}class Kj{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Me(),this.mutatedKeys=Me(),this.Xa=lb(e),this.eu=new zo(this.Xa)}get tu(){return this.Ha}nu(e,t){const r=t?t.ru:new dx,s=t?t.eu:this.eu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,c=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((h,m)=>{const f=s.get(h),w=rl(this.query,m)?m:null,k=!!f&&this.mutatedKeys.has(f.key),C=!!w&&(w.hasLocalMutations||this.mutatedKeys.has(w.key)&&w.hasCommittedMutations);let b=!1;f&&w?f.data.isEqual(w.data)?k!==C&&(r.track({type:3,doc:w}),b=!0):this.iu(f,w)||(r.track({type:2,doc:w}),b=!0,(l&&this.Xa(w,l)>0||d&&this.Xa(w,d)<0)&&(c=!0)):!f&&w?(r.track({type:0,doc:w}),b=!0):f&&!w&&(r.track({type:1,doc:f}),b=!0,(l||d)&&(c=!0)),b&&(w?(a=a.add(w),i=C?i.add(h):i.delete(h)):(a=a.delete(h),i=i.delete(h)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{eu:a,ru:r,Ds:c,mutatedKeys:i}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const a=e.ru.pa();a.sort(((h,m)=>(function(w,k){const C=b=>{switch(b){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return he(20277,{At:b})}};return C(w)-C(k)})(h.type,m.type)||this.Xa(h.doc,m.doc))),this.su(r),s=s!=null&&s;const c=t&&!s?this.ou():[],l=this.Za.size===0&&this.current&&!s?1:0,d=l!==this.Ya;return this.Ya=l,a.length!==0||d?{snapshot:new aa(this.query,e.eu,i,a,e.mutatedKeys,l===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:c}:{_u:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new dx,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach((t=>this.Ha=this.Ha.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ha=this.Ha.delete(t))),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=Me(),this.eu.forEach((r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))}));const t=[];return e.forEach((r=>{this.Za.has(r)||t.push(new u0(r))})),this.Za.forEach((r=>{e.has(r)||t.push(new l0(r))})),t}uu(e){this.Ha=e.qs,this.Za=Me();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return aa.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}}const Jm="SyncEngine";class Qj{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Yj{constructor(e){this.key=e,this.lu=!1}}class Xj{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new As((c=>cb(c)),Td),this.Tu=new Map,this.Iu=new Set,this.du=new bt(ce.comparator),this.Eu=new Map,this.Au=new Lm,this.Ru={},this.Vu=new Map,this.mu=Xi.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function Jj(n,e,t=!0){const r=g0(n);let s;const i=r.Pu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.cu()):s=await d0(r,e,t,!0),s}async function Zj(n,e){const t=g0(n);await d0(t,e,!0,!1)}async function d0(n,e,t,r){const s=await wj(n.localStore,xr(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let c;return r&&(c=await eP(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&r0(n.remoteStore,s),c}async function eP(n,e,t,r,s){n.gu=(m,f,w)=>(async function(C,b,N,I){let E=b.view.nu(N);E.Ds&&(E=await ix(C.localStore,b.query,!1).then((({documents:g})=>b.view.nu(g,E))));const R=I&&I.targetChanges.get(b.targetId),P=I&&I.targetMismatches.get(b.targetId)!=null,O=b.view.applyChanges(E,C.isPrimaryClient,R,P);return px(C,b.targetId,O._u),O.snapshot})(n,m,f,w);const i=await ix(n.localStore,e,!0),a=new Kj(e,i.qs),c=a.nu(i.documents),l=il.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(c,n.isPrimaryClient,l);px(n,t,d._u);const h=new Qj(e,t,a);return n.Pu.set(e,h),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),d.snapshot}async function tP(n,e,t){const r=ke(n),s=r.Pu.get(e),i=r.Tu.get(s.targetId);if(i.length>1)return r.Tu.set(s.targetId,i.filter((a=>!Td(a,e)))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ef(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&zm(r.remoteStore,s.targetId),Af(r,s.targetId)})).catch(ao)):(Af(r,s.targetId),await Ef(r.localStore,s.targetId,!0))}async function nP(n,e){const t=ke(n),r=t.Pu.get(e),s=t.Tu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),zm(t.remoteStore,r.targetId))}async function rP(n,e,t){const r=y0(n);try{const s=await(function(a,c){const l=ke(a),d=nt.now(),h=c.reduce(((w,k)=>w.add(k.key)),Me());let m,f;return l.persistence.runTransaction("Locally write mutations","readwrite",(w=>{let k=sr(),C=Me();return l.Os.getEntries(w,h).next((b=>{k=b,k.forEach(((N,I)=>{I.isValidDocument()||(C=C.add(N))}))})).next((()=>l.localDocuments.getOverlayedDocuments(w,k))).next((b=>{m=b;const N=[];for(const I of c){const E=_R(I,m.get(I.key).overlayedDocument);E!=null&&N.push(new Cs(I.key,E,Zv(E.value.mapValue),Ct.exists(!0)))}return l.mutationQueue.addMutationBatch(w,d,N,c)})).next((b=>{f=b;const N=b.applyToLocalDocumentSet(m,C);return l.documentOverlayCache.saveOverlays(w,b.batchId,N)}))})).then((()=>({batchId:f.batchId,changes:db(m)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,c,l){let d=a.Ru[a.currentUser.toKey()];d||(d=new bt(Ee)),d=d.insert(c,l),a.Ru[a.currentUser.toKey()]=d})(r,s.batchId,t),await cl(r,s.changes),await al(r.remoteStore)}catch(s){const i=Gm(s,"Failed to persist write");t.reject(i)}}async function h0(n,e){const t=ke(n);try{const r=await gj(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Eu.get(i);a&&(ge(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.lu=!0:s.modifiedDocuments.size>0?ge(a.lu,14607):s.removedDocuments.size>0&&(ge(a.lu,42227),a.lu=!1))})),await cl(t,r,e)}catch(r){await ao(r)}}function mx(n,e,t){const r=ke(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Pu.forEach(((i,a)=>{const c=a.view.va(e);c.snapshot&&s.push(c.snapshot)})),(function(a,c){const l=ke(a);l.onlineState=c;let d=!1;l.queries.forEach(((h,m)=>{for(const f of m.wa)f.va(c)&&(d=!0)})),d&&Ym(l)})(r.eventManager,e),s.length&&r.hu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function sP(n,e,t){const r=ke(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Eu.get(e),i=s&&s.key;if(i){let a=new bt(ce.comparator);a=a.insert(i,vt.newNoDocument(i,xe.min()));const c=Me().add(i),l=new Ad(xe.min(),new Map,new bt(Ee),a,c);await h0(r,l),r.du=r.du.remove(i),r.Eu.delete(e),Zm(r)}else await Ef(r.localStore,e,!1).then((()=>Af(r,e,t))).catch(ao)}async function iP(n,e){const t=ke(n),r=e.batch.batchId;try{const s=await pj(t.localStore,e);m0(t,r,null),f0(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await cl(t,s)}catch(s){await ao(s)}}async function oP(n,e,t){const r=ke(n);try{const s=await(function(a,c){const l=ke(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let h;return l.mutationQueue.lookupMutationBatch(d,c).next((m=>(ge(m!==null,37113),h=m.keys(),l.mutationQueue.removeMutationBatch(d,m)))).next((()=>l.mutationQueue.performConsistencyCheck(d))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(d,h,c))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h))).next((()=>l.localDocuments.getDocuments(d,h)))}))})(r.localStore,e);m0(r,e,t),f0(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await cl(r,s)}catch(s){await ao(s)}}function f0(n,e){(n.Vu.get(e)||[]).forEach((t=>{t.resolve()})),n.Vu.delete(e)}function m0(n,e,t){const r=ke(n);let s=r.Ru[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ru[r.currentUser.toKey()]=s}}function Af(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach((r=>{n.Au.containsKey(r)||p0(n,r)}))}function p0(n,e){n.Iu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(zm(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),Zm(n))}function px(n,e,t){for(const r of t)r instanceof l0?(n.Au.addReference(r.key,e),aP(n,r)):r instanceof u0?(X(Jm,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||p0(n,r.key)):he(19791,{yu:r})}function aP(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(X(Jm,"New document in limbo: "+t),n.Iu.add(r),Zm(n))}function Zm(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Iu.values().next().value;n.Iu.delete(e);const t=new ce(Qe.fromString(e)),r=n.mu.next();n.Eu.set(r,new Yj(t)),n.du=n.du.insert(t,r),r0(n.remoteStore,new ps(xr(nl(t.path)),r,"TargetPurposeLimboResolution",mr.ue))}}async function cl(n,e,t){const r=ke(n),s=[],i=[],a=[];r.Pu.isEmpty()||(r.Pu.forEach(((c,l)=>{a.push(r.gu(l,e,t).then((d=>{var h;if((d||t)&&r.isPrimaryClient){const m=d?!d.fromCache:(h=t?.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(d){s.push(d);const m=Um.Es(l.targetId,d);i.push(m)}})))})),await Promise.all(a),r.hu.J_(s),await(async function(l,d){const h=ke(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>V.forEach(d,(f=>V.forEach(f.Is,(w=>h.persistence.referenceDelegate.addReference(m,f.targetId,w))).next((()=>V.forEach(f.ds,(w=>h.persistence.referenceDelegate.removeReference(m,f.targetId,w)))))))))}catch(m){if(!gi(m))throw m;X(Fm,"Failed to update sequence numbers: "+m)}for(const m of d){const f=m.targetId;if(!m.fromCache){const w=h.Fs.get(f),k=w.snapshotVersion,C=w.withLastLimboFreeSnapshotVersion(k);h.Fs=h.Fs.insert(f,C)}}})(r.localStore,i))}async function cP(n,e){const t=ke(n);if(!t.currentUser.isEqual(e)){X(Jm,"User change. New user:",e.toKey());const r=await Zb(t.localStore,e);t.currentUser=e,(function(i,a){i.Vu.forEach((c=>{c.forEach((l=>{l.reject(new ne($.CANCELLED,a))}))})),i.Vu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await cl(t,r.Bs)}}function lP(n,e){const t=ke(n),r=t.Eu.get(e);if(r&&r.lu)return Me().add(r.key);{let s=Me();const i=t.Tu.get(e);if(!i)return s;for(const a of i){const c=t.Pu.get(a);s=s.unionWith(c.view.tu)}return s}}function g0(n){const e=ke(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=h0.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=sP.bind(null,e),e.hu.J_=Wj.bind(null,e.eventManager),e.hu.pu=Gj.bind(null,e.eventManager),e}function y0(n){const e=ke(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=iP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=oP.bind(null,e),e}class Vc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=jd(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return Jb(this.persistence,new Xb,e.initialUser,this.serializer)}Du(e){return new Vm(Rd.Vi,this.serializer)}bu(e){return new t0}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Vc.provider={build:()=>new Vc};class uP extends Vc{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){ge(this.persistence.referenceDelegate instanceof Mu,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Wb(r,e.asyncQueue,t)}Du(e){const t=this.cacheSizeBytes!==void 0?gn.withCacheSize(this.cacheSizeBytes):gn.DEFAULT;return new Vm((r=>Mu.Vi(r,t)),this.serializer)}}class dP extends Vc{constructor(e,t,r){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Mu.initialize(this,e),await y0(this.Mu.syncEngine),await al(this.Mu.remoteStore),await this.persistence.ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return Jb(this.persistence,new Xb,e.initialUser,this.serializer)}Cu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new Wb(r,e.asyncQueue,t)}Fu(e,t){const r=new _S(t,this.persistence);return new wS(e.asyncQueue,r)}Du(e){const t=dj(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?gn.withCacheSize(this.cacheSizeBytes):gn.DEFAULT;return new Mm(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Nj(),hu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new t0}}class Fu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>mx(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=cP.bind(null,this.syncEngine),await $j(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Hj})()}createDatastore(e){const t=jd(e.databaseInfo.databaseId),r=(function(i){return new Ej(i)})(e.databaseInfo);return(function(i,a,c,l){return new Sj(i,a,c,l)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,c){return new jj(r,s,i,a,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>mx(this.syncEngine,t,0)),(function(){return cx.C()?new cx:new vj})())}createSyncEngine(e,t){return(function(s,i,a,c,l,d,h){const m=new Xj(s,i,a,c,l,d);return h&&(m.fu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(s){const i=ke(s);X(Ji,"RemoteStore shutting down."),i.Ia.add(5),await ol(i),i.Ea.shutdown(),i.Aa.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Fu.provider={build:()=>new Fu};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):An("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ne($.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(s,i){const a=ke(s),c={documents:i.map((m=>Oc(a.serializer,m)))},l=await a.Jo("BatchGetDocuments",a.serializer.databaseId,Qe.emptyPath(),c,i.length),d=new Map;l.forEach((m=>{const f=SR(a.serializer,m);d.set(f.key.toString(),f)}));const h=[];return i.forEach((m=>{const f=d.get(m.toString());ge(!!f,55234,{key:m}),h.push(f)})),h})(this.datastore,e);return t.forEach((r=>this.recordVersion(r))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new sl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,r)=>{const s=ce.fromPath(r);this.mutations.push(new Am(s,this.precondition(s)))})),await(async function(r,s){const i=ke(r),a={writes:s.map((c=>Lc(i.serializer,c)))};await i.Wo("Commit",i.serializer.databaseId,Qe.emptyPath(),a)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw he(50498,{Wu:e.constructor.name});t=xe.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new ne($.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(xe.min())?Ct.exists(!1):Ct.updateTime(t):Ct.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(xe.min()))throw new ne($.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ct.updateTime(t)}return Ct.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fP{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.Gu=r.maxAttempts,this.F_=new Bm(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_((async()=>{const e=new hP(this.datastore),t=this.Ju(e);t&&t.then((r=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(r)})).catch((s=>{this.Hu(s)}))))})).catch((r=>{this.Hu(r)}))}))}Ju(e){try{const t=this.updateFunction(e);return!Zc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget((()=>(this.ju(),Promise.resolve())))):this.deferred.reject(e)}Yu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!vb(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hi="FirestoreClient";class mP{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=kn.UNAUTHENTICATED,this.clientId=gm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{X(hi,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(X(hi,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Rr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Gm(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Ah(n,e){n.asyncQueue.verifyOperationInProgress(),X(hi,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Zb(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>{ci("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then((()=>{X("Terminating Firestore due to IndexedDb database deletion completed successfully")})).catch((s=>{ci("Terminating Firestore due to IndexedDb database deletion failed",s)}))})),n._offlineComponents=e}async function gx(n,e){n.asyncQueue.verifyOperationInProgress();const t=await pP(n);X(hi,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>ux(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>ux(e.remoteStore,s))),n._onlineComponents=e}async function pP(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){X(hi,"Using user provided OfflineComponentProvider");try{await Ah(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===$.FAILED_PRECONDITION||s.code===$.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;ci("Error using user provided cache. Falling back to memory cache: "+t),await Ah(n,new Vc)}}else X(hi,"Using default OfflineComponentProvider"),await Ah(n,new uP(void 0));return n._offlineComponents}async function tp(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(X(hi,"Using user provided OnlineComponentProvider"),await gx(n,n._uninitializedComponentsProvider._online)):(X(hi,"Using default OnlineComponentProvider"),await gx(n,new Fu))),n._onlineComponents}function gP(n){return tp(n).then((e=>e.syncEngine))}function yP(n){return tp(n).then((e=>e.datastore))}async function Bu(n){const e=await tp(n),t=e.eventManager;return t.onListen=Jj.bind(null,e.syncEngine),t.onUnlisten=tP.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Zj.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=nP.bind(null,e.syncEngine),t}function xP(n,e,t={}){const r=new Rr;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,c,l,d){const h=new ep({next:f=>{h.Ou(),a.enqueueAndForget((()=>Qm(i,m)));const w=f.docs.has(c);!w&&f.fromCache?d.reject(new ne($.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&f.fromCache&&l&&l.source==="server"?d.reject(new ne($.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(f)},error:f=>d.reject(f)}),m=new Xm(nl(c.path),h,{includeMetadataChanges:!0,ka:!0});return Km(i,m)})(await Bu(n),n.asyncQueue,e,t,r))),r.promise}function wP(n,e,t={}){const r=new Rr;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,c,l,d){const h=new ep({next:f=>{h.Ou(),a.enqueueAndForget((()=>Qm(i,m))),f.fromCache&&l.source==="server"?d.reject(new ne($.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(f)},error:f=>d.reject(f)}),m=new Xm(c,h,{includeMetadataChanges:!0,ka:!0});return Km(i,m)})(await Bu(n),n.asyncQueue,e,t,r))),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x0(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yx=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _P="firestore.googleapis.com",xx=!0;class wx{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ne($.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=_P,this.ssl=xx}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:xx;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Bb;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Hb)throw new ne($.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}mS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=x0((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ne($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ne($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ne($.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class np{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new wx({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ne($.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ne($.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new wx(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new oS;switch(r.type){case"firstParty":return new lS(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ne($.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=yx.get(t);r&&(X("ComponentProvider","Removing Datastore"),yx.delete(t),r.terminate())})(this),Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ss(this.firestore,e,this._query)}}class Tt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new si(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Tt(this.firestore,e,this._key)}toJSON(){return{type:Tt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Jc(t,Tt._jsonSchema))return new Tt(e,r||null,new ce(Qe.fromString(t.referencePath)))}}Tt._jsonSchemaVersion="firestore/documentReference/1.0",Tt._jsonSchema={type:Mt("string",Tt._jsonSchemaVersion),referencePath:Mt("string")};class si extends Ss{constructor(e,t,r){super(e,t,nl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Tt(this.firestore,null,new ce(e))}withConverter(e){return new si(this.firestore,e,this._path)}}function St(n,e,...t){if(n=Ne(n),Av("collection","path",e),n instanceof np){const r=Qe.fromString(e,...t);return ly(r),new si(n,null,r)}{if(!(n instanceof Tt||n instanceof si))throw new ne($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Qe.fromString(e,...t));return ly(r),new si(n.firestore,null,r)}}function Se(n,e,...t){if(n=Ne(n),arguments.length===1&&(e=gm.newId()),Av("doc","path",e),n instanceof np){const r=Qe.fromString(e,...t);return cy(r),new Tt(n,null,new ce(r))}{if(!(n instanceof Tt||n instanceof si))throw new ne($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Qe.fromString(e,...t));return cy(r),new Tt(n.firestore,n instanceof si?n.converter:null,new ce(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _x="AsyncQueue";class vx{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Bm(this,"async_queue_retry"),this.oc=()=>{const r=hu();r&&X(_x,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;const t=hu();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=hu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise((()=>{}));const t=new Rr;return this.uc((()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Zu.push(e),this.cc())))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!gi(e))throw e;X(_x,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_((()=>this.cc()))}}uc(e){const t=this._c.then((()=>(this.nc=!0,e().catch((r=>{throw this.tc=r,this.nc=!1,An("INTERNAL UNHANDLED ERROR: ",bx(r)),r})).then((r=>(this.nc=!1,r))))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const s=Wm.createAndSchedule(this,e,t,r,(i=>this.lc(i)));return this.ec.push(s),s}ac(){this.tc&&he(47125,{hc:bx(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then((()=>{this.ec.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()}))}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function bx(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ix(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1})(n,["next","error","complete"])}class Jr extends np{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new vx,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new vx(e),this._firestoreClient=void 0,await e}}}function vP(n,e,t){t||(t=Ru);const r=Or(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(xs(i,e))return s;throw new ne($.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new ne($.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Hb)throw new ne($.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Ns(e.host)&&id(e.host),r.initialize({options:e,instanceIdentifier:t})}function ll(n){if(n._terminated)throw new ne($.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||bP(n),n._firestoreClient}function bP(n){var e,t,r;const s=n._freezeSettings(),i=(function(c,l,d,h){return new QS(c,l,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,x0(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new mP(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&(function(c){const l=c?._online.build();return{_offline:c?._offline.build(l),_online:l}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new nr(Ut.fromBase64String(e))}catch(t){throw new ne($.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new nr(Ut.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:nr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Jc(e,nr._jsonSchema))return nr.fromBase64String(e.bytes)}}nr._jsonSchemaVersion="firestore/bytes/1.0",nr._jsonSchema={type:Mt("string",nr._jsonSchemaVersion),bytes:Mt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ne($.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new It(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ne($.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ne($.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ee(this._lat,e._lat)||Ee(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Kr._jsonSchemaVersion}}static fromJSON(e){if(Jc(e,Kr._jsonSchema))return new Kr(e.latitude,e.longitude)}}Kr._jsonSchemaVersion="firestore/geoPoint/1.0",Kr._jsonSchema={type:Mt("string",Kr._jsonSchemaVersion),latitude:Mt("number"),longitude:Mt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Qr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Jc(e,Qr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Qr(e.vectorValues);throw new ne($.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Qr._jsonSchemaVersion="firestore/vectorValue/1.0",Qr._jsonSchema={type:Mt("string",Qr._jsonSchemaVersion),vectorValues:Mt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP=/^__.*__$/;class TP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Cs(e,this.data,this.fieldMask,t,this.fieldTransforms):new xa(e,this.data,t,this.fieldTransforms)}}class w0{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Cs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function _0(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw he(40011,{Ec:n})}}class Dd{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Ac(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new Dd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Rc({path:r,mc:!1});return s.fc(e),s}gc(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Rc({path:r,mc:!1});return s.Ac(),s}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return zu(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(_0(this.Ec)&&IP.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class EP{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||jd(e)}Dc(e,t,r,s=!1){return new Dd({Ec:e,methodName:t,bc:r,path:It.emptyPath(),mc:!1,Sc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dl(n){const e=n._freezeSettings(),t=jd(n._databaseId);return new EP(n._databaseId,!!e.ignoreUndefinedProperties,t)}function rp(n,e,t,r,s,i={}){const a=n.Dc(i.merge||i.mergeFields?2:0,e,t,s);ap("Data must be an object, but it was:",a,r);const c=I0(r,a);let l,d;if(i.merge)l=new Vn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const h=[];for(const m of i.mergeFields){const f=Cf(e,m,t);if(!a.contains(f))throw new ne($.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);E0(h,f)||h.push(f)}l=new Vn(h),d=a.fieldTransforms.filter((m=>l.covers(m.field)))}else l=null,d=a.fieldTransforms;return new TP(new rn(c),l,d)}class Od extends _a{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Od}}function NP(n,e,t){return new Dd({Ec:3,bc:e.settings.bc,methodName:n._methodName,mc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class sp extends _a{_toFieldTransform(e){return new Nd(e.path,new ra)}isEqual(e){return e instanceof sp}}class ip extends _a{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=NP(this,e,!0),r=this.vc.map((i=>va(i,t))),s=new Ki(r);return new Nd(e.path,s)}isEqual(e){return e instanceof ip&&xs(this.vc,e.vc)}}class op extends _a{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){const t=new ia(e.serializer,mb(e.serializer,this.Cc));return new Nd(e.path,t)}isEqual(e){return e instanceof op&&this.Cc===e.Cc}}function v0(n,e,t,r){const s=n.Dc(1,e,t);ap("Data must be an object, but it was:",s,r);const i=[],a=rn.empty();yi(r,((l,d)=>{const h=cp(e,l,t);d=Ne(d);const m=s.gc(h);if(d instanceof Od)i.push(h);else{const f=va(d,m);f!=null&&(i.push(h),a.set(h,f))}}));const c=new Vn(i);return new w0(a,c,s.fieldTransforms)}function b0(n,e,t,r,s,i){const a=n.Dc(1,e,t),c=[Cf(e,r,t)],l=[s];if(i.length%2!=0)throw new ne($.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)c.push(Cf(e,i[f])),l.push(i[f+1]);const d=[],h=rn.empty();for(let f=c.length-1;f>=0;--f)if(!E0(d,c[f])){const w=c[f];let k=l[f];k=Ne(k);const C=a.gc(w);if(k instanceof Od)d.push(w);else{const b=va(k,C);b!=null&&(d.push(w),h.set(w,b))}}const m=new Vn(d);return new w0(h,m,a.fieldTransforms)}function kP(n,e,t,r=!1){return va(t,n.Dc(r?4:3,e))}function va(n,e){if(T0(n=Ne(n)))return ap("Unsupported field value:",e,n),I0(n,e);if(n instanceof _a)return(function(r,s){if(!_0(s.Ec))throw s.wc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.wc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const c of r){let l=va(c,s.yc(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=Ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return mb(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=nt.fromDate(r);return{timestampValue:oa(s.serializer,i)}}if(r instanceof nt){const i=new nt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:oa(s.serializer,i)}}if(r instanceof Kr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof nr)return{bytesValue:Eb(s.serializer,r._byteString)};if(r instanceof Tt){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Pm(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Qr)return(function(a,c){return{mapValue:{fields:{[Tm]:{stringValue:Em},[Zo]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw c.wc("VectorValues must only contain numeric values.");return km(c.serializer,d)}))}}}}}})(r,s);throw s.wc(`Unsupported field value: ${yd(r)}`)})(n,e)}function I0(n,e){const t={};return qv(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):yi(n,((r,s)=>{const i=va(s,e.Vc(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function T0(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof nt||n instanceof Kr||n instanceof nr||n instanceof Tt||n instanceof _a||n instanceof Qr)}function ap(n,e,t){if(!T0(t)||!Cv(t)){const r=yd(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function Cf(n,e,t){if((e=Ne(e))instanceof ul)return e._internalPath;if(typeof e=="string")return cp(n,e);throw zu("Field path arguments must be of type string or ",n,!1,void 0,t)}const AP=new RegExp("[~\\*/\\[\\]]");function cp(n,e,t){if(e.search(AP)>=0)throw zu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ul(...e.split("."))._internalPath}catch{throw zu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function zu(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${r}`),a&&(l+=` in document ${s}`),l+=")"),new ne($.INVALID_ARGUMENT,c+n+l)}function E0(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $u{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Tt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new CP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ld("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class CP extends $u{data(){return super.data()}}function Ld(n,e){return typeof e=="string"?cp(n,e):e instanceof ul?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N0(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ne($.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class lp{}class up extends lp{}function zn(n,e,...t){let r=[];e instanceof lp&&r.push(e),r=r.concat(t),(function(i){const a=i.filter((l=>l instanceof dp)).length,c=i.filter((l=>l instanceof Vd)).length;if(a>1||a>0&&c>0)throw new ne($.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class Vd extends up{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Vd(e,t,r)}_apply(e){const t=this._parse(e);return k0(e._query,t),new Ss(e.firestore,e.converter,yf(e._query,t))}_parse(e){const t=dl(e.firestore);return(function(i,a,c,l,d,h,m){let f;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new ne($.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){Ex(m,h);const k=[];for(const C of m)k.push(Tx(l,i,C));f={arrayValue:{values:k}}}else f=Tx(l,i,m)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||Ex(m,h),f=kP(c,a,m,h==="in"||h==="not-in");return Be.create(d,h,f)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function jr(n,e,t){const r=e,s=Ld("where",n);return Vd._create(s,r,t)}class dp extends lp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new dp(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:rt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,i){let a=s;const c=i.getFlattenedFilters();for(const l of c)k0(a,l),a=yf(a,l)})(e._query,t),new Ss(e.firestore,e.converter,yf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class hp extends up{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new hp(e,t)}_apply(e){const t=(function(s,i,a){if(s.startAt!==null)throw new ne($.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ne($.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Dc(i,a)})(e._query,this._field,this._direction);return new Ss(e.firestore,e.converter,(function(s,i){const a=s.explicitOrderBy.concat([i]);return new ya(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(e._query,t))}}function fp(n,e="asc"){const t=e,r=Ld("orderBy",n);return hp._create(r,t)}class mp extends up{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new mp(e,t,r)}_apply(e){return new Ss(e.firestore,e.converter,Du(e._query,this._limit,this._limitType))}}function Md(n){return pS("limit",n),mp._create("limit",n,"F")}function Tx(n,e,t){if(typeof(t=Ne(t))=="string"){if(t==="")throw new ne($.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ab(e)&&t.indexOf("/")!==-1)throw new ne($.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Qe.fromString(t));if(!ce.isDocumentKey(r))throw new ne($.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return jc(n,new ce(r))}if(t instanceof Tt)return jc(n,t._key);throw new ne($.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${yd(t)}.`)}function Ex(n,e){if(!Array.isArray(n)||n.length===0)throw new ne($.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function k0(n,e){const t=(function(s,i){for(const a of s)for(const c of a.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new ne($.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ne($.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class A0{convertValue(e,t="none"){switch(li(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _t(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Is(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw he(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return yi(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t[Zo].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map((a=>_t(a.doubleValue)));return new Qr(i)}convertGeoPoint(e){return new Kr(_t(e.latitude),_t(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=bd(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Sc(e));default:return null}}convertTimestamp(e){const t=bs(e);return new nt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Qe.fromString(e);ge(Ob(r),9688,{name:e});const s=new Wi(r.get(1),r.get(3)),i=new ce(r.popFirst(5));return s.isEqual(t)||An(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pp(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class SP extends A0{constructor(e){super(),this.firestore=e}convertBytes(e){return new nr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Tt(this.firestore,null,t)}}class Oo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ii extends $u{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new fu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ld("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ne($.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=ii._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}ii._jsonSchemaVersion="firestore/documentSnapshot/1.0",ii._jsonSchema={type:Mt("string",ii._jsonSchemaVersion),bundleSource:Mt("string","DocumentSnapshot"),bundleName:Mt("string"),bundle:Mt("string")};class fu extends ii{data(e={}){return super.data(e)}}class zi{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Oo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new fu(this._firestore,this._userDataWriter,r.key,r,new Oo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ne($.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((c=>{const l=new fu(s._firestore,s._userDataWriter,c.doc.key,c.doc,new Oo(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((c=>i||c.type!==3)).map((c=>{const l=new fu(s._firestore,s._userDataWriter,c.doc.key,c.doc,new Oo(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),h=a.indexOf(c.doc.key)),{type:RP(c.type),doc:l,oldIndex:d,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ne($.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=zi._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=gm.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function RP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return he(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qn(n){n=Bn(n,Tt);const e=Bn(n.firestore,Jr);return xP(ll(e),n._key).then((t=>C0(e,n,t)))}zi._jsonSchemaVersion="firestore/querySnapshot/1.0",zi._jsonSchema={type:Mt("string",zi._jsonSchemaVersion),bundleSource:Mt("string","QuerySnapshot"),bundleName:Mt("string"),bundle:Mt("string")};class Ud extends A0{constructor(e){super(),this.firestore=e}convertBytes(e){return new nr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Tt(this.firestore,null,t)}}function jn(n){n=Bn(n,Ss);const e=Bn(n.firestore,Jr),t=ll(e),r=new Ud(e);return N0(n._query),wP(t,n._query).then((s=>new zi(e,r,n,s)))}function $n(n,e,t){n=Bn(n,Tt);const r=Bn(n.firestore,Jr),s=pp(n.converter,e,t);return Fd(r,[rp(dl(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Ct.none())])}function _n(n,e,t,...r){n=Bn(n,Tt);const s=Bn(n.firestore,Jr),i=dl(s);let a;return a=typeof(e=Ne(e))=="string"||e instanceof ul?b0(i,"updateDoc",n._key,e,t,r):v0(i,"updateDoc",n._key,e),Fd(s,[a.toMutation(n._key,Ct.exists(!0))])}function $o(n){return Fd(Bn(n.firestore,Jr),[new sl(n._key,Ct.none())])}function qu(n,e){const t=Bn(n.firestore,Jr),r=Se(n),s=pp(n.converter,e);return Fd(t,[rp(dl(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Ct.exists(!1))]).then((()=>r))}function fi(n,...e){var t,r,s;n=Ne(n);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Ix(e[a])||(i=e[a++]);const c={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Ix(e[a])){const m=e[a];e[a]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[a+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[a+2]=(s=m.complete)===null||s===void 0?void 0:s.bind(m)}let l,d,h;if(n instanceof Tt)d=Bn(n.firestore,Jr),h=nl(n._key.path),l={next:m=>{e[a]&&e[a](C0(d,n,m))},error:e[a+1],complete:e[a+2]};else{const m=Bn(n,Ss);d=Bn(m.firestore,Jr),h=m._query;const f=new Ud(d);l={next:w=>{e[a]&&e[a](new zi(d,f,m,w))},error:e[a+1],complete:e[a+2]},N0(n._query)}return(function(f,w,k,C){const b=new ep(C),N=new Xm(w,b,k);return f.asyncQueue.enqueueAndForget((async()=>Km(await Bu(f),N))),()=>{b.Ou(),f.asyncQueue.enqueueAndForget((async()=>Qm(await Bu(f),N)))}})(ll(d),h,c,l)}function Fd(n,e){return(function(r,s){const i=new Rr;return r.asyncQueue.enqueueAndForget((async()=>rP(await gP(r),s,i))),i.promise})(ll(n),e)}function C0(n,e,t){const r=t.docs.get(e._key),s=new Ud(n);return new ii(n,s,e._key,r,new Oo(t.hasPendingWrites,t.fromCache),e.converter)}class jP{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=OP(),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function PP(n){return new jP(n)}class DP{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Fu.provider,this._offlineComponentProvider={build:t=>new dP(t,e?.cacheSizeBytes,this.forceOwnership)}}}function OP(n){return new DP(void 0)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LP={maxAttempts:5};function Qa(n,e){if((n=Ne(n)).firestore!==e)throw new ne($.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=dl(e)}get(e){const t=Qa(e,this._firestore),r=new SP(this._firestore);return this._transaction.lookup([t._key]).then((s=>{if(!s||s.length!==1)return he(24041);const i=s[0];if(i.isFoundDocument())return new $u(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new $u(this._firestore,r,t._key,null,t.converter);throw he(18433,{doc:i})}))}set(e,t,r){const s=Qa(e,this._firestore),i=pp(s.converter,t,r),a=rp(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,a),this}update(e,t,r,...s){const i=Qa(e,this._firestore);let a;return a=typeof(t=Ne(t))=="string"||t instanceof ul?b0(this._dataReader,"Transaction.update",i._key,t,r,s):v0(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,a),this}delete(e){const t=Qa(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP extends VP{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Qa(e,this._firestore),r=new Ud(this._firestore);return super.get(e).then((s=>new ii(this._firestore,r,t._key,s._document,new Oo(!1,!1),t.converter)))}}function S0(n,e,t){n=Bn(n,Jr);const r=Object.assign(Object.assign({},LP),t);return(function(i){if(i.maxAttempts<1)throw new ne($.INVALID_ARGUMENT,"Max attempts must be at least 1")})(r),(function(i,a,c){const l=new Rr;return i.asyncQueue.enqueueAndForget((async()=>{const d=await yP(i);new fP(i.asyncQueue,d,c,a,l).zu()})),l.promise})(ll(n),(s=>e(new MP(n,s))),r)}function Sn(){return new sp("serverTimestamp")}function UP(...n){return new ip("arrayUnion",n)}function Cr(n){return new op("increment",n)}(function(e,t=!0){(function(s){ga=s})(io),Wn(new Rn("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),c=new Jr(new aS(r.getProvider("auth-internal")),new uS(a,r.getProvider("app-check-internal")),(function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new ne($.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wi(d.options.projectId,h)})(a,s),a);return i=Object.assign({useFetchStreams:t},i),c._setSettings(i),c}),"PUBLIC").setMultipleInstances(!0)),sn(ry,sy,e),sn(ry,sy,"esm2017")})();const R0="@firebase/installations",gp="0.6.18";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j0=1e4,P0=`w:${gp}`,D0="FIS_v2",FP="https://firebaseinstallations.googleapis.com/v1",BP=3600*1e3,zP="installations",$P="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qP={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Zi=new pi(zP,$P,qP);function O0(n){return n instanceof Kn&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L0({projectId:n}){return`${FP}/projects/${n}/installations`}function V0(n){return{token:n.token,requestStatus:2,expiresIn:WP(n.expiresIn),creationTime:Date.now()}}async function M0(n,e){const r=(await e.json()).error;return Zi.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function U0({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function HP(n,{refreshToken:e}){const t=U0(n);return t.append("Authorization",GP(e)),t}async function F0(n){const e=await n();return e.status>=500&&e.status<600?n():e}function WP(n){return Number(n.replace("s","000"))}function GP(n){return`${D0} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KP({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=L0(n),s=U0(n),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const a={fid:t,authVersion:D0,appId:n.appId,sdkVersion:P0},c={method:"POST",headers:s,body:JSON.stringify(a)},l=await F0(()=>fetch(r,c));if(l.ok){const d=await l.json();return{fid:d.fid||t,registrationStatus:2,refreshToken:d.refreshToken,authToken:V0(d.authToken)}}else throw await M0("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B0(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QP(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YP=/^[cdef][\w-]{21}$/,Sf="";function XP(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=JP(n);return YP.test(t)?t:Sf}catch{return Sf}}function JP(n){return QP(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bd(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z0=new Map;function $0(n,e){const t=Bd(n);q0(t,e),ZP(t,e)}function q0(n,e){const t=z0.get(n);if(t)for(const r of t)r(e)}function ZP(n,e){const t=e1();t&&t.postMessage({key:n,fid:e}),t1()}let Mi=null;function e1(){return!Mi&&"BroadcastChannel"in self&&(Mi=new BroadcastChannel("[Firebase] FID Change"),Mi.onmessage=n=>{q0(n.data.key,n.data.fid)}),Mi}function t1(){z0.size===0&&Mi&&(Mi.close(),Mi=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n1="firebase-installations-database",r1=1,eo="firebase-installations-store";let Ch=null;function yp(){return Ch||(Ch=N_(n1,r1,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(eo)}}})),Ch}async function Hu(n,e){const t=Bd(n),s=(await yp()).transaction(eo,"readwrite"),i=s.objectStore(eo),a=await i.get(t);return await i.put(e,t),await s.done,(!a||a.fid!==e.fid)&&$0(n,e.fid),e}async function H0(n){const e=Bd(n),r=(await yp()).transaction(eo,"readwrite");await r.objectStore(eo).delete(e),await r.done}async function zd(n,e){const t=Bd(n),s=(await yp()).transaction(eo,"readwrite"),i=s.objectStore(eo),a=await i.get(t),c=e(a);return c===void 0?await i.delete(t):await i.put(c,t),await s.done,c&&(!a||a.fid!==c.fid)&&$0(n,c.fid),c}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xp(n){let e;const t=await zd(n.appConfig,r=>{const s=s1(r),i=i1(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Sf?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function s1(n){const e=n||{fid:XP(),registrationStatus:0};return W0(e)}function i1(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Zi.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=o1(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:a1(n)}:{installationEntry:e}}async function o1(n,e){try{const t=await KP(n,e);return Hu(n.appConfig,t)}catch(t){throw O0(t)&&t.customData.serverCode===409?await H0(n.appConfig):await Hu(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function a1(n){let e=await Nx(n.appConfig);for(;e.registrationStatus===1;)await B0(100),e=await Nx(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await xp(n);return r||t}return e}function Nx(n){return zd(n,e=>{if(!e)throw Zi.create("installation-not-found");return W0(e)})}function W0(n){return c1(n)?{fid:n.fid,registrationStatus:0}:n}function c1(n){return n.registrationStatus===1&&n.registrationTime+j0<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l1({appConfig:n,heartbeatServiceProvider:e},t){const r=u1(n,t),s=HP(n,t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const a={installation:{sdkVersion:P0,appId:n.appId}},c={method:"POST",headers:s,body:JSON.stringify(a)},l=await F0(()=>fetch(r,c));if(l.ok){const d=await l.json();return V0(d)}else throw await M0("Generate Auth Token",l)}function u1(n,{fid:e}){return`${L0(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wp(n,e=!1){let t;const r=await zd(n.appConfig,i=>{if(!G0(i))throw Zi.create("not-registered");const a=i.authToken;if(!e&&f1(a))return i;if(a.requestStatus===1)return t=d1(n,e),i;{if(!navigator.onLine)throw Zi.create("app-offline");const c=p1(i);return t=h1(n,c),c}});return t?await t:r.authToken}async function d1(n,e){let t=await kx(n.appConfig);for(;t.authToken.requestStatus===1;)await B0(100),t=await kx(n.appConfig);const r=t.authToken;return r.requestStatus===0?wp(n,e):r}function kx(n){return zd(n,e=>{if(!G0(e))throw Zi.create("not-registered");const t=e.authToken;return g1(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function h1(n,e){try{const t=await l1(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await Hu(n.appConfig,r),t}catch(t){if(O0(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await H0(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Hu(n.appConfig,r)}throw t}}function G0(n){return n!==void 0&&n.registrationStatus===2}function f1(n){return n.requestStatus===2&&!m1(n)}function m1(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+BP}function p1(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function g1(n){return n.requestStatus===1&&n.requestTime+j0<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y1(n){const e=n,{installationEntry:t,registrationPromise:r}=await xp(e);return r?r.catch(console.error):wp(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x1(n,e=!1){const t=n;return await w1(t),(await wp(t,e)).token}async function w1(n){const{registrationPromise:e}=await xp(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _1(n){if(!n||!n.options)throw Sh("App Configuration");if(!n.name)throw Sh("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Sh(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Sh(n){return Zi.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K0="installations",v1="installations-internal",b1=n=>{const e=n.getProvider("app").getImmediate(),t=_1(e),r=Or(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},I1=n=>{const e=n.getProvider("app").getImmediate(),t=Or(e,K0).getImmediate();return{getId:()=>y1(t),getToken:s=>x1(t,s)}};function T1(){Wn(new Rn(K0,b1,"PUBLIC")),Wn(new Rn(v1,I1,"PRIVATE"))}T1();sn(R0,gp);sn(R0,gp,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wu="analytics",E1="firebase_id",N1="origin",k1=60*1e3,A1="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",_p="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qn=new Wc("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C1={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},or=new pi("analytics","Analytics",C1);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S1(n){if(!n.startsWith(_p)){const e=or.create("invalid-gtag-resource",{gtagURL:n});return qn.warn(e.message),""}return n}function Q0(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function R1(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function j1(n,e){const t=R1("firebase-js-sdk-policy",{createScriptURL:S1}),r=document.createElement("script"),s=`${_p}?l=${n}&id=${e}`;r.src=t?t?.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function P1(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function D1(n,e,t,r,s,i){const a=r[s];try{if(a)await e[a];else{const l=(await Q0(t)).find(d=>d.measurementId===s);l&&await e[l.appId]}}catch(c){qn.error(c)}n("config",s,i)}async function O1(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let a=s.send_to;Array.isArray(a)||(a=[a]);const c=await Q0(t);for(const l of a){const d=c.find(m=>m.measurementId===l),h=d&&e[d.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){qn.error(i)}}function L1(n,e,t,r){async function s(i,...a){try{if(i==="event"){const[c,l]=a;await O1(n,e,t,c,l)}else if(i==="config"){const[c,l]=a;await D1(n,e,t,r,c,l)}else if(i==="consent"){const[c,l]=a;n("consent",c,l)}else if(i==="get"){const[c,l,d]=a;n("get",c,l,d)}else if(i==="set"){const[c]=a;n("set",c)}else n(i,...a)}catch(c){qn.error(c)}}return s}function V1(n,e,t,r,s){let i=function(...a){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=L1(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function M1(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(_p)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U1=30,F1=1e3;class B1{constructor(e={},t=F1){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const Y0=new B1;function z1(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function $1(n){var e;const{appId:t,apiKey:r}=n,s={method:"GET",headers:z1(r)},i=A1.replace("{app-id}",t),a=await fetch(i,s);if(a.status!==200&&a.status!==304){let c="";try{const l=await a.json();!((e=l.error)===null||e===void 0)&&e.message&&(c=l.error.message)}catch{}throw or.create("config-fetch-failed",{httpStatus:a.status,responseMessage:c})}return a.json()}async function q1(n,e=Y0,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw or.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw or.create("no-api-key")}const a=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new G1;return setTimeout(async()=>{c.abort()},k1),X0({appId:r,apiKey:s,measurementId:i},a,c,e)}async function X0(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=Y0){var i;const{appId:a,measurementId:c}=n;try{await H1(r,e)}catch(l){if(c)return qn.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${l?.message}]`),{appId:a,measurementId:c};throw l}try{const l=await $1(n);return s.deleteThrottleMetadata(a),l}catch(l){const d=l;if(!W1(d)){if(s.deleteThrottleMetadata(a),c)return qn.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${d?.message}]`),{appId:a,measurementId:c};throw l}const h=Number((i=d?.customData)===null||i===void 0?void 0:i.httpStatus)===503?Qh(t,s.intervalMillis,U1):Qh(t,s.intervalMillis),m={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(a,m),qn.debug(`Calling attemptFetch again in ${h} millis`),X0(n,m,r,s)}}function H1(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(or.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function W1(n){if(!(n instanceof Kn)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class G1{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function K1(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,a=Object.assign(Object.assign({},r),{send_to:i});n("event",t,a)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q1(){if(ha())try{await sm()}catch(n){return qn.warn(or.create("indexeddb-unavailable",{errorInfo:n?.toString()}).message),!1}else return qn.warn(or.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Y1(n,e,t,r,s,i,a){var c;const l=q1(n);l.then(w=>{t[w.measurementId]=w.appId,n.options.measurementId&&w.measurementId!==n.options.measurementId&&qn.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${w.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(w=>qn.error(w)),e.push(l);const d=Q1().then(w=>{if(w)return r.getId()}),[h,m]=await Promise.all([l,d]);M1(i)||j1(i,h.measurementId),s("js",new Date);const f=(c=a?.config)!==null&&c!==void 0?c:{};return f[N1]="firebase",f.update=!0,m!=null&&(f[E1]=m),s("config",h.measurementId,f),h.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X1{constructor(e){this.app=e}_delete(){return delete uc[this.app.options.appId],Promise.resolve()}}let uc={},Ax=[];const Cx={};let Rh="dataLayer",J1="gtag",Sx,J0,Rx=!1;function Z1(){const n=[];if(rm()&&n.push("This is a browser extension environment."),I_()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=or.create("invalid-analytics-context",{errorInfo:e});qn.warn(t.message)}}function eD(n,e,t){Z1();const r=n.options.appId;if(!r)throw or.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)qn.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw or.create("no-api-key");if(uc[r]!=null)throw or.create("already-exists",{id:r});if(!Rx){P1(Rh);const{wrappedGtag:i,gtagCore:a}=V1(uc,Ax,Cx,Rh,J1);J0=i,Sx=a,Rx=!0}return uc[r]=Y1(n,Ax,Cx,e,Sx,Rh,t),new X1(n)}function tD(n=Gc()){n=Ne(n);const e=Or(n,Wu);return e.isInitialized()?e.getImmediate():nD(n)}function nD(n,e={}){const t=Or(n,Wu);if(t.isInitialized()){const s=t.getImmediate();if(xs(e,t.getOptions()))return s;throw or.create("already-initialized")}return t.initialize({options:e})}async function rD(){if(rm()||!I_()||!ha())return!1;try{return await sm()}catch{return!1}}function sD(n,e,t,r){n=Ne(n),K1(J0,uc[n.app.options.appId],e,t,r).catch(s=>qn.error(s))}const jx="@firebase/analytics",Px="0.10.17";function iD(){Wn(new Rn(Wu,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return eD(r,s,t)},"PUBLIC")),Wn(new Rn("analytics-internal",n,"PRIVATE")),sn(jx,Px),sn(jx,Px,"esm2017");function n(e){try{const t=e.getProvider(Wu).getImmediate();return{logEvent:(r,s,i)=>sD(t,r,s,i)}}catch(t){throw or.create("interop-component-reg-failed",{reason:t})}}}iD();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rf=new Map,Z0={activated:!1,tokenObservers:[]},oD={initialized:!1,enabled:!1};function zt(n){return Rf.get(n)||Object.assign({},Z0)}function aD(n,e){return Rf.set(n,e),Rf.get(n)}function $d(){return oD}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eI="https://content-firebaseappcheck.googleapis.com/v1",cD="exchangeRecaptchaEnterpriseToken",lD="exchangeDebugToken",Dx={RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},uD=1440*60*1e3;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dD{constructor(e,t,r,s,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=s,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=s,s>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new wc,this.pending.promise.catch(t=>{}),await hD(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new wc,this.pending.promise.catch(t=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}function hD(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fD={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Mn=new pi("appCheck","AppCheck",fD);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ox(n=!1){var e;return n?(e=self.grecaptcha)===null||e===void 0?void 0:e.enterprise:self.grecaptcha}function vp(n){if(!zt(n).activated)throw Mn.create("use-before-activation",{appName:n.name})}function tI(n){const e=Math.round(n/1e3),t=Math.floor(e/(3600*24)),r=Math.floor((e-t*3600*24)/3600),s=Math.floor((e-t*3600*24-r*3600)/60),i=e-t*3600*24-r*3600-s*60;let a="";return t&&(a+=zl(t)+"d:"),r&&(a+=zl(r)+"h:"),a+=zl(s)+"m:"+zl(i)+"s",a}function zl(n){return n===0?"00":n>=10?n.toString():"0"+n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bp({url:n,body:e},t){const r={"Content-Type":"application/json"},s=t.getImmediate({optional:!0});if(s){const m=await s.getHeartbeatsHeader();m&&(r["X-Firebase-Client"]=m)}const i={method:"POST",body:JSON.stringify(e),headers:r};let a;try{a=await fetch(n,i)}catch(m){throw Mn.create("fetch-network-error",{originalErrorMessage:m?.message})}if(a.status!==200)throw Mn.create("fetch-status-error",{httpStatus:a.status});let c;try{c=await a.json()}catch(m){throw Mn.create("fetch-parse-error",{originalErrorMessage:m?.message})}const l=c.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw Mn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});const d=Number(l[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}}function mD(n,e){const{projectId:t,appId:r,apiKey:s}=n.options;return{url:`${eI}/projects/${t}/apps/${r}:${cD}?key=${s}`,body:{recaptcha_enterprise_token:e}}}function nI(n,e){const{projectId:t,appId:r,apiKey:s}=n.options;return{url:`${eI}/projects/${t}/apps/${r}:${lD}?key=${s}`,body:{debug_token:e}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pD="firebase-app-check-database",gD=1,Mc="firebase-app-check-store",rI="debug-token";let $l=null;function sI(){return $l||($l=new Promise((n,e)=>{try{const t=indexedDB.open(pD,gD);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var s;e(Mn.create("storage-open",{originalErrorMessage:(s=r.target.error)===null||s===void 0?void 0:s.message}))},t.onupgradeneeded=r=>{const s=r.target.result;switch(r.oldVersion){case 0:s.createObjectStore(Mc,{keyPath:"compositeKey"})}}}catch(t){e(Mn.create("storage-open",{originalErrorMessage:t?.message}))}}),$l)}function yD(n){return oI(aI(n))}function xD(n,e){return iI(aI(n),e)}function wD(n){return iI(rI,n)}function _D(){return oI(rI)}async function iI(n,e){const r=(await sI()).transaction(Mc,"readwrite"),i=r.objectStore(Mc).put({compositeKey:n,value:e});return new Promise((a,c)=>{i.onsuccess=l=>{a()},r.onerror=l=>{var d;c(Mn.create("storage-set",{originalErrorMessage:(d=l.target.error)===null||d===void 0?void 0:d.message}))}})}async function oI(n){const t=(await sI()).transaction(Mc,"readonly"),s=t.objectStore(Mc).get(n);return new Promise((i,a)=>{s.onsuccess=c=>{const l=c.target.result;i(l?l.value:void 0)},t.onerror=c=>{var l;a(Mn.create("storage-get",{originalErrorMessage:(l=c.target.error)===null||l===void 0?void 0:l.message}))}})}function aI(n){return`${n.options.appId}-${n.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xs=new Wc("@firebase/app-check");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vD(n){if(ha()){let e;try{e=await yD(n)}catch(t){Xs.warn(`Failed to read token from IndexedDB. Error: ${t}`)}return e}}function jh(n,e){return ha()?xD(n,e).catch(t=>{Xs.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}async function bD(){let n;try{n=await _D()}catch{}if(n)return n;{const e=crypto.randomUUID();return wD(e).catch(t=>Xs.warn(`Failed to persist debug token to IndexedDB. Error: ${t}`)),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ip(){return $d().enabled}async function Tp(){const n=$d();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function ID(){const n=tm(),e=$d();if(e.initialized=!0,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN!="string"&&n.FIREBASE_APPCHECK_DEBUG_TOKEN!==!0)return;e.enabled=!0;const t=new wc;e.token=t,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN=="string"?t.resolve(n.FIREBASE_APPCHECK_DEBUG_TOKEN):t.resolve(bD())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TD={error:"UNKNOWN_ERROR"};function ED(n){return em.encodeString(JSON.stringify(n),!1)}async function jf(n,e=!1,t=!1){const r=n.app;vp(r);const s=zt(r);let i=s.token,a;if(i&&!Lo(i)&&(s.token=void 0,i=void 0),!i){const d=await s.cachedTokenPromise;d&&(Lo(d)?i=d:await jh(r,void 0))}if(!e&&i&&Lo(i))return{token:i.token};let c=!1;if(Ip())try{s.exchangeTokenPromise||(s.exchangeTokenPromise=bp(nI(r,await Tp()),n.heartbeatServiceProvider).finally(()=>{s.exchangeTokenPromise=void 0}),c=!0);const d=await s.exchangeTokenPromise;return await jh(r,d),s.token=d,{token:d.token}}catch(d){return d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?Xs.warn(d.message):t&&Xs.error(d),Ph(d)}try{s.exchangeTokenPromise||(s.exchangeTokenPromise=s.provider.getToken().finally(()=>{s.exchangeTokenPromise=void 0}),c=!0),i=await zt(r).exchangeTokenPromise}catch(d){d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?Xs.warn(d.message):t&&Xs.error(d),a=d}let l;return i?a?Lo(i)?l={token:i.token,internalError:a}:l=Ph(a):(l={token:i.token},s.token=i,await jh(r,i)):l=Ph(a),c&&uI(r,l),l}async function ND(n){const e=n.app;vp(e);const{provider:t}=zt(e);if(Ip()){const r=await Tp(),{token:s}=await bp(nI(e,r),n.heartbeatServiceProvider);return{token:s}}else{const{token:r}=await t.getToken();return{token:r}}}function cI(n,e,t,r){const{app:s}=n,i=zt(s),a={next:t,error:r,type:e};if(i.tokenObservers=[...i.tokenObservers,a],i.token&&Lo(i.token)){const c=i.token;Promise.resolve().then(()=>{t({token:c.token}),Lx(n)}).catch(()=>{})}i.cachedTokenPromise.then(()=>Lx(n))}function lI(n,e){const t=zt(n),r=t.tokenObservers.filter(s=>s.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Lx(n){const{app:e}=n,t=zt(e);let r=t.tokenRefresher;r||(r=kD(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function kD(n){const{app:e}=n;return new dD(async()=>{const t=zt(e);let r;if(t.token?r=await jf(n,!0):r=await jf(n),r.error)throw r.error;if(r.internalError)throw r.internalError},()=>!0,()=>{const t=zt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5;const s=t.token.expireTimeMillis-300*1e3;return r=Math.min(r,s),Math.max(0,r-Date.now())}else return 0},Dx.RETRIAL_MIN_WAIT,Dx.RETRIAL_MAX_WAIT)}function uI(n,e){const t=zt(n).tokenObservers;for(const r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Lo(n){return n.expireTimeMillis-Date.now()>0}function Ph(n){return{token:ED(TD),error:n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AD{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=zt(this.app);for(const t of e)lI(this.app,t.next);return Promise.resolve()}}function CD(n,e){return new AD(n,e)}function SD(n){return{getToken:e=>jf(n,e),getLimitedUseToken:()=>ND(n),addTokenListener:e=>cI(n,"INTERNAL",e),removeTokenListener:e=>lI(n.app,e)}}const RD="@firebase/app-check",jD="0.10.1",PD="https://www.google.com/recaptcha/enterprise.js";function DD(n,e){const t=new wc,r=zt(n);r.reCAPTCHAState={initialized:t};const s=OD(n),i=Ox(!0);return i?Vx(n,e,i,s,t):MD(()=>{const a=Ox(!0);if(!a)throw new Error("no recaptcha");Vx(n,e,a,s,t)}),t.promise}function Vx(n,e,t,r,s){t.ready(()=>{VD(n,e,t,r),s.resolve(t)})}function OD(n){const e=`fire_app_check_${n.name}`,t=document.createElement("div");return t.id=e,t.style.display="none",document.body.appendChild(t),e}async function LD(n){vp(n);const t=await zt(n).reCAPTCHAState.initialized.promise;return new Promise((r,s)=>{const i=zt(n).reCAPTCHAState;t.ready(()=>{r(t.execute(i.widgetId,{action:"fire_app_check"}))})})}function VD(n,e,t,r){const s=t.render(r,{sitekey:e,size:"invisible",callback:()=>{zt(n).reCAPTCHAState.succeeded=!0},"error-callback":()=>{zt(n).reCAPTCHAState.succeeded=!1}}),i=zt(n);i.reCAPTCHAState=Object.assign(Object.assign({},i.reCAPTCHAState),{widgetId:s})}function MD(n){const e=document.createElement("script");e.src=PD,e.onload=n,document.head.appendChild(e)}class Ep{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e,t,r;FD(this._throttleData);const s=await LD(this._app).catch(a=>{throw Mn.create("recaptcha-error")});if(!(!((e=zt(this._app).reCAPTCHAState)===null||e===void 0)&&e.succeeded))throw Mn.create("recaptcha-error");let i;try{i=await bp(mD(this._app,s),this._heartbeatServiceProvider)}catch(a){throw!((t=a.code)===null||t===void 0)&&t.includes("fetch-status-error")?(this._throttleData=UD(Number((r=a.customData)===null||r===void 0?void 0:r.httpStatus),this._throttleData),Mn.create("initial-throttle",{time:tI(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):a}return this._throttleData=null,i}initialize(e){this._app=e,this._heartbeatServiceProvider=Or(e,"heartbeat"),DD(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Ep?this._siteKey===e._siteKey:!1}}function UD(n,e){if(n===404||n===403)return{backoffCount:1,allowRequestsAfter:Date.now()+uD,httpStatus:n};{const t=e?e.backoffCount:0,r=Qh(t,1e3,2);return{backoffCount:t+1,allowRequestsAfter:Date.now()+r,httpStatus:n}}}function FD(n){if(n&&Date.now()-n.allowRequestsAfter<=0)throw Mn.create("throttled",{time:tI(n.allowRequestsAfter-Date.now()),httpStatus:n.httpStatus})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BD(n=Gc(),e){n=Ne(n);const t=Or(n,"app-check");if($d().initialized||ID(),Ip()&&Tp().then(s=>console.log(`App Check debug token: ${s}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(i.isTokenAutoRefreshEnabled===e.isTokenAutoRefreshEnabled&&i.provider.isEqual(e.provider))return s;throw Mn.create("already-initialized",{appName:n.name})}const r=t.initialize({options:e});return zD(n,e.provider,e.isTokenAutoRefreshEnabled),zt(n).isTokenAutoRefreshEnabled&&cI(r,"INTERNAL",()=>{}),r}function zD(n,e,t=!1){const r=aD(n,Object.assign({},Z0));r.activated=!0,r.provider=e,r.cachedTokenPromise=vD(n).then(s=>(s&&Lo(s)&&(r.token=s,uI(n,{token:s.token})),s)),r.isTokenAutoRefreshEnabled=t&&n.automaticDataCollectionEnabled,!n.automaticDataCollectionEnabled&&t&&Xs.warn("`isTokenAutoRefreshEnabled` is true but `automaticDataCollectionEnabled` was set to false during `initializeApp()`. This blocks automatic token refresh."),r.provider.initialize(n)}const $D="app-check",Mx="app-check-internal";function qD(){Wn(new Rn($D,n=>{const e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return CD(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Mx).initialize()})),Wn(new Rn(Mx,n=>{const e=n.getProvider("app-check").getImmediate();return SD(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),sn(RD,jD)}qD();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dI="firebasestorage.googleapis.com",hI="storageBucket",HD=120*1e3,WD=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt extends Kn{constructor(e,t,r=0){super(Dh(e),`Firebase Storage: ${t} (${Dh(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,kt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Dh(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Nt;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Nt||(Nt={}));function Dh(n){return"storage/"+n}function Np(){const n="An unknown error occurred, please check the error payload for server response.";return new kt(Nt.UNKNOWN,n)}function GD(n){return new kt(Nt.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function KD(n){return new kt(Nt.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function QD(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new kt(Nt.UNAUTHENTICATED,n)}function YD(){return new kt(Nt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function XD(n){return new kt(Nt.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function JD(){return new kt(Nt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ZD(){return new kt(Nt.CANCELED,"User canceled the upload/download.")}function e2(n){return new kt(Nt.INVALID_URL,"Invalid URL '"+n+"'.")}function t2(n){return new kt(Nt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function n2(){return new kt(Nt.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+hI+"' property when initializing the app?")}function r2(){return new kt(Nt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function s2(){return new kt(Nt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function i2(n){return new kt(Nt.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Pf(n){return new kt(Nt.INVALID_ARGUMENT,n)}function fI(){return new kt(Nt.APP_DELETED,"The Firebase app was deleted.")}function o2(n){return new kt(Nt.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function dc(n,e){return new kt(Nt.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Ua(n){throw new kt(Nt.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=ir.makeFromUrl(e,t)}catch{return new ir(e,"")}if(r.path==="")return r;throw t2(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(R){R.path.charAt(R.path.length-1)==="/"&&(R.path_=R.path_.slice(0,-1))}const a="(/(.*))?$",c=new RegExp("^gs://"+s+a,"i"),l={bucket:1,path:3};function d(R){R.path_=decodeURIComponent(R.path)}const h="v[A-Za-z0-9_]+",m=t.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",w=new RegExp(`^https?://${m}/${h}/b/${s}/o${f}`,"i"),k={bucket:1,path:3},C=t===dI?"(?:storage.googleapis.com|storage.cloud.google.com)":t,b="([^?#]*)",N=new RegExp(`^https?://${C}/${s}/${b}`,"i"),E=[{regex:c,indices:l,postModify:i},{regex:w,indices:k,postModify:d},{regex:N,indices:{bucket:1,path:2},postModify:d}];for(let R=0;R<E.length;R++){const P=E[R],O=P.regex.exec(e);if(O){const g=O[P.indices.bucket];let x=O[P.indices.path];x||(x=""),r=new ir(g,x),P.postModify(r);break}}if(r==null)throw e2(e);return r}}class a2{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c2(n,e,t){let r=1,s=null,i=null,a=!1,c=0;function l(){return c===2}let d=!1;function h(...b){d||(d=!0,e.apply(null,b))}function m(b){s=setTimeout(()=>{s=null,n(w,l())},b)}function f(){i&&clearTimeout(i)}function w(b,...N){if(d){f();return}if(b){f(),h.call(null,b,...N);return}if(l()||a){f(),h.call(null,b,...N);return}r<64&&(r*=2);let E;c===1?(c=2,E=0):E=(r+Math.random())*1e3,m(E)}let k=!1;function C(b){k||(k=!0,f(),!d&&(s!==null?(b||(c=2),clearTimeout(s),m(0)):b||(c=1)))}return m(0),i=setTimeout(()=>{a=!0,C(!0)},t),C}function l2(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u2(n){return n!==void 0}function d2(n){return typeof n=="object"&&!Array.isArray(n)}function kp(n){return typeof n=="string"||n instanceof String}function Ux(n){return Ap()&&n instanceof Blob}function Ap(){return typeof Blob<"u"}function Fx(n,e,t,r){if(r<e)throw Pf(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Pf(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cp(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function mI(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var $i;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})($i||($i={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h2(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f2{constructor(e,t,r,s,i,a,c,l,d,h,m,f=!0,w=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=c,this.errorCallback_=l,this.timeout_=d,this.progressCallback_=h,this.connectionFactory_=m,this.retry=f,this.isUsingEmulator=w,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((k,C)=>{this.resolve_=k,this.reject_=C,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new ql(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const a=c=>{const l=c.loaded,d=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,d)};this.progressCallback_!==null&&i.addUploadProgressListener(a),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(a),this.pendingConnection_=null;const c=i.getErrorCode()===$i.NO_ERROR,l=i.getStatus();if(!c||h2(l,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===$i.ABORT;r(!1,new ql(!1,null,h));return}const d=this.successCodes_.indexOf(l)!==-1;r(!0,new ql(d,i))})},t=(r,s)=>{const i=this.resolve_,a=this.reject_,c=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(c,c.getResponse());u2(l)?i(l):i()}catch(l){a(l)}else if(c!==null){const l=Np();l.serverResponse=c.getErrorText(),this.errorCallback_?a(this.errorCallback_(c,l)):a(l)}else if(s.canceled){const l=this.appDelete_?fI():ZD();a(l)}else{const l=JD();a(l)}};this.canceled_?t(!1,new ql(!1,null,!0)):this.backoffId_=c2(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&l2(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class ql{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function m2(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function p2(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function g2(n,e){e&&(n["X-Firebase-GMPID"]=e)}function y2(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function x2(n,e,t,r,s,i,a=!0,c=!1){const l=mI(n.urlParams),d=n.url+l,h=Object.assign({},n.headers);return g2(h,e),m2(h,t),p2(h,i),y2(h,r),new f2(d,n.method,h,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,a,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w2(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function _2(...n){const e=w2();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(Ap())return new Blob(n);throw new kt(Nt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function v2(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b2(n){if(typeof atob>"u")throw i2("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wr={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Oh{constructor(e,t){this.data=e,this.contentType=t||null}}function I2(n,e){switch(n){case Wr.RAW:return new Oh(pI(e));case Wr.BASE64:case Wr.BASE64URL:return new Oh(gI(n,e));case Wr.DATA_URL:return new Oh(E2(e),N2(e))}throw Np()}function pI(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,a=n.charCodeAt(++t);r=65536|(i&1023)<<10|a&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function T2(n){let e;try{e=decodeURIComponent(n)}catch{throw dc(Wr.DATA_URL,"Malformed data URL.")}return pI(e)}function gI(n,e){switch(n){case Wr.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw dc(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Wr.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw dc(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=b2(e)}catch(s){throw s.message.includes("polyfill")?s:dc(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class yI{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw dc(Wr.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=k2(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function E2(n){const e=new yI(n);return e.base64?gI(Wr.BASE64,e.rest):T2(e.rest)}function N2(n){return new yI(n).contentType}function k2(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e,t){let r=0,s="";Ux(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(Ux(this.data_)){const r=this.data_,s=v2(r,e,t);return s===null?null:new Gs(s)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Gs(r,!0)}}static getBlob(...e){if(Ap()){const t=e.map(r=>r instanceof Gs?r.data_:r);return new Gs(_2.apply(null,t))}else{const t=e.map(a=>kp(a)?I2(Wr.RAW,a).data:a.data_);let r=0;t.forEach(a=>{r+=a.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(a=>{for(let c=0;c<a.length;c++)s[i++]=a[c]}),new Gs(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xI(n){let e;try{e=JSON.parse(n)}catch{return null}return d2(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A2(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function C2(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function wI(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S2(n,e){return e}class En{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||S2}}let Hl=null;function R2(n){return!kp(n)||n.length<2?n:wI(n)}function _I(){if(Hl)return Hl;const n=[];n.push(new En("bucket")),n.push(new En("generation")),n.push(new En("metageneration")),n.push(new En("name","fullPath",!0));function e(i,a){return R2(a)}const t=new En("name");t.xform=e,n.push(t);function r(i,a){return a!==void 0?Number(a):a}const s=new En("size");return s.xform=r,n.push(s),n.push(new En("timeCreated")),n.push(new En("updated")),n.push(new En("md5Hash",null,!0)),n.push(new En("cacheControl",null,!0)),n.push(new En("contentDisposition",null,!0)),n.push(new En("contentEncoding",null,!0)),n.push(new En("contentLanguage",null,!0)),n.push(new En("contentType",null,!0)),n.push(new En("metadata","customMetadata",!0)),Hl=n,Hl}function j2(n,e){function t(){const r=n.bucket,s=n.fullPath,i=new ir(r,s);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function P2(n,e,t){const r={};r.type="file";const s=t.length;for(let i=0;i<s;i++){const a=t[i];r[a.local]=a.xform(r,e[a.server])}return j2(r,n),r}function vI(n,e,t){const r=xI(e);return r===null?null:P2(n,r,t)}function D2(n,e,t,r){const s=xI(e);if(s===null||!kp(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const a=encodeURIComponent;return i.split(",").map(d=>{const h=n.bucket,m=n.fullPath,f="/b/"+a(h)+"/o/"+a(m),w=Cp(f,t,r),k=mI({alt:"media",token:d});return w+k})[0]}function O2(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class bI{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function II(n){if(!n)throw Np()}function L2(n,e){function t(r,s){const i=vI(n,s,e);return II(i!==null),i}return t}function V2(n,e){function t(r,s){const i=vI(n,s,e);return II(i!==null),D2(i,s,n.host,n._protocol)}return t}function TI(n){function e(t,r){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=YD():s=QD():t.getStatus()===402?s=KD(n.bucket):t.getStatus()===403?s=XD(n.path):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}return e}function M2(n){const e=TI(n);function t(r,s){let i=e(r,s);return r.getStatus()===404&&(i=GD(n.path)),i.serverResponse=s.serverResponse,i}return t}function U2(n,e,t){const r=e.fullServerUrl(),s=Cp(r,n.host,n._protocol),i="GET",a=n.maxOperationRetryTime,c=new bI(s,i,V2(n,t),a);return c.errorHandler=M2(e),c}function F2(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function B2(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=F2(null,e)),r}function z2(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function c(){let E="";for(let R=0;R<2;R++)E=E+Math.random().toString().slice(2);return E}const l=c();a["Content-Type"]="multipart/related; boundary="+l;const d=B2(e,r,s),h=O2(d,t),m="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+l+`\r
Content-Type: `+d.contentType+`\r
\r
`,f=`\r
--`+l+"--",w=Gs.getBlob(m,r,f);if(w===null)throw r2();const k={name:d.fullPath},C=Cp(i,n.host,n._protocol),b="POST",N=n.maxUploadRetryTime,I=new bI(C,b,L2(n,t),N);return I.urlParams=k,I.headers=a,I.body=w.uploadData(),I.errorHandler=TI(e),I}class $2{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=$i.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=$i.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=$i.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s,i){if(this.sent_)throw Ua("cannot .send() more than once");if(Ns(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(const a in i)i.hasOwnProperty(a)&&this.xhr_.setRequestHeader(a,i[a].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ua("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ua("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ua("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ua("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class q2 extends $2{initXhr(){this.xhr_.responseType="text"}}function EI(){return new q2}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(e,t){this._service=e,t instanceof ir?this._location=t:this._location=ir.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new to(e,t)}get root(){const e=new ir(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return wI(this._location.path)}get storage(){return this._service}get parent(){const e=A2(this._location.path);if(e===null)return null;const t=new ir(this._location.bucket,e);return new to(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw o2(e)}}function H2(n,e,t){n._throwIfRoot("uploadBytes");const r=z2(n.storage,n._location,_I(),new Gs(e,!0),t);return n.storage.makeRequestWithTokens(r,EI).then(s=>({metadata:s,ref:n}))}function W2(n){n._throwIfRoot("getDownloadURL");const e=U2(n.storage,n._location,_I());return n.storage.makeRequestWithTokens(e,EI).then(t=>{if(t===null)throw s2();return t})}function G2(n,e){const t=C2(n._location.path,e),r=new ir(n._location.bucket,t);return new to(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K2(n){return/^[A-Za-z]+:\/\//.test(n)}function Q2(n,e){return new to(n,e)}function NI(n,e){if(n instanceof Sp){const t=n;if(t._bucket==null)throw n2();const r=new to(t,t._bucket);return e!=null?NI(r,e):r}else return e!==void 0?G2(n,e):n}function Y2(n,e){if(e&&K2(e)){if(n instanceof Sp)return Q2(n,e);throw Pf("To use ref(service, url), the first argument must be a Storage instance.")}else return NI(n,e)}function Bx(n,e){const t=e?.[hI];return t==null?null:ir.makeFromBucketSpec(t,n)}function X2(n,e,t,r={}){n.host=`${e}:${t}`;const s=Ns(e);s&&(id(`https://${n.host}/b`),nm("Storage",!0)),n._isUsingEmulator=!0,n._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:GE(i,n.app.options.projectId))}class Sp{constructor(e,t,r,s,i,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=a,this._bucket=null,this._host=dI,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=HD,this._maxUploadRetryTime=WD,this._requests=new Set,s!=null?this._bucket=ir.makeFromBucketSpec(s,this._host):this._bucket=Bx(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=ir.makeFromBucketSpec(this._url,e):this._bucket=Bx(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Fx("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Fx("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(At(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new to(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new a2(fI());{const a=x2(e,this._appId,r,s,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const zx="@firebase/storage",$x="0.13.14";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kI="storage";function J2(n,e,t){return n=Ne(n),H2(n,e,t)}function Z2(n){return n=Ne(n),W2(n)}function eO(n,e){return n=Ne(n),Y2(n,e)}function tO(n=Gc(),e){n=Ne(n);const r=Or(n,kI).getImmediate({identifier:e}),s=y_("storage");return s&&nO(r,...s),r}function nO(n,e,t,r={}){X2(n,e,t,r)}function rO(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new Sp(t,r,s,e,io)}function sO(){Wn(new Rn(kI,rO,"PUBLIC").setMultipleInstances(!0)),sn(zx,$x,""),sn(zx,$x,"esm2017")}sO();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iO="type.googleapis.com/google.protobuf.Int64Value",oO="type.googleapis.com/google.protobuf.UInt64Value";function AI(n,e){const t={};for(const r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function Gu(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>Gu(e));if(typeof n=="function"||typeof n=="object")return AI(n,e=>Gu(e));throw new Error("Data cannot be encoded in JSON: "+n)}function ca(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case iO:case oO:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>ca(e)):typeof n=="function"||typeof n=="object"?AI(n,e=>ca(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rp="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qx={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Un extends Kn{constructor(e,t,r){super(`${Rp}/${e}`,t||""),this.details=r,Object.setPrototypeOf(this,Un.prototype)}}function aO(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Ku(n,e){let t=aO(n),r=t,s;try{const i=e&&e.error;if(i){const a=i.status;if(typeof a=="string"){if(!qx[a])return new Un("internal","internal");t=qx[a],r=a}const c=i.message;typeof c=="string"&&(r=c),s=i.details,s!==void 0&&(s=ca(s))}}catch{}return t==="ok"?null:new Un(t,r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(e,t,r,s){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,At(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(i=>this.auth=i,()=>{}),this.messaging||r.get().then(i=>this.messaging=i,()=>{}),this.appCheck||s?.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:s}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Df="us-central1",lO=/^data: (.*?)(?:\n|$)/;function uO(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new Un("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class dO{constructor(e,t,r,s,i=Df,a=(...c)=>fetch(...c)){this.app=e,this.fetchImpl=a,this.emulatorOrigin=null,this.contextProvider=new cO(e,t,r,s),this.cancelAllRequests=new Promise(c=>{this.deleteService=()=>Promise.resolve(c())});try{const c=new URL(i);this.customDomain=c.origin+(c.pathname==="/"?"":c.pathname),this.region=Df}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function hO(n,e,t){const r=Ns(e);n.emulatorOrigin=`http${r?"s":""}://${e}:${t}`,r&&(id(n.emulatorOrigin),nm("Functions",!0))}function fO(n,e,t){const r=s=>pO(n,e,s,{});return r.stream=(s,i)=>yO(n,e,s,i),r}async function mO(n,e,t,r){t["Content-Type"]="application/json";let s;try{s=await r(n,{method:"POST",body:JSON.stringify(e),headers:t})}catch{return{status:0,json:null}}let i=null;try{i=await s.json()}catch{}return{status:s.status,json:i}}async function CI(n,e){const t={},r=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return r.authToken&&(t.Authorization="Bearer "+r.authToken),r.messagingToken&&(t["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=r.appCheckToken),t}function pO(n,e,t,r){const s=n._url(e);return gO(n,s,t,r)}async function gO(n,e,t,r){t=Gu(t);const s={data:t},i=await CI(n,r),a=r.timeout||7e4,c=uO(a),l=await Promise.race([mO(e,s,i,n.fetchImpl),c.promise,n.cancelAllRequests]);if(c.cancel(),!l)throw new Un("cancelled","Firebase Functions instance was deleted.");const d=Ku(l.status,l.json);if(d)throw d;if(!l.json)throw new Un("internal","Response is not valid JSON object.");let h=l.json.data;if(typeof h>"u"&&(h=l.json.result),typeof h>"u")throw new Un("internal","Response is missing data field.");return{data:ca(h)}}function yO(n,e,t,r){const s=n._url(e);return xO(n,s,t,r||{})}async function xO(n,e,t,r){var s;t=Gu(t);const i={data:t},a=await CI(n,r);a["Content-Type"]="application/json",a.Accept="text/event-stream";let c;try{c=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(i),headers:a,signal:r?.signal})}catch(w){if(w instanceof Error&&w.name==="AbortError"){const C=new Un("cancelled","Request was cancelled.");return{data:Promise.reject(C),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(C)}}}}}}const k=Ku(0,null);return{data:Promise.reject(k),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(k)}}}}}}let l,d;const h=new Promise((w,k)=>{l=w,d=k});(s=r?.signal)===null||s===void 0||s.addEventListener("abort",()=>{const w=new Un("cancelled","Request was cancelled.");d(w)});const m=c.body.getReader(),f=wO(m,l,d,r?.signal);return{stream:{[Symbol.asyncIterator](){const w=f.getReader();return{async next(){const{value:k,done:C}=await w.read();return{value:k,done:C}},async return(){return await w.cancel(),{done:!0,value:void 0}}}}},data:h}}function wO(n,e,t,r){const s=(a,c)=>{const l=a.match(lO);if(!l)return;const d=l[1];try{const h=JSON.parse(d);if("result"in h){e(ca(h.result));return}if("message"in h){c.enqueue(ca(h.message));return}if("error"in h){const m=Ku(0,h);c.error(m),t(m);return}}catch(h){if(h instanceof Un){c.error(h),t(h);return}}},i=new TextDecoder;return new ReadableStream({start(a){let c="";return l();async function l(){if(r?.aborted){const d=new Un("cancelled","Request was cancelled");return a.error(d),t(d),Promise.resolve()}try{const{value:d,done:h}=await n.read();if(h){c.trim()&&s(c.trim(),a),a.close();return}if(r?.aborted){const f=new Un("cancelled","Request was cancelled");a.error(f),t(f),await n.cancel();return}c+=i.decode(d,{stream:!0});const m=c.split(`
`);c=m.pop()||"";for(const f of m)f.trim()&&s(f.trim(),a);return l()}catch(d){const h=d instanceof Un?d:Ku(0,null);a.error(h),t(h)}}},cancel(){return n.cancel()}})}const Hx="@firebase/functions",Wx="0.12.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _O="auth-internal",vO="app-check-internal",bO="messaging-internal";function IO(n){const e=(t,{instanceIdentifier:r})=>{const s=t.getProvider("app").getImmediate(),i=t.getProvider(_O),a=t.getProvider(bO),c=t.getProvider(vO);return new dO(s,i,a,c,r)};Wn(new Rn(Rp,e,"PUBLIC").setMultipleInstances(!0)),sn(Hx,Wx,n),sn(Hx,Wx,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jp(n=Gc(),e=Df){const r=Or(Ne(n),Rp).getImmediate({identifier:e}),s=y_("functions");return s&&TO(r,...s),r}function TO(n,e,t){hO(Ne(n),e,t)}function lo(n,e,t){return fO(Ne(n),e)}IO();const EO={apiKey:"AIzaSyBYpxHaQ-WDuj-c7pTT4zu7Kf5Kpx7FgUk",authDomain:"dddd-e6a52.firebaseapp.com",projectId:"dddd-e6a52",storageBucket:"dddd-e6a52.firebasestorage.app",messagingSenderId:"852428184810",appId:"1:852428184810:web:c97e9be32fe18600ae4b93",measurementId:"G-RH3Y682M53"},xi=k_(EO);if(typeof window<"u"){const n="6LeA4B0sAAAAAEf9UN-uyRJlqnH5pozFf0X-Me4C";BD(xi,{provider:new Ep(n),isTokenAutoRefreshEnabled:!0})}const me=vP(xi,{localCache:PP()});rD().then(n=>{n&&tD(xi)});const _e=tS(xi),NO=tO(xi),qd=jp(xi,"asia-northeast3");function kO(){const[n,e]=y.useState(!0),[t,r]=y.useState("login"),[s,i]=y.useState({nickname:"",email:"",profileImage:""}),[a,c]=y.useState(null),l=y.useCallback(async h=>{e(!0),c(null);try{const m=Se(me,"users",h.uid),f=await Qn(m);if(f.exists()){const w=f.data(),k=w?.nickname,C=w?.onboardingComplete===!0||w?.communityGuidelinesAgreed===!0;k&&C?(i({nickname:k,email:h.email||"",profileImage:h.photoURL||""}),r("main")):k&&!C?(i({nickname:k,email:h.email||"",profileImage:h.photoURL||""}),r("guidelines")):(i({nickname:"",email:h.email||"",profileImage:h.photoURL||""}),r("nickname"))}else i({nickname:"",email:h.email||"",profileImage:h.photoURL||""}),r("nickname")}catch(m){console.error("[AppInit] Firestore  ",m),c("   .   ."),r("login")}finally{e(!1)}},[]),d=y.useCallback(()=>{i({nickname:"",email:"",profileImage:""}),r("login")},[]);return y.useEffect(()=>{const h=_e.onAuthStateChanged(async m=>{if(!m){r("login"),e(!1);return}await l(m)});return()=>h()},[l]),{isLoading:n,initialScreen:t,userData:s,globalError:a,checkUserStatus:l,resetAuthState:d}}async function AO(n){const r=(await lo(qd,"setNickname")({nickname:n})).data;if(!r?.success)throw new Error("  .");return r.nickname}async function CO(){if(!(await lo(qd,"completeOnboarding")({})).data?.success)throw new Error("   .")}async function SO(n){if(!n)return null;const e=St(me,"users"),t=zn(e,jr("nickname","==",n)),r=await jn(t);if(r.empty)return null;const s=r.docs[0],i=s.data();return{uid:s.id,nickname:i?.nickname??n,photoURL:i?.photoURL??""}}async function RO(n){if(!n)return{followerCount:0,followingCount:0,followingNicknames:[]};const e=Se(me,"users",n),t=await Qn(e),r=(t.exists()?t.data():{})??{},s=typeof r.followerCount=="number"?r.followerCount:0,i=typeof r.followingCount=="number"?r.followingCount:0,a=St(me,"follows"),c=zn(a,jr("followerUid","==",n)),l=await jn(c),d=new Set;return l.forEach(h=>{const f=h.data()?.followingNickname;f&&d.add(f)}),{followerCount:s,followingCount:i,followingNicknames:Array.from(d)}}async function jO(n){const{currentUid:e,currentNickname:t,targetNickname:r}=n;if(!e)throw new Error("CURRENT_USER_REQUIRED");if(!r)throw new Error("TARGET_NICKNAME_REQUIRED");if(t===r)return{isFollowing:!1,followerCount:0,followingCount:0};const s=await SO(r);if(!s)throw new Error("TARGET_USER_NOT_FOUND");const i=`${e}_${s.uid}`,a=Se(me,"follows",i);return await S0(me,async l=>(await l.get(a)).exists()?(l.delete(a),{isFollowing:!1,followerCount:0,followingCount:0}):(l.set(a,{followerUid:e,followerNickname:t,followingUid:s.uid,followingNickname:s.nickname,createdAt:Sn()}),{isFollowing:!0,followerCount:0,followingCount:0}))}async function SI(n){if(!n)return[];const e=St(me,"follows"),t=zn(e,jr("followingUid","==",n)),r=await jn(t),s=new Set;return r.forEach(i=>{const c=i.data()?.followerNickname;c&&s.add(c)}),Array.from(s)}function PO(...n){return Qw(Yw(n))}const DO=Yf("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),se=y.forwardRef(({className:n,variant:e,size:t,asChild:r=!1,...s},i)=>{const a=r?zw:"button";return o.jsx(a,{className:PO(DO({variant:e,size:t}),n),ref:i,...s})});se.displayName="Button";function Je(...n){return Qw(Yw(n))}function Z({className:n,...e}){return o.jsx("div",{"data-slot":"card",className:Je("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",n),...e})}function ve({className:n,...e}){return o.jsx("div",{"data-slot":"card-header",className:Je("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",n),...e})}function Te({className:n,...e}){return o.jsx("h4",{"data-slot":"card-title",className:Je("leading-none",n),...e})}function ee({className:n,...e}){return o.jsx("div",{"data-slot":"card-content",className:Je("px-6 [&:last-child]:pb-6",n),...e})}function hc({className:n,...e}){return o.jsx(KT,{"data-slot":"checkbox",className:Je("peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",n),...e,children:o.jsx(QT,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:o.jsx(yc,{className:"size-3.5"})})})}function Nn({className:n,...e}){return o.jsx(DT,{"data-slot":"label",className:Je("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",n),...e})}function Of(){try{const n=localStorage.getItem("toastEnabled");return n===null?!0:n==="true"}catch(n){return console.error("Failed to get toast setting:",n),!0}}function OO(n){try{localStorage.setItem("toastEnabled",n.toString())}catch(e){console.error("Failed to save toast setting:",e)}}const oe={success:(n,e)=>{if(Of())return hs.success(n,e)},error:(n,e)=>hs.error(n,e),info:(n,e)=>{if(Of())return hs.info(n,e)},warning:(n,e)=>hs.warning(n,e),promise:hs.promise,loading:hs.loading,custom:hs.custom,message:hs.message,dismiss:hs.dismiss};var Gx;(function(n){n.IndexedDbLocal="INDEXED_DB_LOCAL",n.InMemory="IN_MEMORY",n.BrowserLocal="BROWSER_LOCAL",n.BrowserSession="BROWSER_SESSION"})(Gx||(Gx={}));var Kx;(function(n){n.APPLE="apple.com",n.FACEBOOK="facebook.com",n.GAME_CENTER="gc.apple.com",n.GITHUB="github.com",n.GOOGLE="google.com",n.MICROSOFT="microsoft.com",n.PLAY_GAMES="playgames.google.com",n.TWITTER="twitter.com",n.YAHOO="yahoo.com",n.PASSWORD="password",n.PHONE="phone"})(Kx||(Kx={}));const LO=rd("FirebaseAuthentication",{web:()=>_r(()=>import("./web-BocqmiDs.js"),__vite__mapDeps([6,1,2,3,4,5])).then(n=>new n.FirebaseAuthenticationWeb)}),Qx=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];async function VO(n){const e=lo(qd,"checkRejoinAllowed"),{data:t}=await e({email:n});return t}function MO({item:n}){const e=n.opacity<.2?"fadeInOut1":n.opacity<.25?"fadeInOut2":"fadeInOut3",t=y.useCallback(r=>{r&&(r.style.setProperty("--symbol-x",`${n.x}%`),r.style.setProperty("--symbol-y",`${n.y}%`),r.style.setProperty("--symbol-size",`${n.size}px`),r.style.setProperty("--symbol-animation",`${e} ${n.duration}s ease-in-out ${n.delay}s infinite both`))},[n.x,n.y,n.size,e,n.duration,n.delay]);return o.jsx("div",{className:"floating-symbol text-slate-600 dark:text-slate-400",ref:t,children:n.symbol},n.id)}function UO({onGoogleLogin:n,onShowTerms:e,onShowPrivacy:t,isDarkMode:r,onToggleDarkMode:s}){const i=y.useMemo(()=>Array.from({length:30},(k,C)=>({id:C,symbol:Qx[Math.floor(Math.random()*Qx.length)],x:Math.random()*100,y:Math.random()*100,size:16+Math.random()*24,duration:5+Math.random()*5,delay:Math.random()*8,opacity:.15+Math.random()*.2})),[]),[a,c]=y.useState(!1),[l,d]=y.useState(!1);y.useEffect(()=>{console.log("[LoginScreen] isLoggingIn :",l)},[l]),y.useEffect(()=>{console.log("[Debug] platform:",Li.getPlatform()),console.log("[Debug] isNative:",Li.isNativePlatform()),console.log("[Debug] FirebaseAuthentication available:",Li.isPluginAvailable("FirebaseAuthentication"))},[]);const h=y.useCallback(async()=>{if(!a||l)return;d(!0);const k=new $r;try{let C=null;if(Li.isNativePlatform()){console.log("[DEBUG] Starting native Google sign-in...");const I=await LO.signInWithGoogle();if(console.log("[DEBUG] signInWithGoogle result:",JSON.stringify(I,null,2)),!I?.credential?.idToken)throw console.error("[DEBUG] Missing idToken!"),new Error("Google  . ( )");console.log("[DEBUG] Got idToken, signing in to Firebase...");const E=$r.credential(I.credential.idToken),R=await hd(_e,E);console.log("[DEBUG] Firebase sign-in successful:",R.user.email),C=R.user}else C=(await uC(_e,k)).user;if(!C)throw new Error("    .");const b=C.email;if(!b)throw new Error("  .");const N=await VO(b);if(!N.allowed){const I=N.remainingDays??0;oe.error(`  .  : ${I}`),await nf(_e),d(!1);return}n(C)}catch(C){console.error("[ERROR]  :",C),C?.code&&console.error("[ERROR]  :",C.code,C.message,C.details),oe.error(C?.message||"   ."),await nf(_e)}finally{d(!1)}},[a,l,n]),m=y.useCallback(k=>{const C=!!k;c(C);try{typeof window<"u"&&"localStorage"in window&&(C?(window.localStorage.setItem("tosAccepted","true"),window.localStorage.setItem("privacyAccepted","true")):(window.localStorage.removeItem("tosAccepted"),window.localStorage.removeItem("privacyAccepted")))}catch{}},[]),f=y.useCallback(k=>{k.preventDefault(),e()},[e]),w=y.useCallback(k=>{k.preventDefault(),t()},[t]);return o.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center p-6 overflow-hidden bg-background text-foreground transition-colors duration-300",children:[s&&o.jsx("div",{className:"absolute top-4 right-4 z-50",children:o.jsx(se,{variant:"ghost",size:"icon",onClick:s,className:"rounded-full hover:bg-accent transition-colors",children:r?o.jsx(ro,{className:"w-5 h-5 text-yellow-500"}):o.jsx(so,{className:"w-5 h-5 text-slate-700 dark:text-slate-300"})})}),o.jsx("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none select-none opacity-60",children:i.map(k=>o.jsx(MO,{item:k},k.id))}),o.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none",children:o.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[o.jsxs("defs",{children:[o.jsxs("pattern",{id:"loginComplexGrid",x:"0",y:"0",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:[o.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"currentColor",strokeWidth:"1",className:"text-muted-foreground/20"}),o.jsx("circle",{cx:"20",cy:"20",r:"2",fill:"currentColor",className:"text-muted-foreground/20"})]}),o.jsx("pattern",{id:"loginDiagonalLines",x:"0",y:"0",width:"60",height:"60",patternUnits:"userSpaceOnUse",children:o.jsx("path",{d:"M 0 60 L 60 0",stroke:"currentColor",strokeWidth:"1",className:"text-muted-foreground/10"})})]}),o.jsx("rect",{width:"100%",height:"100%",fill:"url(#loginComplexGrid)"}),o.jsx("rect",{width:"100%",height:"100%",fill:"url(#loginDiagonalLines)"})]})}),o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[o.jsx("div",{className:"absolute top-20 left-10 w-3 h-3 bg-primary/20 animate-pulse transform rotate-45"}),o.jsx("div",{className:"absolute top-40 right-20 w-2 h-2 bg-primary/25 animate-bounce"}),o.jsx("div",{className:"absolute bottom-32 left-20 w-4 h-4 bg-primary/15 rotate-45 animate-spin custom-spin-8s"}),o.jsx("div",{className:"absolute bottom-20 right-10 w-2 h-2 bg-primary/20 animate-pulse delay-1000"}),o.jsx("div",{className:"absolute top-60 left-6 w-1 h-8 bg-primary/20 animate-pulse delay-500"}),o.jsx("div",{className:"absolute bottom-60 right-6 w-8 h-1 bg-primary/20 animate-pulse delay-700"}),o.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:o.jsxs("div",{className:"w-32 h-32 relative",children:[o.jsx("div",{className:"absolute top-0 left-1/2 w-1 h-1 bg-primary/30 animate-spin geometric-orbit-1"}),o.jsx("div",{className:"absolute top-0 left-1/2 w-1 h-1 bg-primary/25 animate-spin geometric-orbit-2"})]})})]}),o.jsx("div",{className:"relative z-10 w-full max-w-sm animate-in fade-in zoom-in duration-500",children:o.jsx(Z,{className:"w-full border-border/60 shadow-2xl bg-background",children:o.jsxs(ee,{className:"pt-8 pb-7 px-6 space-y-8",children:[o.jsx("div",{className:"flex flex-col items-center space-y-3",children:o.jsxs("div",{className:"text-center space-y-1",children:[o.jsx("h1",{className:"text-2xl font-bold tracking-tight bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent dark:from-white dark:to-gray-400",children:""}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"    "})]})}),o.jsx("div",{className:"space-y-3",children:o.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg bg-muted/30 border border-border/40 hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>m(!a),children:[o.jsx(hc,{id:"terms",checked:a,onCheckedChange:k=>m(k),className:"mt-0.5 data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),o.jsxs("div",{className:"grid gap-1.5 leading-none",children:[o.jsx(Nn,{htmlFor:"terms",className:"text-sm font-medium leading-snug cursor-pointer select-none",children:"   ()"}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:[o.jsx("button",{type:"button",className:"underline decoration-muted-foreground/50 hover:text-primary hover:decoration-primary underline-offset-2 transition-all",onClick:f,children:""}),""," ",o.jsx("button",{type:"button",className:"underline decoration-muted-foreground/50 hover:text-primary hover:decoration-primary underline-offset-2 transition-all",onClick:w,children:""}),"  ."]})]})]})}),o.jsx(se,{className:"w-full h-12 text-base font-medium transition-all hover:scale-[1.02] active:scale-[0.98]",variant:a?"default":"secondary",disabled:!a||l,onClick:h,children:l?o.jsxs("div",{className:"flex items-center justify-center gap-2",children:[o.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),o.jsx("span",{children:" ..."})]}):o.jsxs("div",{className:"flex items-center justify-center gap-2",children:[o.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[o.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),o.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),o.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.84z"}),o.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),o.jsx("span",{children:"Google  "})]})}),o.jsx("p",{className:"text-xs text-muted-foreground/60 text-center",children:" 2024 BiyuNote. All rights reserved."})]})})})]})}const hl=y.forwardRef(({className:n,type:e,...t},r)=>o.jsx("input",{type:e,ref:r,"data-slot":"input",className:Je("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",n),...t}));hl.displayName="Input";const fl=y.forwardRef(({className:n,...e},t)=>o.jsx(Xw,{ref:t,"data-slot":"avatar",className:Je("relative flex size-10 shrink-0 overflow-hidden rounded-full",n),...e}));fl.displayName=Xw.displayName;const Pp=y.forwardRef(({className:n,...e},t)=>o.jsx(Jw,{ref:t,"data-slot":"avatar-image",className:Je("aspect-square size-full",n),...e}));Pp.displayName=Jw.displayName;const ml=y.forwardRef(({className:n,...e},t)=>o.jsx(Zw,{ref:t,"data-slot":"avatar-fallback",className:Je("bg-muted flex size-full items-center justify-center rounded-full",n),...e}));ml.displayName=Zw.displayName;const FO=["","","","","","",""," ","","","","","","","","","","","1","","","1",""];function Yx(n){return(n||"").toLowerCase().replace(/[0-9\s~!@#$%^&*()\-_=+\[\]{};:'",.<>/?\\|`]/g,"")}function Qu(n){const e=Yx(n);return e?FO.some(t=>{const r=Yx(t);return r?e.includes(r):!1}):!1}const Xx=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function BO({item:n}){const e=n.opacity<.2?"fadeInOut1":n.opacity<.25?"fadeInOut2":"fadeInOut3",t=y.useCallback(r=>{r&&(r.style.setProperty("--symbol-x",`${n.x}%`),r.style.setProperty("--symbol-y",`${n.y}%`),r.style.setProperty("--symbol-size",`${n.size}px`),r.style.setProperty("--symbol-animation",`${e} ${n.duration}s ease-in-out ${n.delay}s infinite both`))},[n.x,n.y,n.size,e,n.duration,n.delay]);return o.jsx("div",{className:"floating-symbol text-slate-600 dark:text-slate-400",ref:t,children:n.symbol},n.id)}function zO({onBack:n,onComplete:e,userEmail:t,isDarkMode:r,onToggleDarkMode:s}){const[i,a]=y.useState(""),[c,l]=y.useState(""),[d,h]=y.useState(!1),m=y.useMemo(()=>Array.from({length:30},(I,E)=>({id:E,symbol:Xx[Math.floor(Math.random()*Xx.length)],x:Math.random()*100,y:Math.random()*100,size:16+Math.random()*24,duration:5+Math.random()*5,delay:Math.random()*8,opacity:.15+Math.random()*.2})),[]),f=y.useCallback(I=>{a(I.target.value),l("")},[]),[w,k]=y.useState(!1),C=y.useCallback(async()=>{if(d)return;const I=i.trim();if(I.length<2||I.length>12){l(" 2~12 .");return}if(!/^[-a-zA-Z0-9]+$/.test(I)){l(", ,    .");return}if(Qu(I)){l("   .");return}h(!0);try{const E=zn(St(me,"users"),jr("nickname","==",I),Md(1));if(!(await jn(E)).empty){l("   ."),h(!1);return}h(!1),k(!0)}catch(E){console.error("   :",E),l("    .    ."),h(!1)}},[i,d]),b=y.useCallback(()=>{e(i.trim())},[e,i]),N=y.useCallback(()=>{const I=["","","","","","",""],E=I[Math.floor(Math.random()*I.length)]+(Math.floor(Math.random()*9e3)+1e3);a(E),l("")},[]);return o.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center p-6 overflow-hidden bg-background text-foreground transition-colors duration-300",children:[s&&o.jsx("div",{className:"absolute top-4 right-4 z-50",children:o.jsx(se,{variant:"ghost",size:"icon",onClick:s,className:"rounded-full hover:bg-accent transition-colors",children:r?o.jsx(ro,{className:"w-5 h-5 text-yellow-500"}):o.jsx(so,{className:"w-5 h-5 text-slate-700 dark:text-slate-300"})})}),o.jsx("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none select-none opacity-60",children:m.map(I=>o.jsx(BO,{item:I},I.id))}),o.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none",children:o.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[o.jsxs("defs",{children:[o.jsxs("pattern",{id:"nicknameComplexGrid",x:"0",y:"0",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:[o.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"currentColor",strokeWidth:"1",className:"text-muted-foreground/20"}),o.jsx("circle",{cx:"20",cy:"20",r:"2",fill:"currentColor",className:"text-muted-foreground/20"})]}),o.jsx("pattern",{id:"nicknameDiagonalLines",x:"0",y:"0",width:"60",height:"60",patternUnits:"userSpaceOnUse",children:o.jsx("path",{d:"M 0 60 L 60 0",stroke:"currentColor",strokeWidth:"1",className:"text-muted-foreground/10"})})]}),o.jsx("rect",{width:"100%",height:"100%",fill:"url(#nicknameComplexGrid)"}),o.jsx("rect",{width:"100%",height:"100%",fill:"url(#nicknameDiagonalLines)"})]})}),o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[o.jsx("div",{className:"absolute top-20 left-10 w-3 h-3 bg-primary/20 animate-pulse transform rotate-45"}),o.jsx("div",{className:"absolute top-40 right-20 w-2 h-2 bg-primary/25 animate-bounce"}),o.jsx("div",{className:"absolute bottom-32 left-20 w-4 h-4 bg-primary/15 rotate-45 animate-spin custom-spin-8s"}),o.jsx("div",{className:"absolute bottom-20 right-10 w-2 h-2 bg-primary/20 animate-pulse delay-1000"}),o.jsx("div",{className:"absolute top-60 left-6 w-1 h-8 bg-primary/20 animate-pulse delay-500"}),o.jsx("div",{className:"absolute bottom-60 right-6 w-8 h-1 bg-primary/20 animate-pulse delay-700"}),o.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:o.jsxs("div",{className:"w-32 h-32 relative",children:[o.jsx("div",{className:"absolute top-0 left-1/2 w-1 h-1 bg-primary/30 animate-spin geometric-orbit-1"}),o.jsx("div",{className:"absolute top-0 left-1/2 w-1 h-1 bg-primary/25 animate-spin geometric-orbit-2"})]})})]}),o.jsx("div",{className:"relative z-10 w-full max-w-sm animate-in fade-in zoom-in duration-500",children:o.jsxs(Z,{className:"w-full border-border/60 shadow-2xl bg-background",children:[o.jsx(ve,{className:"pb-4",children:o.jsxs("div",{className:"w-full relative",children:[o.jsx(se,{variant:"ghost",size:"icon",className:"absolute left-0 top-0 rounded-full text-muted-foreground hover:text-foreground hover:bg-accent -ml-2",onClick:n,children:o.jsx(Gn,{className:"w-6 h-6"})}),o.jsxs("div",{className:"flex flex-col items-center text-center space-y-4 pt-2",children:[o.jsxs("div",{className:"relative group cursor-default",children:[o.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-blue-100 to-purple-100 rounded-full blur opacity-40 group-hover:opacity-60 transition duration-500"}),o.jsxs(fl,{className:"w-24 h-24 border-4 border-background shadow-xl relative ring-2 ring-primary/20",children:[o.jsx(Pp,{src:`https://api.dicebear.com/7.x/notionists/svg?seed=${i||"user"}&backgroundColor=transparent`}),o.jsx(ml,{className:"text-3xl bg-gradient-to-br from-primary via-primary/80 to-primary/60 text-primary-foreground font-bold",children:i?i.charAt(0).toUpperCase():"?"})]})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("h1",{className:"text-2xl font-bold tracking-tight bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent dark:from-white dark:to-gray-400",children:" "}),o.jsxs("p",{className:"text-sm text-muted-foreground",children:["   ",t&&o.jsxs("span",{className:"block mt-1 text-xs opacity-70 font-mono",children:["(",t,")"]})]})]})]})]})}),o.jsxs(ee,{className:"pt-2 pb-6 px-6 space-y-6",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(Nn,{htmlFor:"nickname",className:"text-sm font-medium leading-snug",children:""}),o.jsxs("div",{className:"relative",children:[o.jsx(hl,{id:"nickname",value:i,onChange:f,placeholder:" ",className:`pr-10 ${c?"border-destructive focus-visible:ring-destructive":""}`,maxLength:12,onKeyDown:I=>{I.key==="Enter"&&C()}}),!c&&i.length>=2&&o.jsx(yc,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-green-500"})]}),o.jsx("div",{className:"h-4 text-xs",children:c?o.jsxs("span",{className:"text-destructive flex items-center gap-1",children:[o.jsx(Gh,{className:"w-3 h-3"})," ",c]}):o.jsx("span",{className:"text-muted-foreground",children:d?"  ...":"2~12 , , "})})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx(se,{onClick:C,disabled:i.length<2||d,className:"w-full h-12 text-base font-medium transition-all hover:scale-[1.02] active:scale-[0.98]",children:d?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),o.jsx("span",{children:" ..."})]}):o.jsx("span",{children:""})}),o.jsx(se,{variant:"ghost",className:"w-full text-muted-foreground hover:text-foreground hover:bg-accent",onClick:N,children:"  "})]})]})]})}),w&&o.jsx("div",{className:"fixed inset-0 z-[999] bg-black/60 backdrop-blur-sm flex items-center justify-center px-4",children:o.jsxs("div",{className:"w-[360px] max-w-full rounded-2xl border border-border/60 bg-card shadow-2xl shadow-black/20 p-6 space-y-5",children:[o.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center shrink-0 mb-1",children:o.jsx(yc,{className:"w-6 h-6 text-primary"})}),o.jsxs("div",{className:"space-y-1",children:[o.jsxs("p",{className:"text-lg font-semibold text-foreground",children:[o.jsxs("span",{className:"text-primary",children:['"',i.trim(),'"']}),"()",o.jsx("br",{}),"?"]}),o.jsxs("p",{className:"text-sm text-muted-foreground leading-relaxed break-keep",children:["      .",o.jsx("br",{})," ."]})]})]}),o.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2",children:[o.jsx("button",{className:"flex-1 h-11 rounded-xl border border-input bg-background hover:bg-accent hover:text-accent-foreground text-foreground font-medium transition-colors text-sm",onClick:()=>k(!1),children:""}),o.jsx("button",{className:"flex-1 h-11 rounded-xl bg-primary text-primary-foreground hover:bg-primary/90 font-medium shadow-lg shadow-primary/20 transition-colors text-sm",onClick:b,children:""})]})]})})]})}const Bs={stroke:"currentColor",fill:"none",display:"block"};function RI({onBack:n,onContinue:e,isAlreadyAgreed:t=!1,hideBackButton:r=!1,disableBack:s=!1,isDarkMode:i,onToggleDarkMode:a}){const[c,l]=y.useState(t),[d,h]=y.useState(t),[m,f]=y.useState(t),w=y.useMemo(()=>c&&d&&m,[c,d,m]),k=y.useCallback(()=>{e&&w?e():n()},[e,w,n]),C=y.useCallback(I=>{t||l(I===!0)},[t]),b=y.useCallback(I=>{t||h(I===!0)},[t]),N=y.useCallback(I=>{t||f(I===!0)},[t]);return o.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[!r&&o.jsx(se,{variant:"ghost",size:"icon",onClick:n,className:"touch-target transition-transform active:scale-95",children:o.jsx(Gn,{className:"w-5 h-5",style:Bs})}),o.jsxs("h1",{className:"flex items-center gap-2 font-semibold",children:[o.jsx(gu,{className:"w-5 h-5",style:Bs}),"  "]})]}),a&&o.jsx(se,{variant:"ghost",size:"icon",onClick:a,className:"rounded-full hover:bg-accent transition-colors",children:i?o.jsx(ro,{className:"w-5 h-5 text-yellow-500"}):o.jsx(so,{className:"w-5 h-5 text-slate-700 dark:text-slate-300"})})]})})}),o.jsx("div",{className:"flex-1 scroll-container no-scrollbar",children:o.jsxs("div",{className:"p-4 space-y-6 pb-24",children:[o.jsxs(Z,{className:"border-primary/30 bg-primary/5",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center gap-2",children:[o.jsx(Gh,{className:"w-5 h-5",style:Bs})," "]})}),o.jsxs(ee,{className:"space-y-3 leading-relaxed",children:[o.jsx("p",{className:"text-lg font-medium",children:"  "}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"    ,       .         ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center gap-2",children:[o.jsx(rE,{className:"w-5 h-5 text-green-600 dark:text-green-400",style:Bs}),"1.  "]})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{className:"font-medium",children:"      ."}),o.jsxs("ul",{className:"space-y-2 list-disc pl-5 text-muted-foreground",children:[o.jsx("li",{children:"  .   ."}),o.jsx("li",{children:"     ."}),o.jsx("li",{children:"   ,   ."}),o.jsx("li",{children:"    ."})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center gap-2",children:[o.jsx(Gh,{className:"w-5 h-5 text-blue-600 dark:text-blue-400",style:Bs}),"2.   "]})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{className:"font-medium",children:"    ,    ."}),o.jsxs("ul",{className:"space-y-2 list-disc pl-5 text-muted-foreground",children:[o.jsx("li",{children:"      ."}),o.jsx("li",{children:"    ."}),o.jsx("li",{children:"    ."}),o.jsx("li",{children:"     ."})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center gap-2",children:[o.jsx(gu,{className:"w-5 h-5 text-purple-600 dark:text-purple-400",style:Bs}),"3.   "]})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{className:"font-medium",children:"    ."}),o.jsxs("ul",{className:"space-y-2 list-disc pl-5 text-muted-foreground",children:[o.jsx("li",{children:"    ."}),o.jsx("li",{children:"   ."}),o.jsx("li",{children:"      ."}),o.jsx("li",{children:"     ."})]})]})]}),o.jsxs(Z,{className:"border-destructive/30 bg-destructive/5",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center gap-2 text-destructive",children:[o.jsx(sE,{className:"w-5 h-5",style:Bs}),"4.  "]})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{className:"font-medium text-destructive",children:"   ."}),o.jsxs("ul",{className:"space-y-2 list-disc pl-5 text-muted-foreground",children:[o.jsx("li",{children:", ,  "}),o.jsx("li",{children:"  "}),o.jsx("li",{children:",  "}),o.jsx("li",{children:"  "}),o.jsx("li",{children:"  (  )"}),o.jsx("li",{children:"  "})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center gap-2",children:[o.jsx(Xf,{className:"w-5 h-5 text-orange-600 dark:text-orange-400",style:Bs}),"5.   "]})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{className:"font-medium",children:"      ."}),o.jsxs("ul",{className:"space-y-2 list-disc pl-5 text-muted-foreground",children:[o.jsx("li",{children:"  ."}),o.jsx("li",{children:"      ."}),o.jsx("li",{children:"      ."}),o.jsx("li",{children:"  ,  ."})]})]})]}),o.jsx(Z,{className:"border-primary/30 bg-primary/5",children:o.jsxs(ee,{className:"pt-6 space-y-2 text-center",children:[o.jsx("p",{className:"text-base font-medium",children:"   "}),o.jsxs("p",{className:"text-sm text-muted-foreground leading-relaxed",children:["    .",o.jsx("br",{}),"  ,  !"]})]})})]})}),e&&o.jsxs("div",{className:"bg-background/95 backdrop-blur-xl border-t border-border p-4 space-y-4 safe-nav-bottom flex-shrink-0 mb-4",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg border border-border hover:border-primary/30 active:border-primary/40 active:bg-primary/5 transition-colors transition-transform active:scale-[0.99]",children:[o.jsx(hc,{id:"agreement1",checked:c,onCheckedChange:C,disabled:t,className:"mt-0.5"}),o.jsxs(Nn,{htmlFor:"agreement1",className:"flex-1 cursor-pointer leading-relaxed",children:[o.jsx("span",{className:"font-medium",children:"   "}),o.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"   ,    ."})]})]}),o.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg border border-border hover:border-primary/30 active:border-primary/40 active:bg-primary/5 transition-colors transition-transform active:scale-[0.99]",children:[o.jsx(hc,{id:"agreement2",checked:d,onCheckedChange:b,disabled:t,className:"mt-0.5"}),o.jsxs(Nn,{htmlFor:"agreement2",className:"flex-1 cursor-pointer leading-relaxed",children:[o.jsx("span",{className:"font-medium",children:"   "}),o.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"     ."})]})]}),o.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg border border-border hover:border-primary/30 active:border-primary/40 active:bg-primary/5 transition-colors transition-transform active:scale-[0.99]",children:[o.jsx(hc,{id:"agreement3",checked:m,onCheckedChange:N,disabled:t,className:"mt-0.5"}),o.jsxs(Nn,{htmlFor:"agreement3",className:"flex-1 cursor-pointer leading-relaxed",children:[o.jsx("span",{className:"font-medium",children:"  "}),o.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"     ."})]})]})]}),!w&&!t&&o.jsx("div",{className:"text-center text-sm text-destructive",children:"  "}),o.jsx(se,{onClick:k,disabled:!w&&!t,className:"w-full transition-transform active:scale-95 disabled:active:scale-100",size:"lg",children:" "})]}),!e&&o.jsx("div",{className:"bg-background/95 backdrop-blur-xl border-t border-border p-6 pb-8 safe-nav-bottom flex-shrink-0 mb-4",children:o.jsx(se,{onClick:n,className:"w-full transition-transform active:scale-95",size:"lg",children:""})})]})}const $O=Object.freeze(Object.defineProperty({__proto__:null,CommunityGuidelinesScreen:RI},Symbol.toStringTag,{value:"Module"}));function Ts(n){const{className:e,...t}=n;return o.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[o.jsx("path",{d:"M8 6h8l1 2v8c0 1.1-0.9 2-2 2H9c-1.1 0-2-0.9-2-2V8l1-2z"}),o.jsx("path",{d:"M7 6c0-1.1 0.9-2 2-2h6c1.1 0 2 0.9 2 2v0.5H7V6z"}),o.jsx("rect",{x:"10",y:"2",width:"4",height:"2",rx:"0.5"}),o.jsx("circle",{cx:"12",cy:"12",r:"2.5"}),o.jsx("rect",{x:"11.5",y:"9.5",width:"1",height:"5",rx:"0.5"}),o.jsx("rect",{x:"9.5",y:"11.5",width:"5",height:"1",rx:"0.5"}),o.jsx("rect",{x:"11.5",y:"18",width:"1",height:"2",rx:"0.5"})]})}function pr(n){return o.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",...n,children:[o.jsx("path",{d:"M8 6h8l1 2v8c0 1-1 2-2 2H9c-1 0-2-1-2-2V8l1-2z",fillOpacity:.8}),o.jsx("path",{d:"M7 6c0-1 1-2 2-2h6c1 0 2 1 2 2z"}),o.jsx("rect",{x:"10",y:"2",width:"4",height:"2"}),o.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor",fillOpacity:.3}),o.jsx("rect",{x:"11.5",y:"18",width:"1",height:"2"})]})}const Jx=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function qO({item:n}){const e=n.opacity<.2?"fadeInOut1":n.opacity<.25?"fadeInOut2":"fadeInOut3",t=y.useCallback(r=>{r&&(r.style.setProperty("--symbol-x",`${n.x}%`),r.style.setProperty("--symbol-y",`${n.y}%`),r.style.setProperty("--symbol-size",`${n.size}px`),r.style.setProperty("--symbol-animation",`${e} ${n.duration}s ease-in-out ${n.delay}s infinite both`))},[n.x,n.y,n.size,e,n.duration,n.delay]);return o.jsx("div",{className:"floating-symbol text-slate-600 dark:text-slate-400",ref:t,children:n.symbol})}function HO({nickname:n,onRestart:e,onStartApp:t,isDarkMode:r,onToggleDarkMode:s}){const i=y.useMemo(()=>Array.from({length:30},(a,c)=>({id:c,symbol:Jx[Math.floor(Math.random()*Jx.length)],x:Math.random()*100,y:Math.random()*100,size:16+Math.random()*24,duration:5+Math.random()*5,delay:Math.random()*8,opacity:.15+Math.random()*.2})),[]);return o.jsxs("div",{className:"w-full h-full bg-background text-foreground transition-colors duration-300 flex items-center justify-center relative overflow-hidden",children:[s&&o.jsx("div",{className:"absolute top-4 right-4 z-50",children:o.jsx(se,{variant:"ghost",size:"icon",onClick:s,className:"rounded-full hover:bg-accent transition-colors",children:r?o.jsx(ro,{className:"w-5 h-5 text-yellow-500"}):o.jsx(so,{className:"w-5 h-5 text-slate-700 dark:text-slate-300"})})}),o.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden opacity-60",children:i.map(a=>o.jsx(qO,{item:a},a.id))}),o.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none",children:o.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[o.jsxs("defs",{children:[o.jsxs("pattern",{id:"welcomeComplexGrid",x:"0",y:"0",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:[o.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"currentColor",strokeWidth:"1",className:"text-muted-foreground/20"}),o.jsx("circle",{cx:"20",cy:"20",r:"2",fill:"currentColor",className:"text-muted-foreground/20"})]}),o.jsx("pattern",{id:"welcomeDiagonalLines",x:"0",y:"0",width:"60",height:"60",patternUnits:"userSpaceOnUse",children:o.jsx("path",{d:"M 0 60 L 60 0",stroke:"currentColor",strokeWidth:"1",className:"text-muted-foreground/10"})})]}),o.jsx("rect",{width:"100%",height:"100%",fill:"url(#welcomeComplexGrid)"}),o.jsx("rect",{width:"100%",height:"100%",fill:"url(#welcomeDiagonalLines)"})]})}),o.jsxs(Z,{className:"w-full max-w-md bg-card/80 backdrop-blur-sm border-border/60 shadow-2xl relative z-10 animate-in fade-in zoom-in duration-500",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-background/50 via-transparent to-muted/30 pointer-events-none"}),o.jsxs(ee,{className:"pt-10 pb-8 px-8 flex flex-col items-center text-center space-y-6",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"absolute -inset-4 bg-primary/20 rounded-full blur-xl animate-pulse"}),o.jsx(fl,{className:"w-24 h-24 border-4 border-background shadow-xl relative ring-2 ring-primary/20",children:o.jsx(ml,{className:"text-3xl bg-gradient-to-br from-primary via-primary/80 to-primary/60 text-primary-foreground font-bold",children:n?n.charAt(0).toUpperCase():"?"})}),o.jsx("div",{className:"absolute -bottom-2 -right-2 bg-background p-1.5 rounded-full shadow-lg border border-border",children:o.jsx("div",{className:"bg-primary text-primary-foreground p-1 rounded-full",children:o.jsx(yc,{className:"w-4 h-4 stroke-[3]"})})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("h1",{className:"text-2xl font-bold tracking-tight text-foreground",children:[", ",o.jsx("span",{className:"text-primary",children:n}),"!"]}),o.jsxs("p",{className:"text-muted-foreground leading-relaxed",children:["   ",o.jsx("br",{}),"  ."]})]}),o.jsxs("div",{className:"w-full pt-4 space-y-3",children:[o.jsxs(se,{className:"w-full h-12 text-lg font-medium shadow-lg shadow-primary/20 bg-primary hover:bg-primary/90 text-primary-foreground transition-all hover:scale-[1.02] active:scale-[0.98] group relative overflow-hidden",onClick:t,children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/0 via-white/10 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"}),o.jsxs("span",{className:"flex items-center justify-center gap-2 relative",children:[o.jsx(Ts,{className:"w-5 h-5 fill-current"})," "]})]}),o.jsxs(se,{variant:"ghost",className:"w-full text-muted-foreground hover:text-foreground hover:bg-accent",onClick:e,children:[o.jsx(Kh,{className:"w-4 h-4 mr-2"}),""]})]})]})]})]})}const Js=new Map,la=new Map,qo=new Map,WO=50;function GO(){for(;Js.size>WO;){const n=Js.keys().next().value;if(!n)break;Js.delete(n),qo.delete(n);const e=la.get(n);e&&(e(),la.delete(n))}}const jI=300*1e3;function KO(){const n=Date.now();for(const[e,t]of qo.entries())if(n-t>jI){qo.delete(e),Js.delete(e);const r=la.get(e);r&&(r(),la.delete(e))}}let Zx=!1;function QO(){Zx||(Zx=!0,setInterval(KO,jI))}function ba(n){QO();const e=y.useMemo(()=>Array.from(new Set((n||[]).filter(i=>typeof i=="string"&&i.length>0))),[n]),t=y.useMemo(()=>e.join("|"),[e]),[r,s]=y.useState({});return y.useEffect(()=>{if(e.length===0){s({});return}let i=!1;const a=Date.now(),c={};return e.forEach(l=>{const d=Js.get(l);d&&(c[l]={nickname:d.nickname,profileImage:d.profileImage,currentTitleId:d.currentTitleId,profileDescription:d.profileDescription,role:d.role},qo.set(l,a))}),s(c),e.forEach(l=>{if(la.has(l))return;const d=Se(me,"users",l),h=fi(d,m=>{if(qo.set(l,Date.now()),!m.exists())Js.delete(l),qo.delete(l);else{const f=m.data(),w={nickname:typeof f.nickname=="string"?f.nickname:"",profileImage:typeof f.profileImage=="string"?f.profileImage:null,currentTitleId:typeof f.currentTitle=="string"?f.currentTitle:null,profileDescription:typeof f.profileDescription=="string"?f.profileDescription:null,role:f.role==="admin"||f.role==="user"?f.role:"user"};Js.set(l,w),GO()}if(!i){const f={};e.forEach(w=>{const k=Js.get(w);k&&(f[w]={nickname:k.nickname,profileImage:k.profileImage,currentTitleId:k.currentTitleId,profileDescription:k.profileDescription,role:k.role})}),s(f)}},m=>{console.error("[useUserProfiles] users   :",m)});la.set(l,h)}),()=>{i=!0}},[t]),r}function YO(){const n=_e.currentUser?.uid??null,e=ba(n?[n]:[]);return n?e[n]??null:null}const Yu=" ";function Hd(n,e){return e===!0||n===Yu}function Dp(n,e){return Hd(n,e)||!n?Yu:n}const PI=jp(xi,"asia-northeast3"),XO=lo(PI,"awardLumens"),JO=lo(PI,"purchaseTitle");function ew(n){const e={id:n.id,amount:n.amount,reason:n.reason,timestamp:n.timestamp};return n.achievementId!=null&&(e.achievementId=n.achievementId),n.titleId!=null&&(e.titleId=n.titleId),e}const Fa=100,DI="app_lumens",Ao={balance:0,totalEarned:0,totalSpent:0,transactions:[]};function ZO(){if(typeof window>"u")return null;try{if(!("localStorage"in window))return null}catch{return null}try{const n=window.localStorage.getItem(DI);if(!n)return null;const e=JSON.parse(n);if(!e||typeof e!="object")return null;const t=typeof e.balance=="number"&&!Number.isNaN(e.balance)?e.balance:0,r=typeof e.totalEarned=="number"&&!Number.isNaN(e.totalEarned)?e.totalEarned:0,s=typeof e.totalSpent=="number"&&!Number.isNaN(e.totalSpent)?e.totalSpent:0,i=Array.isArray(e.transactions)?e.transactions.map(a=>{if(!a)return null;const c=String(a.id??""),l=Number(a.amount??0),d=String(a.reason??""),h=Number(a.timestamp??0);return!c||!d||Number.isNaN(l)||Number.isNaN(h)?null:{id:c,amount:l,reason:d,timestamp:h,achievementId:a.achievementId,titleId:a.titleId}}).filter(a=>a!==null).sort((a,c)=>c.timestamp-a.timestamp):[];return{balance:t,totalEarned:r,totalSpent:s,transactions:i}}catch(n){return console.error(" localStorage    :",n),null}}function eL(){const[n,e]=y.useState(Ao);y.useEffect(()=>{const c=_e.currentUser?.uid;if(!c)return;let l=!1;return(async()=>{try{const h=Se(me,"users",c),m=await Qn(h);if(m.exists()){const k=m.data(),C={balance:typeof k.lumenBalance=="number"?k.lumenBalance:Ao.balance,totalEarned:typeof k.lumenTotalEarned=="number"?k.lumenTotalEarned:Ao.totalEarned,totalSpent:typeof k.lumenTotalSpent=="number"?k.lumenTotalSpent:Ao.totalSpent,transactions:Array.isArray(k.lumenTransactions)?k.lumenTransactions.map(b=>{if(!b)return null;const N=String(b.id??""),I=Number(b.amount??0),E=String(b.reason??""),R=Number(b.timestamp??0);return!N||!E||Number.isNaN(I)||Number.isNaN(R)?null:{id:N,amount:I,reason:E,timestamp:R,achievementId:b.achievementId,titleId:b.titleId}}).filter(b=>b!==null).sort((b,N)=>N.timestamp-b.timestamp).slice(0,Fa):[]};l||e(C);return}const f=ZO(),w=f??Ao;if(l||e({...w,transactions:w.transactions.slice(0,Fa)}),await $n(h,{lumenBalance:w.balance,lumenTotalEarned:w.totalEarned,lumenTotalSpent:w.totalSpent,lumenTransactions:w.transactions.slice(0,Fa).map(ew)},{merge:!0}),f)try{window.localStorage.removeItem(DI)}catch{}}catch(h){console.error(" Firestore  :",h)}})(),()=>{l=!0}},[]);const t=y.useCallback((c,l,d)=>{if(c<=0)return console.error(" 0   "),!1;if(!(_e.currentUser?.uid??null))return console.error("     "),!1;const m={id:Date.now().toString()+Math.random().toString(36).substr(2,9),amount:c,reason:l,timestamp:Date.now(),achievementId:d};return e(f=>{const w=[m,...f.transactions].slice(0,Fa);return{balance:f.balance+c,totalEarned:f.totalEarned+c,totalSpent:f.totalSpent,transactions:w}}),XO({amount:c,reason:l,achievementId:d}).then(f=>{const w=f.data;w.success||console.warn("[lumens] awardLumens  success=false .",w)}).catch(f=>{console.error("[lumens] awardLumens Cloud Function  ",f)}),!0},[]),r=y.useCallback((c,l,d)=>{if(c<=0)return console.error(" 0   "),!1;if(n.balance<c)return console.error(` ! : ${c}, : ${n.balance}`),!1;const h=_e.currentUser?.uid??null;if(!h)return console.error("     "),!1;const m={id:`${Date.now()}-${Math.random()}`,amount:-c,reason:l,timestamp:Date.now(),titleId:d};if(e(w=>{if(w.balance<c)return console.error(` ! : ${c}, : ${w.balance}`),w;const k=[m,...w.transactions].slice(0,Fa);return{balance:w.balance-c,totalEarned:w.totalEarned,totalSpent:w.totalSpent+c,transactions:k}}),d)return JO({titleId:d}).then(w=>{const k=w.data;k.success||console.warn("[lumens] purchaseTitle  success=false .",k)}).catch(w=>{console.error("[lumens] purchaseTitle Cloud Function  ",w)}),!0;const f=Se(me,"users",h);return _n(f,{lumenBalance:Cr(-c),lumenTotalSpent:Cr(c),lumenTransactions:UP(ew(m))}).catch(w=>{console.error(" Firestore  ():",w)}),!0},[n.balance]),s=y.useCallback(c=>n.transactions.some(l=>l.achievementId===c&&l.amount>0),[n.transactions]),i=y.useCallback((c=10)=>n.transactions.slice(0,c),[n.transactions]),a=y.useCallback(()=>{const c=_e.currentUser?.uid??null;if(e(Ao),c){const l=Se(me,"users",c);_n(l,{lumenBalance:0,lumenTotalEarned:0,lumenTotalSpent:0,lumenTransactions:[]}).catch(d=>{console.error(" Firestore  :",d)})}},[]);return{balance:n.balance,totalEarned:n.totalEarned,totalSpent:n.totalSpent,transactions:n.transactions,addLumens:t,spendLumens:r,hasReceivedRewardForAchievement:s,getRecentTransactions:i,resetLumens:a}}const Lf=[{id:"first_explore",name:" ",description:"    ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:1},reward:{lumens:0}},{id:"first_share",name:" ",description:"     ",category:"share",hidden:!1,condition:{type:"share_post_count",target:1},reward:{lumens:0}},{id:"first_reply",name:" ",description:"   ",category:"reply",hidden:!1,condition:{type:"reply_count",target:1},reward:{lumens:0}},{id:"first_guide",name:" ",description:"   -     ",category:"guide",hidden:!1,condition:{type:"guide_count",target:1},reward:{lumens:0}},{id:"first_lantern_received",name:" ",description:"  ",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:1},reward:{lumens:0}},{id:"first_login_streak",name:" ",description:" 3 ",category:"streak",hidden:!1,condition:{type:"login_streak",target:3},reward:{lumens:0}},{id:"explore_seeker",name:"",description:"  10 ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:10},reward:{lumens:0,specialTitle:""}},{id:"explore_inquirer",name:"",description:"  30 ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:30},reward:{lumens:1,specialTitle:""}},{id:"explore_investigator",name:"",description:"  100 ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:100},reward:{lumens:3,specialTitle:""}},{id:"explore_philosopher",name:"",description:"  300 ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:300},reward:{lumens:5,specialTitle:""}},{id:"reply_helper",name:"",description:" 10    10  -     ",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:10,minLanterns:10},reward:{lumens:0,specialTitle:""}},{id:"reply_advisor",name:"",description:" 10    30  -     ",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:30,minLanterns:10},reward:{lumens:1,specialTitle:""}},{id:"reply_mentor",name:"",description:" 10    100  -    ",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:100,minLanterns:10},reward:{lumens:3,specialTitle:""}},{id:"reply_scholar",name:"",description:" 10    300  -     ",category:"reply",hidden:!1,condition:{type:"quality_reply_count",target:300,minLanterns:10},reward:{lumens:5,specialTitle:""}},{id:"guide_guide",name:"",description:" 5  -    ",category:"guide",hidden:!1,condition:{type:"guide_count",target:5},reward:{lumens:0,specialTitle:""}},{id:"guide_navigator",name:"",description:" 20  -    ",category:"guide",hidden:!1,condition:{type:"guide_count",target:20},reward:{lumens:1,specialTitle:""}},{id:"guide_pathfinder",name:"",description:" 50  -    ",category:"guide",hidden:!1,condition:{type:"guide_count",target:50},reward:{lumens:3,specialTitle:""}},{id:"guide_luminary",name:"",description:" 100  -   ",category:"guide",hidden:!1,condition:{type:"guide_count",target:100},reward:{lumens:5,specialTitle:""}},{id:"lantern_candle",name:"",description:" 50  -      ",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:50},reward:{lumens:0,specialTitle:""}},{id:"lantern_campfire",name:"",description:" 200  -      ",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:200},reward:{lumens:1,specialTitle:""}},{id:"lantern_lantern",name:"",description:" 500  -     ",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:500},reward:{lumens:3,specialTitle:""}},{id:"lantern_furnace",name:"",description:" 1500  -    ",category:"lantern",hidden:!1,condition:{type:"lanterns_received",target:1500},reward:{lumens:5,specialTitle:""}},{id:"share_sharer",name:"",description:" 3      10 ",category:"share",hidden:!1,condition:{type:"share_post_count",target:10,minLanterns:3},reward:{lumens:0,specialTitle:""}},{id:"share_curator",name:"",description:" 3      30 ",category:"share",hidden:!1,condition:{type:"share_post_count",target:30,minLanterns:3},reward:{lumens:1,specialTitle:""}},{id:"share_publisher",name:"",description:" 3      100 ",category:"share",hidden:!1,condition:{type:"share_post_count",target:100,minLanterns:3},reward:{lumens:3,specialTitle:""}},{id:"share_archivist",name:" ",description:" 3      300 ",category:"share",hidden:!1,condition:{type:"share_post_count",target:300,minLanterns:3},reward:{lumens:5,specialTitle:" "}},{id:"streak_visitor",name:"",description:" 7 ",category:"streak",hidden:!1,condition:{type:"login_streak",target:7},reward:{lumens:0,specialTitle:""}},{id:"streak_regular",name:"",description:" 30 ",category:"streak",hidden:!1,condition:{type:"login_streak",target:30},reward:{lumens:0,specialTitle:""}},{id:"streak_resident",name:"",description:" 100 ",category:"streak",hidden:!1,condition:{type:"login_streak",target:100},reward:{lumens:0,specialTitle:""}},{id:"streak_pillar",name:"",description:" 365 ",category:"streak",hidden:!1,condition:{type:"login_streak",target:365},reward:{lumens:0,specialTitle:""}},{id:"captain_captain",name:"",description:" 100 ",category:"captain",hidden:!1,condition:{type:"follower_count",target:100},reward:{lumens:0,specialTitle:""}},{id:"economy_analyst",name:" ",description:"   5    40 ",category:"economy",hidden:!1,condition:{type:"category_quality_reply",target:40,minAverageLanterns:5},reward:{lumens:2,specialTitle:" "}},{id:"economy_expert",name:" ",description:"   10    150 ",category:"economy",hidden:!1,condition:{type:"category_quality_reply",target:150,minAverageLanterns:10},reward:{lumens:5,specialTitle:" "}},{id:"it_consultant",name:" ",description:"IT   5    40 ",category:"it",hidden:!1,condition:{type:"category_quality_reply",target:40,minAverageLanterns:5},reward:{lumens:2,specialTitle:" "}},{id:"it_expert",name:" ",description:"IT   10    150 ",category:"it",hidden:!1,condition:{type:"category_quality_reply",target:150,minAverageLanterns:10},reward:{lumens:5,specialTitle:" "}},{id:"language_tutor",name:" ",description:"   5    40 ",category:"language",hidden:!1,condition:{type:"category_quality_reply",target:40,minAverageLanterns:5},reward:{lumens:2,specialTitle:" "}},{id:"language_expert",name:" ",description:"   10    150 ",category:"language",hidden:!1,condition:{type:"category_quality_reply",target:150,minAverageLanterns:10},reward:{lumens:5,specialTitle:" "}},{id:"engineering_curious",name:" ",description:"    10 ",category:"explore",hidden:!1,condition:{type:"category_explore_count",target:10},reward:{lumens:1,specialTitle:" "}},{id:"engineering_focused",name:" ",description:"    40 ",category:"reply",hidden:!0,condition:{type:"single_category_posts",target:40},reward:{lumens:2,specialTitle:" "}},{id:"engineering_first_light",name:"  ",description:"    ",category:"lantern",hidden:!1,condition:{type:"category_first_lantern",target:1},reward:{lumens:1,specialTitle:"  "}},{id:"engineering_destroyer",name:" ",description:"   50 ",category:"reply",hidden:!1,condition:{type:"category_reply_count",target:50},reward:{lumens:3,specialTitle:" "}},{id:"explore_brave_questioner",name:"  ",description:"    5  -      ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:5},reward:{lumens:1,specialTitle:"  "}},{id:"explore_steady_questioner",name:" ",description:"    20  -   ",category:"explore",hidden:!1,condition:{type:"explore_post_count",target:20},reward:{lumens:2,specialTitle:" "}},{id:"reply_challenger",name:" ",description:" ,      10  -    ",category:"reply",hidden:!1,condition:{type:"reply_count",target:10},reward:{lumens:1,specialTitle:" "}},{id:"reply_persistent_helper",name:"  ",description:"    50  -     ",category:"reply",hidden:!1,condition:{type:"reply_count",target:50},reward:{lumens:3,specialTitle:"  "}},{id:"lantern_giver_small",name:" ",description:"    50  -     ",category:"lantern",hidden:!1,condition:{type:"lanterns_given",target:50},reward:{lumens:1,specialTitle:" "}},{id:"lantern_giver_captain",name:"",description:"    200  -    ",category:"lantern",hidden:!1,condition:{type:"lanterns_given",target:200},reward:{lumens:3,specialTitle:""}}],Vf=[{id:"multi_specialist",name:" ",description:"3    ",category:"reply",hidden:!0,condition:{type:"multi_field_expert",target:3},reward:{lumens:10,specialTitle:" "}},{id:"discussion_expert",name:" ",description:"   15  ",category:"reply",hidden:!0,condition:{type:"discussion_exchanges",target:15},reward:{lumens:5,specialTitle:" "}},{id:"best_contributor",name:" ",description:"   100  ",category:"lantern",hidden:!0,condition:{type:"max_post_lanterns",target:100},reward:{lumens:10,specialTitle:" "}},{id:"community_fellow",name:" ",description:"   3  ",category:"guide",hidden:!0,condition:{type:"all_categories_tier3",target:1},reward:{lumens:15,specialTitle:" "}},{id:"honorary_scholar",name:" ",description:"   4() ",category:"guide",hidden:!0,condition:{type:"all_categories_tier4",target:1},reward:{lumens:50,specialTitle:" "}},{id:"lantern_giver",name:" ",description:"   500 ",category:"lantern",hidden:!0,condition:{type:"lanterns_given",target:500},reward:{lumens:3,specialTitle:" "}},{id:"diligent_visitor",name:" ",description:" 30  27  ",category:"streak",hidden:!0,condition:{type:"monthly_login_rate",target:27},reward:{lumens:0,specialTitle:" "}},{id:"popular_questioner",name:" ",description:"      30  ,     ",category:"explore",hidden:!0,condition:{type:"max_post_lanterns",target:30},reward:{lumens:2,specialTitle:" "}},{id:"specialized_replier",name:" ",description:"   300 ",category:"reply",hidden:!0,condition:{type:"single_category_replies",target:300},reward:{lumens:3,specialTitle:" "}}],tL=[...Lf,...Vf];function iU(n){return{guide:"",explore:"",share:" ",reply:"",lantern:"",streak:"",captain:"",economy:"",it:"IT",language:""}[n]}const Vo={explorePosts:0,sharePosts:0,replies:0,qualityReplies:0,lanternsReceived:0,lanternsGiven:0,guideCount:0,bookmarks:0,loginStreak:0,maxPostReplies:0,maxPostLanterns:0,maxDiscussionExchanges:0,followerCount:0},Xu={ACHIEVED_ACHIEVEMENTS:"app_achieved_achievements",USER_ACTIVITY:"app_user_activity"};function nL(){if(typeof window>"u")return null;try{const n=window.localStorage.getItem(Xu.ACHIEVED_ACHIEVEMENTS),e=window.localStorage.getItem(Xu.USER_ACTIVITY);if(!n&&!e)return null;let t=[],r={...Vo};if(n)try{const s=JSON.parse(n);Array.isArray(s)&&(t=s.map(i=>!i||typeof i!="object"||typeof i.achievementId!="string"||typeof i.achievedAt!="string"?null:{achievementId:i.achievementId,achievedAt:i.achievedAt,rewardClaimed:typeof i.rewardClaimed=="boolean"?i.rewardClaimed:!0}).filter(i=>i!==null))}catch(s){console.error("legacy achievedAchievements  :",s)}if(e)try{const s=JSON.parse(e);s&&typeof s=="object"&&(r={...Vo,...s})}catch(s){console.error("legacy userActivity  :",s)}return{achieved:t,activity:r}}catch(n){return console.error("legacy    :",n),null}}function rL(n,e){const[t,r]=y.useState([]),[s,i]=y.useState(Vo),[a,c]=y.useState(!1),l=y.useRef(!1),d=y.useCallback(E=>t.find(R=>R.achievementId===E),[t]);y.useEffect(()=>{const E=_e.currentUser?.uid;if(!E)return;let R=!1;return(async()=>{try{const O=Se(me,"users",E),g=await Qn(O);if(g.exists()){const S=g.data(),D=S.userActivity&&typeof S.userActivity=="object"?{...Vo,...S.userActivity}:{...Vo};let T=[];Array.isArray(S.achievedAchievements)&&(T=S.achievedAchievements.filter(L=>L&&typeof L.achievementId=="string"&&typeof L.achievedAt=="string").map(L=>({achievementId:L.achievementId,achievedAt:L.achievedAt,rewardClaimed:typeof L.rewardClaimed=="boolean"?L.rewardClaimed:!0}))),R||(i(D),r(T));return}const x=nL(),v=x?.activity??{...Vo},A=x?.achieved??[];if(R||(i(v),r(A)),await $n(O,{userActivity:v,achievedAchievements:A},{merge:!0}),x)try{window.localStorage.removeItem(Xu.USER_ACTIVITY),window.localStorage.removeItem(Xu.ACHIEVED_ACHIEVEMENTS)}catch{}}catch(O){console.error(" /   :",O)}finally{R||c(!0)}})(),()=>{R=!0}},[]),y.useEffect(()=>{const E=_e.currentUser?.uid;if(!E||!a)return;if(!l.current){l.current=!0;return}const R=Se(me,"users",E);_n(R,{userActivity:s,achievedAchievements:t}).catch(P=>{console.error(" / Firestore  :",P)})},[s,t,a]);const h=y.useCallback(E=>t.some(R=>R.achievementId===E),[t]),m=y.useCallback((E,R)=>{const{condition:P}=E;switch(P.type){case"explore_post_count":return R.explorePosts>=P.target;case"share_post_count":return R.sharePosts>=P.target;case"quality_reply_count":return R.qualityReplies>=P.target;case"reply_count":return R.replies>=P.target;case"lanterns_received":return R.lanternsReceived>=P.target;case"lanterns_given":return R.lanternsGiven>=P.target;case"guide_count":return R.guideCount>=P.target;case"bookmark_count":return R.bookmarks>=P.target;case"login_streak":return R.loginStreak>=P.target;case"follower_count":return R.followerCount>=P.target;case"discussion_exchanges":return R.maxDiscussionExchanges>=P.target;case"max_post_lanterns":return R.maxPostLanterns>=P.target;case"category_quality_reply":return E.category==="economy"?(R.economyReplies||0)>=P.target&&(R.economyAverageLanterns||0)>=(P.minAverageLanterns||0):E.category==="it"?(R.itReplies||0)>=P.target&&(R.itAverageLanterns||0)>=(P.minAverageLanterns||0):E.category==="language"?(R.languageReplies||0)>=P.target&&(R.languageAverageLanterns||0)>=(P.minAverageLanterns||0):!1;case"multi_field_expert":return(R.unlockedFieldExpertCount||0)>=P.target;case"all_categories_tier3":return(R.tier3AchievementsCount||0)>=6;case"all_categories_tier4":return(R.tier4AchievementsCount||0)>=6;case"category_explore_count":return(R.engineeringExplorePosts||0)>=P.target;case"single_category_posts":return(R.engineeringOnlyPosts||0)>=P.target;case"category_first_lantern":return R.engineeringFirstLanternReceived===!0;case"category_reply_count":return(R.engineeringTotalReplies||0)>=P.target;case"monthly_login_rate":return(R.monthlyLoginDays||0)>=P.target;case"own_post_guide_selected":return(R.ownPostGuideSelected||0)>=P.target;case"single_category_replies":return(R.singleCategoryMaxReplies||0)>=P.target;default:return!1}},[]),f=y.useCallback(E=>{const R=t.find(A=>A.achievementId===E.id);if(R&&R.rewardClaimed)return;const{reward:P}=E,O=!R||!R.rewardClaimed;O&&(P.lumens>0&&n&&n(P.lumens,` : ${E.name}`,E.id),P.specialTitle&&e&&e(E.id,P.specialTitle));const g=new Date().toISOString(),x=R?{...R,achievedAt:R.achievedAt||g,rewardClaimed:!0}:{achievementId:E.id,achievedAt:g,rewardClaimed:!0};r(A=>{const S=A.findIndex(T=>T.achievementId===E.id);if(S===-1)return[...A,x];const D=[...A];return D[S]=x,D});let v=`${E.name}  !`;O&&(P.lumens>0&&P.specialTitle?v+=` ( ${P.lumens} +  "${P.specialTitle}" )`:P.lumens>0?v+=` ( ${P.lumens} )`:P.specialTitle&&(v+=` (  "${P.specialTitle}" )`)),E.hidden?oe.success(`   ! 
${v}`,{duration:5e3}):oe.success(` ${v}`,{duration:4e3})},[t,n,e]),w=y.useCallback(E=>{tL.forEach(R=>{h(R.id)||m(R,E)&&f(R)})},[m,f,h]),k=y.useCallback(E=>{i(R=>{const P={...R,...E};return setTimeout(()=>{w(P)},100),P})},[w]),C=t.filter(E=>Lf.some(R=>R.id===E.achievementId)).length,b=t.filter(E=>Vf.some(R=>R.id===E.achievementId)).length,N=Lf.length,I=Vf.length;return{achievedAchievements:t,userActivity:s,isAchievementUnlocked:h,getAchievementInfo:d,updateActivity:k,checkAchievements:w,achievedNormalCount:C,achievedHiddenCount:b,normalCount:N,hiddenCount:I}}function sL(n){const{includeHidden:e=!1}={},[t,r]=y.useState([]);return y.useEffect(()=>{const s=St(me,"posts"),i=zn(s,fp("createdAt","desc")),a=fi(i,async c=>{const l=_e.currentUser?.uid??null,h=(await Promise.all(c.docs.map(async m=>{const f=m.data(),w=f.hidden===!0;if(w&&!e)return null;const k=f.createdAt&&typeof f.createdAt.toDate=="function"?f.createdAt.toDate():f.createdAt instanceof Date?f.createdAt:new Date;let C=[];Array.isArray(f.replies)&&(C=f.replies.filter(R=>!(R?.hidden===!0&&!e)).map(R=>{let P;if(R?.createdAt&&typeof R.createdAt.toDate=="function")P=R.createdAt.toDate();else if(R?.createdAt instanceof Date)P=R.createdAt;else if(typeof R?.createdAt=="string"||typeof R?.createdAt=="number"){const O=new Date(R.createdAt);P=Number.isNaN(O.getTime())?new Date:O}else P=new Date;return{id:typeof R.id=="number"||typeof R.id=="string"?R.id:Date.now(),content:R.content??"",author:R.author??"  ",authorUid:typeof R.authorUid=="string"?R.authorUid:null,authorAvatar:typeof R.authorAvatar=="string"?R.authorAvatar:null,timeAgo:R.timeAgo??"",lanterns:typeof R.lanterns=="number"?R.lanterns:0,isGuide:!!R.isGuide,createdAt:P,authorTitleId:R.authorTitleId??null,isAi:R.isAi===!0||typeof R.aiLabel=="string",aiLabel:typeof R.aiLabel=="string"?R.aiLabel:R.isAi===!0?"[AI ]":void 0,aiSummary:typeof R.aiSummary=="string"?R.aiSummary:void 0,aiSource:typeof R.aiSource=="string"?R.aiSource:void 0}}));let b=null,N=null;if(f.authorUid)try{const E=Se(me,"users",f.authorUid),R=await Qn(E);if(R.exists()){const P=R.data();b=P.currentTitle??null,P.currentTitleName&&(N=P.currentTitleName)}}catch(E){console.error("    :",E)}return{id:m.id,title:f.title??"",content:f.content??"",category:f.category??"",subCategory:f.subCategory??"",type:f.type??"question",tags:Array.isArray(f.tags)?f.tags:[],author:f.author??"  ",authorUid:f.authorUid??null,authorAvatar:f.authorAvatar??"",createdAt:k,lanterns:f.lanterns??0,replies:C,replyCount:typeof f.replyCount=="number"?f.replyCount:C.length,comments:typeof f.comments=="number"?f.comments:C.length,views:f.views??0,isBookmarked:!1,isOwner:l&&f.authorUid?l===f.authorUid:!1,authorTitleId:b,authorTitleName:N,hidden:w,reportCount:typeof f.reportCount=="number"?f.reportCount:void 0}}))).filter(m=>m!==null);r(h)},c=>{console.error("Firestore   :",c)});return()=>a()},[e]),{posts:t,setPosts:r}}const Ju={reply:{label:" ",defaultPriority:"normal",icon:""},lantern:{label:"",defaultPriority:"normal",icon:""},guide:{label:" ",defaultPriority:"high",icon:""},popular:{label:" ",defaultPriority:"normal",icon:""},follow:{label:" ",defaultPriority:"normal",icon:""},mention:{label:"",defaultPriority:"normal",icon:"@"},achievement:{label:"",defaultPriority:"normal",icon:""},system:{label:"",defaultPriority:"high",icon:""}},Zu={low:0,normal:1,high:2,urgent:3};function OI(n,e){const t=Ju[n]?.label??"",r=l=>{const d=(l??"").trim();return d?d===" "||d===" "||d==="  "?"  ":d:""},s=r(e?.userName),i=e?.lanternCount??1,a=r(e?.titleName),c=e?.lumenReward;switch(n){case"reply":return{title:t,message:`${s}    .`};case"lantern":return{title:t,message:i>1?`${s}  ${i-1}  .`:`${s}  .`};case"guide":return{title:t,message:c&&a?`${a}   . (+${c} )`:`${s}   .`};case"popular":return{title:t,message:"    ."};case"follow":return{title:t,message:`${s}  .`};case"mention":return{title:t,message:`${s}  .`};case"achievement":return{title:t,message:"  ."};case"system":return{title:t,message:"  ."};default:return{title:"",message:"  ."}}}function Wl(n){if(!n)return null;const e=/^(\d{1,2}):(\d{2})$/.exec(n.trim());if(!e)return null;const t=Number(e[1]),r=Number(e[2]);return Number.isNaN(t)||Number.isNaN(r)?null:t*60+r}function LI(n,e=new Date){if(!n)return!1;let t=!1,r=null,s=null;if(n.doNotDisturb){const a=n.doNotDisturb;t=!!a.enabled,typeof a.start=="string"&&typeof a.end=="string"&&(r=Wl(a.start),s=Wl(a.end)),(r==null||s==null)&&typeof a.startHour=="number"&&typeof a.endHour=="number"&&(r=a.startHour*60,s=a.endHour*60)}if((!t||r==null||s==null)&&n.dndEnabled&&typeof n.dndStart=="string"&&typeof n.dndEnd=="string"&&(t=!0,r=Wl(n.dndStart),s=Wl(n.dndEnd)),!t||r==null||s==null)return!1;const i=e.getHours()*60+e.getMinutes();return r===s?!1:r<s?i>=r&&i<s:i>=r||i<s}function tw(n,e){return e?n.filter(t=>{if(e.type&&e.type!=="all"&&t.type!==e.type||e.types&&e.types.length>0&&!e.types.includes(t.type)||e.onlyUnread&&t.read||typeof e.read=="boolean"&&t.read!==e.read)return!1;if(e.minPriority){const r=Zu[e.minPriority]??0;if((Zu[t.priority]??0)<r)return!1}return!0}):n}function iL(n){return n.reduce((e,t)=>t.read?e:e+1,0)}function oL(n){const e={};for(const t of n){const r=t.groupId??(t.data&&t.data.postId?`${t.type}:${String(t.data.postId)}`:t.id);e[r]||(e[r]=[]),e[r].push(t)}return e}function aL(n){return[...n].sort((e,t)=>{const r=Zu[e.priority]??0,s=Zu[t.priority]??0;return r!==s?s-r:t.timestamp-e.timestamp})}function cL(n){const e={id:n.id,type:n.type,priority:n.priority,title:n.title,message:n.message,timestamp:n.timestamp,read:n.read};return n.data!=null&&(e.data=n.data),n.action!=null&&(e.action=n.action),n.groupId!=null&&(e.groupId=n.groupId),e}const lL=n=>St(me,"user_notifications",n,"items"),uL=n=>Se(me,"user_notification_settings",n),dL=n=>Se(me,"users",n);async function hL(n){const e=await Qn(uL(n));return e.exists()?e.data():null}async function fL(n){const e=await Qn(dL(n));if(!e.exists())return null;const r=e.data().notificationSettings;if(!r||typeof r!="object")return null;const s=typeof r.allEnabled=="boolean"?r.allEnabled:!0,i=Array.isArray(r.enabledCategories)?r.enabledCategories:[];return{allEnabled:s,enabledCategories:i}}async function mL(n){const{toUserUid:e,fromUserUid:t,type:r,categoryId:s}=n;if(!e||t&&t===e)return!1;const i=await hL(e);if(i&&(!i.enabled||i.types&&i.types[r]===!1||LI(i)))return!1;if(s){const a=await fL(e);if(a){const{allEnabled:c,enabledCategories:l}=a;if(!c&&!l.includes(s))return!1}}return!0}async function ua(n){const{toUserUid:e,fromUserUid:t=null,type:r,categoryId:s=null,data:i,priority:a,groupId:c,action:l}=n;if(!e||!await mL(n))return null;const{title:h,message:m}=OI(r,i),f=Ju[r],w=Date.now(),k=lL(e),C=Se(k),b={id:C.id,type:r,priority:a??f.defaultPriority,title:h,message:m,timestamp:w,read:!1,data:i,action:l,groupId:c},N=cL(b);return await $n(C,{...N,toUserUid:e,fromUserUid:t??null,categoryId:s??null,createdAt:Sn()}),b}async function pL(n){const{toUserUid:e,fromUserUid:t,followerNickname:r,followerAvatar:s}=n,i={userId:t,userName:r,userAvatar:s??void 0};return s&&(i.userAvatar=s),ua({toUserUid:e,fromUserUid:t,type:"follow",data:i})}const nw=(n,e)=>St(me,"user_lanterns",n,e),rw=(n,e)=>Se(me,"user_lanterns",n,"posts",e),sw=(n,e)=>Se(me,"user_lanterns",n,"replies",String(e)),iw=(n,e,t)=>Se(me,"posts",n,"replyLanterns",`${e}_${t}`);function gL({posts:n,setPosts:e,selectedPost:t,setSelectedPost:r,userNickname:s,userActivity:i,updateActivity:a,userPostLanterns:c,setUserPostLanterns:l,userReplyLanterns:d,setUserReplyLanterns:h,addLumensWithTrust:m,updateTrust:f}){const[w,k]=y.useState(new Set),[C,b]=y.useState(new Set);y.useEffect(()=>{const P=_e.currentUser?.uid??null;if(!P)return;(async()=>{try{const x=(await jn(nw(P,"posts"))).docs.map(S=>S.id);k(new Set(x));const A=(await jn(nw(P,"replies"))).docs.map(S=>Number(S.id)).filter(S=>!Number.isNaN(S));b(new Set(A))}catch(g){console.error("   :",g)}})()},[]);const N=y.useCallback(async P=>{const O=String(P),g=new Set;w.forEach(S=>g.add(String(S)));const x=g.has(O),v=new Set(g);x?v.delete(O):v.add(O),k(v);const A=_e.currentUser?.uid??null;if(A)try{x?await $o(rw(A,O)):await $n(rw(A,O),{postId:O,createdAt:Sn()},{merge:!0})}catch(S){console.error("    :",S)}if(!x){const S=n.find(D=>String(D.id)===O);if(S){const D=_e.currentUser?.uid??null,T=typeof S.authorUid=="string"?S.authorUid:null;if(D&&T&&D!==T)try{await ua({toUserUid:T,fromUserUid:D,type:"lantern",categoryId:S.categoryId??S.category??null,data:{postId:S.id,userId:D,userName:s,lanternCount:1}})}catch(L){console.error("    :",L)}}oe.success(" ! ")}},[w,n,s]),I=y.useCallback(async(P,O)=>{const g=String(O),x=C.has(P),v=new Set(C);b(v);const A=_e.currentUser?.uid??null;if(A)try{x?(await $o(sw(A,P)),await $o(iw(g,P,A))):(await $n(sw(A,P),{replyId:P,postId:O,createdAt:Sn()},{merge:!0}),await $n(iw(g,P,A),{uid:A,replyId:P,postId:g,createdAt:Sn()},{merge:!0}))}catch(S){console.error("     :",S)}if(!x){const S=String(O),D=n.find(L=>L.id===S),T=D?.replies.find(L=>L.id===P);if(D&&T){const L=_e.currentUser?.uid??null,F=T.authorUid&&typeof T.authorUid=="string"?T.authorUid:null;if(L&&F&&L!==F)try{await ua({toUserUid:F,fromUserUid:L,type:"lantern",categoryId:D.categoryId??D.category??null,data:{postId:D.id,replyId:P,userId:L,userName:s,lanternCount:1}})}catch(G){console.error("    :",G)}}oe.success(" ! ")}},[C,n,s]),E=y.useCallback(P=>w.has(String(P)),[w]),R=y.useCallback(P=>C.has(P),[C]);return{lanternedPosts:w,lanternedReplies:C,handleLanternToggle:N,handleReplyLanternToggle:I,isPostLanterned:E,isReplyLanterned:R}}const ow=n=>St(me,"user_bookmarks",n,"posts"),aw=(n,e)=>Se(me,"user_bookmarks",n,"posts",String(e));function yL({userNickname:n}){const[e,t]=y.useState(new Set);y.useEffect(()=>{const i=_e.currentUser?.uid??null;if(!i)return;(async()=>{try{const l=(await jn(ow(i))).docs.map(d=>d.id);t(new Set(l))}catch(c){console.error("  :",c)}})()},[]),y.useEffect(()=>{const i=_e.currentUser?.uid??null;if(!i){t(new Set);return}(async()=>{try{const c=await jn(ow(i)),l=new Set;c.forEach(d=>{const h=d.data(),m=(h&&h.postId)??d.id;l.add(String(m))}),t(l)}catch(c){console.error("Firestore   :",c)}})()},[n]);const r=y.useCallback(async i=>{const a=String(i),c=e.has(a),l=_e.currentUser?.uid??null;if(t(d=>{const h=new Set(d);return c?h.delete(a):h.add(a),h}),l)try{if(c)await $o(aw(l,a)),oe.success(" ");else{let d=null,h=null;try{const m=await Qn(Se(me,"posts",a));if(m.exists()){const f=m.data();d=f?.category??null,h=f?.subCategory??null}}catch(m){console.warn("   ,  ",m)}await $n(aw(l,a),{postId:a,category:d,subCategory:h,createdAt:Sn()},{merge:!0}),oe.success(" ")}}catch(d){console.error("  :",d),t(h=>{const m=new Set(h);return c?m.add(a):m.delete(a),m}),oe.error("  ")}else oe.error(" "),t(d=>{const h=new Set(d);return c?h.add(a):h.delete(a),h})},[e]),s=y.useCallback(i=>e.has(String(i)),[e]);return{bookmarkedPosts:e,handleBookmarkToggle:r,isBookmarked:s}}const dt={setItem:(n,e)=>{try{localStorage.setItem(n,e)}catch(t){console.warn(`Failed to save ${n} to localStorage:`,t)}},getItem:n=>{try{return localStorage.getItem(n)}catch(e){return console.warn(`Failed to get ${n} from localStorage:`,e),null}},setJSON:(n,e)=>{try{localStorage.setItem(n,JSON.stringify(e))}catch(t){console.warn(`Failed to save ${n} to localStorage:`,t)}},getJSON:(n,e)=>{try{const t=localStorage.getItem(n);return t===null?e:JSON.parse(t)}catch(t){return console.warn(`Failed to parse ${n} from localStorage:`,t),e}},getNumber:(n,e)=>{try{const t=localStorage.getItem(n);if(t===null)return e;const r=parseInt(t);return isNaN(r)?e:r}catch(t){return console.warn(`Failed to get number ${n} from localStorage:`,t),e}}},Co=3;function xL({posts:n,setPosts:e,selectedPost:t,setSelectedPost:r,userNickname:s,userGuideCount:i,setUserGuideCount:a,addLumensWithTrust:c,updateActivity:l,updateTrust:d}){const[h,m]=y.useState(new Set),[f,w]=y.useState(new Map);y.useEffect(()=>{const E=dt.getJSON("guideReplies",[]);Array.isArray(E)&&m(new Set(E));const R=dt.getJSON("postGuides",{});if(typeof R=="object"&&R!==null){const P=Object.entries(R).filter(([,O])=>typeof O=="number");w(new Map(P))}},[]);const k=y.useCallback(async(E,R,P)=>{const O=String(P),g=n.find(T=>String(T.id)===O);if(!g){oe.error("    .");return}const x=f.get(O),v=g.guideReplyId;if(x!==void 0||typeof v=="number"){oe.error("   .");return}if(R===s){oe.error("    .");return}if(g.author!==s){oe.error("     .");return}const A=new Set(h);A.add(E),m(A);const S=new Map(f);S.set(O,E),w(S),dt.setJSON("guideReplies",Array.from(A)),dt.setJSON("postGuides",Object.fromEntries(S));const D=n.map(T=>{if(String(T.id)===O){const L=(T.replies||[]).map(F=>({...F,isGuide:F.id===E}));return{...T,replies:L}}return T});if(e(D),t&&String(t.id)===O){const T=D.find(L=>String(L.id)===O);T&&r(T)}try{const T=(g.replies||[]).map(q=>({...q,isGuide:q.id===E})),L=T.find(q=>q.id===E),F=L&&typeof L.authorUid=="string"?L.authorUid:null;if(F){const q=Se(me,"users",F);try{await _n(q,{guideCount:Cr(1),lumenBalance:Cr(Co),lumenTotalEarned:Cr(Co)})}catch(U){if(typeof U?.message=="string"&&U.message.includes("No document"))await $n(q,{guideCount:0,followerCount:0,followingCount:0,lumenBalance:0,lumenTotalEarned:0,createdAt:new Date().toISOString()},{merge:!0}),await _n(q,{guideCount:Cr(1),lumenBalance:Cr(Co),lumenTotalEarned:Cr(Co)});else throw U}}const G=typeof g.id=="string"?g.id:String(g.id);if(await _n(Se(me,"posts",G),{guideReplyId:E,guideReplyAuthor:R,replies:T}),F){const q=_e.currentUser?.uid??null;await ua({toUserUid:F,fromUserUid:q??void 0,type:"guide",categoryId:g.categoryId??g.category??null,data:{postId:typeof g.id=="string"||typeof g.id=="number"?g.id:void 0,replyId:E,userId:q??void 0,userName:s,titleName:R,lumenReward:Co}})}}catch(T){console.error("  Firestore/  :",T)}oe.success(`${R}  ! `)},[n,t,s,h,f,e,r]),C=y.useCallback(()=>{a(E=>{const R=E+1;return dt.setItem("userGuideCount",String(R)),R}),c(Co,"  "),d(1),l({guideCount:i+1})},[i,a,c,d,l]),b=y.useCallback(E=>h.has(E),[h]),N=y.useCallback(E=>f.has(String(E)),[f]),I=y.useCallback(E=>f.get(String(E)),[f]);return{guideReplies:h,postGuides:f,handleGuideSelect:k,handleGuideReceived:C,isGuideReply:b,hasGuide:N,getGuideReplyId:I}}async function cw(n){if(!n.length)return[];const e=n.slice(0,10),t=St(me,"users"),r=zn(t,jr("nickname","in",e)),s=await jn(r),i=new Map;return s.forEach(a=>{const c=a.data(),l=c.nickname;i.set(l,{nickname:l,avatarUrl:c.profileImageUrl||c.photoURL||"",bio:c.profileDescription||"",title:c.currentTitle||""})}),n.map(a=>i.get(a)||{nickname:a})}function wL({userNickname:n}){const[e,t]=y.useState([]),[r,s]=y.useState(0),[i,a]=y.useState([]),[c,l]=y.useState([]),[d,h]=y.useState([]),m=y.useRef(new Set),f=y.useCallback(async N=>{const I=St(me,"users"),E=zn(I,jr("nickname","==",N)),R=await jn(E);if(R.empty)return{exists:!1,isDeleted:!1};const P=R.docs[0].data();return{exists:!0,isDeleted:P?.isDeleted===!0||P?.status==="deleted"||P?.nickname===" "||P?.nickname==="  "||typeof P?.nickname=="string"&&P.nickname.includes(" ")}},[]);y.useEffect(()=>{const N=_e.currentUser?.uid??null;if(!N)return;const I=St(me,"follows"),E=zn(I,jr("followerUid","==",N)),R=fi(E,g=>{const x=new Set;g.forEach(v=>{const S=v.data()?.followingNickname;S&&x.add(S)}),t(Array.from(x))},g=>{console.error("   :",g)}),P=Se(me,"users",N),O=fi(P,g=>{const x=(g.exists()?g.data():{})??{},v=typeof x.followerCount=="number"?x.followerCount:0;s(v)},g=>{console.error("   :",g)});return()=>{R(),O()}},[]);const w=y.useCallback(async()=>{const N=_e.currentUser?.uid??null;if(N)try{const I=await SI(N);a(I??[]),s(Array.isArray(I)?I.length:0)}catch(I){console.error("   :",I)}},[]);y.useEffect(()=>{let N=!1;const I=async()=>{try{const E=await cw(i);N||l(E)}catch(E){console.error("    :",E)}};return i.length?I():l([]),()=>{N=!0}},[i]),y.useEffect(()=>{let N=!1;const I=async()=>{try{const E=await cw(e);N||h(E)}catch(E){console.error("    :",E)}};return e.length?I():h([]),()=>{N=!0}},[e]);const k=y.useCallback(async N=>{const I=N?.trim();if(!I||I===n)return!1;if(I===" ")return oe.error("    ."),!1;if(m.current.has(I))return!1;m.current.add(I);const E=_e.currentUser?.uid??null;if(!E)return oe.error("  ."),m.current.delete(I),!1;try{const{exists:R,isDeleted:P}=await f(I);if(!R)return oe.error("     ."),t(g=>g.filter(x=>x!==I)),!1;if(P)return oe.error("    ."),t(g=>g.filter(x=>x!==I)),!1;if((await jO({currentUid:E,currentNickname:n,targetNickname:I})).isFollowing)try{const g=St(me,"users"),x=zn(g,jr("nickname","==",I)),v=await jn(x);if(!v.empty){const S=v.docs[0].id;await pL({toUserUid:S,fromUserUid:E,followerNickname:n,followerAvatar:_e.currentUser?.photoURL??void 0})}}catch(g){console.error("   :",g)}return!0}catch(R){return console.error("/ :",R),(typeof R?.message=="string"?R.message:"").includes("TARGET_USER_NOT_FOUND")?(oe.error("     ."),t(O=>O.filter(g=>g!==I))):oe.error("   .    ."),!1}finally{m.current.delete(I)}},[n,f]),C=y.useCallback(N=>e.includes(N),[e]),b=e.length;return{followingUsers:e,followerUsers:i,followerCount:r,followingCount:b,handleToggleFollowUser:k,isFollowing:C,fetchFollowerUsers:w,setFollowerCount:s,followerUsersDetailed:c,followingUsersDetailed:d}}const zs=n=>{const e=_e.currentUser?.uid;return e?`${n}_${e}`:n};function _L({lumenBalance:n,spendLumens:e}){const[t,r]=y.useState([]),[s,i]=y.useState(""),[a,c]=y.useState(!1);y.useEffect(()=>{const w=zs("ownedTitles"),k=zs("currentTitle"),C=dt.getJSON(w,[]);Array.isArray(C)&&r(C);const b=dt.getItem(k);b&&i(b)},[]),y.useEffect(()=>{const w=_e.currentUser?.uid;if(!w)return;(async()=>{try{const C=Se(me,"users",w),b=await Qn(C);if(!b.exists()){c(!0);return}const N=b.data();if(Array.isArray(N.ownedTitles)){const I=N.ownedTitles.filter(E=>typeof E=="string");I.length>0&&r(E=>{const R=Array.from(new Set([...E,...I])),P=zs("ownedTitles");return dt.setJSON(P,R),R})}if(typeof N.currentTitle=="string"){const I=zs("currentTitle");N.currentTitle?(i(N.currentTitle),dt.setItem(I,N.currentTitle)):(i(""),dt.setItem(I,""))}}catch(C){console.error("   :",C)}finally{c(!0)}})()},[]),y.useEffect(()=>{if(!a)return;const w=_e.currentUser?.uid??null;if(!w)return;(async()=>{try{const C=Se(me,"users",w);await _n(C,{ownedTitles:t,currentTitle:s||null})}catch(C){console.error("   :",C)}})()},[t,s,a]);const l=y.useCallback((w,k)=>a?k<0?(console.error("[titles] cost    .",{titleId:w,cost:k}),oe.error("  .   ."),!1):t.includes(w)?(oe.error("  ."),!1):k>0&&n<k?(oe.error(" ."),!1):k>0&&!e(k," ",w)?(oe.error(" ."),!1):(r(C=>{if(C.includes(w))return C;const b=[...C,w],N=zs("ownedTitles");return dt.setJSON(N,b),b}),oe.success(" ! "),!0):(oe.error("!    ."),!1),[t,n,e,a]),d=y.useCallback(w=>{if(!t.includes(w))return oe.error("  ."),!1;if(s===w)return oe.info("   ."),!1;i(w);const k=zs("currentTitle");return dt.setItem(k,w),oe.success(" ! "),!0},[t,s]),h=y.useCallback(()=>{if(!s)return oe.info("   ."),!1;i("");const w=zs("currentTitle");return dt.setItem(w,""),oe.success(" ."),!0},[s]),m=y.useCallback((w,k)=>{r(C=>{if(C.includes(w))return C;const b=[...C,w],N=zs("ownedTitles");return dt.setJSON(N,b),console.log(`  '${k}' !`),b})},[]),f=y.useCallback(w=>t.includes(w),[t]);return{ownedTitles:t,currentTitle:s,titlesSyncReady:a,handleTitlePurchase:l,handleTitleEquip:d,handleTitleUnequip:h,addSpecialTitle:m,hasTitle:f,setOwnedTitles:r,setCurrentTitle:i}}function lw(n){let e;if(n.createdAt instanceof Date)e=n.createdAt;else if(n.createdAt&&typeof n.createdAt.toDate=="function")e=n.createdAt.toDate();else if(typeof n.createdAt=="string"||typeof n.createdAt=="number"){const t=new Date(n.createdAt);e=Number.isNaN(t.getTime())?new Date:t}else e=new Date;return{id:n.id??Date.now(),content:n.content??"",author:n.author??"",authorUid:n.authorUid??null,authorAvatar:typeof n.authorAvatar=="string"?n.authorAvatar:null,timeAgo:n.timeAgo??"",lanterns:typeof n.lanterns=="number"?n.lanterns:0,isGuide:!!n.isGuide,createdAt:e,authorTitleId:n.authorTitleId??null,isAi:n.isAi===!0||typeof n.aiLabel=="string",aiLabel:typeof n.aiLabel=="string"?n.aiLabel:void 0,aiSummary:typeof n.aiSummary=="string"?n.aiSummary:void 0,aiSource:typeof n.aiSource=="string"?n.aiSource:void 0}}async function vL(n){if(!n)return null;try{const e=St(me,"users"),t=zn(e,jr("nickname","==",n),Md(1)),r=await jn(t);return r.empty?null:r.docs[0].id}catch(e){return console.error("[findUserUidByNickname] :",e),null}}function bL({posts:n,setPosts:e,selectedPost:t,setSelectedPost:r,userNickname:s,clampedTrust:i,updateActivity:a,userProfileImage:c}){const[l,d]=y.useState(""),h=y.useRef(null),m=y.useCallback(N=>{d(N.target.value)},[]),f=y.useCallback(N=>{N&&(d(I=>{if(!I)return`@${N} `;const E=!I.endsWith(" ");return`${I}${E?" ":""}@${N} `}),h.current&&h.current.focus())},[]),w=y.useCallback(async()=>{if(!t||!l.trim())return;if(i<=0){oe.error(" 0    .");return}if(Qu(l)){oe.error("   .");return}const N=_e.currentUser?.uid??null;let I=null;if(N)try{const x=Se(me,"users",N),v=await Qn(x);v.exists()&&(I=v.data().currentTitle??null)}catch(x){console.error("    :",x)}const E=Date.now(),R={id:E,content:l.trim(),author:s,authorUid:N,authorAvatar:c??null,timeAgo:"",lanterns:0,isGuide:!1,createdAt:new Date,authorTitleId:I,isAi:!1},P=[...t.replies||[],R],O=P.map(x=>lw(x)),g=n.map(x=>String(x.id)===String(t.id)?{...x,replies:P,replyCount:P.length,comments:typeof x.comments=="number"?x.comments+1:P.length}:x);e(g),r({...t,replies:P,replyCount:P.length,comments:typeof t.comments=="number"?t.comments+1:P.length}),d(""),oe.success(" !"),a({replies:1});try{let x=typeof t.id=="string"?t.id:null;if(!x){const v=n.find(A=>String(A.id)===String(t.id));v&&typeof v.id=="string"&&(x=v.id)}if(!x){console.warn("[handleReplySubmit] Firestore  :  ID  .",{selectedPostId:t.id});return}if(await _n(Se(me,"posts",x),{replies:O,replyCount:O.length,comments:typeof t.comments=="number"?t.comments+1:O.length}),N)try{await _n(Se(me,"users",N),{replyCount:Cr(1)})}catch(v){console.error(" replyCount  :",v)}}catch(x){console.error("Firestore   :",x)}try{const x=_e.currentUser?.uid??null,v=typeof t.authorUid=="string"?t.authorUid:null;v&&x&&v!==x&&await ua({toUserUid:v,fromUserUid:x,type:"reply",categoryId:t.categoryId??t.category??null,data:{postId:t.id,replyId:E,userId:x,userName:s,userAvatar:c??void 0}})}catch(x){console.error("   :",x)}try{const x=/@([^\s@]+)/g,v=new Set;let A;for(;(A=x.exec(R.content))!==null;){const S=A[1].trim();S&&S!==s&&v.add(S)}if(v.size>0){const S=_e.currentUser?.uid??null;for(const D of v){if(D===t.author)continue;const T=await vL(D);if(T&&S&&T!==S)try{await ua({toUserUid:T,fromUserUid:S,type:"mention",categoryId:t.categoryId??t.category??null,data:{postId:t.id,replyId:E,userId:S,userName:s,userAvatar:c??void 0}})}catch(L){console.error("   :",L)}}}}catch(x){console.error("    :",x)}},[t,l,s,n,i,e,r,a,c]),k=y.useCallback(async N=>{if(!t)return;const I=t.replies?.find(P=>P.id===N);if(!I||I.author!==s){oe.error("    .");return}const E=t.replies.filter(P=>P.id!==N),R=n.map(P=>String(P.id)===String(t.id)?{...P,replies:E,replyCount:E.length,comments:E.length}:P);e(R),r({...t,replies:E,replyCount:E.length}),oe.success(" .");try{let P=typeof t.id=="string"?t.id:null;if(!P){const O=n.find(g=>String(g.id)===String(t.id));O&&typeof O.id=="string"&&(P=O.id)}if(P){const O=E.map(x=>lw(x)),g=JSON.parse(JSON.stringify(O));await _n(Se(me,"posts",P),{replies:g,replyCount:g.length,comments:g.length})}}catch(P){console.error("Firestore   :",P)}},[t,s,n,e,r]),C=y.useCallback((N,I)=>{if(!N)return null;const E=[],R=/@([^\s@]+)/g;let P=0,O;for(;(O=R.exec(N))!==null;){const g=O[0],x=O[1],v=O.index;v>P&&E.push(N.slice(P,v)),E.push(o.jsx("span",{"data-nickname":x,className:"text-primary font-semibold hover:underline cursor-pointer",onClick:()=>I(x),children:g},`mention-${v}-${x}`)),P=v+g.length}return P<N.length&&E.push(N.slice(P)),E},[]),b=i>0;return{newReplyContent:l,replyInputRef:h,handleReplyContentChange:m,handleInsertMention:f,handleReplySubmit:w,handleDeleteReply:k,renderContentWithMentions:C,canSubmitReply:b,setNewReplyContent:d}}const uw="notifications",dw="notificationSettings_v2",Ba={enabled:!0,sound:!0,vibration:!0,types:{lantern:!0,reply:!0,guide:!0,mention:!0,follow:!0,system:!0,achievement:!0},pushEnabled:!1,inAppEnabled:!0,doNotDisturb:{enabled:!1,start:"22:00",end:"08:00"}},er=()=>_e.currentUser?.uid??null,IL=n=>St(me,"user_notifications",n,"items"),Lh=(n,e)=>Se(me,"user_notifications",n,"items",e),Vh=n=>Se(me,"user_notification_settings",n);function TL(n={}){const{maxNotifications:e=100,autoDeleteAfterDays:t=30}=n,[r,s]=y.useState([]),[i,a]=y.useState(Ba),[c,l]=y.useState(!0),d=t*24*60*60*1e3,h=y.useCallback(T=>{try{localStorage.setItem(uw,JSON.stringify(T))}catch(L){console.error("Failed to save notifications (local):",L)}},[]),m=y.useCallback(T=>{try{localStorage.setItem(dw,JSON.stringify(T))}catch(L){console.error("Failed to save notification settings (local):",L)}},[]);y.useEffect(()=>{const T=er();if(!T){try{const q=localStorage.getItem(uw);if(q){const B=JSON.parse(q),Y=Date.now()-d,ue=B.filter(J=>J.timestamp>Y);s(ue.slice(0,e))}const U=localStorage.getItem(dw);U&&a(JSON.parse(U))}catch(q){console.error("Failed to load notifications from localStorage:",q)}finally{l(!1)}return}l(!0);const L=zn(IL(T),fp("timestamp","desc"),Md(e)),F=fi(L,q=>{const U=Date.now(),B=U-d,Y=q.docs.map(ue=>{const J=ue.data(),H=typeof J.timestamp=="number"?J.timestamp:U,we=J.type,Ae=Ju[we];return{id:ue.id,type:we,priority:J.priority??Ae.defaultPriority,title:J.title??"",message:J.message??"",timestamp:H,read:!!J.read,data:J.data,action:J.action,groupId:J.groupId}}).filter(ue=>ue.timestamp>B);s(Y),l(!1)},q=>{console.error("Failed to load notifications from Firestore:",q),l(!1)}),G=fi(Vh(T),q=>{if(q.exists()){const U=q.data();a({...Ba,...U,types:{...Ba.types,...U.types??{}},doNotDisturb:{...Ba.doNotDisturb,...U.doNotDisturb??{}}})}else a(Ba)},q=>{console.error("Failed to load notification settings from Firestore:",q)});return()=>{F(),G()}},[e,d]);const f=y.useCallback(async T=>{const L=er();if(!L){oe.error("     .");return}try{await $n(Vh(L),T,{merge:!0})}catch(F){console.error("Failed to save notification settings to Firestore:",F)}},[]),w=y.useCallback(async T=>{const L=er();if(L)try{await $n(Lh(L,T.id),T,{merge:!0})}catch(F){console.error("Failed to save notification to Firestore:",F)}},[]),k=y.useCallback(async T=>{const L=er();if(L)try{await _n(Lh(L,T),{read:!0})}catch(F){console.error("Failed to mark notification as read in Firestore:",F)}},[]),C=y.useCallback(async T=>{const L=er();if(L)try{await $o(Lh(L,T))}catch(F){console.error("Failed to delete notification from Firestore:",F)}},[]),b=y.useCallback(async()=>{const T=er();if(T)try{const L=await Qn(Vh(T))}catch(L){console.error("Failed to prepare clearAll in Firestore:",L)}},[]),N=y.useCallback((T,L,F)=>{if(!i.enabled||!i.types[T]||LI(i))return null;const{title:G,message:q}=OI(T,L),U=Ju[T],B=Date.now(),Y={id:B.toString()+Math.random().toString(36).substr(2,9),type:T,priority:F?.priority||U.defaultPriority,title:G,message:q,timestamp:B,read:!1,data:L,action:F?.action,groupId:F?.groupId};return s(ue=>{const J=[Y,...ue].slice(0,e);return er()?w(Y):h(J),J}),i.inAppEnabled&&typeof window<"u"&&window.dispatchEvent(new CustomEvent("showInAppNotification",{detail:Y})),i.pushEnabled&&typeof window<"u"&&"Notification"in window&&Notification.permission==="granted"&&EL(Y,i),Y},[i,e,h,w]),I=y.useCallback(T=>{s(L=>{const F=L.map(q=>q.id===T?{...q,read:!0}:q);return er()?k(T):h(F),F})},[h,k]),E=y.useCallback(()=>{s(T=>{const L=T.filter(q=>!q.read),F=T.map(q=>({...q,read:!0}));return er()?L.forEach(q=>{k(q.id)}):h(F),F})},[h,k]),R=y.useCallback(T=>{s(L=>{const F=L.filter(q=>q.id!==T);return er()?C(T):h(F),F})},[h,C]),P=y.useCallback(()=>{s([]),er()?b():h([])},[h,b]),O=y.useCallback(T=>{s(L=>{const F=L.filter(q=>q.type!==T);return er()||h(F),F})},[h]),g=y.useCallback(T=>{a(L=>{const F={...L,...T,types:{...L.types,...T.types??{}},doNotDisturb:{...L.doNotDisturb,...T.doNotDisturb??{}}};return er()?f(F):m(F),F})},[m,f]),x=y.useMemo(()=>iL(r),[r]),v=y.useMemo(()=>oL(r),[r]),A=y.useCallback(T=>tw(r,{type:T}),[r]),S=y.useMemo(()=>tw(r,{read:!1}),[r]);return{notifications:y.useMemo(()=>aL(r),[r]),groupedNotifications:v,unreadNotifications:S,unreadCount:x,settings:i,isLoading:c,addNotification:N,markAsRead:I,markAllAsRead:E,removeNotification:R,clearAll:P,clearByType:O,updateSettings:g,getNotificationsByType:A}}function EL(n,e){if(typeof window>"u"||!("Notification"in window))return;const t={body:n.message,icon:"/icon-192.png",badge:"/badge-72.png",tag:n.groupId||n.id,requireInteraction:n.priority==="urgent",silent:!e.sound,data:{notificationId:n.id,type:n.type,...n.data}};n.data?.userAvatar&&(t.icon=n.data.userAvatar);const r=new Notification(n.title,t);r.onclick=()=>{window.focus(),n.action?.url?window.location.href=n.action.url:n.action?.onClick&&n.action.onClick(),r.close()},n.priority!=="urgent"&&setTimeout(()=>{r.close()},5e3)}function NL({posts:n,onPostSelect:e}){const[t,r]=y.useState(!1),{notifications:s,markAsRead:i,markAllAsRead:a,removeNotification:c,clearAll:l}=TL({maxNotifications:100,autoDeleteAfterDays:30}),d=le.useMemo(()=>s.filter(b=>!b.read).map(b=>{const N=b.data?.postId,I=typeof N=="string"||typeof N=="number"?N:void 0;let E;if(I!==void 0){const R=n.find(P=>String(P.id)===String(I));R&&(E=R.title)}return{id:b.id,type:b.type,message:b.message,postId:I,postTitle:E,time:new Date(b.timestamp).toLocaleString("ko-KR"),isRead:b.read}}),[s,n]),h=d.length>0,m=y.useCallback(b=>{if(i(b.id),r(!1),b.postId!=null){const N=n.find(I=>String(I.id)===String(b.postId));if(N){e(N);return}}},[i,n,e]),f=y.useCallback(()=>{d.length&&(a(),oe.success("   "))},[a,d.length]),w=y.useCallback(b=>{c(b)},[c]),k=y.useCallback(()=>{d.length&&(l(),oe.success("  "))},[l,d.length]),C=y.useCallback(b=>{r(N=>b!==void 0?b:!N)},[]);return{notifications:d,hasNotifications:h,showNotifications:t,handleNotificationClick:m,handleMarkAllNotificationsRead:f,removeNotification:w,clearAllNotifications:k,toggleNotifications:C,setShowNotifications:r}}function kL({posts:n,setPosts:e,userNickname:t,userProfileImage:r,clampedTrust:s,updateActivity:i}){const[a,c]=y.useState(!1),[l,d]=y.useState(!1),h=y.useCallback(N=>s<=0?(oe.error(" 0    ."),!1):l||localStorage.getItem("hidePostWarning")==="true"?(N(),!0):(c(!0),!0),[s,l]),m=y.useCallback(N=>{if(l&&localStorage.setItem("hidePostWarning","true"),c(!1),s<=0){oe.error(" 0    .");return}N()},[l,s]),f=y.useCallback(async N=>{if(s<=0)return oe.error(" 0    ."),null;if(Qu(N.title)||Qu(N.content))return oe.error("   ."),null;const I=_e.currentUser?.uid??null,E={...N,author:t,authorUid:I,authorAvatar:r,createdAt:new Date,lanterns:0,replies:[],replyCount:0,comments:0,views:0,isBookmarked:!1,isOwner:!0};try{const P={id:(await qu(St(me,"posts"),{...E,createdAt:Sn()})).id,...E,createdAt:new Date,title:"",content:"",category:"",subCategory:"",type:"",tags:[],author:"",authorUid:null,authorAvatar:"",lanterns:0,replies:[],replyCount:0,comments:0,views:0,isBookmarked:!1,isOwner:!1};if(e(O=>[P,...O]),I)try{await _n(Se(me,"users",I),{postCount:Cr(1)})}catch(O){console.error(" postCount  :",O)}return N.type==="question"?i({explorePosts:1}):i({sharePosts:1}),oe.success(" !"),P}catch(R){return console.error("  :",R),oe.error("  ."),null}},[t,r,s,e,i]),w=y.useCallback(async N=>{const I=String(N),E=n.find(O=>String(O.id)===I);if(!E||E.author!==t)return oe.error("    ."),!1;const R=E.createdAt instanceof Date?E.createdAt:new Date(E.createdAt),P=new Date(Date.now()-1800*1e3);if(R<P)return oe.error("  30     ."),!1;try{return typeof E.id=="string"&&await $o(Se(me,"posts",E.id)),e(O=>O.filter(g=>String(g.id)!==I)),oe.success(" ."),!0}catch(O){return console.error("  :",O),oe.error("  ."),!1}},[n,t,e]),k=y.useCallback(async N=>{const I=_e.currentUser?.uid;if(!I)return;const E=String(N),R=n.find(g=>String(g.id)===E);if(!R||typeof R.id!="string")return;const P=Se(me,"posts",R.id),O=Se(me,"postViews",`${R.id}_${I}`);try{await S0(me,async x=>(await x.get(O)).exists()?!1:(x.set(O,{postId:R.id,viewerUid:I,viewedAt:Sn()}),x.update(P,{views:Cr(1)}),!0))&&e(x=>x.map(v=>String(v.id)===E?{...v,views:(v.views||0)+1}:v))}catch(g){console.error("  :",g)}},[n,e]),C=y.useCallback(N=>{const I=String(N),E=n.find(O=>String(O.id)===I);if(!E||E.author!==t)return!1;const R=E.createdAt instanceof Date?E.createdAt:new Date(E.createdAt),P=new Date(Date.now()-1800*1e3);return R>=P},[n,t]);return{showPostWarning:a,setShowPostWarning:c,dontShowWarningAgain:l,setDontShowWarningAgain:d,handleStartWriting:h,handleWarningConfirm:m,createPost:f,deletePost:w,incrementViews:k,canDeletePost:C,checkboxConfig:{checked:l,onCheckedChange:d,label:"  "}}}function AL({addLumens:n}){const[e,t]=y.useState(30);y.useEffect(()=>{const l=dt.getNumber("trustScore",30);t(l)},[]),y.useEffect(()=>{const l=_e.currentUser?.uid;if(!l)return;(async()=>{try{const h=Se(me,"users",l),m=await Qn(h);if(m.exists()){const f=m.data();typeof f.trustScore=="number"&&(t(f.trustScore),dt.setItem("trustScore",String(f.trustScore)))}}catch(h){console.error("  :",h)}})()},[]);const r=y.useMemo(()=>Math.max(0,Math.min(100,e)),[e]),s=y.useMemo(()=>r<=10?.5:1,[r]),i=y.useCallback(l=>{t(d=>{const h=Math.max(0,Math.min(100,d+l));dt.setItem("trustScore",h.toString());const m=_e.currentUser?.uid??null;if(m){const f=Se(me,"users",m);_n(f,{trustScore:h}).catch(w=>{console.error(" Firestore  :",w)})}return h})},[]),a=y.useCallback((l,d,h)=>{if(r<=0)return;const m=Math.floor(l*s);m<=0||n(m,d??"",h)},[n,r,s]),c=r>0;return{trustScore:e,clampedTrust:r,lumenMultiplier:s,updateTrust:i,addLumensWithTrust:a,canWrite:c}}function CL({posts:n,userNickname:e}){const[t,r]=y.useState(0),[s,i]=y.useState(0),[a,c]=y.useState(0),[l,d]=y.useState(""),[h,m]=y.useState(""),[f,w]=y.useState({}),[k,C]=y.useState({}),[b,N]=y.useState({});y.useEffect(()=>{r(dt.getNumber("userPostLanterns",0)),i(dt.getNumber("userReplyLanterns",0)),c(dt.getNumber("userGuideCount",0));const g=dt.getItem("profileDescription");g&&d(g);const x=dt.getItem("profileInterests");x&&m(x)},[]),y.useEffect(()=>{const g=_e.currentUser?.uid;if(!g)return;const x=Se(me,"users",g),v=fi(x,A=>{if(!A.exists())return;const S=A.data();typeof S.guideCount=="number"&&(c(S.guideCount),dt.setItem("userGuideCount",String(S.guideCount))),typeof S.postLanternsReceived=="number"&&(r(S.postLanternsReceived),dt.setItem("userPostLanterns",String(S.postLanternsReceived))),typeof S.replyLanternsReceived=="number"&&(i(S.replyLanternsReceived),dt.setItem("userReplyLanterns",String(S.replyLanternsReceived)))},A=>{console.error("    :",A)});return()=>{v()}},[]),y.useEffect(()=>{const g=new Date;g.setDate(g.getDate()-7);const x={};n.forEach(v=>{if(v.createdAt<g)return;const A=v.replies?.find(F=>F.isGuide);if(!A)return;const S=A.author??"  ",D=typeof A.authorUid=="string"?A.authorUid:null,T=D||S,L=x[T];x[T]={author:S,authorUid:D,count:(L?.count??0)+1}}),w(x)},[n]),y.useEffect(()=>{const g={};n.forEach(x=>{const v=x.replies?.find(L=>L.isGuide);if(!v)return;const A=v.author??"  ",S=typeof v.authorUid=="string"?v.authorUid:null,D=S||A,T=g[D];g[D]={author:A,authorUid:S,count:(T?.count??0)+1}}),C(g)},[n]),y.useEffect(()=>{const g=new Date;g.setDate(g.getDate()-7);const x={};n.forEach(v=>{const A=v.createdAt instanceof Date?v.createdAt:new Date(v.createdAt);if(A<g)return;const S=typeof v.lanterns=="number"?v.lanterns:0;if(S>0&&v.author){const D=v.author,T=typeof v.authorUid=="string"?v.authorUid:null,L=T||D,F=x[L];x[L]={author:D,authorUid:T,count:(F?.count??0)+S}}Array.isArray(v.replies)&&v.replies.forEach(D=>{if(D?.isAi===!0)return;const T=typeof D.lanterns=="number"?D.lanterns:0,L=D.author;if(!L||T<=0||((D.createdAt instanceof Date?D.createdAt:null)??A)<g)return;const q=typeof D.authorUid=="string"?D.authorUid:null,U=q||L,B=x[U];x[U]={author:L,authorUid:q,count:(B?.count??0)+T}})}),N(x)},[n]);const I=y.useCallback(g=>{d(g),dt.setItem("profileDescription",g)},[]),E=y.useCallback(g=>{m(g),dt.setItem("profileInterests",g)},[]),R=y.useMemo(()=>n.filter(g=>g.author===e),[n,e]),P=y.useMemo(()=>n.flatMap(g=>(g.replies||[]).filter(x=>x.author===e).map(x=>({...x,postTitle:g.title,postAuthor:g.author,postId:g.id}))),[n,e]),O=y.useMemo(()=>Object.values(f).sort((x,v)=>v.count-x.count).slice(0,10).map((x,v)=>({rank:v+1,nickname:x.author,guideCount:x.count})),[f]);return{userPostLanterns:t,setUserPostLanterns:r,userReplyLanterns:s,setUserReplyLanterns:i,userGuideCount:a,setUserGuideCount:c,profileDescription:l,profileInterests:h,handleProfileDescriptionChange:I,handleProfileInterestsChange:E,weeklyGuideRanking:f,totalGuideRanking:k,weeklyLanternRanking:b,userPosts:R,userReplies:P,topGuideUsers:O}}function pl(){const[n,e]=y.useState(typeof navigator<"u"?navigator.onLine:!0),[t,r]=y.useState(!1),[s,i]=y.useState({});return y.useEffect(()=>{const a=()=>{if("connection"in navigator){const h=navigator.connection;i({downlink:h?.downlink,effectiveType:h?.effectiveType,saveData:h?.saveData})}},c=()=>{e(!0),n||(r(!0),setTimeout(()=>r(!1),5e3)),a()},l=()=>{e(!1),a()},d=()=>{a()};return a(),window.addEventListener("online",c),window.addEventListener("offline",l),"connection"in navigator&&navigator.connection?.addEventListener("change",d),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",l),"connection"in navigator&&navigator.connection?.removeEventListener("change",d)}},[n]),{isOnline:n,wasOffline:t,...s}}function SL({viewedNickname:n,currentUserNickname:e}){const[t,r]=y.useState(null);return y.useEffect(()=>{if(!n||n===e){r(null);return}let s=!1;return(async()=>{try{r(b=>b?{...b,loading:!0}:{followerCount:0,followingCount:0,followerUsers:[],followingUsers:[],loading:!0});const a=St(me,"users"),c=zn(a,jr("nickname","==",n)),l=await jn(c);if(s)return;if(l.empty){console.warn("[follow]     :",n),r({followerCount:0,followingCount:0,followerUsers:[],followingUsers:[],loading:!1});return}const d=l.docs[0],m=d.data().uid??d.id,f=await RO(m);if(s)return;const w=f.followerCount??0,k=f.followingNicknames??[],C=await SI(m);if(s)return;r({followerCount:w,followingCount:k.length,followerUsers:Array.isArray(C)?C:[],followingUsers:k,loading:!1})}catch(a){s||(console.error("[follow]      :",a),r({followerCount:0,followingCount:0,followerUsers:[],followingUsers:[],loading:!1}))}})(),()=>{s=!0}},[n,e]),t}function Es({src:n,alt:e,fallbackText:t,className:r="",imageClassName:s="",size:i,loading:a="lazy",decoding:c="async",onClick:l}){const[d,h]=y.useState(!1),m=y.useMemo(()=>{if(typeof n!="string")return;const b=n.trim();return b.length>0?b:void 0},[n]);y.useEffect(()=>{h(!1)},[m]);const f=!!m,w="w-full h-full object-cover",k=d?"lazy-image-loaded":"image-skeleton",C=i?{width:i,height:i,minWidth:i,minHeight:i}:void 0;return o.jsxs(fl,{className:r,style:C,onClick:l,children:[f&&o.jsx(Pp,{src:m,alt:e,loading:a,decoding:c,onLoad:()=>h(!0),onError:()=>h(!0),className:`${w} ${s} ${k}`,sizes:i?`${i}px`:void 0}),o.jsx(ml,{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 text-white text-xl flex items-center justify-center rounded-full",children:t||"?"})]})}const RL=Yf("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ht({className:n,variant:e,asChild:t=!1,...r}){const s=t?zw:"span";return o.jsx(s,{"data-slot":"badge",className:Je(RL({variant:e}),n),...r})}const Op=y.forwardRef(({className:n,...e},t)=>o.jsx("textarea",{ref:t,"data-slot":"textarea",className:Je("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),...e}));Op.displayName="Textarea";function VI({delayDuration:n=0,...e}){return o.jsx(OT,{"data-slot":"tooltip-provider",delayDuration:n,...e})}function jL({...n}){return o.jsx(VI,{children:o.jsx(LT,{"data-slot":"tooltip",...n})})}function PL({...n}){return o.jsx(VT,{"data-slot":"tooltip-trigger",...n})}function DL({className:n,sideOffset:e=0,children:t,...r}){return o.jsx(MT,{children:o.jsxs(UT,{"data-slot":"tooltip-content",sideOffset:e,className:Je("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",n),...r,children:[t,o.jsx(FT,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}const Lp=zT,Wd=y.forwardRef(({...n},e)=>o.jsx($w,{ref:e,"data-slot":"popover-trigger",...n}));Wd.displayName=$w.displayName;const Gd=y.forwardRef(({className:n,align:e="center",sideOffset:t=4,...r},s)=>o.jsx(BT,{children:o.jsx(qw,{ref:s,"data-slot":"popover-content",align:e,sideOffset:t,className:Je("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",n),...r})}));Gd.displayName=qw.displayName;function Ia({key:n,debounceMs:e=100}){const t=y.useRef(null),r=y.useRef(null),s=y.useRef(!1);return y.useEffect(()=>{const i=t.current;if(!i)return;const a=sessionStorage.getItem(`scroll-${n}`);a&&!s.current&&(s.current=!0,requestAnimationFrame(()=>{i.scrollTop=parseInt(a,10),setTimeout(()=>{s.current=!1},100)}));const c=()=>{s.current||(r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{sessionStorage.setItem(`scroll-${n}`,i.scrollTop.toString())},e))};return i.addEventListener("scroll",c,{passive:!0}),()=>{i.removeEventListener("scroll",c),r.current&&clearTimeout(r.current)}},[n,e]),t}const OL=[{id:"guide_sprout",name:" ",requiredGuideCount:1},{id:"little_guide",name:" ",requiredGuideCount:1},{id:"ordinary_guide",name:" ",requiredGuideCount:5},{id:"kind_guide",name:" ",requiredGuideCount:15},{id:"famous_guide",name:" ",requiredGuideCount:30},{id:"master_on_path",name:"  ",requiredGuideCount:50},{id:"sherpa",name:"",requiredGuideCount:100},{id:"immortal_lantern",name:"",requiredGuideCount:200}],MI={best_contributor:" ",captain_captain:"",community_fellow:" ",curiosity_spark:" ",diligent_visitor:" ",discussion_expert:" ",discussion_maestro:" ",economy_analyst:" ",economy_expert:" ",engineering_curious:" ",engineering_destroyer:" ",engineering_first_light:"  ",engineering_focused:" ",explore_brave_questioner:"  ",explore_inquirer:"",explore_investigator:"",explore_philosopher:"",explore_steady_questioner:" ",famous_guide:" ",first_explore:"",guide_guide:"",guide_luminary:"",guide_navigator:"",guide_pathfinder:"",guide_sprout:" ",honorary_scholar:" ",immortal_lantern:"",insight_collector:" ",it_consultant:" ",it_expert:" ",kind_guide:" ",knowledge_sage:" ",language_expert:" ",language_tutor:" ",lantern_campfire:"",lantern_candle:"",lantern_furnace:"",lantern_giver:" ",lantern_giver_captain:"",lantern_giver_small:" ",lantern_lantern:"",little_guide:" ",master_on_path:"  ",multi_specialist:" ",ordinary_guide:" ",philosopher_soul:" ",popular_questioner:" ",reply_advisor:"",reply_challenger:" ",reply_helper:"",reply_mentor:"",reply_persistent_helper:"  ",reply_scholar:"",share_archivist:" ",share_curator:"",share_publisher:"",share_sharer:"",sherpa:"",specialized_replier:" ",streak_pillar:"",streak_regular:"",streak_resident:"",streak_visitor:"",thought_architect:" ",truth_seeker:" ",wisdom_lighthouse:" "},Kd=(n,e,t)=>{const r=n??"";return!r||r!==e||!t?"":MI[t]??""},da=n=>n?MI[n]??"":"";function Vp(n,e){if(!n)return"";const r=(e??new Date).getTime()-n.getTime(),s=Math.floor(r/1e3),i=Math.floor(s/60),a=Math.floor(i/60);if(Math.floor(a/24)<1)return s<60?" ":i<60?`${i} `:`${a} `;const l=n.getFullYear(),d=String(n.getMonth()+1).padStart(2,"0"),h=String(n.getDate()).padStart(2,"0");return`${l}.${d}.${h}`}function UI(n=6e4){const[e,t]=y.useState(()=>new Date);return y.useEffect(()=>{const r=setInterval(()=>{t(new Date)},n);return()=>clearInterval(r)},[n]),e}function FI(n){if(!n)return null;if(n instanceof Date)return n;if(n&&typeof n.toDate=="function")return n.toDate();if(typeof n=="string"||typeof n=="number"){const e=new Date(n);if(!Number.isNaN(e.getTime()))return e}return null}function BI(n){const e=FI(n);return e?e.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}function LL({post:n,userNickname:e,currentTitle:t}){const r=y.useMemo(()=>{const N=new Set;return typeof n.authorUid=="string"&&n.authorUid.length>0&&N.add(n.authorUid),n.replies?.forEach(I=>{typeof I.authorUid=="string"&&I.authorUid.length>0&&N.add(I.authorUid)}),Array.from(N)},[n.authorUid,n.replies]),s=ba(r),i=n.authorUid?s[n.authorUid]:void 0,a=i?.currentTitleId??null,c=da(a),l=n.authorDeleted===!0||n.author===" ",d=Dp(n.author,l),h=Hd(n.author,l),m=i?.profileImage??n.authorAvatar??null,f=Kd(n.author??"",e,t),w=h?null:c||f,k=FI(n.createdAt),C=BI(n.createdAt),b=y.useMemo(()=>n.replies?.filter(N=>N.hidden!==!0)?.map(N=>({...N,isGuide:N.isGuide||n.guideReplyId===N.id}))??[],[n.guideReplyId,n.replies]);return{userProfiles:s,postAuthorProfileImage:m,postAuthorName:d,isPostAuthorDeleted:h,authorTitle:w,postCreatedAtText:C,postCreatedAtDate:k,visibleReplies:b}}const VL=le.memo(function({date:e,title:t}){const r=UI(6e4);return e?o.jsx("span",{title:t||void 0,children:Vp(e,r)}):null});function ML({post:n,userNickname:e,userProfileImage:t,currentTitle:r,isDarkMode:s,isPostLanterned:i,isReplyLanterned:a,onLanternToggle:c,onReplyLanternToggle:l,isBookmarked:d,onBookmarkToggle:h,isGuideReply:m,hasGuide:f,onGuideSelect:w,newReplyContent:k,onReplyContentChange:C,onReplySubmit:b,replyInputRef:N,onClose:I,onAuthorClick:E,onMentionAuthor:R,onMentionReplyAuthor:P,onReplyAuthorClick:O,onReport:g,onDelete:x,onReportReply:v,renderContentWithMentions:A,canSubmitReply:S}){const D=UI(6e4),T=Ia({key:`post-detail-${n.id}`}),{userProfiles:L,postAuthorProfileImage:F,postAuthorName:G,isPostAuthorDeleted:q,authorTitle:U,postCreatedAtText:B,postCreatedAtDate:Y,visibleReplies:ue}=LL({post:n,userNickname:e,currentTitle:r}),J=y.useCallback(H=>{H.key==="Enter"&&!H.shiftKey&&(H.preventDefault(),b())},[b]);return o.jsxs("div",{className:"h-full flex flex-col",children:[o.jsx("div",{className:"bg-card/95 border-b border-border p-4 flex-shrink-0",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(se,{variant:"ghost",size:"icon",onClick:I,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsx("h2",{className:"font-medium",children:" "})]})}),o.jsx("div",{ref:T,className:"flex-1 scroll-container",children:o.jsxs("div",{className:"px-4 py-3 pb-24 space-y-4",children:[o.jsx(Z,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm",children:o.jsx(ee,{className:"p-6",children:o.jsxs("div",{className:"space-y-5",children:[o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx(Es,{src:F||void 0,alt:G?`${G} `:" ",fallbackText:G.charAt(0)?.toUpperCase()||"?",className:"w-12 h-12 ring-2 ring-border/30 cursor-pointer",size:48,loading:"eager",decoding:"async",onClick:q?void 0:E}),o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("p",{className:"font-semibold text-base "+(q?"text-muted-foreground cursor-default":"cursor-pointer hover:text-primary transition-colors duration-200"),onClick:q?void 0:R,children:G}),U&&o.jsx(ht,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:U})]}),o.jsx("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:o.jsx(VL,{date:Y,title:B})})]})]}),o.jsx("div",{className:"flex items-center space-x-2",children:o.jsxs(Lp,{children:[o.jsx(Wd,{asChild:!0,children:o.jsx(se,{variant:"ghost",size:"icon",className:"touch-target",children:o.jsx(e_,{className:"w-4 h-4"})})}),o.jsx(Gd,{className:"w-48 p-2",align:"end",children:o.jsxs("div",{className:"space-y-1",children:[n.isOwner&&o.jsxs(se,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-500",onClick:x,children:[o.jsx(t_,{className:"w-4 h-4 mr-2"}),""]}),!n.isOwner&&o.jsxs(se,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-500",onClick:g,children:[o.jsx(Xf,{className:"w-4 h-4 mr-2"}),""]})]})})]})})]}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-xl font-medium mb-3",children:n.title}),o.jsx("p",{className:"text-muted-foreground leading-relaxed",children:A(n.content)})]}),n.tags&&n.tags.length>0&&o.jsx("div",{className:"flex flex-wrap gap-2",children:n.tags.map(H=>o.jsxs(ht,{variant:"secondary",children:["#",H]},H))}),o.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[n.author!==e?o.jsxs(se,{variant:"ghost",size:"sm",onClick:c,className:`space-x-2 touch-target ${i?"text-amber-500":""}`,children:[i?o.jsx(pr,{className:"w-4 h-4 text-amber-500"}):o.jsx(Ts,{className:"w-4 h-4"}),o.jsx("span",{children:n.lanterns})]}):o.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[o.jsx(Ts,{className:"w-4 h-4"}),o.jsx("span",{children:n.lanterns})]}),o.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[o.jsx(Ln,{className:"w-4 h-4"}),o.jsx("span",{children:n.comments??n.replies?.length??0})]}),o.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[o.jsx(iE,{className:"w-4 h-4"}),o.jsx("span",{children:n.views??0})]})]}),o.jsx(se,{variant:d?"default":"ghost",size:"sm",onClick:h,className:"flex items-center space-x-1 touch-target",children:o.jsx(ai,{className:`w-4 h-4 ${d?"fill-current":""}`})})]})]})})}),o.jsx(UL,{post:n,userNickname:e,userProfileImage:t,currentTitle:r,now:D,hasGuide:f,isReplyLanterned:a,onReplyLanternToggle:l,onGuideSelect:w,onMentionReplyAuthor:P,onReplyAuthorClick:O,onReportReply:v,renderContentWithMentions:A,userProfiles:L,visibleReplies:ue}),o.jsx(Z,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm",children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-4",children:[o.jsx(Op,{ref:N,placeholder:S?"    .":" 0    ",value:k,onChange:C,onKeyDown:J,disabled:!S,className:"min-h-[100px] resize-none border-border/60 focus:border-primary/50 transition-colors duration-200 bg-background/50"}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"text-xs text-muted-foreground",children:[k.length,"/1000"]}),o.jsxs(se,{onClick:b,disabled:!k.trim()||!S,size:"sm",className:"touch-target px-6 py-2 rounded-xl transition-all duration-200 disabled:opacity-50",children:[o.jsx(oE,{className:"w-4 h-4 mr-2"})," "]})]})]})})})]})})]})}const UL=le.memo(function({post:e,userNickname:t,userProfileImage:r,currentTitle:s,now:i,hasGuide:a,visibleReplies:c,isReplyLanterned:l,onReplyLanternToggle:d,onGuideSelect:h,onMentionReplyAuthor:m,onReplyAuthorClick:f,onReportReply:w,renderContentWithMentions:k,userProfiles:C}){const b=e.author===t;return o.jsx("div",{className:"space-y-3",children:c.map(N=>o.jsx(FL,{reply:N,postId:e.id,userNickname:t,userProfileImage:r,currentTitle:s,now:i,isPostAuthor:b,isLanterned:l(N.id),isGuide:N.isGuide||e.guideReplyId===N.id,hasGuideAlready:a,onReplyLanternToggle:d,onGuideSelect:h,onMentionReplyAuthor:m,onReplyAuthorClick:f,onReportReply:w,renderContentWithMentions:k,userProfiles:C},N.id))})}),FL=le.memo(function({reply:e,postId:t,userNickname:r,userProfileImage:s,currentTitle:i,now:a,isPostAuthor:c,isLanterned:l,isGuide:d,hasGuideAlready:h,onReplyLanternToggle:m,onGuideSelect:f,onMentionReplyAuthor:w,onReplyAuthorClick:k,onReportReply:C,renderContentWithMentions:b,userProfiles:N}){const I=e.author===r,E=e.isAi===!0,R=e.aiLabel??"[AI ]",P=typeof e.aiSummary=="string"&&e.aiSummary.length>0?e.aiSummary:"1       .",O=y.useCallback(()=>{m(e.id,t)},[m,t,e.id]),g=y.useCallback(()=>{f(e.id,e.author,t)},[f,t,e.author,e.id]),x=y.useCallback(()=>{w(e.author)},[w,e.author]),v=y.useCallback(()=>{k(e.author)},[k,e.author]),A=y.useCallback(()=>{C(e)},[C,e]),S=e.authorUid?N[e.authorUid]:void 0,D=S?.currentTitleId??null,T=da(D),L=S?.profileImage??e.authorAvatar??null,F=Kd(e.author??"",r,i),G=T||F,q=e.authorDeleted===!0||e.author===" ",U=Dp(e.author,q),B=Hd(e.author,q),Y=B?null:L,ue=B?null:G;let J=null;if(e.createdAt instanceof Date)J=e.createdAt;else if(e.createdAt&&typeof e.createdAt.toDate=="function")J=e.createdAt.toDate();else if(typeof e.createdAt=="string"||typeof e.createdAt=="number"){const Ae=new Date(e.createdAt);Number.isNaN(Ae.getTime())||(J=Ae)}let H="";J?H=Vp(J,a):typeof e.timeAgo=="string"&&e.timeAgo.length>0&&(H=e.timeAgo);const we=J?BI(J):"";return o.jsx(Z,{className:`border-border/60 shadow-sm bg-card/40 backdrop-blur-sm list-optimized ${d?"ring-2 ring-amber-500/50 bg-amber-500/5":""}`,children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(Es,{src:Y||void 0,alt:U?`${U} `:" ",fallbackText:U.charAt(0)?.toUpperCase()||"?",className:"w-9 h-9 ring-2 ring-border/20 "+(B?"":"cursor-pointer"),size:36,loading:"lazy",decoding:"async",onClick:B?void 0:v}),o.jsx("div",{children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("p",{className:"font-medium text-sm "+(B?"text-muted-foreground cursor-default":"cursor-pointer hover:text-primary transition-colors duration-200"),onClick:B?void 0:x,children:U}),ue&&o.jsx(ht,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:ue}),E&&o.jsx(VI,{children:o.jsxs(jL,{children:[o.jsx(PL,{asChild:!0,children:o.jsx(ht,{variant:"outline",className:"text-[10px] px-2 py-0.5 h-auto border-primary/40 text-primary bg-primary/5",children:R})}),o.jsx(DL,{side:"top",align:"start",children:o.jsx("p",{className:"max-w-xs text-xs leading-snug",children:P})})]})}),d&&o.jsxs(ht,{className:"bg-amber-500 text-white text-[10px] px-2 py-0 flex items-center",children:[o.jsx(oi,{className:"w-3 h-3 mr-1"}),""]})]})})]}),!I&&o.jsxs(Lp,{children:[o.jsx(Wd,{asChild:!0,children:o.jsx(se,{variant:"ghost",size:"icon",className:"w-8 h-8",children:o.jsx(e_,{className:"w-4 h-4"})})}),o.jsx(Gd,{className:"w-48 p-2",align:"end",children:o.jsxs("div",{className:"space-y-1",children:[c&&!h&&!d&&!E&&o.jsxs(se,{variant:"ghost",size:"sm",className:"w-full justify-start text-amber-600",onClick:g,children:[o.jsx(oi,{className:"w-4 h-4 mr-2"})," "]}),o.jsxs(se,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-500",onClick:A,children:[o.jsx(Xf,{className:"w-4 h-4 mr-2"}),""]})]})})]})]}),o.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:b(e.content)}),o.jsxs("div",{className:"flex items-center justify-between pt-2",children:[o.jsx("div",{className:"flex items-center space-x-3",children:I?o.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground px-2",children:[o.jsx(Ts,{className:"w-4 h-4"}),o.jsx("span",{className:"text-xs",children:e.lanterns})]}):o.jsxs(se,{variant:"ghost",size:"sm",onClick:O,className:`space-x-1 h-8 ${l?"text-amber-500":""}`,children:[l?o.jsx(pr,{className:"w-4 h-4 text-amber-500"}):o.jsx(Ts,{className:"w-4 h-4"}),o.jsx("span",{className:"text-xs",children:e.lanterns})]})}),o.jsx("div",{className:"flex flex-col items-end leading-tight text-xs text-muted-foreground",children:H&&o.jsx("span",{title:we||void 0,children:H})})]})]})})})},(n,e)=>!(n.reply.id!==e.reply.id||n.isLanterned!==e.isLanterned||n.isGuide!==e.isGuide||n.hasGuideAlready!==e.hasGuideAlready||n.reply.lanterns!==e.reply.lanterns||n.reply.content!==e.reply.content||n.reply.author!==e.reply.author||n.reply.authorAvatar!==e.reply.authorAvatar||n.reply.createdAt!==e.reply.createdAt||n.reply.authorUid!==e.reply.authorUid||n.reply.timeAgo!==e.reply.timeAgo||n.reply.isAi!==e.reply.isAi||n.reply.aiLabel!==e.reply.aiLabel||n.reply.aiSummary!==e.reply.aiSummary||n.userNickname!==e.userNickname||n.currentTitle!==e.currentTitle||n.userProfileImage!==e.userProfileImage||n.isPostAuthor!==e.isPostAuthor)),Qd=0,wi=1,Ta=2,zI=4;function hw(n){return()=>n}function BL(n){n()}function $I(n,e){return t=>n(e(t))}function fw(n,e){return()=>n(e)}function zL(n,e){return t=>n(e,t)}function Mp(n){return n!==void 0}function $L(...n){return()=>{n.map(BL)}}function Ea(){}function Yd(n,e){return e(n),n}function qL(n,e){return e(n)}function yt(...n){return n}function tt(n,e){return n(wi,e)}function Pe(n,e){n(Qd,e)}function Up(n){n(Ta)}function wt(n){return n(zI)}function ye(n,e){return tt(n,zL(e,Qd))}function Pr(n,e){const t=n(wi,r=>{t(),e(r)});return t}function mw(n){let e,t;return r=>s=>{e=s,t&&clearTimeout(t),t=setTimeout(()=>{r(e)},n)}}function qI(n,e){return n===e}function gt(n=qI){let e;return t=>r=>{n(e,r)||(e=r,t(r))}}function Ie(n){return e=>t=>{n(t)&&e(t)}}function de(n){return e=>$I(e,n)}function zr(n){return e=>()=>{e(n)}}function Q(n,...e){const t=HL(...e);return(r,s)=>{switch(r){case Ta:Up(n);return;case wi:return tt(n,t(s))}}}function Gr(n,e){return t=>r=>{t(e=n(e,r))}}function no(n){return e=>t=>{n>0?n--:e(t)}}function gs(n){let e=null,t;return r=>s=>{e=s,!t&&(t=setTimeout(()=>{t=void 0,r(e)},n))}}function Le(...n){const e=new Array(n.length);let t=0,r=null;const s=Math.pow(2,n.length)-1;return n.forEach((i,a)=>{const c=Math.pow(2,a);tt(i,l=>{const d=t;t=t|c,e[a]=l,d!==s&&t===s&&r&&(r(),r=null)})}),i=>a=>{const c=()=>{i([a].concat(e))};t===s?c():r=c}}function HL(...n){return e=>n.reduceRight(qL,e)}function WL(n){let e,t;const r=()=>e?.();return function(s,i){switch(s){case wi:return i?t===i?void 0:(r(),t=i,e=tt(n,i),e):(r(),Ea);case Ta:r(),t=null;return}}}function te(n){let e=n;const t=$e();return(r,s)=>{switch(r){case Qd:e=s;break;case wi:{s(e);break}case zI:return e}return t(r,s)}}function xn(n,e){return Yd(te(e),t=>ye(n,t))}function $e(){const n=[];return(e,t)=>{switch(e){case Qd:n.slice().forEach(r=>{r(t)});return;case Ta:n.splice(0,n.length);return;case wi:return n.push(t),()=>{const r=n.indexOf(t);r>-1&&n.splice(r,1)}}}}function ar(n){return Yd($e(),e=>ye(n,e))}function Ze(n,e=[],{singleton:t}={singleton:!0}){return{constructor:n,dependencies:e,id:GL(),singleton:t}}const GL=()=>Symbol();function KL(n){const e=new Map,t=({constructor:r,dependencies:s,id:i,singleton:a})=>{if(a&&e.has(i))return e.get(i);const c=r(s.map(l=>t(l)));return a&&e.set(i,c),c};return t(n)}function Vt(...n){const e=$e(),t=new Array(n.length);let r=0;const s=Math.pow(2,n.length)-1;return n.forEach((i,a)=>{const c=Math.pow(2,a);tt(i,l=>{t[a]=l,r=r|c,r===s&&Pe(e,t)})}),function(i,a){switch(i){case Ta:{Up(e);return}case wi:return r===s&&a(t),tt(e,a)}}}function be(n,e=qI){return Q(n,gt(e))}function Mf(...n){return function(e,t){switch(e){case Ta:return;case wi:return $L(...n.map(r=>tt(r,t)))}}}var Hn=(n=>(n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR",n))(Hn||{});const QL={0:"debug",3:"error",1:"log",2:"warn"},YL=()=>typeof globalThis>"u"?window:globalThis,_i=Ze(()=>{const n=te(3);return{log:te((e,t,r=1)=>{var s;const i=(s=YL().VIRTUOSO_LOG_LEVEL)!=null?s:wt(n);r>=i&&console[QL[r]]("%creact-virtuoso: %c%s %o","color: #0253b3; font-weight: bold","color: initial",e,t)}),logLevel:n}},[],{singleton:!0});function uo(n,e,t){return Fp(n,e,t).callbackRef}function Fp(n,e,t){const r=le.useRef(null);let s=a=>{};const i=le.useMemo(()=>typeof ResizeObserver<"u"?new ResizeObserver(a=>{const c=()=>{const l=a[0].target;l.offsetParent!==null&&n(l)};t?c():requestAnimationFrame(c)}):null,[n,t]);return s=a=>{a&&e?(i?.observe(a),r.current=a):(r.current&&i?.unobserve(r.current),r.current=null)},{callbackRef:s,ref:r}}function XL(n,e,t,r,s,i,a,c,l){const d=le.useCallback(h=>{const m=JL(h.children,e,c?"offsetWidth":"offsetHeight",s);let f=h.parentElement;for(;!f.dataset.virtuosoScroller;)f=f.parentElement;const w=f.lastElementChild.dataset.viewportType==="window";let k;w&&(k=f.ownerDocument.defaultView);const C=a?c?a.scrollLeft:a.scrollTop:w?c?k.scrollX||k.document.documentElement.scrollLeft:k.scrollY||k.document.documentElement.scrollTop:c?f.scrollLeft:f.scrollTop,b=a?c?a.scrollWidth:a.scrollHeight:w?c?k.document.documentElement.scrollWidth:k.document.documentElement.scrollHeight:c?f.scrollWidth:f.scrollHeight,N=a?c?a.offsetWidth:a.offsetHeight:w?c?k.innerWidth:k.innerHeight:c?f.offsetWidth:f.offsetHeight;r({scrollHeight:b,scrollTop:Math.max(C,0),viewportHeight:N}),i?.(c?pw("column-gap",getComputedStyle(h).columnGap,s):pw("row-gap",getComputedStyle(h).rowGap,s)),m!==null&&n(m)},[n,e,s,i,a,r,c]);return Fp(d,t,l)}function JL(n,e,t,r){const s=n.length;if(s===0)return null;const i=[];for(let a=0;a<s;a++){const c=n.item(a);if(c.dataset.index===void 0)continue;const l=parseInt(c.dataset.index),d=parseFloat(c.dataset.knownSize),h=e(c,t);if(h===0&&r("Zero-sized element, this should not happen",{child:c},Hn.ERROR),h===d)continue;const m=i[i.length-1];i.length===0||m.size!==h||m.endIndex!==l-1?i.push({endIndex:l,size:h,startIndex:l}):i[i.length-1].endIndex++}return i}function pw(n,e,t){return e!=="normal"&&!(e!=null&&e.endsWith("px"))&&t(`${n} was not resolved to pixel value correctly`,e,Hn.WARN),e==="normal"?0:parseInt(e??"0",10)}function HI(n,e,t){const r=le.useRef(null),s=le.useCallback(l=>{if(!(l!=null&&l.offsetParent))return;const d=l.getBoundingClientRect(),h=d.width;let m,f;if(e){const w=e.getBoundingClientRect(),k=d.top-w.top;f=w.height-Math.max(0,k),m=k+e.scrollTop}else{const w=a.current.ownerDocument.defaultView;f=w.innerHeight-Math.max(0,d.top),m=d.top+w.scrollY}r.current={offsetTop:m,visibleHeight:f,visibleWidth:h},n(r.current)},[n,e]),{callbackRef:i,ref:a}=Fp(s,!0,t),c=le.useCallback(()=>{s(a.current)},[s,a]);return le.useEffect(()=>{var l;if(e){e.addEventListener("scroll",c);const d=new ResizeObserver(()=>{requestAnimationFrame(c)});return d.observe(e),()=>{e.removeEventListener("scroll",c),d.unobserve(e)}}else{const d=(l=a.current)==null?void 0:l.ownerDocument.defaultView;return d?.addEventListener("scroll",c),d?.addEventListener("resize",c),()=>{d?.removeEventListener("scroll",c),d?.removeEventListener("resize",c)}}},[c,e,a]),i}const Pn=Ze(()=>{const n=$e(),e=$e(),t=te(0),r=$e(),s=te(0),i=$e(),a=$e(),c=te(0),l=te(0),d=te(0),h=te(0),m=$e(),f=$e(),w=te(!1),k=te(!1),C=te(!1);return ye(Q(n,de(({scrollTop:b})=>b)),e),ye(Q(n,de(({scrollHeight:b})=>b)),a),ye(e,s),{deviation:t,fixedFooterHeight:d,fixedHeaderHeight:l,footerHeight:h,headerHeight:c,horizontalDirection:k,scrollBy:f,scrollContainerState:n,scrollHeight:a,scrollingInProgress:w,scrollTo:m,scrollTop:e,skipAnimationFrameInResizeObserver:C,smoothScrollTargetReached:r,statefulScrollTop:s,viewportHeight:i}},[],{singleton:!0}),Uc={lvl:0};function WI(n,e){const t=n.length;if(t===0)return[];let{index:r,value:s}=e(n[0]);const i=[];for(let a=1;a<t;a++){const{index:c,value:l}=e(n[a]);i.push({end:c-1,start:r,value:s}),r=c,s=l}return i.push({end:1/0,start:r,value:s}),i}function at(n){return n===Uc}function Fc(n,e){if(!at(n))return e===n.k?n.v:e<n.k?Fc(n.l,e):Fc(n.r,e)}function Dr(n,e,t="k"){if(at(n))return[-1/0,void 0];if(Number(n[t])===e)return[n.k,n.v];if(Number(n[t])<e){const r=Dr(n.r,e,t);return r[0]===-1/0?[n.k,n.v]:r}return Dr(n.l,e,t)}function rr(n,e,t){return at(n)?QI(e,t,1):e===n.k?Bt(n,{k:e,v:t}):e<n.k?gw(Bt(n,{l:rr(n.l,e,t)})):gw(Bt(n,{r:rr(n.r,e,t)}))}function Ho(){return Uc}function Wo(n,e,t){if(at(n))return[];const r=Dr(n,e)[0];return ZL(Ff(n,r,t))}function Uf(n,e){if(at(n))return Uc;const{k:t,l:r,r:s}=n;if(e===t){if(at(r))return s;if(at(s))return r;{const[i,a]=KI(r);return mu(Bt(n,{k:i,l:GI(r),v:a}))}}else return e<t?mu(Bt(n,{l:Uf(r,e)})):mu(Bt(n,{r:Uf(s,e)}))}function Ui(n){return at(n)?[]:[...Ui(n.l),{k:n.k,v:n.v},...Ui(n.r)]}function Ff(n,e,t){if(at(n))return[];const{k:r,l:s,r:i,v:a}=n;let c=[];return r>e&&(c=c.concat(Ff(s,e,t))),r>=e&&r<=t&&c.push({k:r,v:a}),r<=t&&(c=c.concat(Ff(i,e,t))),c}function mu(n){const{l:e,lvl:t,r}=n;if(r.lvl>=t-1&&e.lvl>=t-1)return n;if(t>r.lvl+1){if(Mh(e))return YI(Bt(n,{lvl:t-1}));if(!at(e)&&!at(e.r))return Bt(e.r,{l:Bt(e,{r:e.r.l}),lvl:t,r:Bt(n,{l:e.r.r,lvl:t-1})});throw new Error("Unexpected empty nodes")}else{if(Mh(n))return Bf(Bt(n,{lvl:t-1}));if(!at(r)&&!at(r.l)){const s=r.l,i=Mh(s)?r.lvl-1:r.lvl;return Bt(s,{l:Bt(n,{lvl:t-1,r:s.l}),lvl:s.lvl+1,r:Bf(Bt(r,{l:s.r,lvl:i}))})}else throw new Error("Unexpected empty nodes")}}function Bt(n,e){return QI(e.k!==void 0?e.k:n.k,e.v!==void 0?e.v:n.v,e.lvl!==void 0?e.lvl:n.lvl,e.l!==void 0?e.l:n.l,e.r!==void 0?e.r:n.r)}function GI(n){return at(n.r)?n.l:mu(Bt(n,{r:GI(n.r)}))}function Mh(n){return at(n)||n.lvl>n.r.lvl}function KI(n){return at(n.r)?[n.k,n.v]:KI(n.r)}function QI(n,e,t,r=Uc,s=Uc){return{k:n,l:r,lvl:t,r:s,v:e}}function gw(n){return Bf(YI(n))}function YI(n){const{l:e}=n;return!at(e)&&e.lvl===n.lvl?Bt(e,{r:Bt(n,{l:e.r})}):n}function Bf(n){const{lvl:e,r:t}=n;return!at(t)&&!at(t.r)&&t.lvl===e&&t.r.lvl===e?Bt(t,{l:Bt(n,{r:t.l}),lvl:e+1}):n}function ZL(n){return WI(n,({k:e,v:t})=>({index:e,value:t}))}function XI(n,e){return!!(n&&n.startIndex===e.startIndex&&n.endIndex===e.endIndex)}function Bc(n,e){return!!(n&&n[0]===e[0]&&n[1]===e[1])}const Bp=Ze(()=>({recalcInProgress:te(!1)}),[],{singleton:!0});function JI(n,e,t){return n[ed(n,e,t)]}function ed(n,e,t,r=0){let s=n.length-1;for(;r<=s;){const i=Math.floor((r+s)/2),a=n[i],c=t(a,e);if(c===0)return i;if(c===-1){if(s-r<2)return i-1;s=i-1}else{if(s===r)return i;r=i+1}}throw new Error(`Failed binary finding record in array - ${n.join(",")}, searched for ${e}`)}function eV(n,e,t,r){const s=ed(n,e,r),i=ed(n,t,r,s);return n.slice(s,i+1)}function mi(n,e){return Math.round(n.getBoundingClientRect()[e])}function Xd(n){return!at(n.groupOffsetTree)}function zp({index:n},e){return e===n?0:e<n?-1:1}function tV(){return{groupIndices:[],groupOffsetTree:Ho(),lastIndex:0,lastOffset:0,lastSize:0,offsetTree:[],sizeTree:Ho()}}function nV(n,e){let t=at(n)?0:1/0;for(const r of e){const{endIndex:s,size:i,startIndex:a}=r;if(t=Math.min(t,a),at(n)){n=rr(n,0,i);continue}const c=Wo(n,a-1,s+1);if(c.some(lV(r)))continue;let l=!1,d=!1;for(const{end:h,start:m,value:f}of c)l?(s>=m||i===f)&&(n=Uf(n,m)):(d=f!==i,l=!0),h>s&&s>=m&&f!==i&&(n=rr(n,s+1,f));d&&(n=rr(n,a,i))}return[n,t]}function rV(n){return typeof n.groupIndex<"u"}function sV({offset:n},e){return e===n?0:e<n?-1:1}function zc(n,e,t){if(e.length===0)return 0;const{index:r,offset:s,size:i}=JI(e,n,zp),a=n-r,c=i*a+(a-1)*t+s;return c>0?c+t:c}function ZI(n,e){if(!Xd(e))return n;let t=0;for(;e.groupIndices[t]<=n+t;)t++;return n+t}function eT(n,e,t){if(rV(n))return e.groupIndices[n.groupIndex]+1;{const r=n.index==="LAST"?t:n.index;let s=ZI(r,e);return s=Math.max(0,s,Math.min(t,s)),s}}function iV(n,e,t,r=0){return r>0&&(e=Math.max(e,JI(n,r,zp).offset)),WI(eV(n,e,t,sV),cV)}function oV(n,[e,t,r,s]){e.length>0&&r("received item sizes",e,Hn.DEBUG);const i=n.sizeTree;let a=i,c=0;if(t.length>0&&at(i)&&e.length===2){const f=e[0].size,w=e[1].size;a=t.reduce((k,C)=>rr(rr(k,C,f),C+1,w),a)}else[a,c]=nV(a,e);if(a===i)return n;const{lastIndex:l,lastOffset:d,lastSize:h,offsetTree:m}=zf(n.offsetTree,c,a,s);return{groupIndices:t,groupOffsetTree:t.reduce((f,w)=>rr(f,w,zc(w,m,s)),Ho()),lastIndex:l,lastOffset:d,lastSize:h,offsetTree:m,sizeTree:a}}function aV(n){return Ui(n).map(({k:e,v:t},r,s)=>{const i=s[r+1];return{endIndex:i?i.k-1:1/0,size:t,startIndex:e}})}function yw(n,e){let t=0,r=0;for(;t<n;)t+=e[r+1]-e[r]-1,r++;return r-(t===n?0:1)}function zf(n,e,t,r){let s=n,i=0,a=0,c=0,l=0;if(e!==0){l=ed(s,e-1,zp),c=s[l].offset;const d=Dr(t,e-1);i=d[0],a=d[1],s.length&&s[l].size===Dr(t,e)[1]&&(l-=1),s=s.slice(0,l+1)}else s=[];for(const{start:d,value:h}of Wo(t,e,1/0)){const m=d-i,f=m*a+c+m*r;s.push({index:d,offset:f,size:h}),i=d,c=f,a=h}return{lastIndex:i,lastOffset:c,lastSize:a,offsetTree:s}}function cV(n){return{index:n.index,value:n}}function lV(n){const{endIndex:e,size:t,startIndex:r}=n;return s=>s.start===r&&(s.end===e||s.end===1/0)&&s.value===t}const uV={offsetHeight:"height",offsetWidth:"width"},Zr=Ze(([{log:n},{recalcInProgress:e}])=>{const t=$e(),r=$e(),s=xn(r,0),i=$e(),a=$e(),c=te(0),l=te([]),d=te(void 0),h=te(void 0),m=te(void 0),f=te(void 0),w=te((g,x)=>mi(g,uV[x])),k=te(void 0),C=te(0),b=tV(),N=xn(Q(t,Le(l,n,C),Gr(oV,b),gt()),b),I=xn(Q(l,gt(),Gr((g,x)=>({current:x,prev:g.current}),{current:[],prev:[]}),de(({prev:g})=>g)),[]);ye(Q(l,Ie(g=>g.length>0),Le(N,C),de(([g,x,v])=>{const A=g.reduce((S,D,T)=>rr(S,D,zc(D,x.offsetTree,v)||T),Ho());return{...x,groupIndices:g,groupOffsetTree:A}})),N),ye(Q(r,Le(N),Ie(([g,{lastIndex:x}])=>g<x),de(([g,{lastIndex:x,lastSize:v}])=>[{endIndex:x,size:v,startIndex:g}])),t),ye(d,h);const E=xn(Q(d,de(g=>g===void 0)),!0);ye(Q(h,Ie(g=>g!==void 0&&at(wt(N).sizeTree)),de(g=>{const x=wt(m),v=wt(l).length>0;return x?v?[{endIndex:0,size:x,startIndex:0},{endIndex:1,size:g,startIndex:1}]:[]:[{endIndex:0,size:g,startIndex:0}]})),t),ye(Q(f,Ie(g=>g!==void 0&&g.length>0&&at(wt(N).sizeTree)),de(g=>{const x=[];let v=g[0],A=0;for(let S=1;S<g.length;S++){const D=g[S];D!==v&&(x.push({endIndex:S-1,size:v,startIndex:A}),v=D,A=S)}return x.push({endIndex:g.length-1,size:v,startIndex:A}),x})),t),ye(Q(l,Le(m,h),Ie(([,g,x])=>g!==void 0&&x!==void 0),de(([g,x,v])=>{const A=[];for(let S=0;S<g.length;S++){const D=g[S],T=g[S+1];A.push({startIndex:D,endIndex:D,size:x}),T!==void 0&&A.push({startIndex:D+1,endIndex:T-1,size:v})}return A})),t);const R=ar(Q(t,Le(N),Gr(({sizes:g},[x,v])=>({changed:v!==g,sizes:v}),{changed:!1,sizes:b}),de(g=>g.changed)));tt(Q(c,Gr((g,x)=>({diff:g.prev-x,prev:x}),{diff:0,prev:0}),de(g=>g.diff)),g=>{const{groupIndices:x}=wt(N);if(g>0)Pe(e,!0),Pe(i,g+yw(g,x));else if(g<0){const v=wt(I);v.length>0&&(g-=yw(-g,v)),Pe(a,g)}}),tt(Q(c,Le(n)),([g,x])=>{g<0&&x("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:c},Hn.ERROR)});const P=ar(i);ye(Q(i,Le(N),de(([g,x])=>{const v=x.groupIndices.length>0,A=[],S=x.lastSize;if(v){const D=Fc(x.sizeTree,0);let T=0,L=0;for(;T<g;){const G=x.groupIndices[L],q=x.groupIndices.length===L+1?1/0:x.groupIndices[L+1]-G-1;A.push({endIndex:G,size:D,startIndex:G}),A.push({endIndex:G+1+q-1,size:S,startIndex:G+1}),L++,T+=q+1}const F=Ui(x.sizeTree);return T!==g&&F.shift(),F.reduce((G,{k:q,v:U})=>{let B=G.ranges;return G.prevSize!==0&&(B=[...G.ranges,{endIndex:q+g-1,size:G.prevSize,startIndex:G.prevIndex}]),{prevIndex:q+g,prevSize:U,ranges:B}},{prevIndex:g,prevSize:0,ranges:A}).ranges}return Ui(x.sizeTree).reduce((D,{k:T,v:L})=>({prevIndex:T+g,prevSize:L,ranges:[...D.ranges,{endIndex:T+g-1,size:D.prevSize,startIndex:D.prevIndex}]}),{prevIndex:0,prevSize:S,ranges:[]}).ranges})),t);const O=ar(Q(a,Le(N,C),de(([g,{offsetTree:x},v])=>{const A=-g;return zc(A,x,v)})));return ye(Q(a,Le(N,C),de(([g,x,v])=>{if(x.groupIndices.length>0){if(at(x.sizeTree))return x;let A=Ho();const S=wt(I);let D=0,T=0,L=0;for(;D<-g;){L=S[T];const F=S[T+1]-L-1;T++,D+=F+1}if(A=Ui(x.sizeTree).reduce((F,{k:G,v:q})=>rr(F,Math.max(0,G+g),q),A),D!==-g){const F=Fc(x.sizeTree,L);A=rr(A,0,F);const G=Dr(x.sizeTree,-g+1)[1];A=rr(A,1,G)}return{...x,sizeTree:A,...zf(x.offsetTree,0,A,v)}}else{const A=Ui(x.sizeTree).reduce((S,{k:D,v:T})=>rr(S,Math.max(0,D+g),T),Ho());return{...x,sizeTree:A,...zf(x.offsetTree,0,A,v)}}})),N),{beforeUnshiftWith:P,data:k,defaultItemSize:h,firstItemIndex:c,fixedItemSize:d,fixedGroupSize:m,gap:C,groupIndices:l,heightEstimates:f,itemSize:w,listRefresh:R,shiftWith:a,shiftWithOffset:O,sizeRanges:t,sizes:N,statefulTotalCount:s,totalCount:r,trackItemSizes:E,unshiftWith:i}},yt(_i,Bp),{singleton:!0});function dV(n){return n.reduce((e,t)=>(e.groupIndices.push(e.totalCount),e.totalCount+=t+1,e),{groupIndices:[],totalCount:0})}const tT=Ze(([{groupIndices:n,sizes:e,totalCount:t},{headerHeight:r,scrollTop:s}])=>{const i=$e(),a=$e(),c=ar(Q(i,de(dV)));return ye(Q(c,de(l=>l.totalCount)),t),ye(Q(c,de(l=>l.groupIndices)),n),ye(Q(Vt(s,e,r),Ie(([l,d])=>Xd(d)),de(([l,d,h])=>Dr(d.groupOffsetTree,Math.max(l-h,0),"v")[0]),gt(),de(l=>[l])),a),{groupCounts:i,topItemsIndexes:a}},yt(Zr,Pn)),vi=Ze(([{log:n}])=>{const e=te(!1),t=ar(Q(e,Ie(r=>r),gt()));return tt(e,r=>{r&&wt(n)("props updated",{},Hn.DEBUG)}),{didMount:t,propsReady:e}},yt(_i),{singleton:!0}),hV=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function nT(n){const e=typeof n=="number"?{index:n}:n;return e.align||(e.align="start"),(!e.behavior||!hV)&&(e.behavior="auto"),e.offset||(e.offset=0),e}const gl=Ze(([{gap:n,listRefresh:e,sizes:t,totalCount:r},{fixedFooterHeight:s,fixedHeaderHeight:i,footerHeight:a,headerHeight:c,scrollingInProgress:l,scrollTo:d,smoothScrollTargetReached:h,viewportHeight:m},{log:f}])=>{const w=$e(),k=$e(),C=te(0);let b=null,N=null,I=null;function E(){b&&(b(),b=null),I&&(I(),I=null),N&&(clearTimeout(N),N=null),Pe(l,!1)}return ye(Q(w,Le(t,m,r,C,c,a,f),Le(n,i,s),de(([[R,P,O,g,x,v,A,S],D,T,L])=>{const F=nT(R),{align:G,behavior:q,offset:U}=F,B=g-1,Y=eT(F,P,B);let ue=zc(Y,P.offsetTree,D)+v;G==="end"?(ue+=T+Dr(P.sizeTree,Y)[1]-O+L,Y===B&&(ue+=A)):G==="center"?ue+=(T+Dr(P.sizeTree,Y)[1]-O+L)/2:ue-=x,U&&(ue+=U);const J=H=>{E(),H?(S("retrying to scroll to",{location:R},Hn.DEBUG),Pe(w,R)):(Pe(k,!0),S("list did not change, scroll successful",{},Hn.DEBUG))};if(E(),q==="smooth"){let H=!1;I=tt(e,we=>{H=H||we}),b=Pr(h,()=>{J(H)})}else b=Pr(Q(e,fV(150)),J);return N=setTimeout(()=>{E()},1200),Pe(l,!0),S("scrolling from index to",{behavior:q,index:Y,top:ue},Hn.DEBUG),{behavior:q,top:ue}})),d),{scrollTargetReached:k,scrollToIndex:w,topListHeight:C}},yt(Zr,Pn,_i),{singleton:!0});function fV(n){return e=>{const t=setTimeout(()=>{e(!1)},n);return r=>{r&&(e(!0),clearTimeout(t))}}}function $p(n,e){n==0?e():requestAnimationFrame(()=>{$p(n-1,e)})}function qp(n,e){const t=e-1;return typeof n=="number"?n:n.index==="LAST"?t:n.index}const yl=Ze(([{defaultItemSize:n,listRefresh:e,sizes:t},{scrollTop:r},{scrollTargetReached:s,scrollToIndex:i},{didMount:a}])=>{const c=te(!0),l=te(0),d=te(!0);return ye(Q(a,Le(l),Ie(([h,m])=>!!m),zr(!1)),c),ye(Q(a,Le(l),Ie(([h,m])=>!!m),zr(!1)),d),tt(Q(Vt(e,a),Le(c,t,n,d),Ie(([[,h],m,{sizeTree:f},w,k])=>h&&(!at(f)||Mp(w))&&!m&&!k),Le(l)),([,h])=>{Pr(s,()=>{Pe(d,!0)}),$p(4,()=>{Pr(r,()=>{Pe(c,!0)}),Pe(i,h)})}),{initialItemFinalLocationReached:d,initialTopMostItemIndex:l,scrolledToInitialItem:c}},yt(Zr,Pn,gl,vi),{singleton:!0});function rT(n,e){return Math.abs(n-e)<1.01}const $c="up",fc="down",mV="none",pV={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollHeight:0,scrollTop:0,viewportHeight:0}},gV=0,xl=Ze(([{footerHeight:n,headerHeight:e,scrollBy:t,scrollContainerState:r,scrollTop:s,viewportHeight:i}])=>{const a=te(!1),c=te(!0),l=$e(),d=$e(),h=te(4),m=te(gV),f=xn(Q(Mf(Q(be(s),no(1),zr(!0)),Q(be(s),no(1),zr(!1),mw(100))),gt()),!1),w=xn(Q(Mf(Q(t,zr(!0)),Q(t,zr(!1),mw(200))),gt()),!1);ye(Q(Vt(be(s),be(m)),de(([I,E])=>I<=E),gt()),c),ye(Q(c,gs(50)),d);const k=ar(Q(Vt(r,be(i),be(e),be(n),be(h)),Gr((I,[{scrollHeight:E,scrollTop:R},P,O,g,x])=>{const v=R+P-E>-x,A={scrollHeight:E,scrollTop:R,viewportHeight:P};if(v){let D,T;return R>I.state.scrollTop?(D="SCROLLED_DOWN",T=I.state.scrollTop-R):(D="SIZE_DECREASED",T=I.state.scrollTop-R||I.scrollTopDelta),{atBottom:!0,atBottomBecause:D,scrollTopDelta:T,state:A}}let S;return A.scrollHeight>I.state.scrollHeight?S="SIZE_INCREASED":P<I.state.viewportHeight?S="VIEWPORT_HEIGHT_DECREASING":R<I.state.scrollTop?S="SCROLLING_UPWARDS":S="NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:S,state:A}},pV),gt((I,E)=>I&&I.atBottom===E.atBottom))),C=xn(Q(r,Gr((I,{scrollHeight:E,scrollTop:R,viewportHeight:P})=>{if(rT(I.scrollHeight,E))return{changed:!1,jump:0,scrollHeight:E,scrollTop:R};{const O=E-(R+P)<1;return I.scrollTop!==R&&O?{changed:!0,jump:I.scrollTop-R,scrollHeight:E,scrollTop:R}:{changed:!0,jump:0,scrollHeight:E,scrollTop:R}}},{changed:!1,jump:0,scrollHeight:0,scrollTop:0}),Ie(I=>I.changed),de(I=>I.jump)),0);ye(Q(k,de(I=>I.atBottom)),a),ye(Q(a,gs(50)),l);const b=te(fc);ye(Q(r,de(({scrollTop:I})=>I),gt(),Gr((I,E)=>wt(w)?{direction:I.direction,prevScrollTop:E}:{direction:E<I.prevScrollTop?$c:fc,prevScrollTop:E},{direction:fc,prevScrollTop:0}),de(I=>I.direction)),b),ye(Q(r,gs(50),zr(mV)),b);const N=te(0);return ye(Q(f,Ie(I=>!I),zr(0)),N),ye(Q(s,gs(100),Le(f),Ie(([I,E])=>!!E),Gr(([I,E],[R])=>[E,R],[0,0]),de(([I,E])=>E-I)),N),{atBottomState:k,atBottomStateChange:l,atBottomThreshold:h,atTopStateChange:d,atTopThreshold:m,isAtBottom:a,isAtTop:c,isScrolling:f,lastJumpDueToItemResize:C,scrollDirection:b,scrollVelocity:N}},yt(Pn)),qc="top",Hc="bottom",xw="none";function ww(n,e,t){return typeof n=="number"?t===$c&&e===qc||t===fc&&e===Hc?n:0:t===$c?e===qc?n.main:n.reverse:e===Hc?n.main:n.reverse}function _w(n,e){var t;return typeof n=="number"?n:(t=n[e])!=null?t:0}const Hp=Ze(([{deviation:n,fixedHeaderHeight:e,headerHeight:t,scrollTop:r,viewportHeight:s}])=>{const i=$e(),a=te(0),c=te(0),l=te(0),d=xn(Q(Vt(be(r),be(s),be(t),be(i,Bc),be(l),be(a),be(e),be(n),be(c)),de(([h,m,f,[w,k],C,b,N,I,E])=>{const R=h-I,P=b+N,O=Math.max(f-R,0);let g=xw;const x=_w(E,qc),v=_w(E,Hc);return w-=I,w+=f+N,k+=f+N,k-=I,w>h+P-x&&(g=$c),k<h-O+m+v&&(g=fc),g!==xw?[Math.max(R-f-ww(C,qc,g)-x,0),R-O-N+m+ww(C,Hc,g)+v]:null}),Ie(h=>h!=null),gt(Bc)),[0,0]);return{increaseViewportBy:c,listBoundary:i,overscan:l,topListHeight:a,visibleRange:d}},yt(Pn),{singleton:!0});function yV(n,e,t){if(Xd(e)){const r=ZI(n,e);return[{index:Dr(e.groupOffsetTree,r)[0],offset:0,size:0},{data:t?.[0],index:r,offset:0,size:0}]}return[{data:t?.[0],index:n,offset:0,size:0}]}const Uh={bottom:0,firstItemIndex:0,items:[],offsetBottom:0,offsetTop:0,top:0,topItems:[],topListHeight:0,totalCount:0};function pu(n,e,t,r,s,i){const{lastIndex:a,lastOffset:c,lastSize:l}=s;let d=0,h=0;if(n.length>0){d=n[0].offset;const C=n[n.length-1];h=C.offset+C.size}const m=t-a,f=c+m*l+(m-1)*r,w=d,k=f-h;return{bottom:h,firstItemIndex:i,items:vw(n,s,i),offsetBottom:k,offsetTop:d,top:w,topItems:vw(e,s,i),topListHeight:e.reduce((C,b)=>b.size+C,0),totalCount:t}}function sT(n,e,t,r,s,i){let a=0;if(t.groupIndices.length>0)for(const h of t.groupIndices){if(h-a>=n)break;a++}const c=n+a,l=qp(e,c),d=Array.from({length:c}).map((h,m)=>({data:i[m+l],index:m+l,offset:0,size:0}));return pu(d,[],c,s,t,r)}function vw(n,e,t){if(n.length===0)return[];if(!Xd(e))return n.map(d=>({...d,index:d.index+t,originalIndex:d.index}));const r=n[0].index,s=n[n.length-1].index,i=[],a=Wo(e.groupOffsetTree,r,s);let c,l=0;for(const d of n){(!c||c.end<d.index)&&(c=a.shift(),l=e.groupIndices.indexOf(c.start));let h;d.index===c.start?h={index:l,type:"group"}:h={groupIndex:l,index:d.index-(l+1)+t},i.push({...h,data:d.data,offset:d.offset,originalIndex:d.index,size:d.size})}return i}function bw(n,e){var t;return n===void 0?0:typeof n=="number"?n:(t=n[e])!=null?t:0}const ho=Ze(([{data:n,firstItemIndex:e,gap:t,sizes:r,totalCount:s},i,{listBoundary:a,topListHeight:c,visibleRange:l},{initialTopMostItemIndex:d,scrolledToInitialItem:h},{topListHeight:m},f,{didMount:w},{recalcInProgress:k}])=>{const C=te([]),b=te(0),N=$e(),I=te(0);ye(i.topItemsIndexes,C);const E=xn(Q(Vt(w,k,be(l,Bc),be(s),be(r),be(d),h,be(C),be(e),be(t),be(I),n),Ie(([g,x,,v,,,,,,,,A])=>{const S=A&&A.length!==v;return g&&!x&&!S}),de(([,,[g,x],v,A,S,D,T,L,F,G,q])=>{var U,B,Y,ue;const J=A,{offsetTree:H,sizeTree:we}=J,Ae=wt(b);if(v===0)return{...Uh,totalCount:v};if(g===0&&x===0)return Ae===0?{...Uh,totalCount:v}:sT(Ae,S,A,L,F,q||[]);if(at(we))return Ae>0?null:pu(yV(qp(S,v),J,q),[],v,F,J,L);const ct=[];if(T.length>0){const ot=T[0],et=T[T.length-1];let ft=0;for(const Ye of Wo(we,ot,et)){const Ve=Ye.value,Ue=Math.max(Ye.start,ot),mt=Math.min(Ye.end,et);for(let Ge=Ue;Ge<=mt;Ge++)ct.push({data:q?.[Ge],index:Ge,offset:ft,size:Ve}),ft+=Ve}}if(!D)return pu([],ct,v,F,J,L);const qe=T.length>0?T[T.length-1]+1:0,re=iV(H,g,x,qe);if(re.length===0)return null;const je=v-1,ze=Yd([],ot=>{for(const et of re){const ft=et.value;let Ye=ft.offset,Ve=et.start;const Ue=ft.size;if(ft.offset<g){Ve+=Math.floor((g-ft.offset+F)/(Ue+F));const Ge=Ve-et.start;Ye+=Ge*Ue+Ge*F}Ve<qe&&(Ye+=(qe-Ve)*Ue,Ve=qe);const mt=Math.min(et.end,je);for(let Ge=Ve;Ge<=mt&&!(Ye>=x);Ge++)ot.push({data:q?.[Ge],index:Ge,offset:Ye,size:Ue}),Ye+=Ue+F}}),it=bw(G,qc),Rt=bw(G,Hc);if(ze.length>0&&(it>0||Rt>0)){const ot=ze[0],et=ze[ze.length-1];if(it>0&&ot.index>qe){const ft=Math.min(it,ot.index-qe),Ye=[];let Ve=ot.offset;for(let Ue=ot.index-1;Ue>=ot.index-ft;Ue--){const mt=(B=(U=Wo(we,Ue,Ue)[0])==null?void 0:U.value)!=null?B:ot.size;Ve-=mt+F,Ye.unshift({data:q?.[Ue],index:Ue,offset:Ve,size:mt})}ze.unshift(...Ye)}if(Rt>0&&et.index<je){const ft=Math.min(Rt,je-et.index);let Ye=et.offset+et.size+F;for(let Ve=et.index+1;Ve<=et.index+ft;Ve++){const Ue=(ue=(Y=Wo(we,Ve,Ve)[0])==null?void 0:Y.value)!=null?ue:et.size;ze.push({data:q?.[Ve],index:Ve,offset:Ye,size:Ue}),Ye+=Ue+F}}}return pu(ze,ct,v,F,J,L)}),Ie(g=>g!==null),gt()),Uh);ye(Q(n,Ie(Mp),de(g=>g?.length)),s),ye(Q(E,de(g=>g.topListHeight)),m),ye(m,c),ye(Q(E,de(g=>[g.top,g.bottom])),a),ye(Q(E,de(g=>g.items)),N);const R=ar(Q(E,Ie(({items:g})=>g.length>0),Le(s,n),Ie(([{items:g},x])=>g[g.length-1].originalIndex===x-1),de(([,g,x])=>[g-1,x]),gt(Bc),de(([g])=>g))),P=ar(Q(E,gs(200),Ie(({items:g,topItems:x})=>g.length>0&&g[0].originalIndex===x.length),de(({items:g})=>g[0].index),gt())),O=ar(Q(E,Ie(({items:g})=>g.length>0),de(({items:g})=>{let x=0,v=g.length-1;for(;g[x].type==="group"&&x<v;)x++;for(;g[v].type==="group"&&v>x;)v--;return{endIndex:g[v].index,startIndex:g[x].index}}),gt(XI)));return{endReached:R,initialItemCount:b,itemsRendered:N,listState:E,minOverscanItemCount:I,rangeChanged:O,startReached:P,topItemsIndexes:C,...f}},yt(Zr,tT,Hp,yl,gl,xl,vi,Bp),{singleton:!0}),iT=Ze(([{fixedFooterHeight:n,fixedHeaderHeight:e,footerHeight:t,headerHeight:r},{listState:s}])=>{const i=$e(),a=xn(Q(Vt(t,n,r,e,s),de(([c,l,d,h,m])=>c+l+d+h+m.offsetBottom+m.bottom)),0);return ye(be(a),i),{totalListHeight:a,totalListHeightChanged:i}},yt(Pn,ho),{singleton:!0}),xV=Ze(([{viewportHeight:n},{totalListHeight:e}])=>{const t=te(!1),r=xn(Q(Vt(t,n,e),Ie(([s])=>s),de(([,s,i])=>Math.max(0,s-i)),gs(0),gt()),0);return{alignToBottom:t,paddingTopAddition:r}},yt(Pn,iT),{singleton:!0}),oT=Ze(()=>({context:te(null)})),wV=({itemBottom:n,itemTop:e,locationParams:{align:t,behavior:r,...s},viewportBottom:i,viewportTop:a})=>e<a?{...s,align:t??"start",behavior:r}:n>i?{...s,align:t??"end",behavior:r}:null,aT=Ze(([{gap:n,sizes:e,totalCount:t},{fixedFooterHeight:r,fixedHeaderHeight:s,headerHeight:i,scrollingInProgress:a,scrollTop:c,viewportHeight:l},{scrollToIndex:d}])=>{const h=$e();return ye(Q(h,Le(e,l,t,i,s,r,c),Le(n),de(([[m,f,w,k,C,b,N,I],E])=>{const{align:R,behavior:P,calculateViewLocation:O=wV,done:g,...x}=m,v=eT(m,f,k-1),A=zc(v,f.offsetTree,E)+C+b,S=A+Dr(f.sizeTree,v)[1],D=I+b,T=I+w-N,L=O({itemBottom:S,itemTop:A,locationParams:{align:R,behavior:P,...x},viewportBottom:T,viewportTop:D});return L?g&&Pr(Q(a,Ie(F=>!F),no(wt(a)?1:2)),g):g&&g(),L}),Ie(m=>m!==null)),d),{scrollIntoView:h}},yt(Zr,Pn,gl,ho,_i),{singleton:!0});function Iw(n){return n?n==="smooth"?"smooth":"auto":!1}const _V=(n,e)=>typeof n=="function"?Iw(n(e)):e&&Iw(n),vV=Ze(([{listRefresh:n,totalCount:e,fixedItemSize:t,data:r},{atBottomState:s,isAtBottom:i},{scrollToIndex:a},{scrolledToInitialItem:c},{didMount:l,propsReady:d},{log:h},{scrollingInProgress:m},{context:f},{scrollIntoView:w}])=>{const k=te(!1),C=$e();let b=null;function N(P){Pe(a,{align:"end",behavior:P,index:"LAST"})}tt(Q(Vt(Q(be(e),no(1)),l),Le(be(k),i,c,m),de(([[P,O],g,x,v,A])=>{let S=O&&v,D="auto";return S&&(D=_V(g,x||A),S=S&&!!D),{followOutputBehavior:D,shouldFollow:S,totalCount:P}}),Ie(({shouldFollow:P})=>P)),({followOutputBehavior:P,totalCount:O})=>{b&&(b(),b=null),wt(t)?requestAnimationFrame(()=>{wt(h)("following output to ",{totalCount:O},Hn.DEBUG),N(P)}):b=Pr(n,()=>{wt(h)("following output to ",{totalCount:O},Hn.DEBUG),N(P),b=null})});function I(P){const O=Pr(s,g=>{P&&!g.atBottom&&g.notAtBottomBecause==="SIZE_INCREASED"&&!b&&(wt(h)("scrolling to bottom due to increased size",{},Hn.DEBUG),N("auto"))});setTimeout(O,100)}tt(Q(Vt(be(k),e,d),Ie(([P,,O])=>P&&O),Gr(({value:P},[,O])=>({refreshed:P===O,value:O}),{refreshed:!1,value:0}),Ie(({refreshed:P})=>P),Le(k,e)),([,P])=>{wt(c)&&I(P!==!1)}),tt(C,()=>{I(wt(k)!==!1)}),tt(Vt(be(k),s),([P,O])=>{P&&!O.atBottom&&O.notAtBottomBecause==="VIEWPORT_HEIGHT_DECREASING"&&N("auto")});const E=te(null),R=$e();return ye(Mf(Q(be(r),de(P=>{var O;return(O=P?.length)!=null?O:0})),Q(be(e))),R),tt(Q(Vt(Q(R,no(1)),l),Le(be(E),c,m,f),de(([[P,O],g,x,v,A])=>O&&x&&g?.({context:A,totalCount:P,scrollingInProgress:v})),Ie(P=>!!P),gs(0)),P=>{b&&(b(),b=null),wt(t)?requestAnimationFrame(()=>{wt(h)("scrolling into view",{}),Pe(w,P)}):b=Pr(n,()=>{wt(h)("scrolling into view",{}),Pe(w,P),b=null})}),{autoscrollToBottom:C,followOutput:k,scrollIntoViewOnChange:E}},yt(Zr,xl,gl,yl,vi,_i,Pn,oT,aT)),bV=Ze(([{data:n,firstItemIndex:e,gap:t,sizes:r},{initialTopMostItemIndex:s},{initialItemCount:i,listState:a},{didMount:c}])=>(ye(Q(c,Le(i),Ie(([,l])=>l!==0),Le(s,r,e,t,n),de(([[,l],d,h,m,f,w=[]])=>sT(l,d,h,m,f,w))),a),{}),yt(Zr,yl,ho,vi),{singleton:!0}),IV=Ze(([{didMount:n},{scrollTo:e},{listState:t}])=>{const r=te(0);return tt(Q(n,Le(r),Ie(([,s])=>s!==0),de(([,s])=>({top:s}))),s=>{Pr(Q(t,no(1),Ie(i=>i.items.length>1)),()=>{requestAnimationFrame(()=>{Pe(e,s)})})}),{initialScrollTop:r}},yt(vi,Pn,ho),{singleton:!0}),cT=Ze(([{scrollVelocity:n}])=>{const e=te(!1),t=$e(),r=te(!1);return ye(Q(n,Le(r,e,t),Ie(([s,i])=>!!i),de(([s,i,a,c])=>{const{enter:l,exit:d}=i;if(a){if(d(s,c))return!1}else if(l(s,c))return!0;return a}),gt()),e),tt(Q(Vt(e,n,t),Le(r)),([[s,i,a],c])=>{s&&c&&c.change&&c.change(i,a)}),{isSeeking:e,scrollSeekConfiguration:r,scrollSeekRangeChanged:t,scrollVelocity:n}},yt(xl),{singleton:!0}),Wp=Ze(([{scrollContainerState:n,scrollTo:e}])=>{const t=$e(),r=$e(),s=$e(),i=te(!1),a=te(void 0);return ye(Q(Vt(t,r),de(([{scrollHeight:c,scrollTop:l,viewportHeight:d},{offsetTop:h}])=>({scrollHeight:c,scrollTop:Math.max(0,l-h),viewportHeight:d}))),n),ye(Q(e,Le(r),de(([c,{offsetTop:l}])=>({...c,top:c.top+l}))),s),{customScrollParent:a,useWindowScroll:i,windowScrollContainerState:t,windowScrollTo:s,windowViewportRect:r}},yt(Pn)),TV=Ze(([{sizeRanges:n,sizes:e},{headerHeight:t,scrollTop:r},{initialTopMostItemIndex:s},{didMount:i},{useWindowScroll:a,windowScrollContainerState:c,windowViewportRect:l}])=>{const d=$e(),h=te(void 0),m=te(null),f=te(null);return ye(c,m),ye(l,f),tt(Q(d,Le(e,r,a,m,f,t)),([w,k,C,b,N,I,E])=>{const R=aV(k.sizeTree);b&&N!==null&&I!==null&&(C=N.scrollTop-I.offsetTop),C-=E,w({ranges:R,scrollTop:C})}),ye(Q(h,Ie(Mp),de(EV)),s),ye(Q(i,Le(h),Ie(([,w])=>w!==void 0),gt(),de(([,w])=>w.ranges)),n),{getState:d,restoreStateFrom:h}},yt(Zr,Pn,yl,vi,Wp));function EV(n){return{align:"start",index:0,offset:n.scrollTop}}const NV=Ze(([{topItemsIndexes:n}])=>{const e=te(0);return ye(Q(e,Ie(t=>t>=0),de(t=>Array.from({length:t}).map((r,s)=>s))),n),{topItemCount:e}},yt(ho));function lT(n){let e=!1,t;return()=>(e||(e=!0,t=n()),t)}const kV=lT(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),AV=Ze(([{deviation:n,scrollBy:e,scrollingInProgress:t,scrollTop:r},{isAtBottom:s,isScrolling:i,lastJumpDueToItemResize:a,scrollDirection:c},{listState:l},{beforeUnshiftWith:d,gap:h,shiftWithOffset:m,sizes:f},{log:w},{recalcInProgress:k}])=>{const C=ar(Q(l,Le(a),Gr(([,N,I,E],[{bottom:R,items:P,offsetBottom:O,totalCount:g},x])=>{const v=R+O;let A=0;return I===g&&N.length>0&&P.length>0&&(P[0].originalIndex===0&&N[0].originalIndex===0||(A=v-E,A!==0&&(A+=x))),[A,P,g,v]},[0,[],0,0]),Ie(([N])=>N!==0),Le(r,c,t,s,w,k),Ie(([,N,I,E,,,R])=>!R&&!E&&N!==0&&I===$c),de(([[N],,,,,I])=>(I("Upward scrolling compensation",{amount:N},Hn.DEBUG),N))));function b(N){N>0?(Pe(e,{behavior:"auto",top:-N}),Pe(n,0)):(Pe(n,0),Pe(e,{behavior:"auto",top:-N}))}return tt(Q(C,Le(n,i)),([N,I,E])=>{E&&kV()?Pe(n,I-N):b(-N)}),tt(Q(Vt(xn(i,!1),n,k),Ie(([N,I,E])=>!N&&!E&&I!==0),de(([N,I])=>I),gs(1)),b),ye(Q(m,de(N=>({top:-N}))),e),tt(Q(d,Le(f,h),de(([N,{groupIndices:I,lastSize:E,sizeTree:R},P])=>{function O(g){return g*(E+P)}if(I.length===0)return O(N);{let g=0;const x=Fc(R,0);let v=0,A=0;for(;v<N;){v++,g+=x;let S=I.length===A+1?1/0:I[A+1]-I[A]-1;v+S>N&&(g-=x,S=N-v+1),v+=S,g+=O(S),A++}return g}})),N=>{Pe(n,N),requestAnimationFrame(()=>{Pe(e,{top:N}),requestAnimationFrame(()=>{Pe(n,0),Pe(k,!1)})})}),{deviation:n}},yt(Pn,xl,ho,Zr,_i,Bp)),CV=Ze(([n,e,t,r,s,i,a,c,l,d,h])=>({...n,...e,...t,...r,...s,...i,...a,...c,...l,...d,...h}),yt(Hp,bV,vi,cT,iT,IV,xV,Wp,aT,_i,oT)),uT=Ze(([{data:n,defaultItemSize:e,firstItemIndex:t,fixedItemSize:r,fixedGroupSize:s,gap:i,groupIndices:a,heightEstimates:c,itemSize:l,sizeRanges:d,sizes:h,statefulTotalCount:m,totalCount:f,trackItemSizes:w},{initialItemFinalLocationReached:k,initialTopMostItemIndex:C,scrolledToInitialItem:b},N,I,E,R,{scrollToIndex:P},O,{topItemCount:g},{groupCounts:x},v])=>{const{listState:A,minOverscanItemCount:S,topItemsIndexes:D,rangeChanged:T,...L}=R;return ye(T,v.scrollSeekRangeChanged),ye(Q(v.windowViewportRect,de(F=>F.visibleHeight)),N.viewportHeight),{data:n,defaultItemHeight:e,firstItemIndex:t,fixedItemHeight:r,fixedGroupHeight:s,gap:i,groupCounts:x,heightEstimates:c,initialItemFinalLocationReached:k,initialTopMostItemIndex:C,scrolledToInitialItem:b,sizeRanges:d,topItemCount:g,topItemsIndexes:D,totalCount:f,...E,groupIndices:a,itemSize:l,listState:A,minOverscanItemCount:S,scrollToIndex:P,statefulTotalCount:m,trackItemSizes:w,rangeChanged:T,...L,...v,...N,sizes:h,...I}},yt(Zr,yl,Pn,TV,vV,ho,gl,AV,NV,tT,CV));function SV(n,e){const t={},r={};let s=0;const i=n.length;for(;s<i;)r[n[s]]=1,s+=1;for(const a in e)Object.hasOwn(r,a)||(t[a]=e[a]);return t}const Gl=typeof document<"u"?le.useLayoutEffect:le.useEffect;function dT(n,e,t){const r=Object.keys(e.required||{}),s=Object.keys(e.optional||{}),i=Object.keys(e.methods||{}),a=Object.keys(e.events||{}),c=le.createContext({});function l(b,N){b.propsReady&&Pe(b.propsReady,!1);for(const I of r){const E=b[e.required[I]];Pe(E,N[I])}for(const I of s)if(I in N){const E=b[e.optional[I]];Pe(E,N[I])}b.propsReady&&Pe(b.propsReady,!0)}function d(b){return i.reduce((N,I)=>(N[I]=E=>{const R=b[e.methods[I]];Pe(R,E)},N),{})}function h(b){return a.reduce((N,I)=>(N[I]=WL(b[e.events[I]]),N),{})}const m=le.forwardRef((b,N)=>{const{children:I,...E}=b,[R]=le.useState(()=>Yd(KL(n),g=>{l(g,E)})),[P]=le.useState(fw(h,R));Gl(()=>{for(const g of a)g in E&&tt(P[g],E[g]);return()=>{Object.values(P).map(Up)}},[E,P,R]),Gl(()=>{l(R,E)}),le.useImperativeHandle(N,hw(d(R)));const O=t;return o.jsx(c.Provider,{value:R,children:t?o.jsx(O,{...SV([...r,...s,...a],E),children:I}):I})}),f=b=>{const N=le.useContext(c);return le.useCallback(I=>{Pe(N[b],I)},[N,b])},w=b=>{const N=le.useContext(c)[b],I=le.useCallback(E=>tt(N,E),[N]);return le.useSyncExternalStore(I,()=>wt(N),()=>wt(N))},k=b=>{const N=le.useContext(c)[b],[I,E]=le.useState(fw(wt,N));return Gl(()=>tt(N,R=>{R!==I&&E(hw(R))}),[N,I]),I},C=le.version.startsWith("18")?w:k;return{Component:m,useEmitter:(b,N)=>{const I=le.useContext(c)[b];Gl(()=>tt(I,N),[N,I])},useEmitterValue:C,usePublisher:f}}const hT=le.createContext(void 0),fT=le.createContext(void 0),mT=typeof document<"u"?le.useLayoutEffect:le.useEffect;function Fh(n){return"self"in n}function RV(n){return"body"in n}function pT(n,e,t,r=Ea,s,i){const a=le.useRef(null),c=le.useRef(null),l=le.useRef(null),d=le.useCallback(f=>{let w,k,C;const b=f.target;if(RV(b)||Fh(b)){const I=Fh(b)?b:b.defaultView;C=i?I.scrollX:I.scrollY,w=i?I.document.documentElement.scrollWidth:I.document.documentElement.scrollHeight,k=i?I.innerWidth:I.innerHeight}else C=i?b.scrollLeft:b.scrollTop,w=i?b.scrollWidth:b.scrollHeight,k=i?b.offsetWidth:b.offsetHeight;const N=()=>{n({scrollHeight:w,scrollTop:Math.max(C,0),viewportHeight:k})};f.suppressFlushSync?N():$T.flushSync(N),c.current!==null&&(C===c.current||C<=0||C===w-k)&&(c.current=null,e(!0),l.current&&(clearTimeout(l.current),l.current=null))},[n,e,i]);le.useEffect(()=>{const f=s||a.current;return r(s||a.current),d({suppressFlushSync:!0,target:f}),f.addEventListener("scroll",d,{passive:!0}),()=>{r(null),f.removeEventListener("scroll",d)}},[a,d,t,r,s]);function h(f){const w=a.current;if(!w||(i?"offsetWidth"in w&&w.offsetWidth===0:"offsetHeight"in w&&w.offsetHeight===0))return;const k=f.behavior==="smooth";let C,b,N;Fh(w)?(b=Math.max(mi(w.document.documentElement,i?"width":"height"),i?w.document.documentElement.scrollWidth:w.document.documentElement.scrollHeight),C=i?w.innerWidth:w.innerHeight,N=i?window.scrollX:window.scrollY):(b=w[i?"scrollWidth":"scrollHeight"],C=mi(w,i?"width":"height"),N=w[i?"scrollLeft":"scrollTop"]);const I=b-C;if(f.top=Math.ceil(Math.max(Math.min(I,f.top),0)),rT(C,b)||f.top===N){n({scrollHeight:b,scrollTop:N,viewportHeight:C}),k&&e(!0);return}k?(c.current=f.top,l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{l.current=null,c.current=null,e(!0)},1e3)):c.current=null,i&&(f={behavior:f.behavior,left:f.top}),w.scrollTo(f)}function m(f){i&&(f={behavior:f.behavior,left:f.top}),a.current.scrollBy(f)}return{scrollByCallback:m,scrollerRef:a,scrollToCallback:h}}const Bh="-webkit-sticky",Tw="sticky",Gp=lT(()=>{if(typeof document>"u")return Tw;const n=document.createElement("div");return n.style.position=Bh,n.style.position===Bh?Bh:Tw});function Kp(n){return n}const jV=Ze(()=>{const n=te(c=>`Item ${c}`),e=te(c=>`Group ${c}`),t=te({}),r=te(Kp),s=te("div"),i=te(Ea),a=(c,l=null)=>xn(Q(t,de(d=>d[c]),gt()),l);return{components:t,computeItemKey:r,EmptyPlaceholder:a("EmptyPlaceholder"),FooterComponent:a("Footer"),GroupComponent:a("Group","div"),groupContent:e,HeaderComponent:a("Header"),HeaderFooterTag:s,ItemComponent:a("Item","div"),itemContent:n,ListComponent:a("List","div"),ScrollerComponent:a("Scroller","div"),scrollerRef:i,ScrollSeekPlaceholder:a("ScrollSeekPlaceholder"),TopItemListComponent:a("TopItemList")}}),PV=Ze(([n,e])=>({...n,...e}),yt(uT,jV)),DV=({height:n})=>o.jsx("div",{style:{height:n}}),OV={overflowAnchor:"none",position:Gp(),zIndex:1},gT={overflowAnchor:"none"},LV={...gT,display:"inline-block",height:"100%"},Ew=le.memo(function({showTopList:n=!1}){const e=Re("listState"),t=gr("sizeRanges"),r=Re("useWindowScroll"),s=Re("customScrollParent"),i=gr("windowScrollContainerState"),a=gr("scrollContainerState"),c=s||r?i:a,l=Re("itemContent"),d=Re("context"),h=Re("groupContent"),m=Re("trackItemSizes"),f=Re("itemSize"),w=Re("log"),k=gr("gap"),C=Re("horizontalDirection"),{callbackRef:b}=XL(t,f,m,n?Ea:c,w,k,s,C,Re("skipAnimationFrameInResizeObserver")),[N,I]=le.useState(0);Qp("deviation",L=>{N!==L&&I(L)});const E=Re("EmptyPlaceholder"),R=Re("ScrollSeekPlaceholder")||DV,P=Re("ListComponent"),O=Re("ItemComponent"),g=Re("GroupComponent"),x=Re("computeItemKey"),v=Re("isSeeking"),A=Re("groupIndices").length>0,S=Re("alignToBottom"),D=Re("initialItemFinalLocationReached"),T=n?{}:{boxSizing:"border-box",...C?{display:"inline-block",height:"100%",marginLeft:N!==0?N:S?"auto":0,paddingLeft:e.offsetTop,paddingRight:e.offsetBottom,whiteSpace:"nowrap"}:{marginTop:N!==0?N:S?"auto":0,paddingBottom:e.offsetBottom,paddingTop:e.offsetTop},...D?{}:{visibility:"hidden"}};return!n&&e.totalCount===0&&E?o.jsx(E,{...yn(E,d)}):o.jsx(P,{...yn(P,d),"data-testid":n?"virtuoso-top-item-list":"virtuoso-item-list",ref:b,style:T,children:(n?e.topItems:e.items).map(L=>{const F=L.originalIndex,G=x(F+e.firstItemIndex,L.data,d);return v?y.createElement(R,{...yn(R,d),height:L.size,index:L.index,key:G,type:L.type||"item",...L.type==="group"?{}:{groupIndex:L.groupIndex}}):L.type==="group"?y.createElement(g,{...yn(g,d),"data-index":F,"data-item-index":L.index,"data-known-size":L.size,key:G,style:OV},h(L.index,d)):y.createElement(O,{...yn(O,d),...FV(O,L.data),"data-index":F,"data-item-group-index":L.groupIndex,"data-item-index":L.index,"data-known-size":L.size,key:G,style:C?LV:gT},A?l(L.index,L.groupIndex,L.data,d):l(L.index,L.data,d))})})}),VV={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},MV={outline:"none",overflowX:"auto",position:"relative"},Jd=n=>({height:"100%",position:"absolute",top:0,width:"100%",...n?{display:"flex",flexDirection:"column"}:{}}),UV={position:Gp(),top:0,width:"100%",zIndex:1};function yn(n,e){if(typeof n!="string")return{context:e}}function FV(n,e){return{item:typeof n=="string"?void 0:e}}const BV=le.memo(function(){const n=Re("HeaderComponent"),e=gr("headerHeight"),t=Re("HeaderFooterTag"),r=uo(le.useMemo(()=>i=>{e(mi(i,"height"))},[e]),!0,Re("skipAnimationFrameInResizeObserver")),s=Re("context");return n?o.jsx(t,{ref:r,children:o.jsx(n,{...yn(n,s)})}):null}),zV=le.memo(function(){const n=Re("FooterComponent"),e=gr("footerHeight"),t=Re("HeaderFooterTag"),r=uo(le.useMemo(()=>i=>{e(mi(i,"height"))},[e]),!0,Re("skipAnimationFrameInResizeObserver")),s=Re("context");return n?o.jsx(t,{ref:r,children:o.jsx(n,{...yn(n,s)})}):null});function yT({useEmitter:n,useEmitterValue:e,usePublisher:t}){return le.memo(function({children:r,style:s,context:i,...a}){const c=t("scrollContainerState"),l=e("ScrollerComponent"),d=t("smoothScrollTargetReached"),h=e("scrollerRef"),m=e("horizontalDirection")||!1,{scrollByCallback:f,scrollerRef:w,scrollToCallback:k}=pT(c,d,l,h,void 0,m);return n("scrollTo",k),n("scrollBy",f),o.jsx(l,{"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,ref:w,style:{...m?MV:VV,...s},tabIndex:0,...a,...yn(l,i),children:r})})}function xT({useEmitter:n,useEmitterValue:e,usePublisher:t}){return le.memo(function({children:r,style:s,context:i,...a}){const c=t("windowScrollContainerState"),l=e("ScrollerComponent"),d=t("smoothScrollTargetReached"),h=e("totalListHeight"),m=e("deviation"),f=e("customScrollParent"),w=le.useRef(null),k=e("scrollerRef"),{scrollByCallback:C,scrollerRef:b,scrollToCallback:N}=pT(c,d,l,k,f);return mT(()=>{var I;return b.current=f||((I=w.current)==null?void 0:I.ownerDocument.defaultView),()=>{b.current=null}},[b,f]),n("windowScrollTo",N),n("scrollBy",C),o.jsx(l,{ref:w,"data-virtuoso-scroller":!0,style:{position:"relative",...s,...h!==0?{height:h+m}:{}},...a,...yn(l,i),children:r})})}const $V=({children:n})=>{const e=le.useContext(hT),t=gr("viewportHeight"),r=gr("fixedItemHeight"),s=Re("alignToBottom"),i=Re("horizontalDirection"),a=le.useMemo(()=>$I(t,l=>mi(l,i?"width":"height")),[t,i]),c=uo(a,!0,Re("skipAnimationFrameInResizeObserver"));return le.useEffect(()=>{e&&(t(e.viewportHeight),r(e.itemHeight))},[e,t,r]),o.jsx("div",{"data-viewport-type":"element",ref:c,style:Jd(s),children:n})},qV=({children:n})=>{const e=le.useContext(hT),t=gr("windowViewportRect"),r=gr("fixedItemHeight"),s=Re("customScrollParent"),i=HI(t,s,Re("skipAnimationFrameInResizeObserver")),a=Re("alignToBottom");return le.useEffect(()=>{e&&(r(e.itemHeight),t({offsetTop:0,visibleHeight:e.viewportHeight,visibleWidth:100}))},[e,t,r]),o.jsx("div",{"data-viewport-type":"window",ref:i,style:Jd(a),children:n})},HV=({children:n})=>{const e=Re("TopItemListComponent")||"div",t=Re("headerHeight"),r={...UV,marginTop:`${t}px`},s=Re("context");return o.jsx(e,{style:r,...yn(e,s),children:n})},WV=le.memo(function(n){const e=Re("useWindowScroll"),t=Re("topItemsIndexes").length>0,r=Re("customScrollParent"),s=Re("context");return o.jsxs(r||e?QV:KV,{...n,context:s,children:[t&&o.jsx(HV,{children:o.jsx(Ew,{showTopList:!0})}),o.jsxs(r||e?qV:$V,{children:[o.jsx(BV,{}),o.jsx(Ew,{}),o.jsx(zV,{})]})]})}),{Component:GV,useEmitter:Qp,useEmitterValue:Re,usePublisher:gr}=dT(PV,{required:{},optional:{restoreStateFrom:"restoreStateFrom",context:"context",followOutput:"followOutput",scrollIntoViewOnChange:"scrollIntoViewOnChange",itemContent:"itemContent",groupContent:"groupContent",overscan:"overscan",increaseViewportBy:"increaseViewportBy",minOverscanItemCount:"minOverscanItemCount",totalCount:"totalCount",groupCounts:"groupCounts",topItemCount:"topItemCount",firstItemIndex:"firstItemIndex",initialTopMostItemIndex:"initialTopMostItemIndex",components:"components",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",computeItemKey:"computeItemKey",defaultItemHeight:"defaultItemHeight",fixedGroupHeight:"fixedGroupHeight",fixedItemHeight:"fixedItemHeight",heightEstimates:"heightEstimates",itemSize:"itemSize",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"HeaderFooterTag",data:"data",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",alignToBottom:"alignToBottom",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",horizontalDirection:"horizontalDirection",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver"},methods:{scrollToIndex:"scrollToIndex",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollBy:"scrollBy",autoscrollToBottom:"autoscrollToBottom",getState:"getState"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",totalListHeightChanged:"totalListHeightChanged",itemsRendered:"itemsRendered",groupIndices:"groupIndices"}},WV),KV=yT({useEmitter:Qp,useEmitterValue:Re,usePublisher:gr}),QV=xT({useEmitter:Qp,useEmitterValue:Re,usePublisher:gr}),wT=GV,YV=Ze(()=>{const n=te(d=>o.jsxs("td",{children:["Item $",d]})),e=te(null),t=te(d=>o.jsxs("td",{colSpan:1e3,children:["Group ",d]})),r=te(null),s=te(null),i=te({}),a=te(Kp),c=te(Ea),l=(d,h=null)=>xn(Q(i,de(m=>m[d]),gt()),h);return{components:i,computeItemKey:a,context:e,EmptyPlaceholder:l("EmptyPlaceholder"),FillerRow:l("FillerRow"),fixedFooterContent:s,fixedHeaderContent:r,itemContent:n,groupContent:t,ScrollerComponent:l("Scroller","div"),scrollerRef:c,ScrollSeekPlaceholder:l("ScrollSeekPlaceholder"),TableBodyComponent:l("TableBody","tbody"),TableComponent:l("Table","table"),TableFooterComponent:l("TableFoot","tfoot"),TableHeadComponent:l("TableHead","thead"),TableRowComponent:l("TableRow","tr"),GroupComponent:l("Group","tr")}});yt(uT,YV);Gp();const Nw={bottom:0,itemHeight:0,items:[],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},XV={bottom:0,itemHeight:0,items:[{index:0}],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},{ceil:kw,floor:td,max:mc,min:zh,round:Aw}=Math;function Cw(n,e,t){return Array.from({length:e-n+1}).map((r,s)=>({data:t===null?null:t[s+n],index:s+n}))}function JV(n){return{...XV,items:n}}function Kl(n,e){return n&&n.width===e.width&&n.height===e.height}function ZV(n,e){return n&&n.column===e.column&&n.row===e.row}const eM=Ze(([{increaseViewportBy:n,listBoundary:e,overscan:t,visibleRange:r},{footerHeight:s,headerHeight:i,scrollBy:a,scrollContainerState:c,scrollTo:l,scrollTop:d,smoothScrollTargetReached:h,viewportHeight:m},f,w,{didMount:k,propsReady:C},{customScrollParent:b,useWindowScroll:N,windowScrollContainerState:I,windowScrollTo:E,windowViewportRect:R},P])=>{const O=te(0),g=te(0),x=te(Nw),v=te({height:0,width:0}),A=te({height:0,width:0}),S=$e(),D=$e(),T=te(0),L=te(null),F=te({column:0,row:0}),G=$e(),q=$e(),U=te(!1),B=te(0),Y=te(!0),ue=te(!1),J=te(!1);tt(Q(k,Le(B),Ie(([re,je])=>!!je)),()=>{Pe(Y,!1)}),tt(Q(Vt(k,Y,A,v,B,ue),Ie(([re,je,ze,it,,Rt])=>re&&!je&&ze.height!==0&&it.height!==0&&!Rt)),([,,,,re])=>{Pe(ue,!0),$p(1,()=>{Pe(S,re)}),Pr(Q(d),()=>{Pe(e,[0,0]),Pe(Y,!0)})}),ye(Q(q,Ie(re=>re!=null&&re.scrollTop>0),zr(0)),g),tt(Q(k,Le(q),Ie(([,re])=>re!=null)),([,re])=>{re&&(Pe(v,re.viewport),Pe(A,re.item),Pe(F,re.gap),re.scrollTop>0&&(Pe(U,!0),Pr(Q(d,no(1)),je=>{Pe(U,!1)}),Pe(l,{top:re.scrollTop})))}),ye(Q(v,de(({height:re})=>re)),m),ye(Q(Vt(be(v,Kl),be(A,Kl),be(F,(re,je)=>re&&re.column===je.column&&re.row===je.row),be(d)),de(([re,je,ze,it])=>({gap:ze,item:je,scrollTop:it,viewport:re}))),G),ye(Q(Vt(be(O),r,be(F,ZV),be(A,Kl),be(v,Kl),be(L),be(g),be(U),be(Y),be(B)),Ie(([,,,,,,,re])=>!re),de(([re,[je,ze],it,Rt,ot,et,ft,,Ye,Ve])=>{const{column:Ue,row:mt}=it,{height:Ge,width:Dn}=Rt,{width:Lr}=ot;if(ft===0&&(re===0||Lr===0))return Nw;if(Dn===0){const br=qp(Ve,re),Yn=br+Math.max(ft-1,0);return JV(Cw(br,Yn,et))}const Gt=_T(Lr,Dn,Ue);let Kt,jt;Ye?je===0&&ze===0&&ft>0?(Kt=0,jt=ft-1):(Kt=Gt*td((je+mt)/(Ge+mt)),jt=Gt*kw((ze+mt)/(Ge+mt))-1,jt=zh(re-1,mc(jt,Gt-1)),Kt=zh(jt,mc(0,Kt))):(Kt=0,jt=-1);const lt=Cw(Kt,jt,et),{bottom:pt,top:On}=Sw(ot,it,Rt,lt),lr=kw(re/Gt),vr=lr*Ge+(lr-1)*mt-pt;return{bottom:pt,itemHeight:Ge,items:lt,itemWidth:Dn,offsetBottom:vr,offsetTop:On,top:On}})),x),ye(Q(L,Ie(re=>re!==null),de(re=>re.length)),O),ye(Q(Vt(v,A,x,F),Ie(([re,je,{items:ze}])=>ze.length>0&&je.height!==0&&re.height!==0),de(([re,je,{items:ze},it])=>{const{bottom:Rt,top:ot}=Sw(re,it,je,ze);return[ot,Rt]}),gt(Bc)),e);const H=te(!1);ye(Q(d,Le(H),de(([re,je])=>je||re!==0)),H);const we=ar(Q(Vt(x,O),Ie(([{items:re}])=>re.length>0),Le(H),Ie(([[re,je],ze])=>{const it=re.items[re.items.length-1].index===je-1;return(ze||re.bottom>0&&re.itemHeight>0&&re.offsetBottom===0&&re.items.length===je)&&it}),de(([[,re]])=>re-1),gt())),Ae=ar(Q(be(x),Ie(({items:re})=>re.length>0&&re[0].index===0),zr(0),gt())),ct=ar(Q(be(x),Le(U),Ie(([{items:re},je])=>re.length>0&&!je),de(([{items:re}])=>({endIndex:re[re.length-1].index,startIndex:re[0].index})),gt(XI),gs(0)));ye(ct,w.scrollSeekRangeChanged),ye(Q(S,Le(v,A,O,F),de(([re,je,ze,it,Rt])=>{const ot=nT(re),{align:et,behavior:ft,offset:Ye}=ot;let Ve=ot.index;Ve==="LAST"&&(Ve=it-1),Ve=mc(0,Ve,zh(it-1,Ve));let Ue=$f(je,Rt,ze,Ve);return et==="end"?Ue=Aw(Ue-je.height+ze.height):et==="center"&&(Ue=Aw(Ue-je.height/2+ze.height/2)),Ye&&(Ue+=Ye),{behavior:ft,top:Ue}})),l);const qe=xn(Q(x,de(re=>re.offsetBottom+re.bottom)),0);return ye(Q(R,de(re=>({height:re.visibleHeight,width:re.visibleWidth}))),v),{customScrollParent:b,data:L,deviation:T,footerHeight:s,gap:F,headerHeight:i,increaseViewportBy:n,initialItemCount:g,itemDimensions:A,overscan:t,restoreStateFrom:q,scrollBy:a,scrollContainerState:c,scrollHeight:D,scrollTo:l,scrollToIndex:S,scrollTop:d,smoothScrollTargetReached:h,totalCount:O,useWindowScroll:N,viewportDimensions:v,windowScrollContainerState:I,windowScrollTo:E,windowViewportRect:R,...w,gridState:x,horizontalDirection:J,initialTopMostItemIndex:B,totalListHeight:qe,...f,endReached:we,propsReady:C,rangeChanged:ct,startReached:Ae,stateChanged:G,stateRestoreInProgress:U,...P}},yt(Hp,Pn,xl,cT,vi,Wp,_i));function _T(n,e,t){return mc(1,td((n+t)/(td(e)+t)))}function Sw(n,e,t,r){const{height:s}=t;if(s===void 0||r.length===0)return{bottom:0,top:0};const i=$f(n,e,t,r[0].index);return{bottom:$f(n,e,t,r[r.length-1].index)+s,top:i}}function $f(n,e,t,r){const s=_T(n.width,t.width,e.column),i=td(r/s),a=i*t.height+mc(0,i-1)*e.row;return a>0?a+e.row:a}const tM=Ze(()=>{const n=te(m=>`Item ${m}`),e=te({}),t=te(null),r=te("virtuoso-grid-item"),s=te("virtuoso-grid-list"),i=te(Kp),a=te("div"),c=te(Ea),l=(m,f=null)=>xn(Q(e,de(w=>w[m]),gt()),f),d=te(!1),h=te(!1);return ye(be(h),d),{components:e,computeItemKey:i,context:t,FooterComponent:l("Footer"),HeaderComponent:l("Header"),headerFooterTag:a,itemClassName:r,ItemComponent:l("Item","div"),itemContent:n,listClassName:s,ListComponent:l("List","div"),readyStateChanged:d,reportReadyState:h,ScrollerComponent:l("Scroller","div"),scrollerRef:c,ScrollSeekPlaceholder:l("ScrollSeekPlaceholder","div")}}),nM=Ze(([n,e])=>({...n,...e}),yt(eM,tM)),rM=le.memo(function(){const n=xt("gridState"),e=xt("listClassName"),t=xt("itemClassName"),r=xt("itemContent"),s=xt("computeItemKey"),i=xt("isSeeking"),a=yr("scrollHeight"),c=xt("ItemComponent"),l=xt("ListComponent"),d=xt("ScrollSeekPlaceholder"),h=xt("context"),m=yr("itemDimensions"),f=yr("gap"),w=xt("log"),k=xt("stateRestoreInProgress"),C=yr("reportReadyState"),b=uo(le.useMemo(()=>N=>{const I=N.parentElement.parentElement.scrollHeight;a(I);const E=N.firstChild;if(E){const{height:R,width:P}=E.getBoundingClientRect();m({height:R,width:P})}f({column:Rw("column-gap",getComputedStyle(N).columnGap,w),row:Rw("row-gap",getComputedStyle(N).rowGap,w)})},[a,m,f,w]),!0,!1);return mT(()=>{n.itemHeight>0&&n.itemWidth>0&&C(!0)},[n]),k?null:o.jsx(l,{className:e,ref:b,...yn(l,h),"data-testid":"virtuoso-item-list",style:{paddingBottom:n.offsetBottom,paddingTop:n.offsetTop},children:n.items.map(N=>{const I=s(N.index,N.data,h);return i?o.jsx(d,{...yn(d,h),height:n.itemHeight,index:N.index,width:n.itemWidth},I):y.createElement(c,{...yn(c,h),className:t,"data-index":N.index,key:I},r(N.index,N.data,h))})})}),sM=le.memo(function(){const n=xt("HeaderComponent"),e=yr("headerHeight"),t=xt("headerFooterTag"),r=uo(le.useMemo(()=>i=>{e(mi(i,"height"))},[e]),!0,!1),s=xt("context");return n?o.jsx(t,{ref:r,children:o.jsx(n,{...yn(n,s)})}):null}),iM=le.memo(function(){const n=xt("FooterComponent"),e=yr("footerHeight"),t=xt("headerFooterTag"),r=uo(le.useMemo(()=>i=>{e(mi(i,"height"))},[e]),!0,!1),s=xt("context");return n?o.jsx(t,{ref:r,children:o.jsx(n,{...yn(n,s)})}):null}),oM=({children:n})=>{const e=le.useContext(fT),t=yr("itemDimensions"),r=yr("viewportDimensions"),s=uo(le.useMemo(()=>i=>{r(i.getBoundingClientRect())},[r]),!0,!1);return le.useEffect(()=>{e&&(r({height:e.viewportHeight,width:e.viewportWidth}),t({height:e.itemHeight,width:e.itemWidth}))},[e,r,t]),o.jsx("div",{ref:s,style:Jd(!1),children:n})},aM=({children:n})=>{const e=le.useContext(fT),t=yr("windowViewportRect"),r=yr("itemDimensions"),s=xt("customScrollParent"),i=HI(t,s,!1);return le.useEffect(()=>{e&&(r({height:e.itemHeight,width:e.itemWidth}),t({offsetTop:0,visibleHeight:e.viewportHeight,visibleWidth:e.viewportWidth}))},[e,t,r]),o.jsx("div",{ref:i,style:Jd(!1),children:n})},cM=le.memo(function({...n}){const e=xt("useWindowScroll"),t=xt("customScrollParent"),r=t||e?uM:lM,s=t||e?aM:oM,i=xt("context");return o.jsx(r,{...n,...yn(r,i),children:o.jsxs(s,{children:[o.jsx(sM,{}),o.jsx(rM,{}),o.jsx(iM,{})]})})}),{useEmitter:vT,useEmitterValue:xt,usePublisher:yr}=dT(nM,{optional:{context:"context",totalCount:"totalCount",overscan:"overscan",itemContent:"itemContent",components:"components",computeItemKey:"computeItemKey",data:"data",initialItemCount:"initialItemCount",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"headerFooterTag",listClassName:"listClassName",itemClassName:"itemClassName",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",restoreStateFrom:"restoreStateFrom",initialTopMostItemIndex:"initialTopMostItemIndex",increaseViewportBy:"increaseViewportBy"},methods:{scrollTo:"scrollTo",scrollBy:"scrollBy",scrollToIndex:"scrollToIndex"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",stateChanged:"stateChanged",readyStateChanged:"readyStateChanged"}},cM),lM=yT({useEmitter:vT,useEmitterValue:xt,usePublisher:yr}),uM=xT({useEmitter:vT,useEmitterValue:xt,usePublisher:yr});function Rw(n,e,t){return e!=="normal"&&!(e!=null&&e.endsWith("px"))&&t(`${n} was not resolved to pixel value correctly`,e,Hn.WARN),e==="normal"?0:parseInt(e??"0",10)}function dM({value:n,options:e,onChange:t,className:r,triggerClassName:s}){const[i,a]=y.useState(!1),c=y.useRef(null),l=e.find(h=>h.value===n);y.useEffect(()=>{const h=m=>{c.current&&!c.current.contains(m.target)&&a(!1)};return i&&(document.addEventListener("mousedown",h),document.addEventListener("touchstart",h)),()=>{document.removeEventListener("mousedown",h),document.removeEventListener("touchstart",h)}},[i]);const d=h=>{t(h),a(!1)};return o.jsxs("div",{ref:c,className:Je("relative inline-block",r),children:[o.jsxs("button",{type:"button",onClick:()=>a(!i),className:Je("inline-flex items-center justify-between gap-2 rounded-lg border border-border/60 bg-background/50 px-3 py-1.5 text-xs transition-colors hover:bg-accent/50",s),children:[o.jsx("span",{children:l?.label}),o.jsx(n_,{size:14,style:{stroke:"currentColor",fill:"none",display:"block",width:"14px",height:"14px",transform:i?"rotate(180deg)":"rotate(0deg)",transition:"transform 200ms ease"}})]}),i&&o.jsx("div",{className:"absolute right-0 top-full mt-1 z-[9999] min-w-[6rem] rounded-md border border-border bg-popover shadow-lg animate-in fade-in-0 zoom-in-95 slide-in-from-top-2",children:o.jsx("div",{className:"p-1",children:e.map(h=>o.jsxs("button",{type:"button",onClick:()=>d(h.value),className:Je("relative w-full flex items-center justify-between gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors cursor-pointer","hover:bg-accent hover:text-accent-foreground",h.value===n?"bg-accent/50 text-accent-foreground":"text-popover-foreground"),children:[o.jsx("span",{children:h.label}),h.value===n&&o.jsx(yc,{size:16,style:{stroke:"currentColor",fill:"none",display:"block",width:"16px",height:"16px"}})]},h.value))})})]})}function hM({icon:n,title:e,description:t,action:r,glowClassName:s,circleClassName:i,containerClassName:a}){return o.jsxs("div",{className:`flex flex-col items-center justify-center h-96 text-center px-4 ${a??""}`,children:[o.jsxs("div",{className:"relative mb-8",children:[o.jsx("div",{className:`absolute inset-0 ${s??"bg-amber-500/30 dark:bg-amber-400/30"} blur-3xl rounded-full animate-pulse`}),o.jsx("div",{className:`relative w-32 h-32 rounded-full ${i??"bg-amber-100 dark:bg-amber-900/40 border-4 border-amber-400 dark:border-amber-600"} flex items-center justify-center shadow-lg`,children:n})]}),o.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:e}),o.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-64",children:t}),r]})}function bT({icon:n,title:e,description:t,glowClassName:r,circleClassName:s}){return o.jsx(Z,{children:o.jsxs(ee,{className:"p-8 text-center",children:[o.jsxs("div",{className:"relative mb-6",children:[o.jsx("div",{className:`absolute inset-0 ${r??"bg-amber-500/30 dark:bg-amber-400/30"} blur-2xl rounded-full`}),o.jsx("div",{className:`relative w-24 h-24 rounded-full ${s??"bg-amber-100 dark:bg-amber-900/40 border-4 border-amber-400 dark:border-amber-600"} shadow-lg flex items-center justify-center mx-auto`,children:n})]}),o.jsx("h3",{className:"font-medium text-foreground mb-2",children:e}),o.jsx("p",{className:"text-sm text-muted-foreground",children:t})]})})}function nd(n,e=!1){const t=y.useRef([]);return y.useEffect(()=>{n.length>0&&(t.current=n)},[n]),{visible:n.length>0?n:e?t.current:[],lastNonEmpty:t.current}}const fM=[{label:"",value:"latest"},{label:"",value:"oldest"},{label:"",value:"lanterns"}],jw={lanterns:(n,e)=>(e.lanterns??0)-(n.lanterns??0),oldest:(n,e)=>(n.createdAt?.getTime?.()??0)-(e.createdAt?.getTime?.()??0),latest:(n,e)=>(e.createdAt?.getTime?.()??0)-(n.createdAt?.getTime?.()??0)},mM=n=>n.hidden===!0;function pM({posts:n,activeCategory:e,activeSubCategory:t,sortBy:r,categories:s,onSubCategoryChange:i}){const a=Ia({key:`main-posts-${e}-${t}`}),c=y.useDeferredValue(n),l=y.useMemo(()=>{const I=new Set;return c.forEach(E=>{typeof E.authorUid=="string"&&E.authorUid.length>0&&I.add(E.authorUid)}),Array.from(I)},[c]),d=ba(l),h=y.useMemo(()=>s.find(I=>I.id===e),[s,e]),m=y.useMemo(()=>h?.subCategories??[],[h]),f=y.useCallback(I=>{const E=I.currentTarget.getAttribute("data-sub-id");E&&i(E)},[i]),w=y.useMemo(()=>{const I=c.filter(R=>!mM(R)),E=e===""?I:I.filter(R=>R.category===e);return t===""?E:E.filter(R=>R.subCategory===t)},[c,e,t]),k=y.useMemo(()=>{const E=jw[r??"latest"]??jw.latest;return[...w].sort(E)},[w,r]),{visible:C}=nd(k,!0),b=y.useCallback(I=>Vp(I),[]),N=y.useCallback(I=>I?I.toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",[]);return{scrollRef:a,currentSubCategories:m,visiblePosts:C,filteredCount:k.length,handleSubCategoryClick:f,formatTimeAgo:b,formatCreatedAt:N,userProfiles:d}}const gM=(n,e)=>n===e?!0:n?.profileImage===e?.profileImage&&n?.currentTitleId===e?.currentTitleId;function yM({posts:n,userNickname:e,userProfileImage:t,activeCategory:r,activeSubCategory:s,sortBy:i,categories:a,onSubCategoryChange:c,onSortChange:l,isPostLanterned:d,isBookmarked:h,onPostClick:m,onLanternToggle:f,onBookmarkToggle:w,onStartWriting:k,currentTitle:C}){const{scrollRef:b,currentSubCategories:N,visiblePosts:I,filteredCount:E,handleSubCategoryClick:R,formatTimeAgo:P,formatCreatedAt:O,userProfiles:g}=pM({posts:n,activeCategory:r,activeSubCategory:s,sortBy:i,categories:a,onSubCategoryChange:c}),x=y.useCallback(v=>{l(v)},[l]);return o.jsxs("div",{className:"h-full flex flex-col",children:[o.jsx(wM,{currentSubCategories:N,activeSubCategory:s,handleSubCategoryClick:R,filteredCount:E,sortBy:i,onSortChange:x}),o.jsx("div",{className:"flex-1 overflow-hidden bg-background",children:I.length===0?o.jsx("div",{className:"h-full overflow-y-auto scrollbar-hide p-4",children:o.jsx(_M,{onStartWriting:k})}):o.jsx(vM,{posts:I,userNickname:e,userProfileImage:t,isPostLanterned:d,isBookmarked:h,currentTitle:C,userProfiles:g,formatTimeAgo:P,formatCreatedAt:O,onPostClick:m,onLanternToggle:f,onBookmarkToggle:w,scrollRef:b})})]})}const xM=le.memo(yM);function wM({currentSubCategories:n,activeSubCategory:e,handleSubCategoryClick:t,filteredCount:r,sortBy:s,onSortChange:i}){return o.jsxs("div",{className:"bg-card/98 glass-effect border-b border-border px-4 py-3 flex-shrink-0 shadow-sm relative z-20",children:[n.length>1&&o.jsx("div",{className:"flex space-x-2 overflow-x-auto scrollbar-hide mb-3",children:n.map(a=>{const c=e===a.id;return o.jsx(se,{variant:c?"default":"ghost",size:"sm","data-sub-id":a.id,onClick:t,className:`whitespace-nowrap flex-shrink-0 rounded-full px-4 transition-all duration-200 ${c?"bg-primary text-primary-foreground shadow-sm":"hover:bg-accent/80"}`,children:a.name},a.id)})}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("span",{className:"text-sm text-muted-foreground",children:[r," "]}),o.jsx(dM,{value:s,onChange:a=>i(a),options:fM,triggerClassName:"w-24 h-8"})]})]})}function _M({onStartWriting:n}){return o.jsx(hM,{icon:o.jsx(Ts,{className:"w-20 h-20 text-amber-900 dark:text-amber-200"}),title:"  ",description:"      !",action:o.jsxs(se,{onClick:n,className:"bg-primary text-primary-foreground px-6 py-2 rounded-xl",children:[o.jsx(r_,{className:"w-4 h-4 mr-2"}),"  "]}),glowClassName:"bg-amber-500/30 dark:bg-amber-400/30",circleClassName:"bg-amber-100 dark:bg-amber-900/40 border-4 border-amber-400 dark:border-amber-600"})}const vM=le.memo(function({posts:e,userNickname:t,userProfileImage:r,isPostLanterned:s,isBookmarked:i,currentTitle:a,userProfiles:c,formatTimeAgo:l,formatCreatedAt:d,onPostClick:h,onLanternToggle:m,onBookmarkToggle:f,scrollRef:w}){const k=y.useMemo(()=>e.map(C=>({post:C,isLanterned:s(C.id),isBookmarked:i(C.id),timeAgo:l(C.createdAt),createdAtText:d(C.createdAt),authorProfile:C.authorUid?c[C.authorUid]:void 0})),[e,s,i,l,d,c]);return o.jsx(wT,{style:{height:"100%"},scrollerRef:C=>{w&&C&&(w.current=C)},data:k,className:"scrollbar-hide",itemContent:(C,{post:b,isLanterned:N,isBookmarked:I,timeAgo:E,createdAtText:R,authorProfile:P})=>o.jsx("div",{className:"px-4 py-1.5 first:pt-3 last:pb-24",children:o.jsx(bM,{post:b,userNickname:t,userProfileImage:r,isLanterned:N,isBookmarked:I,timeAgo:E,createdAtText:R,currentTitle:a,authorProfile:P,onPostClick:h,onLanternToggle:m,onBookmarkToggle:f},b.id)})})}),bM=le.memo(({post:n,userNickname:e,userProfileImage:t,isLanterned:r,isBookmarked:s,timeAgo:i,createdAtText:a,currentTitle:c,authorProfile:l,onPostClick:d,onLanternToggle:h,onBookmarkToggle:m})=>{const f=n.author===e,w=l?.currentTitleId??null,k=da(w),C=l?.profileImage??(f?t:n.authorAvatar??""),b=Kd(n.author??"",e,c),N=n.authorDeleted===!0||n.author===" ",I=Dp(n.author,N),E=Hd(n.author,N),R=E?null:k||b,P=y.useCallback(()=>{d(n)},[d,n]),O=y.useCallback(x=>{x.stopPropagation(),h(n.id)},[h,n.id]),g=y.useCallback(x=>{x.stopPropagation(),m(n.id)},[m,n.id]);return o.jsx(Z,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm hover:shadow-md transition-shadow cursor-pointer list-optimized",onClick:P,children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(Es,{src:C||void 0,alt:I?`${I} `:" ",fallbackText:I.charAt(0)?.toUpperCase()||"?",className:"w-10 h-10 ring-2 ring-border/20",size:40,loading:"lazy",decoding:"async"}),o.jsx("div",{className:"w-full",children:o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("p",{className:"text-sm font-medium "+(E?"text-muted-foreground":""),children:I}),R&&o.jsx(ht,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:R})]}),o.jsx("div",{className:"text-xs text-muted-foreground",children:(n.timeAgo??i)&&o.jsx("span",{title:a||void 0,children:n.timeAgo??i})})]}),(()=>{const x=[n.category&&n.category!==""?n.category:null,n.subCategory&&n.subCategory!==""?n.subCategory:null,n.type?n.type==="guide"?" ":"":null].filter(Boolean);return x.length?o.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:x.join("  ")}):null})()]})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{className:"font-medium text-base mb-1 line-clamp-1",children:n.title}),o.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:n.content})]}),o.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[o.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[f?o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ts,{className:"w-4 h-4"}),o.jsx("span",{className:"text-xs",children:n.lanterns??0})]}):o.jsxs(se,{variant:"ghost",size:"sm",onClick:O,className:`h-8 px-2 space-x-1 ${r?"text-amber-500":"text-muted-foreground"}`,children:[r?o.jsx(pr,{className:"w-4 h-4"}):o.jsx(Ts,{className:"w-4 h-4"}),o.jsx("span",{className:"text-xs",children:n.lanterns??0})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ln,{className:"w-4 h-4"}),o.jsx("span",{className:"text-xs",children:n.comments??n.replies?.length??0})]}),o.jsxs("span",{children:[" ",n.views??0]})]}),o.jsx(se,{variant:"ghost",size:"sm",onClick:g,className:`h-8 px-2 ${s?"text-primary":"text-muted-foreground"}`,children:o.jsx(ai,{className:`w-4 h-4 ${s?"fill-current":""}`})})]})]})})})},(n,e)=>{if(n.post.id!==e.post.id||n.isLanterned!==e.isLanterned||n.isBookmarked!==e.isBookmarked||n.post.lanterns!==e.post.lanterns||(n.post.comments??n.post.replies?.length)!==(e.post.comments??e.post.replies?.length)||n.post.views!==e.post.views||n.post.title!==e.post.title||n.post.content!==e.post.content||n.post.type!==e.post.type||n.post.author!==e.post.author||n.post.authorAvatar!==e.post.authorAvatar||(n.post.createdAt?.getTime?.()??0)!==(e.post.createdAt?.getTime?.()??0))return!1;const t=n.post.tags?.join(",")??"",r=e.post.tags?.join(",")??"";return!(t!==r||!gM(n.authorProfile,e.authorProfile)||n.timeAgo!==e.timeAgo||n.createdAtText!==e.createdAtText||n.currentTitle!==e.currentTitle||n.userProfileImage!==e.userProfileImage||n.userNickname!==e.userNickname)});function IM({isDarkMode:n,onToggleDarkMode:e,hasNotifications:t,showNotifications:r,onNotificationsToggle:s,notifications:i,onNotificationClick:a,onMarkAllNotificationsRead:c,onNotificationSettingsClick:l,onNotificationDelete:d,activeCategory:h,activeSubCategory:m,onCategoryClick:f,onQuizClick:w,onTitleShopClick:k,isAdmin:C,onOpenAdminReports:b}){return o.jsx("header",{className:"bg-card/98 glass-effect border-b border-border/60 flex-shrink-0 z-40 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(se,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200",onClick:f,children:o.jsx(aE,{className:"w-5 h-5"})}),o.jsx("div",{children:o.jsxs("h1",{className:"text-lg font-semibold",children:[h,m!==""&&`  ${m}`]})})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(se,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200 text-foreground",onClick:w,"aria-label":" ",children:o.jsx(s_,{className:"w-5 h-5"})}),o.jsx(se,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200 text-foreground",onClick:k,children:o.jsx(cE,{className:"w-5 h-5"})}),C&&b&&o.jsx(se,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200 text-foreground",onClick:b,"aria-label":" ",children:o.jsx(oi,{className:"w-5 h-5"})}),o.jsx(se,{variant:"ghost",size:"icon",className:"touch-target rounded-xl hover:bg-accent/80 transition-all duration-200",onClick:e,children:n?o.jsx(ro,{className:"w-4 h-4"}):o.jsx(so,{className:"w-4 h-4"})}),o.jsxs(Lp,{open:r,onOpenChange:s,children:[o.jsx(Wd,{asChild:!0,children:o.jsxs(se,{variant:"ghost",size:"icon",className:"relative",children:[o.jsx(i_,{className:"w-4 h-4"}),t&&o.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"})]})}),o.jsxs(Gd,{className:"w-80 p-0",align:"end",side:"bottom",sideOffset:5,children:[o.jsx("div",{className:"p-4 border-b border-border",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h3",{className:"font-medium",children:""}),o.jsxs("div",{className:"flex items-center space-x-2",children:[i.some(N=>!N.isRead)&&o.jsx(se,{variant:"outline",size:"sm",onClick:c,className:"text-xs h-7 px-2",children:" "}),o.jsx(se,{variant:"ghost",size:"icon",onClick:l,children:o.jsx(Jf,{className:"w-4 h-4"})})]})]})}),o.jsx("div",{className:"max-h-80 scroll-optimized",children:i.length===0?o.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"  "}):o.jsx(o.Fragment,{children:i.map(N=>o.jsx(EM,{notification:N,onNotificationClick:()=>a(N),onDelete:()=>d?.(N.id)},N.id))})})]})]})]})]})})})}const TM=le.memo(IM);function EM({notification:n,onNotificationClick:e,onDelete:t}){const r=y.useRef(null),s=y.useRef(null),i=y.useRef(0),[a,c]=le.useState(0),l=y.useRef(!1),d=80,h=10,m=y.useCallback(()=>{i.current=0,c(0),r.current=null,s.current=null,l.current=!1},[]),f=y.useCallback((O,g)=>{r.current=O,s.current=g,i.current=0,l.current=!1,c(0)},[]),w=y.useCallback((O,g)=>{if(r.current===null||s.current===null)return;const x=O-r.current,v=Math.abs(g-s.current);Math.abs(x)>h&&v<50&&(l.current=!0,i.current=x,c(x))},[]),k=y.useCallback(()=>{if(r.current===null)return;Math.abs(i.current)>d&&t&&t(),m()},[t,m]),C=y.useCallback(O=>{const g=O.touches[0];f(g.clientX,g.clientY)},[f]),b=y.useCallback(O=>{if(r.current===null||s.current===null)return;const g=O.touches[0],x=g.clientX-r.current,v=Math.abs(g.clientY-s.current);Math.abs(x)>h&&Math.abs(x)>v*1.5?(l.current=!0,i.current=x,c(x),O.preventDefault(),O.stopPropagation()):l.current&&(O.preventDefault(),O.stopPropagation())},[]),N=y.useCallback(O=>{l.current&&(O.preventDefault(),O.stopPropagation()),k()},[k]),I=y.useCallback(O=>{f(O.clientX,O.clientY);const g=v=>{r.current!==null&&w(v.clientX,v.clientY)},x=()=>{k(),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",x)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",x)},[f,w,k]),E=y.useCallback(O=>{if(l.current||Math.abs(i.current)>h){O.preventDefault(),O.stopPropagation();return}e()},[e]),R=Math.abs(a)>d?.4:1,P=Math.abs(a)>20;return o.jsxs("div",{className:`p-4 border-b border-border hover:bg-muted/50 transition-all cursor-pointer relative overflow-hidden select-none ${n.isRead?"":"bg-muted/30"}`,onClick:E,onTouchStart:C,onTouchMove:b,onTouchEnd:N,onMouseDown:I,style:{transform:`translateX(${a}px)`,opacity:R,transition:a===0?"transform 0.2s ease-out, opacity 0.2s ease-out":"none",touchAction:"pan-y"},children:[P&&o.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center justify-end px-4 bg-destructive text-destructive-foreground pointer-events-none",style:{width:`${Math.min(Math.abs(a)+20,120)}px`},children:o.jsx("span",{className:"text-xs font-medium whitespace-nowrap",children:""})}),o.jsxs("div",{className:"flex items-start space-x-3 relative z-10",children:[o.jsxs("div",{className:"flex-shrink-0 mt-1",children:[n.type==="reply"&&o.jsx(Ln,{className:"w-4 h-4 text-blue-500"}),n.type==="lantern"&&o.jsx(pr,{className:"w-4 h-4 text-amber-500"}),n.type==="popular"&&o.jsx(oi,{className:"w-4 h-4 text-primary"})]}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"text-sm",children:n.message}),o.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[n.postTitle,"  ",n.time]})]}),!n.isRead&&o.jsx("div",{className:"w-2 h-2 bg-primary rounded-full flex-shrink-0"})]})]})}function Pw({title:n,subtitle:e,onBack:t,rightSlot:r}){return o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[t&&o.jsx(se,{variant:"ghost",size:"icon",onClick:t,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("h1",{className:"font-medium",children:n}),e&&o.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e})]})]}),r&&o.jsx("div",{children:r})]})})})}const NM="weekly_quizzes",kM="user_quiz_answers";function AM(n=new Date){const e=new Date(n.toLocaleString("en-US",{timeZone:"Asia/Seoul"})),t=e.getFullYear(),r=new Date(t,0,1),s=Math.floor((e.getTime()-r.getTime())/(1440*60*1e3)),i=Math.ceil((s+r.getDay()+1)/7);return`${t}-W${i.toString().padStart(2,"0")}`}function CM({onBack:n}){const[e,t]=y.useState("category"),[r,s]=y.useState(null),[i,a]=y.useState(null),[c,l]=y.useState(0),[d,h]=y.useState(new Map),[m,f]=y.useState(!1),[w,k]=y.useState(null),[C,b]=y.useState(!1),[N,I]=y.useState([]),[E,R]=y.useState(new Map),P=y.useMemo(()=>AM(),[]);y.useEffect(()=>{(async()=>{b(!0);try{const G=St(me,NM),q=zn(G,jr("weekId","==",P)),U=await jn(q),B=new Map,Y=[];U.forEach(ue=>{const J=ue.data(),H=J.category;H&&Array.isArray(J.questions)&&J.questions.length>0&&(B.set(H,{weekId:J.weekId,category:H,startDate:J.startDate?.toDate?.()??new Date,endDate:J.endDate?.toDate?.()??new Date,questions:J.questions,rewards:J.rewards??{perfect:10,partial:5}}),Y.push(H))}),R(B),I(Y)}catch(G){console.error("[QuizScreen]   :",G),oe.error("  .")}finally{b(!1)}})()},[P]);const O=y.useCallback(F=>{const G=E.get(F);if(!G){oe.error("     .");return}s(F),a(G),l(0),h(new Map),f(!1),k(null),t("quiz")},[E]),g=y.useCallback((F,G)=>{h(q=>{const U=new Map(q);return U.set(F,G),U})},[]),x=y.useCallback(()=>{i&&(c<i.questions.length-1?l(F=>F+1):v())},[i,c]),v=y.useCallback(async()=>{if(!i||!_e.currentUser)return;const F=[];let G=0;i.questions.forEach(B=>{const Y=d.get(B.id)??-1,ue=Y===B.correctIndex;ue&&G++,F.push({questionId:B.id,selectedIndex:Y,isCorrect:ue})});const q=Math.round(G/i.questions.length*100),U=i.questions.length;k({score:q,correctCount:G,totalCount:U}),f(!0);try{const B={userId:_e.currentUser.uid,weekId:i.weekId,category:i.category,answers:F,score:q,completedAt:Sn()},Y=Se(me,kM,`${_e.currentUser.uid}_${i.weekId}_${i.category}`);await $n(Y,B,{merge:!0}),q===100?oe.success(`! ${i.rewards.perfect}  .`):q>=60&&oe.success(`! ${i.rewards.partial}  .`)}catch(B){console.error("[QuizScreen]   :",B)}},[i,d]),A=y.useCallback(()=>{t("category"),s(null),a(null),l(0),h(new Map),f(!1),k(null)},[]),S=y.useCallback(()=>{i&&(l(0),h(new Map),f(!1),k(null))},[i]),D=i?.questions[c],T=D&&d.has(D.id),L=c===(i?.questions.length??0)-1;return e==="category"?o.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[o.jsx(Pw,{title:" ",onBack:n}),o.jsx("div",{className:"flex-1 overflow-y-auto",children:o.jsx("div",{className:"max-w-screen-md mx-auto px-4 py-4",children:C?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx("p",{className:"text-muted-foreground",children:"  ..."})}):N.length===0?o.jsx(bT,{icon:o.jsx(s_,{className:"w-12 h-12 text-muted-foreground"}),title:"   ",description:"    ."}):o.jsxs("div",{className:"space-y-3",children:[o.jsx(Z,{children:o.jsxs(ee,{className:"p-4",children:[o.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[o.jsx(yu,{className:"w-5 h-5 text-amber-500"}),o.jsx("p",{className:"font-medium",children:"  "})]}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"    !"})]})}),N.map(F=>{const G=E.get(F),q=G?.questions.length??0;return o.jsx(Z,{className:"cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>O(F),children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-medium",children:F}),o.jsxs("p",{className:"text-sm text-muted-foreground",children:[q,""]})]}),o.jsxs(ht,{variant:"secondary",children:[G?.rewards.perfect??10," "]})]})})},F)})]})})})]}):e==="quiz"&&i&&D?o.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[o.jsx(Pw,{title:`${i.category} `,onBack:m?void 0:A}),o.jsx("div",{className:"flex-1 overflow-y-auto",children:o.jsx("div",{className:"max-w-screen-md mx-auto px-4 py-4",children:m&&w?o.jsxs("div",{className:"space-y-4",children:[o.jsx(Z,{className:"bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/20",children:o.jsxs(ee,{className:"p-6 text-center",children:[o.jsx("div",{className:"flex justify-center mb-4",children:w.score===100?o.jsx(yu,{className:"w-16 h-16 text-amber-500"}):w.score>=60?o.jsx(xu,{className:"w-16 h-16 text-green-500"}):o.jsx(yg,{className:"w-16 h-16 text-red-500"})}),o.jsxs("p",{className:"text-2xl font-bold mb-2",children:[w.score,""]}),o.jsxs("p",{className:"text-sm text-muted-foreground",children:[w.correctCount," / ",w.totalCount," "]}),w.score===100&&o.jsxs("p",{className:"text-sm text-amber-500 mt-2",children:["+",i.rewards.perfect,"  !"]}),w.score>=60&&w.score<100&&o.jsxs("p",{className:"text-sm text-green-500 mt-2",children:["+",i.rewards.partial,"  !"]})]})}),o.jsx("div",{className:"space-y-3",children:i.questions.map((F,G)=>{const q=d.get(F.id)??-1,U=q===F.correctIndex;return o.jsx(Z,{children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"flex items-start space-x-2 mb-3",children:[U?o.jsx(xu,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}):o.jsx(yg,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("p",{className:"font-medium mb-2",children:[G+1,". ",F.question]}),o.jsx("div",{className:"space-y-2",children:F.options.map((B,Y)=>{const ue=q===Y,J=Y===F.correctIndex;return o.jsx("div",{className:`p-2 rounded border ${J?"bg-green-500/10 border-green-500/50":ue&&!J?"bg-red-500/10 border-red-500/50":"bg-muted/30 border-border"}`,children:o.jsxs("p",{className:"text-sm",children:[String.fromCharCode(65+Y),". ",B,J&&" "]})},Y)})}),o.jsx("div",{className:"mt-3 p-2 bg-muted/30 rounded",children:o.jsxs("p",{className:"text-xs text-muted-foreground",children:[o.jsx("span",{className:"font-medium",children:":"})," ",F.explanation]})})]})]})})},F.id)})}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx(se,{variant:"outline",className:"flex-1",onClick:A,children:" "}),o.jsx(se,{className:"flex-1",onClick:S,children:" "})]})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsx(Z,{children:o.jsxs(ee,{className:"p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("p",{className:"font-medium",children:[c+1," / ",i.questions.length]}),o.jsxs(ht,{variant:"secondary",children:[Math.round((c+1)/i.questions.length*100),"%"]})]}),o.jsx("p",{className:"text-lg mb-4",children:D.question})]})}),o.jsx("div",{className:"space-y-2",children:D.options.map((F,G)=>{const q=d.get(D.id)===G;return o.jsx(Z,{className:`cursor-pointer transition-colors ${q?"bg-primary/10 border-primary":"hover:bg-accent/50"}`,onClick:()=>g(D.id,G),children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${q?"border-primary bg-primary":"border-muted-foreground"}`,children:q&&o.jsx("div",{className:"w-2 h-2 rounded-full bg-primary-foreground"})}),o.jsxs("p",{className:"flex-1",children:[String.fromCharCode(65+G),". ",F]})]})})},G)})}),o.jsx(se,{className:"w-full",onClick:x,disabled:!T,children:L?" ":" "})]})})})]}):null}const Ql={stroke:"currentColor",fill:"none",display:"block",width:"20px",height:"20px"},SM={stroke:"#ffffff",fill:"none",display:"block",width:"24px",height:"24px"};function RM({onHomeClick:n,onRankingClick:e,onBookmarksClick:t,onMyPageClick:r,onWriteClick:s,activeTab:i="home"}){const a=y.useCallback((f,w)=>{const k=w.currentTarget;k.blur(),setTimeout(()=>{k.style.backgroundColor="transparent",k.classList.remove("focus:bg-accent","focus-visible:bg-accent")},0),f()},[]),c=y.useCallback(f=>{a(n,f)},[a,n]),l=y.useCallback(f=>{a(e,f)},[a,e]),d=y.useCallback(f=>{s&&a(s,f)},[a,s]),h=y.useCallback(f=>{a(t,f)},[a,t]),m=y.useCallback(f=>{a(r,f)},[a,r]);return o.jsxs("nav",{className:"bg-card/98 glass-effect border-t border-border flex-shrink-0 shadow-[0_-2px_8px_rgba(0,0,0,0.04)] dark:shadow-[0_-2px_8px_rgba(0,0,0,0.2)] safe-nav-bottom relative",children:[s&&o.jsxs(se,{className:"write-button absolute left-1/2 -translate-x-1/2 -top-5 rounded-full w-14 h-14 bg-primary hover:bg-primary/90 shadow-lg hover:shadow-xl overflow-hidden z-10",onClick:d,children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/80 to-primary rounded-full"}),o.jsx(r_,{size:24,strokeWidth:2.5,style:SM,className:"relative z-10"})]}),o.jsx("div",{className:"px-2 py-2",children:o.jsxs("div",{className:"flex items-center justify-between max-w-md mx-auto",children:[o.jsxs("div",{className:"flex items-center justify-around flex-1",children:[o.jsxs(se,{variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${i==="home"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:c,children:[o.jsx(lE,{size:20,strokeWidth:2,style:Ql,className:`transition-transform duration-200 ${i==="home"?"scale-110":""}`}),o.jsx("span",{className:"text-xs font-medium",children:""})]}),o.jsxs(se,{variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${i==="ranking"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:l,children:[o.jsx(yu,{size:20,strokeWidth:2,style:Ql,className:`transition-transform duration-200 ${i==="ranking"?"scale-110":""}`}),o.jsx("span",{className:"text-xs font-medium",children:""})]})]}),o.jsx("div",{className:"w-16"}),o.jsxs("div",{className:"flex items-center justify-around flex-1",children:[o.jsxs(se,{variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${i==="bookmarks"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:h,children:[o.jsx(ai,{size:20,strokeWidth:2,style:Ql,className:`transition-transform duration-200 ${i==="bookmarks"?"scale-110":""}`}),o.jsx("span",{className:"text-xs font-medium",children:""})]}),o.jsxs(se,{variant:"ghost",size:"sm",className:`nav-button nav-button-override flex flex-col items-center gap-1 touch-target px-3 py-2 rounded-xl ${i==="profile"?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"}`,onClick:m,children:[o.jsx(uE,{size:20,strokeWidth:2,style:Ql,className:`transition-transform duration-200 ${i==="profile"?"scale-110":""}`}),o.jsx("span",{className:"text-xs font-medium",children:" "})]})]})]})})]})}const hr=le.memo(RM),wl=(...n)=>n.filter(Boolean).join(" "),Dw=HT,jM=qT,IT=y.forwardRef(({className:n,...e},t)=>o.jsx(Hw,{ref:t,className:wl("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...e}));IT.displayName=Hw.displayName;const qf=y.forwardRef(({className:n,children:e,...t},r)=>o.jsxs(jM,{children:[o.jsx(IT,{}),o.jsx(Ww,{ref:r,className:wl("fixed left-1/2 top-1/2 z-50 -translate-x-1/2 -translate-y-1/2","w-[360px] max-w-[90vw]","rounded-lg border border-border bg-card p-6 shadow-lg outline-none","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-top-4 data-[state=open]:slide-in-from-top-4",n),...t,children:e})]}));qf.displayName=Ww.displayName;const Hf=({className:n,...e})=>o.jsx("div",{className:wl("flex flex-col space-y-1.5 text-center sm:text-left",n),...e});Hf.displayName="DialogHeader";const Wf=y.forwardRef(({className:n,...e},t)=>o.jsx(Gw,{ref:t,className:wl("text-lg font-semibold leading-none tracking-tight",n),...e}));Wf.displayName=Gw.displayName;const Gf=y.forwardRef(({className:n,...e},t)=>o.jsx(Kw,{ref:t,className:wl("text-sm text-muted-foreground",n),...e}));Gf.displayName=Kw.displayName;function TT({className:n,...e}){return o.jsx(YT,{"data-slot":"tabs",className:Je("flex flex-col gap-2",n),...e})}function ET({className:n,...e}){return o.jsx(XT,{"data-slot":"tabs-list",className:Je("bg-muted text-muted-foreground inline-flex h-11 w-fit items-center justify-center rounded-xl p-[3px] flex",n),...e})}function pc({className:n,...e}){return o.jsx(JT,{"data-slot":"tabs-trigger",className:Je("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-1 py-0.5 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",n),...e})}function gc({className:n,...e}){return o.jsx(ZT,{"data-slot":"tabs-content",className:Je("flex-1 outline-none",n),...e})}function Fr({className:n,...e}){return o.jsx(eE,{"data-slot":"switch",className:Je("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",n),...e,children:o.jsx(tE,{"data-slot":"switch-thumb",className:Je("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function PM({className:n,orientation:e="horizontal",decorative:t=!0,...r}){return o.jsx(nE,{"data-slot":"separator-root",decorative:t,orientation:e,className:Je("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",n),...r})}const Ow="userSettings",DM=jp(xi,"asia-northeast3"),OM=lo(DM,"deleteAccount");function LM({onBack:n,isDarkMode:e,onToggleDarkMode:t,onShowPrivacy:r,onShowTerms:s,onShowGuidelines:i,onLogout:a,onShowOpenSourceLicenses:c,onShowAttributions:l}){const[d,h]=y.useState(!0),[m,f]=y.useState(!0),[w,k]=y.useState(!0),[C,b]=y.useState(!0),[N,I]=y.useState(!0),[E,R]=y.useState(!1),[P,O]=y.useState(!1),[g,x]=y.useState(!1);y.useEffect(()=>{try{const H=localStorage.getItem(Ow);if(!H)return;const we=JSON.parse(H);typeof we.notificationsEnabled=="boolean"&&h(we.notificationsEnabled),typeof we.newPostNotifications=="boolean"&&f(we.newPostNotifications),typeof we.replyNotifications=="boolean"&&k(we.replyNotifications),typeof we.lanternNotifications=="boolean"&&b(we.lanternNotifications),typeof we.autoSave=="boolean"&&I(we.autoSave)}catch(H){console.error("Failed to load user settings",H)}},[]),y.useEffect(()=>{const H=_e.currentUser?.uid;if(!H)return;const we=Se(me,"users",H);x(!0),Qn(we).then(Ae=>{if(!Ae.exists())return;const qe=Ae.data()?.consents??{};typeof qe.aiAutoReply=="boolean"&&R(qe.aiAutoReply),typeof qe.personalizedDigest=="boolean"&&O(qe.personalizedDigest)}).catch(Ae=>{console.error("[settings]    ",Ae)}).finally(()=>x(!1))},[]);const v=y.useCallback(H=>{const we={notificationsEnabled:d,newPostNotifications:m,replyNotifications:w,lanternNotifications:C,autoSave:N,...H};try{localStorage.setItem(Ow,JSON.stringify(we))}catch(Ae){console.error("Failed to save user settings",Ae)}},[d,m,w,C,N]),A=y.useCallback(async H=>{const we=_e.currentUser?.uid;if(!we)return oe.error(" "),!1;const Ae={},ct={};H.aiAutoReply!==void 0&&(Ae.aiAutoReply=H.aiAutoReply,ct.aiAutoReply=Sn()),H.personalizedDigest!==void 0&&(Ae.personalizedDigest=H.personalizedDigest,ct.personalizedDigest=Sn());try{return await $n(Se(me,"users",we),{consents:Ae,consentUpdatedAt:ct},{merge:!0}),!0}catch(qe){return console.error("[settings]   ",qe),oe.error("  .    ."),!1}},[]),S=y.useCallback(H=>{h(H),v({notificationsEnabled:H})},[v]),D=y.useCallback(H=>{f(H),v({newPostNotifications:H})},[v]),T=y.useCallback(H=>{k(H),v({replyNotifications:H})},[v]),L=y.useCallback(H=>{b(H),v({lanternNotifications:H})},[v]),F=y.useCallback(H=>{I(H),v({autoSave:H})},[v]),G=y.useCallback(async H=>{R(H),await A({aiAutoReply:H})&&oe.success(H?"AI  ":"AI  ")},[A]),q=y.useCallback(async H=>{O(H),await A({personalizedDigest:H})&&oe.success(H?"   ":"   ")},[A]),U=y.useCallback(()=>{oe.success(" ")},[]),B=y.useCallback(async()=>{if(window.confirm("  ?     ."))try{if(await OM({}),_e.currentUser)try{await _e.currentUser.delete()}catch(we){console.warn("[settings] client auth delete failed",we)}oe.success("  .     ."),a()}catch(we){console.error("[settings] deleteAccount  ",we),oe.error("    .     .")}},[a]),[Y,ue]=y.useState(Of()),J=y.useCallback(H=>{ue(H),OO(H),oe.success(H?"  ":"  ")},[]);return o.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-y-auto scrollbar-hide",children:[o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(se,{variant:"ghost",size:"icon",onClick:n,className:"hover:bg-accent",children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsx("h1",{className:"font-medium",children:""})]})})}),o.jsxs("div",{className:"p-4 space-y-6",children:[o.jsxs(Z,{className:"bg-card border-border",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center space-x-2",children:[o.jsx(dE,{className:"w-5 h-5"}),o.jsx("span",{children:" "})]})}),o.jsx(ee,{className:"space-y-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[e?o.jsx(so,{className:"w-4 h-4"}):o.jsx(ro,{className:"w-4 h-4"}),o.jsx(Nn,{className:"text-foreground",children:" "})]}),o.jsx("div",{className:"-m-2 p-2 inline-flex items-center",children:o.jsx(Fr,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11\r
                  [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5\r
                  [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:e,onCheckedChange:t})})]})})]}),o.jsxs(Z,{className:"bg-card border-border",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center space-x-2",children:[o.jsx(i_,{className:"w-5 h-5"}),o.jsx("span",{children:" "})]})}),o.jsxs(ee,{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Nn,{className:"text-foreground",children:" "}),o.jsx(Fr,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11\r
                [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5\r
                [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:d,onCheckedChange:S})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(xg,{className:"w-4 h-4 text-gray-700"}),o.jsx(Nn,{className:"text-gray-900",children:"  "})]}),o.jsx("p",{className:"text-xs text-gray-600 mt-1",children:'" "    '})]}),o.jsx(Fr,{checked:Y,onCheckedChange:J})]}),d&&o.jsxs(o.Fragment,{children:[o.jsx(PM,{}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Nn,{className:"text-foreground",children:"  "}),o.jsx(Fr,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11\r
                    [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5\r
                    [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:m,onCheckedChange:D})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Nn,{className:"text-foreground",children:" "}),o.jsx(Fr,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11\r
                    [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5\r
                    [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:w,onCheckedChange:T})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Nn,{className:"text-foreground",children:" "}),o.jsx(Fr,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11\r
                    [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5\r
                    [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:C,onCheckedChange:L})]})]})]})]}),o.jsxs(Z,{className:"bg-card border-border",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center space-x-2",children:[o.jsx(xg,{className:"w-5 h-5"}),o.jsx("span",{children:"AI /  "})]})}),o.jsxs(ee,{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx(Nn,{className:"text-foreground",children:"AI  "}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"1    AI  ."})]}),o.jsx(Fr,{disabled:g,checked:E,onCheckedChange:G})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx(Nn,{className:"text-foreground",children:"   "}),o.jsx("p",{className:"text-xs text-muted-foreground",children:" 9     ."})]}),o.jsx(Fr,{disabled:g,checked:P,onCheckedChange:q})]})]})]}),o.jsxs(Z,{className:"bg-card border-border",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center space-x-2",children:[o.jsx(o_,{className:"w-5 h-5"}),o.jsx("span",{children:" "})]})}),o.jsx(ee,{className:"space-y-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx(Nn,{className:"text-foreground",children:" "}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"    "})]}),o.jsx(Fr,{className:`!min-w-0 !min-h-0 h-4 w-8 md:h-6 md:w-11\r
                [&>span]:h-3.5 [&>span]:w-3.5 md:[&>span]:h-5 md:[&>span]:w-5\r
                [&[data-state=checked]>span]:translate-x-3.5 md:[&[data-state=checked]>span]:translate-x-5`,checked:N,onCheckedChange:F})]})})]}),o.jsxs(Z,{className:"bg-card border-border",children:[o.jsx(ve,{children:o.jsxs(Te,{className:"flex items-center space-x-2 text-gray-900",children:[o.jsx(hE,{className:"w-5 h-5 text-gray-700"}),o.jsx("span",{children:" "})]})}),o.jsxs(ee,{className:"space-y-3",children:[o.jsxs(se,{variant:"outline",className:"w-full justify-start",onClick:U,children:[o.jsx(fE,{className:"w-4 h-4 mr-2"})," "]}),o.jsxs(se,{variant:"destructive",className:"w-full justify-start bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:B,children:[o.jsx(a_,{className:"w-4 h-4 mr-3"}),o.jsx("div",{className:"text-left",children:o.jsx("p",{className:"font-medium",children:" "})})]})]})]}),o.jsxs(Z,{className:"bg-card border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:" "})}),o.jsxs(ee,{className:"space-y-3",children:[s&&o.jsx(se,{variant:"outline",className:"w-full justify-start bg-white border-gray-300 text-gray-900 hover:bg-gray-50",onClick:s,children:""}),r&&o.jsx(se,{variant:"outline",className:"w-full justify-start bg-white border-gray-300 text-gray-900 hover:bg-gray-50",onClick:r,children:" "}),i&&o.jsx(se,{variant:"outline",className:"w-full justify-start bg-white border-gray-300 text-gray-900 hover:bg-gray-50",onClick:i,children:" "}),c&&o.jsx(se,{variant:"outline",className:"w-full justify-start bg-white border-gray-300 text-gray-900 hover:bg-gray-50",onClick:c,children:" "}),l&&o.jsx(se,{variant:"outline",className:"w-full justify-start bg-white border-gray-300 text-gray-900 hover:bg-gray-50",onClick:l,children:" "})]})]}),o.jsxs(Z,{className:"bg-card border-border",children:[o.jsx(ve,{children:o.jsx(Te,{className:"text-gray-900",children:" "})}),o.jsxs(ee,{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-muted-foreground",children:""}),o.jsx("span",{className:"",children:"1.0.0"})]}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-muted-foreground",children:""}),o.jsx("span",{className:"",children:"2025.01.01"})]}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-muted-foreground",children:""}),o.jsx("span",{className:"",children:" "})]})]})]})]})]})}function NT({title:n,icon:e,onBack:t,rightSlot:r}){return o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[t&&o.jsx(se,{variant:"ghost",size:"icon",onClick:t,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsxs("div",{className:"flex items-center space-x-2",children:[e,o.jsx("h1",{className:"font-medium",children:n})]})]}),r&&o.jsx("div",{className:"flex items-center space-x-1",children:r})]})})})}function VM(n){return n<=10?"text-red-400":n<=30?"text-orange-400":n<=70?"text-emerald-400":"text-blue-400"}function MM(n){return n<=10?"     .      .":n<=30?"  .    ,    .":n<=70?" .       .":"  .    ,     ."}function UM({userNickname:n,userProfileImage:e="",onProfileImageChange:t,onBack:r,onLogout:s,isDarkMode:i,onToggleDarkMode:a,onShowPrivacy:c,onShowTerms:l,onShowGuidelines:d,onShowOpenSourceLicenses:h,onShowAttributions:m,userPosts:f=[],userReplies:w=[],bookmarkedPosts:k=[],currentTitle:C="",userGuideCount:b=0,trustScore:N=30,profileDescription:I="",onProfileDescriptionChange:E,onAchievementsClick:R,onTitlesCollectionClick:P,followerCount:O=0,followingCount:g=0,onFollowerCardClick:x,onFollowingCardClick:v,onMyPostsCardClick:A,onMyRepliesCardClick:S,onPostClick:D,onReplyClick:T,autoOpenSettings:L,onAutoSettingsOpened:F}){const[G,q]=y.useState(I);y.useEffect(()=>{q(I)},[I]);const[U,B]=y.useState(!1),[Y,ue]=y.useState(""),J=80,[H,we]=y.useState(!1);y.useEffect(()=>{L&&(we(!0),F&&F())},[L,F]);const Ae=Ia({key:"mypage"}),[ct,qe]=y.useState(!1),[re,je]=y.useState(!1),[ze,it]=y.useState(!1),Rt=y.useCallback(()=>{it(!0)},[]),ot=y.useCallback(()=>{it(!1),s()},[s]),et=y.useCallback(()=>{it(!1)},[]),ft=y.useCallback(pe=>{const Ce=pe.target.files?.[0];if(Ce&&t){if(Ce.size>5*1024*1024){oe.error("  5MB  .");return}if(!Ce.type.startsWith("image/")){oe.error("   .");return}t(Ce),oe.success("  !")}},[t]),Ye=()=>OL.find(Ce=>Ce.id===C)?.name||"",Ve=f,Ue=w,mt=y.useMemo(()=>!Ve||Ve.length===0?null:Ve.reduce((pe,Ce)=>{const vn=typeof pe?.lanterns=="number"?pe.lanterns:0;return(typeof Ce?.lanterns=="number"?Ce.lanterns:0)>vn?Ce:pe},Ve[0]),[Ve]),Ge=y.useMemo(()=>!Ue||Ue.length===0?null:Ue.reduce((pe,Ce)=>{const vn=typeof pe?.lanterns=="number"?pe.lanterns:0;return(typeof Ce?.lanterns=="number"?Ce.lanterns:0)>vn?Ce:pe},Ue[0]),[Ue]),Dn=k,Lr=Math.max(0,Math.min(100,N)),Gt=VM(Lr),Kt=MM(Lr),jt={postsCount:Ve.length,guidesReceived:b,commentsCount:Ue.length,bookmarksCount:Dn.length},lt=f?[...f].sort((pe,Ce)=>(Ce.lanterns||0)-(pe.lanterns||0)).slice(0,1):[],pt=w?[...w].sort((pe,Ce)=>(Ce.lanterns||0)-(pe.lanterns||0)).slice(0,1):[],On=y.useCallback(async()=>{const pe=Y.trim();if(!pe){oe.error("  .");return}if(pe.length>J){oe.error(` ${J}   .`);return}try{const Ce=_e.currentUser;if(!Ce){oe.error("  .");return}const vn=Se(me,"users",Ce.uid);await _n(vn,{profileDescription:pe}),q(pe),E?.(pe),oe.success("  !"),B(!1),ue("")}catch(Ce){console.error("[MyPage]    ",Ce),oe.error("   .    .")}},[Y,E]),lr=y.useCallback(()=>{we(!1)},[]),vr=y.useCallback(pe=>{const Ce=pe.target.value,vn=pe.nativeEvent?.isComposing;ue(vn?Ce:Ce.slice(0,J))},[]),br=y.useCallback(()=>{B(!1)},[]),Yn=y.useCallback(pe=>{B(pe),pe&&ue(G)},[G]),Rs=y.useCallback(()=>{we(!0)},[]),Ir=y.useCallback(()=>{ue(pe=>pe.slice(0,J))},[]),es=y.useCallback(()=>{A?A():qe(!0)},[A]),ts=y.useCallback(()=>{S?S():je(!0)},[S]),bi=y.useCallback(()=>{qe(!1)},[]),Vr=y.useCallback(()=>{je(!1)},[]),ns=y.useCallback(pe=>{qe(!1),D?.(pe)},[D]),Qt=y.useCallback((pe,Ce)=>{je(!1),T?.(pe,Ce)},[T]),Mr=y.useCallback(pe=>{const Ce=pe.currentTarget.getAttribute("data-post-id");Ce&&ns(Ce)},[ns]),He=y.useCallback(pe=>{const Ce=pe.currentTarget.getAttribute("data-post-id"),vn=pe.currentTarget.getAttribute("data-reply-id");if(!Ce||!vn)return;const Tr=Number(vn);Number.isNaN(Tr)||Qt(Ce,Tr)},[Qt]);return H?o.jsx(LM,{onBack:lr,isDarkMode:i,onToggleDarkMode:a,onShowPrivacy:c,onShowTerms:l,onShowGuidelines:d,onShowOpenSourceLicenses:h,onShowAttributions:m,onLogout:s}):o.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col overflow-hidden",children:[o.jsx(NT,{title:"",onBack:r,rightSlot:o.jsx(se,{variant:"ghost",size:"icon",onClick:a,children:i?o.jsx(ro,{className:"w-4 h-4"}):o.jsx(so,{className:"w-4 h-4"})})}),o.jsxs("div",{ref:Ae,className:"flex-1 scroll-container scrollbar-hide p-4 pb-24 space-y-4",children:[o.jsx(Z,{children:o.jsx(ee,{className:"p-6",children:o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsxs("div",{className:"relative",children:[o.jsx(Es,{src:e,alt:n?`${n} `:" ",fallbackText:n?.charAt(0)?.toUpperCase()||"?",className:"w-20 h-20 rounded-full overflow-hidden"}),o.jsxs("div",{className:"absolute -bottom-1 -right-1",children:[o.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"profile-image-upload",onChange:ft}),o.jsx(se,{size:"icon",asChild:!0,className:"w-9 h-9 rounded-full cursor-pointer touch-target",children:o.jsx("label",{htmlFor:"profile-image-upload",children:o.jsx(mE,{className:"w-4 h-4"})})})]})]}),o.jsxs("div",{className:"flex-1 min-h-20 flex flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[o.jsx("h2",{className:"text-xl font-semibold truncate",children:n}),Ye()&&o.jsx(ht,{variant:"secondary",className:"text-xs shrink-0",children:Ye()})]}),o.jsx(se,{variant:"ghost",size:"icon",className:"touch-target",onClick:()=>Yn(!0),children:o.jsx(pE,{className:"w-4 h-4"})})]}),G&&o.jsx("p",{className:"mt-1 text-sm text-muted-foreground whitespace-pre-wrap break-words leading-snug line-clamp-2",children:G})]})]})})}),o.jsx(Z,{className:"border-border/70 shadow-sm rounded-xl mt-3",children:o.jsxs(ee,{className:"p-4 flex flex-col items-center text-center gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(gE,{className:"w-4 h-4 text-muted-foreground"}),o.jsxs("span",{className:"text-sm font-medium",children:[""," ",o.jsxs("span",{className:`font-semibold ${Gt}`,children:[Math.round(Lr),""]})]})]}),o.jsx("p",{className:"text-xs text-muted-foreground leading-snug",children:Kt})]})}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsx(Z,{className:"cursor-pointer",onClick:x,children:o.jsxs(ee,{className:"p-6 text-center",children:[o.jsx(gu,{className:"w-6 h-6 mx-auto mb-2 text-amber-500"}),o.jsx("div",{className:"text-lg font-medium",children:O}),o.jsx("div",{className:"text-xs text-muted-foreground leading-snug",children:""})]})}),o.jsx(Z,{className:"cursor-pointer",onClick:v,children:o.jsxs(ee,{className:"p-6 text-center",children:[o.jsx(yE,{className:"w-6 h-6 mx-auto mb-2 text-amber-500"}),o.jsx("div",{className:"text-lg font-medium",children:g}),o.jsx("div",{className:"text-xs text-muted-foreground leading-snug",children:" "})]})})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsx(Z,{className:"cursor-pointer hover:shadow-md transition-shadow active:scale-[0.98]",onClick:es,children:o.jsxs(ee,{className:"p-4 text-center",children:[o.jsx(Ks,{className:"w-6 h-6 mx-auto mb-2 text-blue-500"}),o.jsx("div",{className:"text-lg font-medium",children:jt.postsCount}),o.jsx("div",{className:"text-xs text-muted-foreground",children:" "})]})}),o.jsx(Z,{className:"cursor-pointer hover:shadow-md transition-shadow active:scale-[0.98]",onClick:ts,children:o.jsxs(ee,{className:"p-4 text-center",children:[o.jsx(Ln,{className:"w-6 h-6 mx-auto mb-2 text-green-500"}),o.jsx("div",{className:"text-lg font-medium",children:jt.commentsCount}),o.jsx("div",{className:"text-xs text-muted-foreground",children:""})]})}),o.jsx(Z,{children:o.jsxs(ee,{className:"p-4 text-center",children:[o.jsx(xE,{className:"w-6 h-6 mx-auto mb-2 text-primary"}),o.jsx("div",{className:"text-lg font-medium",children:jt.guidesReceived}),o.jsx("div",{className:"text-xs text-muted-foreground",children:""})]})}),o.jsx(Z,{children:o.jsxs(ee,{className:"p-4 text-center",children:[o.jsx(oi,{className:"w-6 h-6 mx-auto mb-2 text-yellow-500"}),o.jsx("div",{className:"text-lg font-medium",children:jt.bookmarksCount}),o.jsx("div",{className:"text-xs text-muted-foreground",children:""})]})})]}),o.jsxs(TT,{defaultValue:"posts",className:"w-full",children:[o.jsxs(ET,{className:"grid w-full grid-cols-2",children:[o.jsxs(pc,{value:"posts",className:"text-xs",children:[o.jsx(Ks,{className:"w-4 h-4 mr-1"})," "]}),o.jsxs(pc,{value:"replies",className:"text-xs",children:[o.jsx(Ln,{className:"w-4 h-4 mr-1"})," "]})]}),o.jsx(gc,{value:"posts",className:"space-y-3 mt-4",children:mt?o.jsx(Z,{className:"hover:shadow-md transition-shadow cursor-pointer list-optimized","data-post-id":mt.id,onClick:Mr,children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(ht,{variant:"outline",className:"text-xs",children:mt.subCategory}),o.jsx("span",{className:"text-xs text-muted-foreground",children:mt.timeAgo})]}),o.jsx("h3",{className:"font-medium text-sm",children:mt.title}),o.jsx("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(pr,{className:"w-3 h-3 text-amber-500"}),o.jsx("span",{className:"text-xs text-amber-600",children:mt.lanterns})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ln,{className:"w-3 h-3 text-muted-foreground"}),o.jsx("span",{className:"text-xs text-muted-foreground",children:mt.comments})]})]})})]})})},mt.id):o.jsx(Z,{children:o.jsxs(ee,{className:"p-8 text-center",children:[o.jsxs("div",{className:"relative mb-4",children:[o.jsx("div",{className:"absolute inset-0 bg-blue-500/30 dark:bg-blue-400/30 blur-2xl rounded-full"}),o.jsx("div",{className:"relative w-20 h-20 rounded-full bg-blue-100 dark:bg-blue-900/40 flex items-center justify-center border-4 border-blue-400 dark:border-blue-600 shadow-lg mx-auto",children:o.jsx(Ks,{className:"w-12 h-12 text-blue-900 dark:text-blue-200",strokeWidth:2.5})})]}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"   .     ."})]})})}),o.jsx(gc,{value:"replies",className:"space-y-3 mt-4",children:Ge?o.jsx(Z,{className:"hover:shadow-md transition-shadow cursor-pointer list-optimized","data-post-id":Ge.postId,"data-reply-id":Ge.id,onClick:He,children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("span",{className:"text-xs font-medium text-primary",children:[Ge.postAuthor,"  "]}),o.jsx("span",{className:"text-xs text-muted-foreground",children:Ge.timeAgo})]}),o.jsxs("h4",{className:"text-sm text-muted-foreground",children:['"',Ge.postTitle,'"']}),o.jsx("p",{className:"text-sm leading-relaxed",children:Ge.content}),o.jsxs("div",{className:"flex items-center space-x-1 pt-1",children:[o.jsx(pr,{className:"w-3 h-3 text-amber-500"}),o.jsx("span",{className:"text-xs text-amber-600",children:Ge.lanterns})]})]})})},Ge.id):o.jsx(Z,{children:o.jsxs(ee,{className:"p-8 text-center",children:[o.jsxs("div",{className:"relative mb-4",children:[o.jsx("div",{className:"absolute inset-0 bg-green-500/30 dark:bg-green-400/30 blur-2xl rounded-full"}),o.jsx("div",{className:"relative w-20 h-20 rounded-full bg-green-100 dark:bg-green-900/40 flex items-center justify-center border-4 border-green-400 dark:border-green-600 shadow-lg mx-auto",children:o.jsx(Ln,{className:"w-12 h-12 text-green-900 dark:text-green-200",strokeWidth:2.5})})]}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"   .       ."})]})})})]}),o.jsxs("div",{className:"space-y-2 mt-6",children:[P&&o.jsxs(se,{variant:"ghost",className:"w-full justify-start p-4 h-auto",onClick:P,children:[o.jsx(c_,{className:"w-5 h-5 mr-3 text-purple-500"}),o.jsxs("div",{className:"text-left",children:[o.jsx("p",{className:"font-medium",children:" "}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"      ."})]})]}),R&&o.jsxs(se,{variant:"ghost",className:"w-full justify-start p-4 h-auto",onClick:R,children:[o.jsx(yu,{className:"w-5 h-5 mr-3 text-amber-500"}),o.jsxs("div",{className:"text-left",children:[o.jsx("p",{className:"font-medium",children:""}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"      ."})]})]}),o.jsxs(se,{variant:"ghost",className:"w-full justify-start p-4 h-auto",onClick:Rs,children:[o.jsx(Jf,{className:"w-5 h-5 mr-3"}),o.jsx("div",{className:"text-left",children:o.jsx("p",{className:"font-medium",children:""})})]}),o.jsxs(se,{variant:"ghost",className:"w-full justify-start p-4 h-auto text-destructive hover:text-destructive",onClick:Rt,children:[o.jsx(Kh,{className:"w-5 h-5 mr-3"}),o.jsxs("div",{className:"text-left",children:[o.jsx("p",{className:"font-medium",children:""}),o.jsx("p",{className:"text-sm text-muted-foreground",children:" "})]})]})]})]}),o.jsx(Dw,{open:ct,onOpenChange:qe,children:o.jsxs(qf,{className:"w-[340px] max-w-[90vw] max-h-[70vh] overflow-hidden flex flex-col",children:[o.jsxs(Hf,{children:[o.jsx(Wf,{children:" 3  "}),o.jsx(Gf,{children:" 3    ."})]}),o.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 py-2",children:lt.length>0?lt.map(pe=>o.jsx(Z,{"data-post-id":pe.id,className:"cursor-pointer hover:shadow-md transition-shadow active:scale-[0.98]",onClick:Mr,children:o.jsxs(ee,{className:"p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx(ht,{variant:"outline",className:"text-xs",children:pe.subCategory||pe.category}),o.jsx("span",{className:"text-xs text-muted-foreground",children:pe.timeAgo})]}),o.jsx("h4",{className:"text-sm font-medium line-clamp-2",children:pe.title}),o.jsxs("div",{className:"flex items-center space-x-3 mt-2",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(pr,{className:"w-3 h-3 text-amber-500"}),o.jsx("span",{className:"text-xs text-amber-600",children:pe.lanterns})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ln,{className:"w-3 h-3 text-muted-foreground"}),o.jsx("span",{className:"text-xs text-muted-foreground",children:pe.comments})]})]})]})},pe.id)):o.jsxs("div",{className:"py-8 text-center",children:[o.jsx(Ks,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground/40"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:" 3   "})]})}),o.jsx(se,{variant:"outline",onClick:bi,className:"mt-2",children:""})]})}),o.jsx(Dw,{open:re,onOpenChange:je,children:o.jsxs(qf,{className:"w-[340px] max-w-[90vw] max-h-[70vh] overflow-hidden flex flex-col",children:[o.jsxs(Hf,{children:[o.jsx(Wf,{children:" 3  "}),o.jsx(Gf,{children:" 3    ."})]}),o.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 py-2",children:pt.length>0?pt.map(pe=>o.jsx(Z,{"data-post-id":pe.postId,"data-reply-id":pe.id,className:"cursor-pointer hover:shadow-md transition-shadow active:scale-[0.98]",onClick:He,children:o.jsxs(ee,{className:"p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsxs("span",{className:"text-xs font-medium text-primary truncate max-w-[60%]",children:[pe.postAuthor," "]}),o.jsx("span",{className:"text-xs text-muted-foreground",children:pe.timeAgo})]}),o.jsxs("p",{className:"text-xs text-muted-foreground mb-1 line-clamp-1",children:['"',pe.postTitle,'"']}),o.jsx("p",{className:"text-sm line-clamp-2",children:pe.content}),o.jsxs("div",{className:"flex items-center space-x-1 mt-2",children:[o.jsx(pr,{className:"w-3 h-3 text-amber-500"}),o.jsx("span",{className:"text-xs text-amber-600",children:pe.lanterns})]})]})},pe.id)):o.jsxs("div",{className:"py-8 text-center",children:[o.jsx(Ln,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground/40"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:" 3   "})]})}),o.jsx(se,{variant:"outline",onClick:Vr,className:"mt-2",children:""})]})}),ze&&o.jsx("div",{className:"fixed inset-0 z-[999] bg-black/60 backdrop-blur-sm flex items-center justify-center px-4",children:o.jsxs("div",{className:"w-[360px] max-w-full rounded-2xl border border-border/60 bg-card shadow-2xl shadow-black/20 p-6 space-y-5",children:[o.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full bg-accent/50 flex items-center justify-center shrink-0 mb-1",children:o.jsx(Kh,{className:"w-6 h-6 text-muted-foreground"})}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("p",{className:"text-lg font-semibold text-foreground",children:" ?"}),o.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"    ."})]})]}),o.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2",children:[o.jsx("button",{className:"flex-1 h-11 rounded-xl border border-input bg-background hover:bg-accent hover:text-accent-foreground text-foreground font-medium transition-colors text-sm",onClick:et,children:""}),o.jsx("button",{className:"flex-1 h-11 rounded-xl bg-primary text-primary-foreground hover:bg-primary/90 font-medium shadow-lg shadow-primary/20 transition-colors text-sm",onClick:ot,children:""})]})]})}),U&&o.jsx("div",{className:"fixed inset-0 z-[999] bg-black/50 backdrop-blur-sm flex items-center justify-center px-4",children:o.jsxs("div",{className:"w-[360px] max-w-full rounded-lg border border-border bg-card p-6 shadow-2xl",children:[o.jsxs("div",{className:"flex flex-col space-y-1.5 text-left",children:[o.jsx("h3",{className:"text-lg font-semibold leading-none tracking-tight",children:" "}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"  ,    ."})]}),o.jsx("div",{className:"space-y-4 py-4",children:o.jsxs("div",{className:"space-y-2",children:[o.jsx(Nn,{htmlFor:"description",children:""}),o.jsx(Op,{id:"description",placeholder:":        .",value:Y,onChange:vr,onCompositionEnd:Ir,maxLength:J,className:"min-h-[100px]",autoFocus:!0}),o.jsxs("div",{className:"text-right text-xs text-muted-foreground",children:[Y.length,"/",J]})]})}),o.jsxs("div",{className:"flex justify-end space-x-2",children:[o.jsx(se,{variant:"outline",onClick:br,children:""}),o.jsx(se,{onClick:On,children:""})]})]})})]})}function FM({onBack:n,categories:e,activeCategory:t,activeSubCategory:r,onCategorySelect:s,posts:i,onPostSelect:a}){const[c,l]=y.useState(""),[d,h]=y.useState("category"),m=Ia({key:`category-${d}`}),f=e.filter(g=>g.name.toLowerCase().includes(c.toLowerCase())||g.subCategories.some(x=>x.name.toLowerCase().includes(c.toLowerCase()))),w=i.filter(g=>g.title.toLowerCase().includes(c.toLowerCase())||g.content.toLowerCase().includes(c.toLowerCase())||g.author.toLowerCase().includes(c.toLowerCase())||g.tags&&g.tags.some(x=>x.toLowerCase().includes(c.toLowerCase()))),k=y.useCallback(g=>{s(g,""),n()},[s,n]),C=y.useCallback((g,x)=>{s(g,x),n()},[s,n]),b=y.useCallback(g=>{l(g.target.value)},[]),N=y.useCallback(()=>{h("category"),l("")},[]),I=y.useCallback(()=>{h("post"),l("")},[]),E=y.useCallback(g=>{a(g),n()},[a,n]),R=y.useCallback(g=>{const x=g.currentTarget.dataset.categoryId;x&&k(x)},[k]),P=y.useCallback(g=>{const x=g.currentTarget.dataset.categoryId,v=g.currentTarget.dataset.subCategoryId;x&&v&&C(x,v)},[C]),O=y.useCallback(g=>{const x=Number(g.currentTarget.dataset.postId),v=i.find(A=>A.id===x);v&&E(v)},[i,E]);return o.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsxs("div",{className:"px-4 py-3",children:[o.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[o.jsx(se,{variant:"ghost",size:"icon",onClick:n,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsx("h1",{className:"font-medium",children:" "})]}),o.jsxs("div",{className:"flex space-x-2 mb-3",children:[o.jsx(se,{variant:d==="category"?"default":"outline",size:"sm",onClick:N,className:"flex-1",children:" "}),o.jsx(se,{variant:d==="post"?"default":"outline",size:"sm",onClick:I,className:"flex-1",children:" "})]}),o.jsxs("div",{className:"relative",children:[o.jsx(xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),o.jsx(hl,{type:"text",placeholder:d==="category"?" ...":" , ,  ...",value:c,onChange:b,className:"pl-10 h-9"})]})]})}),o.jsx("div",{ref:m,className:"flex-1 scroll-container scrollbar-hide",children:o.jsx("div",{className:"p-4 space-y-4",children:d==="category"?o.jsxs(o.Fragment,{children:[f.map(g=>{const x=g.icon,v=t===g.id;return o.jsx(Z,{className:`transition-all list-optimized ${v?"ring-2 ring-primary":""}`,children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center justify-between cursor-pointer hover:bg-accent/50 p-3 rounded-md -m-2 touch-target","data-category-id":g.id,onClick:R,children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-primary/10 to-primary/20 flex items-center justify-center",children:o.jsx(x,{className:"w-5 h-5 text-primary"})}),o.jsx("div",{children:o.jsx("h3",{className:"font-medium",children:g.name})})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[v&&o.jsx(ht,{variant:"default",className:"text-xs",children:""}),o.jsx(ht,{variant:"secondary",className:"text-xs tabular-nums",children:g.count})]})]}),g.id!==""&&g.subCategories.length>1&&o.jsx("div",{className:"ml-4 space-y-2",children:o.jsx("div",{className:"border-l-2 border-border pl-4 space-y-2",children:g.subCategories.filter(A=>A.id!=="").filter(A=>c===""||A.name.toLowerCase().includes(c.toLowerCase())).map(A=>{const S=v&&r===A.id;return o.jsxs("div",{className:`flex items-center justify-between cursor-pointer hover:bg-accent/50 p-3 rounded-md transition-colors touch-target ${S?"bg-accent":""}`,"data-category-id":g.id,"data-sub-category-id":A.id,onClick:P,children:[o.jsx("div",{children:o.jsx("p",{className:"text-sm font-medium",children:A.name})}),o.jsx("div",{className:"flex items-center space-x-2",children:S&&o.jsx(ht,{variant:"default",className:"text-xs",children:""})})]},A.id)})})})]})})},g.id)}),f.length===0&&c&&o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-muted-foreground",children:"  ."})})]}):o.jsxs(o.Fragment,{children:[w.map(g=>o.jsx(Z,{className:"cursor-pointer hover:shadow-md transition-shadow list-optimized","data-post-id":g.id,onClick:O,children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsx("div",{className:"flex items-center justify-between",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(fl,{className:"w-8 h-8",children:o.jsx(ml,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white",children:g.author.charAt(0).toUpperCase()})}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-sm",children:g.author}),o.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[o.jsx("span",{children:g.timeAgo}),o.jsx("span",{children:""}),o.jsx(ht,{variant:"outline",className:"text-xs",children:g.subCategory})]})]})]})}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-medium mb-2",children:g.title}),o.jsx("p",{className:"text-muted-foreground text-sm line-clamp-3 leading-relaxed",children:g.content})]}),o.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(pr,{className:"w-4 h-4 text-amber-500"}),o.jsx("span",{className:"text-sm text-muted-foreground",children:g.lanterns})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ln,{className:"w-4 h-4 text-muted-foreground"}),o.jsx("span",{className:"text-sm text-muted-foreground",children:g.comments})]})]}),g.tags&&g.tags.length>0&&o.jsx("div",{className:"flex space-x-1",children:g.tags.slice(0,2).map(x=>o.jsxs(ht,{variant:"secondary",className:"text-xs",children:["#",x]},x))})]})]})})},g.id)),w.length===0&&c&&o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-muted-foreground",children:"  ."})}),c===""&&o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-muted-foreground",children:" ."})})]})})})]})}function kT(){const[n,e]=y.useState({isVisible:!1,height:0});return y.useEffect(()=>{if(typeof window>"u")return;let t=window.visualViewport?.height||window.innerHeight;const r=()=>{if(window.visualViewport){const a=window.visualViewport.height,l=window.innerHeight-a,d=l>150;e({isVisible:d,height:d?l:0})}else{const a=window.innerHeight,c=t-a,l=c>150;e({isVisible:l,height:l?c:0})}},s=()=>{setTimeout(r,300)},i=()=>{setTimeout(()=>{e({isVisible:!1,height:0})},100)};return window.visualViewport?window.visualViewport.addEventListener("resize",r):window.addEventListener("resize",r),window.addEventListener("focusin",s),window.addEventListener("focusout",i),()=>{window.visualViewport?window.visualViewport.removeEventListener("resize",r):window.removeEventListener("resize",r),window.removeEventListener("focusin",s),window.removeEventListener("focusout",i)}},[]),n}function BM(n={}){const{enabled:e=!0,delay:t=300,offset:r=20,behavior:s="smooth",block:i="center"}=n,a=y.useRef(null);return y.useEffect(()=>{if(!e)return;const c=a.current;if(!c)return;const l=()=>{setTimeout(()=>{if(!c)return;const d=c.getBoundingClientRect(),h=d.top+window.scrollY,m=d.height,f=window.visualViewport?.height||window.innerHeight;if(d.bottom>f-r){const C=h-f/2+m/2;window.scrollTo({top:Math.max(0,C),behavior:s})}else c.scrollIntoView({behavior:s,block:i,inline:"nearest"})},t)};return c.addEventListener("focus",l),()=>{c.removeEventListener("focus",l)}},[e,t,r,s,i]),a}function zM({className:n,variant:e="outline",size:t="sm",showIcon:r=!0,text:s=""}){const{isVisible:i}=kT(),a=()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()};return i?o.jsxs(se,{type:"button",variant:e,size:t,onClick:a,className:Je("fixed bottom-4 right-4 z-50 shadow-lg","safe-nav-bottom","transition-all duration-200","animate-in slide-in-from-bottom-2",n),children:[r&&o.jsx(n_,{className:"w-4 h-4"}),s&&o.jsx("span",{className:"ml-1",children:s})]}):null}const $M=Yf("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function Kf({className:n,variant:e,...t}){return o.jsx("div",{"data-slot":"alert",role:"alert",className:Je($M({variant:e}),n),...t})}function Ya({className:n,...e}){return o.jsx("div",{"data-slot":"alert-description",className:Je("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",n),...e})}function qM({position:n="top",variant:e="banner",showReconnectButton:t=!0,onReconnect:r}){const{isOnline:s,wasOffline:i}=pl(),[a,c]=y.useState(!s),[l,d]=y.useState(!1);y.useEffect(()=>{if(!s)c(!0),d(!1);else if(i){d(!0),c(!0);const m=setTimeout(()=>{c(!1),d(!1)},3e3);return()=>clearTimeout(m)}else c(!1),d(!1)},[s,i]);const h=()=>{r?r():window.location.reload()};return a?e==="badge"?o.jsx(ht,{variant:s?"default":"destructive",className:Je("fixed z-50 flex items-center gap-1.5 px-3 py-1.5",n==="top"?"top-4 right-4":"bottom-4 right-4","animate-in slide-in-from-top-2 fade-in","safe-top"),children:s?o.jsxs(o.Fragment,{children:[o.jsx(l_,{className:"w-3.5 h-3.5"}),o.jsx("span",{className:"text-xs",children:""})]}):o.jsxs(o.Fragment,{children:[o.jsx(Yl,{className:"w-3.5 h-3.5"}),o.jsx("span",{className:"text-xs",children:""})]})}):e==="toast"?o.jsx("div",{className:Je("fixed z-50 left-1/2 -translate-x-1/2",n==="top"?"top-4 safe-top":"bottom-4 safe-nav-bottom","animate-in slide-in-from-top-2 fade-in"),children:o.jsx(Kf,{className:Je("shadow-lg border-2",l?"bg-success/10 border-success text-success-foreground":"bg-destructive/10 border-destructive text-destructive-foreground"),children:o.jsx("div",{className:"flex items-center gap-3",children:l?o.jsxs(o.Fragment,{children:[o.jsx(xu,{className:"w-5 h-5"}),o.jsx(Ya,{className:"text-sm font-medium",children:"  "})]}):o.jsxs(o.Fragment,{children:[o.jsx(Yl,{className:"w-5 h-5"}),o.jsx(Ya,{className:"text-sm font-medium",children:"  "})]})})})}):o.jsx("div",{className:Je("fixed left-0 right-0 z-50",n==="top"?"top-0 safe-top":"bottom-0 safe-nav-bottom","animate-in slide-in-from-top-2 fade-in"),children:o.jsx(Kf,{className:Je("rounded-none border-x-0 border-t-0",l?"bg-success/10 border-success":"bg-destructive/10 border-destructive"),children:o.jsxs("div",{className:"flex items-center justify-between px-4",children:[o.jsx("div",{className:"flex items-center gap-3",children:l?o.jsxs(o.Fragment,{children:[o.jsx(xu,{className:"w-5 h-5 text-success"}),o.jsxs("div",{children:[o.jsx(Ya,{className:"font-medium text-success",children:"  "}),o.jsx("p",{className:"text-xs text-success/80 mt-0.5",children:"     "})]})]}):o.jsxs(o.Fragment,{children:[o.jsx(Yl,{className:"w-5 h-5 text-destructive"}),o.jsxs("div",{children:[o.jsx(Ya,{className:"font-medium text-destructive",children:"  "}),o.jsx("p",{className:"text-xs text-destructive/80 mt-0.5",children:"    "})]})]})}),!l&&t&&o.jsxs(se,{size:"sm",variant:"outline",onClick:h,className:"flex items-center gap-1.5",children:[o.jsx(wE,{className:"w-3.5 h-3.5"}),o.jsx("span",{children:""})]})]})})}):null}function oU(){const{isOnline:n,effectiveType:e}=pl();return o.jsx("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:n?o.jsxs(o.Fragment,{children:[o.jsx(l_,{className:"w-3.5 h-3.5 text-success"}),e&&o.jsx("span",{className:"hidden sm:inline",children:e==="4g"?"":e==="3g"?"":""})]}):o.jsxs(o.Fragment,{children:[o.jsx(Yl,{className:"w-3.5 h-3.5 text-destructive"}),o.jsx("span",{className:"hidden sm:inline",children:""})]})})}function HM(){const{isOnline:n,effectiveType:e,downlink:t}=pl(),[r,s]=y.useState(!1);return y.useEffect(()=>{if(!n){s(!1);return}const i=e==="slow-2g"||e==="2g"||t!==void 0&&t<.5;s(i)},[n,e,t]),r?o.jsxs(Kf,{variant:"default",className:"bg-warning/10 border-warning",children:[o.jsx(a_,{className:"w-4 h-4 text-warning"}),o.jsxs(Ya,{className:"text-sm",children:[o.jsx("span",{className:"font-medium text-warning",children:"  "}),o.jsx("p",{className:"text-xs text-warning/80 mt-1",children:"     "})]})]}):null}function WM({onBack:n,posts:e,onPostSelect:t}){const[r,s]=y.useState(""),[i,a]=y.useState([]),[c,l]=y.useState([]),[d,h]=y.useState(!0),[m,f]=y.useState(!1),[w,k]=y.useState([]),[C,b]=y.useState(!1),[N]=y.useState(["AI","","","","","","","","","","","","",""]),[I,E]=y.useState(!1),R=r.trim().length>0,P=kT(),O=BM({delay:350,offset:80});y.useEffect(()=>{if(typeof window>"u"){l([]),h(!0),E(!0);return}let U=[],B=!0;try{const H=localStorage.getItem("recentSearches");if(H){const we=JSON.parse(H);Array.isArray(we)&&(U=we.filter(Ae=>typeof Ae=="string"))}}catch(H){console.error("recentSearches  :",H)}try{const H=localStorage.getItem("searchAutoSave");H!==null&&(B=H!=="false")}catch(H){console.error("searchAutoSave  :",H)}const Y=_e.currentUser?.uid;if(!Y){l(U),h(B),E(!0);return}let ue=!1;const J=Se(me,"users",Y);return(async()=>{try{const H=await Qn(J);if(H.exists()){const Ae=H.data().searchSettings;if(Ae&&typeof Ae=="object"){const ct=typeof Ae.autoSave=="boolean"?Ae.autoSave:B,qe=Array.isArray(Ae.recentSearches)?Ae.recentSearches.filter(re=>typeof re=="string"):U;if(!ue){l(qe),h(ct);try{localStorage.setItem("recentSearches",JSON.stringify(qe)),localStorage.setItem("searchAutoSave",ct.toString())}catch{}}}else ue||(l(U),h(B)),await _n(J,{searchSettings:{autoSave:B,recentSearches:U}})}else ue||(l(U),h(B)),await $n(J,{searchSettings:{autoSave:B,recentSearches:U}},{merge:!0})}catch(H){console.error("  Firestore  :",H),ue||(l(U),h(B))}finally{ue||E(!0)}})(),()=>{ue=!0}},[]);const g=y.useCallback(async(U,B)=>{if(typeof window<"u")try{localStorage.setItem("recentSearches",JSON.stringify(U)),localStorage.setItem("searchAutoSave",B.toString())}catch(H){console.error("  localStorage  :",H)}const Y=_e.currentUser?.uid;if(!Y)return;const ue=Se(me,"users",Y),J={autoSave:B,recentSearches:U};try{await _n(ue,{searchSettings:J})}catch(H){console.error("  Firestore  :",H)}},[]),x=y.useCallback(()=>{f(U=>!U)},[]),v=y.useCallback(U=>{s(U.target.value)},[]),A=y.useCallback(U=>{U&&U.style.setProperty("--dynamic-padding-bottom",P.isVisible?`${P.height}px`:"0px")},[P.isVisible,P.height]),S=y.useCallback(U=>{if(!U.trim()){a([]);return}const B=U.toLowerCase().trim(),Y=e.filter(ue=>{const J=ue.title.toLowerCase(),H=ue.content.toLowerCase(),we=ue.author.toLowerCase(),Ae=ue.category.toLowerCase(),ct=ue.subCategory.toLowerCase(),qe=ue.tags.map(re=>re.toLowerCase());return J===B||we===B||Ae===B||ct===B||qe.some(re=>re===B)||J.startsWith(B)||we.startsWith(B)||Ae.startsWith(B)||ct.startsWith(B)||qe.some(re=>re.startsWith(B))?!0:J.includes(B)||H.includes(B)||we.includes(B)||Ae.includes(B)||ct.includes(B)||qe.some(re=>re.includes(B))}).sort((ue,J)=>{const H=ue.title.toLowerCase(),we=J.title.toLowerCase();return H.startsWith(B)&&!we.startsWith(B)?-1:!H.startsWith(B)&&we.startsWith(B)?1:J.lanterns!==ue.lanterns?J.lanterns-ue.lanterns:J.createdAt.getTime()-ue.createdAt.getTime()});a(Y),b(!1)},[e]),D=y.useCallback(U=>{if(U.preventDefault(),!r.trim())return;if(S(r),d){const Y=[r,...c.filter(ue=>ue!==r)].slice(0,10);l(Y),g(Y,d)}const B=_e.currentUser?.uid;if(B){const Y=St(me,"user_activity",B,"searchLogs");qu(Y,{keyword:r.trim(),createdAt:Sn()}).catch(ue=>{console.warn("[analytics]    ",ue)})}},[r,S,d,c,g]),T=y.useCallback(()=>{s(""),a([]),b(!1),n()},[n]),L=y.useCallback(U=>{s(U),S(U),b(!1)},[S]),F=y.useCallback(U=>{s(U),S(U),b(!1)},[S]),G=y.useCallback(()=>{l([]),g([],d)},[d,g]),q=y.useCallback(()=>{if(!d)h(!0),g(c,!0);else{let B=c;c.length>0&&confirm(`   ?
    .`)&&(B=[],l([])),h(!1),g(B,!1)}},[d,c,g]);return I?o.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsxs("div",{className:"px-4 py-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(se,{variant:"ghost",size:"icon",onClick:T,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsx("h1",{className:"font-medium",children:""})]}),o.jsx(se,{variant:"ghost",size:"icon",onClick:x,children:o.jsx(Jf,{className:"w-5 h-5"})})]}),o.jsxs("form",{onSubmit:D,className:"relative",children:[o.jsx(xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),o.jsx(hl,{ref:O,type:"text",placeholder:" , , ,  ...",value:r,onChange:v,className:"pl-10 h-10 input-keyboard-safe",autoFocus:!0})]}),m&&o.jsx("div",{className:"mt-3 p-3 bg-muted/30 rounded-lg border border-border",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium",children:"  "}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"   "})]}),o.jsx(Fr,{checked:d,onCheckedChange:q})]})})]})}),o.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide keyboard-aware-container dynamic-container",ref:A,children:o.jsxs("div",{className:"p-4 pb-24",children:[o.jsx("div",{className:"mb-4",children:o.jsx(HM,{})}),R&&i.length>0&&o.jsxs("div",{className:"space-y-3",children:[o.jsx("div",{className:"flex items-center justify-between mb-4",children:o.jsxs("p",{className:"text-sm text-muted-foreground",children:["'",r,"'  ",i.length,"  "]})}),i.map(U=>o.jsx(Z,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm hover:shadow-md transition-shadow cursor-pointer list-optimized",onClick:()=>t(U),children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(Es,{src:U.authorAvatar,alt:U.author,size:40,className:"ring-2 ring-border/20",fallbackText:U.author?.charAt(0)?.toUpperCase()||"?"}),o.jsxs("div",{children:[o.jsx("div",{className:"flex items-center space-x-2",children:o.jsx("p",{className:"font-medium text-sm",children:U.author})}),o.jsx("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground mt-1",children:(U.timeAgo||U.createdAtText)&&o.jsx("span",{title:U.createdAtText||void 0,children:U.timeAgo??U.createdAtText})}),(()=>{const B=[U.category&&U.category!==""?U.category:null,U.subCategory&&U.subCategory!==""?U.subCategory:null,U.type?U.type==="guide"?" ":"":null].filter(Boolean);return B.length?o.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:B.join("  ")}):null})()]})]}),o.jsx("div",{className:"flex items-center space-x-2",children:typeof U.isBookmarked<"u"&&o.jsx(ai,{className:`w-4 h-4 ${U.isBookmarked?"fill-amber-500 text-amber-500":"text-muted-foreground"}`})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{className:"font-medium text-base mb-1 line-clamp-1",children:U.title}),o.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed line-clamp-2",children:U.content})]}),o.jsx("div",{className:"flex items-center justify-between pt-1",children:o.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(pr,{className:"w-4 h-4 text-amber-500"}),o.jsx("span",{children:U.lanterns??0})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ln,{className:"w-4 h-4"}),o.jsx("span",{children:U.comments??0})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("span",{className:"w-1 h-1 rounded-full bg-muted-foreground/60 inline-block"}),o.jsxs("span",{children:[U.views??0," "]})]})]})})]})})},U.id))]}),R&&i.length===0&&o.jsxs("div",{className:"text-center py-16 px-4",children:[o.jsxs("div",{className:"relative mb-6",children:[o.jsx("div",{className:"absolute inset-0 bg-slate-500/30 dark:bg-slate-400/30 blur-2xl rounded-full"}),o.jsx("div",{className:"relative w-24 h-24 rounded-full bg-slate-100 dark:bg-slate-700/40 flex items-center justify-center border-4 border-slate-400 dark:border-slate-600 shadow-lg mx-auto",children:o.jsx(xc,{className:"w-14 h-14 text-slate-900 dark:text-slate-200",strokeWidth:2.5})})]}),o.jsxs("p",{className:"text-muted-foreground font-medium mb-1",children:["'",r,"'    ."]}),o.jsx("p",{className:"text-muted-foreground text-sm",children:"  ."})]}),!R&&o.jsxs("div",{className:"space-y-6",children:[c.length>0&&o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("h2",{className:"font-medium flex items-center space-x-2",children:[o.jsx(_E,{className:"w-4 h-4"}),o.jsx("span",{children:" "})]}),o.jsx(se,{variant:"ghost",size:"sm",onClick:G,className:"text-muted-foreground hover:text-foreground",children:" "})]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:c.map((U,B)=>o.jsx(se,{variant:"outline",size:"sm",onClick:()=>F(U),className:"text-xs h-8",children:U},B))})]}),o.jsxs("div",{children:[o.jsxs("h2",{className:"font-medium mb-3 flex items-center space-x-2",children:[o.jsx(u_,{className:"w-4 h-4"}),o.jsx("span",{children:" "})]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(U=>o.jsxs(se,{variant:"secondary",size:"sm",onClick:()=>L(U),className:"text-xs h-8",children:["#",U]},U))})]}),o.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[o.jsx("h3",{className:"font-medium mb-2 text-sm",children:" "}),o.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[o.jsx("li",{children:"   , ,    "}),o.jsx("li",{children:" #   "}),o.jsx("li",{children:"   "})]})]})]})]})}),o.jsx(zM,{})]}):o.jsx("div",{className:"w-full h-full flex items-center justify-center",children:o.jsx("span",{className:"text-sm text-muted-foreground",children:"   ..."})})}const GM=n=>{const e=n.periodEnd;if(e&&typeof e.toDate=="function"){const t=e.toDate(),r=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${r}-${s}-${i}`}return typeof n.weekEnding=="string"?n.weekEnding:""},Lw=(n,e)=>{const t=Array.isArray(n)?n:[],r=t.slice(0,5).map(i=>({author:String(i?.nickname??""),count:typeof i?.count=="number"?i.count:0,authorUid:typeof i?.uid=="string"?i.uid:null})),s=t.map((i,a)=>({rank:typeof i?.rank=="number"?i.rank:a+1,author:String(i?.nickname??""),lumens:typeof i?.rewardLumen=="number"?i.rewardLumen:0,weekEnding:e}));return{items:r,rewards:s}};function KM(n,e=[],t=[]){const[r,s]=y.useState(e),[i,a]=y.useState(t),[c,l]=y.useState([]),[d,h]=y.useState([]),[m,f]=y.useState(!0);y.useEffect(()=>{let C=!0,b=!0;return(async()=>{b&&(f(!0),b=!1);try{const I=St(n,"weekly_stats"),E=zn(I,fp("periodEnd","desc"),Md(1)),R=await jn(E);if(!C)return;if(R.empty){s(e),a(t),l([]),h([]);return}const O=R.docs[0].data(),g=GM(O),{items:x,rewards:v}=Lw(O.guideRanking,g),{items:A,rewards:S}=Lw(O.lanternRanking,g);s(x),a(A),l(v),h(S)}catch(I){if(!C)return;console.error("    :",I),s(e),a(t),l([]),h([])}finally{C&&f(!1)}})(),()=>{C=!1}},[n,e,t]);const{visible:w}=nd(r,m),{visible:k}=nd(i,m);return{weeklyGuideData:r,weeklyLanternData:i,lastWeekGuideRewards:c,lastWeekLanternRewards:d,visibleWeeklyGuide:w,visibleWeeklyLantern:k,isLoading:m}}const $h=(n,e=5)=>Object.values(n??{}).map(t=>({author:t.author,count:t.count,authorUid:t.authorUid})).sort((t,r)=>r.count-t.count).slice(0,e),QM=n=>{const e=new Date(n),t=(7-n.getDay()+1)%7||7;return e.setDate(n.getDate()+t),e.setHours(8,0,0,0),n.getDay()===1&&n.getHours()<8&&e.setDate(n.getDate()),e.getTime()};function YM(){const[n,e]=y.useState(()=>Date.now());return y.useEffect(()=>{const t=setInterval(()=>e(Date.now()),6e4);return()=>clearInterval(t)},[]),y.useMemo(()=>{const t=QM(new Date(n)),r=Math.max(0,t-n),s=Math.floor(r/(1e3*60*60*24)),i=Math.floor(r%(1e3*60*60*24)/(1e3*60*60));return{days:s,hours:i}},[n])}function XM({db:n,weeklyGuideRanking:e,totalGuideRanking:t,weeklyLanternRanking:r}){const s=y.useMemo(()=>$h(e),[e]),i=y.useMemo(()=>$h(r),[r]),a=y.useMemo(()=>$h(t),[t]),{weeklyGuideData:c,weeklyLanternData:l,visibleWeeklyGuide:d,visibleWeeklyLantern:h,lastWeekGuideRewards:m,lastWeekLanternRewards:f,isLoading:w}=KM(n,s,i),k=c.length>0?c:s,C=l.length>0?l:i,b=d.length>0?d:s,N=h.length>0?h:i,I=y.useMemo(()=>Array.from(new Set([...k,...a,...C].map(P=>P.authorUid).filter(P=>!!P))),[k,a,C]),E=ba(I),R=YM();return{fallbackWeeklyGuide:s,fallbackWeeklyLantern:i,weeklyGuideForView:b,weeklyLanternForView:N,totalGuideData:a,lastWeekGuideRewards:m,lastWeekLanternRewards:f,userProfiles:E,isLoading:w,resetCountdown:R}}const qh=({icon:n,title:e,subtitle:t,badgeLabel:r})=>o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[n,o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-muted-foreground",children:e}),t&&o.jsx("p",{className:"text-xs text-muted-foreground",children:t})]})]}),o.jsx(ht,{variant:"secondary",className:"text-xs",children:r})]}),Vw=()=>o.jsx(Z,{className:"bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/20",children:o.jsxs(ee,{className:"p-3",children:[o.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[o.jsx(h_,{className:"w-4 h-4 text-amber-500"}),o.jsx("p",{className:"text-sm font-medium",children:" "})]}),o.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[o.jsx("div",{children:" 1:  5"}),o.jsx("div",{children:" 2:  3"}),o.jsx("div",{children:" 3:  1"})]})]})}),Mw=le.memo(function({rewards:e}){if(e.length===0)return null;const t=e[0].weekEnding;return o.jsx(Z,{children:o.jsxs(ee,{className:"p-3",children:[o.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[o.jsx(d_,{className:"w-4 h-4 text-muted-foreground"}),o.jsxs("p",{className:"text-sm font-medium",children:["   (",t," )"]})]}),o.jsx("div",{className:"space-y-2",children:e.map(r=>o.jsxs("div",{className:"flex items-center justify-between text-xs",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsxs("span",{className:"font-medium",children:[r.rank,""]}),o.jsx("span",{children:r.author})]}),o.jsxs("span",{className:"text-amber-500",children:["+",r.lumens," "]})]},r.author))})]})})});function JM({onBack:n,weeklyGuideRanking:e,totalGuideRanking:t,weeklyLanternRanking:r}){const[s,i]=y.useState("weekly"),a=Ia({key:`ranking-${s}`}),[c,l]=y.useState(null),d=y.useCallback(I=>{a&&(a.current=I),l(I)},[a]),{weeklyGuideForView:h,weeklyLanternForView:m,totalGuideData:f,lastWeekGuideRewards:w,lastWeekLanternRewards:k,userProfiles:C,isLoading:b,resetCountdown:N}=XM({db:me,weeklyGuideRanking:e,totalGuideRanking:t,weeklyLanternRanking:r});return o.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(se,{variant:"ghost",size:"icon",onClick:n,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(u_,{className:"w-5 h-5 text-primary"}),o.jsx("h1",{className:"font-medium",children:""})]})]})})}),o.jsx("div",{ref:d,className:"flex-1 scroll-container",children:o.jsx("div",{className:"p-4 pb-24",children:o.jsxs(TT,{value:s,onValueChange:i,children:[o.jsxs(ET,{className:"grid w-full grid-cols-3 !h-8",children:[o.jsx(pc,{value:"weekly",className:"text-xs",children:" "}),o.jsx(pc,{value:"total",className:"text-xs",children:" "}),o.jsx(pc,{value:"lantern",className:"text-xs",children:" "})]}),s==="weekly"&&o.jsx(gc,{value:"weekly",className:"mt-4",children:o.jsxs("div",{className:"space-y-4",children:[o.jsx(qh,{icon:o.jsx(bE,{className:"w-4 h-4 text-muted-foreground"}),title:"    ",subtitle:`: ${N.days} ${N.hours} `,badgeLabel:"Weekly"}),o.jsx(Vw,{}),o.jsx(Mw,{rewards:w}),o.jsx(Hh,{data:h,type:"guide",loading:b,userProfiles:C,scrollContainer:c})]})}),s==="total"&&o.jsx(gc,{value:"total",className:"mt-4",children:o.jsxs("div",{className:"space-y-4",children:[o.jsx(qh,{icon:o.jsx(oi,{className:"w-4 h-4 text-muted-foreground"}),title:"    ()",badgeLabel:"Total"}),o.jsx(Hh,{data:f,type:"guide",loading:!1,userProfiles:C,scrollContainer:c})]})}),s==="lantern"&&o.jsx(gc,{value:"lantern",className:"mt-4",children:o.jsxs("div",{className:"space-y-4",children:[o.jsx(qh,{icon:o.jsx(Zf,{className:"w-4 h-4 text-muted-foreground"}),title:"    ",subtitle:`: ${N.days} ${N.hours} `,badgeLabel:"Weekly"}),o.jsx(Vw,{}),o.jsx(Mw,{rewards:k}),o.jsx(Hh,{data:m,type:"lantern",loading:b,userProfiles:C,scrollContainer:c})]})})]})})})]})}const ZM=n=>{switch(n){case 0:return o.jsx(h_,{className:"w-5 h-5 text-amber-500"});case 1:return o.jsx(d_,{className:"w-5 h-5 text-gray-400"});case 2:return o.jsx(vE,{className:"w-5 h-5 text-amber-700"});default:return o.jsx("div",{className:"w-5 h-5 flex items-center justify-center text-sm font-medium text-muted-foreground",children:n+1})}},e4=n=>{switch(n){case 0:return o.jsx(ht,{className:"bg-gradient-to-r from-amber-500 to-yellow-600 text-white text-xs",children:"1"});case 1:return o.jsx(ht,{className:"bg-gradient-to-r from-gray-400 to-gray-500 text-white text-xs",children:"2"});case 2:return o.jsx(ht,{className:"bg-gradient-to-r from-amber-700 to-amber-800 text-white text-xs",children:"3"});default:return o.jsxs(ht,{variant:"outline",className:"text-xs",children:[n+1,""]})}},Hh=le.memo(function({data:e,type:t,loading:r,userProfiles:s,scrollContainer:i}){const a=y.useMemo(()=>e,[e]);return r&&e.length===0?o.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((c,l)=>o.jsx(Z,{className:"border border-border/60 bg-card/60",children:o.jsx(ee,{className:"p-4 animate-pulse space-y-3",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-5 h-5 rounded-full bg-muted/60"}),o.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/50"}),o.jsxs("div",{className:"flex-1 space-y-2",children:[o.jsx("div",{className:"h-3 w-1/3 bg-muted/50 rounded"}),o.jsx("div",{className:"h-3 w-1/4 bg-muted/40 rounded"})]}),o.jsx("div",{className:"w-12 h-6 rounded bg-muted/40"})]})})},l))}):e.length===0?o.jsx(bT,{icon:t==="guide"?o.jsx(oi,{className:"w-14 h-14 text-amber-900 dark:text-amber-200",strokeWidth:2.5}):o.jsx(Zf,{className:"w-14 h-14 text-yellow-900 dark:text-yellow-200",strokeWidth:2.5}),title:"  ",description:t==="guide"?"    ":"   ",glowClassName:t==="guide"?"bg-amber-500/30 dark:bg-amber-400/30":"bg-yellow-500/30 dark:bg-yellow-400/30",circleClassName:t==="guide"?"bg-amber-100 dark:bg-amber-900/40 border-4 border-amber-400 dark:border-amber-600":"bg-yellow-100 dark:bg-yellow-900/40 border-4 border-yellow-400 dark:border-yellow-600"}):o.jsx(wT,{customScrollParent:i||void 0,data:a,itemContent:(c,l)=>{const d=l.authorUid&&s[l.authorUid]?s[l.authorUid]:void 0;return o.jsx("div",{className:"pb-3 last:pb-0",children:o.jsx(t4,{item:l,index:c,type:t,profile:d},l.author)})}})}),t4=le.memo(function({item:e,index:t,type:r,profile:s}){const i=s?.currentTitleId??null,a=da(i),c=s?.profileImage;return o.jsx(Z,{className:`list-optimized ${t<3?"bg-gradient-to-r from-muted/50 to-muted/30":""}`,children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"flex-shrink-0",children:ZM(t)}),o.jsx(Es,{src:c||void 0,alt:e.author?`${e.author} `:" ",fallbackText:e.author?.charAt(0)?.toUpperCase()||"?",className:"w-10 h-10",size:40,loading:"lazy",decoding:"async"}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("p",{className:"font-medium text-sm truncate",children:e.author}),e4(t)]}),a&&o.jsx(ht,{variant:"secondary",className:"text-xs px-1.5 py-0.5 mt-1 w-fit",children:a}),o.jsx("div",{className:"flex items-center space-x-1 mt-1",children:r==="guide"?o.jsxs(o.Fragment,{children:[o.jsx(oi,{className:"w-3 h-3 text-amber-500"}),o.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",e.count,""]})]}):o.jsxs(o.Fragment,{children:[o.jsx(Zf,{className:"w-3 h-3 text-amber-500"}),o.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",e.count,""]})]})})]})]})})})},(n,e)=>!(n.index!==e.index||n.type!==e.type||n.item.author!==e.item.author||n.item.count!==e.item.count||n.item.authorUid!==e.item.authorUid||n.profile?.currentTitleId!==e.profile?.currentTitleId||n.profile?.profileImage!==e.profile?.profileImage));function n4({onBack:n,bookmarkedPosts:e,posts:t,onPostSelect:r,userNickname:s,currentTitle:i}){const[a,c]=y.useState(""),l=y.useDeferredValue(a),[d,h]=y.useState(!1),m=Ia({key:"bookmarks"}),f=y.useMemo(()=>t.filter(P=>P.hidden!==!0),[t]),w=y.useMemo(()=>f.filter(P=>e.has(String(P.id))),[f,e]),k=y.useMemo(()=>l.trim().toLowerCase(),[l]),C=y.useMemo(()=>w.filter(P=>{if(!k)return!0;const O=P.title?.toLowerCase()??"",g=P.content?.toLowerCase()??"",x=P.author?.toLowerCase()??"";return O.includes(k)||g.includes(k)||x.includes(k)}),[w,k]);y.useEffect(()=>{(w.length>0||f.length>0)&&h(!0)},[w.length,f.length]);const{visible:b}=nd(C,!d&&e.size>0&&f.length===0),N=y.useCallback(P=>{c(P.target.value)},[]),I=y.useMemo(()=>new Map(f.map(P=>[P.id,P])),[f]),E=y.useCallback(P=>{const O=I.get(P);O&&r(O)},[I,r]),R=y.useCallback(P=>Kd(P,s,i),[s,i]);return o.jsxs("div",{className:"w-full h-full bg-background text-foreground flex flex-col",children:[o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(se,{variant:"ghost",size:"icon",onClick:n,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(ai,{className:"w-5 h-5 text-primary"}),o.jsx("h1",{className:"font-medium",children:""})]}),o.jsxs(ht,{variant:"secondary",className:"ml-auto",children:[w.length,""]})]})})}),o.jsx("div",{className:"border-b border-border p-4 flex-shrink-0",children:o.jsxs("div",{className:"relative",children:[o.jsx(xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),o.jsx(hl,{placeholder:"  ...",value:a,onChange:N,className:"pl-10"})]})}),o.jsx("div",{ref:m,className:"flex-1 scroll-container",children:!d&&e.size>0&&t.length===0?o.jsx("div",{className:"p-4 pb-24 space-y-3",children:Array.from({length:4}).map((P,O)=>o.jsx(Z,{className:"border border-border/60 bg-card/60",children:o.jsxs(ee,{className:"p-4 space-y-3 animate-pulse",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-muted/50"}),o.jsxs("div",{className:"flex-1 space-y-2",children:[o.jsx("div",{className:"h-3 w-1/3 bg-muted/50 rounded"}),o.jsx("div",{className:"h-3 w-1/4 bg-muted/40 rounded"})]})]}),o.jsx("div",{className:"h-4 w-3/4 bg-muted/40 rounded"}),o.jsx("div",{className:"h-3 w-full bg-muted/30 rounded"})]})},O))}):b.length===0?o.jsx("div",{className:"flex flex-col items-center justify-center h-full p-8",children:o.jsx("div",{className:"text-center space-y-4",children:w.length===0?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"relative mb-4",children:[o.jsx("div",{className:"absolute inset-0 bg-blue-500/30 dark:bg-blue-400/30 blur-2xl rounded-full"}),o.jsx("div",{className:"relative w-24 h-24 rounded-full bg-blue-100 dark:bg-blue-900/40 flex items-center justify-center border-4 border-blue-400 dark:border-blue-600 shadow-lg mx-auto",children:o.jsx(ai,{className:"w-14 h-14 text-blue-900 dark:text-blue-200",strokeWidth:2.5})})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-medium mb-2",children:"  "}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"      "})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"relative mb-4",children:[o.jsx("div",{className:"absolute inset-0 bg-slate-500/30 dark:bg-slate-400/30 blur-2xl rounded-full"}),o.jsx("div",{className:"relative w-24 h-24 rounded-full bg-slate-100 dark:bg-slate-700/40 flex items-center justify-center border-4 border-slate-400 dark:border-slate-600 shadow-lg mx-auto",children:o.jsx(xc,{className:"w-14 h-14 text-slate-900 dark:text-slate-200",strokeWidth:2.5})})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-medium mb-2",children:"  "}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"  "})]})]})})}):o.jsx("div",{className:"p-4 pb-24 space-y-3",children:b.map(P=>o.jsx(r4,{post:P,onSelect:E,getAuthorTitle:R},P.id))})})]})}const r4=le.memo(({post:n,onSelect:e,getAuthorTitle:t})=>{const r=y.useCallback(()=>{e(n.id)},[e,n.id]),s=t(n.author);return o.jsx(Z,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm hover:shadow-md transition-shadow cursor-pointer list-optimized",onClick:r,children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[o.jsx(Es,{src:n.authorAvatar||void 0,alt:n.author?`${n.author} `:" ",fallbackText:n.author?.charAt(0)?.toUpperCase()||"?",className:"ring-2 ring-border/20",size:40,loading:"lazy",decoding:"async"}),o.jsxs("div",{className:"min-w-0 flex-1",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("p",{className:"font-medium text-sm truncate",children:n.author}),s&&o.jsx(ht,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:s})]}),o.jsx("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground mt-1",children:(n.timeAgo||n.createdAtText)&&o.jsx("span",{title:n.createdAtText||n.category,children:n.timeAgo??n.createdAtText})}),(()=>{const i=[n.category&&n.category!==""?n.category:null,n.subCategory&&n.subCategory!==""?n.subCategory:null,n.type?n.type==="guide"?" ":"":null].filter(Boolean);return i.length?o.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:i.join("  ")}):null})()]})]}),o.jsx(ai,{className:"w-4 h-4 fill-amber-500 text-amber-500"})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-medium text-base mb-1 line-clamp-1",children:n.title}),n.content&&o.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:n.content})]}),o.jsx("div",{className:"flex items-center justify-between pt-1",children:o.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ts,{className:"w-4 h-4 text-amber-500"}),o.jsx("span",{children:n.lanterns??0})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ln,{className:"w-4 h-4"}),o.jsx("span",{children:n.comments??0})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("span",{className:"w-1 h-1 rounded-full bg-muted-foreground/60 inline-block"}),o.jsxs("span",{children:[n.views??0," "]})]})]})})]})})})},(n,e)=>{if(n.post.id!==e.post.id||n.post.title!==e.post.title||n.post.content!==e.post.content||n.post.author!==e.post.author||n.post.authorAvatar!==e.post.authorAvatar||n.post.timeAgo!==e.post.timeAgo||n.post.category!==e.post.category||n.post.type!==e.post.type||n.post.lanterns!==e.post.lanterns||n.post.comments!==e.post.comments)return!1;const t=n.post.tags?.join(",")??"",r=e.post.tags?.join(",")??"";return t===r});function s4({mode:n,posts:e=[],replies:t=[],onBack:r,onPostClick:s,onReplyClick:i}){const a=n==="posts",c=[...new Set([...e.map(f=>f.authorUid).filter(f=>typeof f=="string"&&f.length>0),...t.map(f=>f.authorUid).filter(f=>typeof f=="string"&&f.length>0)])],l=ba(c),d=a?"  ":"  ",h=y.useCallback(f=>()=>{s?.(f)},[s]),m=y.useCallback((f,w)=>()=>{const k=typeof w=="number"?w:Number(w);Number.isNaN(k)||i?.(f,k)},[i]);return o.jsxs("div",{className:"flex-1 flex flex-col scrollbar-hide",children:[o.jsx(NT,{title:d,onBack:r,icon:o.jsx(Ks,{className:"w-4 h-4"})}),o.jsx("main",{className:"flex-1 scroll-container px-4 py-3 pb-24",children:a?e.length===0?o.jsx("div",{className:"h-full flex items-center justify-center",children:o.jsxs("div",{className:"flex flex-col items-center text-center",children:[o.jsx(Ks,{className:"w-10 h-10 mb-3 text-muted-foreground/60"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"   ."})]})}):o.jsx("div",{className:"space-y-3",children:e.map(f=>{const w=f.authorUid?l[f.authorUid]:void 0,k=w?.profileImage??f.authorAvatar??"",C=w?.currentTitleId?da(w.currentTitleId):null;return o.jsx(Z,{className:"border-border/60 shadow-sm bg-card/80 backdrop-blur-sm hover:shadow-md transition-shadow cursor-pointer list-optimized",onClick:h(f.id),children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(Es,{src:k,alt:f.author,size:40,className:"ring-2 ring-border/20",fallbackText:f.author?.charAt(0)?.toUpperCase()||"?"}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("p",{className:"font-medium text-sm",children:f.author}),C&&o.jsx(ht,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:C})]}),o.jsx("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground mt-1",children:(f.timeAgo||f.createdAtText)&&o.jsx("span",{title:f.createdAtText||void 0,children:f.timeAgo??f.createdAtText})}),(()=>{const b=[f.category&&f.category!==""?f.category:null,f.subCategory&&f.subCategory!==""?f.subCategory:null,f.type?f.type==="guide"?" ":"":null].filter(Boolean);return b.length?o.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:b.join("  ")}):null})()]})]}),o.jsx(ai,{className:`w-4 h-4 ${f.isBookmarked?"fill-amber-500 text-amber-500":"text-muted-foreground"}`})]}),f.title&&o.jsx("h2",{className:"text-sm font-medium line-clamp-1",children:f.title}),f.content&&o.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:f.content}),o.jsx("div",{className:"flex items-center justify-between pt-1",children:o.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(pr,{className:"w-4 h-4 text-amber-500"}),o.jsx("span",{children:f.lanterns??0})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ln,{className:"w-4 h-4"}),o.jsx("span",{children:f.comments??0})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("span",{className:"w-1 h-1 rounded-full bg-muted-foreground/60 inline-block"}),o.jsxs("span",{children:[f.views??0," "]})]})]})})]})})},f.id)})}):t.length===0?o.jsx("div",{className:"h-full flex items-center justify-center",children:o.jsxs("div",{className:"flex flex-col items-center text-center",children:[o.jsx(Ln,{className:"w-10 h-10 mb-3 text-muted-foreground/60"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"   ."})]})}):o.jsx("div",{className:"space-y-3",children:t.map(f=>{const w=f.authorUid?l[f.authorUid]:void 0,k=w?.profileImage??f.authorAvatar??"",C=w?.currentTitleId?da(w.currentTitleId):null;return o.jsx(Z,{className:"hover:shadow-md transition-shadow cursor-pointer list-optimized",onClick:m(f.postId,f.id),children:o.jsx(ee,{className:"p-4",children:o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Es,{src:k,alt:f.author,size:32,fallbackText:f.author?.charAt(0)?.toUpperCase()||"?"}),o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("span",{className:"text-xs font-medium",children:f.author}),C&&o.jsx(ht,{variant:"secondary",className:"text-[10px] px-2 py-0.5 h-auto bg-primary/10 text-primary border-primary/20",children:C})]}),o.jsxs("span",{className:"text-[11px] text-muted-foreground",children:[f.postAuthor," "]})]})]}),f.timeAgo&&o.jsx("span",{className:"text-xs text-muted-foreground",children:f.timeAgo})]}),o.jsx("p",{className:"text-sm line-clamp-2",children:f.content}),o.jsxs("div",{className:"flex items-center space-x-1 mt-2",children:[o.jsx(pr,{className:"w-3 h-3 text-amber-500"}),o.jsx("span",{className:"text-xs text-amber-600",children:f.lanterns})]})]})})},f.id)})})})]})}function AT({open:n,onOpenChange:e,title:t,description:r,confirmText:s="",onConfirm:i,checkbox:a}){if(!n)return null;const c=()=>{i?.(),e(!1)},l=()=>{a&&a.onCheckedChange(!1),e(!1)};return o.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:o.jsxs(Z,{className:"w-full max-w-md",children:[o.jsxs(ve,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Te,{className:"text-lg",children:t}),o.jsx(se,{variant:"ghost",size:"icon",onClick:l,children:o.jsx(t_,{className:"w-4 h-4"})})]}),o.jsxs(ee,{className:"space-y-4",children:[o.jsx("p",{className:"text-muted-foreground",children:r}),a&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(hc,{id:"dont-show-again",checked:a.checked,onCheckedChange:a.onCheckedChange}),o.jsx("label",{htmlFor:"dont-show-again",className:"text-sm cursor-pointer",children:a.label})]}),o.jsxs("div",{className:"flex justify-end space-x-2",children:[o.jsx(se,{variant:"outline",onClick:l,children:""}),o.jsx(se,{onClick:c,children:s})]})]})]})})}const CT=y.createContext(null);function i4({children:n}){const[e,t]=y.useState({name:"home"}),[r,s]=y.useState("home"),i=y.useRef([]),a=y.useCallback(T=>{const L=i.current.filter(F=>F!==T);L.push(T),i.current=L},[]),c=y.useCallback(T=>{i.current=i.current.filter(L=>L!==T)},[]),l=y.useCallback(()=>{i.current=[]},[]),d=y.useCallback(T=>{switch(T.name){case"home":return"home";case"ranking":return"ranking";case"bookmarks":return"bookmarks";case"myPage":return"profile";case"titlesCollection":return"titlesCollection";case"achievements":return"achievements";case"quiz":return"home";case"postDetail":return"home";case"userProfile":return"home";case"category":case"search":case"titleShop":return"home";case"followList":case"myContentList":return"profile";case"adminReports":return"home";case"notificationSettings":return"profile";default:return"home"}},[]),h=y.useCallback(T=>{const L={showMyPage:!1,showCategoryScreen:!1,showSearchScreen:!1,showNotificationSettings:!1,showBookmarks:!1,showWriteScreen:!1,showPostWarning:!1,showTitleShop:!1,showTitlesCollection:!1,showRanking:!1,showAchievements:!1,showGuidelines:!1,showNotifications:!1,showFollowList:null,showMyContentList:null,showUserProfile:null};switch(T.name){case"home":return L;case"ranking":return{...L,showRanking:!0};case"bookmarks":return{...L,showBookmarks:!0};case"myPage":return{...L,showMyPage:!0};case"category":return{...L,showCategoryScreen:!0};case"search":return{...L,showSearchScreen:!0};case"titleShop":return{...L,showTitleShop:!0};case"titlesCollection":return{...L,showTitlesCollection:!0};case"achievements":return{...L,showAchievements:!0};case"quiz":return L;case"followList":return{...L,showFollowList:T.mode};case"myContentList":return{...L,showMyContentList:T.mode};case"userProfile":return{...L,showUserProfile:T.nickname};case"postDetail":return L;case"adminReports":return L;case"notificationSettings":return{...L,showMyPage:!0,showNotificationSettings:!0};default:return L}},[]),m=y.useCallback(T=>{t(T),s(d(T))},[d]),f=y.useCallback(()=>m({name:"home"}),[m]),w=y.useCallback(()=>m({name:"ranking"}),[m]),k=y.useCallback(()=>m({name:"bookmarks"}),[m]),C=y.useCallback(()=>m({name:"myPage"}),[m]),b=y.useCallback(()=>m({name:"category"}),[m]),N=y.useCallback(()=>m({name:"search"}),[m]),I=y.useCallback(()=>m({name:"titleShop"}),[m]),E=y.useCallback(()=>m({name:"titlesCollection"}),[m]),R=y.useCallback(()=>m({name:"achievements"}),[m]),P=y.useCallback(()=>m({name:"quiz"}),[m]),O=y.useCallback(T=>m({name:"followList",mode:T}),[m]),g=y.useCallback(T=>m({name:"myContentList",mode:T}),[m]),x=y.useCallback(T=>m({name:"userProfile",nickname:T}),[m]),v=y.useCallback((T,L)=>m({name:"postDetail",postId:T,source:L}),[m]),A=y.useCallback(()=>m({name:"adminReports"}),[m]),S=y.useCallback(()=>m({name:"notificationSettings"}),[m]),D=y.useMemo(()=>({route:e,setRoute:t,currentScreen:r,setCurrentScreen:s,visibility:h(e),goHome:f,goRanking:w,goBookmarks:k,goMyPage:C,goCategory:b,goSearch:N,goTitleShop:I,goTitlesCollection:E,goAchievements:R,goQuiz:P,goFollowList:O,goMyContentList:g,goUserProfile:x,goPostDetail:v,goAdminReports:A,goNotificationSettings:S,layerStackRef:i,pushLayer:a,removeLayer:c,clearLayers:l}),[e,r,h,f,w,k,C,b,N,I,E,R,P,O,g,x,v,A,S,a,c,l]);return o.jsx(CT.Provider,{value:D,children:n})}function o4(){const n=y.useContext(CT);if(!n)throw new Error("useNavigationStore must be used within NavigationStoreProvider");return n}const a4=[{id:"",name:"",icon:IE,count:0,subCategories:[{id:"",name:"",count:0}]},{id:"",name:"",icon:TE,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:wg,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:EE,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:c_,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:gu,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:NE,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0},{id:"",name:"",count:0}]},{id:"",name:"",icon:wg,count:0,subCategories:[{id:"",name:"",count:0},{id:"",name:"",count:0}]}],c4=y.lazy(()=>_r(()=>import("./AdminReportScreen-RmHHYNmq.js"),__vite__mapDeps([7,1,2,3,4,5])).then(n=>({default:n.AdminReportScreen}))),l4=y.lazy(()=>_r(()=>import("./WriteScreen-DRc0QXB6.js"),__vite__mapDeps([8,1,2,5,3,4])).then(n=>({default:n.WriteScreen}))),u4=y.lazy(()=>_r(()=>import("./TitleShop-ZBx0B6zr.js"),__vite__mapDeps([9,1,2,10,5,3,4])).then(n=>({default:n.TitleShop}))),d4=y.lazy(()=>_r(()=>import("./TitlesCollection-Dx1l-vnF.js"),__vite__mapDeps([11,1,2,10,5,3,4])).then(n=>({default:n.TitlesCollection}))),h4=y.lazy(()=>_r(()=>import("./AchievementsScreen-D1hjBdih.js"),__vite__mapDeps([12,1,2,4,5,3])).then(n=>({default:n.AchievementsScreen}))),f4=y.lazy(()=>_r(()=>import("./FollowListScreen-D3oJ7Oax.js"),__vite__mapDeps([13,1,2,5,3,4])).then(n=>({default:n.FollowListScreen}))),m4=y.lazy(()=>_r(()=>import("./UserProfileDialog-1UJeoVL_.js"),__vite__mapDeps([14,1,2,13,5,3,4])).then(n=>({default:n.UserProfileDialog}))),p4=y.lazy(()=>_r(()=>import("./NotificationSettingsDialog-l0eT2zm0.js"),__vite__mapDeps([15,1,2,5,3,4])).then(n=>({default:n.NotificationSettingsDialog}))),Uw=y.lazy(()=>_r(()=>import("./ReportDialog-C9-VDcfY.js"),__vite__mapDeps([16,1,2,5,3,4])).then(n=>({default:n.ReportDialog})));y.lazy(()=>_r(()=>Promise.resolve().then(()=>$O),void 0).then(n=>({default:n.CommunityGuidelinesScreen})));const Fw=Object.freeze([]),fr=()=>o.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm text-muted-foreground",children:" ..."}),Wh=3600*1e3;function Bw(n){if(!n)return null;if(n instanceof Date)return n;if(n&&typeof n.toDate=="function")try{return n.toDate()}catch{return null}if(typeof n=="string"||typeof n=="number"){const e=new Date(n);if(!Number.isNaN(e.getTime()))return e}return null}function g4(n){return o.jsx(i4,{children:o.jsx(y4,{...n})})}function y4({userNickname:n,userProfileImage:e,onProfileImageChange:t,onLogout:r,isDarkMode:s,onToggleDarkMode:i,onRequestExit:a,onShowTerms:c,onShowPrivacy:l,onShowOpenSourceLicenses:d,onShowAttributions:h,shouldOpenMyPageOnMain:m,shouldOpenSettingsOnMyPage:f,onMainScreenReady:w,onSettingsOpenedFromMain:k}){const{route:C,setRoute:b,currentScreen:N,setCurrentScreen:I,visibility:E,layerStackRef:R,pushLayer:P,removeLayer:O,goHome:g,goRanking:x,goBookmarks:v,goMyPage:A,goPostDetail:S,goAchievements:D}=o4(),[T,L]=y.useState(!1),[F,G]=y.useState(!1),[q,U]=y.useState(null),[B,Y]=y.useState(null),[ue,J]=y.useState("home"),[H,we]=y.useState(""),[Ae,ct]=y.useState(""),[qe,re]=y.useState("latest"),je=y.useRef(null),ze=y.useRef(new Set),it=T,Rt=E.showMyPage,ot=E.showCategoryScreen,et=E.showTitleShop,ft=E.showTitlesCollection,Ye=E.showUserProfile,Ve=E.showRanking,Ue=E.showSearchScreen,mt=E.showAchievements,Ge=E.showBookmarks||N==="bookmarks",Dn=E.showNotificationSettings,Lr=C.name==="quiz",Gt=E.showFollowList,Kt=E.showMyContentList,jt=E.showMyPage,lt=E.showCategoryScreen,pt=E.showSearchScreen,On=E.showTitleShop,lr=E.showTitlesCollection,vr=E.showAchievements,br=E.showUserProfile,Yn=Gt,Rs=Kt;y.useEffect(()=>{switch(C.name){case"home":I("home");break;case"myPage":I("profile");break;case"ranking":I("ranking");break;case"bookmarks":I("bookmarks");break;case"category":I("home");break;case"search":I("home");break;case"titleShop":I("home");break;case"titlesCollection":I("profile");break;case"achievements":I("achievements");break;case"followList":I("profile");break;case"myContentList":I("profile");break;case"userProfile":I("home");break;case"adminReports":I("home");break;case"notificationSettings":I("profile");break;case"postDetail":I("home");break}},[C,I]);const[Ir,es]=y.useState(null),[ts,bi]=y.useState(null),[Vr]=y.useState(a4),[ns,Qt]=y.useState("profile"),Mr=["qOyIJeJmdjbqWDpwXiWVcCqZd9m1"],{posts:He,setPosts:pe}=sL(),{balance:Ce,addLumens:vn,spendLumens:Tr}=eL(),Er=y.useMemo(()=>He.filter(W=>W.hidden!==!0),[He]);y.useEffect(()=>{if(!B)return;const W=He.find(K=>K.id===B.id);W&&W!==B&&Y(W)},[He,B]);const Nr=y.useCallback(()=>{je.current&&(clearTimeout(je.current),je.current=null)},[]),fo=y.useCallback(async W=>{const K=String(W);if(ze.current.has(K))return;const fe=He.find(en=>en.id===K);if(!fe)return;const Oe=fe.replies?.some(en=>en?.isAi===!0||typeof en?.aiLabel=="string")===!0,hn=fe.replies?.some(en=>en?.isAi!==!0&&en?.hidden!==!0)===!0;if(Oe||hn)return;const Zt=Bw(fe.createdAt);if(!(!Zt||Date.now()-Zt.getTime()<Wh)){ze.current.add(K);try{await lo(qd,"aiAutoReply")({postId:K,postTitle:fe.title??"",postContent:fe.content??"",postCategory:fe.category??"",postCreatedAt:Zt.toISOString(),replyCount:fe.replies?.length??0})}catch(en){ze.current.delete(K),console.warn("[MainScreen] aiAutoReply ",{code:en?.code,message:en?.message})}}},[He]);y.useEffect(()=>{if(Nr(),!B||C.name!=="postDetail")return;const W=B.id,K=He.find(ur=>ur.id===W)??B,fe=K.replies?.some(ur=>ur?.isAi===!0||typeof ur?.aiLabel=="string")===!0,Oe=K.replies?.some(ur=>ur?.isAi!==!0&&ur?.hidden!==!0)===!0;if(fe||Oe)return;const hn=Bw(K.createdAt);if(!hn)return;const Zt=Date.now(),Ni=hn.getTime()+Wh;if(Ni<=Zt){fo(String(W));return}const en=Math.max(0,Math.min(Ni-Zt,Wh));return je.current=setTimeout(()=>{fo(String(W))},en),()=>Nr()},[Nr,He,C.name,B,fo]),y.useEffect(()=>()=>{Nr()},[Nr]);const{clampedTrust:Pt,updateTrust:Na,addLumensWithTrust:rs}=AL({addLumens:vn}),Ft=_L({lumenBalance:Ce,spendLumens:Tr}),{userActivity:Zd,updateActivity:mo}=rL(rs,(W,K)=>{Ft.addSpecialTitle(W,K)}),eh=YO()?.role==="admin",th=!!_e.currentUser&&Mr.includes(_e.currentUser.uid),ss=eh||th,on=CL({posts:He,userNickname:n}),[po,is]=y.useState("");y.useEffect(()=>{const W=_e.currentUser?.uid;if(!W){is("");return}const K=Se(me,"users",W),fe=fi(K,Oe=>{if(!Oe.exists()){is("");return}const hn=Oe.data(),Zt=typeof hn.profileDescription=="string"?hn.profileDescription:"";is(Zt)},Oe=>{console.error("[MainScreen] users.profileDescription  :",Oe)});return()=>{fe()}},[]);const bn=gL({posts:He,setPosts:pe,selectedPost:B,setSelectedPost:Y,userNickname:n,userActivity:Zd,updateActivity:mo,userPostLanterns:on.userPostLanterns,setUserPostLanterns:on.setUserPostLanterns,userReplyLanterns:on.userReplyLanterns,setUserReplyLanterns:on.setUserReplyLanterns,addLumensWithTrust:rs,updateTrust:Na}),Ur=yL({userNickname:n}),In=wL({userNickname:n}),js=y.useMemo(()=>(C.name==="userProfile"?C.nickname:null)??E.showUserProfile,[C,E.showUserProfile]),os=y.useMemo(()=>{if(!js)return null;const W=He.find(K=>K.author===js&&(typeof K.authorUid=="string"||typeof K.uid=="string"));return W?W.authorUid??W.uid??null:null},[js,He]),_l=y.useMemo(()=>os?[os]:[],[os]),vl=ba(_l),go=os?vl[os]??null:null,as=SL({viewedNickname:js,currentUserNickname:n}),yo=xL({posts:He,setPosts:pe,selectedPost:B,setSelectedPost:Y,userNickname:n,userGuideCount:on.userGuideCount,setUserGuideCount:on.setUserGuideCount,addLumensWithTrust:rs,updateActivity:mo,updateTrust:Na}),Xn=bL({posts:He,setPosts:pe,selectedPost:B,setSelectedPost:Y,userNickname:n,clampedTrust:Pt,updateActivity:mo,userProfileImage:e}),Ti=y.useCallback(W=>{Y(W)},[]),an=NL({posts:He,onPostSelect:Ti}),Tn=kL({posts:He,setPosts:pe,userNickname:n,userProfileImage:e,clampedTrust:Pt,updateActivity:mo}),bl=y.useCallback((W,K)=>{S(W.id,K),J(K),Y(W),Tn.incrementViews(W.id)},[Tn,S]),cn=y.useCallback(()=>{Y(null),g()},[g]),ln=y.useCallback(()=>{Y(null),x()},[x]),un=y.useCallback(()=>{Y(null),v()},[v]),dn=y.useCallback(()=>{Y(null),A()},[A]),ka=y.useCallback(()=>{Y(null),D()},[D]),{isOnline:xo,wasOffline:Il}=pl(),nh=y.useCallback(W=>an.setShowNotifications(W),[an]),rh=y.useCallback(()=>{b({name:"notificationSettings"})},[b]),Tl=y.useCallback(()=>{b({name:"category"})},[b]),El=y.useCallback(()=>{b({name:"quiz"})},[b]),sh=y.useCallback(()=>{b({name:"titleShop"})},[b]),cs=y.useCallback(()=>{ss&&b({name:"adminReports"})},[ss,b]);y.useEffect(()=>{m&&(b({name:"myPage"}),w?.())},[m,w,b]);const Jn=y.useRef({route:C,showWriteScreen:T,selectedPost:B,showTitlesCollection:lr,showTitleShop:On,showAchievements:vr,showMyPage:jt,showSearchScreen:pt,showCategoryScreen:lt,showNotificationSettings:Dn,showMyContentList:Kt,showFollowList:Gt,showUserProfile:br,userProfileSection:ns,lastUserProfileNickname:q,currentScreen:N,postDetailSource:ue}),Ke=y.useCallback((W,K)=>{K?P(W):O(W)},[P,O]);y.useEffect(()=>{Jn.current={route:C,showWriteScreen:T,selectedPost:B,showTitlesCollection:lr,showTitleShop:On,showAchievements:vr,showMyPage:jt,showSearchScreen:pt,showCategoryScreen:lt,showNotificationSettings:Dn,showMyContentList:Kt,showFollowList:Gt,showUserProfile:br,userProfileSection:ns,lastUserProfileNickname:q,currentScreen:N,postDetailSource:ue}}),y.useEffect(()=>Ke("write",T),[T,Ke]),y.useEffect(()=>Ke("postDetail",!!B),[B,Ke]),y.useEffect(()=>Ke("titlesCollection",lr),[lr,Ke]),y.useEffect(()=>Ke("titleShop",On),[On,Ke]),y.useEffect(()=>Ke("achievements",vr),[vr,Ke]),y.useEffect(()=>Ke("userProfile",!!br),[br,Ke]),y.useEffect(()=>Ke("myContentList",!!Kt),[Kt,Ke]),y.useEffect(()=>Ke("followList",!!Gt),[Gt,Ke]),y.useEffect(()=>Ke("myPage",jt),[jt,Ke]),y.useEffect(()=>Ke("category",lt),[lt,Ke]),y.useEffect(()=>Ke("notificationSettings",Dn),[Dn,Ke]),y.useEffect(()=>Ke("ranking",E.showRanking),[E.showRanking,Ke]),y.useEffect(()=>Ke("search",pt),[pt,Ke]),y.useEffect(()=>Ke("quiz",C.name==="quiz"),[C.name,Ke]);const ls=y.useCallback(W=>{const K=W??Jn.current;if(K.selectedPost){if(K.postDetailSource==="myPostsList")Y(null),b({name:"myContentList",mode:"posts"}),I("profile");else if(K.postDetailSource==="myRepliesList")Y(null),b({name:"myContentList",mode:"replies"}),I("profile");else if(K.postDetailSource==="followList")Y(null),b({name:"followList",mode:K.showFollowList??"followers"}),I("profile");else if(K.postDetailSource==="myPage")Y(null),b({name:"myPage"}),I("profile");else if(K.postDetailSource==="userProfilePosts"){Y(null);const fe=K.lastUserProfileNickname??K.showUserProfile;fe?(Qt("posts"),b({name:"userProfile",nickname:fe})):(Qt("profile"),b({name:"home"})),I("home")}else if(K.postDetailSource==="userProfileReplies"){Y(null);const fe=K.lastUserProfileNickname??K.showUserProfile;fe?(Qt("replies"),b({name:"userProfile",nickname:fe})):(Qt("profile"),b({name:"home"})),I("home")}else Y(null),b({name:"home"});J("home")}},[I,J,b,Y,Qt]),Dt=y.useCallback(()=>{const W=R.current,K=W[W.length-1];if(!K)return!1;switch(K){case"write":L(!1),b({name:"home"});break;case"postDetail":ls();break;case"titlesCollection":b({name:"myPage"});break;case"titleShop":b({name:"home"});break;case"achievements":b({name:"myPage"});break;case"userProfile":b({name:"home"});break;case"myContentList":b({name:"myPage"}),I("profile");break;case"followList":b({name:"myPage"}),I("profile");break;case"myPage":b({name:"home"}),I("home");break;case"category":b({name:"home"});break;case"notificationSettings":b({name:"myPage"});break;case"ranking":g();break;case"quiz":b({name:"home"}),I("home");break;case"search":b({name:"home"});break}return O(K),!0},[ls,g,R,O,I,b,L]);y.useEffect(()=>{Gt==="followers"&&In.fetchFollowerUsers()},[Gt,In]),y.useEffect(()=>{let W=null;return(async()=>{if(wu?.addListener)try{W=await wu.addListener("backButton",()=>{const fe=Jn.current;if(!Dt()){if(fe.currentScreen==="home"&&!fe.selectedPost){a?.();return}b({name:"home"}),I("home")}})}catch(fe){console.error("[MainScreen] backButton listener  :",fe)}})(),()=>{W?.remove()}},[Dt,a,I,b]);const De=y.useCallback(()=>{Tn.handleStartWriting(()=>{L(!0),b({name:"home"})})},[Tn,b,L]),wo=y.useCallback(async W=>{const K=await Tn.createPost(W);K&&(L(!1),Y(K),b({name:"postDetail",postId:K.id,source:"home"}))},[Tn,b,Y,L]),Ps=y.useCallback(W=>{!W||W===Yu||(Qt("profile"),U(W),b({name:"userProfile",nickname:W}))},[U,b,Qt]),Ei=y.useCallback(W=>Xn.renderContentWithMentions(W??"",Ps),[Xn,Ps]),Aa=y.useMemo(()=>{const W=He.filter(Oe=>Oe.author===n),K=He.flatMap(Oe=>(Oe.replies??[]).filter(hn=>hn.author===n).map(hn=>({...hn,postTitle:Oe.title,postAuthor:Oe.author,postId:Oe.id}))),fe=He.filter(Oe=>Ur.isBookmarked(Oe.id)).filter(Oe=>Oe.hidden!==!0);return{userPostsForMyPage:W,userRepliesForMyPage:K,userBookmarkedPosts:fe}},[He,n,Ur]),Nl=y.useMemo(()=>{if(!Ye)return{profileTarget:null,profilePosts:[],profileFirstAvatar:""};const W=Ye,K=He.filter(Oe=>Oe.author===W),fe=K[0]?.authorAvatar??"";return{profileTarget:W,profilePosts:K,profileFirstAvatar:fe}},[Ye,He]),kl=y.useMemo(()=>{const W=Er.filter(fe=>fe.author===n),K=Er.flatMap(fe=>(fe.replies??[]).filter(Oe=>Oe.author===n).map(Oe=>({...Oe,authorAvatar:Oe.authorAvatar??void 0,postTitle:fe.title,postAuthor:fe.author,postId:fe.id,postAuthorUid:typeof fe.authorUid=="string"?fe.authorUid:typeof fe.uid=="string"?fe.uid:null})));return{myPosts:W,myReplies:K}},[Er,n]),[Ds,ih]=y.useState(new Set(["home"]));y.useEffect(()=>{ih(W=>{let K="";if(E.showMyPage?K="myPage":E.showRanking?K="ranking":E.showBookmarks?K="bookmarks":E.showTitleShop?K="titleShop":E.showTitlesCollection?K="titlesCollection":E.showAchievements?K="achievements":C.name==="quiz"?K="quiz":E.showFollowList?K="followList":E.showMyContentList?K="myContentList":E.showCategoryScreen?K="category":E.showSearchScreen?K="search":E.showUserProfile?K="userProfile":E.showNotificationSettings?K="notificationSettings":C.name==="adminReports"?K="adminReports":K="home",W.has(K))return W;const fe=new Set(W);return fe.add(K),fe})},[E,C.name]);const oh=C.name==="postDetail"&&B&&C.postId===B.id;return it?o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsx(l4,{onBack:Dt,onSubmit:wo,categories:Vr})}):o.jsxs("div",{className:`w-full h-full relative ${s?"dark":""}`,children:[o.jsxs("div",{className:`w-full h-full bg-background text-foreground flex flex-col absolute inset-0 ${N==="home"&&!ot&&!Ue&&!et&&!Ye&&!C.name.includes("admin")?"z-10 opacity-100":"z-0 opacity-0 pointer-events-none hidden"}`,children:[o.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[(!xo||Il)&&o.jsx("div",{className:`px-3 py-2 text-xs ${xo?"bg-emerald-500/80 text-white":"bg-red-500/80 text-white"}`,children:xo?" .":" . /   ."}),oh&&B?o.jsx(ML,{post:B,userNickname:n,userProfileImage:e,currentTitle:Ft.currentTitle,isDarkMode:s,isPostLanterned:bn.isPostLanterned(B.id),isReplyLanterned:bn.isReplyLanterned,onLanternToggle:()=>bn.handleLanternToggle(B.id),onReplyLanternToggle:bn.handleReplyLanternToggle,isBookmarked:Ur.isBookmarked(B.id),onBookmarkToggle:()=>Ur.handleBookmarkToggle(B.id),isGuideReply:yo.isGuideReply,hasGuide:yo.hasGuide(B.id),onGuideSelect:yo.handleGuideSelect,newReplyContent:Xn.newReplyContent,onReplyContentChange:Xn.handleReplyContentChange,onReplySubmit:Xn.handleReplySubmit,replyInputRef:Xn.replyInputRef,onClose:()=>ls(),onAuthorClick:()=>{Qt("profile"),U(B.author),b({name:"userProfile",nickname:B.author})},onMentionAuthor:()=>Xn.handleInsertMention(B.author),onMentionReplyAuthor:Xn.handleInsertMention,onReplyAuthorClick:W=>{Qt("profile"),U(W),b({name:"userProfile",nickname:W})},onReport:()=>es(B),onDelete:()=>{Tn.deletePost(B.id),ls()},onReportReply:W=>bi(W),renderContentWithMentions:Ei,canSubmitReply:Xn.canSubmitReply}):o.jsxs(o.Fragment,{children:[o.jsx(TM,{isDarkMode:s,onToggleDarkMode:i,hasNotifications:an.notifications.some(W=>!W.isRead),showNotifications:an.showNotifications,onNotificationsToggle:nh,notifications:an.notifications,onNotificationClick:an.handleNotificationClick,onMarkAllNotificationsRead:an.handleMarkAllNotificationsRead,onNotificationSettingsClick:rh,onNotificationDelete:an.removeNotification,activeCategory:H,activeSubCategory:Ae,onCategoryClick:Tl,onQuizClick:El,onTitleShopClick:sh,isAdmin:ss,onOpenAdminReports:cs}),o.jsx(xM,{posts:Er,userNickname:n,userProfileImage:e,activeCategory:H,activeSubCategory:Ae,sortBy:qe,categories:Vr,onSubCategoryChange:ct,onSortChange:re,isPostLanterned:bn.isPostLanterned,isBookmarked:Ur.isBookmarked,onPostClick:W=>bl(W,"home"),onLanternToggle:bn.handleLanternToggle,onBookmarkToggle:Ur.handleBookmarkToggle,onStartWriting:De,currentTitle:Ft.currentTitle})]})]}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]}),Ds.has("myPage")&&o.jsx("div",{className:`absolute inset-0 bg-background ${Rt?"z-20 block":"z-0 hidden"}`,children:o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx(UM,{userNickname:n,userProfileImage:e,onProfileImageChange:t,onBack:Dt,onLogout:r,isDarkMode:s,onToggleDarkMode:i,onShowTerms:c,onShowPrivacy:l,onShowOpenSourceLicenses:d,onShowAttributions:h,userPosts:Aa.userPostsForMyPage,userReplies:Aa.userRepliesForMyPage,bookmarkedPosts:Aa.userBookmarkedPosts,currentTitle:Ft.currentTitle,userGuideCount:on.userGuideCount,trustScore:Pt,profileDescription:po,onProfileDescriptionChange:is,onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onWriteClick:De,onTitleShopClick:()=>{b({name:"titleShop"})},onAchievementsClick:ka,onTitlesCollectionClick:()=>{b({name:"titlesCollection"})},followerCount:In.followerCount,followingCount:In.followingCount,onFollowerCardClick:()=>{b({name:"followList",mode:"followers"})},onFollowingCardClick:()=>{b({name:"followList",mode:"following"})},onMyPostsCardClick:()=>{b({name:"myContentList",mode:"posts"})},onMyRepliesCardClick:()=>{b({name:"myContentList",mode:"replies"})},onPostClick:W=>{const K=He.find(fe=>fe.id===W);K&&bl(K,"myPage")},onReplyClick:W=>{const K=He.find(fe=>fe.id===W);K&&(J("myPage"),Y(K),b({name:"postDetail",postId:K.id,source:"myPage"}))},autoOpenSettings:f,onAutoSettingsOpened:k}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]})})}),Ds.has("ranking")&&o.jsx("div",{className:`absolute inset-0 bg-background transition-all duration-200 ease-out ${Ve?"z-20 opacity-100 translate-y-0":"z-0 opacity-0 translate-y-2 pointer-events-none"}`,children:o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx(JM,{onBack:Dt,weeklyGuideRanking:on.weeklyGuideRanking,totalGuideRanking:on.totalGuideRanking,weeklyLanternRanking:on.weeklyLanternRanking}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]})})}),Ds.has("bookmarks")&&o.jsx("div",{className:`absolute inset-0 bg-background transition-all duration-200 ease-out ${Ge?"z-20 opacity-100 translate-y-0":"z-0 opacity-0 translate-y-2 pointer-events-none"}`,children:o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx(n4,{onBack:Dt,bookmarkedPosts:Ur.bookmarkedPosts,posts:Er,onPostSelect:W=>{Y(W),b({name:"postDetail",postId:W.id,source:"home"})},userNickname:n,currentTitle:Ft.currentTitle}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]})})}),Ds.has("quiz")&&o.jsx("div",{className:`absolute inset-0 bg-background transition-all duration-200 ease-out ${Lr?"z-20 opacity-100 translate-y-0":"z-0 opacity-0 translate-y-2 pointer-events-none"}`,children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx(CM,{onBack:Dt}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]})}),Ds.has("category")&&o.jsx("div",{className:`absolute inset-0 bg-background transition-all duration-200 ease-out ${ot?"z-30 opacity-100 translate-y-0":"z-0 opacity-0 translate-y-2 pointer-events-none"}`,children:o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsx(FM,{onBack:Dt,categories:Vr,activeCategory:H,activeSubCategory:Ae,onCategorySelect:(W,K)=>{we(W),ct(K||"")},posts:He,onPostSelect:W=>{Y(W),b({name:"postDetail",postId:W.id,source:"home"})}})})}),Ds.has("search")&&o.jsx("div",{className:`absolute inset-0 bg-background transition-all duration-200 ease-out ${Ue?"z-30 opacity-100 translate-y-0":"z-0 opacity-0 translate-y-2 pointer-events-none"}`,children:o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsx(WM,{onBack:Dt,posts:Er,onPostSelect:W=>{Y(W),b({name:"postDetail",postId:W.id,source:"home"})}})})}),et&&o.jsx("div",{className:"absolute inset-0 z-30 bg-background",children:o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide",children:o.jsx(u4,{onBack:Dt,userLumens:Ce,userPostLanterns:on.userPostLanterns,userReplyLanterns:on.userReplyLanterns,userGuideCount:on.userGuideCount,ownedTitles:Ft.ownedTitles,currentTitle:Ft.currentTitle,onTitlePurchase:Ft.handleTitlePurchase,onTitleEquip:Ft.handleTitleEquip})}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]})})}),Ye&&o.jsx("div",{className:"absolute inset-0 z-30 bg-background",children:(()=>{const{profileTarget:W,profilePosts:K,profileFirstAvatar:fe}=Nl,Oe=W===n,hn=Oe?In.followerCount:as?.followerCount??0,Zt=Oe?In.followingCount:as?.followingCount??0,Ni=Oe?In.followerUsers:as?.followerUsers??Fw,en=Oe?In.followingUsers:as?.followingUsers??Fw,ur=go?.nickname,ah=go?.isDeleted===!0||ur===" "?" ":ur??W??"";return o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx(m4,{onBack:Dt,username:ah,userAvatar:Oe?e:go?.profileImage??fe??"",userBio:Oe?po:go?.profileDescription??"",posts:K,trustScore:Oe?Pt:void 0,reportCount:0,achievementCount:0,titleCount:0,guideCount:0,followerCount:hn,followingCount:Zt,followerUsers:Ni,followingUsers:en,onPostClick:Os=>{const dr=He.find(Ls=>Ls.id===Os);dr&&(J("userProfilePosts"),U(W),Y(dr),b({name:"postDetail",postId:dr.id,source:"userProfilePosts"}))},onReplyClick:Os=>{const dr=He.find(Ls=>Ls.id===Os);dr&&(J("userProfileReplies"),U(W),Y(dr),b({name:"postDetail",postId:dr.id,source:"userProfileReplies"}))},isMyself:Oe,isFollowing:In.isFollowing(W??""),onToggleFollowUser:In.handleToggleFollowUser,onFollowUserClick:Os=>{Qt("profile"),U(Os),b({name:"userProfile",nickname:Os})},activeSection:ns,onChangeSection:Qt}),o.jsx(hr,{activeTab:N,onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De})]})})})()}),ft&&o.jsx("div",{className:"absolute inset-0 z-30 bg-background",children:o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx("div",{className:"flex-1 overflow-y-auto",children:o.jsx(d4,{onBack:Dt,userTitles:Ft.ownedTitles,equippedTitle:Ft.currentTitle,onTitleEquip:Ft.handleTitleEquip,onTitleUnequip:Ft.handleTitleUnequip})}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]})})}),Yn&&o.jsx("div",{className:"absolute inset-0 z-30 bg-background",children:o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx(f4,{mode:Yn,users:Yn==="followers"?In.followerUsersDetailed:In.followingUsersDetailed,onBack:Dt,onUserClick:W=>{!W||W===Yu||(Qt("profile"),U(W),b({name:"userProfile",nickname:W}))}}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]})})}),Rs&&o.jsx("div",{className:"absolute inset-0 z-30 bg-background",children:o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx(s4,{mode:Rs,onBack:Dt,posts:kl.myPosts,replies:kl.myReplies,onPostClick:W=>{const K=Er.find(fe=>fe.id===W);if(K){const fe=Rs==="posts"?"myPostsList":"myRepliesList";J(fe),Y(K),b({name:"postDetail",postId:K.id,source:fe})}},onReplyClick:(W,K)=>{const fe=Er.find(Oe=>Oe.id===W);fe&&(J("myRepliesList"),Y(fe),b({name:"postDetail",postId:fe.id,source:"myRepliesList"}))}}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]})})}),mt&&o.jsx("div",{className:"absolute inset-0 z-30 bg-background transition-all duration-200 ease-out opacity-100 translate-y-0",children:o.jsx(y.Suspense,{fallback:o.jsx(fr,{}),children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx(h4,{onBack:Dt,userNickname:n,isDarkMode:s}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]})})}),C.name==="adminReports"&&ss&&o.jsx("div",{className:"absolute inset-0 z-40 bg-background",children:o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx(c4,{onBack:Dt}),o.jsx(hr,{onHomeClick:cn,onRankingClick:ln,onBookmarksClick:un,onMyPageClick:dn,onWriteClick:De,activeTab:N})]})}),Dn&&o.jsx("div",{className:"fixed inset-0 z-50 bg-background",children:o.jsx(p4,{onBack:Dt,categories:Vr})}),Ir&&o.jsx(Uw,{open:!!Ir,onOpenChange:W=>!W&&es(null),targetType:"",onSubmit:async(W,K)=>{if(Ir)try{const fe=_e.currentUser?.uid??null;await qu(St(me,"reports"),{targetType:"post",targetId:Ir.id,targetAuthorUid:Ir.authorUid??Ir.uid??null,reporterUid:fe,reasons:W,details:K,createdAt:Sn(),status:"pending",autoHidden:!1,priority:"normal"}),oe.success(" .   .")}catch(fe){console.error("[report]    ",fe),oe.error("    .    .")}finally{es(null)}}}),ts&&o.jsx(Uw,{open:!!ts,onOpenChange:W=>!W&&bi(null),targetType:"",onSubmit:async(W,K)=>{if(ts)try{const fe=_e.currentUser?.uid??null;await qu(St(me,"reports"),{targetType:"reply",targetId:String(ts.id),targetAuthorUid:ts.authorUid??null,reporterUid:fe,reasons:W,details:K,createdAt:Sn(),status:"pending",autoHidden:!1,priority:"normal",postId:B?.id??null}),oe.success(" .   .")}catch(fe){console.error("[report]    ",fe),oe.error("    .    .")}finally{bi(null)}}}),o.jsx(AT,{open:Tn.showPostWarning,onOpenChange:Tn.setShowPostWarning,title:"  ",description:"  30    ",confirmText:"",onConfirm:()=>{Tn.handleWarningConfirm(()=>{L(!0)})},checkbox:Tn.checkboxConfig})]})}function x4({onBack:n}){return o.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-y-auto scrollbar-hide",children:[o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(se,{variant:"ghost",size:"icon",onClick:n,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(o_,{className:"w-5 h-5 text-primary"}),o.jsx("h1",{className:"font-medium",children:" "})]})]})})}),o.jsxs("div",{className:"p-4 space-y-6 pb-20",children:[o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"1.     "})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:'( "")     .         ,       18         .'}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsx("p",{children:"    :   ,   "}),o.jsx("p",{children:"  :  ,   "}),o.jsx("p",{children:"  :  ,  ,   "}),o.jsx("p",{children:"   :   ,   "})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"2.   "})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"     :"}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsx("p",{children:o.jsx("strong",{children:" :"})}),o.jsx("p",{className:"pl-4",children:"   (  )"}),o.jsx("p",{className:"pl-4",children:" "}),o.jsx("p",{className:"pl-4",children:"   ()"}),o.jsx("br",{}),o.jsx("p",{children:o.jsx("strong",{children:"  :"})}),o.jsx("p",{className:"pl-4",children:"   "}),o.jsx("p",{className:"pl-4",children:"  "}),o.jsx("p",{className:"pl-4",children:"     "})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"3.     "})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"               ."}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsxs("p",{children:[" ",o.jsx("strong",{children:" :"}),"    (  )"]}),o.jsxs("p",{children:[" ",o.jsx("strong",{children:"  :"}),'   :   30   / ,      " "  .']}),o.jsxs("p",{children:[" ",o.jsx("strong",{children:"  :"}),"     "]}),o.jsxs("p",{children:[" ",o.jsx("strong",{children:"  :"}),"    "]})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"4.   "})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"       :"}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsxs("p",{children:[" ",o.jsx("strong",{children:" :"}),"     "]}),o.jsxs("p",{children:[" ",o.jsx("strong",{children:" :"}),"   "]})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"5.  3 "})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"   3  . ,    :"}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsx("p",{children:"    "}),o.jsx("p",{children:"   ,           "})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"6.    "})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"             :"}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsx("p",{children:"   "}),o.jsx("p",{children:"      "}),o.jsx("p",{children:"  "}),o.jsx("p",{children:"   "})]}),o.jsx("p",{className:"mt-4",children:'     " "  ""  " "   ,     .'})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"7.         "})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"     (Local Storage) .     ,       ."}),o.jsxs("div",{className:"pl-4 space-y-2 mt-3",children:[o.jsx("p",{children:o.jsx("strong",{children:" :"})}),o.jsx("p",{className:"pl-4",children:"   "}),o.jsx("p",{className:"pl-4",children:"    ( )"}),o.jsx("p",{className:"pl-4",children:"    "}),o.jsx("p",{className:"pl-4",children:"   "})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"8.  "})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"      ,               :"}),o.jsxs("div",{className:"pl-4 space-y-2 mt-3",children:[o.jsxs("p",{children:[" ",o.jsx("strong",{children:" :"}),"  "]}),o.jsxs("p",{children:[" ",o.jsx("strong",{children:":"})," stillimproving0@gmail.com"]})]}),o.jsx("p",{className:"mt-4 text-muted-foreground text-xs",children:"         , ,         ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"9.   "})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"   2025 1 1 ,      ,        7     ."}),o.jsxs("p",{className:"mt-4 text-muted-foreground",children:[o.jsx("strong",{children:":"})," 2025 1 1",o.jsx("br",{}),o.jsx("strong",{children:":"})," 2025 1 1"]})]})]}),o.jsx(Z,{className:"border-primary/20 bg-primary/5",children:o.jsx(ee,{className:"pt-6",children:o.jsxs("p",{className:"text-xs text-muted-foreground leading-relaxed",children:[o.jsx("strong",{className:"text-foreground",children:" :"}),o.jsx("br",{}),"   (PII)       .     ,   .      ."]})})})]})]})}function w4({onBack:n}){return o.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-y-auto scrollbar-hide",children:[o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(se,{variant:"ghost",size:"icon",onClick:n,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Ks,{className:"w-5 h-5 text-primary"}),o.jsx("h1",{className:"font-medium",children:""})]})]})})}),o.jsxs("div",{className:"p-4 space-y-6 pb-20",children:[o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"1 ()"})}),o.jsx(ee,{className:"space-y-3 text-sm leading-relaxed",children:o.jsx("p",{children:'  ( "")   ( "")     ,   ,      .'})})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"2 ()"})}),o.jsx(ee,{className:"space-y-3 text-sm leading-relaxed",children:o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsx("p",{children:'1. ""  (PC,      )  ""        .'}),o.jsx("p",{children:'2. ""           .'}),o.jsx("p",{children:'3. ""      (ID)   .'}),o.jsx("p",{children:'4. "" "" ""   ""  , ,       .'}),o.jsx("p",{children:'5. ""         .'}),o.jsx("p",{children:'6. ""   10 1   ,   .'})]})})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"3 (  )"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"1.             ."}),o.jsx("p",{children:"2.     ,                  ."}),o.jsx("p",{children:"3.           1      7    ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"4 (   )"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"    :"}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsx("p",{children:"1.     "}),o.jsx("p",{children:"2.   "}),o.jsx("p",{children:"3.   "}),o.jsx("p",{children:"4.     "}),o.jsx("p",{children:"5.   "}),o.jsx("p",{children:"6.    "})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"5 ( )"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"1.          , 1 24   ."}),o.jsx("p",{children:"2.       ,             ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"6 ()"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"1.                ."}),o.jsx("p",{children:"2.  1               :"}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsx("p",{children:"          "}),o.jsx("p",{children:"   , ,   "}),o.jsx("p",{children:"           "})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"7 (     )"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"1.           ."}),o.jsx("p",{children:"2.       ,       :"}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsx("p",{children:"       "}),o.jsx("p",{children:"             "}),o.jsx("p",{children:"            "})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"8 (  )"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"1.      ,          ."}),o.jsx("p",{children:"2.       7         ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"9 (   )"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"1.          ."}),o.jsx("p",{children:"2.               ,        , ,    ."}),o.jsx("p",{children:"3.  2        , ,        ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"10 (  ) "})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{className:"font-medium text-primary",children:"         :"}),o.jsxs("div",{className:"pl-4 space-y-2 mt-3",children:[o.jsxs("p",{children:["1. ",o.jsx("strong",{children:"  :"}),"    30  ,     ."]}),o.jsxs("p",{children:["2. ",o.jsx("strong",{children:"  :"}),"       ."]}),o.jsxs("p",{children:["3. ",o.jsx("strong",{children:" :"}),"        :"]}),o.jsxs("div",{className:"pl-4 space-y-1",children:[o.jsx("p",{children:"   "}),o.jsx("p",{children:"    "}),o.jsx("p",{children:"   "}),o.jsx("p",{children:"      "})]})]}),o.jsx("p",{className:"mt-4 text-muted-foreground text-xs",children:"       ,     ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"11 (   )"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsxs("p",{children:["1. ",o.jsx("strong",{children:" :"}),"         ."]}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsx("p",{children:"  :   ."}),o.jsx("p",{children:"  :    (10  1)."})]}),o.jsxs("p",{className:"mt-3",children:["2. ",o.jsx("strong",{children:":"}),"       ,     ."]}),o.jsxs("p",{className:"mt-3",children:["3. ",o.jsx("strong",{children:" :"}),"            ,     5 ."]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"12 ( )"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"1.       ."}),o.jsx("p",{children:"2.      8 ,     ."}),o.jsx("p",{children:"3.     ,    ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"13 ()"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"     :"}),o.jsxs("div",{className:"pl-4 space-y-2",children:[o.jsx("p",{children:"1.       "}),o.jsx("p",{children:"2.   "}),o.jsx("p",{children:"3.    "}),o.jsx("p",{children:"4.     (  )    "}),o.jsx("p",{children:"5.   3     "}),o.jsx("p",{children:"6.   3     "}),o.jsx("p",{children:"7.    , , ,         "}),o.jsx("p",{children:"8. , ,       "}),o.jsx("p",{children:"9. ,   "}),o.jsx("p",{children:"10.       "})]})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"14 ()"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"1.                 ."}),o.jsx("p",{children:"2.           ."}),o.jsx("p",{children:"3.              ."}),o.jsx("p",{children:"4.    , ,  ,       ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"15 ()"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"1.             ."}),o.jsx("p",{children:"2.                    ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"16 (  )"})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"1.             ,        ."}),o.jsx("p",{children:"2.         ."})]})]}),o.jsx(Z,{className:"border-primary/20 bg-primary/5",children:o.jsx(ee,{className:"pt-6",children:o.jsxs("p",{className:"text-sm leading-relaxed",children:[o.jsx("strong",{children:""}),o.jsx("br",{}),o.jsx("span",{className:"text-muted-foreground",children:"  2025 1 1 ."})]})})})]})]})}function _4({onBack:n}){return o.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-y-auto scrollbar-hide",children:[o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(se,{variant:"ghost",size:"icon",onClick:n,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Ks,{className:"w-5 h-5 text-primary"}),o.jsx("h1",{className:"font-medium",children:" "})]})]})})}),o.jsxs("div",{className:"p-4 space-y-6 pb-20",children:[o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:""})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"      ,    ."}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"     .        ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"1. shadcn/ui (MIT License)"})}),o.jsxs(ee,{className:"space-y-2 text-sm leading-relaxed",children:[o.jsx("p",{children:"UI   shadcn/ui     ."}),o.jsxs("ul",{className:"list-disc pl-4 text-muted-foreground space-y-1",children:[o.jsx("li",{children:"    "}),o.jsx("li",{children:"  "}),o.jsx("li",{children:"        "})]}),o.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"  shadcn/ui GitHub  LICENSE   ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"2. Lucide Icons / lucide-react (ISC & MIT)"})}),o.jsxs(ee,{className:"space-y-2 text-sm leading-relaxed",children:[o.jsx("p",{children:"     Lucide   ."}),o.jsxs("ul",{className:"list-disc pl-4 text-muted-foreground space-y-1",children:[o.jsx("li",{children:"ISC   Feather   MIT "}),o.jsx("li",{children:" , ,  "}),o.jsx("li",{children:"       "})]}),o.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"  lucide.dev   GitHub  LICENSE  ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"3.   "})}),o.jsxs(ee,{className:"space-y-4 text-sm text-muted-foreground",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-foreground mb-1",children:"  / "}),o.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[o.jsx("li",{children:"React, React DOM (MIT)"}),o.jsx("li",{children:"Vite (MIT)"}),o.jsx("li",{children:"@capacitor/app (MIT)"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-foreground mb-1",children:"UI    "}),o.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[o.jsxs("li",{children:["Radix UI Primitives",o.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:"(@radix-ui/react-accordion , MIT)"})]}),o.jsx("li",{children:"Vaul    (MIT)"}),o.jsx("li",{children:"Embla Carousel React    (MIT)"}),o.jsx("li",{children:"React Day Picker    (MIT)"}),o.jsx("li",{children:"React Resizable Panels    (MIT)"}),o.jsx("li",{children:"cmdk     (MIT)"}),o.jsx("li",{children:"input-otp  OTP   (MIT)"}),o.jsx("li",{children:"Lucide React    (ISC & MIT)"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-foreground mb-1",children:"    "}),o.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[o.jsx("li",{children:"React Hook Form   / (MIT)"}),o.jsxs("li",{children:["Class Variance Authority (CVA)",o.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:"(Apache-2.0)"})]}),o.jsx("li",{children:"clsx  className  (MIT)"}),o.jsx("li",{children:"tailwind-merge  Tailwind   (MIT)"}),o.jsx("li",{children:"date-fns    (MIT)"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-foreground mb-1",children:"    "}),o.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[o.jsx("li",{children:"Motion    (MIT)"}),o.jsx("li",{children:"Recharts  /  (MIT)"}),o.jsx("li",{children:"Sonner  /  (MIT)"})]})]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"    ,      .   LICENSE        ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"4.  "})}),o.jsxs(ee,{className:"space-y-2 text-sm leading-relaxed",children:[o.jsx("p",{children:"       ,       LICENSE  ."}),o.jsxs("p",{children:["    (:"," ",o.jsx("code",{className:"text-xs",children:"third-party-licenses.txt"}),")   ,             ."]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"        ,          ."})]})]})]})]})}function v4({onBack:n}){return o.jsxs("div",{className:"w-full h-full bg-background text-foreground overflow-y-auto scrollbar-hide",children:[o.jsx("header",{className:"bg-card/95 backdrop-blur-xl border-b border-border flex-shrink-0 safe-top",children:o.jsx("div",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx(se,{variant:"ghost",size:"icon",onClick:n,children:o.jsx(Gn,{className:"w-5 h-5"})}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(kE,{className:"w-5 h-5 text-primary"}),o.jsx("h1",{className:"font-medium",children:" "})]})]})})}),o.jsxs("div",{className:"p-4 space-y-6 pb-20",children:[o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:""})}),o.jsxs(ee,{className:"space-y-3 text-sm leading-relaxed",children:[o.jsx("p",{children:"         ."}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"        .        ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"1. Unsplash "})}),o.jsxs(ee,{className:"space-y-2 text-sm leading-relaxed",children:[o.jsx("p",{children:"     Unsplash     ."}),o.jsxs("ul",{className:"list-disc pl-4 text-muted-foreground space-y-1",children:[o.jsx("li",{children:"    "}),o.jsx("li",{children:"   "}),o.jsx("li",{children:"Unsplash     "})]}),o.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"  Unsplash     ."})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"2. "})}),o.jsxs(ee,{className:"space-y-2 text-sm leading-relaxed",children:[o.jsx("p",{children:"   Lucide      ."}),o.jsx("p",{className:"text-xs text-muted-foreground",children:'    " "    .'})]})]}),o.jsxs(Z,{className:"border-border",children:[o.jsx(ve,{children:o.jsx(Te,{children:"3.  "})}),o.jsxs(ee,{className:"space-y-2 text-sm leading-relaxed",children:[o.jsx("p",{children:"   UI , ,      ,    ."}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"      ,       ."})]})]})]})]})}const b4=({isDarkMode:n=!1,...e})=>o.jsx(GT,{theme:n?"dark":"light",className:"toaster group",closeButton:!1,richColors:!0,position:"top-center",duration:2e3,...e});async function I4(n,e=512,t=.82){if(typeof window>"u"||typeof document>"u"||!n.type.startsWith("image/"))return n;const r=await new Promise((C,b)=>{const N=new FileReader;N.onload=()=>C(N.result),N.onerror=b,N.readAsDataURL(n)}),s=await new Promise((C,b)=>{const N=new Image;N.onload=()=>C(N),N.onerror=b,N.src=r}),{width:i,height:a}=s,c=Math.min(1,e/Math.max(i,a));if(c>=1)return n;const l=Math.round(i*c),d=Math.round(a*c),h=document.createElement("canvas");h.width=l,h.height=d;const m=h.getContext("2d");if(!m)return n;m.drawImage(s,0,0,l,d);const f="image/webp",w=h.toDataURL(f).startsWith(`data:${f}`)?f:"image/jpeg",k=await new Promise(C=>{h.toBlob(b=>C(b??n),w,t)});return!k||!(k instanceof Blob)?n:new File([k],n.name,{type:k.type||w,lastModified:Date.now()})}async function T4(n){const e=_e.currentUser;if(!e)throw new Error("  .");const t=e.uid,r=await I4(n),s=eO(NO,`profileImages/${t}`);await J2(s,r);const i=await Z2(s);return await RA(e,{photoURL:i}),await $n(Se(me,"users",t),{photoURL:i,updatedAt:Sn()},{merge:!0}),i}function E4(){const{isLoading:n,initialScreen:e,userData:t,globalError:r,checkUserStatus:s,resetAuthState:i}=kO(),[a,c]=y.useState("login"),[l,d]=y.useState(""),[h,m]=y.useState(""),f=y.useRef("login"),w=y.useRef([]),k=y.useRef(!1);y.useEffect(()=>{n||(c(e),d(t.nickname),m(t.profileImage))},[n,e,t]),y.useEffect(()=>{r&&oe.error(r)},[r]);const[C,b]=y.useState("login"),[N,I]=y.useState(!1),[E,R]=y.useState(!1),[P,O]=y.useState(!0),[g,x]=y.useState(!1),v=y.useRef(a);y.useEffect(()=>{v.current=a},[a]),y.useEffect(()=>{if(k.current){k.current=!1,f.current=a;return}const G=f.current;G&&G!==a&&w.current.push(G),f.current=a},[a]),pl(),y.useEffect(()=>{const G=localStorage.getItem("darkMode"),q=G!==null?G==="true":!0;O(q),document.documentElement.classList.toggle("dark",q)},[]);const A=y.useCallback(()=>{O(G=>{const q=!G;return localStorage.setItem("darkMode",q.toString()),document.documentElement.classList.toggle("dark",q),q})},[]),S=y.useCallback(async G=>{await s(G)},[s]),D=y.useCallback(()=>{nf(_e).catch(console.error),i(),d(""),m(""),c("login")},[i]),T=y.useCallback(async G=>{try{if(!_e.currentUser)throw new Error("NOT_AUTHENTICATED");await AO(G),d(G),c("guidelines")}catch(q){console.error("[App]   :",q),q instanceof Kn?oe.error(q.message||"  .    ."):q?.message==="NOT_AUTHENTICATED"?(oe.error(" .   ."),D()):oe.error("  .    .")}},[D]),L=y.useCallback(async()=>{try{await CO(),c("welcome")}catch(G){console.error("[App]    :",G),oe.error("   .    .")}},[]),F=y.useCallback(G=>{const q=new FileReader;q.onload=U=>{const B=U.target?.result;B&&m(B)},q.readAsDataURL(G),T4(G).then(U=>{m(U);try{localStorage.setItem("userProfileImage",U)}catch(B){console.warn("  URL localStorage  :",B)}}).catch(U=>{console.error("   :",U),oe.error("  .")})},[]);return y.useEffect(()=>{if(a==="main")return;let G;return(async()=>{G=await wu.addListener("backButton",()=>{const U=v.current,Y=w.current.pop();if(Y){k.current=!0,c(Y);return}U==="login"||U==="guidelines"?x(!0):U==="privacy"||U==="terms"?c(C):U==="openSourceLicenses"||U==="attributions"?c("main"):U==="nickname"?D():U==="welcome"&&c("guidelines")})})(),()=>{G?.remove()}},[a,C,D]),n?o.jsx("div",{className:`w-full h-screen flex items-center justify-center ${P?"dark bg-background":"bg-white"}`,children:o.jsxs("div",{className:"flex flex-col items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-primary/30 border-t-primary rounded-full animate-spin"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:" ..."})]})}):o.jsxs("div",{className:`w-full h-screen ${P?"dark bg-background text-foreground":"bg-white text-gray-900"}`,children:[a==="login"&&o.jsx(UO,{onGoogleLogin:S,onShowTerms:()=>{b("login"),c("terms")},onShowPrivacy:()=>{b("login"),c("privacy")},isDarkMode:P,onToggleDarkMode:A}),a==="nickname"&&o.jsx(zO,{onBack:D,onComplete:T,userEmail:t.email,isDarkMode:P,onToggleDarkMode:A}),a==="guidelines"&&o.jsx(RI,{onBack:()=>c("nickname"),onContinue:L,hideBackButton:!0,isDarkMode:P,onToggleDarkMode:A}),a==="welcome"&&o.jsx(HO,{nickname:l,onRestart:D,onStartApp:()=>c("main"),isDarkMode:P,onToggleDarkMode:A}),a==="main"&&o.jsx(g4,{userNickname:l,userProfileImage:h,onProfileImageChange:F,onLogout:D,isDarkMode:P,onToggleDarkMode:A,onRequestExit:()=>x(!0),onShowTerms:()=>{b("main"),I(!0),R(!0),c("terms")},onShowPrivacy:()=>{b("main"),I(!0),R(!0),c("privacy")},onShowOpenSourceLicenses:()=>{I(!0),R(!0),c("openSourceLicenses")},onShowAttributions:()=>{I(!0),R(!0),c("attributions")},shouldOpenMyPageOnMain:N,shouldOpenSettingsOnMyPage:E,onMainScreenReady:()=>I(!1),onSettingsOpenedFromMain:()=>R(!1)}),a==="privacy"&&o.jsx(x4,{onBack:()=>c(C)}),a==="terms"&&o.jsx(w4,{onBack:()=>c(C)}),a==="openSourceLicenses"&&o.jsx(_4,{onBack:()=>c("main")}),a==="attributions"&&o.jsx(v4,{onBack:()=>c("main")}),a==="main"&&o.jsx(qM,{position:"top",variant:"toast",showReconnectButton:!0}),o.jsx(b4,{isDarkMode:P}),o.jsx(AT,{open:g,onOpenChange:x,title:" ",description:" ?",onConfirm:()=>wu.exitApp()})]})}AE.createRoot(document.getElementById("root")).render(o.jsx(E4,{}));export{O4 as $,NT as A,ht as B,Z as C,tL as D,iU as E,Yu as F,TT as G,ET as H,hl as I,pc as J,zM as K,pr as L,s4 as M,gc as N,Es as O,da as P,_e as Q,$n as R,Fr as S,Op as T,PM as U,Nn as V,f_ as W,hc as X,tS as Y,L4 as Z,V4 as _,fi as a,Y4 as a0,z4 as a1,rU as a2,Zl as a3,F4 as a4,Kx as a5,oo as a6,$s as a7,qs as a8,$r as a9,vs as aA,G4 as aB,Ug as aC,ZA as aD,av as aE,BA as aF,X4 as aa,Z4 as ab,Hs as ac,Pk as ad,Q4 as ae,$4 as af,D4 as ag,U4 as ah,Gx as ai,K4 as aj,R4 as ak,P4 as al,M4 as am,B4 as an,J4 as ao,j4 as ap,H4 as aq,W4 as ar,RA as as,iA as at,q4 as au,tU as av,uC as aw,nU as ax,eU as ay,kA as az,me as b,St as c,Se as d,ve as e,qd as f,Te as g,lo as h,ee as i,se as j,AT as k,Md as l,Qn as m,kT as n,fp as o,BM as p,zn as q,pl as r,Qu as s,oe as t,_n as u,oU as v,jr as w,Je as x,Ia as y,rL as z};
